<html>
<head>
<link href="http://camel.apache.org/styles/camel-manual.css" rel="stylesheet" type="text/css" />
                                <style type="text/css">
                                @page :left {
                                @top-left {
                                content: "Apache Camel 2.18.1 Developer's Manual";
                                }
                                }
                                </style>

                                <link href='http://camel.apache.org/styles/highlighter/styles/shCoreCamel.css' rel='stylesheet' type='text/css' />
                                <link href='http://camel.apache.org/styles/highlighter/styles/shThemeCamel.css' rel='stylesheet' type='text/css' />
                                <script src='http://camel.apache.org/styles/highlighter/scripts/shCore.js' type='text/javascript'></script>
                                <script src='http://camel.apache.org/styles/highlighter/scripts/shBrushSql.js' type='text/javascript'></script>
                                <script src='http://camel.apache.org/styles/highlighter/scripts/shBrushJava.js' type='text/javascript'></script>
                                <script src='http://camel.apache.org/styles/highlighter/scripts/shBrushXml.js' type='text/javascript'></script>
                                <script src='http://camel.apache.org/styles/highlighter/scripts/shBrushPlain.js' type='text/javascript'></script>

                                <script type="text/javascript">
                                SyntaxHighlighter.defaults['toolbar'] = false;
                                SyntaxHighlighter.all();
                                </script>
</head>
<body><div class="wiki-content maincontent"><div class="titlepage" id="titlepage"><h1 id="BookInOnePage-ApacheCamel">Apache Camel</h1><h2 id="BookInOnePage-UserGuide">User Guide</h2><h3>Version 2.18.1</h3><p><br clear="none"> Copyright 2007-2015, Apache Software Foundation</p></div>
<div class="toc" id="toc"><h1 id="BookInOnePage-TableofContents">Table of Contents</h1><p> 
 </p><ul class="toc"><li class="frontmatter"><a shape="rect" href="#toc">Table of Contents</a></li><li class="chapter"><a shape="rect" href="#chapter-introduction">Introduction</a></li><li class="chapter"><a shape="rect" href="#chapter-quickstart">Quickstart</a></li><li class="chapter"><a shape="rect" href="#chapter-getting-started">Getting Started</a></li><li class="chapter"><a shape="rect" href="#chapter-architecture">Architecture</a></li><li class="chapter"><a shape="rect" href="#chapter-enterprise-integration-patterns">Enterprise Integration Patterns</a></li><li class="chapter"><a shape="rect" href="#chapter-cook-book">Cook Book</a></li><li class="chapter"><a shape="rect" href="#chapter-tutorials">Tutorials</a></li><li class="chapter"><a shape="rect" href="#chapter-languages-supported-Appendix">Language Appendix</a></li><li class="chapter"><a shape="rect" href="#chapter-dataformat-Appendix">DataFormat Appendix</a></li><li class="chapter"><a shape="rect" href="#chapter-pattern-appendix">Pattern Appendix</a></li><li class="chapter"><a shape="rect" href="#chapter-component-appendix">Component Appendix</a></li><li class="endmatter"><a shape="rect" href="#index">Index</a></li></ul> </div>
<div class="chapter page-reset" id="chapter-introduction"><h1 id="BookInOnePage-Introduction">Introduction</h1><a shape="rect" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a><p>Camel empowers you to define routing and mediation rules in a variety of domain-specific languages, including a Java-based <a shape="rect" href="dsl.html">Fluent API</a>, <a shape="rect" href="spring.html">Spring</a> or <a shape="rect" href="using-osgi-blueprint-with-camel.html">Blueprint</a> <a shape="rect" href="xml-configuration.html">XML Configuration</a> files, and a <a shape="rect" href="scala-dsl.html">Scala DSL</a>. This means you get smart completion of routing rules in your IDE, whether in a Java, Scala or XML editor.</p><p>Apache Camel uses <a shape="rect" href="uris.html">URIs</a> to work directly with any kind of <a shape="rect" href="transport.html">Transport</a> or messaging model such as <a shape="rect" href="http.html">HTTP</a>, <a shape="rect" href="activemq.html">ActiveMQ</a>, <a shape="rect" href="jms.html">JMS</a>, <a shape="rect" href="jbi.html">JBI</a>, SCA, <a shape="rect" href="mina.html">MINA</a> or <a shape="rect" href="cxf.html">CXF</a>, as well as pluggable <a shape="rect" href="components.html">Components</a> and <a shape="rect" href="data-format.html">Data Format</a> options. Apache Camel is a small library with minimal <a shape="rect" href="what-are-the-dependencies.html">dependencies</a> for easy embedding in any Java application. Apache Camel lets you work with the same <a shape="rect" href="exchange.html">API</a> regardless which kind of <a shape="rect" href="transport.html">Transport</a> is used - so learn the API once and you can interact with all the <a shape="rect" href="components.html">Components</a> provided out-of-box.</p><p>Apache Camel provides support for <a shape="rect" href="bean-binding.html">Bean Binding</a> and seamless integration with popular frameworks such as <a shape="rect" href="cdi.html">CDI</a>,&#160;<a shape="rect" href="spring.html">Spring</a>, <a shape="rect" href="using-osgi-blueprint-with-camel.html">Blueprint</a> and <a shape="rect" href="guice.html">Guice</a>. Camel also has extensive support for <a shape="rect" href="testing.html">unit testing</a> your routes.</p><p>The following projects can leverage Apache Camel as a routing and mediation engine:</p><ul><li><a shape="rect" class="external-link" href="http://servicemix.apache.org/">Apache ServiceMix</a> - a popular distributed open source ESB and JBI container</li><li><a shape="rect" class="external-link" href="http://activemq.apache.org/">Apache ActiveMQ</a> - a mature, widely used open source message broker</li><li><a shape="rect" href="http://cxf.apache.org/">Apache CXF</a> - a smart web services suite (JAX-WS and JAX-RS)</li><li><a shape="rect" class="external-link" href="http://karaf.apache.org/">Apache Karaf</a> - a small OSGi based runtime in which applications can be deployed</li><li><a shape="rect" class="external-link" href="http://mina.apache.org/">Apache MINA</a> - a high-performance <a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/New_I/O" rel="nofollow">NIO</a>-driven networking framework</li></ul><p>So don't get the hump - try Camel today! <img class="emoticon emoticon-smile" src="https://cwiki.apache.org/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/icons/emoticons/smile.png" data-emoticon-name="smile" alt="(smile)"></p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Too many buzzwords - what exactly is Camel?</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Okay, so the description above is technology focused. <br clear="none"> There's a great discussion about Camel at <a shape="rect" class="external-link" href="http://stackoverflow.com/questions/8845186/what-exactly-is-apache-camel" rel="nofollow">Stack Overflow</a>. We suggest you view the post, read the comments, and browse the suggested links for more details.</p>
 </div>
</div></div>
<div class="chapter page-reset" id="chapter-quickstart"><h1 id="BookInOnePage-Quickstart">Quickstart</h1><p>To start using Apache Camel quickly, you can read through some simple examples in this chapter. For readers who would like a more thorough introduction, please skip ahead to Chapter 3.</p><h2 id="BookInOnePage-WalkthroughanExampleCode">Walk through an Example Code</h2><p>This mini-guide takes you through the source code of a <a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/camel/trunk/examples/camel-example-jms-file/src/main/java/org/apache/camel/example/jmstofile/CamelJmsToFileExample.java">simple example</a>.</p><p>Camel can be configured either by using <a shape="rect" href="spring.html">Spring</a> or directly in Java - which <a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/camel/trunk/examples/camel-example-jms-file/src/main/java/org/apache/camel/example/jmstofile/CamelJmsToFileExample.java">this example does</a>.</p><p>This example is available in the <code>examples\camel-example-jms-file</code> directory of the <a shape="rect" href="download.html">Camel distribution</a>.</p><p>We start with creating a <a shape="rect" href="camelcontext.html">CamelContext</a> - which is a container for <a shape="rect" href="components.html">Components</a>, <a shape="rect" href="routes.html">Routes</a> etc:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> CamelContext context = new DefaultCamelContext(); </script> 
 </div>
</div><p>There is more than one way of adding a Component to the CamelContext. You can add components implicitly - when we set up the routing - as we do here for the <a shape="rect" href="file2.html">FileComponent</a>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> context.addRoutes(new RouteBuilder() { public void configure() { from(&amp;quot;test-jms:queue:test.queue&amp;quot;).to(&amp;quot;file://test&amp;quot;); } }); </script> 
 </div>
</div><p>or explicitly - as we do here when we add the JMS Component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> ConnectionFactory connectionFactory = new ActiveMQConnectionFactory(&amp;quot;vm://localhost?broker.persistent=false&amp;quot;); // Note we can explicit name the component context.addComponent(&amp;quot;test-jms&amp;quot;, JmsComponent.jmsComponentAutoAcknowledge(connectionFactory)); </script> 
 </div>
</div><p>The above works with any JMS provider. If we know we are using <a shape="rect" href="activemq.html">ActiveMQ</a> we can use an even simpler form using the <a shape="rect" class="external-link" href="http://activemq.apache.org/maven/5.5.0/activemq-camel/apidocs/org/apache/activemq/camel/component/ActiveMQComponent.html#activeMQComponent%28java.lang.String%29"><code>activeMQComponent()</code> method</a> while specifying the <a shape="rect" class="external-link" href="http://activemq.apache.org/configuring-transports.html">brokerURL</a> used to connect to ActiveMQ</p><div class="error">
 <span class="error">Error formatting macro: snippet: java.lang.IndexOutOfBoundsException: Index: 20, Size: 20</span> 
</div><p>In normal use, an external system would be firing messages or events directly into Camel through one if its <a shape="rect" href="components.html">Components</a> but we are going to use the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/ProducerTemplate.html">ProducerTemplate</a> which is a really easy way for testing your configuration:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> ProducerTemplate template = context.createProducerTemplate(); </script> 
 </div>
</div><p>Next you <strong>must</strong> start the camel context. If you are using <a shape="rect" href="spring.html">Spring</a> to configure the camel context this is automatically done for you; though if you are using a pure Java approach then you just need to call the start() method</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">camelContext.start(); </script> 
 </div>
</div><p>This will start all of the configured routing rules.</p><p>So after starting the <a shape="rect" href="camelcontext.html">CamelContext</a>, we can fire some objects into camel:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> for (int i = 0; i &amp;lt; 10; i++) { template.sendBody(&amp;quot;test-jms:queue:test.queue&amp;quot;, &amp;quot;Test Message: &amp;quot; + i); } </script> 
 </div>
</div><h2 id="BookInOnePage-Whathappens?">What happens?</h2><p>From the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/ProducerTemplate.html">ProducerTemplate</a> - we send objects (in this case text) into the <a shape="rect" href="camelcontext.html">CamelContext</a> to the Component <em>test-jms:queue:test.queue</em>. These text objects will be <a shape="rect" href="type-converter.html">converted automatically</a> into JMS Messages and posted to a JMS Queue named <em>test.queue</em>. When we set up the <a shape="rect" href="routes.html">Route</a>, we configured the <a shape="rect" href="file2.html">FileComponent</a> to listen off the <em>test.queue</em>.</p><p>The File <a shape="rect" href="file2.html">FileComponent</a> will take messages off the Queue, and save them to a directory named <em>test</em>. Every message will be saved in a file that corresponds to its destination and message id.</p><p>Finally, we configured our own listener in the <a shape="rect" href="routes.html">Route</a> - to take notifications from the <a shape="rect" href="file2.html">FileComponent</a> and print them out as text.</p><p><strong>That's it!</strong></p><p>If you have the time then use 5 more minutes to <a shape="rect" href="walk-through-another-example.html">Walk through another example</a> that demonstrates the Spring DSL (XML based) routing.</p><h2 id="BookInOnePage-Walkthroughanotherexample">Walk through another example</h2><h3 id="BookInOnePage-Introduction.1">Introduction</h3><p>Continuing the walk from our first <a shape="rect" href="walk-through-an-example.html">example</a>, we take a closer look at the routing and explain a few pointers - so you won't walk into a bear trap, but can enjoy an after-hours walk to the local pub for a large beer <img class="emoticon emoticon-wink" src="https://cwiki.apache.org/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/icons/emoticons/wink.png" data-emoticon-name="wink" alt="(wink)"></p><p>First we take a moment to look at the <a shape="rect" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a> - the base pattern catalog for integration scenarios. In particular we focus on <a shape="rect" href="pipes-and-filters.html">Pipes and filters</a> - a central pattern. This is used to route messages through a sequence of processing steps, each performing a specific function - much like the Java Servlet Filters. </p><h3 id="BookInOnePage-Pipesandfilters">Pipes and filters</h3><p>In this sample we want to process a message in a sequence of steps where each steps can perform their specific function. In our example we have a <a shape="rect" href="jms.html">JMS</a> queue for receiving new orders. When an order is received we need to process it in several steps:</p><ul class="alternate"><li>validate</li><li>register</li><li>send confirm email</li></ul><p>This can be created in a route like this:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;jms:queue:order&amp;quot;/&amp;gt; &amp;lt;pipeline&amp;gt; &amp;lt;bean ref=&amp;quot;validateOrder&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;registerOrder&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;sendConfirmEmail&amp;quot;/&amp;gt; &amp;lt;/pipeline&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Pipeline is default</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body"> 
  <p>In the route above we specify <code>pipeline</code> but it can be omitted as its default, so you can write the route as:</p> 
  <div class="code panel pdl" style="border-width: 1px;">
   <div class="codeContent panelContent pdl"> 
    <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;jms:queue:order&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;validateOrder&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;registerOrder&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;sendConfirmEmail&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
   </div>
  </div> 
  <p>This is commonly used not to state the pipeline. </p> 
  <p>An example where the pipeline needs to be used, is when using a multicast and "one" of the endpoints to send to (as a logical group) is a pipeline of other endpoints. For example.</p> 
  <div class="code panel pdl" style="border-width: 1px;">
   <div class="codeContent panelContent pdl"> 
    <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;jms:queue:order&amp;quot;/&amp;gt; &amp;lt;multicast&amp;gt; &amp;lt;to uri=&amp;quot;log:org.company.log.Category&amp;quot;/&amp;gt; &amp;lt;pipeline&amp;gt; &amp;lt;bean ref=&amp;quot;validateOrder&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;registerOrder&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;sendConfirmEmail&amp;quot;/&amp;gt; &amp;lt;/pipeline&amp;gt; &amp;lt;/multicast&amp;gt; &amp;lt;/route&amp;gt; </script> 
   </div>
  </div> 
  <p>The above sends the order (from <code>jms:queue:order</code>) to two locations at the same time, our log component, and to the "pipeline" of beans which goes one to the other. If you consider the opposite, sans the <code>&lt;pipeline&gt;</code></p> 
  <div class="code panel pdl" style="border-width: 1px;">
   <div class="codeContent panelContent pdl"> 
    <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;jms:queue:order&amp;quot;/&amp;gt; &amp;lt;multicast&amp;gt; &amp;lt;to uri=&amp;quot;log:org.company.log.Category&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;validateOrder&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;registerOrder&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;sendConfirmEmail&amp;quot;/&amp;gt; &amp;lt;/multicast&amp;gt; &amp;lt;/route&amp;gt; </script> 
   </div>
  </div> 
  <p>you would see that multicast would not "flow" the message from one bean to the next, but rather send the order to all 4 endpoints (1x log, 3x bean) in parallel, which is not (for this example) what we want. We need the message to flow to the validateOrder, then to the registerOrder, then the sendConfirmEmail so adding the pipeline, provides this facility. </p> 
 </div>
</div><p>Where as the <code>bean ref</code> is a reference for a spring bean id, so we define our beans using regular Spring XML as:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;validateOrder&amp;quot; class=&amp;quot;com.mycompany.MyOrderValidator&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>Our validator bean is a plain POJO that has no dependencies to Camel what so ever. So you can implement this POJO as you like. Camel uses rather intelligent <a shape="rect" href="bean-binding.html">Bean Binding</a> to invoke your POJO with the payload of the received message. In this example we will <strong>not</strong> dig into this how this happens. You should return to this topic later when you got some hands on experience with Camel how it can easily bind routing using your existing POJO beans.</p><p>So what happens in the route above. Well when an order is received from the <a shape="rect" href="jms.html">JMS</a> queue the message is routed like <a shape="rect" href="pipes-and-filters.html">Pipes and filters</a>:<br clear="none"> 1. payload from the <a shape="rect" href="jms.html">JMS</a> is sent as input to the validateOrder bean<br clear="none"> 2. the output from validateOrder bean is sent as input to the registerOrder bean<br clear="none"> 3. the output from registerOrder bean is sent as input to the sendConfirmEmail bean</p><h3 id="BookInOnePage-UsingCamelComponents">Using Camel Components</h3><p>In the route lets imagine that the registration of the order has to be done by sending data to a TCP socket that could be a big mainframe. As Camel has many <a shape="rect" href="components.html">Components</a> we will use the camel-mina component that supports <a shape="rect" href="mina.html">TCP</a> connectivity. So we change the route to:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;jms:queue:order&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;validateOrder&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mina:tcp://mainframeip:4444?textline=true&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;sendConfirmEmail&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>What we now have in the route is a <code>to</code> type that can be used as a direct replacement for the bean type. The steps is now:<br clear="none"> 1. payload from the <a shape="rect" href="jms.html">JMS</a> is sent as input to the validateOrder bean<br clear="none"> 2. the output from validateOrder bean is sent as text to the mainframe using TCP<br clear="none"> 3. the output from mainframe is sent back as input to the sendConfirmEmai bean</p><p>What to notice here is that the <code>to</code> is not the end of the route (the world <img class="emoticon emoticon-wink" src="https://cwiki.apache.org/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/icons/emoticons/wink.png" data-emoticon-name="wink" alt="(wink)">) in this example it's used in the middle of the <a shape="rect" href="pipes-and-filters.html">Pipes and filters</a>. In fact we can change the <code>bean</code> types to <code>to</code> as well:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;jms:queue:order&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:validateOrder&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mina:tcp://mainframeip:4444?textline=true&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:sendConfirmEmail&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>As the <code>to</code> is a generic type we must state in the uri scheme which component it is. So we must write <strong>bean:</strong> for the <a shape="rect" href="bean.html">Bean</a> component that we are using.</p><h3 id="BookInOnePage-Conclusion">Conclusion</h3><p>This example was provided to demonstrate the Spring DSL (XML based) as opposed to the pure Java DSL from the <a shape="rect" href="walk-through-an-example.html">first example</a>. And as well to point about that the <code>to</code> doesn't have to be the last node in a route graph.</p><p>This example is also based on the <strong>in-only</strong> message exchange pattern. What you must understand as well is the <strong>in-out</strong> message exchange pattern, where the caller expects a response. We will look into this in another example.</p><h3 id="BookInOnePage-Seealso">See also</h3><ul class="alternate"><li><a shape="rect" href="examples.html">Examples</a></li><li><a shape="rect" href="tutorials.html">Tutorials</a></li><li><a shape="rect" href="user-guide.html">User Guide</a></li></ul></div>
<div class="chapter" id="chapter-getting-started"><h1 id="BookInOnePage-GettingStartedwithApacheCamel">Getting Started with Apache Camel</h1></div>

<p><span class="confluence-anchor-link" id="BookInOnePage-eip-book"></span></p>
<h2 id="BookInOnePage-TheEnterpriseIntegrationPatterns(EIP)book">The <em>Enterprise Integration Patterns</em> (EIP) book</h2>
<p>The purpose of a "patterns" book is not to advocate new techniques that the authors have invented, but rather to document existing best practices within a particular field. By doing this, the authors of a patterns book hope to spread knowledge of best practices and promote a vocabulary for discussing architectural designs.<br clear="none">
One of the most famous patterns books is <a shape="rect" class="external-link" href="http://www.amazon.com/Design-Patterns-Elements-Reusable-Object-Oriented/dp/0201633612" rel="nofollow"><em>Design Patterns: Elements of Reusable Object-oriented Software</em></a> by Erich Gamma, Richard Helm, Ralph Johnson and John Vlissides, commonly known as the <a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/Design_Patterns" rel="nofollow">"Gang of Four" (GoF)</a> book.  Since the publication of <em>Design Patterns</em>, many other pattern books, of varying quality, have been written. One famous patterns book is called <a shape="rect" class="external-link" href="http://www.amazon.com/Enterprise-Integration-Patterns-Designing-Deploying/dp/0321200683" rel="nofollow"><em>Enterprise Integration Patterns: Designing, Building, and Deploying Messaging Solutions</em></a> by Gregor Hohpe and Bobby Woolf. It is common for people to refer to this book by its initials <em>EIP</em>. As the subtitle of EIP suggests, the book focuses on design patterns for asynchronous messaging systems. The book discusses 65 patterns. Each pattern is given a textual name and most are also given a graphical symbol, intended to be used in architectural diagrams.</p>

<h2 id="BookInOnePage-TheCamelproject">The Camel project</h2>
<p>Camel (<a shape="rect" class="external-link" href="http://camel.apache.org">http://camel.apache.org</a>) is an open-source, Java-based project that helps the user implement many of the design patterns in the EIP book. Because Camel implements many of the design patterns in the EIP book, it would be a good idea for people who work with Camel to have the EIP book as a reference.</p>

<h2 id="BookInOnePage-OnlinedocumentationforCamel">Online documentation for Camel</h2>
<p>The documentation is all under the Documentation category on the right-side menu of the Camel website (also available in <a shape="rect" class="external-link" href="http://camel.apache.org/manual.html">PDF form</a>.  <a shape="rect" href="books.html">Camel-related books</a> are also available, in particular the <a shape="rect" class="external-link" href="http://manning.com/ibsen" rel="nofollow">Camel in Action</a> book, presently serving as the Camel bible--it has a <a shape="rect" class="external-link" href="http://www.manning.com/ibsen/chapter1sample.pdf" rel="nofollow">free Chapter One (pdf)</a>, which is highly recommended to read to get more familiar with Camel.</p>

<h3 id="BookInOnePage-Ausefultipfornavigatingtheonlinedocumentation">A useful tip for navigating the online documentation</h3>
<p>The breadcrumbs at the top of the online Camel documentation can help you navigate between parent and child subsections.  <br clear="none">
For example, If you are on the "Languages" documentation page then the left-hand side of the reddish bar contains the following links.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
Apache Camel &gt; Documentation &gt; Architecture &gt; Languages
]]></script>
</div></div>
<p>As you might expect, clicking on "Apache Camel" takes you back to the home page of the Apache Camel project, and clicking on "Documentation" takes you to the main documentation page. You can interpret the "Architecture" and "Languages" buttons as indicating you are in the "Languages" section of the "Architecture" chapter. Adding browser bookmarks to pages that you frequently reference can also save time.  </p>

<p><span class="confluence-anchor-link" id="BookInOnePage-online-javadoc-docs"></span></p>
<h2 id="BookInOnePage-OnlineJavadocdocumentation">Online Javadoc documentation</h2>
<p>The Apache Camel website provides <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/index.html">Javadoc documentation</a>. It is important to note that the Javadoc documentation is spread over several <em>independent</em> Javadoc hierarchies rather than being all contained in a single Javadoc hierarchy. In particular, there is one Javadoc hierarchy for the <em>core</em> APIs of Camel, and a separate Javadoc hierarchy for each component technology supported by Camel. For example, if you will be using Camel with ActiveMQ and FTP then you need to look at the Javadoc hierarchies for the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/index.html">core API</a> and <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-spring/apidocs/index.html">Spring API</a>.</p>

<h2 id="BookInOnePage-ConceptsandterminologyfundamentaltoCamel">Concepts and terminology fundamental to Camel</h2>
<p>In this section some of the concepts and terminology that are fundamental to Camel are explained. This section is not meant as a complete Camel tutorial, but as a first step in that direction.</p>

<p><span class="confluence-anchor-link" id="BookInOnePage-endpoint"></span></p>
<h3 id="BookInOnePage-Endpoint">Endpoint</h3>
<p>The term <em>endpoint</em> is often used when talking about inter-process communication. For example, in client-server communication, the client is one endpoint and the server is the other endpoint. Depending on the context, an endpoint might refer to an <em>address</em>, such as a host:port pair for TCP-based communication, or it might refer to a <em>software entity</em> that is contactable at that address. For example, if somebody uses "www.example.com:80" as an example of an endpoint, they might be referring to the actual port at that host name (that is, an address), or they might be referring to the web server (that is, software contactable at that address). Often, the distinction between the address and software contactable at that address is not an important one.<br clear="none">
Some middleware technologies make it possible for several software entities to be contactable at the same physical address. For example, CORBA is an object-oriented, remote-procedure-call (RPC) middleware standard. If a CORBA server process contains several objects then a client can communicate with any of these objects at the same <em>physical</em> address (host:port), but a client communicates with a particular object via that object's <em>logical</em> address (called an <em>IOR</em> in CORBA terminology), which consists of the physical address (host:port) plus an id that uniquely identifies the object within its server process. (An IOR contains some additional information that is not relevant to this present discussion.) When talking about CORBA, some people may use the term "endpoint" to refer to a CORBA server's <em>physical address</em>, while other people may use the term to refer to the <em>logical address</em> of a single CORBA object, and other people still might use the term to refer to any of the following:</p>
<ul><li>The physical address (host:port) of the CORBA server process</li><li>The logical address (host:port plus id) of a CORBA object.</li><li>The CORBA server process (a relatively heavyweight software entity)</li><li>A CORBA object (a lightweight software entity)</li></ul>


<p>Because of this, you can see that the term <em>endpoint</em> is ambiguous in at least two ways. First, it is ambiguous because it might refer to an address or to a software entity contactable at that address. Second, it is ambiguous in the <em>granularity</em> of what it refers to: a heavyweight versus lightweight software entity, or physical address versus logical address. It is useful to understand that different people use the term <em>endpoint</em> in slightly different (and hence ambiguous) ways because Camel's usage of this term might be different to whatever meaning you had previously associated with the term.<br clear="none">
Camel provides out-of-the-box support for endpoints implemented with many different communication technologies. Here are some examples of the Camel-supported endpoint technologies.</p>
<ul><li>A JMS queue.</li><li>A web service.</li><li>A file. A file may sound like an unlikely type of endpoint, until you realize that in some systems one application might write information to a file and, later, another application might read that file.</li><li>An FTP server.</li><li>An email address. A client can send a message to an email address, and a server can read an incoming message from a mail server.</li><li>A POJO (plain old Java object).</li></ul>


<p>In a Camel-based application, you create (Camel wrappers around) some endpoints and connect these endpoints with <em>routes</em>, which I will discuss later in <a shape="rect" href="#BookInOnePage-routes">Section 4.8 ("Routes, RouteBuilders and Java DSL")</a>. Camel defines a Java interface called <code>Endpoint</code>. Each Camel-supported endpoint has a class that implements this <code>Endpoint</code> interface. As I discussed in <a shape="rect" href="#BookInOnePage-online-javadoc-docs">Section 3.3 ("Online Javadoc documentation")</a>, Camel provides a separate Javadoc hierarchy for each communications technology supported by Camel. Because of this, you will find documentation on, say, the <code>JmsEndpoint</code> class in the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-jms/apidocs/">JMS Javadoc hierarchy</a>, while documentation for, say, the <code>FtpEndpoint</code> class is in the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-ftp/apidocs/">FTP Javadoc hierarchy</a>.</p>

<h3 id="BookInOnePage-CamelContext">CamelContext</h3>
<p>A <code>CamelContext</code> object represents the Camel runtime system. You typically have one <code>CamelContext</code> object in an application. A typical application executes the following steps.</p>
<ol><li>Create a <code>CamelContext</code> object.</li><li>Add endpoints &#8211; and possibly Components, which are discussed in <a shape="rect" href="#BookInOnePage-components-and-uris">Section 4.5 ("Components")</a> &#8211; to the <code>CamelContext</code> object.</li><li>Add routes to the <code>CamelContext</code> object to connect the endpoints.</li><li>Invoke the <code>start()</code> operation on the <code>CamelContext</code> object. This starts Camel-internal threads that are used to process the sending, receiving and processing of messages in the endpoints.</li><li>Eventually invoke the <code>stop()</code> operation on the <code>CamelContext</code> object. Doing this gracefully stops all the endpoints and Camel-internal threads.</li></ol>


<p>Note that the <code>CamelContext.start()</code> operation does not block indefinitely. Rather, it starts threads internal to each <code>Component</code> and <code>Endpoint</code> and then <code>start()</code> returns. Conversely, <code>CamelContext.stop()</code> waits for all the threads internal to each <code>Endpoint</code> and <code>Component</code> to terminate and then <code>stop()</code> returns.<br clear="none">
If you neglect to call <code>CamelContext.start()</code> in your application then messages will not be processed because internal threads will not have been created.<br clear="none">
If you neglect to call <code>CamelContext.stop()</code> before terminating your application then the application may terminate in an inconsistent state. If you neglect to call <code>CamelContext.stop()</code> in a JUnit test then the test may fail due to messages not having had a chance to be fully processed.</p>

<h3 id="BookInOnePage-CamelTemplate">CamelTemplate</h3>
<p>Camel used to have a class called <code>CamelClient</code>, but this was renamed to be <code>CamelTemplate</code> to be similar to a naming convention used in some other open-source projects, such as the <code>TransactionTemplate</code> and <code>JmsTemplate</code> classes in <a shape="rect" class="external-link" href="http://www.springframework.org/" rel="nofollow">Spring</a>.<br clear="none">
The <code>CamelTemplate</code> class is a thin wrapper around the <code>CamelContext</code> class. It has methods that send a <code>Message</code> or <code>Exchange</code> &#8211; both discussed in <a shape="rect" href="#BookInOnePage-message-and-exchange">Section 4.6 ("Message and Exchange")</a>) &#8211; to an <code>Endpoint</code> &#8211; discussed in <a shape="rect" href="#BookInOnePage-endpoint">Section 4.1 ("Endpoint")</a>. This provides a way to enter messages into source endpoints, so that the messages will move along routes &#8211; discussed in <a shape="rect" href="#BookInOnePage-routes">Section 4.8 ("Routes, RouteBuilders and Java DSL")</a> &#8211; to destination endpoints.</p>

<p><span class="confluence-anchor-link" id="BookInOnePage-url-uri-urn-iri"></span></p>
<h3 id="BookInOnePage-TheMeaningofURL,URI,URNandIRI">The Meaning of URL, URI, URN and IRI </h3>
<p>Some Camel methods take a parameter that is a <em>URI</em> string. Many people know that a URI is "something like a URL" but do not properly understand the relationship between URI and URL, or indeed its relationship with other acronyms such as IRI and URN.<br clear="none">
Most people are familiar with <em>URLs</em> (uniform resource locators), such as "http://...", "ftp://...", "mailto:...". Put simply, a URL specifies the <em>location</em> of a resource.<br clear="none">
A <em>URI</em> (uniform resource identifier) is a URL <em>or</em> a URN. So, to fully understand what URI means, you need to first understand what is a URN.<br clear="none">
<em>URN</em> is an acronym for <em>uniform resource name</em>. There are may "unique identifier" schemes in the world, for example, ISBNs (globally unique for books), social security numbers (unique within a country), customer numbers (unique within a company's customers database) and telephone numbers. Each "unique identifier" scheme has its own notation. A URN is a wrapper for different "unique identifier" schemes. The syntax of a URN is "urn:&lt;scheme-name&gt;:&lt;unique-identifier&gt;". A URN uniquely identifies a <em>resource</em>, such as a book, person or piece of equipment. By itself, a URN does not specify the <em>location</em> of the resource. Instead, it is assumed that a <em>registry</em> provides a mapping from a resource's URN to its location. The URN specification does not state what form a registry takes, but it might be a database, a server application, a wall chart or anything else that is convenient. Some hypothetical examples of URNs are "urn:employee:08765245", "urn:customer:uk:3458:hul8" and "urn:foo:0000-0000-9E59-0000-5E-2". The &lt;scheme-name&gt; ("employee", "customer" and "foo" in these examples) part of a URN implicitly defines how to parse and interpret the &lt;unique-identifier&gt; that follows it. An arbitrary URN is meaningless unless: (1) you know the semantics implied by the &lt;scheme-name&gt;, and (2) you have access to the registry appropriate for the &lt;scheme-name&gt;. A registry does not have to be public or globally accessible. For example, "urn:employee:08765245" might be meaningful only within a specific company.<br clear="none">
To date, URNs are not (yet) as popular as URLs. For this reason, URI is widely misused as a synonym for URL.<br clear="none">
<em>IRI</em> is an acronym for <em>internationalized resource identifier</em>. An IRI is simply an internationalized version of a URI. In particular, a URI can contain letters and digits in the US-ASCII character set, while a IRI can contain those same letters and digits, and <em>also</em> European accented characters, Greek letters, Chinese ideograms and so on.</p>

<h3 id="BookInOnePage-Components">Components</h3>
<p><em>Component</em> is confusing terminology; <em>EndpointFactory</em> would have been more appropriate because a <code>Component</code> is a factory for creating <code>Endpoint</code> instances. For example, if a Camel-based application uses several JMS queues then the application will create one instance of the <code>JmsComponent</code> class (which implements the <code>Component</code> interface), and then the application invokes the <code>createEndpoint()</code> operation on this <code>JmsComponent</code> object several times. Each invocation of <code>JmsComponent.createEndpoint()</code> creates an instance of the <code>JmsEndpoint</code> class (which implements the <code>Endpoint</code> interface). Actually, application-level code does not invoke <code>Component.createEndpoint()</code> directly. Instead, application-level code normally invokes <code>CamelContext.getEndpoint()</code>; internally, the <code>CamelContext</code> object finds the desired <code>Component</code> object (as I will discuss shortly) and then invokes <code>createEndpoint()</code> on it.<br clear="none">
Consider the following code.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
myCamelContext.getEndpoint(&quot;pop3://john.smith@mailserv.example.com?password=myPassword&quot;);
]]></script>
</div></div>
<p>The parameter to <code>getEndpoint()</code> is a URI. The URI <em>prefix</em> (that is, the part before ":") specifies the name of a component. Internally, the <code>CamelContext</code> object maintains a mapping from names of components to <code>Component</code> objects. For the URI given in the above example, the <code>CamelContext</code> object would probably map the <code>pop3</code> prefix to an instance of the <code>MailComponent</code> class. Then the <code>CamelContext</code> object invokes <code>createEndpoint("pop3://john.smith@mailserv.example.com?password=myPassword")</code> on that <code>MailComponent</code> object. The <code>createEndpoint()</code> operation splits the URI into its component parts and uses these parts to create and configure an <code>Endpoint</code> object.<br clear="none">
In the previous paragraph, I mentioned that a <code>CamelContext</code> object maintains a mapping from component names to <code>Component</code> objects. This raises the question of how this map is populated with named <code>Component</code> objects. There are two ways of populating the map. The first way is for application-level code to invoke <code>CamelContext.addComponent(String componentName, Component component)</code>. The example below shows a single <code>MailComponent</code> object being registered in the map under 3 different names.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
Component mailComponent = new org.apache.camel.component.mail.MailComponent();
myCamelContext.addComponent(&quot;pop3&quot;, mailComponent);
myCamelContext.addComponent(&quot;imap&quot;, mailComponent);
myCamelContext.addComponent(&quot;smtp&quot;, mailComponent);
]]></script>
</div></div>
<p>The second (and preferred) way to populate the map of named <code>Component</code> objects in the <code>CamelContext</code> object is to let the <code>CamelContext</code> object perform lazy initialization. This approach relies on developers following a convention when they write a class that implements the <code>Component</code> interface. I illustrate the convention by an example. Let's assume you write a class called <code>com.example.myproject.FooComponent</code> and you want Camel to automatically recognize this by the name "foo". To do this, you have to write a properties file called "META-INF/services/org/apache/camel/component/foo" (without a ".properties" file extension) that has a single entry in it called <code>class</code>, the value of which is the fully-scoped name of your class. This is shown below.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>META-INF/services/org/apache/camel/component/foo</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
class=com.example.myproject.FooComponent
]]></script>
</div></div>
<p>If you want Camel to also recognize the class by the name "bar" then you write another properties file in the same directory called "bar" that has the same contents. Once you have written the properties file(s), you create a jar file that contains the <code>com.example.myproject.FooComponent</code> class and the properties file(s), and you add this jar file to your CLASSPATH. Then, when application-level code invokes <code>createEndpoint("foo:...")</code> on a <code>CamelContext</code> object, Camel will find the "foo"" properties file on the CLASSPATH, get the value of the <code>class</code> property from that properties file, and use reflection APIs to create an instance of the specified class.<br clear="none">
As I said in <a shape="rect" href="#BookInOnePage-endpoint">Section 4.1 ("Endpoint")</a>, Camel provides out-of-the-box support for numerous communication technologies. The out-of-the-box support consists of classes that implement the <code>Component</code> interface plus properties files that enable a <code>CamelContext</code> object to populate its map of named <code>Component</code> objects.<br clear="none">
Earlier in this section I gave the following example of calling <code>CamelContext.getEndpoint()</code>.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
myCamelContext.getEndpoint(&quot;pop3://john.smith@mailserv.example.com?password=myPassword&quot;);
]]></script>
</div></div>
<p>When I originally gave that example, I said that the parameter to <code>getEndpoint()</code> was a URI. I said that because the online Camel documentation and the Camel source code both claim the parameter is a URI. In reality, the parameter is restricted to being a URL. This is because when Camel extracts the component name from the parameter, it looks for the first ":", which is a simplistic algorithm. To understand why, recall from <a shape="rect" href="#BookInOnePage-url-uri-urn-iri">Section 4.4 ("The Meaning of URL, URI, URN and IRI")</a> that a URI can be a URL <em>or</em> a URN. Now consider the following calls to <code>getEndpoint</code>.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
myCamelContext.getEndpoint(&quot;pop3:...&quot;);
myCamelContext.getEndpoint(&quot;jms:...&quot;);
myCamelContext.getEndpoint(&quot;urn:foo:...&quot;);
myCamelContext.getEndpoint(&quot;urn:bar:...&quot;);
]]></script>
</div></div>
<p>Camel identifies the components in the above example as "pop3", "jms", "urn" and "urn". It would be more useful if the latter components were identified as "urn:foo" and "urn:bar" or, alternatively, as "foo" and "bar" (that is, by skipping over the "urn:" prefix). So, in practice you must identify an endpoint with a URL (a string of the form "&lt;scheme&gt;:...") rather than with a URN (a string of the form "urn:&lt;scheme&gt;:..."). This lack of proper support for URNs means the you should consider the parameter to <code>getEndpoint()</code> as being a URL rather than (as claimed) a URI.</p>

<p><span class="confluence-anchor-link" id="BookInOnePage-message-and-exchange"></span></p>
<h3 id="BookInOnePage-MessageandExchange">Message and Exchange</h3>
<p>The <code>Message</code> interface provides an abstraction for a single message, such as a request, reply or exception message.<br clear="none">
There are concrete classes that implement the <code>Message</code> interface for each Camel-supported communications technology. For example, the <code>JmsMessage</code> class provides a JMS-specific implementation of the <code>Message</code> interface. The public API of the <code>Message</code> interface provides get- and set-style methods to access the <em>message id</em>, <em>body</em> and individual <em>header</em> fields of a messge.<br clear="none">
The <code>Exchange</code> interface provides an abstraction for an exchange of messages, that is, a request message and its corresponding reply or exception message. In Camel terminology, the request, reply and exception messages are called <em>in</em>, <em>out</em> and <em>fault</em> messages.<br clear="none">
There are concrete classes that implement the <code>Exchange</code> interface for each Camel-supported communications technology. For example, the <code>JmsExchange</code> class provides a JMS-specific implementation of the <code>Exchange</code> interface. The public API of the <code>Exchange</code> interface is quite limited. This is intentional, and it is expected that each class that implements this interface will provide its own technology-specific operations.<br clear="none">
Application-level programmers rarely access the <code>Exchange</code> interface (or classes that implement it) directly. However, many classes in Camel are generic types that are instantiated on (a class that implements) <code>Exchange</code>. Because of this, the <code>Exchange</code> interface appears a lot in the generic signatures of classes and methods.</p>

<h3 id="BookInOnePage-Processor">Processor</h3>
<p>The <code>Processor</code> interface represents a class that processes a message. The signature of this interface is shown below.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Processor</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
package org.apache.camel;
public interface Processor {
    void process(Exchange exchange) throws Exception;
}
]]></script>
</div></div>
<p>Notice that the parameter to the <code>process()</code> method is an <code>Exchange</code> rather than a <code>Message</code>. This provides flexibility. For example, an implementation of this method initially might call <code>exchange.getIn()</code> to get the input message and process it. If an error occurs during processing then the method can call <code>exchange.setException()</code>.<br clear="none">
An application-level developer might implement the <code>Processor</code> interface with a class that executes some business logic. However, there are many classes in the Camel library that implement the <code>Processor</code> interface in a way that provides support for a design pattern in the <a shape="rect" href="#BookInOnePage-eip-book">EIP book</a>. For example, <code>ChoiceProcessor</code> implements the message router pattern, that is, it uses a cascading if-then-else statement to route a message from an input queue to one of several output queues. Another example is the <code>FilterProcessor</code> class which discards messages that do not satisfy a stated <em>predicate</em> (that is, condition).</p>

<p><span class="confluence-anchor-link" id="BookInOnePage-routes"></span></p>
<h3 id="BookInOnePage-Routes,RouteBuildersandJavaDSL">Routes, RouteBuilders and Java DSL</h3>
<p>A <em>route</em> is the step-by-step movement of a <code>Message</code> from an input queue, through arbitrary types of decision making (such as filters and routers) to a destination queue (if any). Camel provides two ways for an application developer to specify routes. One way is to specify route information in an XML file. A discussion of that approach is outside the scope of this document. The other way is through what Camel calls a Java <em>DSL</em> (domain-specific language).</p>

<h4 id="BookInOnePage-IntroductiontoJavaDSL">Introduction to Java DSL</h4>
<p>For many people, the term "domain-specific language" implies a compiler or interpreter that can process an input file containing keywords and syntax specific to a particular domain. This is <em>not</em> the approach taken by Camel. Camel documentation consistently uses the term "Java DSL" instead of "DSL", but this does not entirely avoid potential confusion. The Camel "Java DSL" is a class library that can be used in a way that looks almost like a DSL, except that it has a bit of Java syntactic baggage. You can see this in the example below. Comments afterwards explain some of the constructs used in the example.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Example of Camel's "Java DSL"</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
RouteBuilder builder = new RouteBuilder() {
    public void configure() {
        from(&quot;queue:a&quot;).filter(header(&quot;foo&quot;).isEqualTo(&quot;bar&quot;)).to(&quot;queue:b&quot;);
        from(&quot;queue:c&quot;).choice()
                .when(header(&quot;foo&quot;).isEqualTo(&quot;bar&quot;)).to(&quot;queue:d&quot;)
                .when(header(&quot;foo&quot;).isEqualTo(&quot;cheese&quot;)).to(&quot;queue:e&quot;)
                .otherwise().to(&quot;queue:f&quot;);
    }
};
CamelContext myCamelContext = new DefaultCamelContext();
myCamelContext.addRoutes(builder);
]]></script>
</div></div>
<p>The first line in the above example creates an object which is an instance of an anonymous subclass of <code>RouteBuilder</code> with the specified <code>configure()</code> method.<br clear="none">
The <code>CamelContext.addRoutes(RouterBuilder builder)</code> method invokes <code>builder.setContext(this)</code> &#8211; so the <code>RouteBuilder</code> object knows which <code>CamelContext</code> object it is associated with &#8211; and then invokes <code>builder.configure()</code>. The body of <code>configure()</code> invokes methods such as <code>from()</code>, <code>filter()</code>, <code>choice()</code>, <code>when()</code>, <code>isEqualTo()</code>, <code>otherwise()</code> and <code>to()</code>.<br clear="none">
The <code>RouteBuilder.from(String uri)</code> method invokes <code>getEndpoint(uri)</code> on the <code>CamelContext</code> associated with the <code>RouteBuilder</code> object to get the specified <code>Endpoint</code> and then puts a <code>FromBuilder</code> "wrapper" around this <code>Endpoint</code>. The <code>FromBuilder.filter(Predicate predicate)</code> method creates a <code>FilterProcessor</code> object for the <code>Predicate</code> (that is, condition) object built from the <code>header("foo").isEqualTo("bar")</code> expression. In this way, these operations incrementally build up a <code>Route</code> object (with a <code>RouteBuilder</code> wrapper around it) and add it to the <code>CamelContext</code> object associated with the <code>RouteBuilder</code>.</p>

<h4 id="BookInOnePage-CritiqueofJavaDSL">Critique of Java DSL</h4>
<p>The online Camel documentation compares Java DSL favourably against the alternative of configuring routes and endpoints in a XML-based Spring configuration file. In particular, Java DSL is less verbose than its XML counterpart. In addition, many integrated development environments (IDEs) provide an auto-completion feature in their editors. This auto-completion feature works with Java DSL, thereby making it easier for developers to write Java DSL.<br clear="none">
However, there is another option that the Camel documentation neglects to consider: that of writing a parser that can process DSL stored in, say, an external file. Currently, Camel does not provide such a DSL parser, and I do not know if it is on the "to do" list of the Camel maintainers. I think that a DSL parser would offer a significant benefit over the current Java DSL. In particular, the DSL would have a syntactic definition that could be expressed in a relatively short BNF form. The effort required by a Camel user to learn how to use DSL by reading this BNF would almost certainly be significantly less than the effort currently required to study the API of the <code>RouterBuilder</code> classes.</p>


<h3 id="BookInOnePage-ContinueLearningaboutCamel">Continue Learning about Camel</h3>

<p>Return to the main <a shape="rect" href="getting-started.html">Getting Started</a> page for additional introductory reference information.</p>
<div class="chapter" id="chapter-architecture"><h1 id="BookInOnePage-Architecture">Architecture</h1><a shape="rect" href="dsl.html">Routing Domain Specific Language (DSL)</a><a shape="rect" href="xml-configuration.html">Xml Configuration</a><a shape="rect" href="routes.html">routing and mediation rules</a><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/CamelContext.html">CamelContext</a><a shape="rect" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a><p>At a high level Camel consists of a <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/CamelContext.html">CamelContext</a> which contains a collection of <a shape="rect" href="component.html">Component</a> instances. A <a shape="rect" href="component.html">Component</a> is essentially a factory of <a shape="rect" href="endpoint.html">Endpoint</a> instances. You can explicitly configure <a shape="rect" href="component.html">Component</a> instances in Java code or an IoC container like Spring or Guice, or they can be auto-discovered using <a shape="rect" href="uris.html">URIs</a>. </p><p>An <a shape="rect" href="endpoint.html">Endpoint</a> acts rather like a URI or URL in a web application or a Destination in a JMS system; you can communicate with an endpoint; either sending messages to it or consuming messages from it. You can then create a <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Producer.html">Producer</a> or <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Consumer.html">Consumer</a> on an <a shape="rect" href="endpoint.html">Endpoint</a> to exchange messages with it.</p><p>The <a shape="rect" href="dsl.html">DSL</a> makes heavy use of pluggable <a shape="rect" href="languages.html">Languages</a> to create an <a shape="rect" href="expression.html">Expression</a> or <a shape="rect" href="predicate.html">Predicate</a> to make a truly powerful DSL which is extensible to the most suitable language depending on your needs. The following languages are supported</p><ul><li><a shape="rect" href="bean-language.html">Bean Language</a> for using Java for expressions</li><li><a shape="rect" href="constant.html">Constant</a></li><li>the unified <a shape="rect" href="el.html">EL</a> from JSP and JSF</li><li><a shape="rect" href="header.html">Header</a></li><li><a shape="rect" href="jsonpath.html">JSonPath</a></li><li><a shape="rect" href="jxpath.html">JXPath</a></li><li><a shape="rect" href="mvel.html">Mvel</a></li><li><a shape="rect" href="ognl.html">OGNL</a></li><li><a shape="rect" href="ref-language.html">Ref Language</a></li><li><a shape="rect" href="exchangeproperty.html">ExchangeProperty</a> /&#160;<a shape="rect" href="property.html">Property</a></li><li><a shape="rect" href="scripting-languages.html">Scripting Languages</a> such as
  <ul><li><a shape="rect" href="beanshell.html">BeanShell</a></li><li><a shape="rect" href="javascript.html">JavaScript</a></li><li><a shape="rect" href="groovy.html">Groovy</a></li><li><a shape="rect" href="python.html">Python</a></li><li><a shape="rect" href="php.html">PHP</a></li><li><a shape="rect" href="ruby.html">Ruby</a></li></ul></li><li><a shape="rect" href="simple.html">Simple</a>
  <ul><li><a shape="rect" href="file-language.html">File Language</a></li></ul></li><li><a shape="rect" href="spel.html">Spring Expression Language</a></li><li><a shape="rect" href="sql.html">SQL</a></li><li><a shape="rect" href="tokenizer.html">Tokenizer</a></li><li><a shape="rect" href="xpath.html">XPath</a></li><li><a shape="rect" href="xquery.html">XQuery</a></li><li><a shape="rect" href="vtd-xml.html">VTD-XML</a></li></ul><p>Most of these languages is also supported used as <a shape="rect" href="annotation-based-expression-language.html">Annotation Based Expression Language</a>.</p><p>For a full details of the individual languages see the <a shape="rect" href="book-languages-appendix.html">Language Appendix</a></p><h2 id="BookInOnePage-URIs">URIs</h2><p>Camel makes extensive use of URIs to allow you to refer to endpoints which are lazily created by a <a shape="rect" href="component.html">Component</a> if you refer to them within <a shape="rect" href="routes.html">Routes</a>.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">important</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body"> 
  <p>Make sure to read <a shape="rect" href="how-do-i-configure-endpoints.html">How do I configure endpoints</a> to learn more about configuring endpoints. For example how to refer to beans in the <a shape="rect" href="registry.html">Registry</a> or how to use raw values for password options, and using <a shape="rect" href="using-propertyplaceholder.html">property placeholders</a> etc.</p>
 </div>
</div><h3 id="BookInOnePage-CurrentSupportedURIs">Current Supported URIs</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Component / ArtifactId / URI</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="ahc.html">AHC</a> /&#160;<code>camel-ahc</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">ahc:http[s]://hostName[:port][/resourceUri][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To call external HTTP services using <a shape="rect" class="external-link" href="https://github.com/AsyncHttpClient/async-http-client" rel="nofollow">Async Http Client</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="ahc-ws.html">AHC-WS</a> <span> /&#160;<code>camel-ahc-ws</code></span></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">ahc-ws[s]://hostName[:port][/resourceUri][?options] </script> 
      </div>
     </div><p><span> <br clear="none"> </span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;To exchange data with external Websocket servers using <a shape="rect" class="external-link" href="https://github.com/AsyncHttpClient/async-http-client" rel="nofollow">Async Http Client</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="amqp.html">AMQP</a> /&#160;<code>camel-amqp</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">amqp:[queue:|topic:]destinationName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For Messaging with <a shape="rect" class="external-link" href="http://www.amqp.org/" rel="nofollow">AMQP protocol</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="apns.html">APNS</a> /&#160;<code>camel-apns</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">apns:&amp;lt;notify|consumer&amp;gt;[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For sending notifications to Apple iOS devices</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="atmosphere-websocket.html">Atmosphere-Websocket</a> <span>&#160;</span> <span> /&#160;<code>camel-atmosphere-websocket</code></span></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">atmosphere-websocket:///relative path[?options] </script> 
      </div>
     </div><p><span> <br clear="none"> </span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;<span>To exchange data with external Websocket clients using </span> <a shape="rect" class="external-link" href="https://github.com/Atmosphere/atmosphere" rel="nofollow">Atmosphere</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="atom.html">Atom</a> /&#160;<code>camel-atom</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">atom:atomUri[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Working with <a shape="rect" class="external-link" href="http://incubator.apache.org/abdera/">Apache Abdera</a> for atom integration, such as consuming an atom feed.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="avro.html">Avro</a> /&#160;<code>camel-avro</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">avro:[transport]:[host]:[port][/messageName][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Working with <a shape="rect" class="external-link" href="http://avro.apache.org/">Apache Avro</a> for data serialization.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="aws-cw.html">AWS-CW</a> / <a shape="rect" href="aws.html">camel-aws</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">aws-cw://namespace[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For working with <a shape="rect" class="external-link" href="http://aws.amazon.com/cloudwatch/" rel="nofollow">Amazon's CloudWatch (CW)</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="aws-ddb.html">AWS-DDB</a> / <a shape="rect" href="aws.html">camel-aws</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">aws-ddb://tableName[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For working with <a shape="rect" class="external-link" href="http://aws.amazon.com/dynamodb/" rel="nofollow">Amazon's DynamoDB (DDB)</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="aws-ddbstream.html">AWS-DDBSTREAM</a> / <a shape="rect" href="aws.html">camel-aws</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">aws-ddbstream://tableName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For working with <a shape="rect" class="external-link" href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Streams.html" rel="nofollow">Amazon's DynamoDB Streams (DDB Streams)</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="aws-ec2.html">AWS-EC2</a> / <a shape="rect" href="aws.html">camel-aws</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">aws-ec2://label[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For working with <a shape="rect" class="external-link" href="http://aws.amazon.com/ec2/" rel="nofollow">Amazon's Elastic Compute Cloud (EC2)</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="aws-sdb.html">AWS-SDB</a> / <a shape="rect" href="aws.html">camel-aws</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">aws-sdb://domainName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For working with <a shape="rect" class="external-link" href="http://aws.amazon.com/simpledb/" rel="nofollow">Amazon's SimpleDB (SDB)</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="aws-ses.html">AWS-SES</a> / <a shape="rect" href="aws.html">camel-aws</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">aws-ses://from[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For working with <a shape="rect" class="external-link" href="http://aws.amazon.com/ses/" rel="nofollow">Amazon's Simple Email Service (SES)</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="aws-sns.html">AWS-SNS</a> / <a shape="rect" href="aws.html">camel-aws</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">aws-sns://topicName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For Messaging with <a shape="rect" class="external-link" href="http://aws.amazon.com/sns/" rel="nofollow">Amazon's Simple Notification Service (SNS)</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="aws-sqs.html">AWS-SQS</a> / <a shape="rect" href="aws.html">camel-aws</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">aws-sqs://queueName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For Messaging with <a shape="rect" class="external-link" href="http://aws.amazon.com/sqs/" rel="nofollow">Amazon's Simple Queue Service (SQS)</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="aws-swf.html">AWS-SWF</a> / <a shape="rect" href="aws.html">camel-aws</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">aws-swf://&amp;lt;worfklow|activity&amp;gt;[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For Messaging with <a shape="rect" class="external-link" href="http://aws.amazon.com/swf/" rel="nofollow">Amazon's Simple Workflow Service (SWF)</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="aws-s3.html">AWS-S3</a> / <a shape="rect" href="aws.html">camel-aws</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">aws-s3://bucketName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For working with <a shape="rect" class="external-link" href="http://aws.amazon.com/s3/" rel="nofollow">Amazon's Simple Storage Service (S3)</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="bean.html">Bean</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">bean:beanName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Uses the <a shape="rect" href="bean-binding.html">Bean Binding</a> to bind message exchanges to beans in the <a shape="rect" href="registry.html">Registry</a>. Is also used for exposing and invoking POJO (Plain Old Java Objects).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="beanstalk.html">Beanstalk</a> <span> /&#160;<code>camel-beanstalk</code></span></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">beanstalk:hostname:port/tube[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For working with <a shape="rect" class="external-link" href="http://aws.amazon.com/elasticbeanstalk/" rel="nofollow">Amazon's Beanstalk</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="bean-validator.html">Bean Validator</a> /&#160;<code>camel-bean-validator</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">bean-validator:label[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Validates the payload of a message using the Java Validation API (<a shape="rect" class="external-link" href="http://jcp.org/en/jsr/detail?id=303" rel="nofollow">JSR 303</a> and JAXP Validation) and its reference implementation <a shape="rect" class="external-link" href="http://docs.jboss.org/hibernate/stable/validator/reference/en/html_single/" rel="nofollow">Hibernate Validator</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="box.html">Box</a> /&#160;<code>camel-box</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">box://endpoint-prefix/endpoint?[options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For uploading, downloading and managing files, managing files, folders, groups, collaborations, etc. on Box.com.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span> <a shape="rect" href="braintree.html">Braintree</a> /&#160;<code>camel-braintree</code></span></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">braintree://endpoint-prefix/endpoint?[options]</script> 
      </div>
     </div><p><span> <br clear="none"> </span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>Component for interacting with Braintree Payments via Braintree Java SDK</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="browse.html">Browse</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">browse:someName </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Provides a simple <a shape="rect" href="browsableendpoint.html">BrowsableEndpoint</a> which can be useful for testing, visualisation tools or debugging. The exchanges sent to the endpoint are all available to be browsed.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="cache.html">Cache</a> /&#160;<code>camel-cache</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">cache://cacheName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The cache component facilitates creation of caching endpoints and processors using <a shape="rect" class="external-link" href="http://ehcache.org/" rel="nofollow">EHCache</a> as the cache implementation.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="cassandra.html">Cassandra</a> / <span style="color: rgb(0,0,0);"><code>camel-cassandraql</code></span></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">cql:localhost/keyspace</script> 
      </div>
     </div><p><span style="color: rgb(0,0,0);"> <br clear="none"> </span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For integrating with <a shape="rect" class="external-link" href="http://cassandra.apache.org/">Apache Cassandra</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="class.html">Class</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">class:className[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Uses the <a shape="rect" href="bean-binding.html">Bean Binding</a> to bind message exchanges to beans in the <a shape="rect" href="registry.html">Registry</a>. Is also used for exposing and invoking POJO (Plain Old Java Objects).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="chronicle-engine.html">Chronicle Engine</a> /&#160;<code>camel-chronicle</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">chronicle-engine:addresses/path[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><a shape="rect" class="external-link" href="https://github.com/OpenHFT/Chronicle-Engine" rel="nofollow">Chronicle Engine</a><span> is a<span> high performance, low latency, reactive processing framework.</span></span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="chunk.html">Chunk</a> /&#160;<code>camel-chunk</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">chunk:templateName[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Generates a response using a <a shape="rect" class="external-link" href="http://www.x5software.com/chunk/examples/ChunkExample" rel="nofollow">Chunk</a> template</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="cmis.html">CMIS</a> /&#160;<code>camel-cmis</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">cmis://cmisServerUrl[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Uses the <a shape="rect" class="external-link" href="http://chemistry.apache.org/java/opencmis.html">Apache Chemistry</a> client API to interface with CMIS supporting CMS</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="cometd.html">Cometd</a> /&#160;<code>camel-cometd</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">cometd://hostName:port/channelName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Used to deliver messages using the <a shape="rect" class="external-link" href="http://docs.codehaus.org/display/JETTY/Cometd+(aka+Bayeux)" rel="nofollow">jetty cometd implementation</a> of the <a shape="rect" class="external-link" href="http://svn.xantus.org/shortbus/trunk/bayeux/bayeux.html" rel="nofollow">bayeux protocol</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="consul-component.html">Consul</a> /&#160;<code>camel-consul</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">consul:apiEndpoint[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>For interfacing with an </span><span>&#160;</span><a shape="rect" class="external-link" href="https://www.consul.io/" rel="nofollow">Consul</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="context.html">Context</a> /&#160;<code>camel-context</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">context:camelContextId:localEndpointName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Used to refer to endpoints within a separate CamelContext to provide a simple <a shape="rect" href="context.html">black box composition</a> approach so that routes can be combined into a CamelContext and then used as a black box component inside other routes in other CamelContexts</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="controlbus-component.html">ControlBus</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">controlbus:command[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="controlbus.html">ControlBus</a> EIP that allows to send messages to <a shape="rect" href="endpoint.html">Endpoint</a>s for managing and monitoring your Camel applications.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="couchdb.html">CouchDB</a> /&#160;<code>camel-couchdb</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">couchdb:hostName[:port]/database[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To integrate with <a shape="rect" class="external-link" href="http://couchdb.apache.org/">Apache CouchDB</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="crypto-digital-signatures.html">Crypto (Digital Signatures)</a> /&#160;<code>camel-crypto</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">crypto:&amp;lt;sign|verify&amp;gt;:name[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Used to sign and verify exchanges using the Signature Service of the Java Cryptographic Extension.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="cxf.html">CXF</a> /&#160;<code>camel-cxf</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">cxf:&amp;lt;bean:cxfEndpoint|//someAddress&amp;gt;[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Working with <a shape="rect" class="external-link" href="http://apache.org/cxf/">Apache CXF</a> for web services integration</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="cxf-bean-component.html">CXF Bean </a> /&#160;<code>camel-cxf</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">cxfbean:serviceBeanRef[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Proceess the exchange using a JAX WS or JAX RS annotated bean from the registry. Requires less configuration than the above CXF Component</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="cxfrs.html">CXFRS</a> /&#160;<code>camel-cxf</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">cxfrs:&amp;lt;bean:rsEndpoint|//address&amp;gt;[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Working with <a shape="rect" class="external-link" href="http://apache.org/cxf/">Apache CXF</a> for REST services integration</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="dataformat-component.html">DataFormat</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">dataformat:name:&amp;lt;marshal|unmarshal&amp;gt;[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>for working with <a shape="rect" href="data-format.html">Data Format</a>s as if it was a regular Component supporting Endpoints and URIs.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="dataset.html">DataSet</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">dataset:name[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For load &amp; soak testing the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/dataset/DataSet.html">DataSet</a> provides a way to create huge numbers of messages for sending to <a shape="rect" href="components.html">Components</a> or asserting that they are consumed correctly</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="direct.html">Direct</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">direct:someName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Synchronous call to another endpoint from <strong>same</strong> CamelContext.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="direct-vm.html">Direct-VM</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">direct-vm:someName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Synchronous call to another endpoint in another CamelContext running in the same JVM.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="dns.html">DNS</a> /&#160;<code>camel-dns</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">dns:operation[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To lookup domain information and run DNS queries using <a shape="rect" class="external-link" href="http://www.xbill.org/dnsjava/" rel="nofollow">DNSJava</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="disruptor.html">Disruptor</a> /&#160;<code>camel-disruptor</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">disruptor:someName[?&amp;lt;option&amp;gt;] disruptor-vm:someName[?&amp;lt;option&amp;gt;] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To provide the implementation of <a shape="rect" href="seda.html">SEDA</a> which is based on <a shape="rect" class="external-link" href="https://github.com/LMAX-Exchange/disruptor" rel="nofollow">disruptor</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span> <a shape="rect" href="docker.html">Docker</a> /&#160;<code>camel-docker</code></span></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">docker://[operation]?[options]</script> 
      </div>
     </div><p><span> <br clear="none"> </span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;To communicate with <a shape="rect" class="external-link" href="https://www.docker.com/" rel="nofollow">Docker</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="dozer.html">Dozer</a> /&#160;<code>camel-dozer</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">dozer://name?[options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;To convert message body using the Dozer type converter library.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="dropbox.html">Dropbox</a> <span> /&#160;<code>camel-dropbox</code></span></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">dropbox://[operation]?[options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="color: rgb(0,0,0);">The&#160;</span> <strong>dropbox:</strong> <span style="color: rgb(0,0,0);">&#160;component allows you to treat&#160;</span> <a shape="rect" class="external-link" href="https://www.dropbox.com/" rel="nofollow">Dropbox</a> <span style="color: rgb(0,0,0);">&#160;remote folders as a producer or consumer of messages.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="ejb.html">EJB</a> /&#160;<code>camel-ejb</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">ejb:ejbName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Uses the <a shape="rect" href="bean-binding.html">Bean Binding</a> to bind message exchanges to EJBs. It works like the <a shape="rect" href="bean.html">Bean</a> component but just for accessing EJBs. Supports EJB 3.0 onwards.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="ehcache.html">Ehcache</a> /&#160;<code>camel-ehcache</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">ehcache://cacheName[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>The cache component facilitates creation of caching endpoints and processors using </span><a shape="rect" class="external-link" href="http://ehcache.org/" rel="nofollow">Ehcache 3</a><span> as the cache implementation.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="elasticsearch.html">ElasticSearch</a> /&#160;<code>camel-elasticsearch</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">elasticsearch://clusterName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For interfacing with an <a shape="rect" class="external-link" href="http://elasticsearch.org" rel="nofollow">ElasticSearch</a> server.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="etcd.html">Etcd</a> /&#160;<code>camel-etcd</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">etcd:namespace[/path][?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>For interfacing with an </span> <a shape="rect" class="external-link" href="https://coreos.com/etcd/" rel="nofollow">Etcd</a> <span> key value store.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="spring-event.html">Spring Event</a> /&#160;<code>camel-spring</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">spring-event://default </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Working with Spring ApplicationEvents</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="eventadmin.html">EventAdmin</a> /&#160;<code>camel-eventadmin</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">eventadmin:topic[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Receiving OSGi EventAdmin events</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="exec.html">Exec</a> /&#160;<code>camel-exec</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">exec://executable[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For executing system commands</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="facebook.html">Facebook</a> /&#160;<code>camel-facebook</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">facebook://endpoint[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Providing access to all of the Facebook APIs accessible using <a shape="rect" class="external-link" href="http://facebook4j.org/en/index.html" rel="nofollow">Facebook4J</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="file2.html">File</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">file://nameOfFileOrDirectory[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sending messages to a file or polling a file or directory.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="flatpack.html">Flatpack</a> /&#160;<code>camel-flatpack</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">flatpack:[fixed|delim]:configFile[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Processing fixed width or delimited files or messages using the <a shape="rect" class="external-link" href="http://flatpack.sourceforge.net" rel="nofollow">FlatPack library</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="flink.html">Flink</a> /&#160;<code>camel-flink</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">flink:dataset[?options] flink:datastream[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;Bridges Camel connectors with <a shape="rect" class="external-link" href="http://flink.apache.org/">Apache Flink</a> tasks.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="fop.html">FOP</a> /&#160;<code>camel-fop</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">fop:outputFormat[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Renders the message into different output formats using <a shape="rect" class="external-link" href="http://xmlgraphics.apache.org/fop/index.html">Apache FOP</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="freemarker.html">FreeMarker</a> /&#160;<code>camel-freemarker</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">freemarker:templateName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Generates a response using a <a shape="rect" class="external-link" href="http://freemarker.org/" rel="nofollow">FreeMarker</a> template</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="ftp2.html">FTP</a> /&#160;<code>camel-ftp</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">ftp:contextPath[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sending and receiving files over FTP.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="ftp2.html">FTPS</a> /&#160;<code>camel-ftp</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">ftps://[username@]hostName[:port]/directoryName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sending and receiving files over FTP Secure (TLS and SSL).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="ganglia.html">Ganglia</a> /&#160;<code>camel-ganglia</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">ganglia:destination:port[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sends values as metrics to the <a shape="rect" class="external-link" href="http://ganglia.info" rel="nofollow">Ganglia</a> performance monitoring system using <a shape="rect" class="external-link" href="https://github.com/ganglia/gmetric4j" rel="nofollow">gmetric4j</a>.&#160; Can be used along with <a shape="rect" class="external-link" href="https://github.com/ganglia/jmxetric" rel="nofollow">JMXetric</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="gauth.html">GAuth</a> / <a shape="rect" href="gae.html">camel-gae</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">gauth://name[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Used by web applications to implement an <a shape="rect" class="external-link" href="http://code.google.com/apis/accounts/docs/OAuth.html" rel="nofollow">OAuth</a> consumer. See also <a shape="rect" href="gae.html">Camel Components for Google App Engine</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="ghttp.html">GHttp</a> / <a shape="rect" href="gae.html">camel-gae</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">ghttp:contextPath[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Provides connectivity to the <a shape="rect" class="external-link" href="http://code.google.com/appengine/docs/java/urlfetch/" rel="nofollow">URL fetch service</a> of Google App Engine but can also be used to receive messages from servlets. See also <a shape="rect" href="gae.html">Camel Components for Google App Engine</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="git.html">Git</a> / <a shape="rect" href="git.html">camel-git</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">git:localRepositoryPath[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Supports interaction with <a shape="rect" class="external-link" href="https://git-scm.com/" rel="nofollow">Git</a> repositories</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="github.html">Github</a> / <a shape="rect" href="github.html">camel-github</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">github:endpoint[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Supports interaction with <a shape="rect" class="external-link" href="https://github.com/" rel="nofollow">Github</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="glogin.html">GLogin</a> / <a shape="rect" href="gae.html">camel-gae</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">glogin://hostname[:port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Used by Camel applications outside Google App Engine (GAE) for programmatic login to GAE applications. See also <a shape="rect" href="gae.html">Camel Components for Google App Engine</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="gtask.html">GTask</a> / <a shape="rect" href="gae.html">camel-gae</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">gtask://queue-name[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Supports asynchronous message processing on Google App Engine by using the <a shape="rect" class="external-link" href="http://code.google.com/appengine/docs/java/taskqueue/" rel="nofollow">task queueing service</a> as message queue. See also <a shape="rect" href="gae.html">Camel Components for Google App Engine</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="googlecalendar.html">Google Calendar</a> / <a shape="rect" href="googlecalendar.html">camel-google-calendar</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">google-calendar://endpoint-prefix/endpoint?[options]&nbsp;</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Supports interaction with <a shape="rect" class="external-link" href="https://developers.google.com/google-apps/calendar/v3/reference/" rel="nofollow">Google Calendar's REST API</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="googledrive.html">Google Drive</a> / <a shape="rect" href="googledrive.html">camel-google-drive</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">google-drive://endpoint-prefix/endpoint?[options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Supports interaction with <a shape="rect" class="external-link" href="https://developers.google.com/drive/v2/reference/" rel="nofollow">Google Drive's REST API</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="googlemail.html">Google Mail</a> / <a shape="rect" href="googlemail.html">camel-google-mail</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">google-mail://endpoint-prefix/endpoint?[options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Supports interaction with <a shape="rect" class="external-link" href="https://developers.google.com/gmail/api/v1/reference/" rel="nofollow">Google Mail's REST API</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="gmail.html">GMail</a> / <a shape="rect" href="gae.html">camel-gae</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">gmail://user@g[oogle]mail.com[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Supports sending of emails via the <a shape="rect" class="external-link" href="http://code.google.com/appengine/docs/java/mail/" rel="nofollow">mail service</a> of Google App Engine. See also <a shape="rect" href="gae.html">Camel Components for Google App Engine</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="gora.html">Gora</a> <span>/&#160;<code>camel-gora</code></span></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">gora:instanceName[?options] </script> 
      </div>
     </div><p><span> <br clear="none"> </span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Supports to work with NoSQL databases using the&#160;<a shape="rect" class="external-link" href="http://gora.apache.org/">Apache Gora</a>&#160;framework.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="gora.html">G</a><a shape="rect" href="grape.html">rape</a>/&#160;<code>camel-grape</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">&nbsp;grape:defaultMavenCoordinates</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://docs.groovy-lang.org/latest/html/documentation/grape.html" rel="nofollow">Grape</a> component allows you to fetch, load and manage additional jars when CamelContext is running.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="geocoder.html">Geocoder</a> /&#160;<code>camel-geocoder</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">geocoder:&amp;lt;address|latlng:latitude,longitude&amp;gt;[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Supports looking up geocoders for an address, or reverse lookup geocoders from an address.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="guava-eventbus.html">Google Guava EventBus</a> /&#160;<code>camel-guava-eventbus</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">guava-eventbus:busName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The <a shape="rect" class="external-link" href="http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/eventbus/package-summary.html" rel="nofollow">Google Guava EventBus</a> allows publish-subscribe-style communication between components without requiring the components to explicitly register with one another (and thus be aware of each other). This component provides integration bridge between Camel and <a shape="rect" class="external-link" href="http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/eventbus/package-summary.html" rel="nofollow">Google Guava EventBus</a> infrastructure.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="hazelcast-component.html">Hazelcast</a> / <a shape="rect" href="hazelcast-component.html">camel-hazelcast</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">hazelcast://[type]:cachename[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://www.hazelcast.com" rel="nofollow">Hazelcast</a> is a data grid entirely implemented in Java (single jar). This component supports map, multimap, seda, queue, set, atomic number and simple cluster support.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="hbase.html">HBase</a> /&#160;<code>camel-hbase</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">hbase://table[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For reading/writing from/to an <a shape="rect" class="external-link" href="http://hadoop.apache.org/hbase/">HBase</a> store (Hadoop database)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="hdfs.html">HDFS</a> /&#160;<code>camel-hdfs</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">hdfs://hostName[:port][/path][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For reading/writing from/to an <a shape="rect" class="external-link" href="http://hadoop.apache.org/hdfs/">HDFS</a> filesystem using Hadoop 1.x</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="hdfs2.html">HDFS2</a> /&#160;<code>camel-hdfs2</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">hdfs2://hostName[:port][/path][?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>For reading/writing from/to an </span> <a shape="rect" class="external-link" href="http://hadoop.apache.org/hdfs/">HDFS</a> <span> filesystem using Hadoop 2.x</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="hipchat.html">Hipchat</a> /&#160;<code>camel-hipchat</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">hipchat://[host][:port]?options</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;For sending/receiving messages to <a shape="rect" class="external-link" href="https://www.hipchat.com" rel="nofollow">Hipchat</a> using v2 API</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="hl7.html">HL7</a> /&#160;<code>camel-hl7</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">mina2:tcp://hostName[:port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For working with the HL7 MLLP protocol and the HL7 data format using the <a shape="rect" class="external-link" href="http://hl7api.sourceforge.net" rel="nofollow">HAPI library</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="infinispan.html">Infinispan</a> /&#160;<code>camel-infinispan</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">infinispan://hostName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For reading/writing from/to <a shape="rect" class="external-link" href="http://infinispan.org/" rel="nofollow">Infinispan</a> distributed key/value store and data grid</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="http.html">HTTP</a> /&#160;<code>camel-http</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">http:hostName[:port][/resourceUri][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For calling out to external HTTP servers using Apache HTTP Client 3.x</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="http4.html">HTTP4</a> /&#160;<code>camel-http4</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">http4:hostName[:port][/resourceUri][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For calling out to external HTTP servers using Apache HTTP Client 4.x</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="ibatis.html">iBATIS</a> /&#160;<code>camel-ibatis</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">ibatis://statementName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Performs a query, poll, insert, update or delete in a relational database using <a shape="rect" class="external-link" href="http://ibatis.apache.org/">Apache iBATIS</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="ignite.html">Ignite</a> /&#160;<code>camel-ignite</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">ignite:[cache/compute/messaging/...][?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="https://ignite.apache.org/">Apache Ignite</a> <span style="color: rgb(0,0,0);">&#160;In-Memory Data Fabric is a high-performance, integrated and distributed in-memory platform for computing and transacting on large-scale data sets in real-time, orders of magnitude faster than possible with traditional disk-based or flash technologies. It&#160;is designed to deliver uncompromised performance for a wide set of in-memory computing use cases from high performance computing, to the industry most advanced data grid, highly available service grid, and streaming.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="mail.html">IMAP</a> /&#160;<code>camel-mail</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">imap://[username@]hostName[:port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Receiving email using <a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/Internet_Message_Access_Protocol" rel="nofollow">IMAP</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="mail.html">IMAPS</a> /&#160;<code>camel-mail</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">imaps://[username@]hostName[:port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>...</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="irc.html">IRC</a> /&#160;<code>camel-irc</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">irc:[login@]hostName[:port]/#room[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For IRC communication</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="ironmq.html">IronMQ</a> <span> /&#160;<code>camel-ironmq</code></span></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">ironmq:queueName[?options]</script> 
      </div>
     </div><p><span> <br clear="none"> </span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For working with <a shape="rect" class="external-link" href="http://www.iron.io/platform/ironmq/" rel="nofollow">IronMQ</a> a elastic and durable hosted message queue as a service.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="javaspace.html">JavaSpace</a> /&#160;<code>camel-javaspace</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">javaspace:jini://hostName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sending and receiving messages through <a shape="rect" class="external-link" href="http://java.sun.com/products/jini/2.1/doc/specs/html/js-spec.html" rel="nofollow">JavaSpace</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="jbpm.html">jBPM</a> /&#160;<code>camel-jbpm</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">jbpm:hostName[:port][/resourceUri][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sending messages through kie-remote-client API to jBPM.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="jcache.html">jcache</a> /&#160;<code>camel-jcache</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">jcache:cacheName[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>The JCache component facilitates creation of caching endpoints and processors using </span> <a shape="rect" class="external-link" href="https://github.com/jsr107/jsr107spec" rel="nofollow">JCache / jsr107</a> <span> as the cache implementation.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="jclouds.html">jclouds</a> /&#160;<code>camel-jclouds</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">jclouds:&amp;lt;blobstore|compute&amp;gt;:[provider id][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For interacting with cloud compute &amp; blobstore service via <a shape="rect" class="external-link" href="http://www.jclouds.org" rel="nofollow">jclouds</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="jcr.html">JCR</a> /&#160;<code>camel-jcr</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">jcr://user:password@repository/path/to/node[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Storing a message in a JCR compliant repository like <a shape="rect" class="external-link" href="http://jackrabbit.apache.org">Apache Jackrabbit</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="jdbc.html">JDBC</a> /&#160;<code>camel-jdbc</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">jdbc:dataSourceName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For performing JDBC queries and operations</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="jetty.html">Jetty</a> /&#160;<code>camel-jetty</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">jetty:hostName[:port][/resourceUri][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For exposing or consuming services over HTTP</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="jgroups.html">JGroups</a> /&#160;<code>camel-jgroups</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">jgroups:clusterName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The <code>jgroups:</code> component provides exchange of messages between Camel infrastructure and <a shape="rect" class="external-link" href="http://jgroups.org" rel="nofollow">JGroups</a> clusters.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="jira.html">JIRA</a> /&#160;<code>camel-jira</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">jira://endpoint[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For interacting with JIRA</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="jms.html">JMS</a> /&#160;<code>camel-jms</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">jms:[queue:|topic:]destinationName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Working with JMS providers</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="jmx.html">JMX</a> /&#160;<code>camel-jmx</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">jmx://platform[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For working with JMX notification listeners</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="jpa.html">JPA</a> /&#160;<code>camel-jpa</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">jpa://entityName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For using a database as a queue via the JPA specification for working with <a shape="rect" class="external-link" href="http://openjpa.apache.org/">OpenJPA</a>, <a shape="rect" class="external-link" href="http://www.hibernate.org/" rel="nofollow">Hibernate</a> or TopLink</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="jolt.html">JOLT</a> <span> /&#160;<code>camel-jolt</code></span></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">jolt:specName[?options]</script> 
      </div>
     </div><p><span> <br clear="none"> </span></p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;<p>The&#160;<strong>jolt:</strong>&#160;component allows you to process a JSON messages using an&#160;<a shape="rect" class="external-link" href="http://bazaarvoice.github.io/jolt/" rel="nofollow">JOLT</a>&#160;specification. This can be ideal when doing JSON to JSON transformation.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="jsch.html">Jsch</a> /&#160;<code>camel-jsch</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">scp://hostName[:port]/destination[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Support for the scp protocol</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="jt400.html">JT/400 </a> /&#160;<code>camel-jt400</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">jt400://user:pwd@system/&amp;lt;path_to_dtaq&amp;gt;[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For integrating with data queues on an AS/400 (aka System i, IBM i, i5, ...) system</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span> <a shape="rect" href="kafka.html">Kafka</a> /&#160;<code>camel-kafka</code></span></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">kafka://server:port[?options]</script> 
      </div>
     </div><p><span> <br clear="none"> </span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>For producing to or consuming from <a shape="rect" class="external-link" href="http://kafka.apache.org/">Apache Kafka</a> message brokers.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="kestrel.html">Kestrel</a> /&#160;<code>camel-kestrel</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">kestrel://[addresslist/]queueName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For producing to or consuming from <a shape="rect" class="external-link" href="https://github.com/robey/kestrel" rel="nofollow">Kestrel</a> queues</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="krati.html">Krati</a> /&#160;<code>camel-krati</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">krati://[path to datastore/][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For producing to or consuming to <a shape="rect" class="external-link" href="https://github.com/jingwei/krati" rel="nofollow">Krati</a> datastores</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="kubernetes.html">Kubernetes</a> /&#160;<code>camel-kubernetes</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">kubernetes:masterUrl[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;For integrating your application with <a shape="rect" class="external-link" href="http://kubernetes.io/" rel="nofollow">Kubernetes</a> standalone or on top of OpenShift.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="kura.html">Kura</a> /&#160;<code>camel-kura</code></p><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For deploying Camel OSGi routes into the <a shape="rect" class="external-link" href="https://eclipse.org/kura/" rel="nofollow">Eclipse Kura</a> M2M container.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="language.html">Language</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">language://languageName[:script][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Executes <a shape="rect" href="languages.html">Languages</a> scripts</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="ldap.html">LDAP</a> /&#160;<code>camel-ldap</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">ldap:host[:port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Performing searches on LDAP servers (&lt;scope&gt; must be one of object|onelevel|subtree)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="linkedin.html">LinkedIn</a> /&#160;<code>camel-linkedin</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">linkedin://endpoint-prefix/endpoint?[options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Component for retrieving LinkedIn user profiles, connections, companies, groups, posts, etc. using LinkedIn REST API.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="log.html">Log</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">log:loggingCategory[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Uses Jakarta Commons Logging to log the message exchange to some underlying logging system like log4j</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="lucene.html">Lucene</a> /&#160;<code>camel-lucene</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">lucene:searcherName:&amp;lt;insert|query&amp;gt;[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Uses Apache Lucene to perform Java-based indexing and full text based searches using advanced analysis/tokenization capabilities</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="lumberjack.html">Lumberjack</a> /&#160;<code>camel-lumberjack</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">lumberjack:host[:port]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;Uses the Lumberjack protocol for retrieving logs (from Filebeat for instance)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="metrics-component.html">Metrics</a> /&#160;<code>camel-metrics</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">metrics:[meter|counter|histogram|timer]:metricname[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="line-height: 1.4285715;">Uses </span> <a shape="rect" class="external-link" href="http://metrics.codahale.com/" style="line-height: 1.4285715;" rel="nofollow">Metrics</a> <span style="line-height: 1.4285715;">&#160;</span> <span style="line-height: 1.4285715;"> to collect application statistics directly from Camel routes.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="mina.html">MINA</a> /&#160;<code>camel-mina</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">mina:[tcp|udp|vm]:host[:port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Working with <a shape="rect" class="external-link" href="http://mina.apache.org/">Apache MINA 1.x</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="mina2.html">MINA2</a> /&#160;<code>camel-mina2</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">mina2:[tcp|udp|vm]:host[:port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Working with <a shape="rect" class="external-link" href="http://mina.apache.org/">Apache MINA 2.x</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="mock.html">Mock</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">mock:name[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For testing routes and mediation rules using mocks</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span> <a shape="rect" href="mllp.html">MLLP</a> /&#160;<code>camel-mllp</code></span></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">mllp:host:port[?options]</script> 
      </div>
     </div><p><span> <br clear="none"> </span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The MLLP component is specifically designed to handle the nuances of the MLLP protocol and provide&#160;the functionality required by Healthcare providers to communicate with other systems using the MLLP protocol</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="mongodb.html">MongoDB</a> /&#160;<code>camel-mongodb</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">mongodb:connectionBean[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Interacts with <a shape="rect" class="external-link" href="http://www.mongodb.org/" rel="nofollow">MongoDB</a> databases and collections. Offers producer endpoints to perform CRUD-style operations and more against databases and collections, as well as consumer endpoints to listen on collections and dispatch objects to Camel routes</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="mongodb-gridfs.html">MongoDB GridFS</a> /&#160;<code>camel-mongodb-gridfs</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">gridfs:dbName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sending and receiving files via MongoDB's GridFS system.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="mqtt.html">MQTT</a> /&#160;<code>camel-mqtt</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">mqtt:name[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Component for communicating with <a shape="rect" class="external-link" href="http://mqtt.org" rel="nofollow">MQTT</a> M2M message brokers</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="msv.html">MSV</a> /&#160;<code>camel-msv</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">msv:someLocalOrRemoteResource[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Validates the payload of a message using the <a shape="rect" class="external-link" href="https://msv.java.net/" rel="nofollow">MSV Library</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="mustache.html">Mustache</a> /&#160;<code>camel-mustache</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">mustache:templateName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Generates a response using a <a shape="rect" class="external-link" href="http://mustache.github.io/" rel="nofollow">Mustache</a> template</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="mvel-component.html">MVEL</a> /&#160;<code>camel-mvel</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">mvel:templateName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Generates a response using an <a shape="rect" class="external-link" href="http://mvel.codehaus.org/" rel="nofollow">MVEL</a> template</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="mybatis.html">MyBatis</a> /&#160;<code>camel-mybatis</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">mybatis://statementName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Performs a query, poll, insert, update or delete in a relational database using <a shape="rect" class="external-link" href="http://mybatis.org/" rel="nofollow">MyBatis</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="nagios.html">Nagios</a> /&#160;<code>camel-nagios</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">nagios://hostName[:port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sending passive checks to <a shape="rect" class="external-link" href="http://www.nagios.org/" rel="nofollow">Nagios</a> using <a shape="rect" class="external-link" href="http://code.google.com/p/jsendnsca/" rel="nofollow">JSendNSCA</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="nats.html">NATS</a> /&#160;<code>camel-nats</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">nats://servers[?options]&nbsp;</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For messaging with the <a shape="rect" class="external-link" href="http://nats.io/" rel="nofollow">NATS</a> platform.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="netty.html">Netty</a> /&#160;<code>camel-netty</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">netty:&amp;lt;tcp|udp&amp;gt;//host[:port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Working with TCP and UDP protocols using Java NIO based capabilities offered by the <a shape="rect" class="external-link" href="http://netty.io/" rel="nofollow">Netty</a> project</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="netty4.html">Netty4</a> <span> /&#160;<code>camel-netty4</code></span></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">netty4:&amp;lt;tcp|udp&amp;gt;//host[:port][?options] </script> 
      </div>
     </div><p><span> <br clear="none"> </span></p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;<span>Working with TCP and UDP protocols using Java NIO based capabilities offered by the </span> <a shape="rect" class="external-link" href="http://netty.io/" rel="nofollow">Netty</a> <span> project </span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="netty-http.html">Netty HTTP</a> /&#160;<code>camel-netty-http</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">netty-http:http:[port]/context-path[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Netty HTTP server and client using the <a shape="rect" class="external-link" href="http://netty.io/" rel="nofollow">Netty</a> project</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="netty4-http.html">Netty4 HTTP</a> /&#160;<code>camel-netty4-http</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">netty4-http:http:[port]/context-path[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;<span>Netty HTTP server and client using the </span> <a shape="rect" class="external-link" href="http://netty.io/" rel="nofollow">Netty</a> <span> project 4.x</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="olingo2.html">Olingo2</a> /&#160;<code>camel-olingo2</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">olingo2:endpoint/resource-path[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Communicates with <a shape="rect" class="external-link" href="http://www.odata.org/documentation/odata-version-2-0" rel="nofollow">OData 2.0</a> services using <a shape="rect" class="external-link" href="http://olingo.apache.org/">Apache Olingo</a> 2.0.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="openshift.html">Openshift</a> /&#160;<code>camel-openshift</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">openshift:clientId[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To manage your <a shape="rect" class="external-link" href="https://www.openshift.com/" rel="nofollow">Openshift</a> applications.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="optaplanner.html">OptaPlanner</a> /&#160;<code>camel-optaplanner</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">optaplanner:solverConfig[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Solves the planning problem contained in a message with <a shape="rect" class="external-link" href="http://www.optaplanner.org/" rel="nofollow">OptaPlanner</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="paho.html">Paho</a> <span> /&#160;<code>camel-paho</code></span></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">paho:topic[?options] </script> 
      </div>
     </div><p><span> <br clear="none"> </span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;Paho component provides connector for the MQTT messaging protocol using the&#160;<a shape="rect" class="external-link" href="https://eclipse.org/paho/" rel="nofollow">Paho</a>&#160;library.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="pax-logging.html">Pax-Logging</a> /&#160;<code>camel-paxlogging</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">paxlogging:appender </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Receiving Pax-Logging events in OSGi</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="pdf.html">PDF</a> /&#160;<code>camel-pdf</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">pdf:operation[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Allows to work with Apache <a shape="rect" class="external-link" href="https://pdfbox.apache.org/">PDFBox</a> PDF documents</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="pgevent.html">PGEvent</a> <span> /&#160;<code>camel-pgevent</code></span></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">pgevent:dataSource[?options]</script> 
      </div>
     </div><p><span> <br clear="none"> </span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>Allows for Producing/Consuming PostgreSQL events related to the LISTEN/NOTIFY commands added since PostgreSQL 8.3</span></p></td></tr></tbody></table>
</div><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="mail.html">POP3</a> /&#160;<code>camel-mail</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">pop3s://[username@]hostName port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Receiving email using POP3 and JavaMail</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="mail.html">POP3S</a> /&#160;<code>camel-mail</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">pop3s://[username@]hostName port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>...</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="printer.html">Printer</a> /&#160;<code>camel-printer</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">lpr://host:port/path/to/printer[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The printer component facilitates creation of printer endpoints to local, remote and wireless printers. The endpoints provide the ability to print camel directed payloads when utilized on camel routes.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="properties.html">Properties</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">properties://key[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The properties component facilitates using property placeholders directly in endpoint URI definitions.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="quartz.html">Quartz</a> /&#160;<code>camel-quartz</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">quartz://groupName/timerName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Provides a scheduled delivery of messages using the <a shape="rect" class="external-link" href="http://www.quartz-scheduler.org/" rel="nofollow">Quartz 1.x scheduler</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="quartz2.html">Quartz2</a> /&#160;<code>camel-quartz2</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">quartz2://groupName/timerName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Provides a scheduled delivery of messages using the <a shape="rect" class="external-link" href="http://www.quartz-scheduler.org/" rel="nofollow">Quartz 2.x scheduler</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="quickfix.html">Quickfix</a> /&#160;<code>camel-quickfix</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">quickfix:configFile[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Implementation of the QuickFix for Java engine which allow to send/receive <a shape="rect" class="external-link" href="http://www.fixprotocol.org" rel="nofollow">FIX</a> messages</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="rabbitmq.html">RabbitMQ</a> /&#160;<code>camel-rabbitmq</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">rabbitmq://hostname[:port]/exchangeName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Component for integrating with RabbitMQ</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="ref.html">Ref</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">ref:name </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Component for lookup of existing endpoints bound in the <a shape="rect" href="registry.html">Registry</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="rest.html">Rest</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">rest:verb:path[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Component for consuming Restful resources supporting the <a shape="rect" href="component-list.html">Rest DSL</a> and plugins to other Camel rest components.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="restlet.html">Restlet</a> /&#160;<code>camel-restlet</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">restlet:restletUrl[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Component for consuming and producing Restful resources using <a shape="rect" class="external-link" href="http://www.restlet.org" rel="nofollow">Restlet</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="rmi.html">RMI</a> /&#160;<code>camel-rmi</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">rmi://hostName[:port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Working with RMI</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="jing.html">RNC</a> /&#160;<code>camel-jing</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">rnc:/relativeOrAbsoluteUri[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Validates the payload of a message using <a shape="rect" class="external-link" href="http://relaxng.org/compact-tutorial-20030326.html" rel="nofollow">RelaxNG Compact Syntax</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="jing.html">RNG</a> /&#160;<code>camel-jing</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">rng:/relativeOrAbsoluteUri[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Validates the payload of a message using <a shape="rect" class="external-link" href="http://relaxng.org/" rel="nofollow">RelaxNG</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="routebox.html">Routebox</a> /&#160;<code>camel-routebox</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">routebox:routeBoxName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Facilitates the creation of specialized endpoints that offer encapsulation and a strategy/map based indirection service to a collection of camel routes hosted in an automatically created or user injected camel context</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="rss.html">RSS</a> /&#160;<code>camel-rss</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">rss:uri[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Working with <a shape="rect" class="external-link" href="http://rometools.org/" rel="nofollow">ROME</a> for RSS integration, such as consuming an RSS feed.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="salesforce.html">Salesforce</a> /&#160;<code>camel-salesforce</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">salesforce:topic[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To integrate with Salesforce</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="sap-netweaver.html">SAP NetWeaver</a> /&#160;<code>camel-sap-netweaver</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">sap-netweaver:hostName[:port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To integrate with <a shape="rect" class="external-link" href="http://scn.sap.com/docs/DOC-31221" rel="nofollow">SAP NetWeaver Gateway</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="scheduler.html">Scheduler</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">scheduler://name?[options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Used to generate message exchanges when a scheduler fires. The scheduler has more functionality than the <a shape="rect" href="timer.html">timer</a> component.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="schematron.html">schematron</a> /&#160;<code>camel-schematron</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">schematron://path?[options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Camel component of <a shape="rect" class="external-link" href="http://www.schematron.com/index.html" rel="nofollow">Schematron</a>&#160;which supports to validate the XML instance documents.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="seda.html">SEDA</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">seda:someName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Asynchronous call to another endpoint in the same CamelContext</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="servicenow.html">ServiceNow</a> /&#160;<code>camel-servicenow</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">servicenow:instanceName[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;Camel component for <a shape="rect" class="external-link" href="http://www.servicenow.com/" rel="nofollow">ServiceNow</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="servlet.html">SERVLET</a> /&#160;<code>camel-servlet</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">servlet:relativePath[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For exposing services over HTTP through the servlet which is deployed into the Web container.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="ftp2.html">SFTP</a> /&#160;<code>camel-ftp</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">sftp://[username@]hostName[:port]/directoryName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sending and receiving files over SFTP (FTP over SSH).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="sip.html">Sip</a> /&#160;<code>camel-sip</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">sip://user@hostName[:port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Publish/Subscribe communication capability using the Telecom SIP protocol. <a shape="rect" class="external-link" href="http://www.ietf.org/rfc/rfc3903.txt" rel="nofollow">RFC3903 - Session Initiation Protocol (SIP) Extension for Event</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="unresolved" href="#">SIPS</a> /&#160;<code>camel-sip</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">sips://user@hostName[:port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>...</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="sjms.html">SJMS</a>&#160; /&#160;<code>camel-sjms</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">sjms:[queue:|topic:]destinationName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A ground up implementation of a JMS client</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="confluence-link"><a shape="rect" href="sjms-batch.html">SJMS Batch</a> /&#160;<code>camel-sjms</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">sjms-batch:[queue:]destinationName[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A specialized JMS component for highly-performant transactional batch consumption from a queue.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="slack.html">Slack</a> /&#160;<code>camel-slack</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">slack:#channel[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;<span>The&#160;</span> <strong>slack</strong> <span>&#160;component allows you to connect to an instance of&#160;</span> <a shape="rect" class="external-link" href="http://www.slack.com/" rel="nofollow">Slack</a> <span>&#160;and delivers a message contained in the message body via a pre established&#160;</span> <a shape="rect" class="external-link" href="https://api.slack.com/incoming-webhooks" rel="nofollow">Slack incoming webhook</a> <span>.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="mail.html">SMTP</a> /&#160;<code>camel-mail</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">smtps://[username@]hostName[:port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sending email using SMTP and JavaMail</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="mail.html">SMTP</a> /&#160;<code>camel-mail</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">smtps://[username@]hostName[:port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>...</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="smpp.html">SMPP</a> /&#160;<code>camel-smpp</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">smpp://[username@]hostName[:port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To send and receive SMS using Short Messaging Service Center using the <a shape="rect" class="external-link" href="http://code.google.com/p/jsmpp/" rel="nofollow">JSMPP library</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="unresolved" href="#">SMPPS</a> /&#160;<code>camel-smpp</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">smpps://[username@]hostName[:port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>...</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="snmp.html">SNMP</a> /&#160;<code>camel-snmp</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">snmp://hostName[:port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Polling OID values and receiving traps using SNMP via <a shape="rect" class="external-link" href="http://snmp4j.com" rel="nofollow">SNMP4J </a> library</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="solr.html">Solr</a> /&#160;<code>camel-solr</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">solr://hostName[:port]/solr[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Uses the <a shape="rect" class="external-link" href="http://wiki.apache.org/solr/Solrj">Solrj</a> client API to interface with an <a shape="rect" class="external-link" href="http://lucene.apache.org/solr/">Apache Lucene Solr</a> server</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="apache-spark.html">Apache Spark</a> /&#160;<code>camel-spark</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">spark:{rdd|dataframe|hive}[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Bridges <a shape="rect" class="external-link" href="http://spark.apache.org">Apache Spark</a> computations with Camel endpoints.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span> <a shape="rect" href="spark-rest.html">Spark-rest</a> /&#160;<code>camel-spark-rest</code></span></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">spark-rest://verb:path[?options] </script> 
      </div>
     </div><p><span> <br clear="none"> </span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;For easily defining REST services endpoints using <a shape="rect" class="external-link" href="http://sparkjava.com/" rel="nofollow">Spark REST Java</a> library.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="splunk.html">Splunk</a> /&#160;<code>camel-splunk</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">splunk://[endpoint][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For working with <a shape="rect" class="external-link" href="http://docs.splunk.com/Documentation/Splunk" rel="nofollow">Splunk</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="springbatch.html">SpringBatch</a> /&#160;<code>camel-spring-batch</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">spring-batch://jobName[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To bridge Camel and <a shape="rect" class="external-link" href="http://www.springsource.org/spring-batch" rel="nofollow">Spring Batch</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="springintegration.html">SpringIntegration</a> /&#160;<code>camel-spring-integration</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">spring-integration:defaultChannelName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The bridge component of Camel and <a shape="rect" class="external-link" href="http://www.springframework.org/spring-integration" rel="nofollow">Spring Integration</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="spring-ldap.html">Spring LDAP</a> /&#160;<code>camel-spring-ldap</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">spring-ldap:springLdapTemplateBean[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Camel wrapper for <a shape="rect" class="external-link" href="http://www.springsource.org/ldap" rel="nofollow">Spring LDAP</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="spring-redis.html">Spring Redis</a> /&#160;<code>camel-spring-redis</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">spring-redis://hostName:port[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Component for consuming and producing from Redis key-value store <a shape="rect" class="external-link" href="http://redis.io" rel="nofollow">Redis</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="spring-web-services.html">Spring Web Services</a> /&#160;<code>camel-spring-ws</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">spring-ws:[mapping-type:]address[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Client-side support for accessing web services, and server-side support for creating your own contract-first web services using <a shape="rect" class="external-link" href="http://static.springsource.org/spring-ws/sites/1.5/" rel="nofollow">Spring Web Services</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="sql-component.html">SQL</a> /&#160;<code>camel-sql</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">sql:select * from table where id=#[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Performing SQL queries using JDBC</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="sql-component.html">SQL</a> <a shape="rect" href="sql-stored-procedure.html"> Stored Procedure</a> <span> /&#160;<code>camel-sql</code></span></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">sql-stored:template[?options]</script> 
      </div>
     </div><p><span> <br clear="none"> </span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Performing SQL queries using Stored Procedure calls</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="ssh.html">SSH</a> component /&#160;<code>camel-ssh</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">ssh:[username[:password]@]hostName[:port][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For sending commands to a SSH server</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="stax.html">StAX</a> /&#160;<code>camel-stax</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">stax:(contentHandlerClassName|#myHandler) </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Process messages through a SAX <a shape="rect" class="external-link" href="http://download.oracle.com/javase/6/docs/api/org/xml/sax/ContentHandler.html" rel="nofollow">ContentHandler</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="stream.html">Stream</a> /&#160;<code>camel-stream</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">stream:[in|out|err|file|header|url][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Read or write to an input/output/error/file stream rather like unix pipes</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="stomp.html">Stomp</a> /&#160;<code>camel-stomp</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">stomp:queue:destinationName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For communicating with <a shape="rect" class="external-link" href="http://stomp.github.io/" rel="nofollow">Stomp</a> compliant message brokers, like <a shape="rect" class="external-link" href="http://activemq.apache.org">Apache ActiveMQ</a> or <a shape="rect" class="external-link" href="http://activemq.apache.org/apollo/">ActiveMQ Apollo</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="stringtemplate.html">StringTemplate</a> /&#160;<code>camel-stringtemplate</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">string-template:templateName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Generates a response using a <a shape="rect" class="external-link" href="http://www.stringtemplate.org/" rel="nofollow">String Template</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="stub.html">Stub</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">stub:someOtherCamelUri[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Allows you to <a shape="rect" href="stub.html">stub out some physical middleware endpoint</a> for easier testing or debugging</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="telegram.html">Telegram</a> /&#160;<code>camel-telegram</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">telegram://bots/authToken[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Allows to exchange data with the Telegram messaging network</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="test.html">Test</a> /&#160;<code>camel-spring</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">test:expectedMessagesEndpointUri[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Creates a <a shape="rect" href="mock.html">Mock</a> endpoint which expects to receive all the message bodies that could be polled from the given underlying endpoint</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="timer.html">Timer</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">timer:timerName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Used to generate message exchanges when a timer fires You can only consume events from this endpoint.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="twitter.html">Twitter</a> /&#160;<code>camel-twitter</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">twitter://endpoint[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A twitter endpoint</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="undertow.html">Undertow</a> /&#160;<code>camel-undertow</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">undertow://host:port/context-path[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>HTTP server and client using the light-weight <a shape="rect" class="external-link" href="http://undertow.io/index.html" rel="nofollow">Undertow</a> server.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="validation.html">Validation</a> /&#160;<code>camel-core</code> (camel-spring for Camel 2.8 or older)</p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">validation:someLocalOrRemoteResource[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Validates the payload of a message using <a shape="rect" class="external-link" href="http://www.w3.org/XML/Schema" rel="nofollow">XML Schema</a> and JAXP Validation</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="velocity.html">Velocity</a> /&#160;<code>camel-velocity</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">velocity:templateName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Generates a response using an <a shape="rect" class="external-link" href="http://velocity.apache.org/">Apache Velocity</a> template</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="vertx.html">Vertx</a> /&#160;<code>camel-vertx</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">vertx:eventBusName </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Working with the <a shape="rect" class="external-link" href="http://vertx.io/" rel="nofollow">vertx</a> event bus</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="vm.html">VM</a> /&#160;<code>camel-core</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">vm:queueName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Asynchronous call to another endpoint in the same JVM</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="weather.html">Weather</a> /&#160;<code>camel-weather</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">wweather://name[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Polls the weather information from <a shape="rect" class="external-link" href="http://openweathermap.org" rel="nofollow">Open Weather Map</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="websocket.html">Websocket</a> /&#160;<code>camel-websocket</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">websocket://hostname[:port][/resourceUri][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Communicating with <a shape="rect" class="external-link" href="http://wiki.eclipse.org/Jetty/Feature/WebSockets" rel="nofollow">Websocket</a> clients</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="xml-security-component.html">XML Security </a> /&#160;<code>camel-xmlsecurity</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">xmlsecurity:&amp;lt;sign|verify&amp;gt;:name[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Used to sign and verify exchanges using the XML signature specification.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="xmpp.html">XMPP</a> /&#160;<code>camel-xmpp</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">xmpp://[login@]hostname[:port][/participant][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Working with XMPP and Jabber</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="xquery-endpoint.html">XQuery</a> /&#160;<code>camel-saxon</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">xquery:someXQueryResource </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Generates a response using an <a shape="rect" href="xquery.html">XQuery</a> template</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="xslt.html">XSLT</a> /&#160;<code>camel-core</code> (camel-spring for Camel 2.8 or older)</p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">xslt:templateName[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Generates a response using an <a shape="rect" class="external-link" href="http://www.w3.org/TR/xslt" rel="nofollow">XSLT</a> template</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="yammer.html">Yammer</a> /&#160;<code>camel-yammer</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">yammer://function[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Allows you to interact with the <a shape="rect" class="external-link" href="http://yammer.com" rel="nofollow">Yammer</a> enterprise social network</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="zookeeper.html">Zookeeper</a> /&#160;<code>camel-zookeeper</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: plain; gutter: false; theme: Default" type="syntaxhighlighter">zookeeper://zookeeperServer[:port][/path][?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Working with <a shape="rect" class="external-link" href="http://hadoop.apache.org/zookeeper/">ZooKeeper</a> cluster(s)</p></td></tr></tbody></table>
</div><p>&#160;</p><div>
 <span style="white-space: pre-wrap;"> <br clear="none"> </span>
</div><div>
 <span style="white-space: pre-wrap;"> <br clear="none"> </span>
</div><div>
 <span style="white-space: pre-wrap;"> <br clear="none"> <br clear="none"> </span>
</div><h3 id="BookInOnePage-URI'sforexternalcomponents">URI's for external components</h3><p>Other projects and companies have also created Camel components to integrate additional functionality into Camel. These components may be provided under licenses that are not compatible with the Apache License, use libraries that are not compatible, etc... These components are not supported by the Camel team, but we provide links here to help users find the additional functionality.</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Component / ArtifactId / URI</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>License</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="activemq.html">ActiveMQ</a> /&#160;<code>activemq-camel</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">activemq:[queue|topic:]destinationName</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For JMS Messaging with <a shape="rect" class="external-link" href="http://activemq.apache.org/" title="The most popular and powerful open source message broker">Apache ActiveMQ.</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://activemq.apache.org/broker-camel-component.html">ActiveMQ Broker</a> /&#160;<code>activemq-camel</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter">broker:[queue|topic:]destinationName</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For internal message routing in the <a shape="rect" href="activemq.html">ActiveMQ</a> broker using Camel.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://activiti.org/userguide/index.html#bpmnCamelTask" rel="nofollow">Activiti</a> /&#160;<code>activiti-camel</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">activiti:camelProcess:serviceTask </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For working with <a shape="rect" class="external-link" href="http://www.activiti.org/" rel="nofollow">Activiti</a>, a light-weight workflow and Business Process Management (BPM) platform which supports BPMN 2.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/gateway/camel_components/camel_bluetooth_component.html" rel="nofollow">Bluetooth </a>/&#160;<code>camel-bluetooth</code> / <a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/" rel="nofollow">rhiot.io</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">bluetooth:label </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Camel Bluetooth component can retrieve information about the Bluetooth devices available within the device range.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="couchbase.html">Couchbase</a> /&#160;<code>camel-couchbase</code> / <a shape="rect" class="external-link" href="https://code.google.com/a/apache-extras.org/p/camel-extra/" rel="nofollow">camel-extra</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">couchbase:protocol://host[:port]/bucket</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Couchbase</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Working with <a shape="rect" class="external-link" href="http://www.couchbase.com/" rel="nofollow">Couchbase NoSQL</a> document database.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="db4o.html">Db4o</a> /&#160;<code>camel-db4o</code> / <a shape="rect" class="external-link" href="http://code.google.com/p/camel-extra/" rel="nofollow">camel-extra</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">db4o://className </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>GPL</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For using a db4o datastore as a queue via the <a shape="rect" class="external-link" href="http://www.db4o.com/" rel="nofollow">db4o</a> library.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="esper.html">Esper</a> /&#160;<code>camel-esper</code> / <a shape="rect" class="external-link" href="http://code.google.com/p/camel-extra/" rel="nofollow">camel-extra</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">esper:name </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>GPL</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Working with the <a shape="rect" class="external-link" href="http://esper.codehaus.org" rel="nofollow">Esper Library</a> for Event Stream Processing.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>Fabric <a shape="rect" class="external-link" href="http://fabric8.io/gitbook/camelEndpointAmq.html" rel="nofollow">AMQ</a> /&#160;<code>mq-fabric-camel</code> / <a shape="rect" class="external-link" href="http://code.google.com/p/camel-extra/" rel="nofollow">f</a><a shape="rect" class="external-link" href="http://fabric8.io/" rel="nofollow">abric8</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">amq:[queue|topic:]destinationName</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The <strong><a shape="rect" class="external-link" href="http://fabric8.io/gitbook/camelEndpointAmq.html" rel="nofollow">amq:</a></strong> endpoint works exactly like the <strong>activemq:</strong> endpoint in Apache Camel; only it uses the <a shape="rect" class="external-link" href="http://fabric8.io/" rel="nofollow">fabric</a> to automatically discover the broker. So there is no configuration required; it'll just work out of the box and automatically discover whatever ActiveMQ message brokers are available; with failover and load balancing.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span>Fabric <a shape="rect" class="external-link" href="http://fabric8.io/gitbook/camelEndpointFabric.html" rel="nofollow">Fabric</a></span><span> /&#160;<code>fabric-camel</code> / </span><a shape="rect" class="external-link" href="http://code.google.com/p/camel-extra/" rel="nofollow">f</a><a shape="rect" class="external-link" href="http://fabric8.io/" rel="nofollow">abric8</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">fabric:logicalName:camelEndpointUri</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The <strong><a shape="rect" class="external-link" href="http://fabric8.io/gitbook/camelEndpointFabric.html" rel="nofollow">fabric:</a></strong> endpoint uses Fabric's discovery mechanism to expose physical sockets, HTTP endpoints, etc. into the <a shape="rect" class="external-link" href="http://fabric8.io/gitbook/registry.html" rel="nofollow">runtime registry</a> using a logical name so that clients can use the existing Camel <a shape="rect" href="load-balancer.html">Load Balancer</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span>Fabric <a shape="rect" class="external-link" href="http://fabric8.io/gitbook/camelEndpointMaster.html" rel="nofollow">Master</a> /&#160;<code>fabric-camel</code> / </span><a shape="rect" class="external-link" href="http://code.google.com/p/camel-extra/" rel="nofollow">f</a><a shape="rect" class="external-link" href="http://fabric8.io/" rel="nofollow">abric8</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">master:clusterName:camelEndpointUri</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The <strong><a shape="rect" class="external-link" href="http://fabric8.io/gitbook/camelEndpointMaster.html" rel="nofollow">master:</a></strong> endpoint provides a way to ensure only a single consumer in a cluster consumes from a given endpoint; with automatic failover if that JVM dies.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/gateway/camel_components/camel_framebuffer_component.html" rel="nofollow">Framebuffer</a>&#160; /&#160;<code>camel-framebuffer</code> / <a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/" rel="nofollow">rhiot.io</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">framebuffer://name</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Camel Framebuffer component can be used to manage any Linux Framebuffer.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/gateway/camel_components/camel_gpsd_component.html" rel="nofollow">gpsd</a> /&#160;<code>camel-gpsd</code> / <a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/" rel="nofollow">rhiot.io</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">gpsd:label[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Camel <a shape="rect" class="external-link" href="http://www.catb.org/gpsd" rel="nofollow">GPSD</a> component can be used to read current GPS information from GPS devices.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="hibernate.html">Hibernate</a> /&#160;<code>camel-hibernate</code> / <a shape="rect" class="external-link" href="http://code.google.com/p/camel-extra/" rel="nofollow">camel-extra</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">hibernate://entityName </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>GPL</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For using a database as a queue via the <a shape="rect" class="external-link" href="http://www.hibernate.org/" rel="nofollow">Hibernate</a> library.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="jbi.html">JBI</a> /&#160;<code>servicemix-camel</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">jbi:serviceName </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For JBI integration such as working with <a shape="rect" class="external-link" href="http://servicemix.apache.org">Apache ServiceMix.</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="jcifs.html">JCIFS</a> /&#160;<code>camel-jcifs</code> / <a shape="rect" class="external-link" href="http://code.google.com/p/camel-extra/" rel="nofollow">camel-extra</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">smb://user@server.example.com/sharename?password=secret&amp;amp;localWorkDirectory=/tmp </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>LGPL</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>This component provides access to remote file systems over the CIFS/SMB networking protocol by using the <a shape="rect" class="external-link" href="http://jcifs.samba.org/" rel="nofollow">JCIFS</a> library.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/gateway/camel_components/camel_kura_cloud_component.html" rel="nofollow">kura-cloud</a> /&#160;<code>camel-kura</code> / <a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/" rel="nofollow">rhiot.io</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">kura-wifi:networkInterface/ssid </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Camel Kura Cloud component interacts directly with Kura CloudService.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/gateway/camel_components/camel_kura_wifi_component.html" rel="nofollow">kura-wifi</a> /&#160;<code>camel-kura</code> / <a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/" rel="nofollow">rhiot.io</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">kura-wifi:networkInterface/ssid </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Camel Kura WiFi component can be used to retrieve the information about the WiFi access spots available within the device range.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="nmr.html">NMR</a> /&#160;<code>servicemix-nmr</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">nmr://serviceName </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Integration with the Normalized Message Router BUS in <a shape="rect" class="external-link" href="http://servicemix.apache.org/SMX4NMR/index.html">ServiceMix 4.x.</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/backend/camel_components/camel_openimaj_component.html" rel="nofollow">OpenIMAJ</a> /&#160;<code>camel-openimaj</code> / <a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/" rel="nofollow">rhiot.io</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">pi4j-gpio://gpioId[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Camel <a shape="rect" class="external-link" href="http://www.openimaj.org/" rel="nofollow">OpenIMAJ</a> component can be used to detect faces in images.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="unresolved" href="#">pi4j-gpio</a> /&#160;<code>camel-pi4j</code> / <a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/" rel="nofollow">rhiot.io</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">pi4j-gpio://gpioId[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>GPIO&#160;Component for RaspberryPi based on pi4j lib.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="https://github.com/camel-labs/camel-labs/tree/master/iot" rel="nofollow">pi4j-i2c</a> /&#160;<code>camel-pi4j</code> / <a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/" rel="nofollow">rhiot.io</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">pi4j-i2c://busId/deviceId[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>i2c Component for RaspberryPi based on pi4j lib.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="https://github.com/camel-labs/camel-labs/tree/master/iot#camel-pubnub-component" rel="nofollow">PubNub</a> /&#160;<code>camel-pubnub</code> / <a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/" rel="nofollow">rhiot.io</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&nbsp;pubnub://pubnubEndpointType:channel[?options]</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Camel <a shape="rect" class="external-link" href="https://www.pubnub.com/" rel="nofollow">PubNub</a> component. More information <a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/" rel="nofollow">rhiot.io project.</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="rcode.html">RCode</a> /&#160;<code>camel-rcode</code> / <a shape="rect" class="external-link" href="http://code.google.com/p/camel-extra/" rel="nofollow">camel-extra</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">rcode://host[:port]/operation[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>LGPL</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Uses <a shape="rect" class="external-link" href="http://www.rforge.net/Rserve/" rel="nofollow">Rserve</a> to integrate Camel with the statistics environment <a shape="rect" class="external-link" href="http://www.r-project.org/" rel="nofollow">R.</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://scalate.fusesource.org/camel.html" rel="nofollow">Scalate</a> /&#160;<code>scalate-camel</code></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">scalate:templateName </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Uses the given <a shape="rect" class="external-link" href="http://scalate.fusesource.org/" rel="nofollow">Scalate</a> template to transform the message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="smooks.html">Smooks</a> /&#160;<code>camel-smooks</code> / <a shape="rect" class="external-link" href="http://code.google.com/p/camel-extra/" rel="nofollow">camel-extra</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">unmarshal(edi) </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>GPL</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For working with EDI parsing using the <a shape="rect" class="external-link" href="http://milyn.codehaus.org/Smooks" rel="nofollow">Smooks library</a>. This component is <strong>deprecated</strong> as Smooks now provides <a shape="rect" class="external-link" href="http://www.smooks.org/mediawiki/index.php?title=V1.5:Smooks_v1.5_User_Guide#Apache_Camel_Integration" rel="nofollow">Camel integration out of the box.</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="spring-neo4j.html">Spring Neo4j</a> /&#160;<code>camel-spring-neo4j</code> / <a shape="rect" class="external-link" href="http://code.google.com/p/camel-extra/" rel="nofollow">camel-extra</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">spring-neo4j:http://hostname[:port]/database[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>TBA</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Component for producing to Neo4j datastore using the <a shape="rect" class="external-link" href="http://www.springsource.org/spring-data/neo4j" rel="nofollow">Spring Data Neo4j</a> library.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://www.tinkerforge.com" rel="nofollow">Tinkerforge</a> /&#160;<code>camel-tinkerforge</code> / <a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/" rel="nofollow">rhiot.io</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">tinkerforge:[//hostname[:port]]/devicetype/uid/[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The tinkerforge component allows interaction with Tinkerforge <a shape="rect" class="external-link" href="http://www.tinkerforge.com/en/doc/Primer.html#primer-bricklets" rel="nofollow">bricklets</a>. It uses the standard <a shape="rect" class="external-link" href="http://www.tinkerforge.com/en/doc/Software/API_Bindings_Java.html#api-bindings-java" rel="nofollow">Java bindings</a> to connects to <code>brickd</code>. For more information see the <a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/" rel="nofollow">rhiot.io</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="virtualbox.html">VirtualBox</a> /&#160;<code>camel-virtualbox</code> / <a shape="rect" class="external-link" href="http://code.google.com/p/camel-extra/" rel="nofollow">camel-extra</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">virtualbox:machine[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>GPL V2</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The VitualBox component uses the webservice API that exposes&#160;<a shape="rect" class="external-link" href="https://www.virtualbox.org/wiki/VirtualBox" rel="nofollow">VirtualBox</a>&#160;functionality and consumes events generated by virtual machines.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/gateway/camel_components/camel_webcam_component.html" rel="nofollow">Webcam</a> /&#160;<code>camel-webcam</code> / <a shape="rect" class="external-link" href="https://rhiot.gitbooks.io/rhiotdocumentation/content/" rel="nofollow">rhiot.io</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">webcam:label[?options] </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Apache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Camel <a shape="rect" class="external-link" href="http://webcam-capture.sarxos.pl/" rel="nofollow">Webcam</a> component can be used to capture still images and detect motion.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="zeromq.html">ZeroMQ</a> /&#160;<code>camel-zeromq</code> / <a shape="rect" class="external-link" href="http://code.google.com/p/camel-extra/" rel="nofollow">camel-extra</a></p>
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">zeromq:(tcp|ipc)://hostname:port </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>LGPL</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The ZeroMQ component allows you to consumer or produce messages using&#160;<a shape="rect" class="external-link" href="http://zeromq.org" rel="nofollow">ZeroMQ</a>.</p></td></tr></tbody></table>
</div><p>For a full details of the individual components see the <a shape="rect" href="book-component-appendix.html">Component Appendix</a></p></div>
<div class="chapter" id="chapter-enterprise-integration-patterns"><h1 id="BookInOnePage-EnterpriseIntegrationPatterns">Enterprise Integration Patterns</h1><p>Camel supports most of the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/toc.html" rel="nofollow">Enterprise Integration Patterns</a> from the <a shape="rect" class="external-link" href="http://www.amazon.com/dp/0321200683?tag=enterpriseint-20&amp;camp=14573&amp;creative=327641&amp;linkCode=as1&amp;creativeASIN=0321200683&amp;adid=1VPQTCMNNEMCJXPKRFPG&amp;" rel="nofollow">excellent book</a> of the same name by Gregor Hohpe and Bobby Woolf. Its a highly recommended book, particularly for users of Camel.</p><h2 id="BookInOnePage-PatternIndex">Pattern Index</h2><p>There now follows a list of the Enterprise Integration Patterns from the book along with examples of the various patterns using Apache Camel</p><h3 id="BookInOnePage-MessagingSystems">Messaging Systems</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/ChannelIcon.gif" data-image-src="http://www.eaipatterns.com/img/ChannelIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="message-channel.html">Message Channel</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How does one application communicate with another using messaging?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/MessageIcon.gif" data-image-src="http://www.eaipatterns.com/img/MessageIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="message.html">Message</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can two applications connected by a message channel exchange a piece of information?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/PipesAndFiltersIcon.gif" data-image-src="http://www.eaipatterns.com/img/PipesAndFiltersIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="pipes-and-filters.html">Pipes and Filters</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can we perform complex processing on a message while maintaining independence and flexibility?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/ContentBasedRouterIcon.gif" data-image-src="http://www.eaipatterns.com/img/ContentBasedRouterIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="message-router.html">Message Router</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can you decouple individual processing steps so that messages can be passed to different filters depending on a set of conditions?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/MessageTranslatorIcon.gif" data-image-src="http://www.eaipatterns.com/img/MessageTranslatorIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="message-translator.html">Message Translator</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can systems using different data formats communicate with each other using messaging?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/MessageEndpointIcon.gif" data-image-src="http://www.eaipatterns.com/img/MessageEndpointIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="message-endpoint.html">Message Endpoint</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How does an application connect to a messaging channel to send and receive messages?</p></td></tr></tbody></table>
</div><h3 id="BookInOnePage-MessagingChannels">Messaging Channels</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/PointToPointIcon.gif" data-image-src="http://www.eaipatterns.com/img/PointToPointIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="point-to-point-channel.html">Point to Point Channel</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can the caller be sure that exactly one receiver will receive the document or perform the call?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/PublishSubscribeIcon.gif" data-image-src="http://www.eaipatterns.com/img/PublishSubscribeIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="publish-subscribe-channel.html">Publish Subscribe Channel</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can the sender broadcast an event to all interested receivers?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/DeadLetterChannelIcon.gif" data-image-src="http://www.eaipatterns.com/img/DeadLetterChannelIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="dead-letter-channel.html">Dead Letter Channel</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>What will the messaging system do with a message it cannot deliver?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/GuaranteedMessagingIcon.gif" data-image-src="http://www.eaipatterns.com/img/GuaranteedMessagingIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="guaranteed-delivery.html">Guaranteed Delivery</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can the sender make sure that a message will be delivered, even if the messaging system fails?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/MessageBusIcon.gif" data-image-src="http://www.eaipatterns.com/img/MessageBusIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="message-bus.html">Message Bus</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>What is an architecture that enables separate applications to work together, but in a de-coupled fashion such that applications can be easily added or removed without affecting the others?</p></td></tr></tbody></table>
</div><h3 id="BookInOnePage-MessageConstruction">Message Construction</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/EventMessageIcon.gif" data-image-src="http://www.eaipatterns.com/img/EventMessageIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="event-message.html">Event Message</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can messaging be used to transmit events from one application to another?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/RequestReplyIcon.gif" data-image-src="http://www.eaipatterns.com/img/RequestReplyIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="request-reply.html">Request Reply</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>When an application sends a message, how can it get a response from the receiver?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/CorrelationIdentifierIcon.gif" data-image-src="http://www.eaipatterns.com/img/CorrelationIdentifierIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="correlation-identifier.html">Correlation Identifier</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How does a requestor that has received a reply know which request this is the reply for?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/ReturnAddressIcon.gif" data-image-src="http://www.eaipatterns.com/img/ReturnAddressIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="return-address.html">Return Address</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How does a replier know where to send the reply?</p></td></tr></tbody></table>
</div><h3 id="BookInOnePage-MessageRouting">Message Routing</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/ContentBasedRouterIcon.gif" data-image-src="http://www.eaipatterns.com/img/ContentBasedRouterIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="content-based-router.html">Content Based Router</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How do we handle a situation where the implementation of a single logical function (e.g., inventory check) is spread across multiple physical systems?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/MessageFilterIcon.gif" data-image-src="http://www.eaipatterns.com/img/MessageFilterIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="message-filter.html">Message Filter</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can a component avoid receiving uninteresting messages?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/DynamicRouterIcon.gif" data-image-src="http://www.eaipatterns.com/img/DynamicRouterIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="dynamic-router.html">Dynamic Router</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can you avoid the dependency of the router on all possible destinations while maintaining its efficiency?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/RecipientListIcon.gif" data-image-src="http://www.eaipatterns.com/img/RecipientListIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="recipient-list.html">Recipient List</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How do we route a message to a list of (static or dynamically) specified recipients?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/SplitterIcon.gif" data-image-src="http://www.eaipatterns.com/img/SplitterIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="splitter.html">Splitter</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can we process a message if it contains multiple elements, each of which may have to be processed in a different way?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/AggregatorIcon.gif" data-image-src="http://www.eaipatterns.com/img/AggregatorIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="aggregator2.html">Aggregator</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How do we combine the results of individual, but related messages so that they can be processed as a whole?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/ResequencerIcon.gif" data-image-src="http://www.eaipatterns.com/img/ResequencerIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="resequencer.html">Resequencer</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can we get a stream of related but out-of-sequence messages back into the correct order?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/DistributionAggregateIcon.gif" data-image-src="http://www.eaipatterns.com/img/DistributionAggregateIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="composed-message-processor.html">Composed Message Processor</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can you maintain the overall message flow when processing a message consisting of multiple elements, each of which may require different processing?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png" data-image-src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="scatter-gather.html">Scatter-Gather</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How do you maintain the overall message flow when a message needs to be sent to multiple recipients, each of which may send a reply?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/RoutingTableIcon.gif" data-image-src="http://www.eaipatterns.com/img/RoutingTableIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="routing-slip.html">Routing Slip</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How do we route a message consecutively through a series of processing steps when the sequence of steps is not known at design-time and may vary for each message?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png" data-image-src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="throttler.html">Throttler</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can I throttle messages to ensure that a specific endpoint does not get overloaded, or we don't exceed an agreed SLA with some external service?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png" data-image-src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="sampling.html">Sampling</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can I sample one message out of many in a given period to avoid downstream route does not get overloaded?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png" data-image-src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="delayer.html">Delayer</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can I delay the sending of a message?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png" data-image-src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="load-balancer.html">Load Balancer</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can I balance load across a number of endpoints?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="hystrix-eip.html">Hystrix</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To use Hystrix Circuit Breaker when calling an external service.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="servicecall-eip.html">Service Call</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To call a remote service in a distributed system where the service is looked up from a service registry of some sorts.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png" data-image-src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="multicast.html">Multicast</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can I route a message to a number of endpoints at the same time?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png" data-image-src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="loop.html">Loop</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can I repeat processing a message in a loop?</p></td></tr></tbody></table>
</div><h3 id="BookInOnePage-MessageTransformation">Message Transformation</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/DataEnricherIcon.gif" data-image-src="http://www.eaipatterns.com/img/DataEnricherIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="content-enricher.html">Content Enricher</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How do we communicate with another system if the message originator does not have all the required data items available?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/ContentFilterIcon.gif" data-image-src="http://www.eaipatterns.com/img/ContentFilterIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="content-filter.html">Content Filter</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How do you simplify dealing with a large message, when you are interested only in a few data items?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/StoreInLibraryIcon.gif" data-image-src="http://www.eaipatterns.com/img/StoreInLibraryIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="claim-check.html">Claim Check</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can we reduce the data volume of message sent across the system without sacrificing information content?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/NormalizerIcon.gif" data-image-src="http://www.eaipatterns.com/img/NormalizerIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="normalizer.html">Normalizer</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How do you process messages that are semantically equivalent, but arrive in a different format?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png" data-image-src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="sort.html">Sort</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can I sort the body of a message?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p>Script</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How do I execute a script which may not change the message?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png" data-image-src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="validate.html">Validate</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can I validate a message?</p></td></tr></tbody></table>
</div><h3 id="BookInOnePage-MessagingEndpoints">Messaging Endpoints</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png" data-image-src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="messaging-mapper.html">Messaging Mapper</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How do you move data between domain objects and the messaging infrastructure while keeping the two independent of each other?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/EventDrivenConsumerIcon.gif" data-image-src="http://www.eaipatterns.com/img/EventDrivenConsumerIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="event-driven-consumer.html">Event Driven Consumer</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can an application automatically consume messages as they become available?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/PollingConsumerIcon.gif" data-image-src="http://www.eaipatterns.com/img/PollingConsumerIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="polling-consumer.html">Polling Consumer</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can an application consume a message when the application is ready?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/CompetingConsumersIcon.gif" data-image-src="http://www.eaipatterns.com/img/CompetingConsumersIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="competing-consumers.html">Competing Consumers</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can a messaging client process multiple messages concurrently?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/MessageDispatcherIcon.gif" data-image-src="http://www.eaipatterns.com/img/MessageDispatcherIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="message-dispatcher.html">Message Dispatcher</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can multiple consumers on a single channel coordinate their message processing?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/MessageSelectorIcon.gif" data-image-src="http://www.eaipatterns.com/img/MessageSelectorIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="selective-consumer.html">Selective Consumer</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can a message consumer select which messages it wishes to receive?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/DurableSubscriptionIcon.gif" data-image-src="http://www.eaipatterns.com/img/DurableSubscriptionIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="durable-subscriber.html">Durable Subscriber</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can a subscriber avoid missing messages while it's not listening for them?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png" data-image-src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="idempotent-consumer.html">Idempotent Consumer</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can a message receiver deal with duplicate messages?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/TransactionalClientIcon.gif" data-image-src="http://www.eaipatterns.com/img/TransactionalClientIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="transactional-client.html">Transactional Client</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can a client control its transactions with the messaging system?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/MessagingGatewayIcon.gif" data-image-src="http://www.eaipatterns.com/img/MessagingGatewayIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="messaging-gateway.html">Messaging Gateway</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How do you encapsulate access to the messaging system from the rest of the application?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/MessagingAdapterIcon.gif" data-image-src="http://www.eaipatterns.com/img/MessagingAdapterIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="service-activator.html">Service Activator</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can an application design a service to be invoked both via various messaging technologies and via non-messaging techniques?</p></td></tr></tbody></table>
</div><h3 id="BookInOnePage-SystemManagement">System Management</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/ControlBusIcon.gif" data-image-src="http://www.eaipatterns.com/img/ControlBusIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="controlbus.html">ControlBus</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can we effectively administer a messaging system that is distributed across multiple platforms and a wide geographic area?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/DetourIcon.gif" data-image-src="http://www.eaipatterns.com/img/DetourIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="detour.html">Detour</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can you route a message through intermediate steps to perform validation, testing or debugging functions?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.eaipatterns.com/img/WireTapIcon.gif" data-image-src="http://www.eaipatterns.com/img/WireTapIcon.gif"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="wire-tap.html">Wire Tap</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How do you inspect messages that travel on a point-to-point channel?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png" data-image-src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="message-history.html">Message History</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can we effectively analyze and debug the flow of messages in a loosely coupled system?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png" data-image-src="http://cwiki.apache.org/confluence/download/attachments/49204/clear.png"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="logeip.html">Log</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How can I log processing a message?</p></td></tr></tbody></table>
</div><p>For a full breakdown of each pattern see the <a shape="rect" href="book-pattern-appendix.html">Book Pattern Appendix</a></p></div>
<div class="chapter" id="chapter-cook-book"></div>
<h1 id="BookInOnePage-CookBook">CookBook</h1>
This document describes various recipes for working with Camel
<ul><li><a shape="rect" href="bean-integration.html">Bean Integration</a> describes how to work with beans and Camel in a loosely coupled way so that your beans do not have to depend on any Camel APIs
	<ul><li><a shape="rect" href="annotation-based-expression-language.html">Annotation Based Expression Language</a> binds expressions to method parameters</li><li><a shape="rect" href="bean-binding.html">Bean Binding</a> defines which methods are invoked and how the Message is converted into the parameters of the method when it is invoked</li><li><a shape="rect" href="bean-injection.html">Bean Injection</a> for injecting Camel related resources into your POJOs</li><li><a shape="rect" href="parameter-binding-annotations.html">Parameter Binding Annotations</a> for extracting various headers, properties or payloads from a Message</li><li><a shape="rect" href="pojo-consuming.html">POJO Consuming</a> for consuming and possibly routing messages from Camel</li><li><a shape="rect" href="pojo-producing.html">POJO Producing</a> for producing camel messages from your POJOs</li><li><a shape="rect" href="recipientlist-annotation.html">RecipientList Annotation</a> for creating a Recipient List from a POJO method</li><li><a shape="rect" href="using-exchange-pattern-annotations.html">Using Exchange Pattern Annotations</a> describes how pattern annotations can be used to change the behaviour of method invocations</li></ul>
	</li><li><a shape="rect" href="hiding-middleware.html">Hiding Middleware</a> describes how to avoid your business logic being coupled to any particular middleware APIs allowing you to easily switch from in JVM <a shape="rect" href="seda.html">SEDA</a> to <a shape="rect" href="jms.html">JMS</a>, <a shape="rect" href="activemq.html">ActiveMQ</a>, <a shape="rect" href="hibernate.html">Hibernate</a>, <a shape="rect" href="jpa.html">JPA</a>, <a shape="rect" href="jdbc.html">JDBC</a>, <a shape="rect" href="ibatis.html">iBatis</a> or <a shape="rect" href="javaspace.html">JavaSpace</a> etc.</li><li><a shape="rect" href="visualisation.html">Visualisation</a> describes how to visualise your <a shape="rect" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a> to help you understand your routing rules</li><li><a shape="rect" href="bam.html">Business Activity Monitoring (BAM)</a> for monitoring business processes across systems</li><li><a shape="rect" href="etl.html">Extract Transform Load (ETL)</a> to load data into systems or databases</li><li><a shape="rect" href="testing.html">Testing</a> for testing distributed and asynchronous systems using a messaging approach
	<ul><li><a shape="rect" href="camel-test.html">Camel Test</a> for creating test cases using a single Java class for all your configuration and routing</li><li><a shape="rect" href="spring-testing.html">Spring Testing</a> uses Spring Test together with either XML or Java Config to dependency inject your test classes</li><li><a shape="rect" href="guice.html">Guice</a> uses Guice to dependency inject your test classes</li></ul>
	</li><li><a shape="rect" href="templating.html">Templating</a> is a great way to create service stubs to be able to test your system without some back end system.</li><li><a shape="rect" href="database.html">Database</a> for working with databases</li><li><a shape="rect" href="parallel-processing-and-ordering.html">Parallel Processing and Ordering</a> on how using parallel processing and <a shape="rect" href="seda.html">SEDA</a> or <a shape="rect" href="jms.html">JMS</a> based load balancing can be achieved.</li><li><a shape="rect" href="asynchronous-processing.html">Asynchronous Processing</a> in Camel Routes.</li><li><a shape="rect" href="implementing-virtual-topics-on-other-jms-providers.html">Implementing Virtual Topics on other JMS providers</a> shows how to get the effect of Virtual Topics and avoid issues with JMS durable topics</li><li><a shape="rect" href="camel-transport-for-cxf.html">Camel Transport for CXF</a> describes how to put the Camel context into the CXF transport layer.</li><li><a shape="rect" href="fine-grained-control-over-a-channel.html">Fine Grained Control Over a Channel</a> describes how to deliver a sequence of messages over a single channel and then stopping any more messages being sent over that channel. Typically used for sending data over a socket and then closing the socket.</li><li><a shape="rect" href="eventnotifier-to-log-details-about-all-sent-exchanges.html">EventNotifier to log details about all sent Exchanges</a> shows how to let Camels <code>EventNotifier</code> log all sent to endpoint events and how long time it took.</li><li><a shape="rect" href="loading-routes-from-xml-files.html">Loading routes from XML files</a> into an existing <a shape="rect" href="camelcontext.html">CamelContext</a>.</li><li>Using <a shape="rect" href="mdc-logging.html">MDC logging</a> with Camel</li><li><a shape="rect" href="running-camel-standalone-and-have-it-keep-running.html">Running Camel standalone and have it keep running</a> shows how to keep Camel running when you run it standalone.</li><li><a shape="rect" href="hazelcast-idempotent-repository-tutorial.html">Hazelcast Idempotent Repository Tutorial</a> shows how to avoid to consume duplicated messages in a clustered environment.</li><li><a shape="rect" href="how-to-use-camel-as-a-http-proxy-between-a-client-and-server.html">How to use Camel as a HTTP proxy between a client and server</a> shows how to use Camel as a HTTP adapter/proxy between a client and HTTP service.</li></ul>

<h2 id="BookInOnePage-BeanIntegration">Bean Integration</h2>

<p>Camel supports the integration of beans and POJOs in a number of ways</p>

<h3 id="BookInOnePage-Annotations">Annotations</h3>
<p>If a bean is defined in <a shape="rect" href="spring.html">Spring</a> XML or scanned using the Spring component scanning mechanism and a <strong>&lt;camelContext&gt;</strong> is used or a <code>CamelBeanPostProcessor</code> then we process a number of Camel annotations to do various things such as injecting resources or producing, consuming or routing messages.</p>

<p>The following annotations is supported and inject by Camel's <code>CamelBeanPostProcessor</code></p>

<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Annotation </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>@EndpointInject</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> To inject an endpoint, see more details at <a shape="rect" href="pojo-producing.html">POJO Producing</a>. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>@BeanInject</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.13:</strong> To inject a bean obtained from the <a shape="rect" href="registry.html">Registry</a>. See <a shape="rect" href="bean-injection.html">Bean Injection</a>. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>@PropertyInject</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.12:</strong> To inject a value using <a shape="rect" href="using-propertyplaceholder.html">property placeholder</a>. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>@Produce</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> To inject a producer to send message to an endpoint. See <a shape="rect" href="pojo-producing.html">POJO Producing</a>. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>@Consume</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> To inject a consumer on a method. See <a shape="rect" href="pojo-consuming.html">POJO Consuming</a>. </p></td></tr></tbody></table></div>


<p>See more details at:</p>

<ul><li><a shape="rect" href="pojo-consuming.html">POJO Consuming</a> to consume and possibly route messages from Camel</li><li><a shape="rect" href="pojo-producing.html">POJO Producing</a> to make it easy to produce camel messages from your POJOs</li><li><a shape="rect" href="dynamicrouter-annotation.html">DynamicRouter Annotation</a> for creating a <a shape="rect" href="dynamic-router.html">Dynamic Router</a> from a POJO method</li><li><a shape="rect" href="recipientlist-annotation.html">RecipientList Annotation</a> for creating a <a shape="rect" href="recipient-list.html">Recipient List</a> from a POJO method</li><li><a shape="rect" href="routingslip-annotation.html">RoutingSlip Annotation</a> for creating a <a shape="rect" href="routing-slip.html">Routing Slip</a> for a POJO method</li><li><a shape="rect" href="bean-injection.html">Bean Injection</a> to inject Camel related resources into your POJOs</li><li><a shape="rect" href="using-exchange-pattern-annotations.html">Using Exchange Pattern Annotations</a> describes how the pattern annotations can be used to change the behaviour of method invocations with <a shape="rect" href="spring-remoting.html">Spring Remoting</a> or <a shape="rect" href="pojo-producing.html">POJO Producing</a></li></ul>


<div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Example</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>See the <a shape="rect" href="pojo-messaging-example.html">POJO Messaging Example</a> for how to use the annotations for routing and messaging.</p></div></div>

<h3 id="BookInOnePage-BeanComponent">Bean Component</h3>
<p>The <a shape="rect" href="bean.html">Bean</a> component allows one to invoke a particular method. Alternately the <a shape="rect" href="bean.html">Bean</a> component supports the creation of a proxy via <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/bean/ProxyHelper.html">ProxyHelper</a> to a Java interface; which the implementation just sends a message containing a <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/bean/BeanInvocation.html">BeanInvocation</a> to some Camel endpoint.</p>

<h3 id="BookInOnePage-SpringRemoting">Spring Remoting</h3>
<p>We support a <a shape="rect" href="spring-remoting.html">Spring Remoting</a> provider which uses Camel as the underlying transport mechanism. The nice thing about this approach is we can use any of the Camel transport <a shape="rect" href="components.html">Components</a> to communicate between beans. It also means we can use <a shape="rect" href="content-based-router.html">Content Based Router</a> and the other <a shape="rect" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a> in between the beans; in particular we can use <a shape="rect" href="message-translator.html">Message Translator</a> to be able to convert what the on-the-wire messages look like in addition to adding various headers and so forth. </p>

<div class="confluence-information-macro confluence-information-macro-information"><p class="title">Bean binding</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>Whenever Camel invokes a bean method via one of the above methods (<a shape="rect" href="bean.html">Bean</a> component, <a shape="rect" href="spring-remoting.html">Spring Remoting</a> or <a shape="rect" href="pojo-consuming.html">POJO Consuming</a>) then the <strong><a shape="rect" href="bean-binding.html">Bean Binding</a></strong> mechanism is used to figure out what method to use (if it is not explicit) and how to bind the <a shape="rect" href="message.html">Message</a> to the parameters possibly using the <a shape="rect" href="parameter-binding-annotations.html">Parameter Binding Annotations</a> or using a <a shape="rect" href="bean-binding.html">method name option</a>.</p></div></div>
<h3 id="BookInOnePage-AnnotationBasedExpressionLanguage">Annotation Based Expression Language</h3>

<p>You can also use any of the <a shape="rect" href="languages.html">Languages</a> supported in Camel to bind expressions to method parameters when using <a shape="rect" href="bean-integration.html">Bean Integration</a>. For example you can use any of these annotations:</p>

<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Annotation</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/language/Bean.html">@Bean</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="bean.html">Bean</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-script/apidocs/org/apache/camel/builder/script/BeanShell.html">@BeanShell</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="beanshell.html">BeanShell</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/language/Constant.html">@Constant</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="constant.html">Constant</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-juel/apidocs/org/apache/camel/language/juel/EL.html">@EL</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject an <a shape="rect" href="el.html">EL</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-script/apidocs/org/apache/camel/builder/script/Groovy.html">@Groovy</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="groovy.html">Groovy</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/maven/camel-core/apidocs/org/apache/camel/Header.html">@Header</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="header.html">Header</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-script/apidocs/org/apache/camel/builder/script/JavaScript.html">@JavaScript</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="javascript.html">JavaScript</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-mvel/apidocs/org/apache/camel/language/mvel/MVEL.html">@MVEL</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="mvel.html">MVEL</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-ognl/apidocs/org/apache/camel/language/ognl/OGNL.html">@OGNL</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject an <a shape="rect" href="ognl.html">OGNL</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-script/apidocs/org/apache/camel/builder/script/PHP.html">@PHP</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="php.html">PHP</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-script/apidocs/org/apache/camel/builder/script/Python.html">@Python</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="python.html">Python</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-script/apidocs/org/apache/camel/builder/script/Ruby.html">@Ruby</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="ruby.html">Ruby</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/language/Simple.html">@Simple</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject an <a shape="rect" href="simple.html">Simple</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/language/XPath.html">@XPath</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject an <a shape="rect" href="xpath.html">XPath</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-saxon/apidocs/org/apache/camel/component/xquery/XQuery.html">@XQuery</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject an <a shape="rect" href="xquery.html">XQuery</a> expression </p></td></tr></tbody></table></div>


<h4 id="BookInOnePage-Example:">Example:</h4>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class Foo {
	
    @MessageDriven(uri = &quot;activemq:my.queue&quot;)
    public void doSomething(@XPath(&quot;/foo/bar/text()&quot;) String correlationID, @Body String body) {
		// process the inbound message here
    }
}
]]></script>
</div></div>

<h4 id="BookInOnePage-Advancedexampleusing@Bean">Advanced example using @Bean</h4>

<p>And an example of using the the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/language/Bean.html">@Bean</a> binding annotation, where you can use a <a shape="rect" href="pojo.html">POJO</a> where you can do whatever java code you like:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class Foo {
	
    @MessageDriven(uri = &quot;activemq:my.queue&quot;)
    public void doSomething(@Bean(&quot;myCorrelationIdGenerator&quot;) String correlationID, @Body String body) {
		// process the inbound message here
    }
}
]]></script>
</div></div>

<p>And then we can have a spring bean with the id <strong>myCorrelationIdGenerator</strong> where we can compute the id.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class MyIdGenerator {

    private UserManager userManager;

    public String generate(@Header(name = &quot;user&quot;) String user, @Body String payload) throws Exception {
       User user = userManager.lookupUser(user);
       String userId = user.getPrimaryId();
       String id = userId + generateHashCodeForPayload(payload);
       return id;
   }
}
]]></script>
</div></div>

<p>The <a shape="rect" href="pojo.html">POJO</a> MyIdGenerator has one public method that accepts two parameters. However we have also annotated this one with the @Header and @Body annotation to help Camel know what to bind here from the Message from the Exchange being processed.</p>

<p>Of course this could be simplified a lot if you for instance just have a simple id generator. But we wanted to demonstrate that you can use the <a shape="rect" href="bean-binding.html">Bean Binding</a> annotations anywhere.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class MySimpleIdGenerator {

    public static int generate()  {
       // generate a unique id
       return 123;
   }
}
]]></script>
</div></div>

<p>And finally we just need to remember to have our bean registered in the Spring <a shape="rect" href="registry.html">Registry</a>:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
   &lt;bean id=&quot;myCorrelationIdGenerator&quot; class=&quot;com.mycompany.MySimpleIdGenerator&quot;/&gt;
]]></script>
</div></div>

<h4 id="BookInOnePage-Exampleusing">Example using <a shape="rect" href="groovy.html">Groovy</a></h4>
<p>In this example we have an Exchange that has a User object stored in the in header. This User object has methods to get some user information. We want to use <a shape="rect" href="groovy.html">Groovy</a> to inject an expression that extracts and concats the fullname of the user into the fullName parameter.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    public void doSomething(@Groovy(&quot;$request.header[&#39;user&#39;].firstName $request.header[&#39;user&#39;].familyName) String fullName, @Body String body) {
		// process the inbound message here
    }
]]></script>
</div></div>

<p>Groovy supports GStrings that is like a template where we can insert $ placeholders that will be evaluated by Groovy.</p>
<h2 id="BookInOnePage-BeanBinding">Bean Binding</h2><p>Bean Binding in Camel defines both which methods are invoked and also how the <a shape="rect" href="message.html">Message</a> is converted into the parameters of the method when it is invoked.</p><h3 id="BookInOnePage-Choosingthemethodtoinvoke">Choosing the method to invoke</h3><p>The binding of a Camel <a shape="rect" href="message.html">Message</a> to a bean method call can occur in different ways, in the following order of importance:</p><ul><li>if the message contains the header <strong>CamelBeanMethodName</strong> then that method is invoked, converting the body to the type of the method's argument.<ul><li>From <strong>Camel 2.8</strong> onwards you can qualify parameter types to select exactly which method to use among overloads with the same name (see below for more details).</li><li>From <strong>Camel 2.9</strong> onwards you can specify parameter values directly in the method option (see below for more details).</li></ul></li><li>you can explicitly specify the method name in the <a shape="rect" href="dsl.html">DSL</a> or when using <a shape="rect" href="pojo-consuming.html">POJO Consuming</a> or <a shape="rect" href="pojo-producing.html">POJO Producing</a></li><li>if the bean has a method marked with the <code>@Handler</code> annotation, then that method is selected</li><li>if the bean can be converted to a <a shape="rect" href="processor.html">Processor</a> using the <a shape="rect" href="type-converter.html">Type Converter</a> mechanism, then this is used to process the message. The <a shape="rect" href="activemq.html">ActiveMQ</a> component uses this mechanism to allow any JMS MessageListener to be invoked directly by Camel without having to write any integration glue code. You can use the same mechanism to integrate Camel into any other messaging/remoting frameworks.</li><li>if the body of the message can be converted to a <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/bean/BeanInvocation.html">BeanInvocation</a> (the default payload used by the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/bean/ProxyHelper.html">ProxyHelper</a>) component - then that is used to invoke the method and pass its arguments</li><li>otherwise the type of the body is used to find a matching method; an error is thrown if a single method cannot be chosen unambiguously.</li><li>you can also use Exchange as the parameter itself, but then the return type must be void.</li><li>if the bean class is private (or package-private), interface methods will be preferred (from <strong>Camel 2.9</strong> onwards) since Camel can't invoke class methods on such beans</li></ul><p>In cases where Camel cannot choose a method to invoke, an <code>AmbiguousMethodCallException</code> is thrown.</p><p>By default the return value is set on the outbound message body.&#160;</p><h3 id="BookInOnePage-Asynchronousprocessing">Asynchronous processing</h3><p>From&#160;<strong>Camel 2.18</strong>&#160;onwards you can return a CompletionStage implementation (e.g. a CompletableFuture) to implement asynchronous processing.</p><p>Please be sure to properly complete the CompletionStage with the result or exception, including any timeout handling. Exchange processing would wait for completion and would not impose any timeouts automatically. It's extremely useful to monitor&#160;<a shape="rect" class="external-link" href="https://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/spi/InflightRepository.html">Inflight repository</a> for any hanging messages.</p><p>Note that completing with "null" won't set outbody message body to null, but would keep message intact. This is useful to support methods that don't modify exchange and return CompletableFuture&lt;Void&gt;. To set body to null, just add Exchange method parameter and directly modify exchange messages.</p><p>Examples:</p><p>Simple asynchronous processor, modifying message body.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public CompletableFuture&lt;String&gt; doSomethingAsync(String body)]]></script>
</div></div><p>Composite processor that do not modify exchange</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public CompletableFuture&lt;Void&gt; doSomethingAsync(String body) {
	return CompletableFuture.allOf(doA(body), doB(body), doC());
}]]></script>
</div></div><h3 id="BookInOnePage-Parameterbinding">Parameter binding</h3><p>When a method has been chosen for invocation, Camel will bind to the parameters of the method.</p><p>The following Camel-specific types are automatically bound:</p><ul class="alternate"><li><code>org.apache.camel.Exchange</code></li><li><code>org.apache.camel.Message</code></li><li><code>org.apache.camel.CamelContext</code></li><li><code>org.apache.camel.TypeConverter</code></li><li><code>org.apache.camel.spi.Registry</code></li><li><code>java.lang.Exception</code></li></ul><p>So, if you declare any of these types, they will be provided by Camel. <strong>Note that <code>Exception</code> will bind to the caught exception of the <a shape="rect" href="exchange.html">Exchange</a></strong> - so it's often usable if you employ a <a shape="rect" href="pojo.html">Pojo</a> to handle, e.g., an <code>onException</code> route.</p><p>What is most interesting is that Camel will also try to bind the body of the <a shape="rect" href="exchange.html">Exchange</a> to the first parameter of the method signature (albeit not of any of the types above). So if, for instance, we declare a parameter as <code>String body</code>, then Camel will bind the IN body to this type. Camel will also automatically convert to the type declared in the method signature.</p><p>Let's review some examples:</p><p>Below is a simple method with a body binding. Camel will bind the IN body to the <code>body</code> parameter and convert it to a <code>String</code>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public String doSomething(String body)
]]></script>
</div></div><p>In the following sample we got one of the automatically-bound types as well - for instance, a <code>Registry</code> that we can use to lookup beans.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public String doSomething(String body, Registry registry)
]]></script>
</div></div><p>We can use <a shape="rect" href="exchange.html">Exchange</a> as well:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public String doSomething(String body, Exchange exchange)
]]></script>
</div></div><p>You can also have multiple types:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public String doSomething(String body, Exchange exchange, TypeConverter converter)
]]></script>
</div></div><p>And imagine you use a <a shape="rect" href="pojo.html">Pojo</a> to handle a given custom exception <code>InvalidOrderException</code> - we can then bind that as well:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public String badOrder(String body, InvalidOrderException invalid)
]]></script>
</div></div><p>Notice that we can bind to it even if we use a sub type of <code>java.lang.Exception</code> as Camel still knows it's an exception and can bind the cause (if any exists).</p><p>So what about headers and other stuff? Well now it gets a bit tricky - so we can use annotations to help us, or specify the binding in the method name option.<br clear="none"> See the following sections for more detail.</p><h3 id="BookInOnePage-BindingAnnotations">Binding Annotations</h3><p>You can use the <a shape="rect" href="parameter-binding-annotations.html">Parameter Binding Annotations</a> to customize how parameter values are created from the <a shape="rect" href="message.html">Message</a></p><h4 id="BookInOnePage-Examples">Examples</h4><p>For example, a <a shape="rect" href="bean.html">Bean</a> such as:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public class Bar {

    public String doSomething(String body) {
      // process the in body and return whatever you want
      return &quot;Bye World&quot;;
   }
]]></script>
</div></div><p>Or the Exchange example. Notice that the return type must be <strong>void</strong> when there is only a single parameter of the type <code>org.apache.camel.Exchange</code>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public class Bar {

    public void doSomething(Exchange exchange) {
      // process the exchange
      exchange.getIn().setBody(&quot;Bye World&quot;);
   }
]]></script>
</div></div><h4 id="BookInOnePage-@Handler">@Handler</h4><p>You can mark a method in your bean with the @Handler annotation to indicate that this method should be used for <a shape="rect" href="bean-binding.html">Bean Binding</a>.<br clear="none"> This has an advantage as you need not specify a method name in the Camel route, and therefore do not run into problems after renaming the method in an IDE that can't find all its references.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public class Bar {

    @Handler
    public String doSomething(String body) {
      // process the in body and return whatever you want
      return &quot;Bye World&quot;;
   }
]]></script>
</div></div><h3 id="BookInOnePage-Parameterbindingusingmethodoption">Parameter binding using method option</h3><p><strong>Available as of Camel 2.9</strong></p><p>Camel uses the following rules to determine if it's a parameter value in the method option</p><ul class="alternate"><li>The value is either <code>true</code> or <code>false</code> which denotes a boolean value</li><li>The value is a numeric value such as <code>123</code> or <code>7</code></li><li>The value is a String enclosed with either single or double quotes</li><li>The value is null which denotes a <code>null</code> value</li><li>It can be evaluated using the <a shape="rect" href="simple.html">Simple</a> language, which means you can use, e.g., body, header.foo and other <a shape="rect" href="simple.html">Simple</a> tokens. Notice the tokens must be enclosed with ${ }.</li></ul><p>Any other value is consider to be a type declaration instead - see the next section about specifying types for overloaded methods.</p><p>When invoking a <a shape="rect" href="bean.html">Bean</a> you can instruct Camel to invoke a specific method by providing the method name:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[   .bean(OrderService.class, &quot;doSomething&quot;)
]]></script>
</div></div><p>Here we tell Camel to invoke the doSomething method - Camel handles the parameters' binding. Now suppose the method has 2 parameters, and the 2nd parameter is a boolean where we want to pass in a true value:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public void doSomething(String payload, boolean highPriority) {
   ...
}
]]></script>
</div></div><p>This is now possible in <strong>Camel 2.9</strong> onwards:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[   .bean(OrderService.class, &quot;doSomething(*, true)&quot;)
]]></script>
</div></div><p>In the example above, we defined the first parameter using the wild card symbol *, which tells Camel to bind this parameter to any type, and let Camel figure this out. The 2nd parameter has a fixed value of <code>true</code>. Instead of the wildcard symbol we can instruct Camel to use the message body as shown:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[   .bean(OrderService.class, &quot;doSomething(${body}, true)&quot;)
]]></script>
</div></div><p>The syntax of the parameters is using the <a shape="rect" href="simple.html">Simple</a> expression language so we have to use ${ } placeholders in the body to refer to the message body.</p><p>If you want to pass in a <code>null</code> value, then you can explicit define this in the method option as shown below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[   .to(&quot;bean:orderService?method=doSomething(null, true)&quot;)
]]></script>
</div></div><p>Specifying <code>null</code> as a parameter value instructs Camel to force passing a <code>null</code> value.</p><p>Besides the message body, you can pass in the message headers as a <code>java.util.Map</code>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[   .bean(OrderService.class, &quot;doSomethingWithHeaders(${body}, ${headers})&quot;)
]]></script>
</div></div><p>You can also pass in other fixed values besides booleans. For example, you can pass in a String and an integer:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[   .bean(MyBean.class, &quot;echo(&#39;World&#39;, 5)&quot;)
]]></script>
</div></div><p>In the example above, we invoke the echo method with two parameters. The first has the content 'World' (without quotes), and the 2nd has the value of 5.<br clear="none"> Camel will automatically convert these values to the parameters' types.</p><p>Having the power of the <a shape="rect" href="simple.html">Simple</a> language allows us to bind to message headers and other values such as:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[   .bean(OrderService.class, &quot;doSomething(${body}, ${header.high})&quot;)
]]></script>
</div></div><p>You can also use the OGNL support of the <a shape="rect" href="simple.html">Simple</a> expression language. Now suppose the message body is an object which has a method named <code>asXml</code>. To invoke the <code>asXml</code> method we can do as follows:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[   .bean(OrderService.class, &quot;doSomething(${body.asXml}, ${header.high})&quot;)
]]></script>
</div></div><p>Instead of using <code>.bean</code> as shown in the examples above, you may want to use <code>.to</code> instead as shown:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[   .to(&quot;bean:orderService?method=doSomething(${body.asXml}, ${header.high})&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-Usingtypequalifierstoselectamongoverloadedmethods">Using type qualifiers to select among overloaded methods</h3><p><strong>Available as of Camel 2.8</strong></p><p>If you have a <a shape="rect" href="bean.html">Bean</a> with overloaded methods, you can now specify parameter types in the method name so Camel can match the method you intend to use.<br clear="none"> Given the following bean:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>MyBean</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public static final class MyBean {

    public String hello(String name) {
        return &quot;Hello &quot; + name;
    }

    public String hello(String name, @Header(&quot;country&quot;) String country) {
        return &quot;Hello &quot; + name + &quot; you are from &quot; + country;
    }

    public String times(String name, @Header(&quot;times&quot;) int times) {
        StringBuilder sb = new StringBuilder();
        for (int i = 0; i &lt; times; i++) {
            sb.append(name);
        }
        return sb.toString();
    }

    public String times(byte[] data, @Header(&quot;times&quot;) int times) {
        String s = new String(data);
        StringBuilder sb = new StringBuilder();
        for (int i = 0; i &lt; times; i++) {
            sb.append(s);
            if (i &lt; times - 1) {
                sb.append(&quot;,&quot;);
            }
        }
        return sb.toString();
    }

    public String times(String name, int times, char separator) {
        StringBuilder sb = new StringBuilder();
        for (int i = 0; i &lt; times; i++) {
            sb.append(name);
            if (i &lt; times - 1) {
                sb.append(separator);
            }
        }
        return sb.toString();
    }

}
]]></script>
</div></div>Then the <code>MyBean</code> has 2 overloaded methods with the names <code>hello</code> and <code>times</code>. So if we want to use the method which has 2 parameters we can do as follows in the Camel route:<div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Invoke 2 parameter method</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;direct:start&quot;)
    .bean(MyBean.class, &quot;hello(String,String)&quot;)
    .to(&quot;mock:result&quot;);
]]></script>
</div></div>We can also use a <code>*</code> as wildcard so we can just say we want to execute the method with 2 parameters we do<div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Invoke 2 parameter method using wildcard</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;direct:start&quot;)
    .bean(MyBean.class, &quot;hello(*,*)&quot;)
    .to(&quot;mock:result&quot;);
]]></script>
</div></div>By default Camel will match the type name using the simple name, e.g. any leading package name will be disregarded. However if you want to match using the FQN, then specify the FQN type and Camel will leverage that. So if you have a <code>com.foo.MyOrder</code> and you want to match against the FQN, and <strong>not</strong> the simple name "MyOrder", then follow this example:<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[   .bean(OrderService.class, &quot;doSomething(com.foo.MyOrder)&quot;)
]]></script>
</div></div><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Camel currently only supports either specifying parameter binding or type per parameter in the method name option. You <strong>cannot</strong> specify both at the same time, such as</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[doSomething(com.foo.MyOrder ${body}, boolean ${header.high})
]]></script>
</div></div><p>This may change in the future.</p></div></div>
<h3 id="BookInOnePage-BeanInjection">Bean Injection</h3>

<p>We support the injection of various resources using @EndpointInject or @BeanInject. This can be used to inject</p>

<ul><li><a shape="rect" href="endpoint.html">Endpoint</a> instances which can be used for testing when used with <a shape="rect" href="mock.html">Mock</a> endpoints; see the <a shape="rect" href="spring-testing.html">Spring Testing</a> for an example.</li><li><a shape="rect" href="producertemplate.html">ProducerTemplate</a> instances for <a shape="rect" href="pojo-producing.html">POJO Producing</a></li><li>client side proxies for <a shape="rect" href="pojo-producing.html">POJO Producing</a> which is a simple approach to <a shape="rect" href="spring-remoting.html">Spring Remoting</a></li></ul>


<h4 id="BookInOnePage-Using@BeanInject">Using @BeanInject</h4>

<p>From <strong>Camel 2.13</strong> onwards you can inject beans (obtained from the <a shape="rect" href="registry.html">Registry</a>) into your beans such as <code>RouteBuilder</code> classes. </p>

<p>For example to inject a bean named foo, you can enlist the bean in the <a shape="rect" href="registry.html">Registry</a> such as in a Spring XML file:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;bean id=&quot;foo&quot; class=&quot;com.foo.MyFooBean&quot;/&gt;
]]></script>
</div></div>

<p>And then in a Java <code>RouteBuilder</code> class, you can inject the bean using <code>@BeanInject</code> as shown below:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class MyRouteBuilder extends RouteBuilder {

   @BeanInject(&quot;foo&quot;)
   MyFooBean foo;

   public void configure() throws Exception {
     ..
   }
}
]]></script>
</div></div>

<p>If you omit the name, then Camel does a lookup by type, and injects the bean if there is exactly only one bean of that type enlisted in the <a shape="rect" href="registry.html">Registry</a>.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
   @BeanInject
   MyFooBean foo;
]]></script>
</div></div>
<h3 id="BookInOnePage-ParameterBindingAnnotations">Parameter Binding Annotations</h3>

<div class="confluence-information-macro confluence-information-macro-information"><p class="title">camel-core</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>The annotations below are all part of <strong>camel-core</strong> and thus does not require <strong>camel-spring</strong> or <a shape="rect" href="spring.html">Spring</a>. These annotations can be used with the <a shape="rect" href="bean.html">Bean</a> component or when invoking beans in the <a shape="rect" href="dsl.html">DSL</a></p></div></div>

<p>Annotations can be used to define an <a shape="rect" href="expression.html">Expression</a> or to extract various headers, properties or payloads from a <a shape="rect" href="message.html">Message</a> when invoking a bean method (see <a shape="rect" href="bean-integration.html">Bean Integration</a> for more detail of how to invoke bean methods) together with being useful to help disambiguate which method to invoke.</p>

<p>If no annotations are used then Camel assumes that a single parameter is the body of the message. Camel will then use the <a shape="rect" href="type-converter.html">Type Converter</a> mechanism to convert from the expression value to the actual type of the parameter.</p>

<p>The core annotations are as follows</p>

<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Annotation </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Meaning </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Parameter </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Body.html">@Body</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> To bind to an inbound message body </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/ExchangeException.html">@ExchangeException</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> To bind to an Exception set on the exchange </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Header.html">@Header</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> To bind to an inbound message header </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> String name of the header </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Headers.html">@Headers</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> To bind to the Map of the inbound message headers </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/OutHeaders.html">@OutHeaders</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> To bind to the Map of the outbound message headers </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Property.html">@Property</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> To bind to a named property on the exchange </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> String name of the property </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Properties.html">@Properties</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> To bind to the property map on the exchange </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Handler.html">@Handler</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Not part as a type parameter but stated in this table anyway to spread the good word that we have this annotation in Camel now. See more at <a shape="rect" href="bean-binding.html">Bean Binding</a>. </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr></tbody></table></div>


<p>The follow annotations <code>@Headers</code>, <code>@OutHeaders</code> and <code>@Properties</code> binds to the backing <code>java.util.Map</code> so you can alter the content of these maps directly, for instance using the <code>put</code> method to add a new entry. See the OrderService class at <a shape="rect" href="exception-clause.html">Exception Clause</a> for such an example. You can use <code>@Header("myHeader")</code> and <code>@Property("myProperty")</code> to access the backing <code>java.util.Map</code>.</p>

<h3 id="BookInOnePage-Example">Example</h3>
<p>In this example below we have a @Consume consumer (like message driven) that consumes JMS messages from the activemq queue. We use the @Header and @Body parameter binding annotations to bind from the JMSMessage to the method parameters.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class Foo {
	
    @Consume(uri = &quot;activemq:my.queue&quot;)
    public void doSomething(@Header(&quot;JMSCorrelationID&quot;) String correlationID, @Body String body) {
		// process the inbound message here
    }

}
]]></script>
</div></div>

<p>In the above Camel will extract the value of Message.getJMSCorrelationID(), then using the <a shape="rect" href="type-converter.html">Type Converter</a> to adapt the value to the type of the parameter if required - it will inject the parameter value for the <strong>correlationID</strong> parameter. Then the payload of the message will be converted to a String and injected into the <strong>body</strong> parameter.</p>

<p>You don't necessarily need to use the @Consume annotation if you don't want to as you could also make use of the Camel <a shape="rect" href="dsl.html">DSL</a> to route to the bean's method as well.</p>

<h4 id="BookInOnePage-UsingtheDSLtoinvokethebeanmethod">Using the DSL to invoke the bean method</h4>

<p>Here is another example which does not use <a shape="rect" href="pojo-consuming.html">POJO Consuming</a> annotations but instead uses the <a shape="rect" href="dsl.html">DSL</a> to route messages to the bean method</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class Foo {
    public void doSomething(@Header(&quot;JMSCorrelationID&quot;) String correlationID, @Body String body) {
		// process the inbound message here
    }

}
]]></script>
</div></div>

<p>The routing DSL then looks like this</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;activemq:someQueue&quot;).
  to(&quot;bean:myBean&quot;);
]]></script>
</div></div>

<p>Here <strong>myBean</strong> would be looked up in the <a shape="rect" href="registry.html">Registry</a> (such as JNDI or the Spring ApplicationContext), then the body of the message would be used to try figure out what method to call.</p>

<p>If you want to be explicit you can use</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;activemq:someQueue&quot;).
  to(&quot;bean:myBean?methodName=doSomething&quot;);
]]></script>
</div></div>

<p>And here we have a nifty example for you to show some great power in Camel. You can mix and match the annotations with the normal parameters, so we can have this example with annotations and the Exchange also:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    public void doSomething(@Header(&quot;user&quot;) String user, @Body String body, Exchange exchange) {
        exchange.getIn().setBody(body + &quot;MyBean&quot;);
    }
]]></script>
</div></div>

<h3 id="BookInOnePage-AnnotationBasedExpressionLanguage.1">Annotation Based Expression Language</h3>

<p>You can also use any of the <a shape="rect" href="languages.html">Languages</a> supported in Camel to bind expressions to method parameters when using <a shape="rect" href="bean-integration.html">Bean Integration</a>. For example you can use any of these annotations:</p>

<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Annotation</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/language/Bean.html">@Bean</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="bean.html">Bean</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-script/apidocs/org/apache/camel/builder/script/BeanShell.html">@BeanShell</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="beanshell.html">BeanShell</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/language/Constant.html">@Constant</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="constant.html">Constant</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-juel/apidocs/org/apache/camel/language/juel/EL.html">@EL</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject an <a shape="rect" href="el.html">EL</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-script/apidocs/org/apache/camel/builder/script/Groovy.html">@Groovy</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="groovy.html">Groovy</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/maven/camel-core/apidocs/org/apache/camel/Header.html">@Header</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="header.html">Header</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-script/apidocs/org/apache/camel/builder/script/JavaScript.html">@JavaScript</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="javascript.html">JavaScript</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-mvel/apidocs/org/apache/camel/language/mvel/MVEL.html">@MVEL</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="mvel.html">MVEL</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-ognl/apidocs/org/apache/camel/language/ognl/OGNL.html">@OGNL</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject an <a shape="rect" href="ognl.html">OGNL</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-script/apidocs/org/apache/camel/builder/script/PHP.html">@PHP</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="php.html">PHP</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-script/apidocs/org/apache/camel/builder/script/Python.html">@Python</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="python.html">Python</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-script/apidocs/org/apache/camel/builder/script/Ruby.html">@Ruby</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject a <a shape="rect" href="ruby.html">Ruby</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/language/Simple.html">@Simple</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject an <a shape="rect" href="simple.html">Simple</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/language/XPath.html">@XPath</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject an <a shape="rect" href="xpath.html">XPath</a> expression </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-saxon/apidocs/org/apache/camel/component/xquery/XQuery.html">@XQuery</a> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Inject an <a shape="rect" href="xquery.html">XQuery</a> expression </p></td></tr></tbody></table></div>


<h4 id="BookInOnePage-Example:.1">Example:</h4>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class Foo {
	
    @MessageDriven(uri = &quot;activemq:my.queue&quot;)
    public void doSomething(@XPath(&quot;/foo/bar/text()&quot;) String correlationID, @Body String body) {
		// process the inbound message here
    }
}
]]></script>
</div></div>

<h4 id="BookInOnePage-Advancedexampleusing@Bean.1">Advanced example using @Bean</h4>

<p>And an example of using the the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/language/Bean.html">@Bean</a> binding annotation, where you can use a <a shape="rect" href="pojo.html">POJO</a> where you can do whatever java code you like:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class Foo {
	
    @MessageDriven(uri = &quot;activemq:my.queue&quot;)
    public void doSomething(@Bean(&quot;myCorrelationIdGenerator&quot;) String correlationID, @Body String body) {
		// process the inbound message here
    }
}
]]></script>
</div></div>

<p>And then we can have a spring bean with the id <strong>myCorrelationIdGenerator</strong> where we can compute the id.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class MyIdGenerator {

    private UserManager userManager;

    public String generate(@Header(name = &quot;user&quot;) String user, @Body String payload) throws Exception {
       User user = userManager.lookupUser(user);
       String userId = user.getPrimaryId();
       String id = userId + generateHashCodeForPayload(payload);
       return id;
   }
}
]]></script>
</div></div>

<p>The <a shape="rect" href="pojo.html">POJO</a> MyIdGenerator has one public method that accepts two parameters. However we have also annotated this one with the @Header and @Body annotation to help Camel know what to bind here from the Message from the Exchange being processed.</p>

<p>Of course this could be simplified a lot if you for instance just have a simple id generator. But we wanted to demonstrate that you can use the <a shape="rect" href="bean-binding.html">Bean Binding</a> annotations anywhere.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class MySimpleIdGenerator {

    public static int generate()  {
       // generate a unique id
       return 123;
   }
}
]]></script>
</div></div>

<p>And finally we just need to remember to have our bean registered in the Spring <a shape="rect" href="registry.html">Registry</a>:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
   &lt;bean id=&quot;myCorrelationIdGenerator&quot; class=&quot;com.mycompany.MySimpleIdGenerator&quot;/&gt;
]]></script>
</div></div>

<h4 id="BookInOnePage-Exampleusing.1">Example using <a shape="rect" href="groovy.html">Groovy</a></h4>
<p>In this example we have an Exchange that has a User object stored in the in header. This User object has methods to get some user information. We want to use <a shape="rect" href="groovy.html">Groovy</a> to inject an expression that extracts and concats the fullname of the user into the fullName parameter.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    public void doSomething(@Groovy(&quot;$request.header[&#39;user&#39;].firstName $request.header[&#39;user&#39;].familyName) String fullName, @Body String body) {
		// process the inbound message here
    }
]]></script>
</div></div>

<p>Groovy supports GStrings that is like a template where we can insert $ placeholders that will be evaluated by Groovy.</p>
<h4 id="BookInOnePage-@Consume">@Consume</h4>

<p>To consume a message you use the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Consume.html">@Consume</a> annotation to mark a particular method of a bean as being a consumer method. The uri of the annotation defines the Camel <a shape="rect" href="endpoint.html">Endpoint</a> to consume from. </p>

<p>e.g. lets invoke the <code>onCheese()</code> method with the String body of the inbound JMS message from <a shape="rect" href="activemq.html">ActiveMQ</a> on the cheese queue; this will use the <a shape="rect" href="type-converter.html">Type Converter</a> to convert the JMS ObjectMessage or BytesMessage to a String - or just use a TextMessage from JMS</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class Foo {

  @Consume(uri=&quot;activemq:cheese&quot;)
  public void onCheese(String name) {
    ...
  }
}
]]></script>
</div></div>

<p>The <a shape="rect" href="bean-binding.html">Bean Binding</a> is then used to convert the inbound <a shape="rect" href="message.html">Message</a> to the parameter list used to invoke the method .</p>

<p>What this does is basically create a route that looks kinda like this</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(uri).bean(theBean, &quot;methodName&quot;);
]]></script>
</div></div>

<div class="confluence-information-macro confluence-information-macro-warning"><p class="title">When using more than one CamelContext</p><span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>When you use more than 1 <a shape="rect" href="camelcontext.html">CamelContext</a> you might end up with each of them creating a <a shape="rect" href="pojo-consuming.html">POJO Consuming</a>; therefore use the option <code>context</code> on <strong>@Consume</strong> that allows you to specify which <a shape="rect" href="camelcontext.html">CamelContext</a> id/name you want it to apply for.</p></div></div>

<h3 id="BookInOnePage-UsingcontextoptiontoapplyonlyacertainCamelContext">Using context option to apply only a certain CamelContext</h3>
<p>See the warning above.</p>

<p>You can use the <code>context</code> option to specify which <a shape="rect" href="camelcontext.html">CamelContext</a> the consumer should only apply for. For example:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
  @Consume(uri=&quot;activemq:cheese&quot;, context=&quot;camel-1&quot;)
  public void onCheese(String name) {
]]></script>
</div></div>

<p>The consumer above will only be created for the <a shape="rect" href="camelcontext.html">CamelContext</a> that have the context id = <code>camel-1</code>. You set this id in the XML tag:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;camelContext id=&quot;camel-1&quot; ...&gt;
]]></script>
</div></div>

<h4 id="BookInOnePage-Usinganexplicitroute">Using an explicit route</h4>

<p>If you want to invoke a bean method from many different endpoints or within different complex routes in different circumstances you can just use the normal routing <a shape="rect" href="dsl.html">DSL</a> or the <a shape="rect" href="spring.html">Spring</a> XML configuration file.</p>

<p>For example</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(uri).beanRef(&quot;myBean&quot;, &quot;methodName&quot;);
]]></script>
</div></div>


<p>which will then look up in the <a shape="rect" href="registry.html">Registry</a> and find the bean and invoke the given bean name. (You can omit the method name and have Camel figure out the right method based on the method annotations and body type).</p>

<h4 id="BookInOnePage-UsetheBeanendpoint">Use the Bean endpoint</h4>

<p>You can always use the bean endpoint</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(uri).to(&quot;bean:myBean?method=methodName&quot;);
]]></script>
</div></div>


<h4 id="BookInOnePage-Usingapropertytodefinetheendpoint">Using a property to define the endpoint</h4>
<p><strong>Available as of Camel 2.11</strong></p>

<p>The following annotations @Consume, @Produce, @EndpointInject, now offers a <code>property</code> attribute you can use to define the endpoint as a property on the bean. Then Camel will use the getter method to access the property. </p>

<div class="confluence-information-macro confluence-information-macro-information"><p class="title">This applies for them all</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>The explanation below applies for all the three annotations, eg @Consume, @Produce, and @EndpointInject</p></div></div>

<p>For example</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class MyService {
  private String serviceEndpoint;
  
  public void setServiceEndpoint(String uri) {
     this.serviceEndpoint = uri;
  }

  public String getServiceEndpoint() {
     return serviceEndpoint
  }

  @Consume(property = &quot;serviceEndpoint&quot;)
  public void onService(String input) {
     ...
  }
}
]]></script>
</div></div>

<p>The bean <code>MyService</code> has a property named <code>serviceEndpoint</code> which has getter/setter for the property. Now we want to use the bean for <a shape="rect" href="pojo-consuming.html">POJO Consuming</a>, and hence why we use @Consume in the onService method. Notice how we use the <code>property = "serviceEndpoint</code> to configure the property that has the endpoint url.</p>

<p>If you define the bean in Spring XML or Blueprint, then you can configure the property as follows:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;bean id=&quot;myService&quot; class=&quot;com.foo.MyService&quot;&gt;
  &lt;property name=&quot;serviceEndpoint&quot; value=&quot;activemq:queue:foo&quot;/&gt;
&lt;/bean&gt;
]]></script>
</div></div>

<p>This allows you to configure the bean using any standard IoC style.</p>

<p>Camel offers a naming convention which allows you to not have to explicit name the property.<br clear="none">
Camel uses this algorithm to find the getter method. The method must be a getXXX method.</p>

<p>1. Use the property name if explicit given<br clear="none">
2. If no property name was configured, then use the method name<br clear="none">
3. Try to get the property with name*Endpoint* (eg with Endpoint as postfix)<br clear="none">
4. Try to get the property with the name as is (eg no postfix or postfix)<br clear="none">
5. If the property name starts with <strong>on</strong> then omit that, and try step 3 and 4 again.</p>

<p>So in the example above, we could have defined the @Consume annotation as</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
  @Consume(property = &quot;service&quot;)
  public void onService(String input) {
]]></script>
</div></div>

<p>Now the property is named 'service' which then would match step 3 from the algorithm, and have Camel invoke the getServiceEndpoint method.</p>

<p>We could also have omitted the property attribute, to make it implicit</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
  @Consume
  public void onService(String input) {
]]></script>
</div></div>

<p>Now Camel matches step 5, and loses the prefix <strong>on</strong> in the name, and looks for 'service' as the property. And because there is a getServiceEndpoint method, Camel will use that.</p>



<h4 id="BookInOnePage-Whichapproachtouse?">Which approach to use?</h4>

<p>Using the @Consume annotations are simpler when you are creating a simple route with a single well defined input URI. </p>

<p>However if you require more complex routes or the same bean method needs to be invoked from many places then please use the routing <a shape="rect" href="dsl.html">DSL</a> as shown above.</p>
There are two different ways to send messages to any Camel <a shape="rect" href="endpoint.html">Endpoint</a> from a POJO

<h4 id="BookInOnePage-@EndpointInject">@EndpointInject</h4>

<p>To allow sending of messages from POJOs you can use the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/EndpointInject.html">@EndpointInject</a> annotation. This will inject a <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/ProducerTemplate.html">ProducerTemplate</a> so that the bean can participate in message exchanges.</p>

<p>e.g. lets send a message to the <strong>foo.bar</strong> queue in <a shape="rect" href="activemq.html">ActiveMQ</a> at some point</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[

public class Foo {
  @EndpointInject(uri=&quot;activemq:foo.bar&quot;)
  ProducerTemplate producer;

  public void doSomething() {
    if (whatever) {
      producer.sendBody(&quot;&lt;hello&gt;world!&lt;/hello&gt;&quot;);
    }
  }
}
]]></script>
</div></div>

<p>The downside of this is that your code is now dependent on a Camel API, the ProducerTemplate. The next section describes how to remove this</p>

<div class="confluence-information-macro confluence-information-macro-tip"><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>See <a shape="rect" href="pojo-consuming.html">POJO Consuming</a> for how to use a property on the bean as endpoint configuration, eg using the <code>property</code> attribute on @Produce, @EndpointInject.</p></div></div>

<h3 id="BookInOnePage-HidingtheCamelAPIsfromyourcodeusing@Produce">Hiding the Camel APIs from your code using @Produce</h3>

<p>We recommend <a shape="rect" href="hiding-middleware.html">Hiding Middleware</a> APIs from your application code so the next option might be more suitable.<br clear="none">
 You can add the @Produce annotation to an injection point (a field or property setter) using a ProducerTemplate <strong>or</strong> using some interface you use in your business logic. e.g.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public interface MyListener {
    String sayHello(String name);
}

public class MyBean {
    @Produce(uri = &quot;activemq:foo&quot;)
    protected MyListener producer;

    public void doSomething() {
        // lets send a message
        String response = producer.sayHello(&quot;James&quot;);
    }
}
]]></script>
</div></div>

<p>Here Camel will automatically inject a smart client side proxy at the @Produce annotation - an instance of the MyListener instance. When we invoke methods on this interface the method call is turned into an object and using the Camel <a shape="rect" href="spring-remoting.html">Spring Remoting</a> mechanism it is sent to the endpoint - in this case the <a shape="rect" href="activemq.html">ActiveMQ</a> endpoint to queue <strong>foo</strong>; then the caller blocks for a response.</p>

<p>If you want to make asynchronous message sends then use <a shape="rect" href="using-exchange-pattern-annotations.html">an @InOnly annotation on the injection point</a>.</p>
<h2 id="BookInOnePage-@RecipientListAnnotation">@RecipientList Annotation</h2>

<p>We support the use of @RecipientList on a bean method to easily create a dynamic <a shape="rect" href="recipient-list.html">Recipient List</a> using a Java method.</p>

<h3 id="BookInOnePage-SimpleExampleusing@Consumeand@RecipientList">Simple Example using @Consume and @RecipientList</h3>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
package com.acme.foo;

public class RouterBean {

    @Consume(uri = &quot;activemq:foo&quot;)
    @RecipientList
    public String[] route(String body) {
        return new String[]{&quot;activemq:bar&quot;, &quot;activemq:whatnot&quot;};
    }
}
]]></script>
</div></div>

<p>For example if the above bean is configured in <a shape="rect" href="spring.html">Spring</a> when using a <strong>&lt;camelContext&gt;</strong> element as follows</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd
    &quot;&gt;

  &lt;camelContext xmlns=&quot;http://activemq.apache.org/camel/schema/spring&quot;/&gt;

  &lt;bean id=&quot;myRecipientList&quot; class=&quot;com.acme.foo.RouterBean&quot;/&gt;

&lt;/beans&gt;
]]></script>
</div></div>

<p>then a route will be created consuming from the <strong>foo</strong> queue on the <a shape="rect" href="activemq.html">ActiveMQ</a> component which when a message is received the message will be forwarded to the endpoints defined by the result of this method call - namely the <strong>bar</strong> and <strong>whatnot</strong> queues.</p>

<h3 id="BookInOnePage-Howitworks">How it works</h3>

<p>The return value of the @RecipientList method is  converted to either a java.util.Collection / java.util.Iterator or array of objects where each element is converted to an <a shape="rect" href="endpoint.html">Endpoint</a> or a String, or if you are only going to route to a single endpoint then just return either an Endpoint object or an object that can be converted to a String. So the following methods are all valid </p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
@RecipientList 
public String[] route(String body) { ... }

@RecipientList 
public List&lt;String&gt; route(String body) { ... }

@RecipientList 
public Endpoint route(String body) { ... }

@RecipientList 
public Endpoint[] route(String body) { ... }

@RecipientList 
public Collection&lt;Endpoint&gt; route(String body) { ... }

@RecipientList 
public URI route(String body) { ... }

@RecipientList 
public URI[] route(String body) { ... }
]]></script>
</div></div>

<p>Then for each endpoint or URI the message is forwarded a separate copy to that endpoint. </p>

<p>You can then use whatever Java code you wish to figure out what endpoints to route to; for example you can use the <a shape="rect" href="bean-binding.html">Bean Binding</a> annotations to inject parts of the message body or headers or use <a shape="rect" href="expression.html">Expression</a> values on the message.</p>

<h3 id="BookInOnePage-MoreComplexExampleUsingDSL">More Complex Example Using DSL</h3>

<p>In this example we will use more complex <a shape="rect" href="bean-binding.html">Bean Binding</a>, plus we will use a separate route to invoke the <a shape="rect" href="recipient-list.html">Recipient List</a></p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class RouterBean2 {

    @RecipientList
    public String route(@Header(&quot;customerID&quot;) String custID String body) {
    	if (custID == null)  return null;
        return &quot;activemq:Customers.Orders.&quot; + custID;
    }
}

public class MyRouteBuilder extends RouteBuilder {
    protected void configure() {
        from(&quot;activemq:Orders.Incoming&quot;).recipientList(bean(&quot;myRouterBean&quot;, &quot;route&quot;));
    }
}
]]></script>
</div></div>


<p>Notice how we are injecting some headers or expressions and using them to determine the recipients using <a shape="rect" href="recipient-list.html">Recipient List</a> EIP.<br clear="none">
See the <a shape="rect" href="bean-integration.html">Bean Integration</a> for more details.</p>
<h2 id="BookInOnePage-UsingExchangePatternAnnotations">Using Exchange Pattern Annotations</h2>

<p>When working with <a shape="rect" href="pojo-producing.html">POJO Producing</a> or <a shape="rect" href="spring-remoting.html">Spring Remoting</a> you invoke methods which typically by default are InOut for <a shape="rect" href="request-reply.html">Request Reply</a>. That is there is an In message and an Out for the result. Typically invoking this operation will be synchronous, the caller will block until the server returns a result.</p>

<p>Camel has flexible <a shape="rect" href="exchange-pattern.html">Exchange Pattern</a> support - so you can also support the <a shape="rect" href="event-message.html">Event Message</a> pattern to use InOnly for asynchronous or one way operations. These are often called 'fire and forget' like sending a JMS message but not waiting for any response.</p>

<p>From 1.5 onwards Camel supports annotations for specifying the message exchange pattern on regular Java methods, classes or interfaces.</p>

<h3 id="BookInOnePage-SpecifyingInOnlymethods">Specifying InOnly methods</h3>

<p>Typically the default InOut is what most folks want but you can customize to use InOnly using an annotation.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public interface Foo {
  Object someInOutMethod(String input);
  String anotherInOutMethod(Cheese input);
  
  @InOnly
  void someInOnlyMethod(Document input);
}
]]></script>
</div></div>

<p>The above code shows three methods on an interface; the first two use the default InOut mechanism but the <strong>someInOnlyMethod</strong> uses the InOnly annotation to specify it as being a oneway method call.</p>

<h3 id="BookInOnePage-Classlevelannotations">Class level annotations</h3>

<p>You can also use class level annotations to default all methods in an interface to some pattern such as</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
@InOnly
public interface Foo {
  void someInOnlyMethod(Document input);
  void anotherInOnlyMethod(String input);
}
]]></script>
</div></div>

<p>Annotations will also be detected on base classes or interfaces. So for example if you created a client side proxy for </p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class MyFoo implements Foo {
  ...
}
]]></script>
</div></div>

<p>Then the methods inherited from Foo would be InOnly.</p>

<h3 id="BookInOnePage-Overloadingaclasslevelannotation">Overloading a class level annotation</h3>

<p>You can overload a class level annotation on specific methods. A common use case for this is if you have a class or interface with many InOnly methods but you want to just annote one or two methods as InOut</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
@InOnly
public interface Foo {
  void someInOnlyMethod(Document input);
  void anotherInOnlyMethod(String input);
  
  @InOut
  String someInOutMethod(String input); 
}
]]></script>
</div></div>

<p>In the above Foo interface the <strong>someInOutMethod</strong> will be InOut</p>

<h3 id="BookInOnePage-Usingyourownannotations">Using your own annotations</h3>

<p>You might want to create your own annotations to represent a group of different bits of metadata; such as combining synchrony, concurrency and transaction behaviour.</p>

<p>So you could annotate your annotation with the @Pattern annotation to default the exchange pattern you wish to use.</p>

<p>For example lets say we want to create our own annotation called @MyAsyncService</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.TYPE, ElementType.METHOD})

// lets add the message exchange pattern to it
@Pattern(ExchangePattern.InOnly)

// lets add some other annotations - maybe transaction behaviour?

public @interface MyAsyncService {
}
]]></script>
</div></div>

<p>Now we can use this annotation and Camel will figure out the correct exchange pattern...</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public interface Foo {
  void someInOnlyMethod(Document input);
  void anotherInOnlyMethod(String input);
  
  @MyAsyncService
  String someInOutMethod(String input); 
}
]]></script>
</div></div>
When writing software these days, its important to try and decouple as much middleware code from your business logic as possible. 

<p>This provides a number of benefits...</p>
<ul><li>you can choose the right middleware solution for your deployment and switch at any time</li><li>you don't have to spend a large amount of time learning the specifics of any particular technology, whether its <a shape="rect" href="jms.html">JMS</a> or <a shape="rect" href="javaspace.html">JavaSpace</a> or <a shape="rect" href="hibernate.html">Hibernate</a> or <a shape="rect" href="jpa.html">JPA</a> or <a shape="rect" href="ibatis.html">iBatis</a> whatever</li></ul>


<p>For example if you want to implement some kind of message passing, remoting, reliable load balancing or asynchronous processing in your application we recommend you use Camel annotations to bind your services and business logic to Camel <a shape="rect" href="components.html">Components</a> which means you can then easily switch between things like</p>
<ul><li>in JVM messaging with <a shape="rect" href="seda.html">SEDA</a></li><li>using JMS via <a shape="rect" href="activemq.html">ActiveMQ</a> or other <a shape="rect" href="jms.html">JMS</a> providers for reliable load balancing, grid or publish and subscribe</li><li>for low volume, but easier administration since you're probably already using a database you could use
	<ul><li><a shape="rect" href="hibernate.html">Hibernate</a> or <a shape="rect" href="jpa.html">JPA</a> to use an entity bean / table as a queue</li><li><a shape="rect" href="ibatis.html">iBatis</a> to work with SQL</li><li><a shape="rect" href="jdbc.html">JDBC</a> for raw SQL access</li></ul>
	</li><li>use <a shape="rect" href="javaspace.html">JavaSpace</a></li></ul>


<h3 id="BookInOnePage-HowtodecouplefrommiddlewareAPIs">How to decouple from middleware APIs</h3>

<p>The best approach when using remoting is to use <a shape="rect" href="spring-remoting.html">Spring Remoting</a> which can then use any messaging or remoting technology under the covers. When using Camel's implementation you can then use any of the Camel <a shape="rect" href="components.html">Components</a> along with any of the <a shape="rect" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a>.</p>

<p>Another approach is to bind Java beans to Camel endpoints via the <a shape="rect" href="bean-integration.html">Bean Integration</a>. For example using <a shape="rect" href="pojo-consuming.html">POJO Consuming</a> and <a shape="rect" href="pojo-producing.html">POJO Producing</a> you can avoid using any Camel APIs to decouple your code both from middleware APIs <em>and</em> Camel APIs! <img class="emoticon emoticon-smile" src="https://cwiki.apache.org/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/icons/emoticons/smile.png" data-emoticon-name="smile" alt="(smile)"></p>
<h2 id="BookInOnePage-Visualisation">Visualisation</h2><div class="confluence-information-macro confluence-information-macro-warning"><span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>This functionality is deprecated and to be removed in future Camel releases.</p></div></div><p>&#160;</p><p>Camel supports the visualisation of your <a shape="rect" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a> using the <a shape="rect" class="external-link" href="http://graphviz.org" rel="nofollow">GraphViz</a> DOT files which can either be rendered directly via a suitable GraphViz tool or turned into HTML, PNG or SVG files via the <a shape="rect" href="camel-maven-plugin.html">Camel Maven Plugin</a>.</p><p>Here is a <a shape="rect" class="external-link" href="http://activemq.apache.org/camel/maven/camel-spring/cameldoc/index.html">typical example</a> of the kind of thing we can generate</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="book-in-one-page.data/org.apache.camel.example.docs.ContentBasedRouteRoute.png" data-image-src="/confluence/download/attachments/64021/org.apache.camel.example.docs.ContentBasedRouteRoute.png?version=1&amp;modificationDate=1229506014000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="9437" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="org.apache.camel.example.docs.ContentBasedRouteRoute.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="64021" data-linked-resource-container-version="18"></span></p><p>If you click on <a shape="rect" class="external-link" href="http://activemq.apache.org/camel/maven/examples/camel-example-docs/cameldoc/main/routes.html">the actual generated html</a>you will see that you can navigate from an EIP node to its pattern page, along with getting hover-over tool tips ec.</p><h3 id="BookInOnePage-Howtogenerate">How to generate</h3><p>See <a shape="rect" href="camel-dot-maven-goal.html">Camel Dot Maven Goal</a> or the other maven goals <a shape="rect" href="camel-maven-plugin.html">Camel Maven Plugin</a></p><h3 id="BookInOnePage-ForOSXusers">For OS X users</h3><p>If you are using OS X then you can open the DOT file using <a shape="rect" class="external-link" href="http://www.pixelglow.com/graphviz/" rel="nofollow">graphviz</a> which will then automatically re-render if it changes, so you end up with a real time graphical representation of the topic and queue hierarchies!</p><p>Also if you want to edit the layout a little before adding it to a wiki to distribute to your team, open the DOT file with <a shape="rect" class="external-link" href="http://www.omnigroup.com/applications/omnigraffle/" rel="nofollow">OmniGraffle</a> then just edit away <img class="emoticon emoticon-smile" src="https://cwiki.apache.org/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/icons/emoticons/smile.png" data-emoticon-name="smile" alt="(smile)"></p>
<h2 id="BookInOnePage-BusinessActivityMonitoring">Business Activity Monitoring </h2>

<p>The <strong>Camel BAM</strong> module provides a Business Activity Monitoring (BAM) framework for testing business processes across multiple message exchanges on different <a shape="rect" href="endpoint.html">Endpoint</a> instances.</p>

<p>Consider, for example, a simple system in which you submit Purchase Orders into system A and then receive Invoices from system B.  You might want to test that, for a given Purchase Order, you receive a matching Invoice from system B within a specific time period.</p>

<h3 id="BookInOnePage-HowCamelBAMWorks">How Camel BAM Works</h3>

<p>Camel BAM uses a <a shape="rect" href="correlation-identifier.html">Correlation Identifier</a> on an input message to determine the <em>Process Instance</em> to which it belongs. The process instance is an entity bean which can maintain state for each <em>Activity</em> (where an activity typically maps to a single endpoint - such as the submission of Purchase Orders or the receipt of Invoices).</p>

<p>You can then add rules to be triggered when a message is received on any activity - such as to set time expectations or perform real time reconciliation of values across activities.</p>

<h3 id="BookInOnePage-SimpleExample">Simple Example</h3>

<p>The following example shows how to perform some time based rules on a simple business process of 2 activities - A and B - which correspond with Purchase Orders and Invoices in the example above. If you would like to experiment with this scenario, you may edit this <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-bam/src/test/java/org/apache/camel/bam/BamRouteTest.java">Test Case</a>, which defines the activities and rules, and then tests that they work.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
return new ProcessBuilder(entityManagerFactory, transactionTemplate) {
    public void configure() throws Exception {

        // let&#39;s define some activities, correlating on an XPath on the message bodies
        ActivityBuilder a = activity(&quot;seda:a&quot;).name(&quot;a&quot;)
                .correlate(xpath(&quot;/hello/@id&quot;));

        ActivityBuilder b = activity(&quot;seda:b&quot;).name(&quot;b&quot;)
                .correlate(xpath(&quot;/hello/@id&quot;));

        // now let&#39;s add some rules
        b.starts().after(a.completes())
                .expectWithin(seconds(1))
                .errorIfOver(seconds(errorTimeout)).to(&quot;mock:overdue&quot;);
    }
};
]]></script>
</div></div>

<p>As you can see in the above example, we first define two activities, and then rules to specify when we expect them to complete for a process instance and when an error condition should be raised.p. The ProcessBuilder is a <a shape="rect" href="routebuilder.html">RouteBuilder</a> and can be added to any <a shape="rect" href="camelcontext.html">CamelContext</a>.  </p>

<h3 id="BookInOnePage-CompleteExample">Complete Example</h3>

<p>For a complete example please see the <a shape="rect" href="bam-example.html">BAM Example</a>, which is part of the standard Camel <a shape="rect" href="examples.html">Examples</a></p>

<h3 id="BookInOnePage-UseCases">Use Cases</h3>

<p>In the world of finance, a common requirement is tracking trades. Often a trader will submit a Front Office Trade which then flows through the Middle Office and Back Office through various systems to settle the trade so that money is exchanged. You may wish to test that the front and back office trades match up within a certain time period; if they don't match or a back office trade does not arrive within a required amount of time, you might signal an alarm.</p>
<h2 id="BookInOnePage-ExtractTransformLoad(ETL)">Extract Transform Load (ETL)</h2>

<p>The <a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/Extract,_transform,_load" rel="nofollow">ETL</a> (Extract, Transform, Load) is a mechanism for loading data into systems or databases using some kind of <a shape="rect" href="data-format.html">Data Format</a> from a variety of sources; often files then using <a shape="rect" href="pipes-and-filters.html">Pipes and Filters</a>, <a shape="rect" href="message-translator.html">Message Translator</a> and possible other <a shape="rect" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a>.</p>

<p>So you could query data from various Camel <a shape="rect" href="components.html">Components</a> such as <a shape="rect" href="file2.html">File</a>, <a shape="rect" href="http.html">HTTP</a> or <a shape="rect" href="jpa.html">JPA</a>, perform multiple patterns such as <a shape="rect" href="splitter.html">Splitter</a> or <a shape="rect" href="message-translator.html">Message Translator</a> then send the messages to some other <a shape="rect" href="component.html">Component</a>.</p>

<p>To show how this all fits together, try the <a shape="rect" href="etl-example.html">ETL Example</a> </p>
<h2 id="BookInOnePage-MockComponent">Mock Component</h2><p><a shape="rect" href="testing.html">Testing</a> of distributed and asynchronous processing is notoriously difficult. The <a shape="rect" href="mock.html">Mock</a>, <a shape="rect" href="test.html">Test</a> and <a shape="rect" href="dataset.html">DataSet</a> endpoints work great with the <a shape="rect" href="testing.html">Camel Testing Framework</a> to simplify your unit and integration testing using <a shape="rect" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a> and Camel's large range of <a shape="rect" href="components.html">Components</a> together with the powerful <a shape="rect" href="bean-integration.html">Bean Integration</a>.</p><p>The Mock component provides a powerful declarative testing mechanism, which is similar to <a shape="rect" class="external-link" href="http://www.jmock.org" rel="nofollow">jMock</a><a shape="rect" class="external-link" href="http://jmock.org" rel="nofollow"></a> in that it allows declarative expectations to be created on any Mock endpoint before a test begins. Then the test is run, which typically fires messages to one or more endpoints, and finally the expectations can be asserted in a test case to ensure the system worked as expected.</p><p>This allows you to test various things like:</p><ul><li>The correct number of messages are received on each endpoint,</li><li>The correct payloads are received, in the right order,</li><li>Messages arrive on an endpoint in order, using some <a shape="rect" href="expression.html">Expression</a> to create an order testing function,</li><li>Messages arrive match some kind of <a shape="rect" href="predicate.html">Predicate</a> such as that specific headers have certain values, or that parts of the messages match some predicate, such as by evaluating an <a shape="rect" href="xpath.html">XPath</a> or <a shape="rect" href="xquery.html">XQuery</a> <a shape="rect" href="expression.html">Expression</a>.</li></ul><p><strong>Note</strong> that there is also the <a shape="rect" href="test.html">Test endpoint</a> which is a Mock endpoint, but which uses a second endpoint to provide the list of expected message bodies and automatically sets up the Mock endpoint assertions. In other words, it's a Mock endpoint that automatically sets up its assertions from some sample messages in a <a shape="rect" href="file2.html">File</a> or <a shape="rect" href="jpa.html">database</a>, for example.</p><div class="confluence-information-macro confluence-information-macro-warning"><p class="title">Mock endpoints keep received Exchanges in memory indefinitely</p><span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Remember that Mock is designed for testing. When you add Mock endpoints to a route, each <a shape="rect" href="exchange.html">Exchange</a> sent to the endpoint will be stored (to allow for later validation) in memory until explicitly reset or the JVM is restarted. If you are sending high volume and/or large messages, this may cause excessive memory use. If your goal is to test deployable routes inline, consider using <a shape="rect" href="notifybuilder.html">NotifyBuilder</a> or <a shape="rect" href="advicewith.html">AdviceWith</a> in your tests instead of adding Mock endpoints to routes directly.</p><p>From Camel 2.10 onwards there are two new options <code>retainFirst</code>, and <code>retainLast</code> that can be used to limit the number of messages the Mock endpoints keep in memory.</p></div></div><h3 id="BookInOnePage-URIformat">URI format</h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[mock:someName[?options]
]]></script>
</div></div><p>Where <strong>someName</strong> can be any string that uniquely identifies the endpoint.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options">Options</h3><div class="confluenceTableSmall"><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>reportGroup</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A size to use a <a shape="rect" href="log.html">throughput logger</a> for reporting</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>retainFirst</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> To only keep first X number of messages in memory.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>retainLast</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> To only keep last X number of messages in memory.</p></td></tr></tbody></table>
</div></div><h3 id="BookInOnePage-SimpleExample.1">Simple Example</h3><p>Here's a simple example of Mock endpoint in use. First, the endpoint is resolved on the context. Then we set an expectation, and then, after the test has run, we assert that our expectations have been met.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[MockEndpoint resultEndpoint = context.resolveEndpoint(&quot;mock:foo&quot;, MockEndpoint.class);

resultEndpoint.expectedMessageCount(2);

// send some messages
...

// now lets assert that the mock:foo endpoint received 2 messages
resultEndpoint.assertIsSatisfied();
]]></script>
</div></div><p>You typically always call the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#assertIsSatisfied()">assertIsSatisfied() method</a> to test that the expectations were met after running a test.</p><p>Camel will by default wait 10 seconds when the <code>assertIsSatisfied()</code> is invoked. This can be configured by setting the <code>setResultWaitTime(millis)</code> method.</p><h4 id="BookInOnePage-UsingassertPeriod">Using assertPeriod</h4><p><strong>Available as of Camel 2.7</strong><br clear="none"> When the assertion is satisfied then Camel will stop waiting and continue from the <code>assertIsSatisfied</code> method. That means if a new message arrives on the mock endpoint, just a bit later, that arrival will not affect the outcome of the assertion. Suppose you do want to test that no new messages arrives after a period thereafter, then you can do that by setting the <code>setAssertPeriod</code> method, for example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[MockEndpoint resultEndpoint = context.resolveEndpoint(&quot;mock:foo&quot;, MockEndpoint.class);
resultEndpoint.setAssertPeriod(5000);
resultEndpoint.expectedMessageCount(2);

// send some messages
...

// now lets assert that the mock:foo endpoint received 2 messages
resultEndpoint.assertIsSatisfied();
]]></script>
</div></div><h3 id="BookInOnePage-Settingexpectations">Setting expectations</h3><p>You can see from the javadoc of <a shape="rect" href="httphttp://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html" rel="nofollow">MockEndpoint</a> the various helper methods you can use to set expectations. The main methods are as follows:</p><div class="confluenceTableSmall"><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Method</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#expectedMessageCount(int)">expectedMessageCount(int)</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To define the expected message count on the endpoint.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#expectedMinimumMessageCount(int)">expectedMinimumMessageCount(int)</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To define the minimum number of expected messages on the endpoint.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#expectedBodiesReceived(java.lang.Object...)">expectedBodiesReceived(...)</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To define the expected bodies that should be received (in order).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#expectedHeaderReceived(java.lang.String,%20java.lang.String)">expectedHeaderReceived(...)</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To define the expected header that should be received</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#expectsAscending(org.apache.camel.Expression)">expectsAscending(Expression)</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To add an expectation that messages are received in order, using the given <a shape="rect" href="expression.html">Expression</a> to compare messages.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#expectsDescending(org.apache.camel.Expression)">expectsDescending(Expression)</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To add an expectation that messages are received in order, using the given <a shape="rect" href="expression.html">Expression</a> to compare messages.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#expectsNoDuplicates(org.apache.camel.Expression)">expectsNoDuplicates(Expression)</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To add an expectation that no duplicate messages are received; using an <a shape="rect" href="expression.html">Expression</a> to calculate a unique identifier for each message. This could be something like the <code>JMSMessageID</code> if using JMS, or some unique reference number within the message.</p></td></tr></tbody></table>
</div></div><p>Here's another example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[resultEndpoint.expectedBodiesReceived(&quot;firstMessageBody&quot;, &quot;secondMessageBody&quot;, &quot;thirdMessageBody&quot;);
]]></script>
</div></div><h4 id="BookInOnePage-Addingexpectationstospecificmessages">Adding expectations to specific messages</h4><p>In addition, you can use the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#message(int)">message(int messageIndex)</a> method to add assertions about a specific message that is received.</p><p>For example, to add expectations of the headers or body of the first message (using zero-based indexing like <code>java.util.List</code>), you can use the following code:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[resultEndpoint.message(0).header(&quot;foo&quot;).isEqualTo(&quot;bar&quot;);
]]></script>
</div></div><p>There are some examples of the Mock endpoint in use in the <a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/">camel-core processor tests</a>.</p><h3 id="BookInOnePage-Mockingexistingendpoints">Mocking existing endpoints</h3><p><strong>Available as of Camel 2.7</strong></p><p>Camel now allows you to automatically mock existing endpoints in your Camel routes.</p><div class="confluence-information-macro confluence-information-macro-information"><p class="title">How it works</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p><strong>Important:</strong> The endpoints are still in action. What happens differently is that a <a shape="rect" href="mock.html">Mock</a> endpoint is injected and receives the message first and then delegates the message to the target endpoint. You can view this as a kind of intercept and delegate or endpoint listener.</p></div></div><p>Suppose you have the given route below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Route</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// tag::route[]
@Override
protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder() {
        @Override
        public void configure() throws Exception {
            from(&quot;direct:start&quot;).to(&quot;direct:foo&quot;).to(&quot;log:foo&quot;).to(&quot;mock:result&quot;);

            from(&quot;direct:foo&quot;).transform(constant(&quot;Bye World&quot;));
        }
    };
}
// end::route[]
]]></script>
</div></div><p>You can then use the <code>adviceWith</code> feature in Camel to mock all the endpoints in a given route from your unit test, as shown below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>adviceWith mocking all endpoints</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// tag::e1[]
public void testAdvisedMockEndpoints() throws Exception {
    // advice the first route using the inlined AdviceWith route builder
    // which has extended capabilities than the regular route builder
    context.getRouteDefinitions().get(0).adviceWith(context, new AdviceWithRouteBuilder() {
        @Override
        public void configure() throws Exception {
            // mock all endpoints
            mockEndpoints();
        }
    });

    getMockEndpoint(&quot;mock:direct:start&quot;).expectedBodiesReceived(&quot;Hello World&quot;);
    getMockEndpoint(&quot;mock:direct:foo&quot;).expectedBodiesReceived(&quot;Hello World&quot;);
    getMockEndpoint(&quot;mock:log:foo&quot;).expectedBodiesReceived(&quot;Bye World&quot;);
    getMockEndpoint(&quot;mock:result&quot;).expectedBodiesReceived(&quot;Bye World&quot;);

    template.sendBody(&quot;direct:start&quot;, &quot;Hello World&quot;);

    assertMockEndpointsSatisfied();

    // additional test to ensure correct endpoints in registry
    assertNotNull(context.hasEndpoint(&quot;direct:start&quot;));
    assertNotNull(context.hasEndpoint(&quot;direct:foo&quot;));
    assertNotNull(context.hasEndpoint(&quot;log:foo&quot;));
    assertNotNull(context.hasEndpoint(&quot;mock:result&quot;));
    // all the endpoints was mocked
    assertNotNull(context.hasEndpoint(&quot;mock:direct:start&quot;));
    assertNotNull(context.hasEndpoint(&quot;mock:direct:foo&quot;));
    assertNotNull(context.hasEndpoint(&quot;mock:log:foo&quot;));
}
// end::e1[]
]]></script>
</div></div><p>Notice that the mock endpoints is given the uri <code>mock:&lt;endpoint&gt;</code>, for example <code>mock:direct:foo</code>. Camel logs at <code>INFO</code> level the endpoints being mocked:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[INFO  Adviced endpoint [direct://foo] with mock endpoint [mock:direct:foo]
]]></script>
</div></div><div class="confluence-information-macro confluence-information-macro-information"><p class="title">Mocked endpoints are without parameters</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Endpoints which are mocked will have their parameters stripped off. For example the endpoint "log:foo?showAll=true" will be mocked to the following endpoint "mock:log:foo". Notice the parameters have been removed.</p></div></div><p>Its also possible to only mock certain endpoints using a pattern. For example to mock all <code>log</code> endpoints you do as shown:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>adviceWith mocking only log endpoints using a pattern</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// tag::e2[]
public void testAdvisedMockEndpointsWithPattern() throws Exception {
    // advice the first route using the inlined AdviceWith route builder
    // which has extended capabilities than the regular route builder
    context.getRouteDefinitions().get(0).adviceWith(context, new AdviceWithRouteBuilder() {
        @Override
        public void configure() throws Exception {
            // mock only log endpoints
            mockEndpoints(&quot;log*&quot;);
        }
    });

    // now we can refer to log:foo as a mock and set our expectations
    getMockEndpoint(&quot;mock:log:foo&quot;).expectedBodiesReceived(&quot;Bye World&quot;);

    getMockEndpoint(&quot;mock:result&quot;).expectedBodiesReceived(&quot;Bye World&quot;);

    template.sendBody(&quot;direct:start&quot;, &quot;Hello World&quot;);

    assertMockEndpointsSatisfied();

    // additional test to ensure correct endpoints in registry
    assertNotNull(context.hasEndpoint(&quot;direct:start&quot;));
    assertNotNull(context.hasEndpoint(&quot;direct:foo&quot;));
    assertNotNull(context.hasEndpoint(&quot;log:foo&quot;));
    assertNotNull(context.hasEndpoint(&quot;mock:result&quot;));
    // only the log:foo endpoint was mocked
    assertNotNull(context.hasEndpoint(&quot;mock:log:foo&quot;));
    assertNull(context.hasEndpoint(&quot;mock:direct:start&quot;));
    assertNull(context.hasEndpoint(&quot;mock:direct:foo&quot;));
}
// end::e2[]
]]></script>
</div></div><p>The pattern supported can be a wildcard or a regular expression. See more details about this at <a shape="rect" href="intercept.html">Intercept</a> as its the same matching function used by Camel.</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Mind that mocking endpoints causes the messages to be copied when they arrive on the mock.<br clear="none"> That means Camel will use more memory. This may not be suitable when you send in a lot of messages.</p></div></div><h4 id="BookInOnePage-Mockingexistingendpointsusingthecamel-testcomponent">Mocking existing endpoints using the <code>camel-test</code> component</h4><p>Instead of using the <code>adviceWith</code> to instruct Camel to mock endpoints, you can easily enable this behavior when using the <code>camel-test</code> Test Kit.<br clear="none"> The same route can be tested as follows. Notice that we return <code>"*"</code> from the <code>isMockEndpoints</code> method, which tells Camel to mock all endpoints.<br clear="none"> If you only want to mock all <code>log</code> endpoints you can return <code>"log*"</code> instead.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>isMockEndpoints using camel-test kit</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// tag::e1[]
public class IsMockEndpointsJUnit4Test extends CamelTestSupport {

    @Override
    public String isMockEndpoints() {
        // override this method and return the pattern for which endpoints to mock.
        // use * to indicate all
        return &quot;*&quot;;
    }

    @Test
    public void testMockAllEndpoints() throws Exception {
        // notice we have automatic mocked all endpoints and the name of the endpoints is &quot;mock:uri&quot;
        getMockEndpoint(&quot;mock:direct:start&quot;).expectedBodiesReceived(&quot;Hello World&quot;);
        getMockEndpoint(&quot;mock:direct:foo&quot;).expectedBodiesReceived(&quot;Hello World&quot;);
        getMockEndpoint(&quot;mock:log:foo&quot;).expectedBodiesReceived(&quot;Bye World&quot;);
        getMockEndpoint(&quot;mock:result&quot;).expectedBodiesReceived(&quot;Bye World&quot;);

        template.sendBody(&quot;direct:start&quot;, &quot;Hello World&quot;);

        assertMockEndpointsSatisfied();

        // additional test to ensure correct endpoints in registry
        assertNotNull(context.hasEndpoint(&quot;direct:start&quot;));
        assertNotNull(context.hasEndpoint(&quot;direct:foo&quot;));
        assertNotNull(context.hasEndpoint(&quot;log:foo&quot;));
        assertNotNull(context.hasEndpoint(&quot;mock:result&quot;));
        // all the endpoints was mocked
        assertNotNull(context.hasEndpoint(&quot;mock:direct:start&quot;));
        assertNotNull(context.hasEndpoint(&quot;mock:direct:foo&quot;));
        assertNotNull(context.hasEndpoint(&quot;mock:log:foo&quot;));
    }

    @Override
    protected RouteBuilder createRouteBuilder() throws Exception {
        return new RouteBuilder() {
            @Override
            public void configure() throws Exception {
                from(&quot;direct:start&quot;).to(&quot;direct:foo&quot;).to(&quot;log:foo&quot;).to(&quot;mock:result&quot;);

                from(&quot;direct:foo&quot;).transform(constant(&quot;Bye World&quot;));
            }
        };
    }
}
// end::e1[]
]]></script>
</div></div><h4 id="BookInOnePage-MockingexistingendpointswithXMLDSL">Mocking existing endpoints with XML DSL</h4><p>If you do not use the <code>camel-test</code> component for unit testing (as shown above) you can use a different approach when using XML files for routes.<br clear="none"> The solution is to create a new XML file used by the unit test and then include the intended XML file which has the route you want to test.</p><p>Suppose we have the route in the <code>camel-route.xml</code> file:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>camel-route.xml</b></div><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;!-- tag::e1[] --&gt;
&lt;!-- this camel route is in the camel-route.xml file --&gt;
&lt;camelContext xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;

    &lt;route&gt;
        &lt;from uri=&quot;direct:start&quot;/&gt;
        &lt;to uri=&quot;direct:foo&quot;/&gt;
        &lt;to uri=&quot;log:foo&quot;/&gt;
        &lt;to uri=&quot;mock:result&quot;/&gt;
    &lt;/route&gt;

    &lt;route&gt;
        &lt;from uri=&quot;direct:foo&quot;/&gt;
        &lt;transform&gt;
            &lt;constant&gt;Bye World&lt;/constant&gt;
        &lt;/transform&gt;
    &lt;/route&gt;

&lt;/camelContext&gt;
&lt;!-- end::e1[] --&gt;
]]></script>
</div></div><p>Then we create a new XML file as follows, where we include the <code>camel-route.xml</code> file and define a spring bean with the class <code>org.apache.camel.impl.InterceptSendToMockEndpointStrategy</code> which tells Camel to mock all endpoints:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>test-camel-route.xml</b></div><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;!-- tag::e1[] --&gt;
&lt;!-- the Camel route is defined in another XML file --&gt;
&lt;import resource=&quot;camel-route.xml&quot;/&gt;

&lt;!-- bean which enables mocking all endpoints --&gt;
&lt;bean id=&quot;mockAllEndpoints&quot; class=&quot;org.apache.camel.impl.InterceptSendToMockEndpointStrategy&quot;/&gt;
&lt;!-- end::e1[] --&gt;
]]></script>
</div></div><p>Then in your unit test you load the new XML file (<code>test-camel-route.xml</code>) instead of <code>camel-route.xml</code>.</p><p>To only mock all <a shape="rect" href="log.html">Log</a> endpoints you can define the pattern in the constructor for the bean:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;bean id=&quot;mockAllEndpoints&quot; class=&quot;org.apache.camel.impl.InterceptSendToMockEndpointStrategy&quot;&gt;
    &lt;constructor-arg index=&quot;0&quot; value=&quot;log*&quot;/&gt;
&lt;/bean&gt;
]]></script>
</div></div><h4 id="BookInOnePage-Mockingendpointsandskipsendingtooriginalendpoint">Mocking endpoints and skip sending to original endpoint</h4><p><strong>Available as of Camel 2.10</strong></p><p>Sometimes you want to easily mock and skip sending to a certain endpoints. So the message is detoured and send to the mock endpoint only. From Camel 2.10 onwards you can now use the <code>mockEndpointsAndSkip</code> method using <a shape="rect" href="advicewith.html">AdviceWith</a> or the <a shape="rect" class="unresolved" href="#">Test Kit</a>. The example below will skip sending to the two endpoints <code>"direct:foo"</code>, and <code>"direct:bar"</code>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>adviceWith mock and skip sending to endpoints</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// tag::e1[]
public void testAdvisedMockEndpointsWithSkip() throws Exception {
    // advice the first route using the inlined AdviceWith route builder
    // which has extended capabilities than the regular route builder
    context.getRouteDefinitions().get(0).adviceWith(context, new AdviceWithRouteBuilder() {
        @Override
        public void configure() throws Exception {
            // mock sending to direct:foo and direct:bar and skip send to it
            mockEndpointsAndSkip(&quot;direct:foo&quot;, &quot;direct:bar&quot;);
        }
    });

    getMockEndpoint(&quot;mock:result&quot;).expectedBodiesReceived(&quot;Hello World&quot;);
    getMockEndpoint(&quot;mock:direct:foo&quot;).expectedMessageCount(1);
    getMockEndpoint(&quot;mock:direct:bar&quot;).expectedMessageCount(1);

    template.sendBody(&quot;direct:start&quot;, &quot;Hello World&quot;);

    assertMockEndpointsSatisfied();

    // the message was not send to the direct:foo route and thus not sent to the seda endpoint
    SedaEndpoint seda = context.getEndpoint(&quot;seda:foo&quot;, SedaEndpoint.class);
    assertEquals(0, seda.getCurrentQueueSize());
}
// end::e1[]
]]></script>
</div></div><p>The same example using the <a shape="rect" href="testing.html">Test Kit</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>isMockEndpointsAndSkip using camel-test kit</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// tag::e1[]
public class IsMockEndpointsAndSkipJUnit4Test extends CamelTestSupport {

    @Override
    public String isMockEndpointsAndSkip() {
        // override this method and return the pattern for which endpoints to mock,
        // and skip sending to the original endpoint.
        return &quot;direct:foo&quot;;
    }

    @Test
    public void testMockEndpointAndSkip() throws Exception {
        // notice we have automatic mocked the direct:foo endpoints and the name of the endpoints is &quot;mock:uri&quot;
        getMockEndpoint(&quot;mock:result&quot;).expectedBodiesReceived(&quot;Hello World&quot;);
        getMockEndpoint(&quot;mock:direct:foo&quot;).expectedMessageCount(1);

        template.sendBody(&quot;direct:start&quot;, &quot;Hello World&quot;);

        assertMockEndpointsSatisfied();

        // the message was not send to the direct:foo route and thus not sent to the seda endpoint
        SedaEndpoint seda = context.getEndpoint(&quot;seda:foo&quot;, SedaEndpoint.class);
        assertEquals(0, seda.getCurrentQueueSize());
    }

    @Override
    protected RouteBuilder createRouteBuilder() throws Exception {
        return new RouteBuilder() {
            @Override
            public void configure() throws Exception {
                from(&quot;direct:start&quot;).to(&quot;direct:foo&quot;).to(&quot;mock:result&quot;);

                from(&quot;direct:foo&quot;).transform(constant(&quot;Bye World&quot;)).to(&quot;seda:foo&quot;);
            }
        };
    }
}
// end::e1[]
]]></script>
</div></div><h3 id="BookInOnePage-Limitingthenumberofmessagestokeep">Limiting the number of messages to keep</h3><p><strong>Available as of Camel 2.10</strong></p><p>The <a shape="rect" href="mock.html">Mock</a> endpoints will by default keep a copy of every <a shape="rect" href="exchange.html">Exchange</a> that it received. So if you test with a lot of messages, then it will consume memory.<br clear="none"> From Camel 2.10 onwards we have introduced two options <code>retainFirst</code> and <code>retainLast</code> that can be used to specify to only keep N'th of the first and/or last <a shape="rect" href="exchange.html">Exchange</a>s.</p><p>For example in the code below, we only want to retain a copy of the first 5 and last 5 <a shape="rect" href="exchange.html">Exchange</a>s the mock receives.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[  MockEndpoint mock = getMockEndpoint(&quot;mock:data&quot;);
  mock.setRetainFirst(5);
  mock.setRetainLast(5);
  mock.expectedMessageCount(2000);

  ...

  mock.assertIsSatisfied();
]]></script>
</div></div><p>Using this has some limitations. The <code>getExchanges()</code> and <code>getReceivedExchanges()</code> methods on the <code>MockEndpoint</code> will return only the retained copies of the <a shape="rect" href="exchange.html">Exchange</a>s. So in the example above, the list will contain 10 <a shape="rect" href="exchange.html">Exchange</a>s; the first five, and the last five.<br clear="none"> The <code>retainFirst</code> and <code>retainLast</code> options also have limitations on which expectation methods you can use. For example the expectedXXX methods that work on message bodies, headers, etc. will only operate on the retained messages. In the example above they can test only the expectations on the 10 retained messages.</p><h3 id="BookInOnePage-Testingwitharrivaltimes">Testing with arrival times</h3><p><strong>Available as of Camel 2.7</strong></p><p>The <a shape="rect" href="mock.html">Mock</a> endpoint stores the arrival time of the message as a property on the <a shape="rect" href="exchange.html">Exchange</a>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[Date time = exchange.getProperty(Exchange.RECEIVED_TIMESTAMP, Date.class);
]]></script>
</div></div><p>You can use this information to know when the message arrived on the mock. But it also provides foundation to know the time interval between the previous and next message arrived on the mock. You can use this to set expectations using the <code>arrives</code> DSL on the <a shape="rect" href="mock.html">Mock</a> endpoint.</p><p>For example to say that the first message should arrive between 0-2 seconds before the next you can do:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[mock.message(0).arrives().noLaterThan(2).seconds().beforeNext();
]]></script>
</div></div><p>You can also define this as that 2nd message (0 index based) should arrive no later than 0-2 seconds after the previous:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[mock.message(1).arrives().noLaterThan(2).seconds().afterPrevious();
]]></script>
</div></div><p>You can also use between to set a lower bound. For example suppose that it should be between 1-4 seconds:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[mock.message(1).arrives().between(1, 4).seconds().afterPrevious();
]]></script>
</div></div><p>You can also set the expectation on all messages, for example to say that the gap between them should be at most 1 second:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[mock.allMessages().arrives().noLaterThan(1).seconds().beforeNext();
]]></script>
</div></div><div class="confluence-information-macro confluence-information-macro-tip"><p class="title">time units</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>In the example above we use <code>seconds</code> as the time unit, but Camel offers <code>milliseconds</code>, and <code>minutes</code> as well.</p></div></div><p></p><h3 id="BookInOnePage-SeeAlso">See Also</h3>
<ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul><li><a shape="rect" href="spring-testing.html">Spring Testing</a></li><li><a shape="rect" href="testing.html">Testing</a></li></ul>
<h2 id="BookInOnePage-Testing">Testing</h2><p>Testing is a crucial activity in any piece of software development or integration. Typically Camel Riders use various different <a shape="rect" href="components.html">technologies</a> wired together in a variety of <a shape="rect" href="enterprise-integration-patterns.html">patterns</a> with different <a shape="rect" href="languages.html">expression languages</a> together with different forms of <a shape="rect" href="bean-integration.html">Bean Integration</a> and <a shape="rect" href="dependency-injection.html">Dependency Injection</a> so its very easy for things to go wrong! <img class="emoticon emoticon-smile" src="https://cwiki.apache.org/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/icons/emoticons/smile.png" data-emoticon-name="smile" alt="(smile)"> . Testing is the crucial weapon to ensure that things work as you would expect.</p><p>Camel is a Java library so you can easily wire up tests in whatever unit testing framework you use (JUnit 3.x (deprecated), 4.x, or TestNG). However the Camel project has tried to make the testing of Camel as easy and powerful as possible so we have introduced the following features.</p><h3 id="BookInOnePage-Testingmechanisms">Testing mechanisms</h3><p>The following mechanisms are supported:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Component</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="camel-test.html">Camel Test</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>camel-test</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Is a standalone Java library letting you easily create Camel test cases using a single Java class for all your configuration and routing without using <a shape="rect" href="cdi.html">CDI</a>, <a shape="rect" href="spring.html">Spring</a> or <a shape="rect" href="guice.html">Guice</a> for <a shape="rect" href="dependency-injection.html">Dependency Injection</a>&#160;which does not require an in-depth knowledge of Spring + Spring Test or Guice. &#160;Supports JUnit 3.x (deprecated) and JUnit 4.x based tests.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><a shape="rect" href="cdi-testing.html">CDI Testing</a></td><td colspan="1" rowspan="1" class="confluenceTd"><code>camel-test-cdi</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Provides a JUnit 4 runner that bootstraps a test environment using CDI so that you don't have to be familiar with any CDI testing frameworks and can concentrate on the testing logic of your Camel CDI applications. Testing frameworks like&#160;<a shape="rect" class="external-link" href="http://arquillian.org/" rel="nofollow">Arquillian</a>&#160;or&#160;<a shape="rect" class="external-link" href="https://ops4j1.jira.com/wiki/display/PAXEXAM4" rel="nofollow">PAX Exam</a>, can be used for more advanced test cases, where you need to configure your system under test in a very fine-grained way or target specific CDI containers.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="spring-testing.html">Spring Testing</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>camel-test-spring</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Supports JUnit 3.x (deprecated) or JUnit 4.x based tests that bootstrap a test environment using Spring without needing to be familiar with Spring Test. The plain JUnit 3.x/4.x based tests work very similar to the test support classes in <code>camel-test</code>. Also supports Spring Test based tests that use the declarative style of test configuration and injection common in Spring Test. The Spring Test based tests provide feature parity with the plain JUnit 3.x/4.x based testing approach. Notice <code>camel-test-spring</code> is a new component in <strong>Camel 2.10</strong> onwards. For older Camel release use <code>camel-test</code> which has built-in <a shape="rect" href="spring-testing.html">Spring Testing</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="blueprint-testing.html">Blueprint Testing</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>camel-test-blueprint</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Provides the ability to do unit testing on blueprint configurations</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="guice.html">Guice</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>camel-guice</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Deprecated</strong> Uses <a shape="rect" href="guice.html">Guice</a> to dependency inject your test classes</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>Camel TestNG</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>camel-testng</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Deprecated</strong> Supports plain TestNG based tests&#160;with or without <a shape="rect" href="cdi.html">CDI</a>,&#160;<a shape="rect" href="spring.html">Spring</a>&#160;or&#160;<a shape="rect" href="guice.html">Guice</a>&#160;for&#160;<a shape="rect" href="dependency-injection.html">Dependency Injection</a>&#160;which does not require an in-depth knowledge of CDI, Spring + Spring Test or Guice. &#160;Also from <strong>Camel 2.10</strong> onwards, this component supports Spring Test&#160;based tests that use the declarative style of test configuration and injection common in Spring Test and described in more detail under <a shape="rect" href="spring-testing.html">Spring Testing</a>.</p></td></tr></tbody></table></div><p>In all approaches the test classes look pretty much the same in that they all reuse the <a shape="rect" href="bean-integration.html">Camel binding and injection annotations</a>.</p><h4 id="BookInOnePage-CamelTestExample">Camel Test Example</h4><p>Here is the <a shape="rect" href="camel-test.html">Camel Test</a> <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-test/src/test/java/org/apache/camel/test/patterns/FilterTest.java">example</a>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// tag::example[]
public class FilterTest extends CamelTestSupport {

    @EndpointInject(uri = &quot;mock:result&quot;)
    protected MockEndpoint resultEndpoint;

    @Produce(uri = &quot;direct:start&quot;)
    protected ProducerTemplate template;

    @Override
    public boolean isDumpRouteCoverage() {
        return true;
    }

    @Test
    public void testSendMatchingMessage() throws Exception {
        String expectedBody = &quot;&lt;matched/&gt;&quot;;

        resultEndpoint.expectedBodiesReceived(expectedBody);

        template.sendBodyAndHeader(expectedBody, &quot;foo&quot;, &quot;bar&quot;);

        resultEndpoint.assertIsSatisfied();
    }

    @Test
    public void testSendNotMatchingMessage() throws Exception {
        resultEndpoint.expectedMessageCount(0);

        template.sendBodyAndHeader(&quot;&lt;notMatched/&gt;&quot;, &quot;foo&quot;, &quot;notMatchedHeaderValue&quot;);

        resultEndpoint.assertIsSatisfied();
    }

    @Override
    protected RouteBuilder createRouteBuilder() {
        return new RouteBuilder() {
            public void configure() {
                from(&quot;direct:start&quot;).filter(header(&quot;foo&quot;).isEqualTo(&quot;bar&quot;)).to(&quot;mock:result&quot;);
            }
        };
    }
}
// end::example[]
]]></script>
</div></div>Notice how it derives from the Camel helper class <code>CamelTestSupport</code> but has no CDI, Spring or Guice dependency injection configuration but instead overrides the <code>createRouteBuilder()</code> method.<h4 id="BookInOnePage-CDITestexample">CDI Test example</h4><p>Here is the <a shape="rect" href="cdi-testing.html">CDI Testing</a> <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-test-cdi/src/test/java/org/apache/camel/test/cdi/FilterTest.java">example</a>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// tag::example[]
@RunWith(CamelCdiRunner.class)
public class FilterTest {

    @EndpointInject(uri = &quot;mock:result&quot;)
    protected MockEndpoint resultEndpoint;

    @Produce(uri = &quot;direct:start&quot;)
    protected ProducerTemplate template;

    @Before
    public void before() {
        resultEndpoint.reset();
    }

    @Test
    public void testSendMatchingMessage() throws Exception {
        String expectedBody = &quot;&lt;matched/&gt;&quot;;

        resultEndpoint.expectedBodiesReceived(expectedBody);

        template.sendBodyAndHeader(expectedBody, &quot;foo&quot;, &quot;bar&quot;);

        resultEndpoint.assertIsSatisfied();
    }

    @Test
    public void testSendNotMatchingMessage() throws Exception {
        resultEndpoint.expectedMessageCount(0);

        template.sendBodyAndHeader(&quot;&lt;notMatched/&gt;&quot;, &quot;foo&quot;, &quot;notMatchedHeaderValue&quot;);

        resultEndpoint.assertIsSatisfied();
    }

    static class ContextConfig extends RouteBuilder {

        @Override
        public void configure() {
            from(&quot;direct:start&quot;).filter(header(&quot;foo&quot;).isEqualTo(&quot;bar&quot;)).to(&quot;mock:result&quot;);
        }
    }
}
// end::example[]
]]></script>
</div></div>You can find more testing patterns illustrated in the <code>camel-example-cdi-test</code> example&#160;and the test classes that come with it.<h4 id="BookInOnePage-SpringTestwithXMLConfigExample">Spring Test with XML Config Example</h4><p>Here is the <a shape="rect" href="spring-testing.html">Spring Testing</a> <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-spring/src/test/java/org/apache/camel/spring/patterns/FilterTest.java">example using XML Config</a>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// tag::example[]
@ContextConfiguration
public class FilterTest extends SpringRunWithTestSupport {

    @EndpointInject(uri = &quot;mock:result&quot;)
    protected MockEndpoint resultEndpoint;

    @Produce(uri = &quot;direct:start&quot;)
    protected ProducerTemplate template;

    @DirtiesContext
    @Test
    public void testSendMatchingMessage() throws Exception {
        String expectedBody = &quot;&lt;matched/&gt;&quot;;

        resultEndpoint.expectedBodiesReceived(expectedBody);

        template.sendBodyAndHeader(expectedBody, &quot;foo&quot;, &quot;bar&quot;);

        resultEndpoint.assertIsSatisfied();
    }

    @DirtiesContext
    @Test
    public void testSendNotMatchingMessage() throws Exception {
        resultEndpoint.expectedMessageCount(0);

        template.sendBodyAndHeader(&quot;&lt;notMatched/&gt;&quot;, &quot;foo&quot;, &quot;notMatchedHeaderValue&quot;);

        resultEndpoint.assertIsSatisfied();
    }
}
// end::example[]
]]></script>
</div></div>Notice that we use <code>@DirtiesContext</code> on the test methods to force <a shape="rect" href="spring-testing.html">Spring Testing</a> to automatically reload the <code><a shape="rect" href="camelcontext.html">CamelContext</a></code> after each test method - this ensures that the tests don't clash with each other (e.g. one test method sending to an endpoint that is then reused in another test method).<p>Also notice the use of <code>@ContextConfiguration</code> to indicate that by default we should look for the <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-spring/src/test/resources/org/apache/camel/spring/patterns/FilterTest-context.xml"><code>FilterTest-context.xml</code> on the classpath</a> to configure the test case which looks like this:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;!-- tag::example[] --&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xsi:schemaLocation=&quot;
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd
    &quot;&gt;

  &lt;camelContext xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;
    &lt;route&gt;
      &lt;from uri=&quot;direct:start&quot;/&gt;
      &lt;filter&gt;
        &lt;xpath&gt;$foo = &#39;bar&#39;&lt;/xpath&gt;
        &lt;to uri=&quot;mock:result&quot;/&gt;
      &lt;/filter&gt;
    &lt;/route&gt;
  &lt;/camelContext&gt;

&lt;/beans&gt;
&lt;!-- end::example[] --&gt;
]]></script>
</div></div><h4 id="BookInOnePage-SpringTestwithJavaConfigExample">Spring Test with Java Config Example</h4><p>Here is the <a shape="rect" href="spring-testing.html">Spring Testing</a> <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-spring-javaconfig/src/test/java/org/apache/camel/spring/javaconfig/patterns/FilterTest.java">example using Java Config</a>.</p><p>For more information see <a shape="rect" href="spring-java-config.html">Spring Java Config</a>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// tag::example[]
@RunWith(CamelSpringJUnit4ClassRunner.class)
@ContextConfiguration(classes = {FilterTest.ContextConfig.class}, loader = CamelSpringDelegatingTestContextLoader.class)
public class FilterTest extends AbstractJUnit4SpringContextTests {

    @EndpointInject(uri = &quot;mock:result&quot;)
    protected MockEndpoint resultEndpoint;

    @Produce(uri = &quot;direct:start&quot;)
    protected ProducerTemplate template;

    @DirtiesContext
    @Test
    public void testSendMatchingMessage() throws Exception {
        String expectedBody = &quot;&lt;matched/&gt;&quot;;

        resultEndpoint.expectedBodiesReceived(expectedBody);

        template.sendBodyAndHeader(expectedBody, &quot;foo&quot;, &quot;bar&quot;);

        resultEndpoint.assertIsSatisfied();
    }

    @DirtiesContext
    @Test
    public void testSendNotMatchingMessage() throws Exception {
        resultEndpoint.expectedMessageCount(0);

        template.sendBodyAndHeader(&quot;&lt;notMatched/&gt;&quot;, &quot;foo&quot;, &quot;notMatchedHeaderValue&quot;);

        resultEndpoint.assertIsSatisfied();
    }

    @Configuration
    public static class ContextConfig extends SingleRouteCamelConfiguration {
        @Bean
        public RouteBuilder route() {
            return new RouteBuilder() {
                public void configure() {
                    from(&quot;direct:start&quot;).filter(header(&quot;foo&quot;).isEqualTo(&quot;bar&quot;)).to(&quot;mock:result&quot;);
                }
            };
        }
    }
}
// end::example[]
]]></script>
</div></div>This is similar to the XML Config example above except that there is no XML file and instead the nested <code>ContextConfig</code> class does all of the configuration; so your entire test case is contained in a single Java class. We currently have to reference by class name this class in the <code>@ContextConfiguration</code> which is a bit ugly. Please vote for <a shape="rect" class="external-link" href="http://jira.springframework.org/browse/SJC-238" rel="nofollow">SJC-238</a> to address this and make Spring Test work more cleanly with Spring JavaConfig.<p>Its totally optional but for the ContextConfig implementation we derive from <code>SingleRouteCamelConfiguration</code> which is a helper Spring Java Config class which will configure the <code>CamelContext</code> for us and then register the <code>RouteBuilder</code> we create.</p><p>Since <strong>Camel 2.11.0</strong> you can use the <code>CamelSpringJUnit4ClassRunner</code> with <code>CamelSpringDelegatingTestContextLoader</code> like <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-spring-javaconfig/src/test/java/org/apache/camel/spring/javaconfig/test/CamelSpringDelegatingTestContextLoaderTest.java">example using Java Config with <code>CamelSpringJUnit4ClassRunner</code></a>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// tag::example[]
@RunWith(CamelSpringJUnit4ClassRunner.class)
@ContextConfiguration(
        classes = {CamelSpringDelegatingTestContextLoaderTest.TestConfig.class},
        // Since Camel 2.11.0 
        loader = CamelSpringDelegatingTestContextLoader.class
    )
@MockEndpoints
public class CamelSpringDelegatingTestContextLoaderTest {
    @EndpointInject(uri = &quot;mock:direct:end&quot;)
    protected MockEndpoint endEndpoint;

    @EndpointInject(uri = &quot;mock:direct:error&quot;)
    protected MockEndpoint errorEndpoint;

    @Produce(uri = &quot;direct:test&quot;)
    protected ProducerTemplate testProducer;

    @Configuration
    public static class TestConfig extends SingleRouteCamelConfiguration {
        @Bean
        @Override
        public RouteBuilder route() {
            return new RouteBuilder() {
                @Override
                public void configure() throws Exception {
                    from(&quot;direct:test&quot;).errorHandler(deadLetterChannel(&quot;direct:error&quot;)).to(&quot;direct:end&quot;);

                    from(&quot;direct:error&quot;).log(&quot;Received message on direct:error endpoint.&quot;);

                    from(&quot;direct:end&quot;).log(&quot;Received message on direct:end endpoint.&quot;);
                }
            };
        }
    }

    @Test
    public void testRoute() throws InterruptedException {
        endEndpoint.expectedMessageCount(1);
        errorEndpoint.expectedMessageCount(0);

        testProducer.sendBody(&quot;&lt;name&gt;test&lt;/name&gt;&quot;);

        endEndpoint.assertIsSatisfied();
        errorEndpoint.assertIsSatisfied();
    }
}
// end::example[]
]]></script>
</div></div><h4 id="BookInOnePage-SpringTestwithXMLConfigandDeclarativeConfigurationExample">Spring Test with XML Config and Declarative Configuration Example</h4><p>Here is a Camel test support enhanced&#160;<a shape="rect" href="spring-testing.html">Spring Testing</a>&#160;<a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/camel/trunk/components/camel-test-spring/src/test/java/org/apache/camel/test/spring/CamelSpringJUnit4ClassRunnerPlainTest.java">example using XML Config and pure Spring Test based configuration of the Camel Context</a>:</p><div class="error"><span class="error">Error formatting macro: snippet: java.lang.IndexOutOfBoundsException: Index: 20, Size: 20</span> </div>Notice how a custom test runner is used with the&#160;<code>@RunWith</code>&#160;annotation to support the features of&#160;<code>CamelTestSupport</code>&#160;through annotations on the test class. See&#160;<a shape="rect" href="spring-testing.html">Spring Testing</a>&#160;for a list of annotations you can use in your tests.<h4 id="BookInOnePage-BlueprintTest">Blueprint Test</h4><p>Here is the <a shape="rect" href="blueprint-testing.html">Blueprint Testing</a> <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-test-blueprint/src/test/java/org/apache/camel/test/blueprint/DebugBlueprintTest.java">example using XML Config</a>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// tag::example[]
// to use camel-test-blueprint, then extend the CamelBlueprintTestSupport class,
// and add your unit tests methods as shown below.
public class DebugBlueprintTest extends CamelBlueprintTestSupport {

    private boolean debugBeforeMethodCalled;
    private boolean debugAfterMethodCalled;

    // override this method, and return the location of our Blueprint XML file to be used for testing
    @Override
    protected String getBlueprintDescriptor() {
        return &quot;org/apache/camel/test/blueprint/camelContext.xml&quot;;
    }

    // here we have regular JUnit @Test method
    @Test
    public void testRoute() throws Exception {

        // set mock expectations
        getMockEndpoint(&quot;mock:a&quot;).expectedMessageCount(1);

        // send a message
        template.sendBody(&quot;direct:start&quot;, &quot;World&quot;);

        // assert mocks
        assertMockEndpointsSatisfied();

        // assert on the debugBefore/debugAfter methods below being called as we&#39;ve enabled the debugger
        assertTrue(debugBeforeMethodCalled);
        assertTrue(debugAfterMethodCalled);
    }

    @Override
    public boolean isUseDebugger() {
        // must enable debugger
        return true;
    }

    @Override
    protected void debugBefore(Exchange exchange, org.apache.camel.Processor processor, ProcessorDefinition&lt;?&gt; definition, String id, String label) {
        log.info(&quot;Before &quot; + definition + &quot; with body &quot; + exchange.getIn().getBody());
        debugBeforeMethodCalled = true;
    }

    @Override
    protected void debugAfter(Exchange exchange, org.apache.camel.Processor processor, ProcessorDefinition&lt;?&gt; definition, String id, String label, long timeTaken) {
        log.info(&quot;After &quot; + definition + &quot; with body &quot; + exchange.getIn().getBody());
        debugAfterMethodCalled = true;
    }
}
// end::example[]
]]></script>
</div></div>Also notice the use of <code>getBlueprintDescriptors</code> to indicate that by default we should look for the <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-test-blueprint/src/test/resources/org/apache/camel/test/blueprint/camelContext.xml"><code>camelContext.xml</code> in the package</a> to configure the test case which looks like this:<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;!-- tag::example[] --&gt;
&lt;blueprint xmlns=&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot;
           xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
           xsi:schemaLocation=&quot;
             http://www.osgi.org/xmlns/blueprint/v1.0.0 https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd&quot;&gt;

  &lt;camelContext xmlns=&quot;http://camel.apache.org/schema/blueprint&quot;&gt;

    &lt;route&gt;
      &lt;from uri=&quot;direct:start&quot;/&gt;
      &lt;transform&gt;
        &lt;simple&gt;Hello ${body}&lt;/simple&gt;
      &lt;/transform&gt;
      &lt;to uri=&quot;mock:a&quot;/&gt;
    &lt;/route&gt;

  &lt;/camelContext&gt;

&lt;/blueprint&gt;
&lt;!-- end::example[] --&gt;
]]></script>
</div></div><h3 id="BookInOnePage-Testingendpoints">Testing endpoints</h3><p>Camel provides a number of endpoints which can make testing easier.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="dataset.html">DataSet</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For load &amp; soak testing this endpoint provides a way to create huge numbers of messages for sending to <a shape="rect" href="components.html">Components</a> and asserting that they are consumed correctly</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="mock.html">Mock</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For testing routes and mediation rules using mocks and allowing assertions to be added to an endpoint</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="test.html">Test</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Creates a <a shape="rect" href="mock.html">Mock</a> endpoint which expects to receive all the message bodies that could be polled from the given underlying endpoint</p></td></tr></tbody></table></div><p>The main endpoint is the <a shape="rect" href="mock.html">Mock</a> endpoint which allows expectations to be added to different endpoints; you can then run your tests and assert that your expectations are met at the end.</p><h3 id="BookInOnePage-Stubbingoutphysicaltransporttechnologies">Stubbing out physical transport technologies</h3><p>If you wish to test out a route but want to avoid actually using a real physical transport (for example to unit test a transformation route rather than performing a full integration test) then the following endpoints can be useful.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="direct.html">Direct</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Direct invocation of the consumer from the producer so that single threaded (non-SEDA) in VM invocation is performed which can be useful to mock out physical transports</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="seda.html">SEDA</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Delivers messages asynchonously to consumers via a <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/BlockingQueue.html" rel="nofollow">java.util.concurrent.BlockingQueue</a> which is good for testing asynchronous transports</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="stub.html">Stub</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Works like <a shape="rect" href="seda.html">SEDA</a> but does not validate the endpoint uri, which makes stubbing much easier.</p></td></tr></tbody></table></div><h3 id="BookInOnePage-Testingexistingroutes">Testing existing routes</h3><p>Camel provides some features to aid during testing of existing routes where you cannot or will not use <a shape="rect" href="mock.html">Mock</a> etc. For example you may have a production ready route which you want to test with some 3rd party API which sends messages into this route.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="notifybuilder.html">NotifyBuilder</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Allows you to be notified when a certain condition has occurred. For example when the route has completed 5 messages. You can build complex expressions to match your criteria when to be notified.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="advicewith.html">AdviceWith</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Allows you to <strong>advice</strong> or <strong>enhance</strong> an existing route using a <a shape="rect" href="routebuilder.html">RouteBuilder</a> style. For example you can add interceptors to intercept sending outgoing messages to assert those messages are as expected.</p></td></tr></tbody></table></div>
<h2 id="BookInOnePage-CamelTest">Camel Test</h2><p>As a simple alternative to using <a shape="rect" href="cdi-testing.html">CDI Testing</a>,&#160;<a shape="rect" href="spring-testing.html">Spring Testing</a> or <a shape="rect" href="guice.html">Guice</a> the <strong>camel-test</strong> module was introduced so you can perform powerful <a shape="rect" href="testing.html">Testing</a> of your <a shape="rect" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a> easily.</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>The <code>camel-test</code> JAR is using JUnit. There is an alternative <code>camel-testng</code> JAR (Camel 2.8 onwards) using the <a shape="rect" class="external-link" href="http://testng.org/doc/index.html" rel="nofollow">TestNG</a> test framework.</p></div></div><h3 id="BookInOnePage-Addingtoyourpom.xml">Adding to your pom.xml</h3><p>To get started using Camel Test you will need to add an entry to your pom.xml</p><h4 id="BookInOnePage-JUnit">JUnit</h4><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-test&lt;/artifactId&gt;
  &lt;version&gt;${camel-version}&lt;/version&gt;
  &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
]]></script>
</div></div><h4 id="BookInOnePage-TestNG">TestNG</h4><p><strong>Available as of Camel 2.8</strong></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-testng&lt;/artifactId&gt;
  &lt;version&gt;${camel-version}&lt;/version&gt;
  &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
]]></script>
</div></div><p>You might also want to add slf4j and log4j to ensure nice logging messages (and maybe adding a <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-test/src/test/resources/log4j.properties">log4j.properties</a> file into your src/test/resources directory).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
  &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
  &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;log4j&lt;/groupId&gt;
  &lt;artifactId&gt;log4j&lt;/artifactId&gt;
  &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
]]></script>
</div></div><h3 id="BookInOnePage-Writingyourtest">Writing your test</h3><p>You firstly need to derive from the class <strong>CamelTestSupport</strong>&#160;(org.apache.camel.test.CamelTestSupport, org.apache.camel.test.junit4.CamelTestSupport, or org.apache.camel.testng.CamelTestSupport for JUnit 3.x, JUnit 4.x, and TestNG, respectively)&#160;and typically you will need to override the <strong>createRouteBuilder()</strong> or&#160;<strong>createRouteBuilders()</strong>&#160;method to create routes to be tested.</p><p>Here is an <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-test/src/test/java/org/apache/camel/test/patterns/FilterTest.java">example</a>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// tag::example[]
public class FilterTest extends CamelTestSupport {

    @EndpointInject(uri = &quot;mock:result&quot;)
    protected MockEndpoint resultEndpoint;

    @Produce(uri = &quot;direct:start&quot;)
    protected ProducerTemplate template;

    @Override
    public boolean isDumpRouteCoverage() {
        return true;
    }

    @Test
    public void testSendMatchingMessage() throws Exception {
        String expectedBody = &quot;&lt;matched/&gt;&quot;;

        resultEndpoint.expectedBodiesReceived(expectedBody);

        template.sendBodyAndHeader(expectedBody, &quot;foo&quot;, &quot;bar&quot;);

        resultEndpoint.assertIsSatisfied();
    }

    @Test
    public void testSendNotMatchingMessage() throws Exception {
        resultEndpoint.expectedMessageCount(0);

        template.sendBodyAndHeader(&quot;&lt;notMatched/&gt;&quot;, &quot;foo&quot;, &quot;notMatchedHeaderValue&quot;);

        resultEndpoint.assertIsSatisfied();
    }

    @Override
    protected RouteBuilder createRouteBuilder() {
        return new RouteBuilder() {
            public void configure() {
                from(&quot;direct:start&quot;).filter(header(&quot;foo&quot;).isEqualTo(&quot;bar&quot;)).to(&quot;mock:result&quot;);
            }
        };
    }
}
// end::example[]
]]></script>
</div></div>Notice how you can use the various <a shape="rect" href="bean-integration.html">Camel binding and injection annotations</a> to inject individual <a shape="rect" href="endpoint.html">Endpoint</a> objects - particularly the <a shape="rect" href="mock.html">Mock endpoints</a> which are very useful for <a shape="rect" href="testing.html">Testing</a>. Also you can inject <a shape="rect" href="pojo-producing.html">producer objects such as ProducerTemplate or some application code interface</a> for sending messages or invoking services.<h4 id="BookInOnePage-FeaturesProvidedbyCamelTestSupport">Features Provided by CamelTestSupport</h4><p>The various <strong>CamelTestSupport</strong> classes provide a standard set of behaviors relating to the CamelContext used to host the route(s) under test. &#160;The classes provide a number of methods that allow a test to alter the configuration of the CamelContext used. &#160;The following table describes the available customization methods and the default behavior of tests that are built from a&#160;<strong>CamelTestSupport</strong> class.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Method Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Behavior</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean isUseRouteBuilder()</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If the route builders from returned from&#160;<strong>createRouteBuilder()</strong> or <strong>createRouteBuilders()</strong> should be added to the CamelContext used in the test should be started.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Returns true. &#160;<strong>createRouteBuilder()</strong>&#160;or&#160;<strong>createRouteBuilders()</strong> are invoked and the CamelContext is started automatically.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean isUseAdviceWith()</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If the CamelContext use in the test should be automatically started before test methods are invoked. <br clear="none" class="atl-forced-newline"> Override when using <a shape="rect" href="advicewith.html">advice with</a>&#160;and return true. &#160;This helps in knowing the adviceWith is to be used, and the&#160;CamelContext&#160;will not be started before&#160;the advice with takes place. This delay helps by ensuring the advice with has been property setup before the&#160;CamelContext&#160;is started.</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Its important to start the CamelContext manually from the unit test after you are done doing all the advice with.</p></div></div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Returns false. &#160;the CamelContext is started automatically before test methods are invoked.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean isCreateCamelContextPerClass()</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>See&#160;<a shape="rect" href="#BookInOnePage-SetupCamelContextonceperclass,orpereverytestmethod">Setup CamelContext once per class, or per every test method</a>.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The CamelContext and routes are recreated for each test method.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>String isMockEndpoints()</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Triggers the auto-mocking of endpoints whose URIs match the provided filter. &#160;The default&#160;filter is null which disables this feature. &#160;Return "*" &#160;to match all endpoints. &#160;See&#160;org.apache.camel.impl.InterceptSendToMockEndpointStrategy&#160;for&#160;more details on the registration of the mock endpoints.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Disabled</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean isUseDebugger()</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If this method returns true, the&#160;<strong>debugBefore(Exchange exchange, Processor processor, ProcessorDefinition&lt;?&gt; definition,&#160;String id, String label)</strong>&#160;and&#160;<br clear="none" class="atl-forced-newline"> <strong>debugAfter(Exchange exchange, Processor processor, ProcessorDefinition&lt;?&gt; definition,&#160;String id, String label, long timeTaken)</strong>&#160;methods are invoked for each processor in the registered routes.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Disabled. &#160;The methods are not invoked during the test.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>int getShutdownTimeout()</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Returns the number of seconds that Camel should wait for graceful shutdown. &#160;Useful for decreasing test times when a message is still in flight at the end of the test.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Returns 10 seconds.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean useJmx()</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If JMX should be disabled on the CamelContext used in the test.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>JMX is disabled.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>JndiRegistry createRegistry()</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Provides a hook for adding objects into the registry. &#160;Override this method to bind objects to the registry before test methods are invoked.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>An empty registry is initialized.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>useOverridePropertiesWithPropertiesComponent</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Allows to add/override properties when <a shape="rect" href="using-propertyplaceholder.html">Using PropertyPlaceholder</a> in Camel.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>null</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>ignoreMissingLocationWithPropertiesComponent</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Allows to control if Camel should ignore missing locations for properties.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>null</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">boolean isDumpRouteCoverage</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> If enabled, then Camel will dump all route coverage statistics into XML files in the target/camel-route-coverage directory. These XML files contains information about "route coverage" of all the routes that was used during the unit test. This allows tooling to inspect these XML files and generate nice route coverage reports.</td><td colspan="1" rowspan="1" class="confluenceTd">Disabled.</td></tr></tbody></table></div><h3 id="BookInOnePage-JNDI">JNDI</h3><p>Camel uses a <a shape="rect" href="registry.html">Registry</a> to allow you to configure <a shape="rect" href="component.html">Component</a> or <a shape="rect" href="endpoint.html">Endpoint</a> instances or <a shape="rect" href="bean-integration.html">Beans used in your routes</a>. If you are not using <a shape="rect" href="spring.html">Spring</a> or <a shape="rect" class="unresolved" href="#">OSGi</a> then <a shape="rect" href="jndi.html">JNDI</a> is used as the default registry implementation.</p><p>So you will also need to create a <strong>jndi.properties</strong> file in your <strong>src/test/resources</strong> directory so that there is a default registry available to initialise the <a shape="rect" href="camelcontext.html">CamelContext</a>.</p><p>Here is <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-test/src/test/resources/jndi.properties">an example jndi.properties file</a></p><h3 id="BookInOnePage-Dynamicallyassigningports">Dynamically assigning ports</h3><p><strong>Available as of Camel 2.7</strong></p><p>Tests that use port numbers will fail if that port is already on use. <code>AvailablePortFinder</code> provides methods for finding unused port numbers at runtime.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[// Get the next available port number starting from the default starting port of 1024
int port1 = AvailablePortFinder.getNextAvailable();
/*
 * Get another port. Note that just getting a port number does not reserve it so
 * we look starting one past the last port number we got.
 */
int port2 = AvailablePortFinder.getNextAvailable(port1 + 1);
]]></script>
</div></div><h3 id="BookInOnePage-SetupCamelContextonceperclass,orpereverytestmethod">Setup CamelContext once per class, or per every test method</h3><p><strong>Available as of Camel 2.8</strong></p><p>The <a shape="rect" href="camel-test.html">Camel Test</a> kit will by default setup and shutdown <a shape="rect" href="camelcontext.html">CamelContext</a> per every test method in your test class. So for example if you have 3 test methods, then <a shape="rect" href="camelcontext.html">CamelContext</a> is started and shutdown after each test, that is 3 times.</p><div class="confluence-information-macro confluence-information-macro-tip"><p class="title">TestNG</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>This feature is also supported in camel-testng</p></div></div><div class="confluence-information-macro confluence-information-macro-warning"><p class="title">Beware</p><span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>When using this the <a shape="rect" href="camelcontext.html">CamelContext</a> will keep state between tests, so have that in mind. So if your unit tests start to fail for no apparent reason, it could be due this fact. So use this feature with a bit of care.</p></div></div><p>You may want to do this once, to share the <a shape="rect" href="camelcontext.html">CamelContext</a> between test methods, to speedup unit testing. This requires to use JUnit 4! In your unit test method you have to extend the <code>org.apache.camel.test.junit4.CamelTestSupport</code> or the <code>org.apache.camel.test.junit4.CamelSpringTestSupport</code> test class and override the <code>isCreateCamelContextPerClass</code> method and return <code>true</code> as shown in the following example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Setup CamelContext once per class</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class FilterCreateCamelContextPerClassTest extends CamelTestSupport {

    @Override
    public boolean isCreateCamelContextPerClass() {
        // we override this method and return true, to tell Camel test-kit that
        // it should only create CamelContext once (per class), so we will
        // re-use the CamelContext between each test method in this class
        return true;
    }

    @Test
    public void testSendMatchingMessage() throws Exception {
        String expectedBody = &quot;&lt;matched/&gt;&quot;;

        getMockEndpoint(&quot;mock:result&quot;).expectedBodiesReceived(expectedBody);

        template.sendBodyAndHeader(&quot;direct:start&quot;, expectedBody, &quot;foo&quot;, &quot;bar&quot;);

        assertMockEndpointsSatisfied();
    }

    @Test
    public void testSendNotMatchingMessage() throws Exception {
        getMockEndpoint(&quot;mock:result&quot;).expectedMessageCount(0);

        template.sendBodyAndHeader(&quot;direct:start&quot;, &quot;&lt;notMatched/&gt;&quot;, &quot;foo&quot;, &quot;notMatchedHeaderValue&quot;);

        assertMockEndpointsSatisfied();
    }

    @Override
    protected RouteBuilder createRouteBuilder() {
        return new RouteBuilder() {
            public void configure() {
                from(&quot;direct:start&quot;).filter(header(&quot;foo&quot;).isEqualTo(&quot;bar&quot;)).to(&quot;mock:result&quot;);
            }
        };
    }
}
]]></script>
</div></div><h3 id="BookInOnePage-SeeAlso.1">See Also</h3><ul><li><a shape="rect" href="testing.html">Testing</a></li><li><a shape="rect" href="mock.html">Mock</a></li><li><a shape="rect" href="test.html">Test</a></li></ul><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[java.naming.factory.initial = org.apache.camel.util.jndi.CamelInitialContextFactory
]]></script>
</div></div>
<h2 id="BookInOnePage-SpringTesting">Spring Testing</h2><p><a shape="rect" href="testing.html">Testing</a> is a crucial part of any development or integration work. The Spring Framework offers a number of features that makes it easy to test while using Spring for Inversion of Control which works with JUnit 3.x, JUnit 4.x, and <a shape="rect" class="external-link" href="http://testng.org" rel="nofollow">TestNG</a>.</p><p>We can use Spring for IoC and the Camel <a shape="rect" href="mock.html">Mock</a> and <a shape="rect" href="test.html">Test</a> endpoints to create sophisticated integration/unit tests that are easy to run and debug inside your IDE. &#160;There are three supported approaches for testing with Spring in Camel.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Testing Frameworks Supported</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Required Camel Test Dependencies</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>CamelSpringTestSupport</p></td><td colspan="1" rowspan="1" class="confluenceTd"><ul><li>JUnit 3.x (deprecated)</li><li>JUnit 4.x</li><li>TestNG - <strong>Camel 2.8</strong></li></ul></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Provided by org.apache.camel.test.CamelSpringTestSupport, org.apache.camel.test.junit4.CamelSpringTestSupport, and org.apache.camel.testng.CamelSpringTestSupport. &#160;These base classes provide <a shape="rect" href="camel-test.html#CamelTest-FeaturesProvidedbyCamelTestSupport">feature parity</a> with&#160;the simple CamelTestSupport classes from&#160;<a shape="rect" href="camel-test.html">Camel Test</a>&#160;but do not support Spring annotations on the test class such as <strong>@Autowired</strong>,&#160;<strong>@DirtiesContext</strong>, and&#160;<strong>@ContextConfiguration</strong>.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><ul><li>JUnit 3.x (deprecated) - camel-test-spring</li><li>JUnit 4.x&#160;- camel-test-spring</li><li>TestNG - camel-test-ng</li></ul></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>Plain Spring Test</p></td><td colspan="1" rowspan="1" class="confluenceTd"><ul><li>JUnit 3.x</li><li>JUnit 4.x</li><li>TestNG</li></ul></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Extend the abstract base classes (org.springframework.test.context.junit38.AbstractJUnit38SpringContextTests,&#160;org.springframework.test.context.junit38.AbstractJUnit4SpringContextTests, etc.)&#160;provided in Spring Test or use the Spring Test JUnit4 runner. &#160;These approaches support both the Camel annotations and Spring annotations, but do not have <a shape="rect" href="camel-test.html#CamelTest-FeaturesProvidedbyCamelTestSupport">feature parity</a> with&#160;org.apache.camel.test.CamelTestSupport, org.apache.camel.test.junit4.CamelTestSupport, and org.apache.camel.testng.CamelSpringTestSupport.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><ul><li>JUnit 3.x (deprecated) - None</li><li>JUnit 4.x&#160;- None</li><li>TestNG - None</li></ul></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>Camel Enhanced Spring Test</p></td><td colspan="1" rowspan="1" class="confluenceTd"><ul><li>JUnit 4.x - <strong>Camel 2.10</strong></li><li>TestNG - <strong>Camel 2.10</strong></li></ul></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Use the org.apache.camel.test.junit4.CamelSpringJUnit4ClassRunner&#160;runner with the&#160;<strong>@RunWith</strong>&#160;annotation or extend org.apache.camel.testng.AbstractCamelTestNGSpringContextTests&#160;to enable <a shape="rect" href="camel-test.html#CamelTest-FeaturesProvidedbyCamelTestSupport">feature parity</a> with org.apache.camel.test.CamelTestSupport and org.apache.camel.test.junit4.CamelTestSupport and also support the full suite of Spring Test annotations such as&#160;<strong>@Autowired</strong>,&#160;<strong>@DirtiesContext</strong>, and <strong>@ContextConfiguration</strong>.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><ul><li>JUnit 3.x (deprecated) - camel-test-spring</li><li>JUnit 4.x&#160;- camel-test-spring</li><li>TestNG - camel-test-ng</li></ul></td></tr></tbody></table></div><h3 id="BookInOnePage-CamelSpringTestSupport">CamelSpringTestSupport</h3><p>org.apache.camel.test.CamelSpringTestSupport, org.apache.camel.test.junit4.CamelSpringTestSupport, and org.apache.camel.testng.CamelSpringTestSupport&#160;extend their non-Spring aware counterparts (org.apache.camel.test.CamelTestSupport, org.apache.camel.test.junit4.CamelTestSupport, and org.apache.camel.testng.CamelTestSupport) and deliver integration with Spring into your test classes. &#160;Instead of&#160;instantiating&#160;the CamelContext and routes programmatically, these classes rely on a Spring context to wire the needed components together. &#160;If your test extends one of these classes, you must provide the Spring context by implementing the following method.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[protected abstract AbstractApplicationContext createApplicationContext();
]]></script>
</div></div><p>You are responsible for the instantiation of the Spring context in the method implementation. &#160;All of the features available in the non-Spring aware counterparts from <a shape="rect" href="camel-test.html">Camel Test</a> are available in your test.</p><h3 id="BookInOnePage-PlainSpringTest">Plain Spring Test</h3><p>In this approach, your test classes directly inherit from the Spring Test abstract test classes or use the JUnit 4.x test runner provided in Spring Test. &#160;This approach supports&#160;dependency&#160;injection into your test class and the full suite of Spring Test annotations but does not support the features provided by the CamelSpringTestSupport classes.</p><h4 id="BookInOnePage-PlainSpringTestusingJUnit3.xwithXMLConfigExample">Plain Spring Test using JUnit 3.x with XML Config Example</h4><p>Here is a simple unit test using JUnit 3.x support from Spring Test using&#160;<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-spring/src/test/java/org/apache/camel/spring/patterns/FilterTest.java">XML Config</a>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// tag::example[]
@ContextConfiguration
public class FilterTest extends SpringRunWithTestSupport {

    @EndpointInject(uri = &quot;mock:result&quot;)
    protected MockEndpoint resultEndpoint;

    @Produce(uri = &quot;direct:start&quot;)
    protected ProducerTemplate template;

    @DirtiesContext
    @Test
    public void testSendMatchingMessage() throws Exception {
        String expectedBody = &quot;&lt;matched/&gt;&quot;;

        resultEndpoint.expectedBodiesReceived(expectedBody);

        template.sendBodyAndHeader(expectedBody, &quot;foo&quot;, &quot;bar&quot;);

        resultEndpoint.assertIsSatisfied();
    }

    @DirtiesContext
    @Test
    public void testSendNotMatchingMessage() throws Exception {
        resultEndpoint.expectedMessageCount(0);

        template.sendBodyAndHeader(&quot;&lt;notMatched/&gt;&quot;, &quot;foo&quot;, &quot;notMatchedHeaderValue&quot;);

        resultEndpoint.assertIsSatisfied();
    }
}
// end::example[]
]]></script>
</div></div>Notice that we use&#160;<strong>@DirtiesContext</strong>&#160;on the test methods to force&#160;<a shape="rect" href="spring-testing.html">Spring Testing</a>&#160;to automatically reload the&#160;<a shape="rect" href="camelcontext.html">CamelContext</a>&#160;after each test method - this ensures that the tests don't clash with each other (e.g. one test method sending to an endpoint that is then reused in another test method).<p>Also notice the use of&#160;<strong>@ContextConfiguration</strong>&#160;to indicate that by default we should look for the&#160;<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-spring/src/test/resources/org/apache/camel/spring/patterns/FilterTest-context.xml">FilterTest-context.xml on the classpath</a>&#160;to configure the test case which looks like this</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;!-- tag::example[] --&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xsi:schemaLocation=&quot;
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd
    &quot;&gt;

  &lt;camelContext xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;
    &lt;route&gt;
      &lt;from uri=&quot;direct:start&quot;/&gt;
      &lt;filter&gt;
        &lt;xpath&gt;$foo = &#39;bar&#39;&lt;/xpath&gt;
        &lt;to uri=&quot;mock:result&quot;/&gt;
      &lt;/filter&gt;
    &lt;/route&gt;
  &lt;/camelContext&gt;

&lt;/beans&gt;
&lt;!-- end::example[] --&gt;
]]></script>
</div></div>This test will load a Spring XML configuration file calledFilterTest-context.xml&#160;from the classpath in the same package structure as the FilterTest class and initialize it along with any Camel routes we define inside it, then inject theCamelContextinstance into our test case.<p>For instance, like this maven folder layout:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[src/test/java/org/apache/camel/spring/patterns/FilterTest.java
src/test/resources/org/apache/camel/spring/patterns/FilterTest-context.xml
]]></script>
</div></div><h4 id="BookInOnePage-PlainSpringTestusingJUnit4.xwithJavaConfigExample">Plain Spring Test using JUnit 4.x with Java Config Example</h4><p>You can completely avoid using an XML configuration file by using <a shape="rect" href="spring-java-config.html">Spring Java Config</a>. &#160;Here is a unit test using JUnit 4.x support from Spring Test using&#160;<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-spring-javaconfig/src/test/java/org/apache/camel/spring/javaconfig/patterns/FilterTest.java">Java Config</a>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// tag::example[]
@RunWith(CamelSpringJUnit4ClassRunner.class)
@ContextConfiguration(classes = {FilterTest.ContextConfig.class}, loader = CamelSpringDelegatingTestContextLoader.class)
public class FilterTest extends AbstractJUnit4SpringContextTests {

    @EndpointInject(uri = &quot;mock:result&quot;)
    protected MockEndpoint resultEndpoint;

    @Produce(uri = &quot;direct:start&quot;)
    protected ProducerTemplate template;

    @DirtiesContext
    @Test
    public void testSendMatchingMessage() throws Exception {
        String expectedBody = &quot;&lt;matched/&gt;&quot;;

        resultEndpoint.expectedBodiesReceived(expectedBody);

        template.sendBodyAndHeader(expectedBody, &quot;foo&quot;, &quot;bar&quot;);

        resultEndpoint.assertIsSatisfied();
    }

    @DirtiesContext
    @Test
    public void testSendNotMatchingMessage() throws Exception {
        resultEndpoint.expectedMessageCount(0);

        template.sendBodyAndHeader(&quot;&lt;notMatched/&gt;&quot;, &quot;foo&quot;, &quot;notMatchedHeaderValue&quot;);

        resultEndpoint.assertIsSatisfied();
    }

    @Configuration
    public static class ContextConfig extends SingleRouteCamelConfiguration {
        @Bean
        public RouteBuilder route() {
            return new RouteBuilder() {
                public void configure() {
                    from(&quot;direct:start&quot;).filter(header(&quot;foo&quot;).isEqualTo(&quot;bar&quot;)).to(&quot;mock:result&quot;);
                }
            };
        }
    }
}
// end::example[]
]]></script>
</div></div>This is similar to the XML Config example above except that there is no XML file and instead the nested <strong>ContextConfig</strong> class does all of the configuration; so your entire test case is contained in a single Java class. We currently have to reference by class name this class in the <strong>@ContextConfiguration</strong> which is a bit ugly. Please vote for <a shape="rect" class="external-link" href="http://jira.springframework.org/browse/SJC-238" rel="nofollow">SJC-238</a> to address this and make Spring Test work more cleanly with Spring JavaConfig.<h4 id="BookInOnePage-PlainSpringTestusingJUnit4.0.xRunnerwithXMLConfig">Plain Spring Test using JUnit 4.0.x Runner with XML Config</h4><p>You can avoid extending Spring classes by using the SpringJUnit4ClassRunner provided by Spring Test. &#160;This custom JUnit runner means you are free to choose your own class hierarchy while retaining all the capabilities of Spring Test.</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>This is for Spring 4.0.x. If you use Spring 4.1 or newer, then see the next section.</p></div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration
public class MyCamelTest {

  @Autowired
  protected CamelContext camelContext;

  @EndpointInject(uri = &quot;mock:foo&quot;)
  protected MockEndpoint foo;


    @Test
    @DirtiesContext
  public void testMocksAreValid() throws Exception {
        ...   

    foo.message(0).header(&quot;bar&quot;).isEqualTo(&quot;ABC&quot;);

    MockEndpoint.assertIsSatisfied(camelContext);
  }
}
]]></script>
</div></div><h4 id="BookInOnePage-PlainSpringTestusingJUnit4.1.xRunnerwithXMLConfig">Plain Spring Test using JUnit 4.1.x Runner with XML Config</h4><p>You can avoid extending Spring classes by using the SpringJUnit4ClassRunner provided by Spring Test. &#160;This custom JUnit runner means you are free to choose your own class hierarchy while retaining all the capabilities of Spring Test.</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>When using Spring 4.1 onwards, you need to use the @BootstrapWith annotation to configure it to use Camel testing, as shown below.</p></div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@RunWith(CamelSpringJUnit4ClassRunner.class)
@BootstrapWith(CamelTestContextBootstrapper.class)
@ContextConfiguration
public class MyCamelTest {

  @Autowired
  protected CamelContext camelContext;

  @EndpointInject(uri = &quot;mock:foo&quot;)
  protected MockEndpoint foo;


    @Test
    @DirtiesContext
  public void testMocksAreValid() throws Exception {
        ...   

    foo.message(0).header(&quot;bar&quot;).isEqualTo(&quot;ABC&quot;);

    MockEndpoint.assertIsSatisfied(camelContext);
  }
}
]]></script>
</div></div><h3 id="BookInOnePage-CamelEnhancedSpringTest"><span style="line-height: 1.5625;">Camel Enhanced Spring Test</span></h3><p>Using org.apache.camel.test.junit4.CamelSpringJUnit4ClassRunner&#160;runner with the&#160;<strong>@RunWith</strong>&#160;annotation or extending org.apache.camel.testng.AbstractCamelTestNGSpringContextTests provides the full feature set of Spring Test with support for the feature set provided in the CamelTestSupport classes. &#160;A number of Camel specific annotations have been developed in order to provide for declarative manipulation of the Camel context(s) involved in the test. &#160;These annotations free your test classes from having to inherit from the CamelSpringTestSupport classes and also reduce the amount of code required to customize the tests.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Annotation Class</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Applies To</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Behavioir If Not Present</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Behavior If Present</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.camel.test.spring.DisableJmx</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Class</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Indicates if JMX should be globally disabled in the CamelContexts that are bootstrapped &#160;during the test through the use of Spring Test loaded application contexts.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>JMX is disabled</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>JMX is disabled</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.camel.test.spring.ExcludeRoutes</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Class</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Indicates if certain route builder classes should be excluded from discovery. &#160;Initializes a org.apache.camel.spi.PackageScanClassResolver&#160;to exclude a set of given classes from being resolved. Typically this is used at test time to exclude certain routes,&#160;which might otherwise be just noisy, from being discovered and initialized.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Not enabled and no routes are excluded</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No routes are excluded</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.camel.test.spring.LazyLoadTypeConverters (Deprecated)</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Class</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Indicates if the&#160;CamelContexts that are bootstrapped during the test through the use of Spring Test&#160;loaded application contexts should use lazy loading of type converters.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Type converters are not lazy loaded</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Type converters are not lazy loaded</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.camel.test.spring.MockEndpoints</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Class</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Triggers the auto-mocking of endpoints whose URIs match the provided filter.&#160; The default&#160;filter is "*" which matches all endpoints. &#160;See&#160;org.apache.camel.impl.InterceptSendToMockEndpointStrategy&#160;for&#160;more details on the registration of the mock endpoints.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Not enabled</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>All endpoints are sniffed and recorded in a mock endpoint.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.camel.test.spring.MockEndpointsAndSkip</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Class</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Triggers the auto-mocking of endpoints whose URIs match the provided filter.&#160; The default&#160;filter is "*", which matches all endpoints. &#160;See&#160;<a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/camel-core/src/main/java/org/apache/camel/impl/InterceptSendToMockEndpointStrategy.java?view=markup">org.apache.camel.impl.InterceptSendToMockEndpointStrategy</a>&#160;for&#160;more details on the registration of the mock endpoints. &#160;This annotation will also skip sending the message to matched endpoints as well.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Not enabled</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>All endpoints are sniffed and recorded in a mock endpoint. &#160;The original endpoint is not invoked.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.camel.test.spring.ProvidesBreakpoint</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Method</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Indicates that the annotated method returns an&#160;org.apache.camel.spi.Breakpoint&#160;for use in the test.&#160; Useful for intercepting&#160;traffic to all endpoints or simply for setting a break point in an IDE for debugging.&#160; The method must&#160;be public, static, take no arguments, and return org.apache.camel.spi.Breakpoint.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>N/A</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The returned Breakpoint is registered in the CamelContext(s)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.camel.test.spring.ShutdownTimeout</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Class</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Indicates to set the shutdown timeout of all CamelContexts instantiated through the&#160;use of Spring Test loaded application contexts.&#160; If no annotation is used, the timeout is&#160;automatically reduced to 10 seconds by the test framework.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>10 seconds</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>10 seconds</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.camel.test.spring.UseAdviceWith</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Class</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Indicates the use of adviceWith() within the test class.&#160; If a class is annotated with&#160;this annotation and UseAdviceWith#value()&#160;returns true, any&#160;CamelContexts bootstrapped during the test through the use of Spring Test loaded&#160;application contexts will not be started automatically.&#160; The test author is responsible for&#160;injecting the Camel contexts into the test and executing CamelContext#start()&#160;on them&#160;at the appropriate time after any advice has been applied to the routes in the CamelContext(s).</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>CamelContexts do not automatically start.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>CamelContexts do not automatically start.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">org.apache.camel.test.spring.UseOverridePropertiesWithPropertiesComponent</td><td colspan="1" rowspan="1" class="confluenceTd">Method</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong>Indicates that the annotated method returns a java.util.Properties for use in the test, and that those properties override any existing properties configured on the PropertiesComponent</td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd">Override properties</td></tr></tbody></table></div><p>The following example illustrates the use of the <strong>@MockEndpoints</strong>&#160;annotation in order to setup mock endpoints as interceptors on all endpoints using the Camel Log component and the <strong>@DisableJmx</strong> annotation to enable JMX which is disabled during tests by default. &#160;Note that we still use the <strong>@DirtiesContext</strong> annotation to ensure that the CamelContext, routes, and mock endpoints are reinitialized between test methods.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@RunWith(CamelSpringJUnit4ClassRunner.class)
@BootstrapWith(CamelTestContextBootstrapper.class)
@ContextConfiguration
@DirtiesContext(classMode = ClassMode.AFTER_EACH_TEST_METHOD)
@MockEndpoints(&quot;log:*&quot;)
@DisableJmx(false)
public class CamelSpringJUnit4ClassRunnerPlainTest {

    @Autowired
    protected CamelContext camelContext2;

    protected MockEndpoint mockB;

    @EndpointInject(uri = &quot;mock:c&quot;, context = &quot;camelContext2&quot;)
    protected MockEndpoint mockC;

    @Produce(uri = &quot;direct:start2&quot;, context = &quot;camelContext2&quot;)
    protected ProducerTemplate start2;

    @EndpointInject(uri = &quot;mock:log:org.apache.camel.test.junit4.spring&quot;, context = &quot;camelContext2&quot;)
    protected MockEndpoint mockLog;

    @Test
    public void testPositive() throws Exception {

        mockC.expectedBodiesReceived(&quot;David&quot;);
        mockLog.expectedBodiesReceived(&quot;Hello David&quot;);

        start2.sendBody(&quot;David&quot;);

        MockEndpoint.assertIsSatisfied(camelContext);
    }
]]></script>
</div></div><h3 id="BookInOnePage-AddingmoreMockexpectations">Adding more Mock expectations</h3><p>If you wish to programmatically add any new assertions to your test you can easily do so with the following. Notice how we use @EndpointInject to inject a Camel endpoint into our code then the <a shape="rect" href="mock.html">Mock</a> API to add an expectation on a specific message.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@ContextConfiguration
public class MyCamelTest extends AbstractJUnit38SpringContextTests {

    @Autowired
    protected CamelContext camelContext;

    @EndpointInject(uri = &quot;mock:foo&quot;)
    protected MockEndpoint foo;

    public void testMocksAreValid() throws Exception {
        // lets add more expectations
        foo.message(0).header(&quot;bar&quot;).isEqualTo(&quot;ABC&quot;);

        MockEndpoint.assertIsSatisfied(camelContext);
    }
}
]]></script>
</div></div><h3 id="BookInOnePage-Furtherprocessingthereceivedmessages">Further processing the received messages</h3><p>Sometimes once a <a shape="rect" href="mock.html">Mock</a> endpoint has received some messages you want to then process them further to add further assertions that your test case worked as you expect.</p><p>So you can then process the received message exchanges if you like...</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@ContextConfiguration
public class MyCamelTest extends AbstractJUnit38SpringContextTests {

    @Autowired
    protected CamelContext camelContext;

    @EndpointInject(uri = &quot;mock:foo&quot;)
    protected MockEndpoint foo;

    public void testMocksAreValid() throws Exception {
        // lets add more expectations...

        MockEndpoint.assertIsSatisfied(camelContext);

		// now lets do some further assertions
        List&lt;Exchange&gt; list = foo.getReceivedExchanges();
        for (Exchange exchange : list) {
            Message in = exchange.getIn();
            ...
        }
    }
}
]]></script>
</div></div><h3 id="BookInOnePage-Sendingandreceivingmessages">Sending and receiving messages</h3><p>It might be that the <a shape="rect" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a> you have defined in either <a shape="rect" href="spring.html">Spring</a> XML or using the Java <a shape="rect" href="dsl.html">DSL</a> do all of the sending and receiving and you might just work with the <a shape="rect" href="mock.html">Mock</a> endpoints as described above. However sometimes in a test case its useful to explicitly send or receive messages directly.</p><p>To send or receive messages you should use the <a shape="rect" href="bean-integration.html">Bean Integration</a> mechanism. For example to send messages inject a ProducerTemplate using the @EndpointInject annotation then call the various send methods on this object to send a message to an endpoint. To consume messages use the @MessageDriven annotation on a method to have the method invoked when a message is received.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public class Foo {
  @EndpointInject(uri=&quot;activemq:foo.bar&quot;)
  ProducerTemplate producer;

  public void doSomething() {
    // lets send a message!
    producer.sendBody(&quot;&lt;hello&gt;world!&lt;/hello&gt;&quot;);
  }

  // lets consume messages from the &#39;cheese&#39; queue
  @MessageDriven(uri=&quot;activemq:cheese&quot;)
  public void onCheese(String name) {
    ...
  }
}
]]></script>
</div></div><h3 id="BookInOnePage-SeeAlso.2">See Also</h3><ul><li>A <a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/camel/trunk/components/camel-spring/src/test/java/org/apache/camel/spring/mock/InterceptSendToMockEndpointStrategyTest.java">real example test case using Mock and Spring</a> along with its <a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/camel/trunk/components/camel-spring/src/test/resources/org/apache/camel/spring/mock/InterceptSendToMockEndpointStrategyTest.xml">Spring XML</a></li><li><a shape="rect" href="bean-integration.html">Bean Integration</a></li><li><a shape="rect" href="mock.html">Mock</a> endpoint</li><li><a shape="rect" href="test.html">Test</a> endpoint</li></ul>
<h2 id="BookInOnePage-CamelGuice">Camel Guice</h2>

<p>We have support for <a shape="rect" class="external-link" href="http://code.google.com/p/google-guice/" rel="nofollow">Google Guice</a> as a dependency injection framework.</p>

<p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
    &lt;artifactId&gt;camel-guice&lt;/artifactId&gt;
    &lt;version&gt;x.x.x&lt;/version&gt;
    &lt;!-- use the same version as your Camel core version --&gt;
&lt;/dependency&gt;
]]></script>
</div></div>

<h3 id="BookInOnePage-DependencyInjectingCamelwithGuice">Dependency Injecting Camel with Guice</h3>

<p>The <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-guice/apidocs/org/apache/camel/guice/GuiceCamelContext.html">GuiceCamelContext</a> is designed to work nicely inside Guice. You then need to bind it using some Guice Module.</p>

<p>The camel-guice library comes with a number of reusable Guice Modules you can use if you wish - or you can bind the GuiceCamelContext yourself in your own module.</p>

<ul><li><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-guice/apidocs/org/apache/camel/guice/CamelModule.html">CamelModule</a> is the base module which binds the GuiceCamelContext but leaves it up you to bind the RouteBuilder instances</li><li><a shape="rect" href="hhttp://camel.apache.org/maven/current/camel-guice/apidocs/org/apache/camel/guice/CamelModuleWithRouteTypes.html" rel="nofollow">CamelModuleWithRouteTypes</a> extends CamelModule so that in the constructor of the module you specify the RouteBuilder classes or instances to use</li><li><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-guice/apidocs/org/apache/camel/guice/CamelModuleWithMatchingRoutes.html">CamelModuleWithMatchingRoutes</a> extends CamelModule so that all bound RouteBuilder instances will be injected into the CamelContext or you can supply an optional Matcher to find RouteBuilder instances matching some kind of predicate.</li></ul>


<p>So you can specify the exact <a shape="rect" href="routebuilder.html">RouteBuilder</a> instances you want</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
Injector injector = Guice.createInjector(new CamelModuleWithRouteTypes(MyRouteBuilder.class, AnotherRouteBuilder.class));
// if required you can lookup the CamelContext
CamelContext camelContext = injector.getInstance(CamelContext.class);
]]></script>
</div></div>

<p>Or inject them all</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
Injector injector = Guice.createInjector(new CamelModuleWithRouteTypes());
// if required you can lookup the CamelContext
CamelContext camelContext = injector.getInstance(CamelContext.class);
]]></script>
</div></div>

<p>You can then use Guice in the usual way to inject the route instances or any other dependent objects.</p>

<h3 id="BookInOnePage-BootstrappingwithJNDI">Bootstrapping with JNDI</h3>

<p>A common pattern used in J2EE is to bootstrap your application or root objects by looking them up in JNDI. This has long been the approach when working with JMS for example - looking up the JMS ConnectionFactory in JNDI for example.</p>

<p>You can follow a similar pattern with Guice using the <a shape="rect" class="external-link" href="http://code.google.com/p/guiceyfruit/wiki/GuiceyJndi" rel="nofollow">GuiceyFruit JNDI Provider</a> which lets you bootstrap Guice from a <strong>jndi.properties</strong> file which can include the Guice Modules to create along with environment specific properties you can inject into your modules and objects.</p>

<p>If the <strong>jndi.properties</strong> is conflict with other component, you can specify the jndi properties file name in the Guice Main with option -j or -jndiProperties with the properties file location to let Guice Main to load right jndi properties file.</p>

<h3 id="BookInOnePage-ConfiguringComponent,EndpointorRouteBuilderinstances">Configuring Component, Endpoint or RouteBuilder instances</h3>

<p>You can use <a shape="rect" href="guice.html">Guice</a> to dependency inject whatever objects you need to create, be it an <a shape="rect" href="endpoint.html">Endpoint</a>, <a shape="rect" href="component.html">Component</a>, <a shape="rect" href="routebuilder.html">RouteBuilder</a> or arbitrary <a shape="rect" href="bean-integration.html">bean used within a route</a>. </p>

<p>The easiest way to do this is to create your own Guice Module class which extends one of the above module classes and add a provider method for each object you wish to create. A provider method is annotated with <strong>@Provides</strong> as follows</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class MyModule extends CamelModuleWithMatchingRoutes {

    @Provides
    @JndiBind(&quot;jms&quot;)
    JmsComponent jms(@Named(&quot;activemq.brokerURL&quot;) String brokerUrl) {
        return JmsComponent.jmsComponent(new ActiveMQConnectionFactory(brokerUrl));
    }
}
]]></script>
</div></div>

<p>You can optionally annotate the method with <strong>@JndiBind</strong> to bind the object to JNDI at some name if the object is a component, endpoint or bean you wish to refer to by name in your routes.</p>

<p>You can inject any environment specific properties (such as URLs, machine names, usernames/passwords and so forth) from the jndi.properties file easily using the <strong>@Named</strong> annotation as shown above. This allows most of your configuration to be in Java code which is typesafe and easily refactorable - then leaving some properties to be environment specific (the jndi.properties file) which you can then change based on development, testing, production etc.</p>


<h3 id="BookInOnePage-CreatingmultipleRouteBuilderinstancespertype">Creating multiple RouteBuilder instances per type</h3>

<p>It is sometimes useful to create multiple instances of a particular <a shape="rect" href="routebuilder.html">RouteBuilder</a> with different configurations.</p>

<p>To do this just create multiple provider methods for each configuration; or create a single provider method that returns a collection of RouteBuilder instances.</p>

<p>For example</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
import org.apache.camel.guice.CamelModuleWithMatchingRoutes;
import com.google.common.collect.Lists;

public class MyModule extends CamelModuleWithMatchingRoutes {

    @Provides
    @JndiBind(&quot;foo&quot;)
    Collection&lt;RouteBuilder&gt; foo(@Named(&quot;fooUrl&quot;) String fooUrl) {
        return Lists.newArrayList(new MyRouteBuilder(fooUrl), new MyRouteBuilder(&quot;activemq:CheeseQueue&quot;));
    }
}
]]></script>
</div></div>

<h3 id="BookInOnePage-SeeAlso.3">See Also</h3>

<ul><li>there are a number of <a shape="rect" href="examples.html">Examples</a> you can look at to see Guice and Camel being used such as <a shape="rect" href="guice-jms-example.html">Guice JMS Example</a></li><li><a shape="rect" href="guice-maven-plugin.html">Guice Maven Plugin</a> for running your Guice based routes via Maven</li></ul>
<h2 id="BookInOnePage-Templating">Templating</h2><p>When you are testing distributed systems its a very common requirement to have to stub out certain external systems with some stub so that you can test other parts of the system until a specific system is available or written etc.</p><p>A great way to do this is using some kind of Template system to generate responses to requests generating a dynamic message using a mostly-static body.</p><p>There are a number of templating components included in the Camel distribution you could use</p><ul><li><a shape="rect" href="freemarker.html">FreeMarker</a></li><li><a shape="rect" href="mustache.html">Mustache</a></li><li><a shape="rect" href="stringtemplate.html">StringTemplate</a></li><li><a shape="rect" href="velocity.html">Velocity</a></li><li><a shape="rect" href="xquery.html">XQuery</a></li><li><a shape="rect" href="xslt.html">XSLT</a></li></ul><p>or the following external Camel components</p><ul><li><a shape="rect" class="external-link" href="http://scalate.fusesource.org/camel.html" rel="nofollow">Scalate</a></li></ul><h3 id="BookInOnePage-Example.1">Example</h3><p>Here's a simple example showing how we can respond to InOut requests on the <strong>My.Queue</strong> queue on <a shape="rect" href="activemq.html">ActiveMQ</a> with a template generated response. The reply would be sent back to the JMSReplyTo Destination.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;activemq:My.Queue&quot;).
  to(&quot;velocity:com/acme/MyResponse.vm&quot;);
]]></script>
</div></div><p>If you want to use InOnly and consume the message and send it to another destination you could use</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;activemq:My.Queue&quot;).
  to(&quot;velocity:com/acme/MyResponse.vm&quot;).
  to(&quot;activemq:Another.Queue&quot;);
]]></script>
</div></div><h3 id="BookInOnePage-SeeAlso.4">See Also</h3><ul><li><a shape="rect" href="mock.html">Mock</a> for details of mock endpoint testing (as opposed to template based stubs).</li></ul>
<h2 id="BookInOnePage-Database">Database</h2><p>Camel can work with databases in a number of different ways. This document tries to outline the most common approaches.</p><h3 id="BookInOnePage-Databaseendpoints">Database endpoints</h3><p>Camel provides a number of different endpoints for working with databases</p><ul><li><a shape="rect" href="jpa.html">JPA</a> for working with hibernate, openjpa or toplink. When consuming from the endpoints entity beans are read (and deleted/updated to mark as processed) then when producing to the endpoints they are written to the database (via insert/update).</li><li><a shape="rect" href="ibatis.html">iBATIS</a> similar to the above but using <a shape="rect" class="external-link" href="http://ibatis.apache.org/">Apache iBATIS</a></li><li><a shape="rect" href="jdbc.html">JDBC</a> similar though using explicit SQL</li><li><a shape="rect" href="sql-component.html">SQL</a><span style="color: rgb(0,0,0);">&#160;uses<a shape="rect" class="external-link" href="http://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/jdbc.html" rel="nofollow"> spring-jdbc</a> behind&#160;</span>the scene for the actual SQL handling.&#160;The difference between this component and&#160;<a shape="rect" class="external-link" href="http://camel.apache.org/jdbc.html">JDBC</a>&#160;component is that in case of SQL the query is a property of the endpoint and it uses message payload as parameters passed to the query</li></ul><h3 id="BookInOnePage-Databasepatternimplementations">Database pattern implementations</h3><p>Various patterns can work with databases as follows</p><ul><li><a shape="rect" href="idempotent-consumer.html">Idempotent Consumer</a></li><li><a shape="rect" href="aggregator.html">Aggregator</a></li><li><a shape="rect" href="bam.html">BAM</a> for business activity monitoring</li></ul>
<h2 id="BookInOnePage-ParallelProcessingandOrdering">Parallel Processing and Ordering</h2><p>It is a common requirement to want to use parallel processing of messages for throughput and load balancing, while at the same time process certain kinds of messages in order.</p><h3 id="BookInOnePage-Howtoachieveparallelprocessing">How to achieve parallel processing</h3><p>You can send messages to a number of Camel <a shape="rect" href="components.html">Components</a> to achieve parallel processing and load balancing such as</p><ul><li><a shape="rect" href="seda.html">SEDA</a> for in-JVM load balancing across a thread pool</li><li><a shape="rect" href="activemq.html">ActiveMQ</a> or <a shape="rect" href="jms.html">JMS</a> for distributed load balancing and parallel processing</li><li><a shape="rect" href="jpa.html">JPA</a> for using the database as a poor mans message broker</li></ul><p>When processing messages concurrently, you should consider ordering and concurrency issues. These are described below</p><h4 id="BookInOnePage-Concurrencyissues">Concurrency issues</h4><p>Note that there is no concurrency or locking issue when using <a shape="rect" href="activemq.html">ActiveMQ</a>, <a shape="rect" href="jms.html">JMS</a> or <a shape="rect" href="seda.html">SEDA</a> by design; they are designed for highly concurrent use. However there are possible concurrency issues in the <a shape="rect" href="processor.html">Processor</a> of the messages i.e. what the processor does with the message?</p><p>For example if a processor of a message transfers money from one account to another account; you probably want to use a database with pessimistic locking to ensure that operation takes place atomically.</p><h4 id="BookInOnePage-Orderingissues">Ordering issues</h4><p>As soon as you send multiple messages to different threads or processes you will end up with an unknown ordering across the entire message stream as each thread is going to process messages concurrently.</p><p>For many use cases the order of messages is not too important. However for some applications this can be crucial. e.g. if a customer submits a purchase order version 1, then amends it and sends version 2; you don't want to process the first version last (so that you loose the update). Your <a shape="rect" href="processor.html">Processor</a> might be clever enough to ignore old messages. If not you need to preserve order.</p><h3 id="BookInOnePage-Recommendations">Recommendations</h3><p>This topic is large and diverse with lots of different requirements; but from a high level here are our recommendations on parallel processing, ordering and concurrency</p><ul><li>for distributed locking, use a database by default, they are very good at it <img class="emoticon emoticon-smile" src="https://cwiki.apache.org/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/icons/emoticons/smile.png" data-emoticon-name="smile" alt="(smile)"></li><li>to preserve ordering across a JMS queue consider using <a shape="rect" class="external-link" href="http://activemq.apache.org/exclusive-consumer.html">Exclusive Consumers</a> in the <a shape="rect" href="activemq.html">ActiveMQ</a> component</li><li>even better are <a shape="rect" class="external-link" href="http://activemq.apache.org/message-groups.html">Message Groups</a> which allows you to preserve ordering across messages while still offering parallelisation via the <strong>JMSXGroupID</strong> header to determine what can be parallelized</li><li>if you receive messages out of order you could use the <a shape="rect" href="resequencer.html">Resequencer</a> to put them back together again</li></ul><p>A good rule of thumb to help reduce ordering problems is to make sure each single can be processed as an atomic unit in parallel (either without concurrency issues or using say, database locking); or if it can't, use a <a shape="rect" class="external-link" href="http://activemq.apache.org/message-groups.html">Message Group</a> to relate the messages together which need to be processed in order by a single thread.</p><h3 id="BookInOnePage-UsingMessageGroupswithCamel">Using Message Groups with Camel</h3><p>To use a Message Group with Camel you just need to add a header to the output JMS message based on some kind of <a shape="rect" href="correlation-identifier.html">Correlation Identifier</a> to correlate messages which should be processed in order by a single thread - so that things which don't correlate together can be processed concurrently.</p><p>For example the following code shows how to create a message group using an XPath expression taking an invoice's product code as the <a shape="rect" href="correlation-identifier.html">Correlation Identifier</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;activemq:a&quot;).setHeader(JmsConstants.JMS_X_GROUP_ID, xpath(&quot;/invoice/productCode&quot;)).to(&quot;activemq:b&quot;);
]]></script>
</div></div><p>You can of course use the <a shape="rect" href="xml-configuration.html">Xml Configuration</a> if you prefer</p>
<h2 id="BookInOnePage-AsynchronousProcessing">Asynchronous Processing</h2><h3 id="BookInOnePage-Overview">Overview</h3><div class="confluence-information-macro confluence-information-macro-information"><p class="title">Supported versions</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>The information on this page applies for <strong>Camel 2.4</strong> or later.</p><p>Before <strong>Camel 2.4</strong> the asynchronous processing is only implemented for <a shape="rect" href="jbi.html">JBI</a> where as in <strong>Camel 2.4</strong> we have implemented it in many other areas. See more at <a shape="rect" href="asynchronous-routing-engine.html">Asynchronous Routing Engine</a>.</p></div></div><p>Camel supports a more complex asynchronous processing model. The asynchronous processors implement the <strong><code>org.apache.camel.AsyncProcessor</code></strong> interface which is derived from the more synchronous <strong><code>org.apache.camel.Processor</code></strong> interface. There are advantages and disadvantages when using asynchronous processing when compared to using the standard synchronous processing model.</p><p><strong>Advantages</strong>:</p><ul><li>Processing routes that are composed fully of asynchronous processors do not use up threads waiting for processors to complete on blocking calls. This can increase the scalability of your system by reducing the number of threads needed to process the same workload.</li><li>Processing routes can be broken up into <a shape="rect" href="seda.html">SEDA</a> processing stages where different thread pools can process the different stages. This means that your routes can be processed concurrently.</li></ul><p><strong>Disadvantages</strong>:</p><ul><li>Implementing asynchronous processors is more complex than implementing the synchronous versions.</li></ul><h3 id="BookInOnePage-WhentoUse">When to Use</h3><p>We recommend that processors and components be implemented the more simple synchronous APIs unless you identify a performance of scalability requirement that dictates otherwise. A Processor whose&#160;<strong><code>process()</code></strong> method blocks for a long time would be good candidates for being converted into an asynchronous processor.</p><h3 id="BookInOnePage-InterfaceDetails">Interface Details</h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public interface AsyncProcessor extends Processor {
   boolean process(Exchange exchange, AsyncCallback callback);
}
]]></script>
</div></div><p>The&#160;<strong><code>AsyncProcessor</code></strong> defines a single <strong><code>process()</code></strong> method which is very similar to it's synchronous&#160;<strong><code>Processor.process()</code></strong> brethren.</p><p>Here are the differences:</p><ul><li>A non-null&#160;<strong><code>AsyncCallback</code></strong> <strong>MUST</strong> be supplied which will be notified when the exchange processing is completed.</li><li>It <strong>MUST</strong> not throw any exceptions that occurred while processing the exchange. Any such exceptions must be stored on the exchange's&#160;<strong><code>Exception</code></strong> property.</li><li>It <strong>MUST</strong> know if it will complete the processing synchronously or asynchronously. The method will return <strong><code>true</code></strong> if it does complete synchronously, otherwise it returns <strong><code>false</code></strong>.</li><li>When the processor has completed processing the exchange, it must call the <strong><code>callback.done(boolean sync)</code></strong> method.</li><li>The sync parameter <strong>MUST</strong> match the value returned by the <strong><code>process()</code></strong> method.</li></ul><h3 id="BookInOnePage-ImplementingProcessorsthatUsetheAsyncProcessorAPI">Implementing Processors that Use the AsyncProcessor API</h3><p>All processors, even synchronous processors that do not implement the&#160;<strong><code>AsyncProcessor</code></strong> interface, can be coerced to implement the&#160;<strong><code>AsyncProcessor</code></strong> interface. This is usually done when you are implementing a Camel component consumer that supports asynchronous completion of the exchanges that it is pushing through the Camel routes. Consumers are provided a&#160;<strong><code>Processor</code></strong> object when created. All Processor object can be coerced to a&#160;<strong><code>AsyncProcessor</code></strong> using the following API:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[Processor processor = ...
AsyncProcessor asyncProcessor = AsyncProcessorTypeConverter.convert(processor);
]]></script>
</div></div><p>For a route to be fully asynchronous and reap the benefits to lower Thread usage, it must start with the consumer implementation making use of the asynchronous processing API. If it called the synchronous&#160;<strong><code>process()</code></strong> method instead, the consumer's thread would be forced to be blocked and in use for the duration that it takes to process the exchange.</p><p>It is important to take note that just because you call the asynchronous API, it does not mean that the processing will take place asynchronously. It only allows the possibility that it can be done without tying up the caller's thread. If the processing happens asynchronously is dependent on the configuration of the Camel route.</p><p>Normally, the the process call is passed in an inline inner&#160;<strong><code>AsyncCallback</code></strong> class instance which can reference the exchange object that was declared final. This allows it to finish up any post processing that is needed when the called processor is done processing the exchange.</p><p>Example.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[final Exchange exchange = ...
AsyncProcessor asyncProcessor = ...
asyncProcessor.process(exchange, new AsyncCallback() {
    public void done(boolean sync) {

        if (exchange.isFailed()) {
            ... // do failure processing.. perhaps rollback etc.
        } else {
            ... // processing completed successfully, finish up 
                // perhaps commit etc.
        }
    }
});
]]></script>
</div></div><h3 id="BookInOnePage-AsynchronousRouteSequenceScenarios">Asynchronous Route Sequence Scenarios</h3><p>Now that we have understood the interface contract of the <strong><code>AsyncProcessor</code></strong>, and have seen how to make use of it when calling processors, let's looks a what the thread model/sequence scenarios will look like for some sample routes.</p><p>The Jetty component's consumers support asynchronous processing through the use of continuations. Suffice to say it can take a HTTP request and pass it to a Camel route for asynchronous processing. If the processing is indeed asynchronous, it uses a Jetty continuation so that the HTTP request is 'parked' and the thread is released. Once the Camel route finishes processing the request, the Jetty component uses the&#160;<strong><code>AsyncCallback</code></strong> to tell Jetty to 'un-park' the request. Jetty un-parks the request, the HTTP response returned using the result of the exchange processing.</p><p>Notice that the jetty continuations feature is only used "If the processing is indeed async". This is why&#160;<strong><code>AsyncProcessor.process()</code></strong> implementations <em>must</em> accurately report if request is completed synchronously or not.</p><p>The&#160;<strong><code>jhc</code></strong> component's producer allows you to make HTTP requests and implement the&#160;<strong><code>AsyncProcessor</code></strong> interface. A route that uses both the jetty asynchronous consumer and the&#160;<strong><code>jhc</code></strong> asynchronous producer will be a fully asynchronous route and has some nice attributes that can be seen if we take a look at a sequence diagram of the processing route.</p><p>For the route:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;jetty:http://localhost:8080/service&quot;)
    .to(&quot;jhc:http://localhost/service-impl&quot;);
]]></script>
</div></div><p>The sequence diagram would look something like this:</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="book-in-one-page.data/simple-async-route.png" data-image-src="/confluence/download/attachments/68592/simple-async-route.png?version=1&amp;modificationDate=1192103278000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="59670856" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="simple-async-route.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="68592" data-linked-resource-container-version="15"></span></p><p>The diagram simplifies things by making it looks like processors implement the&#160;<strong><code>AsyncCallback</code></strong> interface when in reality the&#160;<strong><code>AsyncCallback</code></strong> interfaces are inline inner classes, but it illustrates the processing flow and shows how two separate threads are used to complete the processing of the original HTTP request. The first thread is synchronous up until processing hits the&#160;<strong><code>jhc</code></strong> producer which issues the&#160;HTTP request. It then reports that the exchange processing will complete asynchronously using NIO to get the response back. Once the&#160;<strong><code>jhc</code></strong> component has received a full response it uses <strong><code>AsyncCallback.done()</code></strong> method to notify the caller. These callback notifications continue up until it reaches the original Jetty consumer which then un-parks the HTTP request and completes it by providing the response.</p><h3 id="BookInOnePage-MixingSynchronousandAsynchronousProcessors">Mixing Synchronous and Asynchronous Processors</h3><p>It is totally possible and reasonable to mix the use of synchronous and asynchronous processors/components. The pipeline processor is the backbone of a Camel processing route. It glues all the processing steps together. It is implemented as an&#160;<strong><code>AsyncProcessor</code></strong> and supports interleaving synchronous and asynchronous processors as the processing steps in the pipeline.</p><p>Let's say we have two custom asynchronous processors, namely:&#160;<strong><code>MyValidator</code></strong> and <strong><code>MyTransformation</code></strong>. Let's say we want to load file from the data/in directory validate them with the&#160;<strong><code>MyValidator()</code></strong> processor, transform them into JPA Java objects using&#160;<strong><code>MyTransformation</code></strong> and then insert them into the database using the <a shape="rect" href="jpa.html">JPA</a> component. Let's say that the transformation process takes quite a bit of time and we want to allocate&#160;<strong><code>20</code></strong> threads to do parallel transformations of the input files. The solution is to make use of the thread processor. The thread is&#160;<strong><code>AsyncProcessor</code></strong> that forces subsequent processing in asynchronous thread from a thread pool.</p><p>The route might look like:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;file:data/in&quot;)
  .process(new MyValidator())
  .threads(20)
  .process(new MyTransformation())
  .to(&quot;jpa:PurchaseOrder&quot;);
]]></script>
</div></div><p>The sequence diagram would look something like this:</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="book-in-one-page.data/camel-mixed-processors.png" data-image-src="/confluence/download/attachments/68592/camel-mixed-processors.png?version=1&amp;modificationDate=1192110286000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="59670857" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="camel-mixed-processors.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="68592" data-linked-resource-container-version="15"></span></p><p>You would actually have multiple threads executing the second part of the thread sequence.</p><h3 id="BookInOnePage-StayingSynchronousinanAsyncProcessor">Staying Synchronous in an&#160;<code>AsyncProcessor</code></h3><p>Generally speaking you get better throughput processing when you process things synchronously. This is due to the fact that starting up an asynchronous thread and doing a context switch to it adds a little bit of of overhead. So it is generally encouraged that <strong><code>AsyncProcessor</code></strong>'s do as much work as they can synchronously. When they get to a step that would block for a long time, at that point they should return from the process call and let the caller know that it will be completing the call asynchronously.</p>
<h2 id="BookInOnePage-ImplementingVirtualTopicsonotherJMSproviders">Implementing Virtual Topics on other JMS providers</h2>

<p><a shape="rect" class="external-link" href="http://activemq.apache.org/">ActiveMQ</a> supports <a shape="rect" class="external-link" href="http://activemq.apache.org/virtual-destinations.html">Virtual Topics</a> since durable topic subscriptions kinda suck (see <a shape="rect" class="external-link" href="http://activemq.apache.org/virtual-destinations.html">this page for more detail</a>) mostly since they don't support <a shape="rect" href="competing-consumers.html">Competing Consumers</a>.</p>

<p>Most folks want Queue semantics when consuming messages; so that you can support <a shape="rect" href="competing-consumers.html">Competing Consumers</a> for load balancing along with things like <a shape="rect" class="external-link" href="http://activemq.apache.org/message-groups.html">Message Groups</a> and <a shape="rect" class="external-link" href="http://activemq.apache.org/exclusive-consumer.html">Exclusive Consumers</a> to preserve ordering or partition the queue across consumers.</p>

<p>However if you are using another JMS provider you can implement Virtual Topics by switching to ActiveMQ <img class="emoticon emoticon-smile" src="https://cwiki.apache.org/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/icons/emoticons/smile.png" data-emoticon-name="smile" alt="(smile)"> or you can use the following Camel pattern.</p>

<p>First here's the ActiveMQ approach.</p>

<ul><li>send to <strong>activemq:topic:VirtualTopic.Orders</strong></li><li>for consumer A consume from <strong>activemq:Consumer.A.VirtualTopic.Orders</strong></li></ul>


<p>When using another message broker use the following pattern</p>

<ul><li>send to <strong>jms:Orders</strong></li><li>add this route with a to() for each logical durable topic subscriber 
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;jms:Orders&quot;).to(&quot;jms:Consumer.A&quot;, &quot;jms:Consumer.B&quot;, ...); ]]></script>
</div></div></li><li>for consumer A consume from <strong>jms:Consumer.A</strong></li></ul>

<h2 id="BookInOnePage-What'stheCamelTransportforCXF">What's the Camel Transport for CXF</h2><p>In CXF you offer or consume a webservice by defining its address. The first part of the address specifies the protocol to use. For example address="http://localhost:9000" in an endpoint configuration means your service will be offered using the http protocol on port 9000 of localhost. When you integrate Camel Tranport into CXF you get a new transport "camel". So you can specify address="camel://direct:MyEndpointName" to bind the CXF service address to a camel direct endpoint.</p><p>Technically speaking Camel transport for CXF is a component which implements the <a shape="rect" class="external-link" href="http://cwiki.apache.org/CXF20DOC/cxf-architecture.html#CXFArchitecture-Transports">CXF transport API</a> with the Camel core library. This allows you to easily use Camel's routing engine and integration patterns support together with your CXF services.</p><h2 id="BookInOnePage-IntegrateCamelintoCXFtransportlayer">Integrate Camel into CXF transport layer</h2><p>To include the Camel Tranport into your CXF bus you use the CamelTransportFactory. You can do this in Java as well as in Spring.</p><h3 id="BookInOnePage-SettinguptheCamelTransportinSpring">Setting up the Camel Transport in Spring</h3><p>You can use the following snippet in your applicationcontext if you want to configure anything special. If you only want to activate the camel transport you do not have to do anything in your application context. As soon as you include the camel-cxf-transport jar (or camel-cxf.jar if your camel version is less than 2.7.x) in your app, cxf will scan the jar and load a CamelTransportFactory for you.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;!-- you don&#39;t need to specify the CamelTransportFactory configuration as it is auto load by CXF bus --&gt;
&lt;bean class=&quot;org.apache.camel.component.cxf.transport.CamelTransportFactory&quot;&gt;
  &lt;property name=&quot;bus&quot; ref=&quot;cxf&quot; /&gt;
  &lt;property name=&quot;camelContext&quot; ref=&quot;camelContext&quot; /&gt;
  &lt;!-- checkException new added in Camel 2.1 and Camel 1.6.2 --&gt;
  &lt;!-- If checkException is true , CamelDestination will check the outMessage&#39;s
     exception and set it into camel exchange. You can also override this value 
     in CamelDestination&#39;s configuration. The default value is false.
     This option should be set true when you want to leverage the camel&#39;s error 
     handler to deal with fault message --&gt;
  &lt;property name=&quot;checkException&quot; value=&quot;true&quot; /&gt;
  &lt;property name=&quot;transportIds&quot;&gt;
    &lt;list&gt;
      &lt;value&gt;http://cxf.apache.org/transports/camel&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;
]]></script>
</div></div><h3 id="BookInOnePage-IntegratingtheCamelTransportinaprogrammaticway">Integrating the Camel Transport in a programmatic way</h3><p>Camel transport provides a setContext method that you could use to set the Camel context into the transport factory. If you want this factory take effect, you need to register the factory into the CXF bus. Here is a full example for you.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[import org.apache.cxf.Bus;
import org.apache.cxf.BusFactory;
import org.apache.cxf.transport.ConduitInitiatorManager;
import org.apache.cxf.transport.DestinationFactoryManager;
...

BusFactory bf = BusFactory.newInstance();
Bus bus = bf.createBus();
CamelTransportFactory camelTransportFactory = new CamelTransportFactory();
// set up the CamelContext which will be use by the CamelTransportFactory
camelTransportFactory.setCamelContext(context)
// if you are using CXF higher then 2.4.x the 
camelTransportFactory.setBus(bus);

// if you are lower CXF, you need to register the ConduitInitiatorManager and DestinationFactoryManager like below
// register the conduit initiator
ConduitInitiatorManager cim = bus.getExtension(ConduitInitiatorManager.class);
cim.registerConduitInitiator(CamelTransportFactory.TRANSPORT_ID, camelTransportFactory);
// register the destination factory
DestinationFactoryManager dfm = bus.getExtension(DestinationFactoryManager.class);
dfm.registerDestinationFactory(CamelTransportFactory.TRANSPORT_ID, camelTransportFactory);
// set or bus as the default bus for cxf
BusFactory.setDefaultBus(bus);
]]></script>
</div></div><h2 id="BookInOnePage-ConfigurethedestinationandconduitwithSpring">Configure the destination and conduit with Spring</h2><h3 id="BookInOnePage-Namespace">Namespace</h3><p>The elements used to configure an Camel transport endpoint are defined in the namespace <code><a shape="rect" href="http://cxf.apache.org/transports/camel">http://cxf.apache.org/transports/camel</a></code>. It is commonly referred to using the prefix <code>camel</code>. In order to use the Camel transport configuration elements, you will need to add the lines shown below to the beans element of your endpoint's configuration file. In addition, you will need to add the configuration elements' namespace to the <code>xsi:schemaLocation</code> attribute.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Adding the Configuration Namespace</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;beans ...
       xmlns:camel=&quot;http://cxf.apache.org/transports/camel
       ...
       xsi:schemaLocation=&quot;...
                           http://cxf.apache.org/transports/camel
                           http://cxf.apache.org/transports/camel.xsd
                          ...&gt;
]]></script>
</div></div><h3 id="BookInOnePage-Thedestinationelement">The <code>destination</code> element</h3><p>You configure an Camel transport server endpoint using the <code>camel:destination</code> element and its children. The <code>camel:destination</code> element takes a single attribute, <code>name</code>, that specifies the WSDL port element that corresponds to the endpoint. The value for the <code>name</code> attribute takes the form <em>portQName</em><code>.camel-destination</code>. The example below shows the <code>camel:destination</code> element that would be used to add configuration for an endpoint that was specified by the WSDL fragment <code>&lt;port binding="widgetSOAPBinding" name="widgetSOAPPort"&gt;</code> if the endpoint's target namespace was <code><a shape="rect" class="external-link" href="http://widgets.widgetvendor.net" rel="nofollow">http://widgets.widgetvendor.net</a></code>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>camel:destination Element</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[...
  &lt;camel:destination name=&quot;{http://widgets/widgetvendor.net}widgetSOAPPort.http-destination&gt;
    &lt;camelContext id=&quot;context&quot; xmlns=&quot;http://activemq.apache.org/camel/schema/spring&quot;&gt;
         &lt;route&gt;
           &lt;from uri=&quot;direct:EndpointC&quot; /&gt;
           &lt;to uri=&quot;direct:EndpointD&quot; /&gt;
         &lt;/route&gt;
     &lt;/camelContext&gt;
  &lt;/camel:destination&gt;

  &lt;!-- new added feature since Camel 2.11.x
  &lt;camel:destination name=&quot;{http://widgets/widgetvendor.net}widgetSOAPPort.camel-destination&quot; camelContextId=&quot;context&quot; /&gt;  

...
]]></script>
</div></div><p>The <code>camel:destination</code> element for Spring has a number of child elements that specify configuration information. They are described below.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Element</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>camel-spring:camelContext</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>You can specify the camel context in the camel destination</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>camel:camelContextRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The camel context id which you want inject into the camel destination</p></td></tr></tbody></table></div><h3 id="BookInOnePage-Theconduitelement">The <code>conduit</code> element</h3><p>You configure a Camel transport client using the <code>camel:conduit</code> element and its children. The <code>camel:conduit</code> element takes a single attribute, <code>name</code>, that specifies the WSDL port element that corresponds to the endpoint. The value for the <code>name</code> attribute takes the form <em>portQName</em><code>.camel-conduit</code>. For example, the code below shows the <code>camel:conduit</code> element that would be used to add configuration for an endpoint that was specified by the WSDL fragment <code>&lt;port binding="widgetSOAPBinding" name="widgetSOAPPort"&gt;</code> if the endpoint's target namespace was <code><a shape="rect" class="external-link" href="http://widgets.widgetvendor.net" rel="nofollow">http://widgets.widgetvendor.net</a></code>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>http-conf:conduit Element</b></div><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[...
  &lt;camelContext id=&quot;conduit_context&quot; xmlns=&quot;http://activemq.apache.org/camel/schema/spring&quot;&gt;
       &lt;route&gt;
           &lt;from uri=&quot;direct:EndpointA&quot; /&gt;
           &lt;to uri=&quot;direct:EndpointB&quot; /&gt;
       &lt;/route&gt;
   &lt;/camelContext&gt;

  &lt;camel:conduit name=&quot;{http://widgets/widgetvendor.net}widgetSOAPPort.camel-conduit&quot;&gt;
     &lt;camel:camelContextRef&gt;conduit_context&lt;/camel:camelContextRef&gt;
  &lt;/camel:conduit&gt;

  &lt;!-- new added feature since Camel 2.11.x
  &lt;camel:conduit name=&quot;{http://widgets/widgetvendor.net}widgetSOAPPort.camel-conduit&quot; camelContextId=&quot;conduit_context&quot; /&gt;
     

  &lt;camel:conduit name=&quot;*.camel-conduit&quot;&gt;
  &lt;!-- you can also using the wild card to specify the camel-conduit that you want to configure --&gt;
    ...
  &lt;/camel:conduit&gt;
...
]]></script>
</div></div><p>The <code>camel:conduit</code> element has a number of child elements that specify configuration information. They are described below.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Element</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>camel-spring:camelContext</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>You can specify the camel context in the camel conduit</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>camel:camelContextRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The camel context id which you want inject into the camel conduit</p></td></tr></tbody></table></div><h2 id="BookInOnePage-ConfigurethedestinationandconduitwithBlueprint">Configure the destination and conduit with Blueprint</h2><p>From <strong>Camel 2.11.x</strong>, Camel Transport supports to be configured with Blueprint.</p><p>If you are using blueprint, you should use the the namespace <code><a shape="rect" href="http://cxf.apache.org/transports/camel/blueprint">http://cxf.apache.org/transports/camel/blueprint</a></code> and import the schema like the blow.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Adding the Configuration Namespace for blueprint</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;beans ...
       xmlns:camel=&quot;http://cxf.apache.org/transports/camel/blueprint&quot;
       ...
       xsi:schemaLocation=&quot;...
                           http://cxf.apache.org/transports/camel/blueprint 
                           http://cxf.apache.org/schmemas/blueprint/camel.xsd
                          ...&gt;
]]></script>
</div></div><p>In blueprint <code>camel:conduit</code> <code>camel:destination</code> only has one camelContextId attribute, they doesn't support to specify the camel context in the camel destination.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[  &lt;camel:conduit id=&quot;*.camel-conduit&quot; camelContextId=&quot;camel1&quot; /&gt;
  &lt;camel:destination id=&quot;*.camel-destination&quot; camelContextId=&quot;camel1&quot; /&gt;
]]></script>
</div></div><h2 id="BookInOnePage-ExampleUsingCamelasaloadbalancerforCXF">Example Using Camel as a load balancer for CXF</h2><p>This example shows how to use the camel load balancing feature in CXF. You need to load the configuration file in CXF and publish the endpoints on the address "camel://direct:EndpointA" and "camel://direct:EndpointB"</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:camel=&quot;http://cxf.apache.org/transports/camel&quot;
       xsi:schemaLocation=&quot;
       http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://cxf.apache.org/transports/camel http://cxf.apache.org/transports/camel.xsd
       http://camel.apache.org/schema/cxf http://camel.apache.org/schema/cxf/cxfEndpoint.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd
    &quot;&gt;
    
   &lt;!-- Enable bridge between Camel Property Placeholder and Spring Property placeholder so we can use system properties
       to dynamically set the port number for unit testing the example.  --&gt;
   &lt;bean id=&quot;bridgePropertyPlaceholder&quot; class=&quot;org.apache.camel.spring.spi.BridgePropertyPlaceholderConfigurer&quot;/&gt;

   &lt;bean id=&quot;roundRobinRef&quot; class=&quot;org.apache.camel.processor.loadbalancer.RoundRobinLoadBalancer&quot; /&gt;

   &lt;camelContext id=&quot;dest_context&quot; xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;
       &lt;route&gt;
            &lt;from uri=&quot;jetty:http://localhost:{{port}}/GreeterContext/GreeterPort&quot;/&gt;
            &lt;loadBalance&gt;
              &lt;custom ref=&quot;roundRobinRef&quot;/&gt;
              &lt;to uri=&quot;direct:EndpointA&quot;/&gt;
              &lt;to uri=&quot;direct:EndpointB&quot;/&gt;
            &lt;/loadBalance&gt;
        &lt;/route&gt;
   &lt;/camelContext&gt;

   &lt;!-- Inject the camel context to the Camel transport&#39;s destination --&gt;
   &lt;camel:destination name=&quot;{http://apache.org/hello_world_soap_http}CamelPort.camel-destination&quot;&gt;
        &lt;camel:camelContextRef&gt;dest_context&lt;/camel:camelContextRef&gt;
   &lt;/camel:destination&gt;

&lt;/beans&gt;
]]></script>
</div></div><h2 id="BookInOnePage-CompleteHowtoandExampleforattachingCameltoCXF">Complete Howto and Example for attaching Camel to CXF</h2><p><a shape="rect" href="better-jms-transport-for-cxf-webservice-using-apache-camel.html">Better JMS Transport for CXF Webservice using Apache Camel</a>&#160;</p>
<h2 id="BookInOnePage-Introduction.2">Introduction</h2>
<p>When sending an <a shape="rect" href="exchange.html">Exchange</a> to an <a shape="rect" href="endpoint.html">Endpoint</a> you can either use a <a shape="rect" href="routes.html">Route</a> or a <a shape="rect" href="producertemplate.html">ProducerTemplate</a>. This works fine in many scenarios. However you may need to guarantee that an exchange is delivered to the same endpoint that you delivered a previous exchange on. For example in the case of delivering a batch of exchanges to a <a shape="rect" href="mina.html">MINA</a> socket you may need to ensure that they are all delivered through the same socket connection. Furthermore once the batch of exchanges have been delivered the protocol requirements may be such that you are responsible for closing the socket.</p>

<h2 id="BookInOnePage-UsingaProducer">Using a Producer</h2>
<p>To achieve fine grained control over sending exchanges you will need to program directly to a Producer. Your code will look similar to:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
  CamelContext camelContext = ...

  // Obtain an endpoint and create the producer we will be using.
  Endpoint endpoint = camelContext.getEndpoint(&quot;someuri:etc&quot;);
  Producer producer = endpoint.createProducer();
  producer.start();

  try {
    // For each message to send...
    Object requestMessage = ...
    Exchange exchangeToSend = producer.createExchange();
    exchangeToSend().setBody(requestMessage);
    producer.process(exchangeToSend);
    ...

  } finally {
    // Tidy the producer up.
    producer.stop();
  }
]]></script>
</div></div>

<p>In the case of using Apache MINA the producer.stop() invocation will cause the socket to be closed.</p>
<div class="chapter" id="chapter-tutorials"></div>
<h1 id="BookInOnePage-Tutorials">Tutorials</h1>

<p>There now follows the documentation on camel tutorials</p>

We have a number of tutorials as listed below. The tutorials often comes with source code which is either available in the Camel <a shape="rect" href="download.html">Download</a> or attached to the wiki page.

<div class="confluence-information-macro confluence-information-macro-information"><p class="title">Notice</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>These tutorials listed below, is hosted at Apache. We offer the <a shape="rect" href="articles.html">Articles</a> page where we have a link collection for 3rd party Camel material, such as tutorials, blog posts, published articles, videos, pod casts, presentations, and so forth.</p>

<p>If you have written a Camel related article, then we are happy to provide a link to it. You can contact the Camel <a shape="rect" href="team.html">Team</a>, for example using the <a shape="rect" href="mailing-lists.html">Mailing Lists</a>, (or post a tweet with the word Apache Camel).</p></div></div>

<ul><li><a shape="rect" href="tutorial-oauth.html">OAuth Tutorial</a><br clear="none">
This tutorial demonstrates how to implement OAuth for a web application with Camel's <a shape="rect" href="gauth.html">gauth</a> component. The sample application of this tutorial is also online at <a shape="rect" class="external-link" href="http://gauthcloud.appspot.com/" rel="nofollow">http://gauthcloud.appspot.com/</a></li></ul>


<ul><li><a shape="rect" href="tutorial-for-camel-on-google-app-engine.html">Tutorial for Camel on Google App Engine</a><br clear="none">
This tutorial demonstrates the usage of the <a shape="rect" href="gae.html">Camel Components for Google App Engine</a>. The sample application of this tutorial is also online at <a shape="rect" class="external-link" href="http://camelcloud.appspot.com/" rel="nofollow">http://camelcloud.appspot.com/</a></li></ul>


<ul><li><a shape="rect" href="tutorial-jmsremoting.html">Tutorial on Spring Remoting with JMS</a><br clear="none">
This tutorial is focused on different techniques with Camel for Client-Server communication.</li></ul>


<ul><li><a shape="rect" href="tutorial-example-reportincident.html">Report Incident - This tutorial introduces Camel steadily and is based on a real life integration problem</a><br clear="none">
This is a very long tutorial beginning from the start; its for entry level to Camel. Its based on a real life integration, showing how Camel can be introduced in an existing solution. We do this in baby steps. The tutorial is currently work in progress, so check it out from time to time. The tutorial explains some of the inner building blocks Camel uses under the covers. This is good knowledge to have when you start using Camel on a higher abstract level where it can do wonders in a few lines of routing DSL.</li></ul>


<ul><li><a shape="rect" class="external-link" href="http://servicemix.apache.org/3-beginner-using-apache-camel-inside-servicemix.html">Using Camel with ServiceMix</a> a tutorial on using Camel inside <a shape="rect" class="external-link" href="http://servicemix.apache.org/home.html">Apache ServiceMix</a>.</li></ul>


<ul><li><a shape="rect" href="better-jms-transport-for-cxf-webservice-using-apache-camel.html">Better JMS Transport for CXF Webservice using Apache Camel</a> Describes how to use the Camel Transport for CXF to attach a CXF Webservice to a JMS Queue</li></ul>


<ul><li><a shape="rect" href="tutorial-axis-camel.html">Tutorial how to use good old Axis 1.4 with Camel</a><br clear="none">
This tutorial shows that Camel does work with the good old frameworks such as AXIS that is/was widely used for WebService.</li></ul>


<ul><li><a shape="rect" href="tutorial-on-using-camel-in-a-web-application.html">Tutorial on using Camel in a Web Application</a><br clear="none">
This tutorial gives an overview of how to use Camel inside Tomcat, Jetty or any other servlet engine</li></ul>


<ul><li><a shape="rect" href="tutorial-business-partners.html">Tutorial on Camel 1.4 for Integration</a><br clear="none">
Another real-life scenario.  The company sells widgets, with a somewhat unique business process (their customers periodically report what they've purchased in order to get billed).  However every customer uses a different data format and protocol.  This tutorial goes through the process of integrating (and testing!) several customers and their electronic reporting of the widgets they've bought, along with the company's response.</li></ul>


<ul><li>Tutorial how to build a Service Oriented Architecture using Camel with OSGI - Updated 20/11/2009<br clear="none">
The tutorial has been designed in two parts. <a shape="rect" href="tutorial-osgi-camel-part1.html">The first part</a> introduces basic concept to create a simple SOA solution using Camel and OSGI and deploy it in a OSGI Server like Apache Felix Karaf and Spring DM Server while the <a shape="rect" href="tutorial-osgi-camel-part2.html">second</a> extends the <a shape="rect" href="tutorial-example-reportincident.html">ReportIncident tutorial</a> part 4 to show How we can separate the different layers (domain, service, ...) of an application and deploy them in separate bundles. The Web Application has also be modified in order to communicate to the OSGI bundles.</li></ul>


<ul><li>Several of the vendors on the <a shape="rect" href="commercial-camel-offerings.html">Commercial Camel Offerings</a> page also offer various tutorials, webinars, examples, etc.... that may be useful.</li></ul>


<ul><li><a shape="rect" href="examples.html">Examples</a><br clear="none">
While not actual tutorials you might find working through the source of the various <a shape="rect" href="examples.html">Examples</a> useful.</li></ul>

<h2 id="BookInOnePage-TutorialonSpringRemotingwithJMS">Tutorial on Spring Remoting with JMS</h2><p>&#160;</p><div class="confluence-information-macro confluence-information-macro-information"><p class="title">Thanks</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>This tutorial was kindly donated to Apache Camel by Martin Gilday.</p></div></div><h2 id="BookInOnePage-Preface">Preface</h2><p>This tutorial aims to guide the reader through the stages of creating a project which uses Camel to facilitate the routing of messages from a JMS queue to a <a shape="rect" class="external-link" href="http://www.springramework.org" rel="nofollow">Spring</a> service. The route works in a synchronous fashion returning a response to the client.</p><p><style type="text/css">/*<![CDATA[*/
div.rbtoc1480069135697 {padding: 0px;}
div.rbtoc1480069135697 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1480069135697 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style></p><div class="toc-macro rbtoc1480069135697">
<ul class="toc-indentation"><li><a shape="rect" href="#BookInOnePage-TutorialonSpringRemotingwithJMS">Tutorial on Spring Remoting with JMS</a></li><li><a shape="rect" href="#BookInOnePage-Preface">Preface</a></li><li><a shape="rect" href="#BookInOnePage-Prerequisites">Prerequisites</a></li><li><a shape="rect" href="#BookInOnePage-Distribution">Distribution</a></li><li><a shape="rect" href="#BookInOnePage-About">About</a></li><li><a shape="rect" href="#BookInOnePage-CreatetheCamelProject">Create the Camel Project</a>
<ul class="toc-indentation"><li><a shape="rect" href="#BookInOnePage-UpdatethePOMwithDependencies">Update the POM with Dependencies</a></li></ul>
</li><li><a shape="rect" href="#BookInOnePage-WritingtheServer">Writing the Server</a>
<ul class="toc-indentation"><li><a shape="rect" href="#BookInOnePage-CreatetheSpringService">Create the Spring Service</a></li><li><a shape="rect" href="#BookInOnePage-DefinetheCamelRoutes">Define the Camel Routes</a></li><li><a shape="rect" href="#BookInOnePage-ConfigureSpring">Configure Spring</a></li><li><a shape="rect" href="#BookInOnePage-RuntheServer">Run the Server</a></li></ul>
</li><li><a shape="rect" href="#BookInOnePage-WritingTheClients">Writing The Clients</a>
<ul class="toc-indentation"><li><a shape="rect" href="#BookInOnePage-ClientUsingTheProducerTemplate">Client Using The ProducerTemplate</a></li><li><a shape="rect" href="#BookInOnePage-ClientUsingSpringRemoting">Client Using Spring Remoting</a></li><li><a shape="rect" href="#BookInOnePage-ClientUsingMessageEndpointEIPPattern">Client Using Message Endpoint EIP Pattern</a></li><li><a shape="rect" href="#BookInOnePage-RuntheClients">Run the Clients</a></li></ul>
</li><li><a shape="rect" href="#BookInOnePage-UsingtheCamelMavenPlugin">Using the Camel Maven Plugin</a></li><li><a shape="rect" href="#BookInOnePage-UsingCamelJMX">Using Camel JMX</a></li><li><a shape="rect" href="#BookInOnePage-SeeAlso">See Also</a></li></ul>
</div><h2 id="BookInOnePage-Prerequisites">Prerequisites</h2><p>This tutorial uses Maven to setup the Camel project and for dependencies for artifacts.</p><h2 id="BookInOnePage-Distribution">Distribution</h2><p>This sample is distributed with the Camel distribution as <code>examples/camel-example-spring-jms</code>.</p><h2 id="BookInOnePage-About">About</h2><p>This tutorial is a simple example that demonstrates more the fact how well Camel is seamless integrated with Spring to leverage the best of both worlds. This sample is client server solution using JMS messaging as the transport. The sample has two flavors of servers and also for clients demonstrating different techniques for easy communication.</p><p>The Server is a JMS message broker that routes incoming messages to a business service that does computations on the received message and returns a response.<br clear="none"> The EIP patterns used in this sample are:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Pattern</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="message-channel.html">Message Channel</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>We need a channel so the Clients can communicate with the server.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="message.html">Message </a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The information is exchanged using the Camel Message interface.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="message-translator.html">Message Translator</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>This is where Camel shines as the message exchange between the Server and the Clients are text based strings with numbers. However our business service uses int for numbers. So Camel can do the message translation automatically.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="message-endpoint.html">Message Endpoint</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>It should be easy to send messages to the Server from the the clients. This is achieved with Camel's powerful Endpoint pattern that even can be more powerful combined with Spring remoting. The tutorial has clients using each kind of technique for this.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="point-to-point-channel.html">Point to Point Channel</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The client and server exchange data using point to point using a JMS queue.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="event-driven-consumer.html">Event Driven Consumer</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>The JMS broker is event driven and is invoked when the client sends a message to the server.</span></p></td></tr></tbody></table></div><p>We use the following Camel components:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Component</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="activemq.html">ActiveMQ</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>We use Apache ActiveMQ as the JMS broker on the Server side</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="bean.html">Bean</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>We use the bean binding to easily route the messages to our business service. This is a very powerful component in Camel.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="file2.html">File</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>In the AOP enabled Server we store audit trails as files.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="jms.html">JMS</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Used for the JMS messaging</p></td></tr></tbody></table></div><h2 id="BookInOnePage-CreatetheCamelProject">Create the Camel Project</h2><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>For the purposes of the tutorial a single Maven project will be used for both the client and server. Ideally you would break your application down into the appropriate components.</p></div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[mvn archetype:generate -DgroupId=org.example -DartifactId=CamelWithJmsAndSpring
]]></script>
</div></div><h3 id="BookInOnePage-UpdatethePOMwithDependencies">Update the POM with Dependencies</h3><p>First we need to have dependencies for the core Camel jars, spring, jms components, and finally ActiveMQ as the message broker.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;!-- required by both client and server --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-core&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-jms&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-spring&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.activemq&lt;/groupId&gt;
  &lt;artifactId&gt;activemq-camel&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.activemq&lt;/groupId&gt;
  &lt;artifactId&gt;activemq-pool&lt;/artifactId&gt;
&lt;/dependency&gt;
]]></script>
</div></div>As we use spring xml configuration for the ActiveMQ JMS broker we need this dependency:<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;!-- xbean is required for ActiveMQ broker configuration in the spring xml file --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.xbean&lt;/groupId&gt;
  &lt;artifactId&gt;xbean-spring&lt;/artifactId&gt;
&lt;/dependency&gt;
]]></script>
</div></div><h2 id="BookInOnePage-WritingtheServer">Writing the Server</h2><h3 id="BookInOnePage-CreatetheSpringService">Create the Spring Service</h3><p>For this example the Spring service (our business service) on the server will be a simple multiplier which trebles in the received value.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public interface Multiplier {

    /**
     * Multiplies the given number by a pre-defined constant.
     *
     * @param originalNumber The number to be multiplied
     * @return The result of the multiplication
     */
    int multiply(int originalNumber);

}
]]></script>
</div></div>And the implementation of this service is:<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
@Service(value = &quot;multiplier&quot;)
public class Treble implements Multiplier {

    public int multiply(final int originalNumber) {
        return originalNumber * 3;
    }

}
]]></script>
</div></div>Notice that this class has been annotated with the @Service spring annotation. This ensures that this class is registered as a bean in the registry with the given name <strong>multiplier</strong>.<h3 id="BookInOnePage-DefinetheCamelRoutes">Define the Camel Routes</h3><p></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class ServerRoutes extends RouteBuilder {

    @Override
    public void configure() throws Exception {
        // route from the numbers queue to our business that is a spring bean registered with the id=multiplier
        // Camel will introspect the multiplier bean and find the best candidate of the method to invoke.
        // You can add annotations etc to help Camel find the method to invoke.
        // As our multiplier bean only have one method its easy for Camel to find the method to use.
        from(&quot;jms:queue:numbers&quot;).to(&quot;multiplier&quot;);

        // Camel has several ways to configure the same routing, we have defined some of them here below

        // as above but with the bean: prefix
        //from(&quot;jms:queue:numbers&quot;).to(&quot;bean:multiplier&quot;);

        // bean is using explicit bean bindings to lookup the multiplier bean and invoke the multiply method
        //from(&quot;jms:queue:numbers&quot;).bean(&quot;multiplier&quot;, &quot;multiply&quot;);

        // the same as above but expressed as a URI configuration
        //from(&quot;jms:queue:numbers&quot;).to(&quot;bean:multiplier?method=multiply&quot;);
    }

}
]]></script>
</div></div>This defines a Camel route <em>from</em> the JMS queue named <strong>numbers</strong> <em>to</em> the Spring <a shape="rect" href="bean.html">bean</a> named <strong>multiplier</strong>. Camel will create a consumer to the JMS queue which forwards all received messages onto the the Spring bean, using the method named <strong>multiply</strong>.<h3 id="BookInOnePage-ConfigureSpring">Configure Spring</h3><p>The Spring config file is placed under <code>META-INF/spring</code> as this is the default location used by the <a shape="rect" href="camel-maven-plugin.html">Camel Maven Plugin</a>, which we will later use to run our server.<br clear="none"> First we need to do the standard scheme declarations in the top. In the camel-server.xml we are using spring beans as the default <strong>bean:</strong> namespace and springs <strong>context:</strong>. For configuring ActiveMQ we use <strong>broker:</strong> and for Camel we of course have <strong>camel:</strong>. Notice that we don't use version numbers for the camel-spring schema. At runtime the schema is resolved in the Camel bundle. If we use a specific version number such as 1.4 then its IDE friendly as it would be able to import it and provide smart completion etc. See <a shape="rect" href="xml-reference.html">Xml Reference</a> for further details.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xmlns:camel=&quot;http://camel.apache.org/schema/spring&quot;
       xmlns:broker=&quot;http://activemq.apache.org/schema/core&quot;
       xsi:schemaLocation=&quot;
         http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
         http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
         http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd
         http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core.xsd&quot;&gt;
]]></script>
</div></div>We use Spring annotations for doing IoC dependencies and its component-scan features comes to the rescue as it scans for spring annotations in the given package name:<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;!-- let Spring do its IoC stuff in this package --&gt;
&lt;context:component-scan base-package=&quot;org.apache.camel.example.server&quot;/&gt;
]]></script>
</div></div>Camel will of course not be less than Spring in this regard so it supports a similar feature for scanning of Routes. This is configured as shown below.<br clear="none"> Notice that we also have enabled the <a shape="rect" href="camel-jmx.html">JMXAgent</a> so we will be able to introspect the Camel Server with a JMX Console.<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;!-- declare a camel context that scans for classes that is RouteBuilder
     in the package org.apache.camel.example.server --&gt;
&lt;camel:camelContext id=&quot;camel-server&quot;&gt;
  &lt;camel:package&gt;org.apache.camel.example.server&lt;/camel:package&gt;
  &lt;!-- enable JMX connector so we can connect to the server and browse mbeans --&gt;
  &lt;!-- Camel will log at INFO level the service URI to use for connecting with jconsole --&gt;
  &lt;camel:jmxAgent id=&quot;agent&quot; createConnector=&quot;true&quot;/&gt;
&lt;/camel:camelContext&gt;
]]></script>
</div></div>The ActiveMQ JMS broker is also configured in this xml file. We set it up to listen on TCP port 61610.<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;!-- lets configure the ActiveMQ JMS broker server --&gt;
&lt;broker:broker useJmx=&quot;true&quot; persistent=&quot;false&quot; brokerName=&quot;myBroker&quot;&gt;
  &lt;broker:transportConnectors&gt;
    &lt;!-- expose a VM transport for in-JVM transport between AMQ and Camel on the server side --&gt;
    &lt;broker:transportConnector name=&quot;vm&quot; uri=&quot;vm://myBroker&quot;/&gt;
    &lt;!-- expose a TCP transport for clients to use --&gt;
    &lt;broker:transportConnector name=&quot;tcp&quot; uri=&quot;tcp://localhost:${tcp.port}&quot;/&gt;
  &lt;/broker:transportConnectors&gt;
&lt;/broker:broker&gt;
]]></script>
</div></div>As this examples uses JMS then Camel needs a <a shape="rect" href="jms.html">JMS component</a> that is connected with the ActiveMQ broker. This is configured as shown below:<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;!-- lets configure the Camel ActiveMQ to use the embedded ActiveMQ broker declared above --&gt;
&lt;bean id=&quot;jms&quot; class=&quot;org.apache.activemq.camel.component.ActiveMQComponent&quot;&gt;
  &lt;property name=&quot;connectionFactory&quot;&gt;
    &lt;bean class=&quot;org.apache.activemq.spring.ActiveMQConnectionFactory&quot;&gt;
      &lt;property name=&quot;brokerURL&quot; value=&quot;vm://myBroker&quot;/&gt;
      &lt;property name=&quot;trustAllPackages&quot; value=&quot;true&quot;/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;
]]></script>
</div></div><strong>Notice:</strong> The <a shape="rect" href="jms.html">JMS component</a> is configured in standard Spring beans, but the gem is that the bean id can be referenced from Camel routes - meaning we can do routing using the JMS Component by just using <strong>jms:</strong> prefix in the route URI. What happens is that Camel will find in the Spring Registry for a bean with the id="jms". Since the bean id can have arbitrary name you could have named it id="jmsbroker" and then referenced to it in the routing as <code>from="jmsbroker:queue:numbers).to("multiplier");</code><br clear="none"> We use the vm protocol to connect to the ActiveMQ server as its embedded in this application.<div class="table-wrap"><table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>component-scan</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Defines the package to be scanned for Spring stereotype annotations, in this case, to load the "multiplier" bean</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>camel-context</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Defines the package to be scanned for Camel routes. Will find the <code>ServerRoutes</code> class and create the routes contained within it</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>jms bean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Creates the Camel JMS component</p></td></tr></tbody></table></div><h3 id="BookInOnePage-RuntheServer">Run the Server</h3><p>The Server is started using the <code>org.apache.camel.spring.Main</code> class that can start camel-spring application out-of-the-box. The Server can be started in several flavors:</p><ul class="alternate"><li>as a standard java main application - just start the <code>org.apache.camel.spring.Main</code> class</li><li>using maven jave:exec</li><li>using <a shape="rect" href="camel-run-maven-goal.html">camel:run</a></li></ul><p>In this sample as there are two servers (with and without AOP) we have prepared some profiles in maven to start the Server of your choice.<br clear="none"> The server is started with:<br clear="none"> <code>mvn compile exec:java -PCamelServer</code></p><h2 id="BookInOnePage-WritingTheClients">Writing The Clients</h2><p>This sample has three clients demonstrating different Camel techniques for communication</p><ul class="alternate"><li>CamelClient using the <a shape="rect" href="producertemplate.html">ProducerTemplate</a> for Spring template style coding</li><li>CamelRemoting using Spring Remoting</li><li>CamelEndpoint using the Message Endpoint EIP pattern using a neutral Camel API</li></ul><h3 id="BookInOnePage-ClientUsingTheProducerTemplate">Client Using The ProducerTemplate</h3><p>We will initially create a client by directly using <code>ProducerTemplate</code>. We will later create a client which uses Spring remoting to hide the fact that messaging is being used.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:camel=&quot;http://camel.apache.org/schema/spring&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xsi:schemaLocation=&quot;
         http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
         http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
         http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd&quot;&gt;
]]></script>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;camel:camelContext id=&quot;camel-client&quot;&gt;
  &lt;camel:template id=&quot;camelTemplate&quot;/&gt;
&lt;/camel:camelContext&gt;
]]></script>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;!-- Camel JMSProducer to be able to send messages to a remote Active MQ server --&gt;
&lt;bean id=&quot;jms&quot; class=&quot;org.apache.activemq.camel.component.ActiveMQComponent&quot;&gt;
  &lt;property name=&quot;connectionFactory&quot;&gt;
    &lt;bean class=&quot;org.apache.activemq.spring.ActiveMQConnectionFactory&quot;&gt;
      &lt;property name=&quot;brokerURL&quot; value=&quot;tcp://localhost:${tcp.port}&quot;/&gt;
      &lt;property name=&quot;trustAllPackages&quot; value=&quot;true&quot;/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;
]]></script>
</div></div>The client will not use the <a shape="rect" href="camel-maven-plugin.html">Camel Maven Plugin</a> so the Spring XML has been placed in <em>src/main/resources</em> to not conflict with the server configs.<div class="table-wrap"><table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>camelContext</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Camel context is defined but does not contain any routes</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>template</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The <code>ProducerTemplate</code> is used to place messages onto the JMS queue</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>jms bean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>This initialises the Camel JMS component, allowing us to place messages onto the queue</p></td></tr></tbody></table></div><p>And the CamelClient source code:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public static void main(final String[] args) throws Exception {
    System.out.println(&quot;Notice this client requires that the CamelServer is already running!&quot;);

    AbstractApplicationContext context = new ClassPathXmlApplicationContext(&quot;camel-client.xml&quot;);

    // get the camel template for Spring template style sending of messages (= producer)
    ProducerTemplate camelTemplate = context.getBean(&quot;camelTemplate&quot;, ProducerTemplate.class);

    System.out.println(&quot;Invoking the multiply with 22&quot;);
    // as opposed to the CamelClientRemoting example we need to define the service URI in this java code
    int response = (Integer)camelTemplate.sendBody(&quot;jms:queue:numbers&quot;, ExchangePattern.InOut, 22);
    System.out.println(&quot;... the result is: &quot; + response);

    // we&#39;re done so let&#39;s properly close the application context
    IOHelper.close(context);
}
]]></script>
</div></div>The <code>ProducerTemplate</code> is retrieved from a Spring <code>ApplicationContext</code> and used to manually place a message on the "numbers" JMS queue. The <code>requestBody</code> method will use the exchange pattern InOut, which states that the call should be synchronous, and that the caller expects a response.<p>Before running the client be sure that both the ActiveMQ broker and the <code>CamelServer</code> are running.</p><h3 id="BookInOnePage-ClientUsingSpringRemoting">Client Using Spring Remoting</h3><p><a shape="rect" href="spring-remoting.html">Spring Remoting</a> "eases the development of remote-enabled services". It does this by allowing you to invoke remote services through your regular Java interface, masking that a remote service is being called.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;!-- Camel proxy for a given service, in this case the JMS queue --&gt;
&lt;camel:proxy
  id=&quot;multiplierProxy&quot;
  serviceInterface=&quot;org.apache.camel.example.server.Multiplier&quot;
  serviceUrl=&quot;jms:queue:numbers&quot;/&gt;
]]></script>
</div></div>The snippet above only illustrates the different and how Camel easily can setup and use Spring Remoting in one line configurations.<p>The <strong>proxy</strong> will create a proxy service bean for you to use to make the remote invocations. The <strong>serviceInterface</strong> property details which Java interface is to be implemented by the proxy. The&#160;<strong>serviceUrl</strong> defines where messages sent to this proxy bean will be directed. Here we define the JMS endpoint with the "numbers" queue we used when working with Camel template directly. The value of the <strong>id</strong> property is the name that will be the given to the bean when it is exposed through the Spring <code>ApplicationContext</code>. We will use this name to retrieve the service in our client. I have named the bean <em>multiplierProxy</em> simply to highlight that it is not the same multiplier bean as is being used by <code>CamelServer</code>. They are in completely independent contexts and have no knowledge of each other. As you are trying to mask the fact that remoting is being used in a real application you would generally not include proxy in the name.</p><p>And the Java client source code:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public static void main(final String[] args) {
    System.out.println(&quot;Notice this client requires that the CamelServer is already running!&quot;);

    AbstractApplicationContext context = new ClassPathXmlApplicationContext(&quot;camel-client-remoting.xml&quot;);
    // just get the proxy to the service and we as the client can use the &quot;proxy&quot; as it was
    // a local object we are invoking. Camel will under the covers do the remote communication
    // to the remote ActiveMQ server and fetch the response.
    Multiplier multiplier = context.getBean(&quot;multiplierProxy&quot;, Multiplier.class);

    System.out.println(&quot;Invoking the multiply with 33&quot;);
    int response = multiplier.multiply(33);
    System.out.println(&quot;... the result is: &quot; + response);

    // we&#39;re done so let&#39;s properly close the application context
    IOHelper.close(context);
}
]]></script>
</div></div>Again, the client is similar to the original client, but with some important differences.<ol><li>The Spring context is created with the new <em>camel-client-remoting.xml</em></li><li>We retrieve the proxy bean instead of a <code>ProducerTemplate</code>. In a non-trivial example you would have the bean injected as in the standard Spring manner.</li><li>The multiply method is then called directly. In the client we are now working to an interface. There is no mention of Camel or JMS inside our Java code.</li></ol><h3 id="BookInOnePage-ClientUsingMessageEndpointEIPPattern">Client Using Message Endpoint EIP Pattern</h3><p>This client uses the Message Endpoint EIP pattern to hide the complexity to communicate to the Server. The Client uses the same simple API to get hold of the endpoint, create an exchange that holds the message, set the payload and create a producer that does the send and receive. All done using the same neutral Camel API for <strong>all</strong> the components in Camel. So if the communication was socket TCP based you just get hold of a different endpoint and all the java code stays the same. That is really powerful.</p><p>Okay enough talk, show me the code!</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public static void main(final String[] args) throws Exception {
    System.out.println(&quot;Notice this client requires that the CamelServer is already running!&quot;);

    AbstractApplicationContext context = new ClassPathXmlApplicationContext(&quot;camel-client.xml&quot;);
    CamelContext camel = context.getBean(&quot;camel-client&quot;, CamelContext.class);

    // get the endpoint from the camel context
    Endpoint endpoint = camel.getEndpoint(&quot;jms:queue:numbers&quot;);

    // create the exchange used for the communication
    // we use the in out pattern for a synchronized exchange where we expect a response
    Exchange exchange = endpoint.createExchange(ExchangePattern.InOut);
    // set the input on the in body
    // must be correct type to match the expected type of an Integer object
    exchange.getIn().setBody(11);

    // to send the exchange we need an producer to do it for us
    Producer producer = endpoint.createProducer();
    // start the producer so it can operate
    producer.start();

    // let the producer process the exchange where it does all the work in this oneline of code
    System.out.println(&quot;Invoking the multiply with 11&quot;);
    producer.process(exchange);

    // get the response from the out body and cast it to an integer
    int response = exchange.getOut().getBody(Integer.class);
    System.out.println(&quot;... the result is: &quot; + response);

    // stopping the JMS producer has the side effect of the &quot;ReplyTo Queue&quot; being properly
    // closed, making this client not to try any further reads for the replies from the server
    producer.stop();

    // we&#39;re done so let&#39;s properly close the application context
    IOHelper.close(context);
}
]]></script>
</div></div>Switching to a different component is just a matter of using the correct endpoint. So if we had defined a TCP endpoint as: <code>"mina:tcp://localhost:61610"</code> then its just a matter of getting hold of this endpoint instead of the JMS and all the rest of the java code is exactly the same.<h3 id="BookInOnePage-RuntheClients">Run the Clients</h3><p>The Clients is started using their main class respectively.</p><ul class="alternate"><li>as a standard java main application - just start their main class</li><li>using maven jave:exec</li></ul><p>In this sample we start the clients using maven:<br clear="none"> <code>mvn compile exec:java -PCamelClient</code><br clear="none"> <code>mvn compile exec:java -PCamelClientRemoting</code><br clear="none"> <code>mvn compile exec:java -PCamelClientEndpoint</code></p><p>Also see the Maven <code>pom.xml</code> file how the profiles for the clients is defined.</p><h2 id="BookInOnePage-UsingtheCamelMavenPlugin">Using the Camel Maven Plugin</h2><p>The <a shape="rect" href="camel-maven-plugin.html">Camel Maven Plugin</a> allows you to run your Camel routes directly from Maven. This negates the need to create a host application, as we did with Camel server, simply to start up the container. This can be very useful during development to get Camel routes running quickly.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>pom.xml</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
      &lt;artifactId&gt;camel-maven-plugin&lt;/artifactId&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;
]]></script>
</div></div><p>All that is required is a new plugin definition in your Maven POM. As we have already placed our Camel config in the default location (camel-server.xml has been placed in META-INF/spring/) we do not need to tell the plugin where the route definitions are located. Simply run <code>mvn camel:run</code>.</p><h2 id="BookInOnePage-UsingCamelJMX">Using Camel JMX</h2><p>Camel has extensive support for JMX and allows us to inspect the Camel Server at runtime. As we have enabled the JMXAgent in our tutorial we can fire up the jconsole and connect to the following service URI: <code>service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi/camel</code>. Notice that Camel will log at INFO level the JMX Connector URI:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[...
DefaultInstrumentationAgent    INFO  JMX connector thread started on service:jmx:rmi:///jndi/rmi://claus-acer:1099/jmxrmi/camel
...
]]></script>
</div></div><p>In the screenshot below we can see the route and its performance metrics:<br clear="none"> <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="book-in-one-page.data/jconsole_jms_tutorial.PNG" data-image-src="/confluence/download/attachments/82923/jconsole_jms_tutorial.PNG?version=1&amp;modificationDate=1214345078000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="59672517" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="jconsole_jms_tutorial.PNG" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="82923" data-linked-resource-container-version="39"></span></p><h2 id="BookInOnePage-SeeAlso.5">See Also</h2><ul><li><a shape="rect" class="external-link" href="http://aminsblog.wordpress.com/2008/05/06/15/" rel="nofollow">Spring Remoting with JMS Example</a> on <a shape="rect" class="external-link" href="http://aminsblog.wordpress.com/" rel="nofollow">Amin Abbaspour's Weblog</a></li></ul>

<h2 id="BookInOnePage-Tutorial-camel-example-reportincident">Tutorial - camel-example-reportincident</h2>


<h2 id="BookInOnePage-Introduction.3">Introduction</h2>

<p>Creating this tutorial was inspired by a real life use-case I discussed over the phone with a colleague. He was working at a client whom uses a heavy-weight integration platform from a very large vendor. He was in talks with developer shops to implement a new integration on this platform. His trouble was the shop tripled the price when they realized the platform of choice. So I was wondering how we could do this integration with Camel. Can it be done, without tripling the cost <img class="emoticon emoticon-wink" src="https://cwiki.apache.org/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/icons/emoticons/wink.png" data-emoticon-name="wink" alt="(wink)">.</p>

<p>This tutorial is written during the development of the integration. I have decided to start off with a sample that isn't Camel's but standard Java and then plugin Camel as we goes. Just as when people needed to learn Spring you could consume it piece by piece, the same goes with Camel.</p>

<p>The target reader is person whom hasn't experience or just started using Camel.</p>

<h2 id="BookInOnePage-Motivationforthistutorial">Motivation for this tutorial</h2>

<p>I wrote this tutorial motivated as Camel lacked an example application that was based on the web application deployment model. The entire world hasn't moved to pure OSGi deployments yet.</p>

<div class="confluence-information-macro confluence-information-macro-tip"><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>The full source code for this tutorial as complete is part of the Apache Camel distribution in the <code>examples/camel-example-reportincident</code> directory</p></div></div>

<h2 id="BookInOnePage-Theuse-case">The use-case</h2>

<p>The goal is to allow staff to report incidents into a central administration. For that they use client software where they report the incident and submit it to the central administration. As this is an integration in a transition phase the administration should get these incidents by email whereas they are manually added to the database. The client software should gather the incident and submit the information to the integration platform that in term will transform the report into an email and send it to the central administrator for manual processing.</p>

<p>The figure below illustrates this process. The end users reports the incidents using the client applications. The incident is sent to the central integration platform as webservice. The integration platform will process the incident and send an OK acknowledgment back to the client. Then the integration will transform the message to an email and send it to the administration mail server. The users in the administration will receive the emails and take it from there.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="book-in-one-page.data/tutorial_reportincident_usecase_overview.png" data-image-src="/confluence/download/attachments/90663/tutorial_reportincident_usecase_overview.png?version=1&amp;modificationDate=1216248762000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="7707" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="tutorial_reportincident_usecase_overview.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="90663" data-linked-resource-container-version="39"></span></p>

<h3 id="BookInOnePage-InEIPpatterns">In EIP patterns</h3>

<p>We distill the use case as <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com" rel="nofollow">EIP</a> patterns:<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="book-in-one-page.data/tutorial_reportincident_usecase_eip2.png" data-image-src="/confluence/download/attachments/90663/tutorial_reportincident_usecase_eip2.png?version=1&amp;modificationDate=1219119425000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="59672632" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="tutorial_reportincident_usecase_eip2.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="90663" data-linked-resource-container-version="39"></span></p>

<h2 id="BookInOnePage-Parts">Parts</h2>

<p>This tutorial is divided into sections and parts:</p>

<p><strong>Section A: Existing Solution, how to slowly use Camel</strong></p>

<p>Part 1 - This first part explain how to setup the project and get a webservice exposed using <a shape="rect" href="http://cxf.apache.org/">Apache CXF</a>. In fact we don't touch Camel yet.</p>

<p>Part 2 - Now we are ready to introduce Camel piece by piece (without using Spring or any XML configuration file) and create the full feature integration. This part will introduce different Camel's concepts and How we can build our solution using them like :</p>
<ul class="alternate"><li>CamelContext</li><li>Endpoint, Exchange &amp; Producer</li><li>Components : Log, File</li></ul>


<p>Part 3 - Continued from part 2 where we implement that last part of the solution with the event driven consumer and how to send the email through the Mail component.</p>

<p><strong>Section B: The Camel Solution</strong></p>

<p>Part 4 - We now turn into the path of Camel where it excels - the routing.<br clear="none">
Part 5 - Is about how embed Camel with Spring and using <a shape="rect" href="cxf.html">CXF</a> endpoints directly in Camel<br clear="none">
Part 6 - Showing a alternative solution primarily using XML instead of Java code</p>

<div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Using Axis 2</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>See this blog entry by Sagara demonstrating how to use <a shape="rect" class="external-link" href="http://ws.apache.org/axis2/">Apache Axis 2</a> instead of <a shape="rect" href="http://cxf.apache.org/">Apache CXF</a> as the web service framework.</p></div></div>

<h2 id="BookInOnePage-Links">Links</h2>

<ul class="alternate"><li><a shape="rect" href="tutorial-example-reportincident.html">Introduction</a></li><li><a shape="rect" href="tutorial-example-reportincident-part1.html">Part 1</a></li><li><a shape="rect" href="tutorial-example-reportincident-part2.html">Part 2</a></li><li><a shape="rect" href="tutorial-example-reportincident-part3.html">Part 3</a></li><li><a shape="rect" href="tutorial-example-reportincident-part4.html">Part 4</a></li><li><a shape="rect" href="tutorial-example-reportincident-part5.html">Part 5</a></li><li><a shape="rect" href="tutorial-example-reportincident-part6.html">Part 6</a></li></ul>
<h2 id="BookInOnePage-Part1">Part 1</h2>

<h2 id="BookInOnePage-Prerequisites.1">Prerequisites</h2>
<p>This tutorial uses the following frameworks:</p>
<ul><li>Maven 3.0.4</li><li>Apache Camel 2.10.0</li><li>Apache CXF 2.6.1</li><li>Spring 3.0.7</li></ul>


<p><strong>Note:</strong> The sample project can be downloaded, see the <a shape="rect" href="#BookInOnePage-Resources">resources</a> section.</p>

<h2 id="BookInOnePage-InitialProjectSetup">Initial Project Setup</h2>
<p>We want the integration to be a standard .war application that can be deployed in any web container such as Tomcat, Jetty or even heavy weight application servers such as WebLogic or WebSphere. There fore we start off with the standard Maven webapp project that is created with the following long archetype command:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
mvn archetype:create -DgroupId=org.apache.camel -DartifactId=camel-example-reportincident -DarchetypeArtifactId=maven-archetype-webapp
]]></script>
</div></div>

<p>Notice that the groupId etc. doens't have to be org.apache.camel it can be com.mycompany.whatever. But I have used these package names as the example is an official part of the Camel distribution.</p>

<p>Then we have the basic maven folder layout. We start out with the webservice part where we want to use Apache CXF for the webservice stuff. So we add this to the pom.xml</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    &lt;properties&gt;
        &lt;cxf-version&gt;2.6.1&lt;/cxf-version&gt;
    &lt;/properties&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt;
        &lt;artifactId&gt;cxf-rt-core&lt;/artifactId&gt;
        &lt;version&gt;${cxf-version}&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt;
        &lt;artifactId&gt;cxf-rt-frontend-jaxws&lt;/artifactId&gt;
        &lt;version&gt;${cxf-version}&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt;
        &lt;artifactId&gt;cxf-rt-transports-http&lt;/artifactId&gt;
        &lt;version&gt;${cxf-version}&lt;/version&gt;
    &lt;/dependency&gt;
]]></script>
</div></div>

<h2 id="BookInOnePage-DevelopingtheWebService">Developing the WebService</h2>
<p>As we want to develop webservice with the contract first approach we create our .wsdl file. As this is a example we have simplified the model of the incident to only include 8 fields. In real life the model would be a bit more complex, but not to much.</p>

<p>We put the wsdl file in the folder <code>src/main/webapp/WEB-INF/wsdl</code> and name the file <code>report_incident.wsdl</code>.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
&lt;wsdl:definitions xmlns:soap=&quot;http://schemas.xmlsoap.org/wsdl/soap/&quot;
	xmlns:tns=&quot;http://reportincident.example.camel.apache.org&quot;
	xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;
	xmlns:http=&quot;http://schemas.xmlsoap.org/wsdl/http/&quot;
	xmlns:wsdl=&quot;http://schemas.xmlsoap.org/wsdl/&quot;
	targetNamespace=&quot;http://reportincident.example.camel.apache.org&quot;&gt;

	&lt;!-- Type definitions for input- and output parameters for webservice --&gt;
	&lt;wsdl:types&gt;
	&lt;xs:schema targetNamespace=&quot;http://reportincident.example.camel.apache.org&quot;&gt;
			&lt;xs:element name=&quot;inputReportIncident&quot;&gt;
				&lt;xs:complexType&gt;
					&lt;xs:sequence&gt;
						&lt;xs:element type=&quot;xs:string&quot;  name=&quot;incidentId&quot;/&gt;
						&lt;xs:element type=&quot;xs:string&quot;  name=&quot;incidentDate&quot;/&gt;
						&lt;xs:element type=&quot;xs:string&quot;  name=&quot;givenName&quot;/&gt;
						&lt;xs:element type=&quot;xs:string&quot;  name=&quot;familyName&quot;/&gt;
						&lt;xs:element type=&quot;xs:string&quot;  name=&quot;summary&quot;/&gt;
						&lt;xs:element type=&quot;xs:string&quot;  name=&quot;details&quot;/&gt;
						&lt;xs:element type=&quot;xs:string&quot;  name=&quot;email&quot;/&gt;
						&lt;xs:element type=&quot;xs:string&quot;  name=&quot;phone&quot;/&gt;
					&lt;/xs:sequence&gt;
				&lt;/xs:complexType&gt;
			&lt;/xs:element&gt;
			&lt;xs:element name=&quot;outputReportIncident&quot;&gt;
				&lt;xs:complexType&gt;
					&lt;xs:sequence&gt;
						&lt;xs:element type=&quot;xs:string&quot; name=&quot;code&quot;/&gt;
					&lt;/xs:sequence&gt;
				&lt;/xs:complexType&gt;
			&lt;/xs:element&gt;
		&lt;/xs:schema&gt;
	&lt;/wsdl:types&gt;

	&lt;!-- Message definitions for input and output --&gt;
	&lt;wsdl:message name=&quot;inputReportIncident&quot;&gt;
		&lt;wsdl:part name=&quot;parameters&quot; element=&quot;tns:inputReportIncident&quot;/&gt;
	&lt;/wsdl:message&gt;
	&lt;wsdl:message name=&quot;outputReportIncident&quot;&gt;
		&lt;wsdl:part name=&quot;parameters&quot; element=&quot;tns:outputReportIncident&quot;/&gt;
	&lt;/wsdl:message&gt;

	&lt;!-- Port (interface) definitions --&gt;
	&lt;wsdl:portType name=&quot;ReportIncidentEndpoint&quot;&gt;
		&lt;wsdl:operation name=&quot;ReportIncident&quot;&gt;
			&lt;wsdl:input message=&quot;tns:inputReportIncident&quot;/&gt;
			&lt;wsdl:output message=&quot;tns:outputReportIncident&quot;/&gt;
		&lt;/wsdl:operation&gt;
	&lt;/wsdl:portType&gt;

	&lt;!-- Port bindings to transports and encoding - HTTP, document literal encoding is used --&gt;
	&lt;wsdl:binding name=&quot;ReportIncidentBinding&quot; type=&quot;tns:ReportIncidentEndpoint&quot;&gt;
		&lt;soap:binding transport=&quot;http://schemas.xmlsoap.org/soap/http&quot;/&gt;
		&lt;wsdl:operation name=&quot;ReportIncident&quot;&gt;
			&lt;soap:operation
				soapAction=&quot;http://reportincident.example.camel.apache.org/ReportIncident&quot;
				style=&quot;document&quot;/&gt;
			&lt;wsdl:input&gt;
				&lt;soap:body parts=&quot;parameters&quot; use=&quot;literal&quot;/&gt;
			&lt;/wsdl:input&gt;
			&lt;wsdl:output&gt;
				&lt;soap:body parts=&quot;parameters&quot; use=&quot;literal&quot;/&gt;
			&lt;/wsdl:output&gt;
		&lt;/wsdl:operation&gt;
	&lt;/wsdl:binding&gt;

	&lt;!-- Service definition --&gt;
	&lt;wsdl:service name=&quot;ReportIncidentService&quot;&gt;
		&lt;wsdl:port name=&quot;ReportIncidentPort&quot; binding=&quot;tns:ReportIncidentBinding&quot;&gt;
			&lt;soap:address location=&quot;http://reportincident.example.camel.apache.org&quot;/&gt;
		&lt;/wsdl:port&gt;
	&lt;/wsdl:service&gt;

&lt;/wsdl:definitions&gt;
]]></script>
</div></div>
<h3 id="BookInOnePage-CXFwsdl2java">CXF wsdl2java</h3>
<p>Then we integration the CXF wsdl2java generator in the pom.xml so we have CXF generate the needed POJO classes for our webservice contract. <br clear="none">
However at first we must configure maven to live in the modern world of Java 1.6 so we must add this to the pom.xml</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
			&lt;!-- to compile with 1.6 --&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
				&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
				&lt;configuration&gt;
					&lt;source&gt;1.6&lt;/source&gt;
					&lt;target&gt;1.6&lt;/target&gt;
				&lt;/configuration&gt;
			&lt;/plugin&gt;
]]></script>
</div></div>

<p>And then we can add the CXF wsdl2java code generator that will hook into the compile goal so its automatic run all the time:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
			&lt;!-- CXF wsdl2java generator, will plugin to the compile goal --&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.apache.cxf&lt;/groupId&gt;
				&lt;artifactId&gt;cxf-codegen-plugin&lt;/artifactId&gt;
				&lt;version&gt;${cxf-version}&lt;/version&gt;
				&lt;executions&gt;
					&lt;execution&gt;
						&lt;id&gt;generate-sources&lt;/id&gt;
						&lt;phase&gt;generate-sources&lt;/phase&gt;
						&lt;configuration&gt;
							&lt;sourceRoot&gt;${basedir}/target/generated/src/main/java&lt;/sourceRoot&gt;
							&lt;wsdlOptions&gt;
								&lt;wsdlOption&gt;
									&lt;wsdl&gt;${basedir}/src/main/webapp/WEB-INF/wsdl/report_incident.wsdl&lt;/wsdl&gt;
								&lt;/wsdlOption&gt;
							&lt;/wsdlOptions&gt;
						&lt;/configuration&gt;
						&lt;goals&gt;
							&lt;goal&gt;wsdl2java&lt;/goal&gt;
						&lt;/goals&gt;
					&lt;/execution&gt;
				&lt;/executions&gt;
			&lt;/plugin&gt;
]]></script>
</div></div>

<p>You are now setup and should be able to compile the project. So running the <code>mvn compile</code> should run the CXF wsdl2java and generate the source code in the folder <code>&amp;{basedir}/target/generated/src/main/java</code> that we specified in the pom.xml above. Since its in the <code>target/generated/src/main/java</code> maven will pick it up and include it in the build process. </p>

<h3 id="BookInOnePage-Configurationoftheweb.xml">Configuration of the web.xml</h3>
<p>Next up is to configure the web.xml to be ready to use CXF so we can expose the webservice.<br clear="none">
As Spring is the center of the universe, or at least is a very important framework in today's Java land we start with the listener that kick-starts Spring. This is the usual piece of code:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
	&lt;!-- the listener that kick-starts Spring --&gt;
	&lt;listener&gt;
		&lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
	&lt;/listener&gt;
]]></script>
</div></div>
<p>And then we have the CXF part where we define the CXF servlet and its URI mappings to which we have chosen that all our webservices should be in the path <code>/webservices/</code></p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
	&lt;!-- CXF servlet --&gt;
	&lt;servlet&gt;
		&lt;servlet-name&gt;CXFServlet&lt;/servlet-name&gt;
		&lt;servlet-class&gt;org.apache.cxf.transport.servlet.CXFServlet&lt;/servlet-class&gt;
		&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
	&lt;/servlet&gt;

	&lt;!-- all our webservices are mapped under this URI pattern --&gt;
	&lt;servlet-mapping&gt;
		&lt;servlet-name&gt;CXFServlet&lt;/servlet-name&gt;
		&lt;url-pattern&gt;/webservices/*&lt;/url-pattern&gt;
	&lt;/servlet-mapping&gt;
]]></script>
</div></div>

<p>Then the last piece of the puzzle is to configure CXF, this is done in a spring XML that we link to fron the web.xml by the standard Spring <code>contextConfigLocation</code> property in the web.xml</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
	&lt;!-- location of spring xml files --&gt;
	&lt;context-param&gt;
		&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
		&lt;param-value&gt;classpath:cxf-config.xml&lt;/param-value&gt;
	&lt;/context-param&gt;
]]></script>
</div></div>
<p>We have named our CXF configuration file <code>cxf-config.xml</code> and its located in the root of the classpath. In Maven land that is we can have the <code>cxf-config.xml</code> file in the <code>src/main/resources</code> folder. We could also have the file located in the WEB-INF folder for instance <code>&lt;param-value&gt;/WEB-INF/cxf-config.xml&lt;/param-value&gt;</code>.</p>

<h3 id="BookInOnePage-Gettingridoftheoldjspworld">Getting rid of the old jsp world</h3>
<p>The maven archetype that created the basic folder structure also created a sample .jsp file index.jsp. This file <code>src/main/webapp/index.jsp</code> should be deleted. </p>

<h3 id="BookInOnePage-ConfigurationofCXF">Configuration of CXF</h3>
<p>The cxf-config.xml is as follows:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:jaxws=&quot;http://cxf.apache.org/jaxws&quot;
       xsi:schemaLocation=&quot;
            http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
            http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd&quot;&gt;

    &lt;import resource=&quot;classpath:META-INF/cxf/cxf.xml&quot;/&gt;
    &lt;import resource=&quot;classpath:META-INF/cxf/cxf-extension-soap.xml&quot;/&gt;
    &lt;import resource=&quot;classpath:META-INF/cxf/cxf-servlet.xml&quot;/&gt;

    &lt;!-- implementation of the webservice --&gt;
    &lt;bean id=&quot;reportIncidentEndpoint&quot; class=&quot;org.apache.camel.example.reportincident.ReportIncidentEndpointImpl&quot;/&gt;

    &lt;!-- export the webservice using jaxws --&gt;
    &lt;jaxws:endpoint id=&quot;reportIncident&quot;
                    implementor=&quot;#reportIncidentEndpoint&quot;
                    address=&quot;/incident&quot;
                    wsdlLocation=&quot;/WEB-INF/wsdl/report_incident.wsdl&quot;
                    endpointName=&quot;s:ReportIncidentPort&quot;
                    serviceName=&quot;s:ReportIncidentService&quot;
                    xmlns:s=&quot;http://reportincident.example.camel.apache.org&quot;/&gt;

&lt;/beans&gt;
]]></script>
</div></div>

<p>The configuration is standard <a shape="rect" href="cxf.html">CXF</a> and is documented at the <a shape="rect" href="http://cxf.apache.org/">Apache CXF website</a>.</p>

<p>The 3 import elements is needed by CXF and they must be in the file.</p>

<p>Noticed that we have a spring bean <strong>reportIncidentEndpoint</strong> that is the implementation of the webservice endpoint we let CXF expose.<br clear="none">
Its linked from the jaxws element with the implementator attribute as we use the # mark to identify its a reference to a spring bean. We could have stated the classname directly as <code>implementor="org.apache.camel.example.reportincident.ReportIncidentEndpoint"</code> but then we lose the ability to let the ReportIncidentEndpoint be configured by spring.<br clear="none">
The <strong>address</strong> attribute defines the relative part of the URL of the exposed webservice. <strong>wsdlLocation</strong> is an optional parameter but for persons like me that likes contract-first we want to expose our own .wsdl contracts and not the auto generated by the frameworks, so with this attribute we can link to the real .wsdl file. The last stuff is needed by CXF as you could have several services so it needs to know which this one is. Configuring these is quite easy as all the information is in the wsdl already.</p>

<h3 id="BookInOnePage-ImplementingtheReportIncidentEndpoint">Implementing the ReportIncidentEndpoint</h3>
<p>Phew after all these meta files its time for some java code so we should code the implementor of the webservice. So we fire up <code>mvn compile</code> to let CXF generate the POJO classes for our webservice and we are ready to fire up a Java editor.</p>

<p>You can use <code>mvn idea:idea</code> or <code>mvn eclipse:eclipse</code> to create project files for these editors so you can load the project. However IDEA has been smarter lately and can load a pom.xml directly.</p>

<p>As we want to quickly see our webservice we implement just a quick and dirty as it can get. At first beware that since its jaxws and Java 1.5 we get annotations for the money, but they reside on the interface so we can remove them from our implementations so its a nice plain POJO again:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
package org.apache.camel.example.reportincident;

/**
 * The webservice we have implemented.
 */
public class ReportIncidentEndpointImpl implements ReportIncidentEndpoint {

    public OutputReportIncident reportIncident(InputReportIncident parameters) {
        System.out.println(&quot;Hello ReportIncidentEndpointImpl is called from &quot; + parameters.getGivenName());

        OutputReportIncident out = new OutputReportIncident();
        out.setCode(&quot;OK&quot;);
        return out;
    }

}
]]></script>
</div></div>

<p>We just output the person that invokes this webservice and returns a OK response. This class should be in the maven source root folder <code>src/main/java</code> under the package name <code>org.apache.camel.example.reportincident</code>. Beware that the maven archetype tool didn't create the <code>src/main/java folder</code>, so you should create it manually.</p>

<p>To test if we are home free we run <code>mvn clean compile</code>.</p>

<h3 id="BookInOnePage-Runningourwebservice">Running our webservice</h3>
<p>Now that the code compiles we would like to run it inside a web container, for this purpose we make use of Jetty which we will bootstrap using it's plugin <code>org.mortbay.jetty:maven-jetty-plugin</code>:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
       &lt;build&gt;
           &lt;plugins&gt;
               ...
               &lt;!-- so we can run mvn jetty:run --&gt;
               &lt;plugin&gt;
                   &lt;groupId&gt;org.mortbay.jetty&lt;/groupId&gt;
                   &lt;artifactId&gt;maven-jetty-plugin&lt;/artifactId&gt;
                   &lt;version&gt;${jetty-version}&lt;/version&gt;
               &lt;/plugin&gt;
]]></script>
</div></div>
<p><strong>Notice:</strong> We make use of the Jetty version being defined inside the <a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/camel/trunk/parent/pom.xml">Camel's Parent POM</a>.</p>

<p>So to see if everything is in order we fire up jetty with <code>mvn jetty:run</code> and if everything is okay you should be able to access <code><a shape="rect" class="external-link" href="http://localhost:8080" rel="nofollow">http://localhost:8080</a></code>.<br clear="none">
Jetty is smart that it will list the correct URI on the page to our web application, so just click on the link. This is smart as you don't have to remember the exact web context URI for your application - just fire up the default page and Jetty will help you.</p>

<p>So where is the damn webservice then? Well as we did configure the web.xml to instruct the CXF servlet to accept the pattern <code>/webservices/*</code> we should hit this URL to get the attention of CXF: <code><a shape="rect" class="external-link" href="http://localhost:8080/camel-example-reportincident/webservices" rel="nofollow">http://localhost:8080/camel-example-reportincident/webservices</a></code>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="book-in-one-page.data/tutorial_reportincident_cxf_servicelist2.png" data-image-src="/confluence/download/attachments/90920/tutorial_reportincident_cxf_servicelist2.png?version=1&amp;modificationDate=1216677217000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="7714" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="tutorial_reportincident_cxf_servicelist2.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="90920" data-linked-resource-container-version="30"></span><br clear="none">
&#160;</p>

<h3 id="BookInOnePage-Hittingthewebservice">Hitting the webservice</h3>
<p>Now we have the webservice running in a standard .war application in a standard web container such as Jetty we would like to invoke the webservice and see if we get our code executed. Unfortunately this isn't the easiest task in the world - its not so easy as a REST URL, so we need tools for this. So we fire up our trusty webservice tool <a shape="rect" class="external-link" href="http://www.soapui.org/" rel="nofollow">SoapUI</a> and let it be the one to fire the webservice request and see the response.</p>

<p>Using SoapUI we sent a request to our webservice and we got the expected OK response and the console outputs the System.out so we are ready to code.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="book-in-one-page.data/tutorial_reportincident_soapui2.png" data-image-src="/confluence/download/attachments/90920/tutorial_reportincident_soapui2.png?version=1&amp;modificationDate=1216677174000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="7713" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="tutorial_reportincident_soapui2.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="90920" data-linked-resource-container-version="30"></span><br clear="none">
&#160;</p>

<h3 id="BookInOnePage-RemoteDebugging">Remote Debugging</h3>
<p>Okay a little sidestep but wouldn't it be cool to be able to debug your code when its fired up under Jetty? As Jetty is started from maven, we need to instruct maven to use debug mode. <br clear="none">
Se we set the <code>MAVEN_OPTS</code> environment to start in debug mode and listen on port 5005.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
MAVEN_OPTS=-Xmx512m -XX:MaxPermSize=128m -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5005
]]></script>
</div></div>

<p>Then you need to restart Jetty so its stopped with <strong>ctrl + c</strong>. Remember to start a new shell to pickup the new environment settings. And start jetty again.</p>

<p>Then we can from our IDE attach a remote debugger and debug as we want.<br clear="none">
First we configure IDEA to attach to a remote debugger on port 5005:<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="book-in-one-page.data/tutorial_reportincident_remotedebug_idea_setup2.png" data-image-src="/confluence/download/attachments/90920/tutorial_reportincident_remotedebug_idea_setup2.png?version=1&amp;modificationDate=1216677205000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="7715" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="tutorial_reportincident_remotedebug_idea_setup2.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="90920" data-linked-resource-container-version="30"></span><br clear="none">
&#160;</p>

<p>Then we set a breakpoint in our code <code>ReportIncidentEndpoint</code> and hit the SoapUI once again and we are breaked at the breakpoint where we can inspect the parameters:<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="book-in-one-page.data/tutorial_reportincident_remotedebug_idea_breakpoint2.png" data-image-src="/confluence/download/attachments/90920/tutorial_reportincident_remotedebug_idea_breakpoint2.png?version=1&amp;modificationDate=1216677190000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="7716" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="tutorial_reportincident_remotedebug_idea_breakpoint2.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="90920" data-linked-resource-container-version="30"></span><br clear="none">
&#160;</p>

<h3 id="BookInOnePage-Addingaunittest">Adding a unit test</h3>
<p>Oh so much hard work just to hit a webservice, why can't we just use an unit test to invoke our webservice? Yes of course we can do this, and that's the next step.<br clear="none">
First we create the folder structure <code>src/test/java</code> and <code>src/test/resources</code>. We then create the unit test in the <code>src/test/java</code> folder.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
package org.apache.camel.example.reportincident;

import junit.framework.TestCase;

/**
 * Plain JUnit test of our webservice.
 */
public class ReportIncidentEndpointTest extends TestCase {

}
]]></script>
</div></div>
<p>Here we have a plain old JUnit class. As we want to test webservices we need to start and expose our webservice in the unit test before we can test it. And JAXWS has pretty decent methods to help us here, the code is simple as:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    import javax.xml.ws.Endpoint;
    ...

    private static String ADDRESS = &quot;http://localhost:9090/unittest&quot;;

    protected void startServer() throws Exception {
        // We need to start a server that exposes or webservice during the unit testing
        // We use jaxws to do this pretty simple
        ReportIncidentEndpointImpl server = new ReportIncidentEndpointImpl();
        Endpoint.publish(ADDRESS, server);
    }
]]></script>
</div></div>

<p>The Endpoint class is the <code>javax.xml.ws.Endpoint</code> that under the covers looks for a provider and in our case its CXF - so its CXF that does the heavy lifting of exposing out webservice on the given URL address. Since our class ReportIncidentEndpointImpl implements the interface <strong>ReportIncidentEndpoint</strong> that is decorated with all the jaxws annotations it got all the information it need to expose the webservice. Below is the CXF wsdl2java generated interface:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[

/*
 * 
 */

package org.apache.camel.example.reportincident;

import javax.jws.WebMethod;
import javax.jws.WebParam;
import javax.jws.WebResult;
import javax.jws.WebService;
import javax.jws.soap.SOAPBinding;
import javax.jws.soap.SOAPBinding.ParameterStyle;
import javax.xml.bind.annotation.XmlSeeAlso;

/**
 * This class was generated by Apache CXF 2.1.1
 * Wed Jul 16 12:40:31 CEST 2008
 * Generated source version: 2.1.1
 * 
 */
 
 /*
  * 
  */


@WebService(targetNamespace = &quot;http://reportincident.example.camel.apache.org&quot;, name = &quot;ReportIncidentEndpoint&quot;)
@XmlSeeAlso({ObjectFactory.class})
@SOAPBinding(parameterStyle = SOAPBinding.ParameterStyle.BARE)

public interface ReportIncidentEndpoint {

/*
 * 
 */

    @SOAPBinding(parameterStyle = SOAPBinding.ParameterStyle.BARE)
    @WebResult(name = &quot;outputReportIncident&quot;, targetNamespace = &quot;http://reportincident.example.camel.apache.org&quot;, partName = &quot;parameters&quot;)
    @WebMethod(operationName = &quot;ReportIncident&quot;, action = &quot;http://reportincident.example.camel.apache.org/ReportIncident&quot;)
    public OutputReportIncident reportIncident(
        @WebParam(partName = &quot;parameters&quot;, name = &quot;inputReportIncident&quot;, targetNamespace = &quot;http://reportincident.example.camel.apache.org&quot;)
        InputReportIncident parameters
    );
}
]]></script>
</div></div>

<p>Next up is to create a webservice client so we can invoke our webservice. For this we actually use the CXF framework directly as its a bit more easier to create a client using this framework than using the JAXWS style. We could have done the same for the server part, and you should do this if you need more power and access more advanced features.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    import org.apache.cxf.jaxws.JaxWsProxyFactoryBean;
    ...
    
    protected ReportIncidentEndpoint createCXFClient() {
        // we use CXF to create a client for us as its easier than JAXWS and works
        JaxWsProxyFactoryBean factory = new JaxWsProxyFactoryBean();
        factory.setServiceClass(ReportIncidentEndpoint.class);
        factory.setAddress(ADDRESS);
        return (ReportIncidentEndpoint) factory.create();
    }
]]></script>
</div></div>

<p>So now we are ready for creating a unit test. We have the server and the client. So we just create a plain simple unit test method as the usual junit style:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    public void testRendportIncident() throws Exception {
        startServer();

        ReportIncidentEndpoint client = createCXFClient();

        InputReportIncident input = new InputReportIncident();
        input.setIncidentId(&quot;123&quot;);
        input.setIncidentDate(&quot;2008-07-16&quot;);
        input.setGivenName(&quot;Claus&quot;);
        input.setFamilyName(&quot;Ibsen&quot;);
        input.setSummary(&quot;bla bla&quot;);
        input.setDetails(&quot;more bla bla&quot;);
        input.setEmail(&quot;davsclaus@apache.org&quot;);
        input.setPhone(&quot;+45 2962 7576&quot;);

        OutputReportIncident out = client.reportIncident(input);
        assertEquals(&quot;Response code is wrong&quot;, &quot;OK&quot;, out.getCode());
    }
]]></script>
</div></div>

<p>Now we are nearly there. But if you run the unit test with <code>mvn test</code> then it will fail. Why!!! Well its because that CXF needs is missing some dependencies during unit testing. In fact it needs the web container, so we need to add this to our <strong>pom.xml</strong>.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    &lt;!-- cxf web container for unit testing --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt;
        &lt;artifactId&gt;cxf-rt-transports-http-jetty&lt;/artifactId&gt;
        &lt;version&gt;${cxf-version}&lt;/version&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
]]></script>
</div></div>

<p>Well what is that, CXF also uses Jetty for unit test - well its just shows how agile, embedable and popular Jetty is.</p>

<p>So lets run our junit test with, and it reports:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
mvn test
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0
[INFO] BUILD SUCCESSFUL
]]></script>
</div></div>

<p>Yep thats it for now. We have a basic project setup.</p>


<h2 id="BookInOnePage-Endofpart1">End of part 1</h2>
<p>Thanks for being patient and reading all this more or less standard Maven, Spring, JAXWS and Apache CXF stuff. Its stuff that is well covered on the net, but I wanted a full fledged tutorial on a maven project setup that is web service ready with Apache CXF. We will use this as a base for the next part where we demonstrate how Camel can be digested slowly and piece by piece just as it was back in the times when was introduced and was learning the Spring framework that we take for granted today. </p>

<h2 id="BookInOnePage-#Resources"><a shape="rect" href="#BookInOnePage-Resources">#Resources</a></h2>
<ul><li><a shape="rect" class="external-link" href="http://cwiki.apache.org/CXF20DOC/index.html">Apache CXF user guide</a></li></ul>


<h2 id="BookInOnePage-Links.1">Links</h2>
<ul class="alternate"><li><a shape="rect" href="tutorial-example-reportincident.html">Introduction</a></li><li><a shape="rect" href="tutorial-example-reportincident-part1.html">Part 1</a></li><li><a shape="rect" href="tutorial-example-reportincident-part2.html">Part 2</a></li><li><a shape="rect" href="tutorial-example-reportincident-part3.html">Part 3</a></li><li><a shape="rect" href="tutorial-example-reportincident-part4.html">Part 4</a></li><li><a shape="rect" href="tutorial-example-reportincident-part5.html">Part 5</a></li><li><a shape="rect" href="tutorial-example-reportincident-part6.html">Part 6</a></li></ul>
<h2 id="BookInOnePage-Part2">Part 2</h2>

<h2 id="BookInOnePage-AddingCamel">Adding Camel</h2>
<p>In this part we will introduce Camel so we start by adding Camel to our pom.xml:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
       &lt;properties&gt;
            ...
            &lt;camel-version&gt;1.4.0&lt;/camel-version&gt;
        &lt;/properties&gt;

        &lt;!-- camel --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
            &lt;artifactId&gt;camel-core&lt;/artifactId&gt;
            &lt;version&gt;${camel-version}&lt;/version&gt;
        &lt;/dependency&gt;
]]></script>
</div></div>

<p>That's it, only <strong>one</strong> dependency for now.</p>
<div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Synchronize IDE</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>If you continue from part 1, remember to update your editor project settings since we have introduce new .jar files. For instance IDEA has a feature to synchronize with Maven projects.</p></div></div>

<p>Now we turn towards our webservice endpoint implementation where we want to let Camel have a go at the input we receive. As Camel is very non invasive its basically a .jar file then we can just grap Camel but creating a new instance of <code>DefaultCamelContext</code> that is the hearth of Camel its context.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
CamelContext camel = new DefaultCamelContext();
]]></script>
</div></div>

<p>In fact we create a constructor in our webservice and add this code:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    private CamelContext camel;

    public ReportIncidentEndpointImpl() throws Exception {
        // create the camel context that is the &quot;heart&quot; of Camel
        camel = new DefaultCamelContext();

        // add the log component
        camel.addComponent(&quot;log&quot;, new LogComponent());

        // start Camel
        camel.start();
    }
]]></script>
</div></div>

<h2 id="BookInOnePage-Loggingthe&quot;HelloWorld&quot;">Logging the "Hello World"</h2>
<p>Here at first we want Camel to log the <strong>givenName</strong> and <strong>familyName</strong> parameters we receive, so we add the <code>LogComponent</code> with the key <strong>log</strong>. And we must <strong>start</strong> Camel before its ready to act.</p>
<div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Component Documentation</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>The <a shape="rect" href="log.html">Log</a> and <a shape="rect" href="file2.html">File</a> components is documented as well, just click on the links. Just return to this documentation later when you must use these components for real.</p></div></div>
<p>Then we change the code in the method that is invoked by Apache CXF when a webservice request arrives. We get the name and let Camel have a go at it in the new method we create <strong>sendToCamel</strong>:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    public OutputReportIncident reportIncident(InputReportIncident parameters) {
        String name = parameters.getGivenName() + &quot; &quot; + parameters.getFamilyName();

        // let Camel do something with the name
        sendToCamelLog(name);

        OutputReportIncident out = new OutputReportIncident();
        out.setCode(&quot;OK&quot;);
        return out;
    }
]]></script>
</div></div>

<p>Next is the Camel code. At first it looks like there are many code lines to do a simple task of logging the name - yes it is. But later you will in fact realize this is one of Camels true power. Its concise API. Hint: The same code can be used for <strong>any</strong> component in Camel.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    private void sendToCamelLog(String name) {
        try {
            // get the log component
            Component component = camel.getComponent(&quot;log&quot;);

            // create an endpoint and configure it.
            // Notice the URI parameters this is a common pratice in Camel to configure
            // endpoints based on URI.
            // com.mycompany.part2 = the log category used. Will log at INFO level as default
            Endpoint endpoint = component.createEndpoint(&quot;log:com.mycompany.part2&quot;);

            // create an Exchange that we want to send to the endpoint
            Exchange exchange = endpoint.createExchange();
            // set the in message payload (=body) with the name parameter
            exchange.getIn().setBody(name);

            // now we want to send the exchange to this endpoint and we then need a producer
            // for this, so we create and start the producer.
            Producer producer = endpoint.createProducer();
            producer.start();
            // process the exchange will send the exchange to the log component, that will process
            // the exchange and yes log the payload
            producer.process(exchange);

            // stop the producer, we want to be nice and cleanup
            producer.stop();




        } catch (Exception e) {
            // we ignore any exceptions and just rethrow as runtime
            throw new RuntimeException(e);

        }
    }
]]></script>
</div></div>
<p>Okay there are code comments in the code block above that should explain what is happening. We run the code by invoking our unit test with maven <code>mvn test</code>, and we should get this log line:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
INFO: Exchange[BodyType:String, Body:Claus Ibsen]
]]></script>
</div></div>

<h2 id="BookInOnePage-Writetofile-easywiththesamecodestyle">Write to file - easy with the same code style</h2>
<p>Okay that isn't to impressive, Camel can log <img class="emoticon emoticon-wink" src="https://cwiki.apache.org/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/icons/emoticons/wink.png" data-emoticon-name="wink" alt="(wink)"> Well I promised that the above code style can be used for <strong>any</strong> component, so let's store the payload in a file. We do this by adding the file component to the Camel context</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        // add the file component
        camel.addComponent(&quot;file&quot;, new FileComponent());
]]></script>
</div></div>

<p>And then we let camel write the payload to the file after we have logged, by creating a new method <strong>sendToCamelFile</strong>. We want to store the payload in filename with the incident id so we need this parameter also:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        // let Camel do something with the name
        sendToCamelLog(name);
        sendToCamelFile(parameters.getIncidentId(), name);
]]></script>
</div></div>

<p>And then the code that is 99% identical. We have change the URI configuration when we create the endpoint as we pass in configuration parameters to the file component.<br clear="none">
And then we need to set the output filename and this is done by adding a special header to the exchange. That's the only difference:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    private void sendToCamelFile(String incidentId, String name) {
        try {
            // get the file component
            Component component = camel.getComponent(&quot;file&quot;);

            // create an endpoint and configure it.
            // Notice the URI parameters this is a common pratice in Camel to configure
            // endpoints based on URI.
            // file://target instructs the base folder to output the files. We put in the target folder
            // then its actumatically cleaned by mvn clean
            Endpoint endpoint = component.createEndpoint(&quot;file://target&quot;);

            // create an Exchange that we want to send to the endpoint
            Exchange exchange = endpoint.createExchange();
            // set the in message payload (=body) with the name parameter
            exchange.getIn().setBody(name);

            // now a special header is set to instruct the file component what the output filename
            // should be
            exchange.getIn().setHeader(FileComponent.HEADER_FILE_NAME, &quot;incident-&quot; + incidentId + &quot;.txt&quot;);

            // now we want to send the exchange to this endpoint and we then need a producer
            // for this, so we create and start the producer.
            Producer producer = endpoint.createProducer();
            producer.start();
            // process the exchange will send the exchange to the file component, that will process
            // the exchange and yes write the payload to the given filename
            producer.process(exchange);

            // stop the producer, we want to be nice and cleanup
            producer.stop();
        } catch (Exception e) {
            // we ignore any exceptions and just rethrow as runtime
            throw new RuntimeException(e);
        }
    }
]]></script>
</div></div>

<p>After running our unit test again with <code>mvn test</code> we have a output file in the target folder:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
D:\demo\part-two&gt;type target\incident-123.txt
Claus Ibsen
]]></script>
</div></div>

<h2 id="BookInOnePage-Fullyjavabasedconfigurationofendpoints">Fully java based configuration of endpoints</h2>
<p>In the file example above the configuration was URI based. What if you want 100% java setter based style, well this is of course also possible. We just need to cast to the component specific endpoint and then we have all the setters available:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
            // create the file endpoint, we cast to FileEndpoint because then we can do
            // 100% java settter based configuration instead of the URI sting based
            // must pass in an empty string, or part of the URI configuration if wanted 
            FileEndpoint endpoint = (FileEndpoint)component.createEndpoint(&quot;&quot;);
            endpoint.setFile(new File(&quot;target/subfolder&quot;));
            endpoint.setAutoCreate(true);
]]></script>
</div></div>
<p>That's it. Now we have used the setters to configure the <code>FileEndpoint</code> that it should store the file in the folder target/subfolder. Of course Camel now stores the file in the subfolder.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
D:\demo\part-two&gt;type target\subfolder\incident-123.txt
Claus Ibsen
]]></script>
</div></div>

<h2 id="BookInOnePage-Lessonslearned">Lessons learned</h2>
<p>Okay I wanted to demonstrate how you can be in 100% control of the configuration and usage of Camel based on plain Java code with no hidden magic or special <strong>XML</strong> or other configuration files. Just add the camel-core.jar and you are ready to go.</p>

<p>You must have noticed that the code for sending a message to a given endpoint is the same for both the <strong>log</strong> and <strong>file</strong>, in fact <strong>any</strong> Camel endpoint. You as the client shouldn't bother with component specific code such as file stuff for file components, jms stuff for JMS messaging etc. This is what the <a shape="rect" href="message-endpoint.html">Message Endpoint</a> EIP pattern is all about and Camel solves this very very nice - a key pattern in Camel.</p>

<h2 id="BookInOnePage-Reducingcodelines">Reducing code lines</h2>
<p>Now that you have been introduced to Camel and one of its masterpiece patterns solved elegantly with the <a shape="rect" href="message-endpoint.html">Message Endpoint</a> its time to give productive and show a solution in fewer code lines, in fact we can get it down to 5, 4, 3, 2 .. yes only <strong>1 line of code</strong>.</p>

<p>The key is the <strong>ProducerTemplate</strong> that is a Spring'ish xxxTemplate based producer. Meaning that it has methods to send messages to any Camel endpoints. First of all we need to get hold of such a template and this is done from the CamelContext</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    private ProducerTemplate template;

    public ReportIncidentEndpointImpl() throws Exception {
        ...

        // get the ProducerTemplate thst is a Spring&#39;ish xxxTemplate based producer for very
        // easy sending exchanges to Camel.
        template = camel.createProducerTemplate();

        // start Camel
        camel.start();
    }
]]></script>
</div></div>

<p>Now we can use <strong>template</strong> for sending payloads to any endpoint in Camel. So all the logging gabble can be reduced to:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    template.sendBody(&quot;log:com.mycompany.part2.easy&quot;, name);
]]></script>
</div></div>

<p>And the same goes for the file, but we must also send the header to instruct what the output filename should be:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    String filename = &quot;easy-incident-&quot; + incidentId + &quot;.txt&quot;;
    template.sendBodyAndHeader(&quot;file://target/subfolder&quot;, name, FileComponent.HEADER_FILE_NAME, filename);
]]></script>
</div></div>

<h2 id="BookInOnePage-Reducingevenmorecodelines">Reducing even more code lines</h2>
<p>Well we got the Camel code down to 1-2 lines for sending the message to the component that does all the heavy work of wring the message to a file etc. But we still got 5 lines to initialize Camel.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    camel = new DefaultCamelContext();
    camel.addComponent(&quot;log&quot;, new LogComponent());
    camel.addComponent(&quot;file&quot;, new FileComponent());
    template = camel.createProducerTemplate();
    camel.start();
]]></script>
</div></div>
<p>This can also be reduced. All the standard components in Camel is auto discovered on-the-fly so we can remove these code lines and we are down to 3 lines.</p>

<div class="confluence-information-macro confluence-information-macro-information"><p class="title">Component auto discovery</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>When an endpoint is requested with a scheme that Camel hasn't seen before it will try to look for it in the classpath. It will do so by looking for special Camel component marker files that reside in the folder <code>META-INF/services/org/apache/camel/component</code>. If there are files in this folder it will read them as the filename is the <strong>scheme</strong> part of the URL. For instance the <strong>log</strong> component is defined in this file <code>META-INF/services/org/apache/component/log</code> and its content is:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
class=org.apache.camel.component.log.LogComponent
]]></script>
</div></div>
<p>The class property defines the component implementation.</p>

<p><strong>Tip:</strong> End-users can create their 3rd party components using the same technique and have them been auto discovered on-the-fly.</p></div></div>

<p>Okay back to the 3 code lines:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    camel = new DefaultCamelContext();
    template = camel.createProducerTemplate();
    camel.start();
]]></script>
</div></div>
<p>Later will we see how we can reduce this to ... in fact 0 java code lines. But the 3 lines will do for now.</p>

<h2 id="BookInOnePage-MessageTranslation">Message Translation</h2>
<p>Okay lets head back to the over goal of the integration. Looking at the EIP diagrams at the introduction page we need to be able to translate the incoming webservice to an email. Doing so we need to create the email body. When doing the message translation we could put up our sleeves and do it manually in pure java with a StringBuilder such as:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    private String createMailBody(InputReportIncident parameters) {
        StringBuilder sb = new StringBuilder();
        sb.append(&quot;Incident &quot;).append(parameters.getIncidentId());
        sb.append(&quot; has been reported on the &quot;).append(parameters.getIncidentDate());
        sb.append(&quot; by &quot;).append(parameters.getGivenName());
        sb.append(&quot; &quot;).append(parameters.getFamilyName());
        
        // and the rest of the mail body with more appends to the string builder
        
        return sb.toString();
    }
]]></script>
</div></div>
<p>But as always it is a hardcoded template for the mail body and the code gets kinda ugly if the mail message has to be a bit more advanced. But of course it just works out-of-the-box with just classes already in the JDK.</p>

<p>Lets use a template language instead such as <a shape="rect" class="external-link" href="http://velocity.apache.org/">Apache Velocity</a>. As Camel have a component for <a shape="rect" href="velocity.html">Velocity</a> integration we will use this component. Looking at the <a shape="rect" href="component.html">Component List</a> overview we can see that camel-velocity component uses the artifactId <strong>camel-velocity</strong> so therefore we need to add this to the <strong>pom.xml</strong></p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
            &lt;artifactId&gt;camel-velocity&lt;/artifactId&gt;
            &lt;version&gt;${camel-version}&lt;/version&gt;
        &lt;/dependency&gt;
]]></script>
</div></div>

<p>And now we have a Spring conflict as Apache CXF is dependent on Spring 2.0.8 and camel-velocity is dependent on Spring 2.5.5. To remedy this we could wrestle with the <strong>pom.xml</strong> with excludes settings in the dependencies or just bring in another dependency <strong>camel-spring</strong>:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
            &lt;artifactId&gt;camel-spring&lt;/artifactId&gt;
            &lt;version&gt;${camel-version}&lt;/version&gt;
        &lt;/dependency&gt;
]]></script>
</div></div>

<p>In fact camel-spring is such a vital part of Camel that you will end up using it in nearly all situations - we will look into how well Camel is seamless integration with Spring in part 3. For now its just another dependency. </p>

<p>We create the mail body with the Velocity template and create the file <code>src/main/resources/MailBody.vm</code>. The content in the <strong>MailBody.vm</strong> file is:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
Incident $body.incidentId has been reported on the $body.incidentDate by $body.givenName $body.familyName.

The person can be contact by:
- email: $body.email
- phone: $body.phone

Summary: $body.summary

Details:
$body.details

This is an auto generated email. You can not reply.
]]></script>
</div></div>

<p>Letting Camel creating the mail body and storing it as a file is as easy as the following 3 code lines:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    private void generateEmailBodyAndStoreAsFile(InputReportIncident parameters) {
        // generate the mail body using velocity template
        // notice that we just pass in our POJO (= InputReportIncident) that we
        // got from Apache CXF to Velocity.
        Object response = template.sendBody(&quot;velocity:MailBody.vm&quot;, parameters);
        // Note: the response is a String and can be cast to String if needed

        // store the mail in a file
        String filename = &quot;mail-incident-&quot; + parameters.getIncidentId() + &quot;.txt&quot;;
        template.sendBodyAndHeader(&quot;file://target/subfolder&quot;, response, FileComponent.HEADER_FILE_NAME, filename);
    }
]]></script>
</div></div>

<p>What is impressive is that we can just pass in our POJO object we got from Apache CXF to Velocity and it will be able to generate the mail body with this object in its context. Thus we don't need to prepare <strong>anything</strong> before we let Velocity loose and generate our mail body. Notice that the <strong>template</strong> method returns a object with out response. This object contains the mail body as a String object. We can cast to String if needed. </p>

<p>If we run our unit test with <code>mvn test</code> we can in fact see that Camel has produced the file and we can type its content:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
D:\demo\part-two&gt;type target\subfolder\mail-incident-123.txt
Incident 123 has been reported on the 2008-07-16 by Claus Ibsen.

The person can be contact by:
- email: davsclaus@apache.org
- phone: +45 2962 7576

Summary: bla bla

Details:
more bla bla

This is an auto generated email. You can not reply.
]]></script>
</div></div>

<h2 id="BookInOnePage-Firstpartofthesolution">First part of the solution</h2>
<p>What we have seen here is actually what it takes to build the first part of the integration flow. Receiving a request from a webservice, transform it to a mail body and store it to a file, and return an OK response to the webservice. All possible within 10 lines of code. So lets wrap it up here is what it takes:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
/**
 * The webservice we have implemented.
 */
public class ReportIncidentEndpointImpl implements ReportIncidentEndpoint {

    private CamelContext camel;
    private ProducerTemplate template;

    public ReportIncidentEndpointImpl() throws Exception {
        // create the camel context that is the &quot;heart&quot; of Camel
        camel = new DefaultCamelContext();

        // get the ProducerTemplate thst is a Spring&#39;ish xxxTemplate based producer for very
        // easy sending exchanges to Camel.
        template = camel.createProducerTemplate();

        // start Camel
        camel.start();
    }

    public OutputReportIncident reportIncident(InputReportIncident parameters) {
        // transform the request into a mail body
        Object mailBody = template.sendBody(&quot;velocity:MailBody.vm&quot;, parameters);

        // store the mail body in a file
        String filename = &quot;mail-incident-&quot; + parameters.getIncidentId() + &quot;.txt&quot;;
        template.sendBodyAndHeader(&quot;file://target/subfolder&quot;, mailBody, FileComponent.HEADER_FILE_NAME, filename);

        // return an OK reply
        OutputReportIncident out = new OutputReportIncident();
        out.setCode(&quot;OK&quot;);
        return out;
    }

}
]]></script>
</div></div>
<p>Okay I missed by one, its in fact only <strong>9 lines of java code and 2 fields</strong>.</p>

<h2 id="BookInOnePage-Endofpart2">End of part 2</h2>
<p>I know this is a bit different introduction to Camel to how you can start using it in your projects just as a plain java .jar framework that isn't invasive at all. I took you through the coding parts that requires 6 - 10 lines to send a message to an endpoint, buts it's important to show the <a shape="rect" href="message-endpoint.html">Message Endpoint</a> EIP pattern in action and how its implemented in Camel. Yes of course Camel also has to one liners that you can use, and will use in your projects for sending messages to endpoints. This part has been about good old plain java, nothing fancy with Spring, XML files, auto discovery, OGSi or other new technologies. I wanted to demonstrate the basic building blocks in Camel and how its setup in pure god old fashioned Java. There are plenty of eye catcher examples with one liners that does more than you can imagine - we will come there in the later parts. </p>

<p>Okay part 3 is about building the last pieces of the solution and now it gets interesting since we have to wrestle with the event driven consumer.<br clear="none">
Brew a cup of coffee, tug the kids and kiss the wife, for now we will have us some fun with the Camel. See you in part 3.</p>

<h2 id="BookInOnePage-Links.2">Links</h2>
<ul class="alternate"><li><a shape="rect" href="tutorial-example-reportincident.html">Introduction</a></li><li><a shape="rect" href="tutorial-example-reportincident-part1.html">Part 1</a></li><li><a shape="rect" href="tutorial-example-reportincident-part2.html">Part 2</a></li><li><a shape="rect" href="tutorial-example-reportincident-part3.html">Part 3</a></li><li><a shape="rect" href="tutorial-example-reportincident-part4.html">Part 4</a></li><li><a shape="rect" href="tutorial-example-reportincident-part5.html">Part 5</a></li><li><a shape="rect" href="tutorial-example-reportincident-part6.html">Part 6</a></li></ul>
<h2 id="BookInOnePage-Part3">Part 3</h2>

<h2 id="BookInOnePage-Recap">Recap</h2>
<p>Lets just recap on the solution we have now:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class ReportIncidentEndpointImpl implements ReportIncidentEndpoint {

    private CamelContext camel;
    private ProducerTemplate template;

    public ReportIncidentEndpointImpl() throws Exception {
        // create the camel context that is the &quot;heart&quot; of Camel
        camel = new DefaultCamelContext();

        // get the ProducerTemplate thst is a Spring&#39;ish xxxTemplate based producer for very
        // easy sending exchanges to Camel.
        template = camel.createProducerTemplate();

        // start Camel
        camel.start();
    }

    /**
     * This is the last solution displayed that is the most simple
     */
    public OutputReportIncident reportIncident(InputReportIncident parameters) {
        // transform the request into a mail body
        Object mailBody = template.sendBody(&quot;velocity:MailBody.vm&quot;, parameters);

        // store the mail body in a file
        String filename = &quot;mail-incident-&quot; + parameters.getIncidentId() + &quot;.txt&quot;;
        template.sendBodyAndHeader(&quot;file://target/subfolder&quot;, mailBody, FileComponent.HEADER_FILE_NAME, filename);

        // return an OK reply
        OutputReportIncident out = new OutputReportIncident();
        out.setCode(&quot;OK&quot;);
        return out;
    }

}
]]></script>
</div></div>

<p>This completes the first part of the solution: receiving the message using webservice, transform it to a mail body and store it as a text file.<br clear="none">
What is missing is the last part that polls the text files and send them as emails. Here is where some fun starts, as this requires usage of the <a shape="rect" href="event-driven-consumer.html">Event Driven Consumer</a> EIP pattern to react when new files arrives. So lets see how we can do this in Camel. There is a saying: Many roads lead to Rome, and that is also true for Camel - there are many ways to do it in Camel.</p>

<h2 id="BookInOnePage-Addingthe">Adding the <a shape="rect" href="event-driven-consumer.html">Event Driven Consumer</a></h2>
<p>We want to add the consumer to our integration that listen for new files, we do this by creating a private method where the consumer code lives. We must register our consumer in Camel before its started so we need to add, and there fore we call the method <strong>addMailSenderConsumer</strong> in the constructor below:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    public ReportIncidentEndpointImpl() throws Exception {
        // create the camel context that is the &quot;heart&quot; of Camel
        camel = new DefaultCamelContext();

        // get the ProducerTemplate thst is a Spring&#39;ish xxxTemplate based producer for very
        // easy sending exchanges to Camel.
        template = camel.createProducerTemplate();

        // add the event driven consumer that will listen for mail files and process them
        addMailSendConsumer();

        // start Camel
        camel.start();
    }
]]></script>
</div></div>

<p>The consumer needs to be consuming from an endpoint so we grab the endpoint from Camel we want to consume. It's <code><a shape="rect" class="external-link" href="file://target/subfolder" rel="nofollow">file://target/subfolder</a></code>. Don't be fooled this endpoint doesn't have to 100% identical to the producer, i.e. the endpoint we used in the previous part to create and store the files. We could change the URL to include some options, and to make it more clear that it's possible we setup a delay value to 10 seconds, and the first poll starts after 2 seconds. This is done by adding <code>?consumer.delay=10000&amp;consumer.initialDelay=2000</code> to the URL.</p>
<div class="confluence-information-macro confluence-information-macro-tip"><p class="title">URL Configuration</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>The URL configuration in Camel <a shape="rect" href="endpoint.html">endpoints</a> is just like regular URL we know from the Internet. You use ? and &amp; to set the options.</p></div></div>

<p>When we have the endpoint we can create the consumer (just as in part 1 where we created a producer}. Creating the consumer requires a <a shape="rect" href="processor.html">Processor</a> where we implement the java code what should happen when a message arrives. To get the mail body as a String object we can use the <strong>getBody</strong> method where we can provide the type we want in return.</p>
<div class="confluence-information-macro confluence-information-macro-note"><p class="title">Camel Type Converter</p><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>Why don't we just cast it as we always do in Java? Well the biggest advantage when you provide the type as a parameter you tell Camel what type you want and Camel can automatically convert it for you, using its flexible <a shape="rect" href="type-converter.html">Type Converter</a> mechanism. This is a great advantage, and you should try to use this instead of regular type casting.</p></div></div>
<p>Sending the email is still left to be implemented, we will do this later. And finally we must remember to start the consumer otherwise its not active and won't listen for new files.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    private void addMailSendConsumer() throws Exception {
        // Grab the endpoint where we should consume. Option - the first poll starts after 2 seconds
        Endpoint endpint = camel.getEndpoint(&quot;file://target/subfolder?consumer.initialDelay=2000&quot;);

        // create the event driven consumer
        // the Processor is the code what should happen when there is an event
        // (think it as the onMessage method)
        Consumer consumer = endpint.createConsumer(new Processor() {
            public void process(Exchange exchange) throws Exception {
                // get the mail body as a String
                String mailBody = exchange.getIn().getBody(String.class);

                // okay now we are read to send it as an email
                System.out.println(&quot;Sending email...&quot; + mailBody);
            }
        });

        // star the consumer, it will listen for files
        consumer.start();
    }
]]></script>
</div></div>

<p>Before we test it we need to be aware that our unit test is only catering for the first part of the solution, receiving the message with webservice, transforming it using Velocity and then storing it as a file - it doesn't test the <a shape="rect" href="event-driven-consumer.html">Event Driven Consumer</a> we just added. As we are eager to see it in action, we just do a common trick adding some sleep in our unit test, that gives our <a shape="rect" href="event-driven-consumer.html">Event Driven Consumer</a> time to react and print to System.out. We will later refine the test:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    public void testRendportIncident() throws Exception {
       ...

        OutputReportIncident out = client.reportIncident(input);
        assertEquals(&quot;Response code is wrong&quot;, &quot;OK&quot;, out.getCode());

        // give the event driven consumer time to react
        Thread.sleep(10 * 1000);
    }
]]></script>
</div></div>

<p>We run the test with <code>mvn clean test</code> and have eyes fixed on the console output. <br clear="none">
During all the output in the console, we see that our consumer has been triggered, as we want.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
2008-07-19 12:09:24,140 [mponent@1f12c4e] DEBUG FileProcessStrategySupport - Locking the file: target\subfolder\mail-incident-123.txt ...
Sending email...Incident 123 has been reported on the 2008-07-16 by Claus Ibsen.

The person can be contact by:
- email: davsclaus@apache.org
- phone: +45 2962 7576

Summary: bla bla

Details:
more bla bla

This is an auto generated email. You can not reply.
2008-07-19 12:09:24,156 [mponent@1f12c4e] DEBUG FileConsumer - Done processing file: target\subfolder\mail-incident-123.txt. Status is: OK
]]></script>
</div></div>

<h2 id="BookInOnePage-Sendingtheemail">Sending the email</h2>
<p>Sending the email requires access to a SMTP mail server, but the implementation code is very simple:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    private void sendEmail(String body) {
        // send the email to your mail server
        String url = &quot;smtp://someone@localhost?password=secret&amp;to=incident@mycompany.com&quot;;
        template.sendBodyAndHeader(url, body, &quot;subject&quot;, &quot;New incident reported&quot;);
    }
]]></script>
</div></div>

<p>And just invoke the method from our consumer:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    // okay now we are read to send it as an email
    System.out.println(&quot;Sending email...&quot;);
    sendEmail(mailBody);
    System.out.println(&quot;Email sent&quot;);
]]></script>
</div></div>

<h2 id="BookInOnePage-Unittestingmail">Unit testing mail</h2>
<p>For unit testing the consumer part we will use a mock mail framework, so we add this to our <strong>pom.xml</strong>:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        &lt;!-- unit testing mail using mock --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.jvnet.mock-javamail&lt;/groupId&gt;
            &lt;artifactId&gt;mock-javamail&lt;/artifactId&gt;
            &lt;version&gt;1.7&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
]]></script>
</div></div>

<p>Then we prepare our integration to run with or without the consumer enabled. We do this to separate the route into the two parts:</p>
<ul class="alternate"><li>receive the webservice, transform and save mail file and return OK as repose</li><li>the consumer that listen for mail files and send them as emails</li></ul>


<p>So we change the constructor code a bit:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    public ReportIncidentEndpointImpl() throws Exception {
        init(true);
    }

    public ReportIncidentEndpointImpl(boolean enableConsumer) throws Exception {
        init(enableConsumer);
    }

    private void init(boolean enableConsumer) throws Exception {
        // create the camel context that is the &quot;heart&quot; of Camel
        camel = new DefaultCamelContext();

        // get the ProducerTemplate thst is a Spring&#39;ish xxxTemplate based producer for very
        // easy sending exchanges to Camel.
        template = camel.createProducerTemplate();

        // add the event driven consumer that will listen for mail files and process them
        if (enableConsumer) {
            addMailSendConsumer();
        }

        // start Camel
        camel.start();
    }
]]></script>
</div></div>
<p>Then remember to change the <strong>ReportIncidentEndpointTest</strong> to pass in <strong>false</strong> in the <code>ReportIncidentEndpointImpl</code> constructor.<br clear="none">
And as always run <code>mvn clean test</code> to be sure that the latest code changes works.</p>

<h2 id="BookInOnePage-Addingnewunittest">Adding new unit test</h2>
<p>We are now ready to add a new unit test that tests the consumer part so we create a new test class that has the following code structure:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
/**
 * Plain JUnit test of our consumer.
 */
public class ReportIncidentConsumerTest extends TestCase {

    private ReportIncidentEndpointImpl endpoint;

    public void testConsumer() throws Exception {
        // we run this unit test with the consumer, hence the true parameter
        endpoint = new ReportIncidentEndpointImpl(true);
   }

}
]]></script>
</div></div>

<p>As we want to test the consumer that it can listen for files, read the file content and send it as an email to our mailbox we will test it by asserting that we receive 1 mail in our mailbox and that the mail is the one we expect. To do so we need to grab the mailbox with the mockmail API. This is done as simple as:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    public void testConsumer() throws Exception {
        // we run this unit test with the consumer, hence the true parameter
        endpoint = new ReportIncidentEndpointImpl(true);

        // get the mailbox
        Mailbox box = Mailbox.get(&quot;incident@mycompany.com&quot;);
        assertEquals(&quot;Should not have mails&quot;, 0, box.size());
]]></script>
</div></div>

<p>How do we trigger the consumer? Well by creating a file in the folder it listen for. So we could use plain java.io.File API to create the file, but wait isn't there an smarter solution? ... yes Camel of course. Camel can do amazing stuff in one liner codes with its ProducerTemplate, so we need to get a hold of this baby. We expose this template in our ReportIncidentEndpointImpl but adding this getter:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    protected ProducerTemplate getTemplate() {
        return template;
    }
]]></script>
</div></div>

<p>Then we can use the template to create the file in <strong>one code line</strong>:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        // drop a file in the folder that the consumer listen
        // here is a trick to reuse Camel! so we get the producer template and just
        // fire a message that will create the file for us
        endpoint.getTemplate().sendBodyAndHeader(&quot;file://target/subfolder?append=false&quot;, &quot;Hello World&quot;,
            FileComponent.HEADER_FILE_NAME, &quot;mail-incident-test.txt&quot;);
]]></script>
</div></div>

<p>Then we just need to wait a little for the consumer to kick in and do its work and then we should assert that we got the new mail. Easy as just:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        // let the consumer have time to run
        Thread.sleep(3 * 1000);

        // get the mock mailbox and check if we got mail ;)
        assertEquals(&quot;Should have got 1 mail&quot;, 1, box.size());
        assertEquals(&quot;Subject wrong&quot;, &quot;New incident reported&quot;, box.get(0).getSubject());
        assertEquals(&quot;Mail body wrong&quot;, &quot;Hello World&quot;, box.get(0).getContent());
    }
]]></script>
</div></div>

<p>The final class for the unit test is:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
/**
 * Plain JUnit test of our consumer.
 */
public class ReportIncidentConsumerTest extends TestCase {

    private ReportIncidentEndpointImpl endpoint;

    public void testConsumer() throws Exception {
        // we run this unit test with the consumer, hence the true parameter
        endpoint = new ReportIncidentEndpointImpl(true);

        // get the mailbox
        Mailbox box = Mailbox.get(&quot;incident@mycompany.com&quot;);
        assertEquals(&quot;Should not have mails&quot;, 0, box.size());

        // drop a file in the folder that the consumer listen
        // here is a trick to reuse Camel! so we get the producer template and just
        // fire a message that will create the file for us
        endpoint.getTemplate().sendBodyAndHeader(&quot;file://target/subfolder?append=false&quot;, &quot;Hello World&quot;,
            FileComponent.HEADER_FILE_NAME, &quot;mail-incident-test.txt&quot;);

        // let the consumer have time to run
        Thread.sleep(3 * 1000);

        // get the mock mailbox and check if we got mail ;)
        assertEquals(&quot;Should have got 1 mail&quot;, 1, box.size());
        assertEquals(&quot;Subject wrong&quot;, &quot;New incident reported&quot;, box.get(0).getSubject());
        assertEquals(&quot;Mail body wrong&quot;, &quot;Hello World&quot;, box.get(0).getContent());
    }

}
]]></script>
</div></div>

<h2 id="BookInOnePage-Endofpart3">End of part 3</h2>
<p>Okay we have reached the end of part 3. For now we have only scratched the surface of what Camel is and what it can do. We have introduced Camel into our integration piece by piece and slowly added more and more along the way. And the most important is: <strong>you as the developer never lost control</strong>. We hit a sweet spot in the webservice implementation where we could write our java code. Adding Camel to the mix is just to use it as a regular java code, nothing magic. We were in control of the flow, we decided when it was time to translate the input to a mail body, we decided when the content should be written to a file. This is very important to not lose control, that the bigger and heavier frameworks tend to do. No names mentioned, but boy do developers from time to time dislike these elephants. And Camel is <strong>no elephant</strong>.</p>

<p>I suggest you download the samples from part 1 to 3 and try them out. It is great basic knowledge to have in mind when we look at some of the features where Camel really excel - <strong>the routing domain language</strong>.</p>

<p>From part 1 to 3 we touched concepts such as::</p>
<ul class="alternate"><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="configuring-camel.html">URI configuration</a></li><li><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Consumer.html">Consumer</a></li><li><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Producer.html">Producer</a></li><li><a shape="rect" href="event-driven-consumer.html">Event Driven Consumer</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/CamelContext.html">CamelContext</a></li><li><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/ProducerTemplate.html">ProducerTemplate</a></li><li><a shape="rect" href="processor.html">Processor</a></li><li><a shape="rect" href="type-converter.html">Type Converter</a></li></ul>


<h2 id="BookInOnePage-Links.3">Links</h2>
<ul class="alternate"><li><a shape="rect" href="tutorial-example-reportincident.html">Introduction</a></li><li><a shape="rect" href="tutorial-example-reportincident-part1.html">Part 1</a></li><li><a shape="rect" href="tutorial-example-reportincident-part2.html">Part 2</a></li><li><a shape="rect" href="tutorial-example-reportincident-part3.html">Part 3</a></li><li><a shape="rect" href="tutorial-example-reportincident-part4.html">Part 4</a></li><li><a shape="rect" href="tutorial-example-reportincident-part5.html">Part 5</a></li><li><a shape="rect" href="tutorial-example-reportincident-part6.html">Part 6</a></li></ul>
<h2 id="BookInOnePage-Part4">Part 4</h2>

<h2 id="BookInOnePage-Introduction.4">Introduction</h2>
<p>This section is about regular Camel. The examples presented here in this section is much more in common of all the examples we have in the Camel documentation.</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>If you have been reading the previous 3 parts then, this quote applies:</p>
<blockquote>
<p>you must unlearn what you have learned<br clear="none">
<em>Master Yoda, Star Wars IV</em></p></blockquote>
<p>So we start all over again! <img class="emoticon emoticon-wink" src="https://cwiki.apache.org/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/icons/emoticons/wink.png" data-emoticon-name="wink" alt="(wink)"></p></div></div>

<h2 id="BookInOnePage-Routing">Routing</h2>
<p>Camel is particular strong as a light-weight and agile <strong>routing</strong> and <strong>mediation</strong> framework. In this part we will introduce the <strong>routing</strong> concept and how we can introduce this into our solution.<br clear="none">
Looking back at the figure from the <a shape="rect" href="tutorial-example-reportincident.html">Introduction</a> page we want to implement this routing. Camel has support for expressing this <a shape="rect" href="routes.html">routing logic using Java</a> as a DSL (Domain Specific Language). In fact Camel also has DSL for XML and Scala. In this part we use the Java DSL as its the most powerful and all developers know Java. Later we will introduce the XML version that is very well integrated with Spring. </p>

<p>Before we jump into it, we want to state that this tutorial is about <strong>Developers not loosing control</strong>. In my humble experience one of the key fears of developers is that they are forced into a tool/framework where they loose control and/or power, and the possible is now impossible. So in this part we stay clear with this vision and our starting point is as follows:</p>
<ul class="alternate"><li>We have generated the webservice source code using the CXF wsdl2java generator and we have our ReportIncidentEndpointImpl.java file where we as a Developer feels home and have the power.</li></ul>


<p>So the starting point is:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
/**
 * The webservice we have implemented.
 */
public class ReportIncidentEndpointImpl implements ReportIncidentEndpoint {

    /**
     * This is the last solution displayed that is the most simple
     */
    public OutputReportIncident reportIncident(InputReportIncident parameters) {
        // WE ARE HERE !!!
        return null;
    }

}
]]></script>
</div></div>
<p>Yes we have a simple plain Java class where we have the implementation of the webservice. The cursor is blinking at the WE ARE HERE block and this is where we feel home. More or less any Java Developers have implemented webservices using a stack such as: Apache AXIS, Apache CXF or some other quite popular framework. They all allow the developer to be in control and implement the code logic as plain Java code. Camel of course doesn't enforce this to be any different. Okay the boss told us to implement the solution from the figure in the Introduction page and we are now ready to code.</p>

<h3 id="BookInOnePage-RouteBuilder">RouteBuilder</h3>
<p><strong>RouteBuilder</strong> is the hearth in Camel of the Java DSL routing. This class does all the heavy lifting of supporting EIP verbs for end-users to express the routing. It does take a little while to get settled and used to, but when you have worked with it for a while you will enjoy its power and realize it is in fact a little language inside Java itself. Camel is the <strong>only</strong> integration framework we are aware of that has Java DSL, all the others are usually <strong>only</strong> XML based. </p>

<p>As an end-user you usually use the <strong>RouteBuilder</strong> as of follows:</p>
<ul class="alternate"><li>create your own Route class that extends <strong>RouteBuilder</strong></li><li>implement your routing DSL in the <strong>configure</strong> method</li></ul>


<p>So we create a new class ReportIncidentRoutes and implement the first part of the routing:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
import org.apache.camel.builder.RouteBuilder;

public class ReportIncidentRoutes extends RouteBuilder {

    public void configure() throws Exception {
        // direct:start is a internal queue to kick-start the routing in our example
        // we use this as the starting point where you can send messages to direct:start
        from(&quot;direct:start&quot;)
            // to is the destination we send the message to our velocity endpoint
            // where we transform the mail body
            .to(&quot;velocity:MailBody.vm&quot;);
    }

}
]]></script>
</div></div>
<p>What to notice here is the <strong>configure</strong> method. Here is where all the action is. Here we have the Java DSL langauge, that is expressed using the <strong>fluent builder syntax</strong> that is also known from Hibernate when you build the dynamic queries etc. What you do is that you can stack methods separating with the dot.</p>

<p>In the example above we have a very common routing, that can be distilled from pseudo verbs to actual code with:</p>
<ul class="alternate"><li>from A to B</li><li>From Endpoint A To Endpoint B</li><li>from("endpointA").to("endpointB")</li><li>from("direct:start").to("velocity:MailBody.vm");</li></ul>


<p><strong>from("direct:start")</strong> is the consumer that is kick-starting our routing flow. It will wait for messages to arrive on the <a shape="rect" href="direct.html">direct</a> queue and then dispatch the message.<br clear="none">
<strong>to("velocity:MailBody.vm")</strong> is the producer that will receive a message and let Velocity generate the mail body response.</p>

<p>So what we have implemented so far with our ReportIncidentRoutes RouteBuilder is this part of the picture:<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="book-in-one-page.data/tutorial_reportincident_route_1.png" data-image-src="/confluence/download/attachments/93043/tutorial_reportincident_route_1.png?version=1&amp;modificationDate=1219011599000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="59672629" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="tutorial_reportincident_route_1.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="93043" data-linked-resource-container-version="31"></span></p>

<h3 id="BookInOnePage-AddingtheRouteBuilder">Adding the RouteBuilder</h3>
<p>Now we have our RouteBuilder we need to add/connect it to our CamelContext that is the hearth of Camel. So turning back to our webservice implementation class ReportIncidentEndpointImpl we add this constructor to the code, to create the CamelContext and add the routes from our route builder and finally to start it.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    private CamelContext context;

    public ReportIncidentEndpointImpl() throws Exception {
        // create the context
        context = new DefaultCamelContext();

        // append the routes to the context
        context.addRoutes(new ReportIncidentRoutes());

        // at the end start the camel context
        context.start();
    }
]]></script>
</div></div>

<p>Okay how do you use the routes then? Well its just as before we use a ProducerTemplate to send messages to Endpoints, so we just send to the <strong>direct:start</strong> endpoint and it will take it from there.<br clear="none">
So we implement the logic in our webservice operation:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    /**
     * This is the last solution displayed that is the most simple
     */
    public OutputReportIncident reportIncident(InputReportIncident parameters) {
        Object mailBody = context.createProducerTemplate().sendBody(&quot;direct:start&quot;, parameters);
        System.out.println(&quot;Body:&quot; + mailBody);

        // return an OK reply
        OutputReportIncident out = new OutputReportIncident();
        out.setCode(&quot;OK&quot;);
        return out;
    }
]]></script>
</div></div>

<p>Notice that we get the producer template using the <strong>createProducerTemplate</strong> method on the CamelContext. Then we send the input parameters to the <strong>direct:start</strong> endpoint and it will route it <strong>to</strong> the velocity endpoint that will generate the mail body. Since we use <strong>direct</strong> as the consumer endpoint (=from) and its a <strong>synchronous</strong> exchange we will get the response back from the route. And the response is of course the output from the velocity endpoint. </p>

<div class="confluence-information-macro confluence-information-macro-information"><p class="title">About creating ProducerTemplate</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>In the example above we create a new <code>ProducerTemplate</code> when the <code>reportIncident</code> method is invoked. However in reality you should only create the template once and re-use it. See this <a shape="rect" href="why-does-camel-use-too-many-threads-with-producertemplate.html">FAQ entry</a>.</p></div></div>

<p>We have now completed this part of the picture:<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="book-in-one-page.data/tutorial_reportincident_route_2b.png" data-image-src="/confluence/download/attachments/93043/tutorial_reportincident_route_2b.png?version=1&amp;modificationDate=1219476622000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="8697" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="tutorial_reportincident_route_2b.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="93043" data-linked-resource-container-version="31"></span></p>

<h2 id="BookInOnePage-Unittesting">Unit testing</h2>
<p>Now is the time we would like to unit test what we got now. So we call for camel and its great test kit. For this to work we need to add it to the pom.xml</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
            &lt;artifactId&gt;camel-core&lt;/artifactId&gt;
            &lt;version&gt;1.4.0&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
            &lt;type&gt;test-jar&lt;/type&gt;
        &lt;/dependency&gt;
]]></script>
</div></div>
<p>After adding it to the pom.xml you should refresh your Java Editor so it pickups the new jar. Then we are ready to create out unit test class.<br clear="none">
We create this unit test skeleton, where we <strong>extend</strong> this class <code>ContextTestSupport</code></p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
package org.apache.camel.example.reportincident;

import org.apache.camel.ContextTestSupport;
import org.apache.camel.builder.RouteBuilder;

/**
 * Unit test of our routes
 */
public class ReportIncidentRoutesTest extends ContextTestSupport {

}
]]></script>
</div></div>

<p><code>ContextTestSupport</code> is a supporting unit test class for much easier unit testing with Apache Camel. The class is extending JUnit TestCase itself so you get all its glory. What we need to do now is to somehow tell this unit test class that it should use our route builder as this is the one we gonna test. So we do this by implementing the <code>createRouteBuilder</code> method.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    @Override
    protected RouteBuilder createRouteBuilder() throws Exception {
        return new ReportIncidentRoutes();
    }
]]></script>
</div></div>
<p>That is easy just return an instance of our route builder and this unit test will use our routes.</p>
<div class="confluence-information-macro confluence-information-macro-tip"><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>It is quite common in Camel itself to unit test using routes defined as an anonymous inner class, such as illustrated below: </p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    protected RouteBuilder createRouteBuilder() throws Exception {
        return new RouteBuilder() {
            public void configure() throws Exception {
                // TODO: Add your routes here, such as:
                from(&quot;jms:queue:inbox&quot;).to(&quot;file://target/out&quot;);
            }
        };
    }
]]></script>
</div></div>
<p>The same technique is of course also possible for end-users of Camel to create parts of your routes and test them separately in many test classes.<br clear="none">
However in this tutorial we test the real route that is to be used for production, so we just return an instance of the real one.</p></div></div>
<p>We then code our unit test method that sends a message to the route and assert that its transformed to the mail body using the Velocity template.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    public void testTransformMailBody() throws Exception {
        // create a dummy input with some input data
        InputReportIncident parameters = createInput();

        // send the message (using the sendBody method that takes a parameters as the input body)
        // to &quot;direct:start&quot; that kick-starts the route
        // the response is returned as the out object, and its also the body of the response
        Object out = context.createProducerTemplate().sendBody(&quot;direct:start&quot;, parameters);

        // convert the response to a string using camel converters. However we could also have casted it to
        // a string directly but using the type converters ensure that Camel can convert it if it wasn&#39;t a string
        // in the first place. The type converters in Camel is really powerful and you will later learn to
        // appreciate them and wonder why its not build in Java out-of-the-box
        String body = context.getTypeConverter().convertTo(String.class, out);

        // do some simple assertions of the mail body
        assertTrue(body.startsWith(&quot;Incident 123 has been reported on the 2008-07-16 by Claus Ibsen.&quot;));
    }

    /**
     * Creates a dummy request to be used for input
     */
    protected InputReportIncident createInput() {
        InputReportIncident input = new InputReportIncident();
        input.setIncidentId(&quot;123&quot;);
        input.setIncidentDate(&quot;2008-07-16&quot;);
        input.setGivenName(&quot;Claus&quot;);
        input.setFamilyName(&quot;Ibsen&quot;);
        input.setSummary(&quot;bla bla&quot;);
        input.setDetails(&quot;more bla bla&quot;);
        input.setEmail(&quot;davsclaus@apache.org&quot;);
        input.setPhone(&quot;+45 2962 7576&quot;);
        return input;
    }
]]></script>
</div></div>

<h2 id="BookInOnePage-AddingtheFileBackup">Adding the File Backup</h2>
<p>The next piece of puzzle that is missing is to store the mail body as a backup file. So we turn back to our route and the EIP patterns. We use the <a shape="rect" href="pipes-and-filters.html">Pipes and Filters</a> pattern here to chain the routing as:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    public void configure() throws Exception {
        from(&quot;direct:start&quot;)
            .to(&quot;velocity:MailBody.vm&quot;)
            // using pipes-and-filters we send the output from the previous to the next
            .to(&quot;file://target/subfolder&quot;);
     }
]]></script>
</div></div>
<p>Notice that we just add a 2nd <strong>.to</strong> on the newline. Camel will default use the <a shape="rect" href="pipes-and-filters.html">Pipes and Filters</a> pattern here when there are multi endpoints chained liked this. We could have used the <strong>pipeline</strong> verb to let out stand out that its the <a shape="rect" href="pipes-and-filters.html">Pipes and Filters</a> pattern such as:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        from(&quot;direct:start&quot;)
            // using pipes-and-filters we send the output from the previous to the next
            .pipeline(&quot;velocity:MailBody.vm&quot;, &quot;file://target/subfolder&quot;);
]]></script>
</div></div>
<p>But most people are using the multi <strong>.to</strong> style instead.</p>

<p>We re-run out unit test and verifies that it still passes:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
Running org.apache.camel.example.reportincident.ReportIncidentRoutesTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.157 sec
]]></script>
</div></div>
<p>But hey we have added the file <em>producer</em> endpoint and thus a file should also be created as the backup file. If we look in the <code>target/subfolder</code> we can see that something happened.<br clear="none">
On my humble laptop it created this folder: <strong>target\subfolder\ID-claus-acer</strong>. So the file producer create a sub folder named <code>ID-claus-acer</code> what is this? Well Camel auto generates an unique filename based on the unique message id if not given instructions to use a fixed filename. In fact it creates another sub folder and name the file as: target\subfolder\ID-claus-acer\3750-1219148558921\1-0 where 1-0 is the file with the mail body. What we want is to use our own filename instead of this auto generated filename. This is archived by adding a header to the message with the filename to use. So we need to add this to our route and compute the filename based on the message content. </p>

<h3 id="BookInOnePage-Settingthefilename">Setting the filename</h3>
<p>For starters we show the simple solution and build from there. We start by setting a constant filename, just to verify that we are on the right path, to instruct the file producer what filename to use. The file producer uses a special header <code>FileComponent.HEADER_FILE_NAME</code> to set the filename.</p>

<p>What we do is to send the header when we "kick-start" the routing as the header will be propagated from the direct queue to the file producer. What we need to do is to use the <code>ProducerTemplate.sendBodyAndHeader</code> method that takes <strong>both</strong> a body and a header. So we change out webservice code to include the filename also:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    public OutputReportIncident reportIncident(InputReportIncident parameters) {
        // create the producer template to use for sending messages
        ProducerTemplate producer = context.createProducerTemplate();
        // send the body and the filename defined with the special header key 
        Object mailBody = producer.sendBodyAndHeader(&quot;direct:start&quot;, parameters, FileComponent.HEADER_FILE_NAME, &quot;incident.txt&quot;);
        System.out.println(&quot;Body:&quot; + mailBody);

        // return an OK reply
        OutputReportIncident out = new OutputReportIncident();
        out.setCode(&quot;OK&quot;);
        return out;
    }
]]></script>
</div></div>
<p>However we could also have used the route builder itself to configure the constant filename as shown below:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    public void configure() throws Exception {
        from(&quot;direct:start&quot;)
            .to(&quot;velocity:MailBody.vm&quot;)
            // set the filename to a constant before the file producer receives the message
            .setHeader(FileComponent.HEADER_FILE_NAME, constant(&quot;incident.txt&quot;))
            .to(&quot;file://target/subfolder&quot;);
     }
]]></script>
</div></div>
<p>But Camel can be smarter and we want to dynamic set the filename based on some of the input parameters, how can we do this?<br clear="none">
Well the obvious solution is to compute and set the filename from the webservice implementation, but then the webservice implementation has such logic and we want this decoupled, so we could create our own POJO bean that has a method to compute the filename. We could then instruct the routing to invoke this method to get the computed filename. This is a string feature in Camel, its <a shape="rect" href="bean.html">Bean</a> binding. So lets show how this can be done:</p>

<h4 id="BookInOnePage-Usingtocomputethefilename">Using <a shape="rect" href="bean-language.html">Bean Language</a> to compute the filename</h4>
<p>First we create our plain java class that computes the filename, and it has 100% no dependencies to Camel what so ever.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
/**
 * Plain java class to be used for filename generation based on the reported incident
 */
public class FilenameGenerator {

    public String generateFilename(InputReportIncident input) {
        // compute the filename
        return &quot;incident-&quot; + input.getIncidentId() + &quot;.txt&quot;;
    }

}
]]></script>
</div></div>
<p>The class is very simple and we could easily create unit tests for it to verify that it works as expected. So what we want now is to let Camel invoke this class and its generateFilename with the input parameters and use the output as the filename. Pheeeww is this really possible out-of-the-box in Camel? Yes it is. So lets get on with the show. We have the code that computes the filename, we just need to call it from our route using the <a shape="rect" href="bean-language.html">Bean Language</a>:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    public void configure() throws Exception {
        from(&quot;direct:start&quot;)
            // set the filename using the bean language and call the FilenameGenerator class.
            // the 2nd null parameter is optional methodname, to be used to avoid ambiguity.
            // if not provided Camel will try to figure out the best method to invoke, as we
            // only have one method this is very simple
            .setHeader(FileComponent.HEADER_FILE_NAME, BeanLanguage.bean(FilenameGenerator.class, null))
            .to(&quot;velocity:MailBody.vm&quot;)
            .to(&quot;file://target/subfolder&quot;);
    }
]]></script>
</div></div>
<p>Notice that we use the <strong>bean</strong> language where we supply the class with our bean to invoke. Camel will instantiate an instance of the class and invoke the suited method. For completeness and ease of code readability we add the method name as the 2nd parameter</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
            .setHeader(FileComponent.HEADER_FILE_NAME, BeanLanguage.bean(FilenameGenerator.class, &quot;generateFilename&quot;))
]]></script>
</div></div>
<p>Then other developers can understand what the parameter is, instead of <code>null</code>.</p>

<p>Now we have a nice solution, but as a sidetrack I want to demonstrate the Camel has other languages out-of-the-box, and that scripting language is a first class citizen in Camel where it etc. can be used in content based routing. However we want it to be used for the filename generation.</p>

<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<h4 id="BookInOnePage-Usingascriptlanguagetosetthefilename">Using a script language to set the filename</h4>
<p>We could do as in the previous parts where we send the computed filename as a message header when we "kick-start" the route. But we want to learn new stuff so we look for a different solution using some of Camels many <a shape="rect" href="languages.html">Languages</a>. As <a shape="rect" href="ognl.html">OGNL</a> is a favorite language of mine (used by WebWork) so we pick this baby for a Camel ride. For starters we must add it to our pom.xml:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
            &lt;artifactId&gt;camel-ognl&lt;/artifactId&gt;
            &lt;version&gt;${camel-version}&lt;/version&gt;
        &lt;/dependency&gt;
]]></script>
</div></div>
<p>And remember to refresh your editor so you got the new .jars. <br clear="none">
We want to construct the filename based on this syntax: <code>mail-incident-#ID#.txt</code> where #ID# is the incident id from the input parameters. As <a shape="rect" href="ognl.html">OGNL</a> is a language that can invoke methods on bean we can invoke the <code>getIncidentId()</code> on the message body and then concat it with the fixed pre and postfix strings.</p>

<p>In <a shape="rect" href="ognl.html">OGNL</a> glory this is done as:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&quot;&#39;mail-incident-&#39; + request.body.incidentId + &#39;.txt&#39;&quot;
]]></script>
</div></div>
<p>where <code>request.body.incidentId</code> computes to:</p>
<ul class="alternate"><li><strong>request</strong> is the IN message. See the <a shape="rect" href="ognl.html">OGNL</a> for other predefined objects available</li><li><strong>body</strong> is the body of the in message</li><li><strong>incidentId</strong> will invoke the <code>getIncidentId()</code> method on the body.<br clear="none">
The rest is just more or less regular plain code where we can concat strings.</li></ul>


<p>Now we got the expression to dynamic compute the filename on the fly we need to set it on our route so we turn back to our route, where we can add the OGNL expression:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    public void configure() throws Exception {
        from(&quot;direct:start&quot;)
            // we need to set the filename and uses OGNL for this
            .setHeader(FileComponent.HEADER_FILE_NAME, OgnlExpression.ognl(&quot;&#39;mail-incident-&#39; + request.body.incidentId + &#39;.txt&#39;&quot;))
            // using pipes-and-filters we send the output from the previous to the next
            .pipeline(&quot;velocity:MailBody.vm&quot;, &quot;file://target/subfolder&quot;);
    }
]]></script>
</div></div>
<p>And since we are on Java 1.5 we can use the static import of <strong>ognl</strong> so we have:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
import static org.apache.camel.language.ognl.OgnlExpression.ognl;
...
    .setHeader(FileComponent.HEADER_FILE_NAME, ognl(&quot;&#39;mail-incident-&#39; + request.body.incidentId + &#39;.txt&#39;&quot;))
]]></script>
</div></div>
<p>Notice the import static also applies for all the other languages, such as the <a shape="rect" href="bean-language.html">Bean Language</a> we used previously.</p></div></div>

<p>Whatever worked for you we have now implemented the backup of the data files:<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="book-in-one-page.data/tutorial_reportincident_route_3.png" data-image-src="/confluence/download/attachments/93043/tutorial_reportincident_route_3.png?version=1&amp;modificationDate=1219647451000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="8732" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="tutorial_reportincident_route_3.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="93043" data-linked-resource-container-version="31"></span></p>

<h2 id="BookInOnePage-Sendingtheemail.1">Sending the email</h2>


<p>What we need to do before the solution is completed is to actually send the email with the mail body we generated and stored as a file. In the previous part we did this with a <a shape="rect" href="file2.html">File</a> consumer, that we manually added to the CamelContext. We can do this quite easily with the routing.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
import org.apache.camel.builder.RouteBuilder;

public class ReportIncidentRoutes extends RouteBuilder {

    public void configure() throws Exception {
        // first part from the webservice -&gt; file backup
        from(&quot;direct:start&quot;)
            .setHeader(FileComponent.HEADER_FILE_NAME, bean(FilenameGenerator.class, &quot;generateFilename&quot;))
            .to(&quot;velocity:MailBody.vm&quot;)
            .to(&quot;file://target/subfolder&quot;);

        // second part from the file backup -&gt; send email
        from(&quot;file://target/subfolder&quot;)
            // set the subject of the email
            .setHeader(&quot;subject&quot;, constant(&quot;new incident reported&quot;))
            // send the email
            .to(&quot;smtp://someone@localhost?password=secret&amp;to=incident@mycompany.com&quot;);
    }

}
]]></script>
</div></div>
<p>The last 3 lines of code does all this. It adds a file consumer <strong>from("file://target/subfolder")</strong>, sets the mail subject, and finally send it as an email.</p>

<p>The DSL is really powerful where you can express your routing integration logic.<br clear="none">
So we completed the last piece in the picture puzzle with just 3 lines of code.</p>

<p>We have now completed the integration:<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="book-in-one-page.data/tutorial_reportincident_route_4.png" data-image-src="/confluence/download/attachments/93043/tutorial_reportincident_route_4.png?version=1&amp;modificationDate=1219648341000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="8733" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="tutorial_reportincident_route_4.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="93043" data-linked-resource-container-version="31"></span></p>

<h2 id="BookInOnePage-Conclusion.1">Conclusion</h2>
<p>We have just briefly touched the <strong>routing</strong> in Camel and shown how to implement them using the <strong>fluent builder</strong> syntax in Java. There is much more to the routing in Camel than shown here, but we are learning step by step. We continue in part 5. See you there.</p>

<h2 id="BookInOnePage-Links.4">Links</h2>
<ul class="alternate"><li><a shape="rect" href="tutorial-example-reportincident.html">Introduction</a></li><li><a shape="rect" href="tutorial-example-reportincident-part1.html">Part 1</a></li><li><a shape="rect" href="tutorial-example-reportincident-part2.html">Part 2</a></li><li><a shape="rect" href="tutorial-example-reportincident-part3.html">Part 3</a></li><li><a shape="rect" href="tutorial-example-reportincident-part4.html">Part 4</a></li><li><a shape="rect" href="tutorial-example-reportincident-part5.html">Part 5</a></li><li><a shape="rect" href="tutorial-example-reportincident-part6.html">Part 6</a></li></ul>

<h2 id="BookInOnePage-BetterJMSTransportforCXFWebserviceusingApacheCamel">Better JMS Transport for CXF Webservice using Apache Camel </h2>
<p>Configuring JMS in Apache CXF before Version 2.1.3 is possible but not really easy or nice. This article shows how to use Apache Camel to provide a better JMS Transport for CXF.</p>

<p><strong>Update:</strong> Since CXF 2.1.3 there is a new way of configuring JMS (<a shape="rect" href="http://cxf.apache.org/docs/using-the-jmsconfigfeature.html">Using the JMSConfigFeature</a>). It makes JMS config for CXF as easy as with Camel. Using Camel for JMS is still a good idea if you want to use the rich feature of Camel for routing and other Integration Scenarios that CXF does not support.</p>

<p><a shape="rect" class="external-link" href="http://www.liquid-reality.de/display/liquid/2008/08/25/Better+JMS+Transport+for+CXF+Webservice+using+Apache+Camel" rel="nofollow">You can find the original announcement for this Tutorial and some additional info on Christian Schneider&#180;s Blog</a></p>


<h3 id="BookInOnePage-SohowtoconnectApacheCamelandCXF">So how to connect Apache Camel and CXF</h3>

<p>The best way to connect Camel and CXF is using the <a shape="rect" class="external-link" href="http://activemq.apache.org/camel/camel-transport-for-cxf.html">Camel transport for CXF</a>. This is a camel module that registers with cxf as a new transport. It is quite easy to configure.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;bean class=&quot;org.apache.camel.component.cxf.transport.CamelTransportFactory&quot;&gt;
  &lt;property name=&quot;bus&quot; ref=&quot;cxf&quot; /&gt;
  &lt;property name=&quot;camelContext&quot; ref=&quot;camelContext&quot; /&gt;
  &lt;property name=&quot;transportIds&quot;&gt;
    &lt;list&gt;
      &lt;value&gt;http://cxf.apache.org/transports/camel&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;
]]></script>
</div></div>
<p>This bean registers with CXF and provides a new transport prefix camel:// that can be used in CXF address configurations. The bean references a bean cxf which will be already present in your config. The other refrenceis a camel context. We will later define this bean to provide the routing config.</p>

<h3 id="BookInOnePage-HowisJMSconfiguredinCamel">How is JMS configured in Camel</h3>

<p>In camel you need two things to configure JMS. A ConnectionFactory and a JMSComponent. As ConnectionFactory you can simply set up the normal Factory your JMS provider offers or <a shape="rect" class="external-link" href="http://static.springframework.org/spring/docs/2.5.x/reference/xsd-config.html#xsd-config-body-schemas-jee-jndi-lookup-environment-single" rel="nofollow">bind a JNDI ConnectionFactory</a>. In this example we use the ConnectionFactory provided by ActiveMQ.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;bean id=&quot;jmsConnectionFactory&quot; class=&quot;org.apache.activemq.ActiveMQConnectionFactory&quot;&gt;
  &lt;property name=&quot;brokerURL&quot; value=&quot;tcp://localhost:61616&quot; /&gt;
&lt;/bean&gt;
]]></script>
</div></div>
<p>Then we set up the JMSComponent. It offers a new transport prefix to camel that we simply call jms. If we need several JMSComponents we can differentiate them by their name.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;bean id=&quot;jms&quot; class=&quot;org.apache.camel.component.jms.JmsComponent&quot;&gt;
  &lt;property name=&quot;connectionFactory&quot; ref=&quot;jmsConnectionFactory&quot; /&gt;
  &lt;property name=&quot;useMessageIDAsCorrelationID&quot; value=&quot;true&quot; /&gt;
&lt;/bean&gt;
]]></script>
</div></div>
<p>You can find more details about the <a shape="rect" class="external-link" href="http://activemq.apache.org/camel/jms.html">JMSComponent at the Camel Wiki</a>. For example you find the complete configuration options and a JNDI sample there.</p>

<h3 id="BookInOnePage-SettinguptheCXFclient">Setting up the CXF client</h3>

<p>We will configure a simple CXF webservice client. It will use stub code generated from a wsdl. The webservice client will be configured to use JMS directly. You can also use a direct: Endpoint and do the routing to JMS in the Camel Context.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;client id=&quot;CustomerService&quot; xmlns=&quot;http://cxf.apache.org/jaxws&quot; xmlns:customer=&quot;http://customerservice.example.com/&quot;
  serviceName=&quot;customer:CustomerServiceService&quot;
  endpointName=&quot;customer:CustomerServiceEndpoint&quot;
  address=&quot;camel:jms:queue:CustomerService&quot;
  serviceClass=&quot;com.example.customerservice.CustomerService&quot;&gt;
&lt;/client&gt;
]]></script>
</div></div>
<p>We explicitly configure serviceName and endpointName so they are not read from the wsdl. The names we use are arbitrary and have no further function but we set them to look nice. The serviceclass points to the service interface that was generated from the wsdl. Now the important thing is address. Here we tell cxf to use the camel transport, use the JmsComponent who registered the prefix "jms" and use the queue "CustomerService".</p>

<h3 id="BookInOnePage-SettinguptheCamelContext">Setting up the CamelContext</h3>

<p>As we do not need additional routing an empty <a shape="rect" class="external-link" href="http://activemq.apache.org/camel/spring.html">CamelContext</a> bean will suffice.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;camelContext id=&quot;camelContext&quot; xmlns=&quot;http://activemq.apache.org/camel/schema/spring&quot;&gt;
&lt;/camelContext&gt;
]]></script>
</div></div>

<h3 id="BookInOnePage-RunningtheExample">Running the Example</h3>

<ul><li><a shape="rect" href="book-in-one-page.data/cxfcamelexample.zip?version=2&amp;modificationDate=1219846788000&amp;api=v2" data-linked-resource-id="8791" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="cxfcamelexample.zip" data-nice-type="Zip Archive" data-linked-resource-content-type="application/x-zip" data-linked-resource-container-id="95908" data-linked-resource-container-version="12">Download the example project here</a></li></ul>


<ul><li>Follow the readme.txt</li></ul>


<h3 id="BookInOnePage-Conclusion.2">Conclusion</h3>

<p>As you have seen in this example you can use Camel to connect services to JMS easily while being able to also use the rich integration features of Apache Camel.</p>

<h2 id="BookInOnePage-TutorialusingAxis1.4withApacheCamel">Tutorial using Axis 1.4 with Apache Camel</h2>

<div class="confluence-information-macro confluence-information-macro-information"><p class="title">Removed from distribution</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>This example has been removed from <strong>Camel 2.9</strong> onwards. Apache Axis 1.4 is a very old and unsupported framework. We encourage users to use <a shape="rect" href="cxf.html">CXF</a> instead of Axis.</p></div></div>

<style type="text/css">/*<![CDATA[*/
div.rbtoc1480069136033 {padding: 0px;}
div.rbtoc1480069136033 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1480069136033 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class="toc-macro rbtoc1480069136033">
<ul class="toc-indentation"><li><a shape="rect" href="#BookInOnePage-TutorialusingAxis1.4withApacheCamel">Tutorial using Axis 1.4 with Apache Camel</a>
<ul class="toc-indentation"><li><a shape="rect" href="#BookInOnePage-Prerequisites">Prerequisites</a></li><li><a shape="rect" href="#BookInOnePage-Distribution">Distribution</a></li><li><a shape="rect" href="#BookInOnePage-Introduction">Introduction</a></li><li><a shape="rect" href="#BookInOnePage-SettinguptheprojecttorunAxis">Setting up the project to run Axis</a>
<ul class="toc-indentation"><li><a shape="rect" href="#BookInOnePage-Maven2">Maven 2</a></li><li><a shape="rect" href="#BookInOnePage-wsdl">wsdl</a></li><li><a shape="rect" href="#BookInOnePage-ConfiguringAxis">Configuring Axis</a></li><li><a shape="rect" href="#BookInOnePage-RunningtheExample">Running the Example</a></li></ul>
</li><li><a shape="rect" href="#BookInOnePage-IntegratingSpring">Integrating Spring</a>
<ul class="toc-indentation"><li><a shape="rect" href="#BookInOnePage-UsingSpring">Using Spring</a></li></ul>
</li><li><a shape="rect" href="#BookInOnePage-IntegratingCamel">Integrating Camel</a>
<ul class="toc-indentation"><li><a shape="rect" href="#BookInOnePage-CamelContext">CamelContext</a></li><li><a shape="rect" href="#BookInOnePage-Storeafilebackup">Store a file backup</a></li></ul>
</li><li><a shape="rect" href="#BookInOnePage-Runningtheexample">Running the example</a></li><li><a shape="rect" href="#BookInOnePage-UnitTesting">Unit Testing</a>
<ul class="toc-indentation"><li><a shape="rect" href="#BookInOnePage-SmarterUnitTestingwithSpring">Smarter Unit Testing with Spring</a></li></ul>
</li><li><a shape="rect" href="#BookInOnePage-UnitTestcallingWebService">Unit Test calling WebService</a></li><li><a shape="rect" href="#BookInOnePage-Annotations">Annotations</a></li><li><a shape="rect" href="#BookInOnePage-TheEnd">The End</a></li><li><a shape="rect" href="#BookInOnePage-SeeAlso">See Also</a></li></ul>
</li></ul>
</div>

<h3 id="BookInOnePage-Prerequisites.2">Prerequisites</h3>

<p>This tutorial uses Maven 2 to setup the Camel project and for dependencies for artifacts.</p>

<h3 id="BookInOnePage-Distribution.1">Distribution</h3>

<p>This sample is distributed with the Camel 1.5 distribution as <code>examples/camel-example-axis</code>.</p>

<h3 id="BookInOnePage-Introduction.5">Introduction</h3>
<p><a shape="rect" class="external-link" href="http://ws.apache.org/axis/">Apache Axis</a> is/was widely used as a webservice framework. So in line with some of the other tutorials to demonstrate how Camel is not an invasive framework but is flexible and integrates well with existing solution. </p>

<p>We have an existing solution that exposes a webservice using Axis 1.4 deployed as web applications. This is a common solution. We use contract first so we have Axis generated source code from an existing wsdl file. Then we show how we introduce Spring and Camel to integrate with Axis.</p>

<p>This tutorial uses the following frameworks:</p>
<ul><li>Maven 2.0.9</li><li>Apache Camel 1.5.0</li><li>Apache Axis 1.4</li><li>Spring 2.5.5</li></ul>


<h3 id="BookInOnePage-SettinguptheprojecttorunAxis">Setting up the project to run Axis</h3>
<p>This first part is about getting the project up to speed with Axis. We are not touching Camel or Spring at this time.</p>

<h4 id="BookInOnePage-Maven2">Maven 2</h4>
<p>Axis dependencies is available for maven 2 so we configure our pom.xml as:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.axis&lt;/groupId&gt;
            &lt;artifactId&gt;axis&lt;/artifactId&gt;
            &lt;version&gt;1.4&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.axis&lt;/groupId&gt;
            &lt;artifactId&gt;axis-jaxrpc&lt;/artifactId&gt;
            &lt;version&gt;1.4&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.axis&lt;/groupId&gt;
            &lt;artifactId&gt;axis-saaj&lt;/artifactId&gt;
            &lt;version&gt;1.4&lt;/version&gt;
        &lt;/dependency&gt;

	&lt;dependency&gt;
	    &lt;groupId&gt;axis&lt;/groupId&gt;
	    &lt;artifactId&gt;axis-wsdl4j&lt;/artifactId&gt;
	    &lt;version&gt;1.5.1&lt;/version&gt;
	&lt;/dependency&gt;

	&lt;dependency&gt;
	    &lt;groupId&gt;commons-discovery&lt;/groupId&gt;
	    &lt;artifactId&gt;commons-discovery&lt;/artifactId&gt;
	    &lt;version&gt;0.4&lt;/version&gt;
	&lt;/dependency&gt; 

        &lt;dependency&gt;
            &lt;groupId&gt;log4j&lt;/groupId&gt;
            &lt;artifactId&gt;log4j&lt;/artifactId&gt;
            &lt;version&gt;1.2.14&lt;/version&gt;
        &lt;/dependency&gt;
]]></script>
</div></div>

<p>Then we need to configure maven to use Java 1.5 and the Axis maven plugin that generates the source code based on the wsdl file:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;!-- to compile with 1.5 --&gt;
	&lt;plugin&gt;
		&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
		&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
		&lt;configuration&gt;
			&lt;source&gt;1.5&lt;/source&gt;
			&lt;target&gt;1.5&lt;/target&gt;
		&lt;/configuration&gt;
	&lt;/plugin&gt;

            &lt;plugin&gt;
               &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
               &lt;artifactId&gt;axistools-maven-plugin&lt;/artifactId&gt;
               &lt;configuration&gt;
	          &lt;sourceDirectory&gt;src/main/resources/&lt;/sourceDirectory&gt;
                  &lt;packageSpace&gt;com.mycompany.myschema&lt;/packageSpace&gt;
                  &lt;testCases&gt;false&lt;/testCases&gt;
                  &lt;serverSide&gt;true&lt;/serverSide&gt;
                  &lt;subPackageByFileName&gt;false&lt;/subPackageByFileName&gt;
               &lt;/configuration&gt;
               &lt;executions&gt;
                 &lt;execution&gt;
                   &lt;goals&gt;
                     &lt;goal&gt;wsdl2java&lt;/goal&gt;
                   &lt;/goals&gt;
                 &lt;/execution&gt;
               &lt;/executions&gt;
            &lt;/plugin&gt;
]]></script>
</div></div>

<h4 id="BookInOnePage-wsdl">wsdl</h4>
<p>We use the same .wsdl file as the <a shape="rect" href="tutorial-example-reportincident.html">Tutorial-Example-ReportIncident</a> and copy it to <code>src/main/webapp/WEB-INF/wsdl</code></p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
&lt;wsdl:definitions xmlns:soap=&quot;http://schemas.xmlsoap.org/wsdl/soap/&quot;
	xmlns:tns=&quot;http://reportincident.example.camel.apache.org&quot;
	xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;
	xmlns:http=&quot;http://schemas.xmlsoap.org/wsdl/http/&quot;
	xmlns:wsdl=&quot;http://schemas.xmlsoap.org/wsdl/&quot;
	targetNamespace=&quot;http://reportincident.example.camel.apache.org&quot;&gt;

	&lt;!-- Type definitions for input- and output parameters for webservice --&gt;
	&lt;wsdl:types&gt;
	&lt;xs:schema targetNamespace=&quot;http://reportincident.example.camel.apache.org&quot;&gt;
			&lt;xs:element name=&quot;inputReportIncident&quot;&gt;
				&lt;xs:complexType&gt;
					&lt;xs:sequence&gt;
						&lt;xs:element type=&quot;xs:string&quot;  name=&quot;incidentId&quot;/&gt;
						&lt;xs:element type=&quot;xs:string&quot;  name=&quot;incidentDate&quot;/&gt;
						&lt;xs:element type=&quot;xs:string&quot;  name=&quot;givenName&quot;/&gt;
						&lt;xs:element type=&quot;xs:string&quot;  name=&quot;familyName&quot;/&gt;
						&lt;xs:element type=&quot;xs:string&quot;  name=&quot;summary&quot;/&gt;
						&lt;xs:element type=&quot;xs:string&quot;  name=&quot;details&quot;/&gt;
						&lt;xs:element type=&quot;xs:string&quot;  name=&quot;email&quot;/&gt;
						&lt;xs:element type=&quot;xs:string&quot;  name=&quot;phone&quot;/&gt;
					&lt;/xs:sequence&gt;
				&lt;/xs:complexType&gt;
			&lt;/xs:element&gt;
			&lt;xs:element name=&quot;outputReportIncident&quot;&gt;
				&lt;xs:complexType&gt;
					&lt;xs:sequence&gt;
						&lt;xs:element type=&quot;xs:string&quot; name=&quot;code&quot;/&gt;
					&lt;/xs:sequence&gt;
				&lt;/xs:complexType&gt;
			&lt;/xs:element&gt;
		&lt;/xs:schema&gt;
	&lt;/wsdl:types&gt;

	&lt;!-- Message definitions for input and output --&gt;
	&lt;wsdl:message name=&quot;inputReportIncident&quot;&gt;
		&lt;wsdl:part name=&quot;parameters&quot; element=&quot;tns:inputReportIncident&quot;/&gt;
	&lt;/wsdl:message&gt;
	&lt;wsdl:message name=&quot;outputReportIncident&quot;&gt;
		&lt;wsdl:part name=&quot;parameters&quot; element=&quot;tns:outputReportIncident&quot;/&gt;
	&lt;/wsdl:message&gt;

	&lt;!-- Port (interface) definitions --&gt;
	&lt;wsdl:portType name=&quot;ReportIncidentEndpoint&quot;&gt;
		&lt;wsdl:operation name=&quot;ReportIncident&quot;&gt;
			&lt;wsdl:input message=&quot;tns:inputReportIncident&quot;/&gt;
			&lt;wsdl:output message=&quot;tns:outputReportIncident&quot;/&gt;
		&lt;/wsdl:operation&gt;
	&lt;/wsdl:portType&gt;

	&lt;!-- Port bindings to transports and encoding - HTTP, document literal encoding is used --&gt;
	&lt;wsdl:binding name=&quot;ReportIncidentBinding&quot; type=&quot;tns:ReportIncidentEndpoint&quot;&gt;
		&lt;soap:binding transport=&quot;http://schemas.xmlsoap.org/soap/http&quot;/&gt;
		&lt;wsdl:operation name=&quot;ReportIncident&quot;&gt;
			&lt;soap:operation
				soapAction=&quot;http://reportincident.example.camel.apache.org/ReportIncident&quot;
				style=&quot;document&quot;/&gt;
			&lt;wsdl:input&gt;
				&lt;soap:body parts=&quot;parameters&quot; use=&quot;literal&quot;/&gt;
			&lt;/wsdl:input&gt;
			&lt;wsdl:output&gt;
				&lt;soap:body parts=&quot;parameters&quot; use=&quot;literal&quot;/&gt;
			&lt;/wsdl:output&gt;
		&lt;/wsdl:operation&gt;
	&lt;/wsdl:binding&gt;

	&lt;!-- Service definition --&gt;
	&lt;wsdl:service name=&quot;ReportIncidentService&quot;&gt;
		&lt;wsdl:port name=&quot;ReportIncidentPort&quot; binding=&quot;tns:ReportIncidentBinding&quot;&gt;
			&lt;soap:address location=&quot;http://reportincident.example.camel.apache.org&quot;/&gt;
		&lt;/wsdl:port&gt;
	&lt;/wsdl:service&gt;

&lt;/wsdl:definitions&gt;
]]></script>
</div></div>

<h4 id="BookInOnePage-ConfiguringAxis">Configuring Axis</h4>
<p>Okay we are now setup for the contract first development and can generate the source file. For now we are still only using standard Axis and not Spring nor Camel. We still need to setup Axis as a web application so we configure the web.xml in <code>src/main/webapp/WEB-INF/web.xml</code> as:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    &lt;servlet&gt;
        &lt;servlet-name&gt;axis&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.apache.axis.transport.http.AxisServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;axis&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/services/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
]]></script>
</div></div>
<p>The web.xml just registers Axis servlet that is handling the incoming web requests to its servlet mapping. We still need to configure Axis itself and this is done using its special configuration file <code>server-config.wsdd</code>. We nearly get this file for free if we let Axis generate the source code so we run the maven goal:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
mvn axistools:wsdl2java
]]></script>
</div></div>
<p>The tool will generate the source code based on the wsdl and save the files to the following folder:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
.\target\generated-sources\axistools\wsdl2java\org\apache\camel\example\reportincident
deploy.wsdd
InputReportIncident.java
OutputReportIncident.java
ReportIncidentBindingImpl.java
ReportIncidentBindingStub.java
ReportIncidentService_PortType.java
ReportIncidentService_Service.java
ReportIncidentService_ServiceLocator.java
undeploy.wsdd
]]></script>
</div></div>
<p>This is standard Axis and so far no Camel or Spring has been touched. To implement our webservice we will add our code, so we create a new class <code>AxisReportIncidentService</code> that implements the port type interface where we can implement our code logic what happens when the webservice is invoked.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
package org.apache.camel.example.axis;

import org.apache.camel.example.reportincident.InputReportIncident;
import org.apache.camel.example.reportincident.OutputReportIncident;
import org.apache.camel.example.reportincident.ReportIncidentService_PortType;

import java.rmi.RemoteException;

/**
 * Axis webservice
 */
public class AxisReportIncidentService implements ReportIncidentService_PortType {

    public OutputReportIncident reportIncident(InputReportIncident parameters) throws RemoteException {
        System.out.println(&quot;Hello AxisReportIncidentService is called from &quot; + parameters.getGivenName());

        OutputReportIncident out = new OutputReportIncident();
        out.setCode(&quot;OK&quot;);
        return out;
    }

}
]]></script>
</div></div>
<p>Now we need to configure Axis itself and this is done using its <code>server-config.wsdd</code> file. We nearly get this for for free from the auto generated code, we copy the stuff from <code>deploy.wsdd</code> and made a few modifications:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;deployment xmlns=&quot;http://xml.apache.org/axis/wsdd/&quot; xmlns:java=&quot;http://xml.apache.org/axis/wsdd/providers/java&quot;&gt;
  &lt;!-- global configuration --&gt;
	&lt;globalConfiguration&gt;
		&lt;parameter name=&quot;sendXsiTypes&quot; value=&quot;true&quot;/&gt;
		&lt;parameter name=&quot;sendMultiRefs&quot; value=&quot;true&quot;/&gt;
		&lt;parameter name=&quot;sendXMLDeclaration&quot; value=&quot;true&quot;/&gt;
		&lt;parameter name=&quot;axis.sendMinimizedElements&quot; value=&quot;true&quot;/&gt;
	&lt;/globalConfiguration&gt;
	&lt;handler name=&quot;URLMapper&quot; type=&quot;java:org.apache.axis.handlers.http.URLMapper&quot;/&gt;

  &lt;!-- this service is from deploy.wsdd --&gt;
  &lt;service name=&quot;ReportIncidentPort&quot; provider=&quot;java:RPC&quot; style=&quot;document&quot; use=&quot;literal&quot;&gt;
      &lt;parameter name=&quot;wsdlTargetNamespace&quot; value=&quot;http://reportincident.example.camel.apache.org&quot;/&gt;
      &lt;parameter name=&quot;wsdlServiceElement&quot; value=&quot;ReportIncidentService&quot;/&gt;
      &lt;parameter name=&quot;schemaUnqualified&quot; value=&quot;http://reportincident.example.camel.apache.org&quot;/&gt;
      &lt;parameter name=&quot;wsdlServicePort&quot; value=&quot;ReportIncidentPort&quot;/&gt;
      &lt;parameter name=&quot;className&quot; value=&quot;org.apache.camel.example.reportincident.ReportIncidentBindingImpl&quot;/&gt;
      &lt;parameter name=&quot;wsdlPortType&quot; value=&quot;ReportIncidentService&quot;/&gt;
      &lt;parameter name=&quot;typeMappingVersion&quot; value=&quot;1.2&quot;/&gt;
      &lt;operation name=&quot;reportIncident&quot; qname=&quot;ReportIncident&quot; returnQName=&quot;retNS:outputReportIncident&quot; xmlns:retNS=&quot;http://reportincident.example.camel.apache.org&quot;
                 returnType=&quot;rtns:&gt;outputReportIncident&quot; xmlns:rtns=&quot;http://reportincident.example.camel.apache.org&quot;
                 soapAction=&quot;http://reportincident.example.camel.apache.org/ReportIncident&quot; &gt;
        &lt;parameter qname=&quot;pns:inputReportIncident&quot; xmlns:pns=&quot;http://reportincident.example.camel.apache.org&quot;
                 type=&quot;tns:&gt;inputReportIncident&quot; xmlns:tns=&quot;http://reportincident.example.camel.apache.org&quot;/&gt;
      &lt;/operation&gt;
      &lt;parameter name=&quot;allowedMethods&quot; value=&quot;reportIncident&quot;/&gt;

      &lt;typeMapping
        xmlns:ns=&quot;http://reportincident.example.camel.apache.org&quot;
        qname=&quot;ns:&gt;outputReportIncident&quot;
        type=&quot;java:org.apache.camel.example.reportincident.OutputReportIncident&quot;
        serializer=&quot;org.apache.axis.encoding.ser.BeanSerializerFactory&quot;
        deserializer=&quot;org.apache.axis.encoding.ser.BeanDeserializerFactory&quot;
        encodingStyle=&quot;&quot;
      /&gt;
      &lt;typeMapping
        xmlns:ns=&quot;http://reportincident.example.camel.apache.org&quot;
        qname=&quot;ns:&gt;inputReportIncident&quot;
        type=&quot;java:org.apache.camel.example.reportincident.InputReportIncident&quot;
        serializer=&quot;org.apache.axis.encoding.ser.BeanSerializerFactory&quot;
        deserializer=&quot;org.apache.axis.encoding.ser.BeanDeserializerFactory&quot;
        encodingStyle=&quot;&quot;
      /&gt;
  &lt;/service&gt;

  &lt;!-- part of Axis configuration --&gt;
	&lt;transport name=&quot;http&quot;&gt;
		&lt;requestFlow&gt;
			&lt;handler type=&quot;URLMapper&quot;/&gt;
			&lt;handler type=&quot;java:org.apache.axis.handlers.http.HTTPAuthHandler&quot;/&gt;
		&lt;/requestFlow&gt;
	&lt;/transport&gt;
&lt;/deployment&gt;
]]></script>
</div></div>
<p>The <strong>globalConfiguration</strong> and <strong>transport</strong> is not in the deploy.wsdd file so you gotta write that yourself. The <strong>service</strong> is a 100% copy from deploy.wsdd. Axis has more configuration to it than shown here, but then you should check the <a shape="rect" class="external-link" href="http://ws.apache.org/axis/">Axis documentation</a>.</p>

<p>What we need to do now is important, as we need to modify the above configuration to use our webservice class than the default one, so we change the classname parameter to our class <strong>AxisReportIncidentService</strong>:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;parameter name=&quot;className&quot; value=&quot;org.apache.camel.example.axis.AxisReportIncidentService&quot;/&gt;
]]></script>
</div></div>




<h4 id="BookInOnePage-RunningtheExample.1">Running the Example</h4>
<p>Now we are ready to run our example for the first time, so we use Jetty as the quick web container using its maven command:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
mvn jetty:run
]]></script>
</div></div>
<p>Then we can hit the web browser and enter this URL: <code><a shape="rect" class="external-link" href="http://localhost:8080/camel-example-axis/services" rel="nofollow">http://localhost:8080/camel-example-axis/services</a></code> and you should see the famous Axis start page with the text <strong>And now... Some Services</strong>. </p>

<p>Clicking on the .wsdl link shows the wsdl file, but what. It's an auto generated one and not our original .wsdl file. So we need to fix this ASAP and this is done by configuring Axis in the server-config.wsdd file:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
  &lt;service name=&quot;ReportIncidentPort&quot; provider=&quot;java:RPC&quot; style=&quot;document&quot; use=&quot;literal&quot;&gt;
    &lt;wsdlFile&gt;/WEB-INF/wsdl/report_incident.wsdl&lt;/wsdlFile&gt;
    ...
]]></script>
</div></div>
<p>We do this by adding the wsdlFile tag in the service element where we can point to the real .wsdl file.</p>

<h3 id="BookInOnePage-IntegratingSpring">Integrating Spring</h3>
<p>First we need to add its dependencies to the <strong>pom.xml</strong>. </p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-web&lt;/artifactId&gt;
            &lt;version&gt;2.5.5&lt;/version&gt;
        &lt;/dependency&gt;
]]></script>
</div></div>

<p>Spring is integrated just as it would like to, we add its listener to the web.xml and a context parameter to be able to configure precisely what spring xml files to use:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    &lt;context-param&gt;
        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
        &lt;param-value&gt;
            classpath:axis-example-context.xml
        &lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;listener&gt;
        &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
    &lt;/listener&gt;
]]></script>
</div></div>
<p>Next is to add a plain spring XML file named <strong>axis-example-context.xml</strong> in the src/main/resources folder.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;
         http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd&quot;&gt;

&lt;/beans&gt;
]]></script>
</div></div>
<p>The spring XML file is currently empty. We hit jetty again with <code>mvn jetty:run</code> just to make sure Spring was setup correctly.</p>

<h4 id="BookInOnePage-UsingSpring">Using Spring</h4>
<p>We would like to be able to get hold of the Spring ApplicationContext from our webservice so we can get access to the glory spring, but how do we do this? And our webservice class AxisReportIncidentService is created and managed by Axis we want to let Spring do this. So we have two problems.</p>

<p>We solve these problems by creating a delegate class that Axis creates, and this delegate class gets hold on Spring and then gets our real webservice as a spring bean and invoke the service. </p>

<p>First we create a new class that is 100% independent from Axis and just a plain POJO. This is our real service.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
package org.apache.camel.example.axis;

import org.apache.camel.example.reportincident.InputReportIncident;
import org.apache.camel.example.reportincident.OutputReportIncident;

/**
 * Our real service that is not tied to Axis
 */
public class ReportIncidentService  {

    public OutputReportIncident reportIncident(InputReportIncident parameters) {
        System.out.println(&quot;Hello ReportIncidentService is called from &quot; + parameters.getGivenName());

        OutputReportIncident out = new OutputReportIncident();
        out.setCode(&quot;OK&quot;);
        return out;
    }

}
]]></script>
</div></div>
<p>So now we need to get from AxisReportIncidentService to this one ReportIncidentService using Spring. Well first of all we add our real service to spring XML configuration file so Spring can handle its lifecycle:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;
         http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd&quot;&gt;
    
    &lt;bean id=&quot;incidentservice&quot; class=&quot;org.apache.camel.example.axis.ReportIncidentService&quot;/&gt;

&lt;/beans&gt;
]]></script>
</div></div>
<p>And then we need to modify AxisReportIncidentService to use Spring to lookup the spring bean <strong>id="incidentservice"</strong> and delegate the call. We do this by extending the spring class <code>org.springframework.remoting.jaxrpc.ServletEndpointSupport</code> so the refactored code is:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
package org.apache.camel.example.axis;

import org.apache.camel.example.reportincident.InputReportIncident;
import org.apache.camel.example.reportincident.OutputReportIncident;
import org.apache.camel.example.reportincident.ReportIncidentService_PortType;
import org.springframework.remoting.jaxrpc.ServletEndpointSupport;

import java.rmi.RemoteException;

/**
 * Axis webservice
 */
public class AxisReportIncidentService extends ServletEndpointSupport implements ReportIncidentService_PortType {

    public OutputReportIncident reportIncident(InputReportIncident parameters) throws RemoteException {
        // get hold of the spring bean from the application context
        ReportIncidentService service = (ReportIncidentService) getApplicationContext().getBean(&quot;incidentservice&quot;);

        // delegate to the real service
        return service.reportIncident(parameters);
    }

}
]]></script>
</div></div>
<p>To see if everything is okay we run <code>mvn jetty:run</code>.</p>

<p>In the code above we get hold of our service at each request by looking up in the application context. However Spring also supports an <strong>init</strong> method where we can do this once. So we change the code to:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class AxisReportIncidentService extends ServletEndpointSupport implements ReportIncidentService_PortType {

    private ReportIncidentService service;

    @Override
    protected void onInit() throws ServiceException {
        // get hold of the spring bean from the application context
        service = (ReportIncidentService) getApplicationContext().getBean(&quot;incidentservice&quot;);
    }

    public OutputReportIncident reportIncident(InputReportIncident parameters) throws RemoteException {
        // delegate to the real service
        return service.reportIncident(parameters);
    }

}
]]></script>
</div></div>
<p>So now we have integrated Axis with Spring and we are ready for Camel.</p>

<h3 id="BookInOnePage-IntegratingCamel">Integrating Camel</h3>
<p>Again the first step is to add the dependencies to the maven <strong>pom.xml</strong> file:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
            &lt;artifactId&gt;camel-core&lt;/artifactId&gt;
            &lt;version&gt;1.5.0&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
            &lt;artifactId&gt;camel-spring&lt;/artifactId&gt;
            &lt;version&gt;1.5.0&lt;/version&gt;
        &lt;/dependency&gt;
]]></script>
</div></div>
<p>Now that we have integrated with Spring then we easily integrate with Camel as Camel works well with Spring.</p>
<div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Camel does not require Spring</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>Camel does not require Spring, we could easily have used Camel without Spring, but most users prefer to use Spring also.</p></div></div>
<p>We choose to integrate Camel in the Spring XML file so we add the camel namespace and the schema location:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
xmlns:camel=&quot;http://activemq.apache.org/camel/schema/spring&quot;
http://activemq.apache.org/camel/schema/spring http://activemq.apache.org/camel/schema/spring/camel-spring.xsd&quot;
]]></script>
</div></div>
<h4 id="BookInOnePage-CamelContext.1">CamelContext</h4>
<p><a shape="rect" href="camelcontext.html">CamelContext</a> is the heart of Camel its where all the <a shape="rect" href="routes.html">routes</a>, <a shape="rect" href="endpoint.html">endpoints</a>, <a shape="rect" href="components.html">components</a>, etc. is registered. So we setup a <a shape="rect" href="camelcontext.html">CamelContext</a> and the spring XML files looks like:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:camel=&quot;http://activemq.apache.org/camel/schema/spring&quot;
       xsi:schemaLocation=&quot;
         http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
         http://activemq.apache.org/camel/schema/spring http://activemq.apache.org/camel/schema/spring/camel-spring.xsd&quot;&gt;

    &lt;bean id=&quot;incidentservice&quot; class=&quot;org.apache.camel.example.axis.ReportIncidentService&quot;/&gt;

    &lt;camel:camelContext id=&quot;camel&quot;&gt;
        &lt;!-- TODO: Here we can add Camel stuff --&gt;
    &lt;/camel:camelContext&gt;

&lt;/beans&gt;
]]></script>
</div></div>

<h4 id="BookInOnePage-Storeafilebackup">Store a file backup</h4>
<p>We want to store the web service request as a file before we return a response. To do this we want to send the file content as a <a shape="rect" href="message.html">message</a> to an <a shape="rect" href="endpoint.html">endpoint</a> that produces the <a shape="rect" href="file2.html">file</a>. So we need to do two steps:</p>
<ul class="alternate"><li>configure the file backup endpoint</li><li>send the message to the endpoint</li></ul>


<p>The endpoint is configured in spring XML so we just add it as:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    &lt;camel:camelContext id=&quot;camelContext&quot;&gt;
        &lt;!-- endpoint named backup that is configued as a file component --&gt;
        &lt;camel:endpoint id=&quot;backup&quot; uri=&quot;file://target?append=false&quot;/&gt;
    &lt;/camel:camelContext&gt;
]]></script>
</div></div>
<p>In the <a shape="rect" href="camelcontext.html">CamelContext</a> we have defined our endpoint with the id <code>backup</code> and configured it use the <a shape="rect" href="how-do-i-configure-endpoints.html">URL notation</a> that we know from the internet. Its a <code>file</code> scheme that accepts a context and some options. The contest is <code>target</code> and its the folder to store the file. The option is just as the internet with ? and &amp; for subsequent options. We configure it to not append, meaning than any existing file will be overwritten. See the <a shape="rect" href="file2.html">File</a> component for options and how to use the camel file endpoint.</p>

<p>Next up is to be able to send a message to this endpoint. The easiest way is to use a ProducerTemplate. A ProducerTemplate is inspired by Spring template pattern with for instance JmsTemplate or JdbcTemplate in mind. The template that all the grunt work and exposes a simple interface to the end-user where he/she can set the payload to send. Then the template will do proper resource handling and all related issues in that regard. But how do we get hold of such a template? Well the <a shape="rect" href="camelcontext.html">CamelContext</a> is able to provide one. This is done by configuring the template on the camel context in the spring XML as:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    &lt;camel:camelContext id=&quot;camelContext&quot;&gt;
        &lt;!-- producer template exposed with this id --&gt;
        &lt;camel:template id=&quot;camelTemplate&quot;/&gt;

        &lt;!-- endpoint named backup that is configued as a file component --&gt;
        &lt;camel:endpoint id=&quot;backup&quot; uri=&quot;file://target?append=false&quot;/&gt;
    &lt;/camel:camelContext&gt;
]]></script>
</div></div>
<p>Then we can expose a ProducerTemplate property on our service with a setter in the Java code as:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class ReportIncidentService {

    private ProducerTemplate template;

    public void setTemplate(ProducerTemplate template) {
        this.template = template;
    }
]]></script>
</div></div>
<p>And then let Spring handle the dependency inject as below:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    &lt;bean id=&quot;incidentservice&quot; class=&quot;org.apache.camel.example.axis.ReportIncidentService&quot;&gt;
        &lt;!-- set the producer template to use from the camel context below --&gt;
        &lt;property name=&quot;template&quot; ref=&quot;camelTemplate&quot;/&gt;
    &lt;/bean&gt;
]]></script>
</div></div>

<p>Now we are ready to use the producer template in our service to send the payload to the endpoint. The template has many <strong>sendXXX</strong> methods for this purpose. But before we send the payload to the file endpoint we must also specify what filename to store the file as. This is done by sending meta data with the payload. In Camel metadata is sent as headers. Headers is just a plain <code>Map&lt;String, Object&gt;</code>. So if we needed to send several metadata then we could construct an ordinary HashMap and put the values in there. But as we just need to send one header with the filename Camel has a convenient send method <code>sendBodyAndHeader</code> so we choose this one. </p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    public OutputReportIncident reportIncident(InputReportIncident parameters) {
        System.out.println(&quot;Hello ReportIncidentService is called from &quot; + parameters.getGivenName());

        String data = parameters.getDetails();

        // store the data as a file
        String filename = parameters.getIncidentId() + &quot;.txt&quot;;
        // send the data to the endpoint and the header contains what filename it should be stored as
        template.sendBodyAndHeader(&quot;backup&quot;, data, &quot;org.apache.camel.file.name&quot;, filename);

        OutputReportIncident out = new OutputReportIncident();
        out.setCode(&quot;OK&quot;);
        return out;
    }
]]></script>
</div></div>
<p>The template in the code above uses 4 parameters:</p>
<ul class="alternate"><li>the endpoint name, in this case the id referring to the endpoint defined in Spring XML in the camelContext element.</li><li>the payload, can be any kind of object</li><li>the key for the header, in this case a Camel keyword to set the filename</li><li>and the value for the header</li></ul>


<h3 id="BookInOnePage-Runningtheexample">Running the example</h3>
<p>We start our integration with maven using <code>mvn jetty:run</code>. Then we open a browser and hit <code><a shape="rect" class="external-link" href="http://localhost:8080" rel="nofollow">http://localhost:8080</a></code>. Jetty is so smart that it display a frontpage with links to the deployed application so just hit the link and you get our application. Now we hit append /services to the URL to access the Axis frontpage. The URL should be <code><a shape="rect" class="external-link" href="http://localhost:8080/camel-example-axis/services" rel="nofollow">http://localhost:8080/camel-example-axis/services</a></code>. </p>

<p>You can then test it using a web service test tools such as <a shape="rect" class="external-link" href="http://www.soapui.org/" rel="nofollow">SoapUI</a>. <br clear="none">
Hitting the service will output to the console</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
2008-09-06 15:01:41.718::INFO:  Started SelectChannelConnector @ 0.0.0.0:8080
[INFO] Started Jetty Server
Hello ReportIncidentService is called from Ibsen
]]></script>
</div></div>
<p>And there should be a file in the target subfolder.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
dir target /b
123.txt
]]></script>
</div></div>

<h3 id="BookInOnePage-UnitTesting">Unit Testing</h3>
<p>We would like to be able to unit test our <strong>ReportIncidentService</strong> class. So we add junit to the maven dependency:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;3.8.2&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
]]></script>
</div></div>
<p>And then we create a plain junit testcase for our service class.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
package org.apache.camel.example.axis;

import junit.framework.TestCase;
import org.apache.camel.example.reportincident.InputReportIncident;
import org.apache.camel.example.reportincident.OutputReportIncident;

/**
 * Unit test of service
 */
public class ReportIncidentServiceTest extends TestCase {

    public void testIncident() {
        ReportIncidentService service = new ReportIncidentService();

        InputReportIncident input = createDummyIncident();
        OutputReportIncident output = service.reportIncident(input);
        assertEquals(&quot;OK&quot;, output.getCode());
    }

   protected InputReportIncident createDummyIncident() {
        InputReportIncident input = new InputReportIncident();
        input.setEmail(&quot;davsclaus@apache.org&quot;);
        input.setIncidentId(&quot;12345678&quot;);
        input.setIncidentDate(&quot;2008-07-13&quot;);
        input.setPhone(&quot;+45 2962 7576&quot;);
        input.setSummary(&quot;Failed operation&quot;);
        input.setDetails(&quot;The wrong foot was operated.&quot;);
        input.setFamilyName(&quot;Ibsen&quot;);
        input.setGivenName(&quot;Claus&quot;);
        return input;
    }

}
]]></script>
</div></div>
<p>Then we can run the test with maven using: <code>mvn test</code>. But we will get a failure:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
Running org.apache.camel.example.axis.ReportIncidentServiceTest
Hello ReportIncidentService is called from Claus
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0.235 sec &lt;&lt;&lt; FAILURE!

Results :

Tests in error:
  testIncident(org.apache.camel.example.axis.ReportIncidentServiceTest)

Tests run: 1, Failures: 0, Errors: 1, Skipped: 0
]]></script>
</div></div>
<p>What is the problem? Well our service uses a CamelProducer (the template) to send a message to the file endpoint so the message will be stored in a file. What we need is to get hold of such a producer and inject it on our service, by calling the setter.</p>

<p>Since Camel is very light weight and embedable we are able to create a CamelContext and add the endpoint in our unit test code directly. We do this to show how this is possible:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    private CamelContext context;

    @Override
    protected void setUp() throws Exception {
        super.setUp();
        // CamelContext is just created like this
        context = new DefaultCamelContext();

        // then we can create our endpoint and set the options
        FileEndpoint endpoint = new FileEndpoint();
        // the endpoint must have the camel context set also
        endpoint.setCamelContext(context);
        // our output folder
        endpoint.setFile(new File(&quot;target&quot;));
        // and the option not to append
        endpoint.setAppend(false);

        // then we add the endpoint just in java code just as the spring XML, we register it with the &quot;backup&quot; id.
        context.addSingletonEndpoint(&quot;backup&quot;, endpoint);

        // finally we need to start the context so Camel is ready to rock
        context.start();
    }

    @Override
    protected void tearDown() throws Exception {
        super.tearDown();
        // and we are nice boys so we stop it to allow resources to clean up
        context.stop();
    }
]]></script>
</div></div>
<p>So now we are ready to set the ProducerTemplate on our service, and we get a hold of that baby from the CamelContext as:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    public void testIncident() {
        ReportIncidentService service = new ReportIncidentService();

        // get a producer template from the camel context
        ProducerTemplate template = context.createProducerTemplate();
        // inject it on our service using the setter
        service.setTemplate(template);

        InputReportIncident input = createDummyIncident();
        OutputReportIncident output = service.reportIncident(input);
        assertEquals(&quot;OK&quot;, output.getCode());
    }
]]></script>
</div></div>
<p>And this time when we run the unit test its a success:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
Results :

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0
]]></script>
</div></div>
<p>We would like to test that the file exists so we add these two lines to our test method:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        // should generate a file also
        File file = new File(&quot;target/&quot; + input.getIncidentId() + &quot;.txt&quot;);
        assertTrue(&quot;File should exists&quot;, file.exists());
]]></script>
</div></div>

<h4 id="BookInOnePage-SmarterUnitTestingwithSpring">Smarter Unit Testing with Spring</h4>
<p>The unit test above requires us to assemble the Camel pieces manually in java code. What if we would like our unit test to use our spring configuration file <strong>axis-example-context.xml</strong> where we already have setup the endpoint. And of course we would like to test using this configuration file as this is the real file we will use. Well hey presto the xml file is a spring ApplicationContext file and spring is able to load it, so we go the spring path for unit testing. First we add the spring-test jar to our maven dependency:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
]]></script>
</div></div>
<p>And then we refactor our unit test to be a standard spring unit class. What we need to do is to extend <code>AbstractJUnit38SpringContextTests</code> instead of <code>TestCase</code> in our unit test. Since Spring 2.5 embraces annotations we will use one as well to instruct what our xml configuration file is located:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
@ContextConfiguration(locations = &quot;classpath:axis-example-context.xml&quot;)
public class ReportIncidentServiceTest extends AbstractJUnit38SpringContextTests {
]]></script>
</div></div>
<p>What we must remember to add is the <strong>classpath:</strong> prefix as our xml file is located in <code>src/main/resources</code>. If we omit the prefix then Spring will by default try to locate the xml file in the current package and that is org.apache.camel.example.axis. If the xml file is located outside the classpath you can use file: prefix instead. So with these two modifications we can get rid of all the setup and teardown code we had before and now we will test our real configuration.</p>

<p>The last change is to get hold of the producer template and now we can just refer to the bean id it has in the spring xml file:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        &lt;!-- producer template exposed with this id --&gt;
        &lt;camel:template id=&quot;camelTemplate&quot;/&gt;
]]></script>
</div></div>
<p>So we get hold of it by just getting it from the spring ApplicationContext as all spring users is used to do:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        // get a producer template from the the spring context
        ProducerTemplate template = (ProducerTemplate) applicationContext.getBean(&quot;camelTemplate&quot;);
        // inject it on our service using the setter
        service.setTemplate(template);
]]></script>
</div></div>

<p>Now our unit test is much better, and a real power of Camel is that is fits nicely with Spring and you can use standard Spring'ish unit test to test your Camel applications as well.</p>

<h3 id="BookInOnePage-UnitTestcallingWebService">Unit Test calling WebService</h3>
<p>What if you would like to execute a unit test where you send a webservice request to the <strong>AxisReportIncidentService</strong> how do we unit test this one? Well first of all the code is merely just a delegate to our real service that we have just tested, but nevertheless its a good question and we would like to know how. Well the answer is that we can exploit that fact that Jetty is also a slim web container that can be embedded anywhere just as Camel can. So we add this to our pom.xml:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        &lt;dependency&gt;
            &lt;groupId&gt;org.mortbay.jetty&lt;/groupId&gt;
            &lt;artifactId&gt;jetty&lt;/artifactId&gt;
            &lt;version&gt;${jetty-version}&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
]]></script>
</div></div>
<p>Then we can create a new class <strong>AxisReportIncidentServiceTest</strong> to unit test with Jetty. The code to setup Jetty is shown below with code comments:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class AxisReportIncidentServiceTest extends TestCase {

    private Server server;

    private void startJetty() throws Exception {
        // create an embedded Jetty server
        server = new Server();

        // add a listener on port 8080 on localhost (127.0.0.1)
        Connector connector = new SelectChannelConnector();
        connector.setPort(8080);
        connector.setHost(&quot;127.0.0.1&quot;);
        server.addConnector(connector);

        // add our web context path
        WebAppContext wac = new WebAppContext();
        wac.setContextPath(&quot;/unittest&quot;);
        // set the location of the exploded webapp where WEB-INF is located
        // this is a nice feature of Jetty where we can point to src/main/webapp
        wac.setWar(&quot;./src/main/webapp&quot;);
        server.setHandler(wac);

        // then start Jetty
        server.setStopAtShutdown(true);
        server.start();
    }

    @Override
    protected void setUp() throws Exception {
        super.setUp();
        startJetty();
    }

    @Override
    protected void tearDown() throws Exception {
        super.tearDown();
        server.stop();
    }

}
]]></script>
</div></div>
<p>Now we just need to send the incident as a webservice request using Axis. So we add the following code:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    public void testReportIncidentWithAxis() throws Exception {
        // the url to the axis webservice exposed by jetty
        URL url = new URL(&quot;http://localhost:8080/unittest/services/ReportIncidentPort&quot;);

        // Axis stuff to get the port where we can send the webservice request
        ReportIncidentService_ServiceLocator locator = new ReportIncidentService_ServiceLocator();
        ReportIncidentService_PortType port = locator.getReportIncidentPort(url);

        // create input to send
        InputReportIncident input = createDummyIncident();
        // send the webservice and get the response
        OutputReportIncident output = port.reportIncident(input);
        assertEquals(&quot;OK&quot;, output.getCode());

        // should generate a file also
        File file = new File(&quot;target/&quot; + input.getIncidentId() + &quot;.txt&quot;);
        assertTrue(&quot;File should exists&quot;, file.exists());
    }

    protected InputReportIncident createDummyIncident() {
        InputReportIncident input = new InputReportIncident();
        input.setEmail(&quot;davsclaus@apache.org&quot;);
        input.setIncidentId(&quot;12345678&quot;);
        input.setIncidentDate(&quot;2008-07-13&quot;);
        input.setPhone(&quot;+45 2962 7576&quot;);
        input.setSummary(&quot;Failed operation&quot;);
        input.setDetails(&quot;The wrong foot was operated.&quot;);
        input.setFamilyName(&quot;Ibsen&quot;);
        input.setGivenName(&quot;Claus&quot;);
        return input;
    }
]]></script>
</div></div>
<p>And now we have an unittest that sends a webservice request using good old Axis.</p>

<h3 id="BookInOnePage-Annotations.1">Annotations</h3>
<p>Both Camel and Spring has annotations that can be used to configure and wire trivial settings more elegantly. Camel has the endpoint annotation <code><a shape="rect" href="bean-integration.html">@EndpointInjected</a></code> that is just what we need. With this annotation we can inject the endpoint into our service. The annotation takes either a name or uri parameter. The name is the bean id in the <a shape="rect" href="registry.html">Registry</a>. The uri is the URI configuration for the endpoint. Using this you can actually inject an endpoint that you have not defined in the camel context. As we have defined our endpoint with the id <strong>backup</strong> we use the name parameter.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    @EndpointInject(name = &quot;backup&quot;)
    private ProducerTemplate template;
]]></script>
</div></div>
<p>Camel is smart as <code><a shape="rect" href="bean-integration.html">@EndpointInjected</a></code> supports different kinds of object types. We like the ProducerTemplate so we just keep it as it is. <br clear="none">
Since we use annotations on the field directly we do not need to set the property in the spring xml file so we change our service bean:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    &lt;bean id=&quot;incidentservice&quot; class=&quot;org.apache.camel.example.axis.ReportIncidentService&quot;/&gt;
]]></script>
</div></div>
<p>Running the unit test with <code>mvn test</code> reveals that it works nicely.</p>

<p>And since we use the <code><a shape="rect" href="bean-integration.html">@EndpointInjected</a></code> that refers to the endpoint with the id backup directly we can loose the template tag in the xml, so its shorter:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    &lt;bean id=&quot;incidentservice&quot; class=&quot;org.apache.camel.example.axis.ReportIncidentService&quot;/&gt;

    &lt;camel:camelContext id=&quot;camelContext&quot;&gt;
        &lt;!-- producer template exposed with this id --&gt;
        &lt;camel:template id=&quot;camelTemplate&quot;/&gt;

        &lt;!-- endpoint named backup that is configued as a file component --&gt;
        &lt;camel:endpoint id=&quot;backup&quot; uri=&quot;file://target?append=false&quot;/&gt;

    &lt;/camel:camelContext&gt;
]]></script>
</div></div>
<p>And the final touch we can do is that since the endpoint is injected with concrete endpoint to use we can remove the <code>"backup"</code> name parameter when we send the message. So we change from:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        // send the data to the endpoint and the header contains what filename it should be stored as
        template.sendBodyAndHeader(&quot;backup&quot;, data, &quot;org.apache.camel.file.name&quot;, filename);
]]></script>
</div></div>
<p>To without the name:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        // send the data to the endpoint and the header contains what filename it should be stored as
        template.sendBodyAndHeader(data, &quot;org.apache.camel.file.name&quot;, filename);
]]></script>
</div></div>
<p>Then we avoid to duplicate the name and if we rename the endpoint name then we don't forget to change it in the code also.</p>

<h3 id="BookInOnePage-TheEnd">The End</h3>
<p>This tutorial hasn't really touched the one of the key concept of Camel as a powerful routing and mediation framework. But we wanted to demonstrate its flexibility and that it integrates well with even older frameworks such as Apache Axis 1.4.</p>

<p>Check out the other tutorials on Camel and the other examples. </p>

<p>Note that the code shown here also applies to Camel 1.4 so actually you can get started right away with the released version of Camel. As this time of writing Camel 1.5 is work in progress.</p>

<h3 id="BookInOnePage-SeeAlso.6">See Also</h3>
<ul class="alternate"><li><a shape="rect" href="tutorials.html">Tutorials</a></li><li><a shape="rect" href="examples.html">Examples</a></li></ul>

<h2 id="BookInOnePage-TutorialonusingCamelinaWebApplication">Tutorial on using Camel in a Web Application</h2>

<p>Camel has been designed to work great with the <a shape="rect" href="spring.html">Spring</a> framework; so if you are already a Spring user you can think of Camel as just a framework for adding to your Spring XML files.</p>

<p>So you can follow the usual Spring approach to working with web applications; namely to add the standard Spring hook to load a <strong>/WEB-INF/applicationContext.xml</strong> file. In that file you can include your usual Camel XML configuration.</p>

<h3 id="BookInOnePage-Step1:Edityourweb.xml">Step1: Edit your web.xml</h3>

<p>To enable spring add a context loader listener to your <strong>/WEB-INF/web.xml</strong> file</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;
         version=&quot;2.5&quot;&gt;

  &lt;listener&gt;
    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
  &lt;/listener&gt;

&lt;/web-app&gt;
]]></script>
</div></div>

<p>This will cause Spring to boot up and look for the <strong>/WEB-INF/applicationContext.xml</strong> file.</p>

<h3 id="BookInOnePage-Step2:Createa/WEB-INF/applicationContext.xmlfile">Step 2: Create a /WEB-INF/applicationContext.xml file</h3>

<p>Now you just need to create your Spring XML file and add your camel routes or configuration.</p>

<p>For example</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xsi:schemaLocation=&quot;
       http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
       http://www.springframework.org/schema/context 
       http://www.springframework.org/schema/context/spring-context-2.5.xsd
       http://camel.apache.org/schema/spring 
       http://camel.apache.org/schema/spring/camel-spring.xsd&quot;&gt;

  &lt;camelContext xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;
    &lt;route&gt;
      &lt;from uri=&quot;seda:foo&quot;/&gt;
      &lt;to uri=&quot;mock:results&quot;/&gt;
    &lt;/route&gt;
  &lt;/camelContext&gt;

&lt;/beans&gt;
]]></script>
</div></div>

<p>Then boot up your web application and you're good to go!</p>


<h3 id="BookInOnePage-HintsandTips">Hints and Tips</h3>

<p>If you use <a shape="rect" class="external-link" href="http://maven.apache.org/">Maven</a> to build your application your directory tree will look like this...</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
src/main/webapp/WEB-INF
  web.xml
  applicationContext.xml
]]></script>
</div></div>

<p>You should update your Maven pom.xml to enable WAR packaging/naming like this...</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;project&gt;
    ...
    &lt;packaging&gt;war&lt;/packaging&gt;
    ...
    &lt;build&gt;
	&lt;finalName&gt;[desired WAR file name]&lt;/finalName&gt;
        ...
    &lt;/build&gt;
]]></script>
</div></div>

<p>To enable more rapid development we highly recommend the <a shape="rect" class="external-link" href="http://docs.codehaus.org/display/JETTY/Maven+Jetty+Plugin" rel="nofollow">jetty:run maven plugin</a>.</p>

<p>Please refer to the <a shape="rect" class="external-link" href="http://docs.codehaus.org/display/JETTY/Maven+Jetty+Plugin" rel="nofollow">help for more information on using jetty:run</a> - but briefly if you add the following to your pom.xml </p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.mortbay.jetty&lt;/groupId&gt;
        &lt;artifactId&gt;maven-jetty-plugin&lt;/artifactId&gt;
        &lt;configuration&gt;
          &lt;webAppConfig&gt;
            &lt;contextPath&gt;/&lt;/contextPath&gt;
          &lt;/webAppConfig&gt;
          &lt;scanIntervalSeconds&gt;10&lt;/scanIntervalSeconds&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
]]></script>
</div></div>

<p>Then you can run your web application as follows</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
mvn jetty:run
]]></script>
</div></div>

<p>Then Jetty will also monitor your target/classes directory and your src/main/webapp directory so that if you modify your spring XML, your web.xml or your java code the web application will be restarted, re-creating your Camel routes.</p>

<p>If your unit tests take a while to run, you could miss them out when running your web application via</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
mvn -Dtest=false jetty:run
]]></script>
</div></div>

<h2 id="BookInOnePage-TutorialBusinessPartners">Tutorial Business Partners</h2>

<div class="confluence-information-macro confluence-information-macro-note"><p class="title">Under Construction</p><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>This tutorial is a work in progress.</p></div></div>

<h2 id="BookInOnePage-BackgroundandIntroduction">Background and Introduction</h2>

<h3 id="BookInOnePage-BusinessBackground">Business Background</h3>

<p>So there's a company, which we'll call Acme.  Acme sells widgets, in a fairly unusual way.  Their customers are responsible for telling Acme what they purchased.  The customer enters into their own systems (ERP or whatever) which widgets they bought from Acme.  Then at some point, their systems emit a record of the sale which needs to go to Acme so Acme can bill them for it.  Obviously, everyone wants this to be as automated as possible, so there needs to be integration between the customer's system and Acme.</p>

<p>Sadly, Acme's sales people are, technically speaking, doormats.  They tell all their prospects, "you can send us the data in whatever format, using whatever protocols, whatever.  You just can't change once it's up and running."</p>

<p>The result is pretty much what you'd expect.  Taking a random sample of 3 customers:</p>
<ul><li>Customer 1: <strong>XML over FTP</strong></li><li>Customer 2: <strong>CSV over HTTP</strong></li><li>Customer 3: <strong>Excel via e-mail</strong></li></ul>


<p>Now on the Acme side, all this has to be converted to a canonical XML format and submitted to the Acme accounting system via JMS.  Then the Acme accounting system does its stuff and sends an XML reply via JMS, with a summary of what it processed (e.g. 3 line items accepted, line item #2 in error, total invoice $123.45).  Finally, that data needs to be formatted into an e-mail, and sent to a contact at the customer in question ("Dear Joyce, we received an invoice on 1/2/08.  We accepted 3 line items totaling $123.45, though there was an error with line items #2 [invalid quantity ordered].  Thank you for your business.  Love, Acme.").</p>

<p>So it turns out Camel can handle all this:</p>
<ul><li>Listen for HTTP, e-mail, and FTP files</li><li>Grab attachments from the e-mail messages</li><li>Convert XML, XLS, and CSV files to a canonical XML format</li><li>read and write JMS messages</li><li>route based on company ID</li><li>format e-mails using Velocity templates</li><li>send outgoing e-mail messages</li></ul>


<h3 id="BookInOnePage-TutorialBackground">Tutorial Background</h3>

<p>This tutorial will cover all that, plus setting up tests along the way.</p>

<p>Before starting, you should be familiar with:</p>
<ul><li>Camel concepts including the <a shape="rect" href="camelcontext.html">CamelContext</a>, <a shape="rect" href="routes.html">Routes</a>, <a shape="rect" href="components.html">Components and Endpoints</a>, and <a shape="rect" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a></li><li>Configuring Camel with the <a shape="rect" href="spring.html#Spring-UsingSpringtoconfiguretheCamelContext">XML</a> or <a shape="rect" href="dsl.html">Java DSL</a></li></ul>


<p>You'll learn:</p>
<ul><li>How to set up a Maven build for a Camel project</li><li>How to transform XML, CSV, and Excel data into a standard XML format with Camel
	<ul><li>How to write POJOs (Plain Old Java Objects), Velocity templates, and XSLT stylesheets that are invoked by Camel routes for message transformation</li></ul>
	</li><li>How to configure simple and complex Routes in Camel, using either the XML or the Java DSL format</li><li>How to set up unit tests that load a Camel configuration and test Camel routes</li><li>How to use Camel's Data Formats to automatically convert data between Java objects and XML, CSV files, etc.</li><li>How to send and receive e-mail from Camel</li><li>How to send and receive JMS messages from Camel</li><li>How to use Enterprise Integration Patterns including Message Router and Pipes and Filters
	<ul><li>How to use various languages to express content-based routing rules in Camel</li></ul>
	</li><li>How to deal with Camel messages, headers, and attachments</li></ul>


<p>You may choose to treat this as a hands-on tutorial, and work through building the code and configuration files yourself.  Each of the sections gives detailed descriptions of the steps that need to be taken to get the components and routes working in Camel, and takes you through tests to make sure they are working as expected.</p>

<p>But each section also links to working copies of the source and configuration files, so if you don't want the hands-on approach, you can simply review and/or download the finished files.</p>

<h3 id="BookInOnePage-High-LevelDiagram">High-Level Diagram</h3>

<p>Here's more or less what the integration process looks like.</p>

<p>First, the input from the customers to Acme:</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="book-in-one-page.data/camel-trading-partners-input.png" data-image-src="/confluence/download/attachments/97175/camel-trading-partners-input.png?version=1&amp;modificationDate=1221300359000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="8929" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="camel-trading-partners-input.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="97175" data-linked-resource-container-version="36"></span></p>

<p>And then, the output from Acme to the customers:</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="book-in-one-page.data/camel-trading-partners-output.png" data-image-src="/confluence/download/attachments/97175/camel-trading-partners-output.png?version=1&amp;modificationDate=1221300359000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="8928" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="camel-trading-partners-output.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="97175" data-linked-resource-container-version="36"></span></p>

<h3 id="BookInOnePage-TutorialTasks">Tutorial Tasks</h3>

<p>To get through this scenario, we're going to break it down into smaller pieces, implement and test those, and then try to assemble the big scenario and test that.</p>

<p>Here's what we'll try to accomplish:</p>
<ol><li>Create a Maven build for the project</li><li>Get sample files for the customer Excel, CSV, and XML input</li><li>Get a sample file for the canonical XML format that Acme's accounting system uses</li><li>Create an XSD for the canonical XML format</li><li>Create JAXB POJOs corresponding to the canonical XSD</li><li>Create an XSLT stylesheet to convert the Customer 1 (XML over FTP) messages to the canonical format</li><li>Create a unit test to ensure that a simple Camel route invoking the XSLT stylesheet works</li><li>Create a POJO that converts a <code>List&lt;List&lt;String&gt;&gt;</code> to the above JAXB POJOs
	<ul><li>Note that Camel can automatically convert CSV input to a List of Lists of Strings representing the rows and columns of the CSV, so we'll use this POJO to handle Customer 2 (CSV over HTTP)</li></ul>
	</li><li>Create a unit test to ensure that a simple Camel route invoking the CSV processing works</li><li>Create a POJO that converts a Customer 3 Excel file to the above JAXB POJOs (using POI to read Excel)</li><li>Create a unit test to ensure that a simple Camel route invoking the Excel processing works</li><li>Create a POJO that reads an input message, takes an attachment off the message, and replaces the body of the message with the attachment
	<ul><li>This is assuming for Customer 3 (Excel over e-mail) that the e-mail contains a single Excel file as an attachment, and the actual e-mail body is throwaway</li></ul>
	</li><li>Build a set of Camel routes to handle the entire input (Customer -&gt; Acme) side of the scenario.</li><li>Build unit tests for the Camel input.</li><li><strong>TODO:</strong> Tasks for the output (Acme -&gt; Customer) side of the scenario</li></ol>


<h2 id="BookInOnePage-Let'sGetStarted!">Let's Get Started!</h2>

<h3 id="BookInOnePage-Step1:InitialMavenbuild">Step 1: Initial Maven build</h3>

<p>We'll use Maven for this project as there will eventually be quite a few dependencies and it's nice to have Maven handle them for us.  You should have a current version of Maven (e.g. 2.0.9) installed.</p>

<p>You can start with a pretty empty project directory and a Maven POM file, or use a simple JAR archetype to create one.</p>

<p>Here's a sample POM.  We've added a dependency on <strong>camel-core</strong>, and set the compile version to 1.5 (so we can use annotations):</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>pom.xml</b></div><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;org.apache.camel.tutorial&lt;/groupId&gt;
    &lt;artifactId&gt;business-partners&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;Camel Business Partners Tutorial&lt;/name&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;artifactId&gt;camel-core&lt;/artifactId&gt;
            &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
            &lt;version&gt;1.4.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;source&gt;1.5&lt;/source&gt;
                    &lt;target&gt;1.5&lt;/target&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
]]></script>
</div></div>

<h3 id="BookInOnePage-Step2:GetSampleFiles">Step 2: Get Sample Files</h3>

<p>You can make up your own if you like, but here are the "off the shelf" ones.  You can save yourself some time by downloading these to <code>src/test/resources</code> in your Maven project.</p>
<ul><li>Customer 1 (XML): <a shape="rect" href="book-in-one-page.data/input-customer1.xml?version=1&amp;modificationDate=1221304897000&amp;api=v2" data-linked-resource-id="8932" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="input-customer1.xml" data-nice-type="XML File" data-linked-resource-content-type="text/xml" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">input-customer1.xml</a></li><li>Customer 2 (CSV): <a shape="rect" href="book-in-one-page.data/input-customer2.csv?version=1&amp;modificationDate=1221304897000&amp;api=v2" data-linked-resource-id="8931" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="input-customer2.csv" data-nice-type="Text File" data-linked-resource-content-type="text/plain" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">input-customer2.csv</a></li><li>Customer 3 (Excel): <a shape="rect" href="book-in-one-page.data/input-customer3.xls?version=1&amp;modificationDate=1221304897000&amp;api=v2" data-linked-resource-id="8930" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="input-customer3.xls" data-nice-type="Excel Spreadsheet" data-linked-resource-content-type="application/vnd.ms-excel" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">input-customer3.xls</a></li><li>Canonical Acme XML Request: <a shape="rect" href="book-in-one-page.data/canonical-acme-request.xml?version=1&amp;modificationDate=1221304897000&amp;api=v2" data-linked-resource-id="8933" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="canonical-acme-request.xml" data-nice-type="XML File" data-linked-resource-content-type="text/xml" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">canonical-acme-request.xml</a></li><li>Canonical Acme XML Response: <strong>TODO</strong></li></ul>


<p>If you look at these files, you'll see that the different input formats use different field names and/or ordering, because of course the sales guys were totally OK with that.  Sigh.</p>

<h3 id="BookInOnePage-Step3:XSDandJAXBBeansfortheCanonicalXMLFormat">Step 3: XSD and JAXB Beans for the Canonical XML Format</h3>

<p>Here's the sample of the canonical XML file:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;invoice xmlns=&quot;http://activemq.apache.org/camel/tutorial/partners/invoice&quot;&gt;
  &lt;partner-id&gt;2&lt;/partner-id&gt;
  &lt;date-received&gt;9/12/2008&lt;/date-received&gt;
  &lt;line-item&gt;
    &lt;product-id&gt;134&lt;/product-id&gt;
    &lt;description&gt;A widget&lt;/description&gt;
    &lt;quantity&gt;3&lt;/quantity&gt;
    &lt;item-price&gt;10.45&lt;/item-price&gt;
    &lt;order-date&gt;6/5/2008&lt;/order-date&gt;
  &lt;/line-item&gt;
  &lt;!-- // more line-item elements here --&gt;
  &lt;order-total&gt;218.82&lt;/order-total&gt;
&lt;/invoice&gt;
]]></script>
</div></div>

<p>If you're ambitions, you can write your own XSD (XML Schema) for files that look like this, and save it to <code>src/main/xsd</code>.</p>

<p><strong>Solution:</strong> If not, you can <a shape="rect" href="book-in-one-page.data/canonical-acme-request.xsd?version=1&amp;modificationDate=1221555594000&amp;api=v2" data-linked-resource-id="8934" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="canonical-acme-request.xsd" data-nice-type="XML File" data-linked-resource-content-type="text/xml" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">download mine</a>, and save that to save it to <code>src/main/xsd</code>.</p>

<h4 id="BookInOnePage-GeneratingJAXBBeans">Generating JAXB Beans</h4>

<p>Down the road we'll want to deal with the XML as Java POJOs.  We'll take a moment now to set up those XML binding POJOs.  So we'll update the Maven POM to generate JAXB beans from the XSD file.</p>

<p>We need a dependency:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;dependency&gt;
    &lt;artifactId&gt;camel-jaxb&lt;/artifactId&gt;
    &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
    &lt;version&gt;1.4.0&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div>

<p>And a plugin configured:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;plugin&gt;
    &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
    &lt;artifactId&gt;jaxb2-maven-plugin&lt;/artifactId&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;goals&gt;
                &lt;goal&gt;xjc&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;
]]></script>
</div></div>

<p>That should do it (it automatically looks for XML Schemas in <code>src/main/xsd</code> to generate beans for).  Run <strong>mvn install</strong> and it should emit the beans into <code>target/generated-sources/jaxb</code>.  Your IDE should see them there, though you may need to update the project to reflect the new settings in the Maven POM.</p>

<h3 id="BookInOnePage-Step4:InitialWorkonCustomer1Input(XMLoverFTP)">Step 4: Initial Work on Customer 1 Input (XML over FTP)</h3>

<p>To get a start on Customer 1, we'll create an XSLT template to convert the Customer 1 sample file into the canonical XML format, write a small Camel route to test it, and build that into a unit test.  If we get through this, we can be pretty sure that the XSLT template is valid and can be run safely in Camel.</p>

<h4 id="BookInOnePage-CreateanXSLTtemplate">Create an XSLT template</h4>

<p>Start with the <a shape="rect" href="book-in-one-page.data/input-customer1.xml?version=1&amp;modificationDate=1221304897000&amp;api=v2" data-linked-resource-id="8932" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="input-customer1.xml" data-nice-type="XML File" data-linked-resource-content-type="text/xml" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">Customer 1 sample input</a>.  You want to create an XSLT template to generate XML like the canonical XML sample above &#8211; an <code>invoice</code> element with <code>line-item</code> elements (one per item in the original XML document).  If you're especially clever, you can populate the current date and order total elements too.</p>

<p><strong>Solution:</strong> My <a shape="rect" href="book-in-one-page.data/XMLConverter.xsl?version=1&amp;modificationDate=1221315500000&amp;api=v2" data-linked-resource-id="8936" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="XMLConverter.xsl" data-nice-type="XML File" data-linked-resource-content-type="text/xml" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">sample XSLT template</a> isn't that smart, but it'll get you going if you don't want to write one of your own.</p>

<h4 id="BookInOnePage-Createaunittest">Create a unit test</h4>

<p>Here's where we get to some meaty Camel work.  We need to:</p>
<ul><li>Set up a unit test</li><li>That loads a Camel configuration</li><li>That has a route invoking our XSLT</li><li>Where the test sends a message to the route</li><li>And ensures that some XML comes out the end of the route</li></ul>


<p>The easiest way to do this is to set up a Spring context that defines the Camel stuff, and then use a base unit test class from Spring that knows how to load a Spring context to run tests against.  So, the procedure is:</p>

<h5 id="BookInOnePage-SetUpaSkeletalCamel/SpringUnitTest">Set Up a Skeletal Camel/Spring Unit Test</h5>
<ol><li>Add dependencies on Camel-Spring, and the Spring test JAR (which will automatically bring in JUnit 3.8.x) to your POM:
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;dependency&gt;
    &lt;artifactId&gt;camel-spring&lt;/artifactId&gt;
    &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
    &lt;version&gt;1.4.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;artifactId&gt;spring-test&lt;/artifactId&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;version&gt;2.5.5&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
]]></script>
</div></div></li><li>Create a new unit test class in <code>src/test/java/your-package-here</code>, perhaps called <code>XMLInputTest.java</code></li><li>Make the test extend Spring's <a shape="rect" class="external-link" href="http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/test/context/junit38/AbstractJUnit38SpringContextTests.html" rel="nofollow">AbstractJUnit38SpringContextTests</a> class, so it can load a Spring context for the test</li><li>Create a Spring context configuration file in <code>src/test/resources</code>, perhaps called <code>XMLInputTest-context.xml</code></li><li>In the unit test class, use the class-level <a shape="rect" class="external-link" href="http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/test/context/ContextConfiguration.html" rel="nofollow">@ContextConfiguration</a> annotation to indicate that a Spring context should be loaded
	<ul><li>By default, this looks for a Context configuration file called <code>TestClassName-context.xml</code> in a subdirectory corresponding to the package of the test class.  For instance, if your test class was <code>org.apache.camel.tutorial.XMLInputTest</code>, it would look for <code>org/apache/camel/tutorial/XMLInputTest-context.xml</code></li><li>To override this default, use the <strong>locations</strong> attribute on the @ContextConfiguration annotation to provide specific context file locations (starting each path with a / if you don't want it to be relative to the package directory).  My solution does this so I can put the context file directly in <code>src/test/resources</code> instead of in a package directory under there.</li></ul>
	</li><li>Add a <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/CamelContext.html">CamelContext</a> instance variable to the test class, with the <a shape="rect" class="external-link" href="http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/beans/factory/annotation/Autowired.html" rel="nofollow">@Autowired</a> annotation.  That way Spring will automatically pull the CamelContext out of the Spring context and inject it into our test class.</li><li>Add a <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/ProducerTemplate.html">ProducerTemplate</a> instance variable and a <code>setUp</code> method that instantiates it from the CamelContext.  We'll use the ProducerTemplate later to send messages to the route.
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
protected ProducerTemplate&lt;Exchange&gt; template;

protected void setUp() throws Exception {
    super.setUp();
    template = camelContext.createProducerTemplate();
}
]]></script>
</div></div></li><li>Put in an empty test method just for the moment (so when we run this we can see that "1 test succeeded")</li><li>Add the Spring <a shape="rect" class="external-link" href="http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-factory-metadata" rel="nofollow">&lt;beans&gt;</a> element (including the <a shape="rect" class="external-link" href="http://activemq.apache.org/camel/xml-reference.html">Camel Namespace</a>) with an empty <a shape="rect" href="spring.html#Spring-UsingSpringtoconfiguretheCamelContext">&lt;camelContext&gt;</a> element to the Spring context, like this:
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
                               http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
                           http://activemq.apache.org/camel/schema/spring
                               http://activemq.apache.org/camel/schema/spring/camel-spring-1.4.0.xsd&quot;&gt;

    &lt;camelContext id=&quot;camel&quot; xmlns=&quot;http://activemq.apache.org/camel/schema/spring&quot;&gt;
    &lt;/camelContext&gt;
&lt;/beans&gt;
]]></script>
</div></div></li></ol>


<p>Test it by running <strong>mvn install</strong> and make sure there are no build errors.  So far it doesn't test much; just that your project and test and source files are all organized correctly, and the one empty test method completes successfully.</p>

<p><strong>Solution:</strong> Your test class might look something like this:</p>
<ul><li>src/test/java/org/apache/camel/tutorial/<a shape="rect" href="book-in-one-page.data/empty-XMLInputTest.java?version=3&amp;modificationDate=1221634419000&amp;api=v2" data-linked-resource-id="8942" data-linked-resource-version="3" data-linked-resource-type="attachment" data-linked-resource-default-alias="empty-XMLInputTest.java" data-nice-type="Text File" data-linked-resource-content-type="text/plain" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">XMLInputTest.java</a></li><li>src/test/resources/XMLInputTest-context.xml (same as just above)</li></ul>


<h5 id="BookInOnePage-FleshOuttheUnitTest">Flesh Out the Unit Test</h5>

<p>So now we're going to write a Camel route that applies the XSLT to the sample Customer 1 input file, and makes sure that some XML output comes out:</p>
<ol><li>Save the <a shape="rect" href="book-in-one-page.data/input-customer1.xml?version=1&amp;modificationDate=1221304897000&amp;api=v2" data-linked-resource-id="8932" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="input-customer1.xml" data-nice-type="XML File" data-linked-resource-content-type="text/xml" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">input-customer1.xml</a> file to <code>src/test/resources</code></li><li>Save your XSLT file (created in the previous step) to <code>src/main/resources</code></li><li>Write a Camel Route, either right in the Spring XML, or using the Java DSL (in another class under <code>src/test/java</code> somewhere).  This route should use the <a shape="rect" href="pipes-and-filters.html">Pipes and Filters</a> integration pattern to:
	<ol><li>Start from the endpoint <a shape="rect" href="direct.html">direct:start</a> (which lets the test conveniently pass messages into the route)</li><li>Call the endpoint <a shape="rect" href="xslt.html">xslt:YourXSLTFile.xsl</a> (to transform the message with the specified XSLT template)</li><li>Send the result to the endpoint <a shape="rect" href="mock.html">mock:finish</a> (which lets the test verify the route output)</li></ol>
	</li><li>Add a test method to the unit test class that:
	<ol><li>Get a reference to the Mock endpoint <code>mock:finish</code> using code like this:
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
MockEndpoint finish = MockEndpoint.resolve(camelContext, &quot;mock:finish&quot;);
]]></script>
</div></div></li><li>Set the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#setExpectedMessageCount(int)">expectedMessageCount</a> on that endpoint to 1</li><li>Get a reference to the Customer 1 input file, using code like this:
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
InputStream in = XMLInputTest.class.getResourceAsStream(&quot;/input-partner1.xml&quot;);
assertNotNull(in);
]]></script>
</div></div></li><li>Send that InputStream as a message to the <code>direct:start</code> endpoint, using code like this:
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    template.sendBody(&quot;direct:start&quot;, in);
]]></script>
</div></div>
Note that we can send the sample file body in several formats (File, InputStream, String, etc.) but in this case an InputStream is pretty convenient.</li><li>Ensure that the message made it through the route to the final endpoint, by testing all configured Mock endpoints <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#assertIsSatisfied(org.apache.camel.CamelContext)">like this</a>:
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
MockEndpoint.assertIsSatisfied(camelContext);
]]></script>
</div></div></li><li>If you like, inspect the final message body using some code like <code>finish.getExchanges().get(0).getIn().getBody()</code>.
		<ul><li>If you do this, you'll need to know what format that body is &#8211; String, byte array, InputStream, etc.</li></ul>
		</li></ol>
	</li><li>Run your test with <strong>mvn install</strong> and make sure the build completes successfully.</li></ol>


<p><strong>Solution:</strong> Your finished test might look something like this:</p>
<ul><li>src/test/java/org/apache/camel/tutorial/<a shape="rect" href="book-in-one-page.data/XMLInputTest.java?version=3&amp;modificationDate=1221637330000&amp;api=v2" data-linked-resource-id="8945" data-linked-resource-version="3" data-linked-resource-type="attachment" data-linked-resource-default-alias="XMLInputTest.java" data-nice-type="Text File" data-linked-resource-content-type="text/plain" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">XMLInputTest.java</a></li><li>For XML Configuration:
	<ul><li>src/test/resources/<a shape="rect" href="book-in-one-page.data/XMLInputTest-context.xml?version=1&amp;modificationDate=1221560232000&amp;api=v2" data-linked-resource-id="8944" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="XMLInputTest-context.xml" data-nice-type="XML File" data-linked-resource-content-type="text/xml" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">XMLInputTest-context.xml</a></li></ul>
	</li><li>Or, for Java DSL Configuration:
	<ul><li>src/test/resources/<a shape="rect" href="book-in-one-page.data/XMLInputTest-dsl-context.xml?version=1&amp;modificationDate=1221627131000&amp;api=v2" data-linked-resource-id="8950" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="XMLInputTest-dsl-context.xml" data-nice-type="XML File" data-linked-resource-content-type="text/xml" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">XMLInputTest-dsl-context.xml</a></li><li>src/test/java/org/apache/camel/tutorial/routes/<a shape="rect" href="book-in-one-page.data/XMLInputTestRoute.java?version=1&amp;modificationDate=1221627131000&amp;api=v2" data-linked-resource-id="8949" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="XMLInputTestRoute.java" data-nice-type="Text File" data-linked-resource-content-type="text/plain" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">XMLInputTestRoute.java</a></li></ul>
	</li></ul>


<div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Test Base Class</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>Once your test class is working, you might want to extract things like the @Autowired CamelContext, the ProducerTemplate, and the setUp method to a custom base class that you extend with your other tests.</p></div></div>

<h3 id="BookInOnePage-Step5:InitialWorkonCustomer2Input(CSVoverHTTP)">Step 5: Initial Work on Customer 2 Input (CSV over HTTP)</h3>

<p>To get a start on Customer 2, we'll create a POJO to convert the Customer 2 sample CSV data into the JAXB POJOs representing the canonical XML format, write a small Camel route to test it, and build that into a unit test. If we get through this, we can be pretty sure that the CSV conversion and JAXB handling is valid and can be run safely in Camel.</p>

<h4 id="BookInOnePage-CreateaCSV-handlingPOJO">Create a CSV-handling POJO</h4>

<p>To begin with, <a shape="rect" href="csv.html">CSV is a known data format</a> in Camel.  Camel can convert a CSV file to a List (representing rows in the CSV) of Lists (representing cells in the row) of Strings (the data for each cell).  That means our POJO can just assume the data coming in is of type <code>List&lt;List&lt;String&gt;&gt;</code>, and we can declare a method with that as the argument.</p>

<p>Looking at the JAXB code in <code>target/generated-sources/jaxb</code>, it looks like an <code>Invoice</code> object represents the whole document, with a nested list of LineItemType objects for the line items.  Therefore our POJO method will return an <code>Invoice</code> (a document in the canonical XML format).</p>

<p>So to implement the CSV-to-JAXB POJO, we need to do something like this:</p>
<ol><li>Create a new class under <code>src/main/java</code>, perhaps called <code>CSVConverterBean</code>.</li><li>Add a method, with one argument of type <code>List&lt;List&lt;String&gt;&gt;</code> and the return type <code>Invoice</code>
	<ul><li>You may <a shape="rect" href="bean.html#Bean-UsingAnnotationstobindparameterstotheExchange">annotate</a> the argument with <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Body.html">@Body</a> to specifically designate it as the body of the incoming message</li></ul>
	</li><li>In the method, the logic should look roughly like this:
	<ol><li>Create a new <code>Invoice</code>, using the method on the generated <code>ObjectFactory</code> class</li><li>Loop through all the rows in the incoming CSV (the outer <code>List</code>)</li><li>Skip the first row, which contains headers (column names)</li><li>For the other rows:
		<ol><li>Create a new <code>LineItemType</code> (using the <code>ObjectFactory</code> again)</li><li>Pick out all the cell values (the Strings in the inner <code>List</code>) and put them into the correct fields of the <code>LineItemType</code>
			<ul><li>Not all of the values will actually go into the line item in this example</li><li>You may hardcode the column ordering based on the sample data file, or else try to read it dynamically from the headers in the first line</li><li>Note that you'll need to use a JAXB <code>DatatypeFactory</code> to create the <code>XMLGregorianCalendar</code> values that JAXB uses for the <code>date</code> fields in the XML &#8211; which probably means using a <code>SimpleDateFormat</code> to parse the date and setting that date on a <code>GregorianCalendar</code></li></ul>
			</li><li>Add the line item to the invoice</li></ol>
		</li><li>Populate the partner ID, date of receipt, and order total on the <code>Invoice</code></li><li>Throw any exceptions out of the method, so Camel knows something went wrong</li><li>Return the finished <code>Invoice</code></li></ol>
	</li></ol>


<p><strong>Solution:</strong> Here's an example of what the <a shape="rect" href="book-in-one-page.data/CSVConverterBean.java?version=1&amp;modificationDate=1221634021000&amp;api=v2" data-linked-resource-id="8951" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="CSVConverterBean.java" data-nice-type="Text File" data-linked-resource-content-type="text/plain" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">CSVConverterBean</a> might look like.</p>

<h4 id="BookInOnePage-Createaunittest.1">Create a unit test</h4>

<p>Start with a simple test class and test Spring context like last time, perhaps based on the name <code>CSVInputTest</code>:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>CSVInputTest.java</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
/**
 * A test class the ensure we can convert Partner 2 CSV input files to the
 * canonical XML output format, using JAXB POJOs.
 */
@ContextConfiguration(locations = &quot;/CSVInputTest-context.xml&quot;)
public class CSVInputTest extends AbstractJUnit38SpringContextTests {
    @Autowired
    protected CamelContext camelContext;
    protected ProducerTemplate&lt;Exchange&gt; template;

    protected void setUp() throws Exception {
        super.setUp();
        template = camelContext.createProducerTemplate();
    }

    public void testCSVConversion() {
        // TODO
    }
}
]]></script>
</div></div>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>CSVInputTest-context.xml</b></div><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
                               http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
                           http://activemq.apache.org/camel/schema/spring
                               http://activemq.apache.org/camel/schema/spring/camel-spring-1.4.0.xsd&quot;&gt;

    &lt;camelContext id=&quot;camel&quot; xmlns=&quot;http://activemq.apache.org/camel/schema/spring&quot;&gt;
        &lt;!-- TODO --&gt;
    &lt;/camelContext&gt;
&lt;/beans&gt;
]]></script>
</div></div>

<p>Now the meaty part is to flesh out the test class and write the Camel routes.</p>

<ol><li>Update the Maven POM to include <a shape="rect" href="csv.html">CSV</a> <a shape="rect" href="data-format.html">Data Format</a> support:
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;dependency&gt;
    &lt;artifactId&gt;camel-csv&lt;/artifactId&gt;
    &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
    &lt;version&gt;1.4.0&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div></li><li>Write the routes (right in the Spring XML context, or using the Java DSL) for the CSV conversion process, again using the <a shape="rect" href="pipes-and-filters.html">Pipes and Filters</a> pattern:
	<ol><li>Start from the endpoint <a shape="rect" href="direct.html">direct:CSVstart</a> (which lets the test conveniently pass messages into the route).  We'll name this differently than the starting point for the previous test, in case you use the Java DSL and put all your routes in the same package (which would mean that each test would load the DSL routes for several tests.)</li><li>This time, there's a little preparation to be done.  Camel doesn't know that the initial input is a CSV, so it won't be able to convert it to the expected <code>List&lt;List&lt;String&gt;&gt;</code> without a little hint.  For that, we need an <a shape="rect" href="data-format.html#DataFormat-Unmarshalling">unmarshal</a> transformation in the route.  The <code>unmarshal</code> method (in the DSL) or element (in the XML) takes a child indicating the format to unmarshal; in this case that should be <code>csv</code>.</li><li>Next invoke the POJO to transform the message with a <a shape="rect" href="bean.html">bean:CSVConverter</a> endpoint</li><li>As before, send the result to the endpoint <a shape="rect" href="mock.html">mock:finish</a> (which lets the test verify the route output)</li><li>Finally, we need a Spring <code>&lt;bean&gt;</code> element in the Spring context XML file (but outside the <code>&lt;camelContext&gt;</code> element) to define the Spring bean that our route invokes.  This Spring bean should have a <code>name</code> attribute that matches the name used in the <code>bean</code> endpoint (<code>CSVConverter</code> in the example above), and a <code>class</code> attribute that points to the CSV-to-JAXB POJO class you wrote above (such as, <code>org.apache.camel.tutorial.CSVConverterBean</code>).  When Spring is in the picture, any <code>bean</code> endpoints look up Spring beans with the specified name.</li></ol>
	</li><li>Write a test method in the test class, which should look very similar to the previous test class:
	<ol><li>Get the MockEndpoint for the final endpoint, and tell it to expect one message</li><li>Load the Partner 2 sample CSV file from the ClassPath, and send it as the body of a message to the starting endpoint</li><li>Verify that the final MockEndpoint is satisfied (that is, it received one message) and examine the message body if you like
		<ul><li>Note that we didn't <a shape="rect" href="data-format.html#DataFormat-Marshalling">marshal</a> the JAXB POJOs to XML in this test, so the final message should contain an <code>Invoice</code> as the body.  You could write a simple line of code to get the Exchange (and Message) from the MockEndpoint to confirm that.</li></ul>
		</li></ol>
	</li><li>Run this new test with <strong>mvn install</strong> and make sure it passes and the build completes successfully.</li></ol>


<p><strong>Solution:</strong> Your finished test might look something like this:</p>
<ul><li>src/test/java/org/apache/camel/tutorial/<a shape="rect" href="book-in-one-page.data/CSVInputTest.java?version=2&amp;modificationDate=1221678956000&amp;api=v2" data-linked-resource-id="8958" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="CSVInputTest.java" data-nice-type="Text File" data-linked-resource-content-type="text/plain" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">CSVInputTest.java</a></li><li>For XML Configuration:
	<ul><li>src/test/resources/<a shape="rect" href="book-in-one-page.data/CSVInputTest-context.xml?version=2&amp;modificationDate=1221678956000&amp;api=v2" data-linked-resource-id="8959" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="CSVInputTest-context.xml" data-nice-type="XML File" data-linked-resource-content-type="text/xml" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">CSVInputTest-context.xml</a></li></ul>
	</li><li>Or, for Java DSL Configuration:
	<ul><li>src/test/resources/<a shape="rect" href="book-in-one-page.data/CSVInputTest-dsl-context.xml?version=1&amp;modificationDate=1221678956000&amp;api=v2" data-linked-resource-id="8962" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="CSVInputTest-dsl-context.xml" data-nice-type="XML File" data-linked-resource-content-type="text/xml" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">CSVInputTest-dsl-context.xml</a></li><li>src/test/java/org/apache/camel/tutorial/routes/<a shape="rect" href="book-in-one-page.data/CSVInputTestRoute.java?version=2&amp;modificationDate=1221679042000&amp;api=v2" data-linked-resource-id="8960" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="CSVInputTestRoute.java" data-nice-type="Text File" data-linked-resource-content-type="text/plain" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">CSVInputTestRoute.java</a></li></ul>
	</li></ul>



<h3 id="BookInOnePage-Step6:InitialWorkonCustomer3Input(Excelovere-mail)">Step 6: Initial Work on Customer 3 Input (Excel over e-mail)</h3>

<p>To get a start on Customer 3, we'll create a POJO to convert the Customer 3 sample Excel data into the JAXB POJOs representing the canonical XML format, write a small Camel route to test it, and build that into a unit test. If we get through this, we can be pretty sure that the Excel conversion and JAXB handling is valid and can be run safely in Camel.</p>

<h4 id="BookInOnePage-CreateanExcel-handlingPOJO">Create an Excel-handling POJO</h4>

<p>Camel does not have a data format handler for Excel by default.  We have two options &#8211; create an Excel <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/index.html">DataFormat</a> (so Camel can convert Excel spreadsheets to something like the CSV <code>List&lt;List&lt;String&gt;&gt;</code> automatically), or create a POJO that can translate Excel data manually.  For now, the second approach is easier (if we go the <code>DataFormat</code> route, we need code to both read and write Excel files, whereas otherwise read-only will do).</p>

<p>So, we need a POJO with a method that takes something like an <code>InputStream</code> or <code>byte[]</code> as an argument, and returns in <code>Invoice</code> as before.  The process should look something like this:</p>
<ol><li>Update the Maven POM to include <a shape="rect" class="external-link" href="http://poi.apache.org/">POI</a> support:
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;dependency&gt;
    &lt;artifactId&gt;poi&lt;/artifactId&gt;
    &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
    &lt;version&gt;3.1-FINAL&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div></li><li>Create a new class under <code>src/main/java</code>, perhaps called <code>ExcelConverterBean</code>.</li><li>Add a method, with one argument of type <code>InputStream</code> and the return type <code>Invoice</code>
	<ul><li>You may <a shape="rect" href="bean.html#Bean-UsingAnnotationstobindparameterstotheExchange">annotate</a> the argument with <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Body.html">@Body</a> to specifically designate it as the body of the incoming message</li></ul>
	</li><li>In the method, the logic should look roughly like this:
	<ol><li>Create a new <code>Invoice</code>, using the method on the generated <code>ObjectFactory</code> class</li><li>Create a new <a shape="rect" class="external-link" href="http://poi.apache.org/apidocs/org/apache/poi/hssf/usermodel/HSSFWorkbook.html">HSSFWorkbook</a> from the <code>InputStream</code>, and get the <a shape="rect" class="external-link" href="http://poi.apache.org/apidocs/org/apache/poi/hssf/usermodel/HSSFWorkbook.html#getSheetAt(int)">first sheet</a> from it</li><li>Loop through <a shape="rect" class="external-link" href="http://poi.apache.org/apidocs/org/apache/poi/hssf/usermodel/HSSFSheet.html#rowIterator()">all the rows</a> in the sheet</li><li>Skip the first row, which contains headers (column names)</li><li>For the other rows:
		<ol><li>Create a new <code>LineItemType</code> (using the <code>ObjectFactory</code> again)</li><li>Pick out <a shape="rect" class="external-link" href="http://poi.apache.org/apidocs/org/apache/poi/hssf/usermodel/HSSFRow.html#cellIterator()">all the cell values</a> and put them into the correct fields of the <code>LineItemType</code> (you'll need some data type conversion logic)
			<ul><li>Not all of the values will actually go into the line item in this example</li><li>You may hardcode the column ordering based on the sample data file, or else try to read it dynamically from the headers in the first line</li><li>Note that you'll need to use a JAXB <code>DatatypeFactory</code> to create the <code>XMLGregorianCalendar</code> values that JAXB uses for the <code>date</code> fields in the XML &#8211; which probably means setting the <a shape="rect" class="external-link" href="http://poi.apache.org/apidocs/org/apache/poi/hssf/usermodel/HSSFCell.html#getDateCellValue()">date from a date cell</a> on a <code>GregorianCalendar</code></li></ul>
			</li><li>Add the line item to the invoice</li></ol>
		</li><li>Populate the partner ID, date of receipt, and order total on the <code>Invoice</code></li><li>Throw any exceptions out of the method, so Camel knows something went wrong</li><li>Return the finished <code>Invoice</code></li></ol>
	</li></ol>


<p><strong>Solution:</strong> Here's an example of what the <a shape="rect" href="book-in-one-page.data/ExcelConverterBean.java?version=1&amp;modificationDate=1221702252000&amp;api=v2" data-linked-resource-id="8968" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="ExcelConverterBean.java" data-nice-type="Text File" data-linked-resource-content-type="text/plain" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">ExcelConverterBean</a> might look like.</p>

<h4 id="BookInOnePage-Createaunittest.2">Create a unit test</h4>

<p>The unit tests should be pretty familiar now.  The test class and context for the Excel bean should be quite similar to the CSV bean.</p>
<ol><li>Create the basic test class and corresponding Spring Context XML configuration file</li><li>The XML config should look a lot like the CSV test, except:
	<ul><li>Remember to use a different start endpoint name if you're using the Java DSL and not use separate packages per test</li><li>You don't need the <code>unmarshal</code> step since the Excel POJO takes the raw <code>InputStream</code> from the source endpoint</li><li>You'll declare a <code>&lt;bean&gt;</code> and endpoint for the Excel bean prepared above instead of the CSV bean</li></ul>
	</li><li>The test class should look a lot like the CSV test, except use the right input file name and start endpoint name.</li></ol>


<div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Logging</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>You may notice that your tests emit a lot less output all of a sudden.  The dependency on POI brought in Log4J and configured commons-logging to use it, so now we need a <a shape="rect" href="book-in-one-page.data/log4j.properties?version=1&amp;modificationDate=1221732568000&amp;api=v2" data-linked-resource-id="8969" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="log4j.properties" data-nice-type="Text File" data-linked-resource-content-type="text/plain" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">log4j.properties</a> file to configure log output.  You can use the attached one (snarfed from ActiveMQ) or write your own; either way save it to <code>src/main/resources</code> to ensure you continue to see log output.</p></div></div>

<p><strong>Solution:</strong> Your finished test might look something like this:</p>
<ul><li>src/test/java/org/apache/camel/tutorial/<a shape="rect" href="book-in-one-page.data/ExcelInputTest.java?version=1&amp;modificationDate=1221732213000&amp;api=v2" data-linked-resource-id="8970" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="ExcelInputTest.java" data-nice-type="Text File" data-linked-resource-content-type="text/plain" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">ExcelInputTest.java</a></li><li>For XML Configuration:
	<ul><li>src/test/resources/<a shape="rect" href="book-in-one-page.data/ExcelInputTest-context.xml?version=1&amp;modificationDate=1221732213000&amp;api=v2" data-linked-resource-id="8971" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="ExcelInputTest-context.xml" data-nice-type="XML File" data-linked-resource-content-type="text/xml" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">ExcelInputTest-context.xml</a></li></ul>
	</li><li>Or, for Java DSL Configuration:
	<ul><li>src/test/resources/<a shape="rect" href="book-in-one-page.data/ExcelInputTest-dsl-context.xml?version=1&amp;modificationDate=1221732432000&amp;api=v2" data-linked-resource-id="8973" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="ExcelInputTest-dsl-context.xml" data-nice-type="XML File" data-linked-resource-content-type="text/xml" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">ExcelInputTest-dsl-context.xml</a></li><li>src/test/java/org/apache/camel/tutorial/routes/<a shape="rect" href="book-in-one-page.data/ExcelInputTestRoute.java?version=1&amp;modificationDate=1221732432000&amp;api=v2" data-linked-resource-id="8972" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="ExcelInputTestRoute.java" data-nice-type="Text File" data-linked-resource-content-type="text/plain" data-linked-resource-container-id="97175" data-linked-resource-container-version="36">ExcelInputTestRoute.java</a></li></ul>
	</li></ul>



<h3 id="BookInOnePage-Step7:PutthisalltogetherintoCamelroutesfortheCustomerInput">Step 7: Put this all together into Camel routes for the Customer Input</h3>

<p>With all the data type conversions working, the next step is to write the real routes that listen for HTTP, FTP, or e-mail input, and write the final XML output to an ActiveMQ queue.  Along the way these routes will use the data conversions we've developed above.</p>

<p>So we'll create 3 routes to start with, as shown in the diagram back at the beginning:</p>
<ol><li>Accept XML orders over FTP from Customer 1 (we'll assume the FTP server dumps files in a local directory on the Camel machine)</li><li>Accept CSV orders over HTTP from Customer 2</li><li>Accept Excel orders via e-mail from Customer 3 (we'll assume the messages are sent to an account we can access via IMAP)</li></ol>


<p>...</p>

<h3 id="BookInOnePage-Step8:CreateaunittestfortheCustomerInputRoutes">Step 8: Create a unit test for the Customer Input Routes</h3>
<div class="chapter" id="chapter-languages-supported-Appendix"></div>
<h1 id="BookInOnePage-LanguagesSupportedAppendix">Languages Supported Appendix</h1>

<p>To support flexible and powerful <a shape="rect" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a> Camel supports various Languages to create an <a shape="rect" href="expression.html">Expression</a> or <a shape="rect" href="predicate.html">Predicate</a> within either the <a shape="rect" href="dsl.html">Routing Domain Specific Language</a> or the <a shape="rect" href="xml-configuration.html">Xml Configuration</a>. The following languages are supported</p>

<h2 id="BookInOnePage-BeanLanguage">Bean Language</h2><p>The purpose of the Bean Language is to be able to implement an <a shape="rect" href="expression.html">Expression</a> or <a shape="rect" href="predicate.html">Predicate</a> using a simple method on a bean. The bean name is resolved using a <a shape="rect" href="registry.html">Registry</a>, such as the <a shape="rect" href="spring.html">Spring</a>&#160;<strong><code>ApplicationContext</code></strong>, then a method is invoked to evaluate the <a shape="rect" href="expression.html">Expression</a> or <a shape="rect" href="predicate.html">Predicate</a>. If no method name is provided then one is chosen using the rules for <a shape="rect" href="bean-binding.html">Bean Binding</a>; using the type of the message body and using any annotations on the bean methods.</p><p>The <a shape="rect" href="bean-binding.html">Bean Binding</a> rules are used to bind the <a shape="rect" href="message.html">Message</a> Exchange to the method parameters; so you can annotate the bean to extract headers or other expressions such as <a shape="rect" href="xpath.html">XPath</a> or <a shape="rect" href="xquery.html">XQuery</a> from the message.</p><h3 id="BookInOnePage-UsingBeanExpressionsinJava">Using Bean Expressions in Java</h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;activemq:topic:OrdersTopic&quot;)
  .filter().method(&quot;myBean&quot;, &quot;isGoldCustomer&quot;)
    .to(&quot;activemq:BigSpendersQueue&quot;);
]]></script>
</div></div><h3 id="BookInOnePage-UsingBeanExpressionsinSpringXML">Using Bean Expressions in Spring XML</h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;route&gt;
  &lt;from uri=&quot;activemq:topic:OrdersTopic&quot;/&gt;
  &lt;filter&gt;
    &lt;method ref=&quot;myBean&quot; method=&quot;isGoldCustomer&quot;/&gt;
    &lt;to uri=&quot;activemq:BigSpendersQueue&quot;/&gt;
  &lt;/filter&gt;
&lt;/route&gt;
]]></script>
</div></div><div class="confluence-information-macro confluence-information-macro-warning"><p class="title">Bean Attribute Now Deprecated</p><span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>The <strong><code>bean</code></strong> attribute of the method expression element is now deprecated. Use the <strong><code>ref</code></strong> attribute instead.</p></div></div><h3 id="BookInOnePage-WritingtheExpressionBean">Writing the Expression Bean</h3><p>The bean in the above examples is just any old Java Bean with a method called&#160;<strong><code>isGoldCustomer()</code></strong> that returns some object that is easily converted to a <strong><code>boolean</code></strong> value in this case, as its used as a predicate.</p><p>Example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public class MyBean {
  public boolean isGoldCustomer(Exchange exchange) {
  	 // ...
  }
}
]]></script>
</div></div><p>We can also use the <a shape="rect" href="bean-integration.html">Bean Integration</a> annotations.</p><p>Example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public boolean isGoldCustomer(String body) {...}
]]></script>
</div></div><p>or</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public boolean isGoldCustomer(@Header(name = &quot;foo&quot;) Integer fooHeader) {...}
]]></script>
</div></div><p>So you can bind parameters of the method to the Exchange, the <a shape="rect" href="message.html">Message</a> or individual headers, properties, the body or other expressions.</p><h3 id="BookInOnePage-Non-RegistryBeans">Non-Registry Beans</h3><p>The <a shape="rect" href="bean-language.html">Bean Language</a> also supports invoking beans that isn't registered in the <a shape="rect" href="registry.html">Registry</a>. This is usable for quickly to invoke a bean from Java DSL where you don't need to register the bean in the <a shape="rect" href="registry.html">Registry</a> such as the <a shape="rect" href="spring.html">Spring</a> <strong><code>ApplicationContext</code></strong>. Camel can instantiate the bean and invoke the method if given a class or invoke an already existing instance.</p><p>Example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;activemq:topic:OrdersTopic&quot;)
  .filter().expression(BeanLanguage(MyBean.class, &quot;isGoldCustomer&quot;))
  .to(&quot;activemq:BigSpendersQueue&quot;);
]]></script>
</div></div><p>The 2nd parameter <strong><code>isGoldCustomer</code></strong> is an optional parameter to explicit set the method name to invoke. If not provided Camel will try to invoke the most suitable method. If case of ambiguity Camel will thrown an Exception. In these situations the 2nd parameter can solve this problem. Also the code is more readable if the method name is provided. The 1st parameter can also be an existing instance of a Bean such as:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[private MyBean my;

from(&quot;activemq:topic:OrdersTopic&quot;)
  .filter().expression(BeanLanguage.bean(my, &quot;isGoldCustomer&quot;))
  .to(&quot;activemq:BigSpendersQueue&quot;);
]]></script>
</div></div><p>In <strong>Camel 2.2</strong>: you can avoid the <strong><code>BeanLanguage</code></strong> and have it just as:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[private MyBean my;

from(&quot;activemq:topic:OrdersTopic&quot;)
  .filter().expression(bean(my, &quot;isGoldCustomer&quot;))
  .to(&quot;activemq:BigSpendersQueue&quot;);
]]></script>
</div></div><p>Which also can be done in a bit shorter and nice way:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[private MyBean my;

from(&quot;activemq:topic:OrdersTopic&quot;)
  .filter().method(my, &quot;isGoldCustomer&quot;)
  .to(&quot;activemq:BigSpendersQueue&quot;);
]]></script>
</div></div><h3 id="BookInOnePage-OtherExamples">Other Examples</h3><p>We have some test cases you can look at if it'll help</p><ul><li><a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/MethodFilterTest.java">MethodFilterTest </a> is a JUnit test case showing the Java <a shape="rect" href="dsl.html">DSL</a> use of the bean expression being used in a filter</li><li><a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-spring/src/test/resources/org/apache/camel/spring/processor/aggregator.xml">aggregator.xml</a> is a Spring XML test case for the <a shape="rect" href="aggregator.html">Aggregator</a> which uses a bean method call to test for the completion of the aggregation.</li></ul><h3 id="BookInOnePage-Dependencies">Dependencies</h3><p>The Bean language is part of <strong><code>camel-core</code></strong>.</p>
<h2 id="BookInOnePage-ConstantExpressionLanguage">Constant Expression Language</h2><p>The Constant Expression Language is really just a way to specify constant strings as a type of expression.</p><h3 id="BookInOnePage-Exampleusage">Example usage</h3><p>The&#160;<strong><code>setHeader</code></strong> element of the Spring DSL can utilize a constant expression like:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;route&gt;
  &lt;from uri=&quot;seda:a&quot;/&gt;
  &lt;setHeader headerName=&quot;theHeader&quot;&gt;
    &lt;constant&gt;the value&lt;/constant&gt;        
  &lt;/setHeader&gt;
  &lt;to uri=&quot;mock:b&quot;/&gt;     
&lt;/route&gt;
]]></script>
</div></div><p>In this case, the <a shape="rect" href="message.html">Message</a> coming from the&#160;<strong><code>seda:a</code></strong> <a shape="rect" href="endpoint.html">Endpoint</a> will have&#160;<strong><code>theHeader</code></strong> header set to the constant value <strong><code>the value</code></strong>.</p><p>And the same example using Java DSL:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;seda:a&quot;)
  .setHeader(&quot;theHeader&quot;, constant(&quot;the value&quot;))
  .to(&quot;mock:b&quot;);
]]></script>
</div></div><h3 id="BookInOnePage-Dependencies.1">Dependencies</h3><p>The Constant language is part of <strong><code>camel-core</code></strong>.</p> 
<h2 id="BookInOnePage-EL">EL</h2><p>Camel supports the unified JSP and JSF Expression Language via the <a shape="rect" class="external-link" href="http://juel.sourceforge.net/" rel="nofollow">JUEL</a> to allow an <a shape="rect" href="expression.html">Expression</a> or <a shape="rect" href="predicate.html">Predicate</a> to be used in the <a shape="rect" href="dsl.html">DSL</a> or <a shape="rect" href="xml-configuration.html">Xml Configuration</a>.</p><p>For example you could use EL inside a <a shape="rect" href="message-filter.html">Message Filter</a> in XML</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;route&gt;
  &lt;from uri=&quot;seda:foo&quot;/&gt;
  &lt;filter&gt;
    &lt;el&gt;${in.headers.foo == &#39;bar&#39;}&lt;/el&gt;
    &lt;to uri=&quot;seda:bar&quot;/&gt;
  &lt;/filter&gt;
&lt;/route&gt;
]]></script>
</div></div><p>You could also use slightly different syntax, e.g. if the header name is not a valid identifier:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;route&gt;
  &lt;from uri=&quot;seda:foo&quot;/&gt;
  &lt;filter&gt;
    &lt;el&gt;${in.headers[&#39;My Header&#39;] == &#39;bar&#39;}&lt;/el&gt;
    &lt;to uri=&quot;seda:bar&quot;/&gt;
  &lt;/filter&gt;
&lt;/route&gt;
]]></script>
</div></div><p>You could use EL to create an <a shape="rect" href="predicate.html">Predicate</a> in a <a shape="rect" href="message-filter.html">Message Filter</a> or as an <a shape="rect" href="expression.html">Expression</a> for a <a shape="rect" href="recipient-list.html">Recipient List</a></p><h3 id="BookInOnePage-Variables">Variables</h3><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Variable</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>exchange</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Exchange</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the Exchange object</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>in</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Message</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the exchange.in message</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>out</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Message</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the exchange.out message</p></td></tr></tbody></table></div><h3 id="BookInOnePage-Samples">Samples</h3><p>You can use EL dot notation to invoke operations. If you for instance have a body that contains a POJO that has a <code>getFamiliyName</code> method then you can construct the syntax as follows:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&quot;${in.body.familyName}&quot;
]]></script>
</div></div><h3 id="BookInOnePage-Dependencies.2">Dependencies</h3><p>To use EL in your camel routes you need to add the a dependency on <strong>camel-juel</strong> which implements the EL language.</p><p>If you use maven you could just add the following to your pom.xml, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-juel&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div><p>Otherwise you'll also need to include <a shape="rect" class="external-link" href="http://repo2.maven.org/maven2/de/odysseus/juel/juel/2.1.3/juel-2.1.3.jar" rel="nofollow">JUEL</a>.</p>
<h2 id="BookInOnePage-HeaderExpressionLanguage">Header Expression Language</h2>

<p>The Header Expression Language allows you to extract values of named headers.</p>

<h3 id="BookInOnePage-Exampleusage.1">Example usage</h3>

<p>The recipientList element of the Spring DSL can utilize a header expression like: </p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;route&gt;
  &lt;from uri=&quot;direct:a&quot; /&gt;
  &lt;!-- use comma as a delimiter for String based values --&gt;
  &lt;recipientList delimiter=&quot;,&quot;&gt;
    &lt;header&gt;myHeader&lt;/header&gt;
  &lt;/recipientList&gt;
&lt;/route&gt;
]]></script>
</div></div>

<p>In this case, the list of recipients are contained in the header 'myHeader'. </p>

<p>And the same example in Java DSL:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;direct:a&quot;).recipientList(header(&quot;myHeader&quot;));
]]></script>
</div></div>

<p>And with a slightly different syntax where you use the builder to the fullest (i.e. avoid using parameters but using stacked operations, notice that header is not a parameter but a stacked method call)</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
  from(&quot;direct:a&quot;).recipientList().header(&quot;myHeader&quot;);
]]></script>
</div></div>

<h3 id="BookInOnePage-Dependencies.3">Dependencies</h3>
<p>The Header language is part of <strong>camel-core</strong>.</p>
<h2 id="BookInOnePage-JXPath">JXPath</h2>

<p>Camel supports <a shape="rect" class="external-link" href="http://commons.apache.org/jxpath/">JXPath</a> to allow <a shape="rect" href="xpath.html">XPath</a> expressions to be used on beans in an <a shape="rect" href="expression.html">Expression</a> or <a shape="rect" href="predicate.html">Predicate</a> to be used in the <a shape="rect" href="dsl.html">DSL</a> or <a shape="rect" href="xml-configuration.html">Xml Configuration</a>. For example you could use JXPath to create an <a shape="rect" href="predicate.html">Predicate</a> in a <a shape="rect" href="message-filter.html">Message Filter</a> or as an <a shape="rect" href="expression.html">Expression</a> for a <a shape="rect" href="recipient-list.html">Recipient List</a>.</p>

<p>You can use XPath expressions directly using smart completion in your IDE as follows</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;queue:foo&quot;).filter().
  jxpath(&quot;/in/body/foo&quot;).
  to(&quot;queue:bar&quot;)
]]></script>
</div></div>

<h3 id="BookInOnePage-Variables.1">Variables</h3>

<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Variable </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Type </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>this</strong> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Exchange </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> the Exchange object </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> in </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Message </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> the exchange.in message </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> out </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Message </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> the exchange.out message </p></td></tr></tbody></table></div>



<h3 id="BookInOnePage-Options.1">Options</h3>

<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Option </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Type </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> lenient </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> boolean </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.11/2.10.5:</strong> Allows to turn lenient on the JXPathContext. When turned on this allows the JXPath expression to evaluate against expressions and message bodies which may be invalid / missing data. See more details at the <a shape="rect" class="external-link" href="http://commons.apache.org/proper/commons-jxpath//users-guide.html#Lenient_Mode">JXPath Documentation</a> This option is by default false. </p></td></tr></tbody></table></div>


<h3 id="BookInOnePage-UsingXMLconfiguration">Using XML configuration</h3>

<p>If you prefer to configure your routes in your <a shape="rect" href="spring.html">Spring</a> XML file then you can use JXPath expressions as follows</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd&quot;&gt;

  &lt;camelContext id=&quot;camel&quot; xmlns=&quot;http://activemq.apache.org/camel/schema/spring&quot;&gt;
    &lt;route&gt;
      &lt;from uri=&quot;activemq:MyQueue&quot;/&gt;
      &lt;filter&gt;
        &lt;jxpath&gt;in/body/name = &#39;James&#39;&lt;/xpath&gt;
        &lt;to uri=&quot;mqseries:SomeOtherQueue&quot;/&gt;
      &lt;/filter&gt;
    &lt;/route&gt;
  &lt;/camelContext&gt;
&lt;/beans&gt;
]]></script>
</div></div>

<h3 id="BookInOnePage-Examples.1">Examples</h3>

<p>Here is a simple <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-jxpath/src/test/java/org/apache/camel/language/jxpath/JXPathFilterTest.java">example</a> using a JXPath expression as a predicate in a <a shape="rect" href="message-filter.html">Message Filter</a></p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;direct:start&quot;).
        filter().jxpath(&quot;in/body/name=&#39;James&#39;&quot;).
        to(&quot;mock:result&quot;);
]]></script>
</div></div>

<h2 id="BookInOnePage-JXPathinjection">JXPath injection </h2>

<p>You can use <a shape="rect" href="bean-integration.html">Bean Integration</a> to invoke a method on a bean and use various languages such as JXPath to extract a value from the message and bind it to a method parameter.</p>

<p>For example</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class Foo {
	
    @MessageDriven(uri = &quot;activemq:my.queue&quot;)
    public void doSomething(@JXPath(&quot;in/body/foo&quot;) String correlationID, @Body String body) {
		// process the inbound message here
    }
}
]]></script>
</div></div>


<h3 id="BookInOnePage-Loadingscriptfromexternalresource">Loading script from external resource</h3>
<p><strong>Available as of Camel 2.11</strong></p>

<p>You can externalize the script and have Camel load it from a resource such as <code>"classpath:"</code>, <code>"file:"</code>, or <code>"http:"</code>.<br clear="none">
This is done using the following syntax: <code>"resource:scheme:location"</code>, eg to refer to a file on the classpath you can do:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
.setHeader(&quot;myHeader&quot;).jxpath(&quot;resource:classpath:myjxpath.txt&quot;)
]]></script>
</div></div>


<h3 id="BookInOnePage-Dependencies.4">Dependencies</h3>

<p>To use JXpath in your camel routes you need to add the a dependency on <strong>camel-jxpath</strong> which implements the JXpath language. </p>

<p>If you use maven you could just add the following to your pom.xml, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-jxpath&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div>

<p>Otherwise, you'll also need <a shape="rect" class="external-link" href="http://repo2.maven.org/maven2/commons-jxpath/commons-jxpath/1.3/commons-jxpath-1.3.jar" rel="nofollow">Commons JXPath</a>.</p>
<h2 id="BookInOnePage-Mvel">Mvel</h2><p>Camel allows Mvel to be used as an <a shape="rect" href="expression.html">Expression</a> or <a shape="rect" href="predicate.html">Predicate</a> the <a shape="rect" href="dsl.html">DSL</a> or <a shape="rect" href="xml-configuration.html">Xml Configuration</a>.</p><p>You could use Mvel to create an <a shape="rect" href="predicate.html">Predicate</a> in a <a shape="rect" href="message-filter.html">Message Filter</a> or as an <a shape="rect" href="expression.html">Expression</a> for a <a shape="rect" href="recipient-list.html">Recipient List</a></p><p>You can use Mvel dot notation to invoke operations. If you for instance have a body that contains a POJO that has a <code>getFamiliyName</code> method then you can construct the syntax as follows:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&quot;request.body.familyName&quot;
   // or 
&quot;getRequest().getBody().getFamilyName()&quot;
]]></script>
</div></div><h3 id="BookInOnePage-Variables.2">Variables</h3><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Variable</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>this</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Exchange</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the Exchange is the root object</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>exchange</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Exchange</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the Exchange object</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>exception</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Throwable</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the Exchange exception (if any)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>exchangeId</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>String</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the exchange id</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>fault</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Message</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the Fault message (if any)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>request</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Message</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the exchange.in message</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>response</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Message</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the exchange.out message (if any)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>properties</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Map</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the exchange properties</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>property(name)</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Object</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the property by the given name</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>property(name, type)</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Type</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the property by the given name as the given type</p></td></tr></tbody></table></div><h3 id="BookInOnePage-Samples.1">Samples</h3><p>For example you could use Mvel inside a <a shape="rect" href="message-filter.html">Message Filter</a> in XML</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;route&gt;
  &lt;from uri=&quot;seda:foo&quot;/&gt;
  &lt;filter&gt;
    &lt;mvel&gt;request.headers.foo == &#39;bar&#39;&lt;/mvel&gt;
    &lt;to uri=&quot;seda:bar&quot;/&gt;
  &lt;/filter&gt;
&lt;/route&gt;
]]></script>
</div></div><p>And the sample using Java DSL:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[   from(&quot;seda:foo&quot;).filter().mvel(&quot;request.headers.foo == &#39;bar&#39;&quot;).to(&quot;seda:bar&quot;);
]]></script>
</div></div><h3 id="BookInOnePage-Loadingscriptfromexternalresource.1">Loading script from external resource</h3><p><strong>Available as of Camel 2.11</strong></p><p>You can externalize the script and have Camel load it from a resource such as <code>"classpath:"</code>, <code>"file:"</code>, or <code>"http:"</code>.<br clear="none"> This is done using the following syntax: <code>"resource:scheme:location"</code>, eg to refer to a file on the classpath you can do:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).mvel(&quot;resource:classpath:script.mvel&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-Dependencies.5">Dependencies</h3><p>To use Mvel in your camel routes you need to add the a dependency on <strong>camel-mvel</strong> which implements the Mvel language.</p><p>If you use maven you could just add the following to your pom.xml, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-mvel&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div>
<h2 id="BookInOnePage-OGNL">OGNL</h2><p>Camel allows <a shape="rect" class="external-link" href="http://commons.apache.org/proper/commons-ognl/">OGNL</a> to be used as an <a shape="rect" href="expression.html">Expression</a> or <a shape="rect" href="predicate.html">Predicate</a> the <a shape="rect" href="dsl.html">DSL</a> or <a shape="rect" href="xml-configuration.html">Xml Configuration</a>.</p><p>You could use OGNL to create an <a shape="rect" href="predicate.html">Predicate</a> in a <a shape="rect" href="message-filter.html">Message Filter</a> or as an <a shape="rect" href="expression.html">Expression</a> for a <a shape="rect" href="recipient-list.html">Recipient List</a></p><p>You can use OGNL dot notation to invoke operations. If you for instance have a body that contains a POJO that has a <code>getFamilyName</code> method then you can construct the syntax as follows:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&quot;request.body.familyName&quot;
   // or 
&quot;getRequest().getBody().getFamilyName()&quot;
]]></script>
</div></div><h3 id="BookInOnePage-Variables.3">Variables</h3><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Variable</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>this</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Exchange</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the Exchange is the root object</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>exchange</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Exchange</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the Exchange object</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>exception</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Throwable</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the Exchange exception (if any)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>exchangeId</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>String</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the exchange id</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>fault</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Message</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the Fault message (if any)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>request</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Message</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the exchange.in message</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>response</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Message</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the exchange.out message (if any)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>properties</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Map</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the exchange properties</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>property(name)</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Object</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the property by the given name</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>property(name, type)</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Type</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the property by the given name as the given type</p></td></tr></tbody></table></div><h3 id="BookInOnePage-Samples.2">Samples</h3><p>For example you could use OGNL inside a <a shape="rect" href="message-filter.html">Message Filter</a> in XML</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;route&gt;
  &lt;from uri=&quot;seda:foo&quot;/&gt;
  &lt;filter&gt;
    &lt;ognl&gt;request.headers.foo == &#39;bar&#39;&lt;/ognl&gt;
    &lt;to uri=&quot;seda:bar&quot;/&gt;
  &lt;/filter&gt;
&lt;/route&gt;
]]></script>
</div></div><p>And the sample using Java DSL:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[   from(&quot;seda:foo&quot;).filter().ognl(&quot;request.headers.foo == &#39;bar&#39;&quot;).to(&quot;seda:bar&quot;);
]]></script>
</div></div><h3 id="BookInOnePage-Loadingscriptfromexternalresource.2">Loading script from external resource</h3><p><strong>Available as of Camel 2.11</strong></p><p>You can externalize the script and have Camel load it from a resource such as <code>"classpath:"</code>, <code>"file:"</code>, or <code>"http:"</code>.<br clear="none"> This is done using the following syntax: <code>"resource:scheme:location"</code>, eg to refer to a file on the classpath you can do:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).ognl(&quot;resource:classpath:myognl.txt&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-Dependencies.6">Dependencies</h3><p>To use OGNL in your camel routes you need to add the a dependency on <strong>camel-ognl</strong> which implements the OGNL language.</p><p>If you use maven you could just add the following to your pom.xml, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-ognl&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div><p>Otherwise, you'll also need <a shape="rect" class="external-link" href="http://repo2.maven.org/maven2/org/apache/servicemix/bundles/org.apache.servicemix.bundles.ognl/2.7.3_4/org.apache.servicemix.bundles.ognl-2.7.3_4.jar" rel="nofollow">OGNL</a></p>
<h2 id="BookInOnePage-PropertyExpressionLanguage">Property Expression Language</h2><p>The Property Expression Language allows you to extract values of named exchange properties.</p><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>From <strong>Camel 2.15</strong> onwards the property language has been renamed to exchangeProperty to avoid ambiguity, confusion and clash with properties as a general term. So use exchangeProperty instead of property when using Camel 2.15 onwards.</p></div></div><p>&#160;</p><h3 id="BookInOnePage-Exampleusage.2">Example usage</h3><p>The recipientList element of the Spring DSL can utilize a property expression like:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;route&gt;
  &lt;from uri=&quot;direct:a&quot; /&gt;
  &lt;recipientList&gt;
    &lt;exchangeProperty&gt;myProperty&lt;/exchangeProperty&gt;
  &lt;/recipientList&gt;
&lt;/route&gt;
]]></script>
</div></div><p>In this case, the list of recipients are contained in the property 'myProperty'.</p><p>And the same example in Java DSL:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;direct:a&quot;).recipientList(property(&quot;myProperty&quot;));
]]></script>
</div></div><p>And with a slightly different syntax where you use the builder to the fullest (i.e. avoid using parameters but using stacked operations, notice that property is not a parameter but a stacked method call)</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[  from(&quot;direct:a&quot;).recipientList().property(&quot;myProperty&quot;);
]]></script>
</div></div><h3 id="BookInOnePage-Dependencies.7">Dependencies</h3><p>The Property language is part of <strong>camel-core</strong>.</p>
<h2 id="BookInOnePage-ScriptingLanguages">Scripting Languages</h2>

<p>Camel supports a number of scripting languages which can be used to create an <a shape="rect" href="expression.html">Expression</a> or <a shape="rect" href="predicate.html">Predicate</a> via the standard <a shape="rect" class="external-link" href="http://jcp.org/en/jsr/detail?id=223" rel="nofollow">JSR 223</a> which is a standard part of Java 6. </p>

<p>The following scripting languages are integrated into the DSL:</p>
<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Language</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>DSL keyword</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>EL</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>el</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>Groovy</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>groovy</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>JavaScript</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>javaScript</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>JoSQL</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sql</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>JXPath</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>jxpath</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>MVEL</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>mvel</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>OGNL</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ognl</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>PHP</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>php</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>Python</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>python</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>Ruby</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ruby</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>XPath</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>xpath</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>XQuery</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>xquery</code></p></td></tr></tbody></table></div>



<p>However any <a shape="rect" class="external-link" href="http://jcp.org/en/jsr/detail?id=223" rel="nofollow">JSR 223</a> scripting language can be used using the generic DSL methods.</p>

<h3 id="BookInOnePage-ScriptContextOptions"><code>ScriptContext</code> Options</h3><p>&#160;</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body">The&#160;<code>JSR-223</code> scripting language's&#160;<strong><code>ScriptContext</code></strong> is pre-configured with the following attributes all set at <strong><code>ENGINE_SCOPE</code></strong>.</div></div><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Attribute</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Value</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span><code>camelContext</code><br clear="none"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.CamelContext</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Camel Context.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>context</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.CamelContext</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Camel Context (cannot be used in groovy).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Exchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The current Exchange.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>properties</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.builder.script.PropertiesFunction</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> Function with a <strong><code>resolve</code></strong> method to make it easier to use Camels <a shape="rect" href="properties.html">Properties</a> component from scripts. See further below for example.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>request</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Message</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The&#160;<strong><code>IN</code></strong> message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>response</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Message</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Deprecated</strong>: The&#160;<strong><code>OUT</code></strong> message. The&#160;<strong><code>OUT</code></strong> message is&#160;<strong><code>null</code></strong> by default. Use the <strong><code>IN</code></strong> message instead.</p></td></tr></tbody></table></div><p>See <a shape="rect" href="scripting-languages.html">Scripting Languages</a> for the list of languages with explicit DSL support.</p><h3 id="BookInOnePage-PassingAdditionalArgumentstotheScriptingEngine">Passing Additional Arguments to the&#160;<code>ScriptingEngine</code></h3><p><strong>Available from Camel 2.8</strong></p><p>You can provide additional arguments to the <strong><code>ScriptingEngine</code></strong> using a header on the Camel message with the key <strong><code>CamelScriptArguments</code></strong>.</p><p>Example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public void testArgumentsExample() throws Exception {
    getMockEndpoint(&quot;mock:result&quot;).expectedMessageCount(0);
    getMockEndpoint(&quot;mock:unmatched&quot;).expectedMessageCount(1);

    // additional arguments to ScriptEngine
    Map&lt;String, Object&gt; arguments = new HashMap&lt;String, Object&gt;();
    arguments.put(&quot;foo&quot;, &quot;bar&quot;);
    arguments.put(&quot;baz&quot;, 7);

    // those additional arguments is provided as a header on the Camel Message
    template.sendBodyAndHeader(&quot;direct:start&quot;, &quot;hello&quot;, ScriptBuilder.ARGUMENTS, arguments);

    assertMockEndpointsSatisfied();
}
]]></script>
</div></div><h3 id="BookInOnePage-UsingPropertiesFunction">Using Properties Function</h3><p><strong>Available from Camel 2.9</strong></p><p>If you need to use the <a shape="rect" href="properties.html">Properties</a> component from a script to lookup property placeholders, then its a bit cumbersome to do so. For example, to set a header name&#160;<strong><code>myHeader</code></strong> with a value from a property placeholder, whose key is taken from a header named <strong><code>foo</code></strong>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;context.resolvePropertyPlaceholders(&#39;{{&#39; + request.headers.get(&#39;foo&#39;) + &#39;}}&#39;)&quot;)
]]></script>
</div></div><p>From <strong>Camel 2.9</strong>: you can now use the properties function and the same example is simpler:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;properties.resolve(request.headers.get(&#39;foo&#39;))&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-LoadingScriptFromExternalResource">Loading Script From External Resource</h3><p><strong>Available from Camel 2.11</strong></p><p>You can externalize the script and have Camel load it from a resource such as <strong><code>classpath:</code></strong>, <strong><code>file:</code></strong>, or <strong><code>http:</code></strong>. This is done using the following syntax: <strong><code>resource:scheme:location</code></strong> e.g. to refer to a file on the classpath you can do:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;resource:classpath:mygroovy.groovy&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-HowtoGettheResultfromMultipleStatementsScript">How to Get the Result from Multiple Statements Script</h3><p><strong>Available from Camel 2.14</strong></p><p>The script engine's eval method returns a&#160;<strong><code>null</code></strong> when it runs a multi-statement script. However, Camel can look up the value of a script's result by using the key <strong><code>result</code></strong> from the value set. When writing a multi-statement script set the value of the&#160;<strong><code>result</code></strong> variable as the script return value.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[bar = &quot;baz&quot;;
# some other statements ... 
# camel take the result value as the script evaluation result
result = body * 2 + 1
]]></script>
</div></div><p>&#160;</p><h3 id="BookInOnePage-Dependencies.8">Dependencies</h3><p>To use scripting languages in your camel routes you need to add the a dependency on <strong><code>camel-script</code></strong> which integrates the JSR-223 scripting engine.</p><p>If you use maven you could just add the following to your <strong><code>pom.xml</code></strong>, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-script&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div>

<h2 id="BookInOnePage-SeeAlso.7">See Also</h2>

<ul><li><a shape="rect" href="languages.html">Languages</a></li><li><a shape="rect" href="dsl.html">DSL</a></li><li><a shape="rect" href="xml-configuration.html">Xml Configuration</a></li></ul>
 
<h2 id="BookInOnePage-BeanShell">BeanShell</h2>

<p>Camel supports <a shape="rect" class="external-link" href="http://www.beanshell.org/" rel="nofollow">BeanShell</a> among other <a shape="rect" href="scripting-languages.html">Scripting Languages</a> to allow an <a shape="rect" href="expression.html">Expression</a> or <a shape="rect" href="predicate.html">Predicate</a> to be used in the <a shape="rect" href="dsl.html">DSL</a> or <a shape="rect" href="xml-configuration.html">Xml Configuration</a>.</p>

<p>To use a BeanShell expression use the following Java code:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
...choice()
    .when(script(&quot;beanshell&quot;, &quot;request.getHeaders().get(\&quot;foo\&quot;).equals(\&quot;bar\&quot;)&quot;))
       .to(&quot;...&quot;)
]]></script>
</div></div>

<p>Or the something like this in your Spring XML:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;filter&gt;
  &lt;language language=&quot;beanshell&quot;&gt;request.getHeaders().get(&quot;Foo&quot;) == null&lt;/language&gt;
  ...
]]></script>
</div></div>

<div class="confluence-information-macro confluence-information-macro-note"><p class="title">BeanShell Issues</p><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>You must use BeanShell 2.0b5 or greater.  Note that as of 2.0b5 BeanShell cannot compile scripts, which causes Camel releases before 2.6 to fail when configured with BeanShell expressions.</p></div></div>

<p>You could follow the examples above to create an <a shape="rect" href="predicate.html">Predicate</a> in a <a shape="rect" href="message-filter.html">Message Filter</a> or as an <a shape="rect" href="expression.html">Expression</a> for a <a shape="rect" href="recipient-list.html">Recipient List</a></p>

<h3 id="BookInOnePage-ScriptContextOptions.1"><code>ScriptContext</code> Options</h3><p>&#160;</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body">The&#160;<code>JSR-223</code> scripting language's&#160;<strong><code>ScriptContext</code></strong> is pre-configured with the following attributes all set at <strong><code>ENGINE_SCOPE</code></strong>.</div></div><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Attribute</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Value</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span><code>camelContext</code><br clear="none"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.CamelContext</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Camel Context.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>context</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.CamelContext</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Camel Context (cannot be used in groovy).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Exchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The current Exchange.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>properties</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.builder.script.PropertiesFunction</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> Function with a <strong><code>resolve</code></strong> method to make it easier to use Camels <a shape="rect" href="properties.html">Properties</a> component from scripts. See further below for example.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>request</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Message</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The&#160;<strong><code>IN</code></strong> message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>response</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Message</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Deprecated</strong>: The&#160;<strong><code>OUT</code></strong> message. The&#160;<strong><code>OUT</code></strong> message is&#160;<strong><code>null</code></strong> by default. Use the <strong><code>IN</code></strong> message instead.</p></td></tr></tbody></table></div><p>See <a shape="rect" href="scripting-languages.html">Scripting Languages</a> for the list of languages with explicit DSL support.</p><h3 id="BookInOnePage-PassingAdditionalArgumentstotheScriptingEngine.1">Passing Additional Arguments to the&#160;<code>ScriptingEngine</code></h3><p><strong>Available from Camel 2.8</strong></p><p>You can provide additional arguments to the <strong><code>ScriptingEngine</code></strong> using a header on the Camel message with the key <strong><code>CamelScriptArguments</code></strong>.</p><p>Example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public void testArgumentsExample() throws Exception {
    getMockEndpoint(&quot;mock:result&quot;).expectedMessageCount(0);
    getMockEndpoint(&quot;mock:unmatched&quot;).expectedMessageCount(1);

    // additional arguments to ScriptEngine
    Map&lt;String, Object&gt; arguments = new HashMap&lt;String, Object&gt;();
    arguments.put(&quot;foo&quot;, &quot;bar&quot;);
    arguments.put(&quot;baz&quot;, 7);

    // those additional arguments is provided as a header on the Camel Message
    template.sendBodyAndHeader(&quot;direct:start&quot;, &quot;hello&quot;, ScriptBuilder.ARGUMENTS, arguments);

    assertMockEndpointsSatisfied();
}
]]></script>
</div></div><h3 id="BookInOnePage-UsingPropertiesFunction.1">Using Properties Function</h3><p><strong>Available from Camel 2.9</strong></p><p>If you need to use the <a shape="rect" href="properties.html">Properties</a> component from a script to lookup property placeholders, then its a bit cumbersome to do so. For example, to set a header name&#160;<strong><code>myHeader</code></strong> with a value from a property placeholder, whose key is taken from a header named <strong><code>foo</code></strong>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;context.resolvePropertyPlaceholders(&#39;{{&#39; + request.headers.get(&#39;foo&#39;) + &#39;}}&#39;)&quot;)
]]></script>
</div></div><p>From <strong>Camel 2.9</strong>: you can now use the properties function and the same example is simpler:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;properties.resolve(request.headers.get(&#39;foo&#39;))&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-LoadingScriptFromExternalResource.1">Loading Script From External Resource</h3><p><strong>Available from Camel 2.11</strong></p><p>You can externalize the script and have Camel load it from a resource such as <strong><code>classpath:</code></strong>, <strong><code>file:</code></strong>, or <strong><code>http:</code></strong>. This is done using the following syntax: <strong><code>resource:scheme:location</code></strong> e.g. to refer to a file on the classpath you can do:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;resource:classpath:mygroovy.groovy&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-HowtoGettheResultfromMultipleStatementsScript.1">How to Get the Result from Multiple Statements Script</h3><p><strong>Available from Camel 2.14</strong></p><p>The script engine's eval method returns a&#160;<strong><code>null</code></strong> when it runs a multi-statement script. However, Camel can look up the value of a script's result by using the key <strong><code>result</code></strong> from the value set. When writing a multi-statement script set the value of the&#160;<strong><code>result</code></strong> variable as the script return value.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[bar = &quot;baz&quot;;
# some other statements ... 
# camel take the result value as the script evaluation result
result = body * 2 + 1
]]></script>
</div></div><p>&#160;</p><h3 id="BookInOnePage-Dependencies.9">Dependencies</h3><p>To use scripting languages in your camel routes you need to add the a dependency on <strong><code>camel-script</code></strong> which integrates the JSR-223 scripting engine.</p><p>If you use maven you could just add the following to your <strong><code>pom.xml</code></strong>, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-script&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div>
<h2 id="BookInOnePage-JavaScript">JavaScript</h2>

<p>Camel supports <a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/JavaScript" rel="nofollow">JavaScript/ECMAScript</a> among other <a shape="rect" href="scripting-languages.html">Scripting Languages</a> to allow an <a shape="rect" href="expression.html">Expression</a> or <a shape="rect" href="predicate.html">Predicate</a> to be used in the <a shape="rect" href="dsl.html">DSL</a> or <a shape="rect" href="xml-configuration.html">Xml Configuration</a>.</p>

<p>To use a JavaScript expression use the following Java code</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
... javaScript(&quot;someJavaScriptExpression&quot;) ... 
]]></script>
</div></div>

<p>For example you could use the <strong>javaScript</strong> function to create an <a shape="rect" href="predicate.html">Predicate</a> in a <a shape="rect" href="message-filter.html">Message Filter</a> or as an <a shape="rect" href="expression.html">Expression</a> for a <a shape="rect" href="recipient-list.html">Recipient List</a></p>

<h3 id="BookInOnePage-Example.2">Example</h3>
<p>In the sample below we use JavaScript to create a <a shape="rect" href="predicate.html">Predicate</a> use in the route path, to route exchanges from admin users to a special queue.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    from(&quot;direct:start&quot;)
        .choice()
            .when().javaScript(&quot;request.headers.get(&#39;user&#39;) == &#39;admin&#39;&quot;).to(&quot;seda:adminQueue&quot;)
        .otherwise()
            .to(&quot;seda:regularQueue&quot;);
]]></script>
</div></div>

<p>And a Spring DSL sample as well:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    &lt;route&gt;
        &lt;from uri=&quot;direct:start&quot;/&gt;
        &lt;choice&gt;
            &lt;when&gt;
                &lt;javaScript&gt;request.headers.get(&#39;user&#39;) == &#39;admin&#39;&lt;/javaScript&gt;
                &lt;to uri=&quot;seda:adminQueue&quot;/&gt;
            &lt;/when&gt;
            &lt;otherwise&gt;
                &lt;to uri=&quot;seda:regularQueue&quot;/&gt;
            &lt;/otherwise&gt;
        &lt;/choice&gt;
    &lt;/route&gt;
]]></script>
</div></div>

<h3 id="BookInOnePage-ScriptContextOptions.2"><code>ScriptContext</code> Options</h3><p>&#160;</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body">The&#160;<code>JSR-223</code> scripting language's&#160;<strong><code>ScriptContext</code></strong> is pre-configured with the following attributes all set at <strong><code>ENGINE_SCOPE</code></strong>.</div></div><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Attribute</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Value</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span><code>camelContext</code><br clear="none"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.CamelContext</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Camel Context.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>context</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.CamelContext</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Camel Context (cannot be used in groovy).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Exchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The current Exchange.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>properties</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.builder.script.PropertiesFunction</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> Function with a <strong><code>resolve</code></strong> method to make it easier to use Camels <a shape="rect" href="properties.html">Properties</a> component from scripts. See further below for example.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>request</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Message</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The&#160;<strong><code>IN</code></strong> message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>response</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Message</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Deprecated</strong>: The&#160;<strong><code>OUT</code></strong> message. The&#160;<strong><code>OUT</code></strong> message is&#160;<strong><code>null</code></strong> by default. Use the <strong><code>IN</code></strong> message instead.</p></td></tr></tbody></table></div><p>See <a shape="rect" href="scripting-languages.html">Scripting Languages</a> for the list of languages with explicit DSL support.</p><h3 id="BookInOnePage-PassingAdditionalArgumentstotheScriptingEngine.2">Passing Additional Arguments to the&#160;<code>ScriptingEngine</code></h3><p><strong>Available from Camel 2.8</strong></p><p>You can provide additional arguments to the <strong><code>ScriptingEngine</code></strong> using a header on the Camel message with the key <strong><code>CamelScriptArguments</code></strong>.</p><p>Example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public void testArgumentsExample() throws Exception {
    getMockEndpoint(&quot;mock:result&quot;).expectedMessageCount(0);
    getMockEndpoint(&quot;mock:unmatched&quot;).expectedMessageCount(1);

    // additional arguments to ScriptEngine
    Map&lt;String, Object&gt; arguments = new HashMap&lt;String, Object&gt;();
    arguments.put(&quot;foo&quot;, &quot;bar&quot;);
    arguments.put(&quot;baz&quot;, 7);

    // those additional arguments is provided as a header on the Camel Message
    template.sendBodyAndHeader(&quot;direct:start&quot;, &quot;hello&quot;, ScriptBuilder.ARGUMENTS, arguments);

    assertMockEndpointsSatisfied();
}
]]></script>
</div></div><h3 id="BookInOnePage-UsingPropertiesFunction.2">Using Properties Function</h3><p><strong>Available from Camel 2.9</strong></p><p>If you need to use the <a shape="rect" href="properties.html">Properties</a> component from a script to lookup property placeholders, then its a bit cumbersome to do so. For example, to set a header name&#160;<strong><code>myHeader</code></strong> with a value from a property placeholder, whose key is taken from a header named <strong><code>foo</code></strong>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;context.resolvePropertyPlaceholders(&#39;{{&#39; + request.headers.get(&#39;foo&#39;) + &#39;}}&#39;)&quot;)
]]></script>
</div></div><p>From <strong>Camel 2.9</strong>: you can now use the properties function and the same example is simpler:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;properties.resolve(request.headers.get(&#39;foo&#39;))&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-LoadingScriptFromExternalResource.2">Loading Script From External Resource</h3><p><strong>Available from Camel 2.11</strong></p><p>You can externalize the script and have Camel load it from a resource such as <strong><code>classpath:</code></strong>, <strong><code>file:</code></strong>, or <strong><code>http:</code></strong>. This is done using the following syntax: <strong><code>resource:scheme:location</code></strong> e.g. to refer to a file on the classpath you can do:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;resource:classpath:mygroovy.groovy&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-HowtoGettheResultfromMultipleStatementsScript.2">How to Get the Result from Multiple Statements Script</h3><p><strong>Available from Camel 2.14</strong></p><p>The script engine's eval method returns a&#160;<strong><code>null</code></strong> when it runs a multi-statement script. However, Camel can look up the value of a script's result by using the key <strong><code>result</code></strong> from the value set. When writing a multi-statement script set the value of the&#160;<strong><code>result</code></strong> variable as the script return value.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[bar = &quot;baz&quot;;
# some other statements ... 
# camel take the result value as the script evaluation result
result = body * 2 + 1
]]></script>
</div></div><p>&#160;</p><h3 id="BookInOnePage-Dependencies.10">Dependencies</h3><p>To use scripting languages in your camel routes you need to add the a dependency on <strong><code>camel-script</code></strong> which integrates the JSR-223 scripting engine.</p><p>If you use maven you could just add the following to your <strong><code>pom.xml</code></strong>, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-script&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div>
<h2 id="BookInOnePage-Groovy">Groovy</h2><p>Camel supports <a shape="rect" class="external-link" href="http://groovy.codehaus.org/" rel="nofollow">Groovy</a> among other <a shape="rect" href="scripting-languages.html">Scripting Languages</a> to allow an <a shape="rect" href="expression.html">Expression</a> or <a shape="rect" href="predicate.html">Predicate</a> to be used in the <a shape="rect" href="dsl.html">DSL</a> or <a shape="rect" href="xml-configuration.html">Xml Configuration</a>.</p><p>To use a Groovy expression use the following Java code</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[... groovy(&quot;someGroovyExpression&quot;) ... 
]]></script>
</div></div><p>For example you could use the <strong>groovy</strong> function to create an <a shape="rect" href="predicate.html">Predicate</a> in a <a shape="rect" href="message-filter.html">Message Filter</a> or as an <a shape="rect" href="expression.html">Expression</a> for a <a shape="rect" href="recipient-list.html">Recipient List</a></p><h3 id="BookInOnePage-Dependency">Dependency</h3><p>You should add the camel-groovy dependeny when using Groovy language with Camel. The generic camel-script is not optimized for best Groovy experience, and hence you should add camel-groovy as dependency.</p><h3 id="BookInOnePage-CustomizingGroovyShell">Customizing Groovy Shell</h3><p>Sometimes you may need to use custom <code>GroovyShell</code> instance in your Groovy expressions. To provide custom <code>GroovyShell</code>, add implementation of the&#160;<code>org.apache.camel.language.groovy.GroovyShellFactory</code> SPI interface to your Camel registry. For example after adding the following bean to your Spring context...</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public class CustomGroovyShellFactory implements GroovyShellFactory {

  public GroovyShell createGroovyShell(Exchange exchange) {
    ImportCustomizer importCustomizer = new ImportCustomizer();
    importCustomizer.addStaticStars(&quot;com.example.Utils&quot;);
    CompilerConfiguration configuration = new CompilerConfiguration();
    configuration.addCompilationCustomizers(importCustomizer);
    return new GroovyShell(configuration);
  }

}]]></script>
</div></div><p><span style="line-height: 1.5625;">...Camel will use your custom GroovyShell instance (containing your custom static imports), instead of the default one.</span></p><h3 id="BookInOnePage-Example.3"><span style="line-height: 1.5625;">Example</span></h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[// lets route if a line item is over $100
from(&quot;queue:foo&quot;).filter(groovy(&quot;request.lineItems.any { i -&gt; i.value &gt; 100 }&quot;)).to(&quot;queue:bar&quot;)
]]></script>
</div></div><p>And the Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[        &lt;route&gt;
            &lt;from uri=&quot;queue:foo&quot;/&gt;
            &lt;filter&gt;
                &lt;groovy&gt;request.lineItems.any { i -&gt; i.value &gt; 100 }&lt;/groovy&gt;
                &lt;to uri=&quot;queue:bar&quot;/&gt;
            &lt;/filter&gt;
        &lt;/route&gt;
]]></script>
</div></div><p></p><h3 id="BookInOnePage-ScriptContextOptions.3"><code>ScriptContext</code> Options</h3><p>&#160;</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body">The&#160;<code>JSR-223</code> scripting language's&#160;<strong><code>ScriptContext</code></strong> is pre-configured with the following attributes all set at <strong><code>ENGINE_SCOPE</code></strong>.</div></div><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Attribute</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Value</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span><code>camelContext</code><br clear="none"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.CamelContext</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Camel Context.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>context</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.CamelContext</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Camel Context (cannot be used in groovy).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Exchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The current Exchange.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>properties</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.builder.script.PropertiesFunction</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> Function with a <strong><code>resolve</code></strong> method to make it easier to use Camels <a shape="rect" href="properties.html">Properties</a> component from scripts. See further below for example.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>request</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Message</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The&#160;<strong><code>IN</code></strong> message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>response</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Message</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Deprecated</strong>: The&#160;<strong><code>OUT</code></strong> message. The&#160;<strong><code>OUT</code></strong> message is&#160;<strong><code>null</code></strong> by default. Use the <strong><code>IN</code></strong> message instead.</p></td></tr></tbody></table></div><p>See <a shape="rect" href="scripting-languages.html">Scripting Languages</a> for the list of languages with explicit DSL support.</p><h3 id="BookInOnePage-PassingAdditionalArgumentstotheScriptingEngine.3">Passing Additional Arguments to the&#160;<code>ScriptingEngine</code></h3><p><strong>Available from Camel 2.8</strong></p><p>You can provide additional arguments to the <strong><code>ScriptingEngine</code></strong> using a header on the Camel message with the key <strong><code>CamelScriptArguments</code></strong>.</p><p>Example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public void testArgumentsExample() throws Exception {
    getMockEndpoint(&quot;mock:result&quot;).expectedMessageCount(0);
    getMockEndpoint(&quot;mock:unmatched&quot;).expectedMessageCount(1);

    // additional arguments to ScriptEngine
    Map&lt;String, Object&gt; arguments = new HashMap&lt;String, Object&gt;();
    arguments.put(&quot;foo&quot;, &quot;bar&quot;);
    arguments.put(&quot;baz&quot;, 7);

    // those additional arguments is provided as a header on the Camel Message
    template.sendBodyAndHeader(&quot;direct:start&quot;, &quot;hello&quot;, ScriptBuilder.ARGUMENTS, arguments);

    assertMockEndpointsSatisfied();
}
]]></script>
</div></div><h3 id="BookInOnePage-UsingPropertiesFunction.3">Using Properties Function</h3><p><strong>Available from Camel 2.9</strong></p><p>If you need to use the <a shape="rect" href="properties.html">Properties</a> component from a script to lookup property placeholders, then its a bit cumbersome to do so. For example, to set a header name&#160;<strong><code>myHeader</code></strong> with a value from a property placeholder, whose key is taken from a header named <strong><code>foo</code></strong>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;context.resolvePropertyPlaceholders(&#39;{{&#39; + request.headers.get(&#39;foo&#39;) + &#39;}}&#39;)&quot;)
]]></script>
</div></div><p>From <strong>Camel 2.9</strong>: you can now use the properties function and the same example is simpler:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;properties.resolve(request.headers.get(&#39;foo&#39;))&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-LoadingScriptFromExternalResource.3">Loading Script From External Resource</h3><p><strong>Available from Camel 2.11</strong></p><p>You can externalize the script and have Camel load it from a resource such as <strong><code>classpath:</code></strong>, <strong><code>file:</code></strong>, or <strong><code>http:</code></strong>. This is done using the following syntax: <strong><code>resource:scheme:location</code></strong> e.g. to refer to a file on the classpath you can do:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;resource:classpath:mygroovy.groovy&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-HowtoGettheResultfromMultipleStatementsScript.3">How to Get the Result from Multiple Statements Script</h3><p><strong>Available from Camel 2.14</strong></p><p>The script engine's eval method returns a&#160;<strong><code>null</code></strong> when it runs a multi-statement script. However, Camel can look up the value of a script's result by using the key <strong><code>result</code></strong> from the value set. When writing a multi-statement script set the value of the&#160;<strong><code>result</code></strong> variable as the script return value.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[bar = &quot;baz&quot;;
# some other statements ... 
# camel take the result value as the script evaluation result
result = body * 2 + 1
]]></script>
</div></div><p>&#160;</p><h3 id="BookInOnePage-Dependencies.11">Dependencies</h3><p>To use scripting languages in your camel routes you need to add the a dependency on <strong><code>camel-script</code></strong> which integrates the JSR-223 scripting engine.</p><p>If you use maven you could just add the following to your <strong><code>pom.xml</code></strong>, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-script&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div>
<h2 id="BookInOnePage-Python">Python</h2><p>Camel supports <a shape="rect" class="external-link" href="http://www.python.org/" rel="nofollow">Python</a> among other <a shape="rect" href="scripting-languages.html">Scripting Languages</a> to allow an <a shape="rect" href="expression.html">Expression</a> or <a shape="rect" href="predicate.html">Predicate</a> to be used in the <a shape="rect" href="dsl.html">DSL</a> or <a shape="rect" href="xml-configuration.html">Xml Configuration</a>.</p><p>To use a Python expression use the following Java code</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[... python(&quot;somePythonExpression&quot;) ... 
]]></script>
</div></div><p>For example you could use the <strong>python</strong> function to create an <a shape="rect" href="predicate.html">Predicate</a> in a <a shape="rect" href="message-filter.html">Message Filter</a> or as an <a shape="rect" href="expression.html">Expression</a> for a <a shape="rect" href="recipient-list.html">Recipient List</a></p><h3 id="BookInOnePage-Example.4">Example</h3><p>In the sample below we use Python to create a <a shape="rect" href="predicate.html">Predicate</a> use in the route path, to route exchanges from admin users to a special queue.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[    from(&quot;direct:start&quot;)
        .choice()
            .when().python(&quot;request.headers[&#39;user&#39;] == &#39;admin&#39;&quot;).to(&quot;seda:adminQueue&quot;)
        .otherwise()
            .to(&quot;seda:regularQueue&quot;);
]]></script>
</div></div><p>And a Spring DSL sample as well:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[    &lt;route&gt;
        &lt;from uri=&quot;direct:start&quot;/&gt;
        &lt;choice&gt;
            &lt;when&gt;
                &lt;python&gt;request.headers[&#39;user&#39;] == &#39;admin&#39;&lt;/python&gt;
                &lt;to uri=&quot;seda:adminQueue&quot;/&gt;
            &lt;/when&gt;
            &lt;otherwise&gt;
                &lt;to uri=&quot;seda:regularQueue&quot;/&gt;
            &lt;/otherwise&gt;
        &lt;/choice&gt;
    &lt;/route&gt;
]]></script>
</div></div><p></p><h3 id="BookInOnePage-ScriptContextOptions.4"><code>ScriptContext</code> Options</h3><p>&#160;</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body">The&#160;<code>JSR-223</code> scripting language's&#160;<strong><code>ScriptContext</code></strong> is pre-configured with the following attributes all set at <strong><code>ENGINE_SCOPE</code></strong>.</div></div><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Attribute</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Value</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span><code>camelContext</code><br clear="none"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.CamelContext</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Camel Context.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>context</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.CamelContext</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Camel Context (cannot be used in groovy).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Exchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The current Exchange.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>properties</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.builder.script.PropertiesFunction</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> Function with a <strong><code>resolve</code></strong> method to make it easier to use Camels <a shape="rect" href="properties.html">Properties</a> component from scripts. See further below for example.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>request</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Message</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The&#160;<strong><code>IN</code></strong> message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>response</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Message</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Deprecated</strong>: The&#160;<strong><code>OUT</code></strong> message. The&#160;<strong><code>OUT</code></strong> message is&#160;<strong><code>null</code></strong> by default. Use the <strong><code>IN</code></strong> message instead.</p></td></tr></tbody></table></div><p>See <a shape="rect" href="scripting-languages.html">Scripting Languages</a> for the list of languages with explicit DSL support.</p><h3 id="BookInOnePage-PassingAdditionalArgumentstotheScriptingEngine.4">Passing Additional Arguments to the&#160;<code>ScriptingEngine</code></h3><p><strong>Available from Camel 2.8</strong></p><p>You can provide additional arguments to the <strong><code>ScriptingEngine</code></strong> using a header on the Camel message with the key <strong><code>CamelScriptArguments</code></strong>.</p><p>Example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public void testArgumentsExample() throws Exception {
    getMockEndpoint(&quot;mock:result&quot;).expectedMessageCount(0);
    getMockEndpoint(&quot;mock:unmatched&quot;).expectedMessageCount(1);

    // additional arguments to ScriptEngine
    Map&lt;String, Object&gt; arguments = new HashMap&lt;String, Object&gt;();
    arguments.put(&quot;foo&quot;, &quot;bar&quot;);
    arguments.put(&quot;baz&quot;, 7);

    // those additional arguments is provided as a header on the Camel Message
    template.sendBodyAndHeader(&quot;direct:start&quot;, &quot;hello&quot;, ScriptBuilder.ARGUMENTS, arguments);

    assertMockEndpointsSatisfied();
}
]]></script>
</div></div><h3 id="BookInOnePage-UsingPropertiesFunction.4">Using Properties Function</h3><p><strong>Available from Camel 2.9</strong></p><p>If you need to use the <a shape="rect" href="properties.html">Properties</a> component from a script to lookup property placeholders, then its a bit cumbersome to do so. For example, to set a header name&#160;<strong><code>myHeader</code></strong> with a value from a property placeholder, whose key is taken from a header named <strong><code>foo</code></strong>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;context.resolvePropertyPlaceholders(&#39;{{&#39; + request.headers.get(&#39;foo&#39;) + &#39;}}&#39;)&quot;)
]]></script>
</div></div><p>From <strong>Camel 2.9</strong>: you can now use the properties function and the same example is simpler:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;properties.resolve(request.headers.get(&#39;foo&#39;))&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-LoadingScriptFromExternalResource.4">Loading Script From External Resource</h3><p><strong>Available from Camel 2.11</strong></p><p>You can externalize the script and have Camel load it from a resource such as <strong><code>classpath:</code></strong>, <strong><code>file:</code></strong>, or <strong><code>http:</code></strong>. This is done using the following syntax: <strong><code>resource:scheme:location</code></strong> e.g. to refer to a file on the classpath you can do:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;resource:classpath:mygroovy.groovy&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-HowtoGettheResultfromMultipleStatementsScript.4">How to Get the Result from Multiple Statements Script</h3><p><strong>Available from Camel 2.14</strong></p><p>The script engine's eval method returns a&#160;<strong><code>null</code></strong> when it runs a multi-statement script. However, Camel can look up the value of a script's result by using the key <strong><code>result</code></strong> from the value set. When writing a multi-statement script set the value of the&#160;<strong><code>result</code></strong> variable as the script return value.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[bar = &quot;baz&quot;;
# some other statements ... 
# camel take the result value as the script evaluation result
result = body * 2 + 1
]]></script>
</div></div><p>&#160;</p><h3 id="BookInOnePage-Dependencies.12">Dependencies</h3><p>To use scripting languages in your camel routes you need to add the a dependency on <strong><code>camel-script</code></strong> which integrates the JSR-223 scripting engine.</p><p>If you use maven you could just add the following to your <strong><code>pom.xml</code></strong>, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-script&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div> 
<h2 id="BookInOnePage-PHP">PHP</h2>

<p>Camel supports <a shape="rect" class="external-link" href="http://www.php.net/" rel="nofollow">PHP</a> among other <a shape="rect" href="scripting-languages.html">Scripting Languages</a> to allow an <a shape="rect" href="expression.html">Expression</a> or <a shape="rect" href="predicate.html">Predicate</a> to be used in the <a shape="rect" href="dsl.html">DSL</a> or <a shape="rect" href="xml-configuration.html">Xml Configuration</a>.</p>

<p>To use a PHP expression use the following Java code</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
... php(&quot;somePHPExpression&quot;) ... 
]]></script>
</div></div>

<p>For example you could use the <strong>php</strong> function to create an <a shape="rect" href="predicate.html">Predicate</a> in a <a shape="rect" href="message-filter.html">Message Filter</a> or as an <a shape="rect" href="expression.html">Expression</a> for a <a shape="rect" href="recipient-list.html">Recipient List</a></p>

<h3 id="BookInOnePage-ScriptContextOptions.5"><code>ScriptContext</code> Options</h3><p>&#160;</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body">The&#160;<code>JSR-223</code> scripting language's&#160;<strong><code>ScriptContext</code></strong> is pre-configured with the following attributes all set at <strong><code>ENGINE_SCOPE</code></strong>.</div></div><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Attribute</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Value</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span><code>camelContext</code><br clear="none"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.CamelContext</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Camel Context.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>context</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.CamelContext</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Camel Context (cannot be used in groovy).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Exchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The current Exchange.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>properties</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.builder.script.PropertiesFunction</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> Function with a <strong><code>resolve</code></strong> method to make it easier to use Camels <a shape="rect" href="properties.html">Properties</a> component from scripts. See further below for example.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>request</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Message</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The&#160;<strong><code>IN</code></strong> message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>response</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Message</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Deprecated</strong>: The&#160;<strong><code>OUT</code></strong> message. The&#160;<strong><code>OUT</code></strong> message is&#160;<strong><code>null</code></strong> by default. Use the <strong><code>IN</code></strong> message instead.</p></td></tr></tbody></table></div><p>See <a shape="rect" href="scripting-languages.html">Scripting Languages</a> for the list of languages with explicit DSL support.</p><h3 id="BookInOnePage-PassingAdditionalArgumentstotheScriptingEngine.5">Passing Additional Arguments to the&#160;<code>ScriptingEngine</code></h3><p><strong>Available from Camel 2.8</strong></p><p>You can provide additional arguments to the <strong><code>ScriptingEngine</code></strong> using a header on the Camel message with the key <strong><code>CamelScriptArguments</code></strong>.</p><p>Example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public void testArgumentsExample() throws Exception {
    getMockEndpoint(&quot;mock:result&quot;).expectedMessageCount(0);
    getMockEndpoint(&quot;mock:unmatched&quot;).expectedMessageCount(1);

    // additional arguments to ScriptEngine
    Map&lt;String, Object&gt; arguments = new HashMap&lt;String, Object&gt;();
    arguments.put(&quot;foo&quot;, &quot;bar&quot;);
    arguments.put(&quot;baz&quot;, 7);

    // those additional arguments is provided as a header on the Camel Message
    template.sendBodyAndHeader(&quot;direct:start&quot;, &quot;hello&quot;, ScriptBuilder.ARGUMENTS, arguments);

    assertMockEndpointsSatisfied();
}
]]></script>
</div></div><h3 id="BookInOnePage-UsingPropertiesFunction.5">Using Properties Function</h3><p><strong>Available from Camel 2.9</strong></p><p>If you need to use the <a shape="rect" href="properties.html">Properties</a> component from a script to lookup property placeholders, then its a bit cumbersome to do so. For example, to set a header name&#160;<strong><code>myHeader</code></strong> with a value from a property placeholder, whose key is taken from a header named <strong><code>foo</code></strong>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;context.resolvePropertyPlaceholders(&#39;{{&#39; + request.headers.get(&#39;foo&#39;) + &#39;}}&#39;)&quot;)
]]></script>
</div></div><p>From <strong>Camel 2.9</strong>: you can now use the properties function and the same example is simpler:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;properties.resolve(request.headers.get(&#39;foo&#39;))&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-LoadingScriptFromExternalResource.5">Loading Script From External Resource</h3><p><strong>Available from Camel 2.11</strong></p><p>You can externalize the script and have Camel load it from a resource such as <strong><code>classpath:</code></strong>, <strong><code>file:</code></strong>, or <strong><code>http:</code></strong>. This is done using the following syntax: <strong><code>resource:scheme:location</code></strong> e.g. to refer to a file on the classpath you can do:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;resource:classpath:mygroovy.groovy&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-HowtoGettheResultfromMultipleStatementsScript.5">How to Get the Result from Multiple Statements Script</h3><p><strong>Available from Camel 2.14</strong></p><p>The script engine's eval method returns a&#160;<strong><code>null</code></strong> when it runs a multi-statement script. However, Camel can look up the value of a script's result by using the key <strong><code>result</code></strong> from the value set. When writing a multi-statement script set the value of the&#160;<strong><code>result</code></strong> variable as the script return value.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[bar = &quot;baz&quot;;
# some other statements ... 
# camel take the result value as the script evaluation result
result = body * 2 + 1
]]></script>
</div></div><p>&#160;</p><h3 id="BookInOnePage-Dependencies.13">Dependencies</h3><p>To use scripting languages in your camel routes you need to add the a dependency on <strong><code>camel-script</code></strong> which integrates the JSR-223 scripting engine.</p><p>If you use maven you could just add the following to your <strong><code>pom.xml</code></strong>, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-script&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div>
<h2 id="BookInOnePage-Ruby">Ruby</h2>

<p>Camel supports <a shape="rect" class="external-link" href="http://www.ruby-lang.org/en/" rel="nofollow">Ruby</a> among other <a shape="rect" href="scripting-languages.html">Scripting Languages</a> to allow an <a shape="rect" href="expression.html">Expression</a> or <a shape="rect" href="predicate.html">Predicate</a> to be used in the <a shape="rect" href="dsl.html">DSL</a> or <a shape="rect" href="xml-configuration.html">Xml Configuration</a>.</p>

<p>To use a Ruby expression use the following Java code</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
... ruby(&quot;someRubyExpression&quot;) ... 
]]></script>
</div></div>

<p>For example you could use the <strong>ruby</strong> function to create an <a shape="rect" href="predicate.html">Predicate</a> in a <a shape="rect" href="message-filter.html">Message Filter</a> or as an <a shape="rect" href="expression.html">Expression</a> for a <a shape="rect" href="recipient-list.html">Recipient List</a></p>

<h3 id="BookInOnePage-Example.5">Example</h3>
<p>In the sample below we use Ruby to create a <a shape="rect" href="predicate.html">Predicate</a> use in the route path, to route exchanges from admin users to a special queue.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    from(&quot;direct:start&quot;)
        .choice()
            .when().ruby(&quot;$request.headers[&#39;user&#39;] == &#39;admin&#39;&quot;).to(&quot;seda:adminQueue&quot;)
        .otherwise()
            .to(&quot;seda:regularQueue&quot;);
]]></script>
</div></div>

<p>And a Spring DSL sample as well:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    &lt;route&gt;
        &lt;from uri=&quot;direct:start&quot;/&gt;
        &lt;choice&gt;
            &lt;when&gt;
                &lt;ruby&gt;$request.headers[&#39;user&#39;] == &#39;admin&#39;&lt;/ruby&gt;
                &lt;to uri=&quot;seda:adminQueue&quot;/&gt;
            &lt;/when&gt;
            &lt;otherwise&gt;
                &lt;to uri=&quot;seda:regularQueue&quot;/&gt;
            &lt;/otherwise&gt;
        &lt;/choice&gt;
    &lt;/route&gt;
]]></script>
</div></div>

<h3 id="BookInOnePage-ScriptContextOptions.6"><code>ScriptContext</code> Options</h3><p>&#160;</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body">The&#160;<code>JSR-223</code> scripting language's&#160;<strong><code>ScriptContext</code></strong> is pre-configured with the following attributes all set at <strong><code>ENGINE_SCOPE</code></strong>.</div></div><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Attribute</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Value</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span><code>camelContext</code><br clear="none"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.CamelContext</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Camel Context.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>context</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.CamelContext</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Camel Context (cannot be used in groovy).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Exchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The current Exchange.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>properties</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.builder.script.PropertiesFunction</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> Function with a <strong><code>resolve</code></strong> method to make it easier to use Camels <a shape="rect" href="properties.html">Properties</a> component from scripts. See further below for example.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>request</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Message</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The&#160;<strong><code>IN</code></strong> message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>response</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Message</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Deprecated</strong>: The&#160;<strong><code>OUT</code></strong> message. The&#160;<strong><code>OUT</code></strong> message is&#160;<strong><code>null</code></strong> by default. Use the <strong><code>IN</code></strong> message instead.</p></td></tr></tbody></table></div><p>See <a shape="rect" href="scripting-languages.html">Scripting Languages</a> for the list of languages with explicit DSL support.</p><h3 id="BookInOnePage-PassingAdditionalArgumentstotheScriptingEngine.6">Passing Additional Arguments to the&#160;<code>ScriptingEngine</code></h3><p><strong>Available from Camel 2.8</strong></p><p>You can provide additional arguments to the <strong><code>ScriptingEngine</code></strong> using a header on the Camel message with the key <strong><code>CamelScriptArguments</code></strong>.</p><p>Example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public void testArgumentsExample() throws Exception {
    getMockEndpoint(&quot;mock:result&quot;).expectedMessageCount(0);
    getMockEndpoint(&quot;mock:unmatched&quot;).expectedMessageCount(1);

    // additional arguments to ScriptEngine
    Map&lt;String, Object&gt; arguments = new HashMap&lt;String, Object&gt;();
    arguments.put(&quot;foo&quot;, &quot;bar&quot;);
    arguments.put(&quot;baz&quot;, 7);

    // those additional arguments is provided as a header on the Camel Message
    template.sendBodyAndHeader(&quot;direct:start&quot;, &quot;hello&quot;, ScriptBuilder.ARGUMENTS, arguments);

    assertMockEndpointsSatisfied();
}
]]></script>
</div></div><h3 id="BookInOnePage-UsingPropertiesFunction.6">Using Properties Function</h3><p><strong>Available from Camel 2.9</strong></p><p>If you need to use the <a shape="rect" href="properties.html">Properties</a> component from a script to lookup property placeholders, then its a bit cumbersome to do so. For example, to set a header name&#160;<strong><code>myHeader</code></strong> with a value from a property placeholder, whose key is taken from a header named <strong><code>foo</code></strong>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;context.resolvePropertyPlaceholders(&#39;{{&#39; + request.headers.get(&#39;foo&#39;) + &#39;}}&#39;)&quot;)
]]></script>
</div></div><p>From <strong>Camel 2.9</strong>: you can now use the properties function and the same example is simpler:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;properties.resolve(request.headers.get(&#39;foo&#39;))&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-LoadingScriptFromExternalResource.6">Loading Script From External Resource</h3><p><strong>Available from Camel 2.11</strong></p><p>You can externalize the script and have Camel load it from a resource such as <strong><code>classpath:</code></strong>, <strong><code>file:</code></strong>, or <strong><code>http:</code></strong>. This is done using the following syntax: <strong><code>resource:scheme:location</code></strong> e.g. to refer to a file on the classpath you can do:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).groovy(&quot;resource:classpath:mygroovy.groovy&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-HowtoGettheResultfromMultipleStatementsScript.6">How to Get the Result from Multiple Statements Script</h3><p><strong>Available from Camel 2.14</strong></p><p>The script engine's eval method returns a&#160;<strong><code>null</code></strong> when it runs a multi-statement script. However, Camel can look up the value of a script's result by using the key <strong><code>result</code></strong> from the value set. When writing a multi-statement script set the value of the&#160;<strong><code>result</code></strong> variable as the script return value.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[bar = &quot;baz&quot;;
# some other statements ... 
# camel take the result value as the script evaluation result
result = body * 2 + 1
]]></script>
</div></div><p>&#160;</p><h3 id="BookInOnePage-Dependencies.14">Dependencies</h3><p>To use scripting languages in your camel routes you need to add the a dependency on <strong><code>camel-script</code></strong> which integrates the JSR-223 scripting engine.</p><p>If you use maven you could just add the following to your <strong><code>pom.xml</code></strong>, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-script&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div>
<h2 id="BookInOnePage-SimpleExpressionLanguage">Simple Expression Language</h2><p>The Simple Expression Language was a really simple language when it was created, but has since grown more powerful. It is primarily intended for being a really small and simple language for evaluating <a shape="rect" href="expression.html">Expression</a>s and <a shape="rect" href="predicate.html">Predicate</a>s without requiring any new dependencies or knowledge of <a shape="rect" href="xpath.html">XPath</a>; so it is ideal for testing in <strong><code>camel-core</code></strong>. The idea was to cover 95% of the common use cases when you need a little bit of expression based script in your Camel routes.</p><p>However for much more complex use cases you are generally recommended to choose a more expressive and powerful language such as:</p><ul><li><a shape="rect" href="spel.html">SpEL</a></li><li><a shape="rect" href="mvel.html">Mvel</a></li><li><a shape="rect" href="groovy.html">Groovy</a></li><li><a shape="rect" href="javascript.html">JavaScript</a></li><li><a shape="rect" href="el.html">EL</a></li><li><a shape="rect" href="ognl.html">OGNL</a></li><li>one of the supported <a shape="rect" href="scripting-languages.html">Scripting Languages</a></li></ul><p>The simple language uses <strong><code>${body</code>}</strong> placeholders for complex expressions where the expression contains constant literals. The&#160;<strong><code>${ }</code></strong> placeholders can be omitted if the expression is only the token itself.</p><div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Alternative syntax</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>From Camel 2.5 you can also use the alternative syntax which uses&#160;<strong><code>$simple{ }</code></strong> as placeholders. This can be used in situations to avoid clashes when using for example Spring property placeholder together with Camel.</p></div></div><div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Configuring result type</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>From Camel 2.8 you can configure the result type of the <a shape="rect" href="simple.html">Simple</a> expression. For example to set the type as a <strong><code>java.lang.Boolean</code></strong> or a <code>j<strong>ava.lang.Integer</strong></code> etc.</p></div></div><div class="confluence-information-macro confluence-information-macro-information"><p class="title">File language is now merged with Simple language</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>From Camel 2.2, the <a shape="rect" href="file-language.html">File Language</a> is now merged with <a shape="rect" href="simple.html">Simple</a> language which means you can use all the file syntax directly within the simple language.</p></div></div><div class="confluence-information-macro confluence-information-macro-information"><p class="title">Simple Language Changes in Camel 2.9 onwards</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>The <a shape="rect" href="simple.html">Simple</a> language have been improved from Camel 2.9 to use a better syntax parser, which can do index precise error messages, so you know exactly what is wrong and where the problem is. For example if you have made a typo in one of the operators, then previously the parser would not be able to detect this, and cause the evaluation to be true. There are a few changes in the syntax which are no longer backwards compatible. When using <a shape="rect" href="simple.html">Simple</a> language as a <a shape="rect" href="predicate.html">Predicate</a> then the literal text <strong>must</strong> be enclosed in either single or double quotes. For example: <code>"<strong>${body} == 'Camel'</strong>"</code>. Notice how we have single quotes around the literal. The old style of using <code>"<strong>body</strong>"</code> and <code>"<strong>header.foo</strong>"</code> to refer to the message body and header is <strong><code>@deprecated</code></strong>, and it is encouraged to always use&#160;<strong><code>${ }</code></strong> tokens for the built-in functions.<br clear="none"> The range operator now requires the range to be in single quote as well as shown: <code>"<strong>${header.zip} between '30000..39999'</strong>"</code>.</p></div></div><p>To get the body of the in message: <strong><code>body</code></strong>, or <strong><code>in.body</code></strong> or <strong><code>${body}</code></strong>.</p><p>A complex expression must use&#160;<strong><code>${ }</code></strong> placeholders, such as: <strong><code>Hello ${in.header.name} how are you?</code></strong>.</p><p>You can have multiple functions in the same expression: <code>"<strong>Hello ${in.header.name} this is ${in.header.me} speaking</strong>"</code>. However you can <em><strong>not</strong></em> nest functions in Camel 2.8.x or older e.g., having another&#160;<strong><code>${ }</code></strong> placeholder in an existing, is not allowed. From <strong>Camel 2.9</strong> you can nest functions.</p><h3 id="BookInOnePage-Variables.4">Variables</h3><div class="confluenceTableSmall"><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Variable</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>camelId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> the <a shape="rect" href="camelcontext.html">CamelContext</a> name.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>camelContext.<strong>OGNL</strong></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> the&#160;<strong><code>CamelContext</code></strong> invoked using a Camel OGNL expression.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Exchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16:</strong> the <a shape="rect" href="exchange.html">Exchange.</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exchange.<strong>OGNL</strong></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16:</strong><span> the </span><a shape="rect" href="exchange.html">Exchange</a><span> invoked using a Camel OGNL expression.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exchangeId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> the exchange Id.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>id</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The input message Id.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>body</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The input body.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>in.body</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The input body.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>body.<strong>OGNL</strong></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> the input body invoked using a Camel OGNL expression.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>in.body.<strong>OGNL</strong></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> the input body invoked using a Camel OGNL expression.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bodyAs(<em>type</em>)</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> Converts the body to the given type determined by its classname. The converted body can be <strong><code>null</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bodyAs(<em>type</em>).<strong>OGNL</strong></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.18:</strong><span> Converts the body to the given type determined by its classname and then invoke methods using a Camel OGNL expression. The converted body can be <strong><code>null</code></strong>.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>mandatoryBodyAs(<em>type</em>)</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> Converts the body to the given type determined by its classname, and expects the body to be not <strong><code>null</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>mandatoryBodyAs(<em>type</em>).<strong>OGNL</strong></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.18:</strong><span> Converts the body to the given type determined by its classname and then invoke methods using a Camel OGNL expression.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>out.body</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The output body.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>header.<em>foo</em></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refer to the input&#160;<strong><code>foo</code></strong> header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>header[<em>foo</em>]</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.2:</strong> refer to the input&#160;<strong><code>foo</code></strong> header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>headers.<em>foo</em></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refer to the input&#160;<strong><code>foo</code></strong> header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>headers[<em>foo</em>]</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.2:</strong> refer to the input&#160;<strong><code>foo</code></strong> header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>in.header.<code><em>foo</em></code></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refer to the input&#160;<strong><code>foo</code></strong> header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>in.header[<code><em>foo</em></code>]</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.2:</strong> refer to the input&#160;<strong><code>foo</code></strong> header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>in.headers.<code><em>foo</em></code></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refer to the input&#160;<strong><code>foo</code></strong> header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>in.headers[<code><em>foo</em></code>]</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.2:</strong> refer to the input&#160;<strong><code>foo</code></strong> header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>header.foo[<em>bar</em>]</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> regard input&#160;<strong><code>foo</code></strong> header as a map and perform lookup on the map with&#160;<strong><code>bar</code></strong> as key.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>in.header.foo[<code><em>bar</em></code>]</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> regard input&#160;<strong><code>foo</code></strong> header as a map and perform lookup on the map with&#160;<strong><code>bar</code></strong> as key.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>in.headers.foo[<code><em>bar</em></code>]</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> regard input&#160;<strong><code>foo</code></strong> header as a map and perform lookup on the map with&#160;<strong><code>bar</code></strong> as key.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>header.<code><em>foo</em></code>.OGNL</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> refer to the input&#160;<strong><code>foo</code></strong> header and invoke its value using a Camel OGNL expression.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>in.header.<code><em>foo</em></code>.OGNL</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> refer to the input&#160;<strong><code>foo</code></strong> header and invoke its value using a Camel OGNL expression.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>in.headers.<code><em>foo</em></code>.OGNL</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> refer to the input&#160;<strong><code>foo</code></strong> header and invoke its value using a Camel OGNL expression.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>out.header.<code><em>foo</em></code></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refer to the out header <strong><code>foo</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>out.header[<code><em>foo</em></code>]</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.2:</strong> refer to the out header <strong><code>foo</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>out.headers.<code><em>foo</em></code></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refer to the out header <strong><code>foo</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>out.headers[<code><em>foo</em></code>]</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.2:</strong> refer to the out header <strong><code>foo</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>headerAs(<em>key</em>,<em>type</em>)</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> Converts the header to the given type determined by its classname.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>headers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Map</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> refer to the input headers.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>in.headers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Map</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> refer to the input headers.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>property.<code><em>foo</em></code></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong><span style="color: rgb(255,0,0);">Deprecated</span>:</strong> refer to the&#160;<strong><code>foo</code></strong> property on the exchange.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exchangeProperty.<code><em>foo</em></code></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span><strong>Camel 2.15:</strong> refer to the&#160;<strong><code>foo</code></strong> property on the exchange.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>property[<code><em>foo</em></code>]</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Deprecated:</strong> refer to the&#160;<strong><code>foo</code></strong> property on the exchange.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span><code>exchangeProperty[<code><em>foo</em></code>]</code></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.15:</strong><span> refer to the&#160;<strong><code>foo</code></strong> property on the exchange.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>property.<code><em>foo</em></code>.OGNL</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Deprecated:</strong> refer to the&#160;<strong><code>foo</code></strong> property on the exchange and invoke its value using a Camel OGNL expression.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exchangeProperty.<code><em>foo</em></code>.OGNL</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.15:</strong><span> refer to the&#160;<strong><code>foo</code></strong> property on the exchange and invoke its value using a Camel OGNL expression.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sys.<code><em>foo</em></code></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refer to the system property <span><strong><code>foo</code></strong></span>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sysenv.<code><em>foo</em></code></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> refer to the system environment property <span><strong><code>foo</code></strong></span>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exception</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.4:</strong> Refer to the exception object on the exchange, is <strong><code>null</code></strong> if no exception set on exchange. Will fallback and grab caught exceptions (<strong><code>Exchange.EXCEPTION_CAUGHT</code></strong>) if the Exchange has any.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exception.OGNL</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.4:</strong> Refer to the exchange exception invoked using a Camel OGNL expression object</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exception.message</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refer to the exception.message on the exchange, is <strong>null</strong> if no exception set on exchange. Will fallback and grab caught exceptions (<strong><code>Exchange.EXCEPTION_CAUGHT</code></strong>) if the Exchange has any.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exception.stacktrace</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.6.</strong> Refer to the&#160;<strong><code>exception.stracktrace</code></strong> on the exchange. Result is&#160;<strong><code>null</code></strong> if no exception set on exchange. Will fallback and grab caught exceptions (<strong><code>Exchange.EXCEPTION_CAUGHT</code></strong>) if the Exchange has any.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>date:<em>command</em>:<em>pattern</em></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Date formatting using the <strong><code>java.text.SimpleDateFormat</code></strong> patterns. Supported commands are:&#160;</p>
     <ul><li><p><strong><code>now</code></strong> for current timestamp.</p></li><li><p><strong><code>in.header.xxx</code></strong> or&#160;<strong><code>header.xxx</code></strong> to use the&#160;<strong><code>Date</code></strong> object in the&#160;<strong><code>IN</code></strong> header with the key <strong><code>xxx</code></strong>.</p></li><li><p><strong><code>out.header.xxx</code></strong> to use the&#160;<strong><code>Date</code></strong> object in the&#160;<strong><code>OUT</code></strong> header with the key <strong><code>xxx</code></strong>.</p></li></ul></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bean:<em>bean expression</em></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Invoking a bean expression using the <a shape="rect" href="bean.html">Bean</a> language. Specifying a method name you must use dot as separator. We also support the&#160;<strong><code>?method=methodname</code></strong> syntax that is used by the <a shape="rect" href="bean.html">Bean</a> component.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>properties:<em>locations</em>:key</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong><span style="color: rgb(255,0,0);">Deprecated</span> (use properties-location instead) Camel 2.3:</strong> Lookup a property with the given key. The <strong><code>locations</code></strong> option is optional. See more at <a shape="rect" href="using-propertyplaceholder.html">Using PropertyPlaceholder</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>properties-location:<em>locations:key</em></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.14.1:</strong> Lookup a property with the given key. The <code>locations</code> option is optional. See more at <a shape="rect" href="using-propertyplaceholder.html">Using PropertyPlaceholder</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>properties:key:default</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.14.1</strong>: Lookup a property with the given key. If the key does not exists or has no value, then an optional default value can be specified.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>routeId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> Returns the Id of the current route the <a shape="rect" href="exchange.html">Exchange</a> is being routed.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>threadName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> Returns the name of the current thread. Can be used for logging purpose.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ref:<em>xxx</em></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.6:</strong> To lookup a bean from the <a shape="rect" href="registry.html">Registry</a> with the given Id.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>type:name.field</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> To refer to a type or field by its FQN name. To refer to a field you can append <strong><code>.FIELD_NAME</code></strong>. For example you can refer to the constant field from Exchange as: <strong><code>org.apache.camel.Exchange.FILE_NAME</code></strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12.3:</strong> represents a <strong><code>null</code>.</strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>random(<em>value</em>)</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Integer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16.0: </strong>returns a random Integer between&#160;<em><strong><code>0</code></strong></em> (included) and <strong><em>value</em></strong> (excluded)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>random(<em>min</em>,<em>max</em>)</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Integer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16.0: </strong>returns a random Integer between <strong><em>min</em></strong> (included) and <strong><em>max</em></strong> (excluded)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>collate(<em>group</em>)</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>List</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17:</strong> The collate function iterates the message body and groups the data into sub lists of specified size. This can be used with the <a shape="rect" href="splitter.html">Splitter</a> EIP to split a message body and group/batch the split sub messages into a group of&#160;<strong><code>N</code></strong> sub lists. This method works similar to the collate method in Groovy.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>messageHistory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17:</strong> The message history of the current exchange how it has been routed. This is similar to the route stack-trace message history the error handler logs in case of an un-handled exception.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span><code>messageHistory(false)</code></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17:</strong><span>&#160;</span>As&#160;<strong><code>messageHistory</code></strong> but without the exchange details (only includes the route strack-trace). This can be used if you do not want to log sensitive data from the message itself.</p></td></tr></tbody></table>
</div></div><h3 id="BookInOnePage-OGNLexpressionsupport">OGNL expression support</h3><p><strong>Available as of Camel 2.3</strong></p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Camel's OGNL support is for invoking methods only. You cannot access fields.<br clear="none"> From <strong>Camel 2.11.1</strong> onwards we added special support for accessing the length field of Java arrays.</p></div></div><p>The <a shape="rect" href="simple.html">Simple</a> and <a shape="rect" href="bean.html">Bean</a> language now supports a Camel OGNL notation for invoking beans in a chain like fashion. Suppose the Message&#160;<strong><code>IN</code></strong> body contains a POJO which has a <strong><code>getAddress()</code></strong> method.</p><p>Then you can use Camel OGNL notation to access the address object:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${body.address}&quot;)
simple(&quot;${body.address.street}&quot;)
simple(&quot;${body.address.zip}&quot;)
]]></script>
</div></div><p>Camel understands the shorthand names for accessors, but you can invoke any method or use the real name such as:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${body.address}&quot;)
simple(&quot;${body.getAddress.getStreet}&quot;)
simple(&quot;${body.address.getZip}&quot;)
simple(&quot;${body.doSomething}&quot;)
]]></script>
</div></div><p>You can also use the null safe operator (<strong><code>?.</code></strong>) to avoid NPE if for example the body does <em>not</em> have an address</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${body?.address?.street}&quot;)
]]></script>
</div></div><p>It is also possible to index in <strong><code>Map</code></strong> or <strong><code>List</code></strong> types, so you can do:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${body[foo].name}&quot;)
]]></script>
</div></div><p>To assume the body is <strong><code>Map</code></strong> based and lookup the value with <strong><code>foo</code></strong> as key, and invoke the <strong><code>getName</code></strong> method on that value.</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>If the key has space, then you <em><strong>must</strong></em> enclose the key with quotes, for example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${body[&#39;foo bar&#39;].name}&quot;)
]]></script>
</div></div></div></div><p>You can access the <strong><code>Map</code></strong> or <strong><code>List</code></strong> objects directly using their key name (with or without dots) :</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${body[foo]}&quot;)
simple(&quot;${body[this.is.foo]}&quot;)
]]></script>
</div></div><p>Suppose there was no value with the key <strong><code>foo</code></strong> then you can use the null safe operator to avoid the NPE as shown:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${body[foo]?.name}&quot;)
]]></script>
</div></div><p>You can also access <code>List</code> types, for example to get lines from the address you can do:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${body.address.lines[0]}&quot;)
simple(&quot;${body.address.lines[1]}&quot;)
simple(&quot;${body.address.lines[2]}&quot;)
]]></script>
</div></div><p>There is a special <strong><code>last</code></strong> keyword which can be used to get the last value from a list.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${body.address.lines[last]}&quot;)
]]></script>
</div></div><p>And to get the 2nd last you can subtract a number, so we can use <strong><code>last-1</code></strong> to indicate this:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${body.address.lines[last-1]}&quot;)
]]></script>
</div></div><p>And the 3rd last is of course:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${body.address.lines[last-2]}&quot;)
]]></script>
</div></div><p>And you can call the size method on the list with</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${body.address.lines.size}&quot;)
]]></script>
</div></div><p>From <strong>Camel 2.11.1</strong> we added support for the length field for Java arrays as well, eg:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[String[] lines = new String[]{&quot;foo&quot;, &quot;bar&quot;, &quot;cat&quot;};
exchange.getIn().setBody(lines);

simple(&quot;There are ${body.length} lines&quot;)
]]></script>
</div></div><p>And yes you can combine this with the operator support as shown below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${body.address.zip} &gt; 1000&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-OperatorSupport">Operator Support</h3><p>The parser is limited to only support a single operator. To enable it the left value must be enclosed in <strong><code>${ }</code></strong>.</p><p>The syntax is:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[${leftValue} OP rightValue
]]></script>
</div></div><p>Where the&#160;<strong><code>rightValue</code></strong> can be a&#160;<strong><code>String</code></strong> literal enclosed in&#160;<strong><code>' '</code></strong>, <strong><code>null</code></strong>, a constant value or another expression enclosed in<strong><code> ${}</code></strong>.</p><div class="confluence-information-macro confluence-information-macro-information"><p class="title">Important</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>There <em><strong>must</strong></em> be spaces around the operator.</p></div></div><p>Camel will automatically type convert the&#160;<strong><code>rightValue</code></strong> type to the&#160;<strong><code>leftValue</code></strong> type, so it is possible to for example, convert a string into a numeric so you can use&#160;<strong><code>&gt;</code></strong> comparison for numeric values.</p><p>The following operators are supported:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Operator</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>==</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Equals.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>=~</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16:</strong> equals ignore case (will ignore case when comparing&#160;<strong><code>String</code></strong> values).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>&gt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Greater than.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>&gt;=</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Greater than or equals.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>&lt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Less than.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>&lt;=</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Less than or equals.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>!=</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Not equals.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>contains</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For testing if contains in a string based value.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>not contains</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For testing if not contains in a string based value.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>regex</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For matching against a given regular expression pattern defined as a&#160;<strong><code>String</code></strong> value.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>not regex</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For not matching against a given regular expression pattern defined as a&#160;<strong><code>String</code></strong> value.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>in</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For matching if in a set of values, each element must be separated by comma.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>not in</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For matching if not in a set of values, each element must be separated by comma.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>is</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For matching if the left hand side type is an&#160;<strong><code>instanceof</code></strong> the value.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>not is</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For matching if the left hand side type is not an&#160;<strong><code>instanceof</code></strong> the value.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>range</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For matching if the left hand side is within a range of values defined as numbers: <strong><code>from..to</code></strong>.</p><p>From <strong>Camel 2.9</strong>: the range values must be enclosed in single quotes.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>not range</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For matching if the left hand side is not within a range of values defined as numbers: <strong><code>from..to</code></strong>.</p><p>From <strong>Camel 2.9</strong>: the range values must be enclosed in single quotes.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>starts with</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17.1, 2.18</strong><span>: For testing if the left hand side string starts with the right hand string.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ends with</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17.1, 2.18</strong>: For testing if the left hand side string ends with the right hand string.</p></td></tr></tbody></table></div><p>And the following unary operators can be used:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Operator</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>++</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> To increment a number by one. The left hand side must be a function, otherwise parsed as literal.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>--</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> To decrement a number by one. The left hand side must be a function, otherwise parsed as literal.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>\</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.3 to 2.10.x</strong> To escape a value, e.g., <strong><code>\$</code></strong>, to indicate a&#160;<strong><code>$</code></strong> sign. Special: Use&#160;<strong><code>\n</code></strong> for new line,&#160;<strong><code>\t</code></strong> for tab, and&#160;<strong><code>\r</code></strong> for carriage return. </p><p><strong>Note:</strong> Escaping is <strong>not</strong> supported using the <a shape="rect" href="file-language.html">File Language</a>.</p><p><span style="color: rgb(255,0,0);">&#160;</span><strong><span style="color: rgb(255,0,0);">Note</span>:</strong> from Camel 2.11, <em>the escape character is no longer supported</em>. It has been replaced with the following three escape sequences.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>\n</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> To use newline character.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>\t</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> To use tab character.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>\r</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> To use carriage return character.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>\</code>}</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.18:</strong> To use the&#160;<strong><code>}</code></strong> character as text.</p></td></tr></tbody></table></div><p>And the following logical operators can be used to group expressions:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Operator</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>and</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="color: rgb(255,0,0);"><strong>Deprecated</strong></span> use&#160;<strong><code>&amp;&amp;</code></strong> instead. The logical and operator is used to group two expressions.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>or</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="color: rgb(255,0,0);"><strong>Deprecated</strong></span> use&#160;<strong><code>||</code></strong> instead. The logical or operator is used to group two expressions.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>&amp;&amp;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> The logical and operator is used to group two expressions.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>||</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> The logical or operator is used to group two expressions.</p></td></tr></tbody></table></div><div class="confluence-information-macro confluence-information-macro-information"><p class="title">Using and,or operators</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>In <strong>Camel 2.4 and older</strong> the <strong><code>and</code></strong> or <strong><code>or</code></strong> can only be used <strong>once</strong> in a simple language expression. From <strong>Camel 2.5</strong>: you can use these operators multiple times.</p></div></div><p>The syntax for&#160;<strong><code>AND</code></strong> is:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[${leftValue} OP rightValue and ${leftValue} OP rightValue 
]]></script>
</div></div><p>And the syntax for&#160;<strong><code>OR</code></strong> is:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[${leftValue} OP rightValue or ${leftValue} OP rightValue 
]]></script>
</div></div><p>Some examples:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[// exact equals match
simple(&quot;${in.header.foo} == &#39;foo&#39;&quot;)

// ignore case when comparing, so if the header has value FOO this will match
simple(&quot;${in.header.foo} =~ &#39;foo&#39;&quot;)

// here Camel will type convert &#39;100&#39; into the type of in.header.bar and if it is an Integer &#39;100&#39; will also be converter to an Integer
simple(&quot;${in.header.bar} == &#39;100&#39;&quot;)

simple(&quot;${in.header.bar} == 100&quot;)

// 100 will be converter to the type of in.header.bar so we can do &gt; comparison
simple(&quot;${in.header.bar} &gt; 100&quot;)
]]></script>
</div></div><div class="confluence-information-macro confluence-information-macro-information"><p class="title">Comparing with different types</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>When you compare with different types such as&#160;<strong><code>String</code></strong> and <strong><code>int</code></strong>, then you have to take a bit care. Camel will use the type from the left hand side as first priority. And fallback to the right hand side type if both values couldn't be compared based on that type. This means you can flip the values to enforce a specific type. Suppose the bar value above is a <strong><code>String</code></strong>. Then you can flip the equation:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;100 &lt; ${in.header.bar}&quot;)
]]></script>
</div></div><p>which then ensures the&#160;<strong><code>int</code></strong> type is used as first priority.</p><p>This may change in the future if the Camel team improves the binary comparison operations to prefer numeric types over&#160;<strong><code>String</code></strong> based. It's most often the&#160;<strong><code>String</code></strong> type which causes problem when comparing with numbers.</p></div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[// testing for null
simple(&quot;${in.header.baz} == null&quot;)

// testing for not null
simple(&quot;${in.header.baz} != null&quot;)
]]></script>
</div></div><p>And a bit more advanced example where the right value is another expression,</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${in.header.date} == ${date:now:yyyyMMdd}&quot;)

simple(&quot;${in.header.type} == ${bean:orderService?method=getOrderType}&quot;)
]]></script>
</div></div><p>And an example with contains, testing if the title contains the word Camel</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${in.header.title} contains &#39;Camel&#39;&quot;)
]]></script>
</div></div><p>And an example with regex, testing if the number header is a four digit value:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${in.header.number} regex &#39;\\d{4}&#39;&quot;)
]]></script>
</div></div><p>And finally an example if the header equals any of the values in the list. Each element must be separated by comma, and no space around. This also works for numbers etc, as Camel will convert each element into the type of the left hand side.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${in.header.type} in &#39;gold,silver&#39;&quot;)
]]></script>
</div></div><p>And for all the last three we also support the negate test using <strong><code>not</code></strong>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${in.header.type} not in &#39;gold,silver&#39;&quot;)
]]></script>
</div></div><p>And you can test if the type is a certain instance, e.g., for instance a <strong><code>String</code></strong>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${in.header.type} is &#39;java.lang.String&#39;&quot;)
]]></script>
</div></div><p>We have added a shorthand for all <strong><code>java.lang</code></strong> types so you can write it as:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${in.header.type} is &#39;String&#39;&quot;)
]]></script>
</div></div><p>Ranges are also supported. The range interval requires numbers and both from and end are inclusive. For instance to test whether a value is between&#160;<strong><code>100</code></strong> and <strong><code>199</code>:</strong></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${in.header.number} range 100..199&quot;)
]]></script>
</div></div><p>Notice we use <strong><code>..</code></strong> in the range without spaces. It is based on the same syntax as Groovy.</p><p>From <strong>Camel 2.9</strong> onwards the range value must be in single quotes:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${in.header.number} range &#39;100..199&#39;&quot;)
]]></script>
</div></div><div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Can be used in Spring XML</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>As the Spring XML does not have all the power as the Java DSL with all its various builder methods, you have to resort to use some other languages for testing with simple operators. Now you can do this with the simple language. In the sample below we want to test if the header is a widget order:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;from uri=&quot;seda:orders&quot;&gt;
   &lt;filter&gt;
       &lt;simple&gt;${in.header.type} == &#39;widget&#39;&lt;/simple&gt;
       &lt;to uri=&quot;bean:orderService?method=handleWidget&quot;/&gt;
   &lt;/filter&gt;
&lt;/from&gt;
]]></script>
</div></div></div></div><h4 id="BookInOnePage-Usingand/or">Using&#160;<code>and</code> /&#160;<code>or</code></h4><p>If you have two expressions you can combine them with the <strong><code>and</code></strong> or <strong><code>or</code></strong> operator.</p><div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Camel 2.9 onwards</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Use&#160;<strong><code>&amp;&amp;</code></strong> or&#160;<strong><code>||</code></strong></p></div></div><p>For instance:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${in.header.title} contains &#39;Camel&#39; and ${in.header.type&#39;} == &#39;gold&#39;&quot;)
]]></script>
</div></div><p>And of course the <strong><code>or</code></strong> is also supported. The sample would be:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${in.header.title} contains &#39;Camel&#39; or ${in.header.type&#39;} == &#39;gold&#39;&quot;)
]]></script>
</div></div><p><strong>Note:</strong> currently <strong><code>and</code></strong> or <strong><code>or</code></strong> can only be used <em><strong>once</strong></em> in a simple language expression. This might change in the future. So you <strong>cannot</strong> do:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[simple(&quot;${in.header.title} contains &#39;Camel&#39; and ${in.header.type&#39;} == &#39;gold&#39; and ${in.header.number} range 100..200&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-Samples.3">Samples</h3><p>In the Spring XML sample below we filter based on a header value:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;from uri=&quot;seda:orders&quot;&gt;
   &lt;filter&gt;
       &lt;simple&gt;${in.header.foo}&lt;/simple&gt;
       &lt;to uri=&quot;mock:fooOrders&quot;/&gt;
   &lt;/filter&gt;
&lt;/from&gt;
]]></script>
</div></div><p>The Simple language can be used for the predicate test above in the <a shape="rect" href="message-filter.html">Message Filter</a> pattern, where we test if the in message has a <code>foo</code> header (a header with the key <code>foo</code> exists). If the expression evaluates to <strong>true</strong> then the message is routed to the <code>mock:fooOrders</code> endpoint, otherwise it is lost in the deep blue sea <img class="emoticon emoticon-wink" src="https://cwiki.apache.org/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/icons/emoticons/wink.png" data-emoticon-name="wink" alt="(wink)">.</p><p>The same example in Java DSL:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;seda:orders&quot;)
  .filter().simple(&quot;${in.header.foo}&quot;)
  .to(&quot;seda:fooOrders&quot;);
]]></script>
</div></div><p>You can also use the simple language for simple text concatenations such as:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;direct:hello&quot;)
  .transform().simple(&quot;Hello ${in.header.user} how are you?&quot;)
  .to(&quot;mock:reply&quot;);
]]></script>
</div></div><p>Notice that we must use ${ } placeholders in the expression now to allow Camel to parse it correctly.</p><p>And this sample uses the date command to output current date.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;direct:hello&quot;)
  .transform().simple(&quot;The today is ${date:now:yyyyMMdd} and it is a great day.&quot;)
  .to(&quot;mock:reply&quot;);
]]></script>
</div></div><p>And in the sample below we invoke the bean language to invoke a method on a bean to be included in the returned string:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;direct:order&quot;)
  .transform().simple(&quot;OrderId: ${bean:orderIdGenerator}&quot;)
  .to(&quot;mock:reply&quot;);
]]></script>
</div></div><p>Where <code>orderIdGenerator</code> is the id of the bean registered in the <a shape="rect" href="registry.html">Registry</a>. If using Spring then it is the Spring bean id.</p><p>If we want to declare which method to invoke on the order id generator bean we must prepend <code>.method name</code> such as below where we invoke the <code>generateId</code> method.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;direct:order&quot;)
  .transform().simple(&quot;OrderId: ${bean:orderIdGenerator.generateId}&quot;)
  .to(&quot;mock:reply&quot;);
]]></script>
</div></div><p>We can use the <strong><code>?method=methodname</code></strong> option that we are familiar with the <a shape="rect" href="bean.html">Bean</a> component itself:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;direct:order&quot;)
  .transform().simple(&quot;OrderId: ${bean:orderIdGenerator?method=generateId}&quot;)
  .to(&quot;mock:reply&quot;);
]]></script>
</div></div><p>And from Camel 2.3 you can also convert the body to a given type, for example to ensure that&#160;it is a&#160;<strong><code>String</code></strong> you can do:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;transform&gt;
  &lt;simple&gt;Hello ${bodyAs(String)} how are you?&lt;/simple&gt;
&lt;/transform&gt;
]]></script>
</div></div><p>There are a few types which have a shorthand notation, so we can use <strong><code>String</code></strong> instead of <strong><code>java.lang.String</code></strong>. These are: <strong><code>byte[]</code></strong>, <strong><code>String</code>, <code>Integer</code></strong>,&#160;<strong><code>Long</code></strong>. All other types must use their FQN name, e.g. <strong><code>org.w3c.dom.Document</code></strong>.</p><p>It is&#160;also possible to lookup a value from a header <strong><code>Map</code></strong> in <strong>Camel 2.3</strong>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;transform&gt;
  &lt;simple&gt;The gold value is ${header.type[gold]}&lt;/simple&gt;
&lt;/transform&gt;
]]></script>
</div></div><p>In the code above we lookup the header with name <code>type</code> and regard it as a <strong><code>java.util.Map</code></strong> and we then lookup with the key <strong><code>gold</code></strong> and return the value. If the header is not convertible to Map an exception is thrown. If the header with name <strong><code>type</code></strong> does not exist <strong><code>null</code></strong> is returned.</p><p>From Camel 2.9 you can nest functions, such as shown below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;setHeader headerName=&quot;myHeader&quot;&gt;
  &lt;simple&gt;${properties:${header.someKey}}&lt;/simple&gt;
&lt;/setHeader&gt;
]]></script>
</div></div><h4 id="BookInOnePage-ReferringtoConstantsorEnums">Referring to Constants or Enums</h4><p><strong>Available as of Camel 2.11</strong></p><p>Suppose you have an enum for customers</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public enum Customer {

    GOLD, SILVER, BRONZE
}
]]></script>
</div></div>And in a <a shape="rect" href="content-based-router.html">Content Based Router</a> we can use the <a shape="rect" href="simple.html">Simple</a> language to refer to this enum, to check the message which enum it matches.<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;direct:start&quot;)
    .choice()
        .when().simple(&quot;${header.customer} == ${type:org.apache.camel.processor.Customer.GOLD}&quot;)
            .to(&quot;mock:gold&quot;)
        .when().simple(&quot;${header.customer} == ${type:org.apache.camel.processor.Customer.SILVER}&quot;)
            .to(&quot;mock:silver&quot;)
        .otherwise()
            .to(&quot;mock:other&quot;);
]]></script>
</div></div><h3 id="BookInOnePage-UsingNewLinesorTabsinXMLDSLs">Using New Lines or Tabs in XML DSLs</h3><p><strong>Available as of Camel 2.9.3</strong></p><p>From Camel 2.9.3 it is easier to specify new lines or tabs in XML DSLs as you can escape the value now</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;transform&gt;
  &lt;simple&gt;The following text\nis on a new line&lt;/simple&gt;
&lt;/transform&gt;
]]></script>
</div></div><h3 id="BookInOnePage-LeadingandTrailingWhitespaceHandling">Leading and Trailing Whitespace Handling</h3><p><strong>Available as of Camel 2.10.0</strong></p><p>From Camel 2.10.0, the trim attribute of the expression can be used to control whether the leading and trailing whitespace characters are removed or preserved. The default value is true, which removes the whitespace characters.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;setBody&gt;
  &lt;simple trim=&quot;false&quot;&gt;You get some trailing whitespace characters.     &lt;/simple&gt;
&lt;/setBody&gt;
]]></script>
</div></div><h3 id="BookInOnePage-SettingtheResultType">Setting the Result Type</h3><p><strong>Available as of Camel 2.8</strong></p><p>You can now provide a result type to the <a shape="rect" href="simple.html">Simple</a> expression, which means the result of the evaluation will be converted to the desired type. This is most usable to define types such as <code>boolean</code>'s, <code>integer</code>'s, etc.</p><p>For example to set a header as a&#160;<strong><code>boolean</code></strong> type you can do:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;cool&quot;, simple(&quot;true&quot;, Boolean.class))
]]></script>
</div></div><p>And in XML DSL</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;setHeader headerName=&quot;cool&quot;&gt;
  &lt;!-- use resultType to indicate that the type should be a java.lang.Boolean --&gt;
  &lt;simple resultType=&quot;java.lang.Boolean&quot;&gt;true&lt;/simple&gt;
&lt;/setHeader&gt;
]]></script>
</div></div><h3 id="BookInOnePage-ChangingFunctionStartandEndTokens">Changing Function Start and End Tokens</h3><p><strong>Available as of Camel 2.9.1</strong></p><p>You can configure the function start and end tokens -&#160;<strong><code>${ }</code></strong> using the setters <strong><code>changeFunctionStartToken</code></strong> and <strong><code>changeFunctionEndToken</code></strong> on <strong><code>SimpleLanguage</code></strong>, using Java code. From Spring XML you can define a&#160;<strong><code>&lt;bean&gt;</code></strong> tag with the new changed tokens in the properties as shown below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;!-- configure Simple to use custom prefix/suffix tokens --&gt;
&lt;bean id=&quot;simple&quot; class=&quot;org.apache.camel.language.simple.SimpleLanguage&quot;&gt;
  &lt;property name=&quot;functionStartToken&quot; value=&quot;[&quot;/&gt;
  &lt;property name=&quot;functionEndToken&quot; value=&quot;]&quot;/&gt;
&lt;/bean&gt;
]]></script>
</div></div><p>In the example above we use&#160;<strong><code>[]</code></strong> as the changed tokens. Notice by changing the start/end token you change those in all the Camel applications which share the same&#160;<strong><code>camel-core</code></strong> on their classpath. For example in an OSGi server this may affect many applications, where as a Web Application as a WAR file it only affects the Web Application.</p><h3 id="BookInOnePage-LoadingScriptfromExternalResource">Loading Script from External Resource</h3><p><strong>Available as of Camel 2.11</strong></p><p>You can externalize the script and have Camel load it from a resource such as: <code><strong>classpath:</strong></code>, <code><strong>file:</strong></code>, or <code><strong>http:</strong></code>. This is done using the following syntax: <code><strong>resource:scheme:location</strong></code>, e.g., to refer to a file on the classpath you can do:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).simple(&quot;resource:classpath:mysimple.txt&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-SettingSpringbeanstoExchangeproperties">Setting Spring beans to Exchange properties</h3><p><strong>Available as of Camel 2.6</strong></p><p>You can set a spring bean into an exchange property as shown below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;bean id=&quot;myBeanId&quot; class=&quot;my.package.MyCustomClass&quot;/&gt;

&lt;route&gt;
  &lt;!-- ... --&gt;  
  &lt;setProperty propertyName=&quot;monitoring.message&quot;&gt;
    &lt;simple&gt;ref:myBeanId&lt;/simple&gt;
  &lt;/setProperty&gt;
  &lt;!-- ... --&gt;
&lt;/route&gt;
]]></script>
</div></div><h3 id="BookInOnePage-Dependencies.15">Dependencies</h3><p>The <a shape="rect" href="simple.html">Simple</a> language is part of <strong><code>camel-core</code></strong>.</p>
<h2 id="BookInOnePage-FileExpressionLanguage">File Expression Language</h2><div class="confluence-information-macro confluence-information-macro-information"><p class="title">File language is now merged with Simple language</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>From <strong>Camel 2.2</strong>: the file language is now merged with <a shape="rect" href="simple.html">Simple</a> language which means you can use all the file syntax directly within the simple language.</p></div></div><p>The File Expression Language is an extension to the <a shape="rect" href="simple.html">Simple</a> language, adding file related capabilities. These capabilities are related to common use cases working with file path and names. The goal is to allow expressions to be used with the <a shape="rect" href="file2.html">File</a> and <a shape="rect" href="ftp.html">FTP</a> components for setting dynamic file patterns for both consumer and producer.</p><h3 id="BookInOnePage-Syntax">Syntax</h3><p>This language is an <strong>extension</strong> to the <a shape="rect" href="simple.html">Simple</a> language so the <a shape="rect" href="simple.html">Simple</a> syntax applies also. So the table below only lists the additional. By contrast to the <a shape="rect" href="simple.html">Simple</a> language, the <a shape="rect" href="file-language.html">File Language</a> also supports the use of <a shape="rect" href="constant.html">Constant</a> expressions to enter a fixed filename, for example.</p><p>All the file tokens use the same expression name as the method on the <strong><code>java.io.File</code></strong> object. For example: <strong><code>file:absolute</code></strong> refers to the <strong><code>java.io.File.getAbsolute()</code></strong> method.</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><strong>Note</strong>: not all expressions are supported by the current Exchange. For example, the <a shape="rect" href="ftp.html">FTP</a> component supports some of the options, whereas the <a shape="rect" href="file2.html">File</a> component supports all of them.</div></div><div class="confluenceTableSmall"><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Expression</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>File Consumer</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>File Producer</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>FTP Consumer</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>FTP Producer</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>date:<em>command</em>:<em>pattern</em></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For date formatting using the <strong><code>java.text.SimpleDateFormat</code></strong> patterns which is an <strong>extension</strong> to the <a shape="rect" href="simple.html">Simple</a> language.</p><p>Additional command is:&#160;<strong><code>file</code></strong> (consumers only) for the last modified timestamp of the file.</p><p><strong>Note</strong>: all the commands from the <a shape="rect" href="simple.html">Simple</a> language can also be used.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:absolute</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refers to whether the file is regarded as absolute or relative.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:absolute.path</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refers to the absolute file path.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:ext</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refers to the file extension only.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:length</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Long</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refers to the file length returned as a&#160;<strong><code>Long</code></strong> type.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:modified</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Date</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refers to the file last modified returned as a&#160;<strong><code>Date</code></strong> type.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:name</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refers to the file name (is relative to the starting directory, see note below).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:name.ext</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> refers to the file extension only.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:name.ext.single</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>String</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>yes</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>no</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>yes</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>no</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.14.4/2.15.3:</strong> refers to the file extension. If the file extension has multiple dots, then this expression strips and only returns the last part.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:name.noext</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refers to the file name with no extension (is relative to the starting directory, see note below).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:name.noext.single</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>String</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>yes</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>no</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>yes</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>no</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.14.4/2.15.3:</strong><span> <span>refers to the file name with no extension (is relative to the starting directory, see note below)</span>. If the file extension has multiple dots, then this expression strips only the last part, and keep the others.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:onlyname</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refers to the file name only with no leading paths.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:onlyname.noext</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refers to the file name only with no extension and with no leading paths.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:onlyname.noext.single</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>String</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>yes</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>no</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>yes</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>no</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.14.4/2.15.3: </strong>refers to the file name only with no extension and with no leading paths. I<span>f the file extension has multiple dots, then this expression strips only the last part, and keep the others.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:parent</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refers to the file parent.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:path</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refers to the file path.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:size</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Long</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>yes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> refers to the file length returned as a&#160;<strong><code>Long</code></strong> type.</p></td></tr></tbody></table>
</div></div><h3 id="BookInOnePage-FileTokenExample">File Token Example</h3><h4 id="BookInOnePage-RelativePaths">Relative Paths</h4><p>We have a <strong><code>java.io.File</code></strong> handle for the file <strong><code>hello.txt</code></strong> in the following <em>relative</em> directory: <strong><code>.\filelanguage\test</code></strong>. And we configure our endpoint to use this starting directory <strong><code>.\filelanguage</code></strong>.</p><p>The file tokens returned are:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Expression</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Returns</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:absolute</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:absolute.path</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>\workspace\camel\camel-core\target\filelanguage\test\hello.txt</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:ext</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>txt</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:name</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>test\hello.txt</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:name.ext</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>txt</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:name.noext</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>test\hello</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:onlyname</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hello.txt</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:onlyname.noext</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hello</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:parent</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>filelanguage\test</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:path</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>filelanguage\test\hello.txt</code></p></td></tr></tbody></table></div><h4 id="BookInOnePage-AbsolutePaths">Absolute Paths</h4><p>We have a <strong><code>java.io.File</code></strong> handle for the file <strong><code>hello.txt</code></strong> in the following <em>absolute</em> directory: <strong><code>\workspace\camel\camel-core\target\filelanguage\test</code></strong>. And we configure out endpoint to use the absolute starting directory: <strong><code>\workspace\camel\camel-core\target\filelanguage</code></strong>.</p><p>The file tokens return are:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Expression</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Returns</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:absolute</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:absolute.path</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>\workspace\camel\camel-core\target\filelanguage\test\hello.txt</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:ext</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>txt</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:name</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>test\hello.txt</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:name.ext</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>txt</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:name.noext</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>test\hello</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:onlyname</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hello.txt</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:onlyname.noext</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hello</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:parent</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>\workspace\camel\camel-core\target\filelanguage\test</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>file:path</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>\workspace\camel\camel-core\target\filelanguage\test\hello.txt</code></p></td></tr></tbody></table></div><h3 id="BookInOnePage-Examples.2">Examples</h3><p>You can enter a fixed <a shape="rect" href="constant.html">Constant</a> expression such as <strong><code>myfile.txt</code></strong>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[fileName=&quot;myfile.txt&quot;
]]></script>
</div></div><p>Lets assume we use the file consumer to read files and want to move the read files to backup folder with the current date as a sub folder. This can be achieved using an expression like:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[fileName=&quot;backup/${date:now:yyyyMMdd}/${file:name.noext}.bak&quot;
]]></script>
</div></div><p>relative folder names are also supported so suppose the backup folder should be a sibling folder then you can append&#160;<strong><code>..</code></strong> as:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[fileName=&quot;../backup/${date:now:yyyyMMdd}/${file:name.noext}.bak&quot;
]]></script>
</div></div><p>As this is an extension to the <a shape="rect" href="simple.html">Simple</a> language we have access to all the goodies from this language also, so in this use case we want to use the&#160;<strong><code>in.header.type</code></strong> as a parameter in the dynamic expression:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[fileName=&quot;../backup/${date:now:yyyyMMdd}/type-${in.header.type}/backup-of-${file:name.noext}.bak&quot;
]]></script>
</div></div><p>If you have a custom&#160;<strong><code>Date</code></strong> you want to use in the expression then Camel supports retrieving dates from the message header.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[fileName=&quot;orders/order-${in.header.customerId}-${date:in.header.orderDate:yyyyMMdd}.xml&quot;
]]></script>
</div></div><p>And finally we can also use a bean expression to invoke a POJO class that generates some&#160;<strong><code>String</code></strong> output (or convertible to <strong><code>String</code></strong>) to be used:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[fileName=&quot;uniquefile-${bean:myguidgenerator.generateid}.txt&quot;
]]></script>
</div></div><p>And of course all this can be combined in one expression where you can use the <a shape="rect" href="file-language.html">File Language</a>, <a shape="rect" href="simple.html">Simple</a> and the <a shape="rect" href="bean.html">Bean</a> language in one combined expression. This is pretty powerful for those common file path patterns.</p><h3 id="BookInOnePage-UsingSpring'sPropertyPlaceholderConfigurerwiththeFileComponent">Using Spring's&#160;<code>PropertyPlaceholderConfigurer</code> with the <a shape="rect" href="file2.html">File</a> Component</h3><p>In Camel you can use the <a shape="rect" href="file-language.html">File Language</a> directly from the <a shape="rect" href="simple.html">Simple</a> language which makes a <a shape="rect" href="content-based-router.html">Content Based Router</a> easier to do in Spring XML, where we can route based on file extensions as shown below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;from uri=&quot;file://input/orders&quot;/&gt;
  &lt;choice&gt;
    &lt;when&gt;
      &lt;simple&gt;${file:ext} == &#39;txt&#39;&lt;/simple&gt;
      &lt;to uri=&quot;bean:orderService?method=handleTextFiles&quot;/&gt;
    &lt;/when&gt;
    &lt;when&gt;
      &lt;simple&gt;${file:ext} == &#39;xml&#39;&lt;/simple&gt;
      &lt;to uri=&quot;bean:orderService?method=handleXmlFiles&quot;/&gt;
    &lt;/when&gt;
    &lt;otherwise&gt;
      &lt;to uri=&quot;bean:orderService?method=handleOtherFiles&quot;/&gt;
    &lt;/otherwise&gt;
  &lt;/choice&gt;
]]></script>
</div></div><p>If you use the <strong><code>fileName</code></strong> option on the <a shape="rect" href="file2.html">File</a> endpoint to set a dynamic filename using the <a shape="rect" href="file-language.html">File Language</a> then make sure you use the alternative syntax (available from Camel 2.5) to avoid clashing with Spring's <strong><code>PropertyPlaceholderConfigurer</code></strong>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>bundle-context.xml</b></div><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;bean id=&quot;propertyPlaceholder&quot; class=&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;&gt;
  &lt;property name=&quot;location&quot; value=&quot;classpath:bundle-context.cfg&quot;/&gt;
&lt;/bean&gt;

&lt;bean id=&quot;sampleRoute&quot; class=&quot;SampleRoute&quot;&gt;
  &lt;property name=&quot;fromEndpoint&quot; value=&quot;${fromEndpoint}&quot;/&gt;
  &lt;property name=&quot;toEndpoint&quot; value=&quot;${toEndpoint}&quot;/&gt;
&lt;/bean&gt;
]]></script>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>bundle-context.cfg</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[fromEndpoint=activemq:queue:test
toEndpoint=file://fileRoute/out?fileName=test-$simple{date:now:yyyyMMdd}.txt
]]></script>
</div></div><p>Notice how we use the&#160;<strong><code>$simple{}</code></strong> syntax in the <strong><code>toEndpoint</code></strong> above. If you don't do this, they will clash and Spring will throw an exception:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[org.springframework.beans.factory.BeanDefinitionStoreException:
Invalid bean definition with name &#39;sampleRoute&#39; defined in class path resource [bundle-context.xml]:
Could not resolve placeholder &#39;date:now:yyyyMMdd&#39;
]]></script>
</div></div><h3 id="BookInOnePage-Dependencies.16">Dependencies</h3><p>The File language is part of <strong><code>camel-core</code></strong>.</p> 
<h2 id="BookInOnePage-SQLLanguage">SQL Language</h2><p>The SQL support is added by <a shape="rect" class="external-link" href="http://josql.sourceforge.net/" rel="nofollow">JoSQL</a> and is primarily used for performing SQL queries on in-memory objects. If you prefer to perform actual database queries then check out the <a shape="rect" href="jpa.html">JPA</a> component.</p><div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Looking for the SQL component</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Camel has both a <a shape="rect" href="sql.html">SQL</a> language and a <a shape="rect" href="sql-component.html">SQL Component</a>. This page is about the SQL language. Click on <a shape="rect" href="sql-component.html">SQL Component</a> if you are looking for the component instead.</p></div></div><p>To use SQL in your camel routes you need to add the a dependency on <strong>camel-josql</strong> which implements the SQL language.</p><p>If you use maven you could just add the following to your pom.xml, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-josql&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
  &lt;!-- use the same version as your Camel core version --&gt;
&lt;/dependency&gt;
]]></script>
</div></div><p>Camel supports <a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/SQL" rel="nofollow">SQL</a> to allow an <a shape="rect" href="expression.html">Expression</a> or <a shape="rect" href="predicate.html">Predicate</a> to be used in the <a shape="rect" href="dsl.html">DSL</a> or <a shape="rect" href="xml-configuration.html">Xml Configuration</a>. For example you could use SQL to create an <a shape="rect" href="predicate.html">Predicate</a> in a <a shape="rect" href="message-filter.html">Message Filter</a> or as an <a shape="rect" href="expression.html">Expression</a> for a <a shape="rect" href="recipient-list.html">Recipient List</a>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;queue:foo&quot;).setBody().sql(&quot;select * from MyType&quot;).to(&quot;queue:bar&quot;)
]]></script>
</div></div><p>And the spring DSL:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[   &lt;from uri=&quot;queue:foo&quot;/&gt;
   &lt;setBody&gt;
       &lt;sql&gt;select * from MyType&lt;/sql&gt;
   &lt;/setBody&gt;
   &lt;to uri=&quot;queue:bar&quot;/&gt;
]]></script>
</div></div><h3 id="BookInOnePage-Variables.5">Variables</h3><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Variable</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>exchange</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Exchange</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the Exchange object</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>in</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Message</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the exchange.in message</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>out</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Message</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the exchange.out message</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>the property key</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Object</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the Exchange properties</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>the header key</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Object</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the exchange.in headers</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>the variable key</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Object</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>if any additional variables is added using <code>setVariables</code> method</p></td></tr></tbody></table></div><h3 id="BookInOnePage-Loadingscriptfromexternalresource.3">Loading script from external resource</h3><p><strong>Available as of Camel 2.11</strong></p><p>You can externalize the script and have Camel load it from a resource such as <code>"classpath:"</code>, <code>"file:"</code>, or <code>"http:"</code>.<br clear="none"> This is done using the following syntax: <code>"resource:scheme:location"</code>, eg to refer to a file on the classpath you can do:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).sql(&quot;resource:classpath:mysql.sql&quot;)
]]></script>
</div></div>
<h2 id="BookInOnePage-XPath">XPath</h2><p>Camel supports <a shape="rect" class="external-link" href="http://www.w3.org/TR/xpath" rel="nofollow">XPath</a> to allow an <a shape="rect" href="expression.html">Expression</a> or <a shape="rect" href="predicate.html">Predicate</a> to be used in the <a shape="rect" href="dsl.html">DSL</a> or <a shape="rect" href="xml-configuration.html">Xml Configuration</a>. For example you could use XPath to create an <a shape="rect" href="predicate.html">Predicate</a> in a <a shape="rect" href="message-filter.html">Message Filter</a> or as an <a shape="rect" href="expression.html">Expression</a> for a <a shape="rect" href="recipient-list.html">Recipient List</a>.</p><div class="confluence-information-macro confluence-information-macro-information"><p class="title">Streams</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>If the message body is stream based, which means the input is received by Camel as a stream, then you will only be able to read the content of the stream <strong>once</strong>. Oftentimes when using <a shape="rect" href="xpath.html">XPath</a> as <a shape="rect" href="message-filter.html">Message Filter</a> or <a shape="rect" href="content-based-router.html">Content Based Router</a> the data will be accessed multiple times. Therefore use <a shape="rect" href="stream-caching.html">Stream caching</a> or convert the message body to a <strong><code>String</code></strong> beforehand. This makes it safe to be re-read multiple times.</p></div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;queue:foo&quot;)
  .filter().xpath(&quot;//foo&quot;))
  .to(&quot;queue:bar&quot;)
]]></script>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;queue:foo&quot;)
  .choice().xpath(&quot;//foo&quot;)).to(&quot;queue:bar&quot;)
  .otherwise().to(&quot;queue:others&quot;);
]]></script>
</div></div><h3 id="BookInOnePage-Namespaces">Namespaces</h3><p>You can easily use namespaces with XPath expressions using the Namespaces helper class.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
Namespaces ns = new Namespaces(&quot;c&quot;, &quot;http://acme.com/cheese&quot;);

from(&quot;direct:start&quot;).filter().
        xpath(&quot;/c:person[@name=&#39;James&#39;]&quot;, ns).
        to(&quot;mock:result&quot;);
]]></script>
</div></div><h3 id="BookInOnePage-Variables.6">Variables</h3><p>Variables in XPath is defined in different namespaces. The default namespace is <code><a shape="rect" class="external-link" href="http://camel.apache.org/schema/spring">http://camel.apache.org/schema/spring</a></code>.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Namespace URI</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Local part</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><a shape="rect" class="external-link" href="http://camel.apache.org/xml/in/">http://camel.apache.org/xml/in/</a></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>in</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Message</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The&#160;<strong><code>exchange.in</code></strong> message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><a shape="rect" class="external-link" href="http://camel.apache.org/xml/out/">http://camel.apache.org/xml/out/</a></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>out</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Message</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The&#160;<strong><code>exchange.out</code></strong> message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><a shape="rect" class="external-link" href="http://camel.apache.org/xml/function/">http://camel.apache.org/xml/function/</a></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>functions</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> Additional functions.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><a shape="rect" class="external-link" href="http://camel.apache.org/xml/variables/environment-variables">http://camel.apache.org/xml/variables/environment-variables</a></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>env</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>Object</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>OS environment variables.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><a shape="rect" class="external-link" href="http://camel.apache.org/xml/variables/system-properties">http://camel.apache.org/xml/variables/system-properties</a></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>system</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>Object</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Java System properties.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><a shape="rect" class="external-link" href="http://camel.apache.org/xml/variables/exchange-property">http://camel.apache.org/xml/variables/exchange-property</a></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The exchange property.</p></td></tr></tbody></table></div><p>Camel will resolve variables according to either:</p><ul class="alternate"><li>namespace given</li><li>no namespace given</li></ul><h4 id="BookInOnePage-NamespaceGiven">Namespace Given</h4><p>If the namespace is given then Camel is instructed exactly what to return. However when resolving either&#160;<strong><code>IN</code></strong> or&#160;<strong><code>OUT</code></strong> Camel will try to resolve a header with the given local part first, and return it. If the local part has the value&#160;<strong><code>body</code></strong> then the body is returned instead.</p><h4 id="BookInOnePage-NoNamespaceGiven">No Namespace Given</h4><p>If there is no namespace given then Camel resolves only based on the local part. Camel will try to resolve a variable in the following steps:</p><ul class="alternate"><li>From <strong><code>variables</code></strong> that has been set using the <strong><code>variable(name, value)</code></strong> fluent builder.</li><li>From&#160;<strong><code>message.in.header</code></strong> if there is a header with the given key.</li><li>From&#160;<strong><code>exchange.properties</code></strong> if there is a property with the given key.</li></ul><h3 id="BookInOnePage-Functions">Functions</h3><p>Camel adds the following XPath functions that can be used to access the exchange:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Function</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Argument</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>in:body</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>none</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Will return the&#160;<strong><code>IN</code></strong> message body.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>in:header</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the header name</p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>Object</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Will return the&#160;<strong><code>IN</code></strong> message header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>out:body</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>none</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Will return the&#160;<strong><code>OUT</code></strong> message body.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>out:header</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the header name</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Will return the&#160;<strong><code>OUT</code></strong> message header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>function:properties</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>key for property</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> To lookup a property using the <a shape="rect" href="properties.html">Properties</a> component (property placeholders).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>function:simple</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>simple expression</p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>Object</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> To evaluate a <a shape="rect" href="simple.html">Simple</a> expression.</p></td></tr></tbody></table></div><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><strong>Note: <code>function:properties</code></strong> and <strong><code>function:simple</code></strong> is not supported when the return type is a <strong><code>NodeSet</code></strong>, such as when using with a <a shape="rect" href="splitter.html">Splitter</a> EIP.</div></div><p>Here's an example showing some of these functions in use.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;direct:start&quot;).choice()
  .when().xpath(&quot;in:header(&#39;foo&#39;) = &#39;bar&#39;&quot;).to(&quot;mock:x&quot;)
  .when().xpath(&quot;in:body() = &#39;&lt;two/&gt;&#39;&quot;).to(&quot;mock:y&quot;)
  .otherwise().to(&quot;mock:z&quot;);
]]></script>
</div></div>And the new functions introduced in Camel 2.5:<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// setup properties component
PropertiesComponent properties = new PropertiesComponent();
properties.setLocation(&quot;classpath:org/apache/camel/builder/xml/myprop.properties&quot;);
context.addComponent(&quot;properties&quot;, properties);

// myprop.properties contains the following properties
// foo=Camel
// bar=Kong

from(&quot;direct:in&quot;).choice()
    // $type is a variable for the header with key type
    // here we use the properties function to lookup foo from the properties files
    // which at runtime will be evaluted to &#39;Camel&#39;
    .when().xpath(&quot;$type = function:properties(&#39;foo&#39;)&quot;)
        .to(&quot;mock:camel&quot;)
    // here we use the simple language to evaluate the expression
    // which at runtime will be evaluated to &#39;Donkey Kong&#39;
    .when().xpath(&quot;//name = function:simple(&#39;Donkey ${properties:bar}&#39;)&quot;)
        .to(&quot;mock:donkey&quot;)
    .otherwise()
        .to(&quot;mock:other&quot;)
    .end();
]]></script>
</div></div><h3 id="BookInOnePage-UsingXMLConfiguration">Using XML Configuration</h3><p>If you prefer to configure your routes in your <a shape="rect" href="spring.html">Spring</a> XML file then you can use XPath expressions as follows</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd&quot;&gt;

  &lt;camelContext id=&quot;camel&quot; xmlns=&quot;http://activemq.apache.org/camel/schema/spring&quot; xmlns:foo=&quot;http://example.com/person&quot;&gt;
    &lt;route&gt;
      &lt;from uri=&quot;activemq:MyQueue&quot;/&gt;
      &lt;filter&gt;
        &lt;xpath&gt;/foo:person[@name=&#39;James&#39;]&lt;/xpath&gt;
        &lt;to uri=&quot;mqseries:SomeOtherQueue&quot;/&gt;
      &lt;/filter&gt;
    &lt;/route&gt;
  &lt;/camelContext&gt;
&lt;/beans&gt;
]]></script>
</div></div><p>Notice how we can reuse the namespace prefixes,&#160;<strong><code>foo</code></strong> in this case, in the XPath expression for easier namespace based XPath expressions! See also this <a shape="rect" class="external-link" href="http://camel.465427.n5.nabble.com/fail-filter-XPATH-camel-td476424.html" rel="nofollow">discussion on the mailinglist</a> about using your own namespaces with XPath.</p><h3 id="BookInOnePage-SettingtheResultType.1">Setting the Result Type</h3><p>The <a shape="rect" href="xpath.html">XPath</a> expression will return a result type using native XML objects such as <strong><code>org.w3c.dom.NodeList</code></strong>. But many times you want a result type to be a <strong><code>String</code></strong>. To do this you have to instruct the <a shape="rect" href="xpath.html">XPath</a> which result type to use.</p><p>In Java DSL:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[xpath(&quot;/foo:person/@id&quot;, String.class)
]]></script>
</div></div><p>In Spring DSL you use the&#160;<strong><code>resultType</code></strong> attribute to provide a fully qualified classname:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;xpath resultType=&quot;java.lang.String&quot;&gt;/foo:person/@id&lt;/xpath&gt;
]]></script>
</div></div><p>In <strong><code>@XPath</code></strong>:<br clear="none"> <strong>Available as of Camel 2.1</strong></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@XPath(value = &quot;concat(&#39;foo-&#39;,//order/name/)&quot;, resultType = String.class) String name)
]]></script>
</div></div><p>Where we use the XPath function&#160;<strong><code>concat</code></strong> to prefix the order name with <strong><code>foo-</code></strong>. In this case we have to specify that we want a&#160;<strong><code>String</code></strong> as result type so the&#160;<strong><code>concat</code></strong> function works.</p><h3 id="BookInOnePage-UsingXPathonHeaders">Using XPath on Headers</h3><p><strong>Available as of Camel 2.11</strong></p><p>Some users may have XML stored in a header. To apply an XPath statement to a header's value you can do this by defining the&#160;<strong><code>headerName</code></strong> attribute.</p><p>In XML DSL:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;camelContext id=&quot;xpathHeaderNameTest&quot; xmlns=&quot;http://camel.apache.org/schema/blueprint&quot;&gt;
  &lt;route&gt;
    &lt;from uri=&quot;direct:in&quot;/&gt;
    &lt;choice&gt;
      &lt;when&gt;
        &lt;!-- use headerName attribute to refer to a header --&gt;
        &lt;xpath headerName=&quot;invoiceDetails&quot;&gt;/invoice/@orderType = &#39;premium&#39;&lt;/xpath&gt;
        &lt;to uri=&quot;mock:premium&quot;/&gt;
      &lt;/when&gt;
      &lt;when&gt;
        &lt;!-- use headerName attribute to refer to a header --&gt;
        &lt;xpath headerName=&quot;invoiceDetails&quot;&gt;/invoice/@orderType = &#39;standard&#39;&lt;/xpath&gt;
        &lt;to uri=&quot;mock:standard&quot;/&gt;
      &lt;/when&gt;
      &lt;otherwise&gt;
        &lt;to uri=&quot;mock:unknown&quot;/&gt;
      &lt;/otherwise&gt;
    &lt;/choice&gt;
  &lt;/route&gt;
&lt;/camelContext&gt;
]]></script>
</div></div>And in Java DSL you specify the&#160;<strong><code>headerName</code></strong> as the 2nd parameter as shown:<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[xpath(&quot;/invoice/@orderType = &#39;premium&#39;&quot;, &quot;invoiceDetails&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-Examples.3">Examples</h3><p>Here is a simple <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/XPathFilterTest.java">example</a> using an XPath expression as a predicate in a <a shape="rect" href="message-filter.html">Message Filter</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;direct:start&quot;).
        filter().xpath(&quot;/person[@name=&#39;James&#39;]&quot;).
        to(&quot;mock:result&quot;);
]]></script>
</div></div>If you have a standard set of namespaces you wish to work with and wish to share them across many different XPath expressions you can use the&#160;<strong><code>NamespaceBuilder</code></strong> as shown <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/XPathWithNamespaceBuilderFilterTest.java">in this example</a><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// lets define the namespaces we&#39;ll need in our filters
Namespaces ns = new Namespaces(&quot;c&quot;, &quot;http://acme.com/cheese&quot;)
        .add(&quot;xsd&quot;, &quot;http://www.w3.org/2001/XMLSchema&quot;);

// now lets create an xpath based Message Filter
from(&quot;direct:start&quot;).
        filter(ns.xpath(&quot;/c:person[@name=&#39;James&#39;]&quot;)).
        to(&quot;mock:result&quot;);
]]></script>
</div></div>In this sample we have a&#160;<strong><code>choice</code></strong> construct. The first choice evaulates if the message has a header key&#160;<strong><code>type</code></strong> that has the value <strong><code>Camel</code></strong>. The 2nd&#160;<strong><code>choice</code></strong> evaluates if the message body has a name tag&#160;<strong><code>&lt;name&gt;</code></strong> which values is <strong><code>Kong</code></strong>.<br clear="none"> If neither is true the message is routed in the otherwise block:<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;direct:in&quot;).choice()
    // using $headerName is special notation in Camel to get the header key
    .when().xpath(&quot;$type = &#39;Camel&#39;&quot;)
        .to(&quot;mock:camel&quot;)
    // here we test for the body name tag
    .when().xpath(&quot;//name = &#39;Kong&#39;&quot;)
        .to(&quot;mock:donkey&quot;)
    .otherwise()
        .to(&quot;mock:other&quot;)
    .end();
]]></script>
</div></div>And the spring XML equivalent of the route:<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;camelContext xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;
    &lt;route&gt;
        &lt;from uri=&quot;direct:in&quot;/&gt;
        &lt;choice&gt;
            &lt;when&gt;
                &lt;xpath&gt;$type = &#39;Camel&#39;&lt;/xpath&gt;
                &lt;to uri=&quot;mock:camel&quot;/&gt;
            &lt;/when&gt;
            &lt;when&gt;
                &lt;xpath&gt;//name = &#39;Kong&#39;&lt;/xpath&gt;
                &lt;to uri=&quot;mock:donkey&quot;/&gt;
            &lt;/when&gt;
            &lt;otherwise&gt;
                &lt;to uri=&quot;mock:other&quot;/&gt;
            &lt;/otherwise&gt;
        &lt;/choice&gt;
    &lt;/route&gt;
&lt;/camelContext&gt;
]]></script>
</div></div><h2 id="BookInOnePage-XPathInjection">XPath Injection</h2><p>You can use <a shape="rect" href="bean-integration.html">Bean Integration</a> to invoke a method on a bean and use various languages such as XPath to extract a value from the message and bind it to a method parameter.</p><p>The default XPath annotation has SOAP and XML namespaces available. If you want to use your own namespace URIs in an XPath expression you can use your own copy of the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/language/XPath.html">XPath annotation</a> to create whatever namespace prefixes you want to use.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

import org.w3c.dom.NodeList;

import org.apache.camel.component.bean.XPathAnnotationExpressionFactory;
import org.apache.camel.language.LanguageAnnotation;
import org.apache.camel.language.NamespacePrefix;

@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.FIELD, ElementType.METHOD, ElementType.PARAMETER})
@LanguageAnnotation(language = &quot;xpath&quot;, factory = XPathAnnotationExpressionFactory.class)
public @interface MyXPath {
    String value();

    // You can add the namespaces as the default value of the annotation
    NamespacePrefix[] namespaces() default {
    @NamespacePrefix(prefix = &quot;n1&quot;, uri = &quot;http://example.org/ns1&quot;),
    @NamespacePrefix(prefix = &quot;n2&quot;, uri = &quot;http://example.org/ns2&quot;)};

    Class&lt;?&gt; resultType() default NodeList.class;
}
]]></script>
</div></div>e.g., cut and paste upper code to your own project in a different package and/or annotation name then add whatever namespace prefix/URIs you want in scope when you use your annotation on a method parameter. Then when you use your annotation on a method parameter all the namespaces you want will be available for use in your XPath expression.<p>Example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public class Foo {
	
    @MessageDriven(uri = &quot;activemq:my.queue&quot;)
    public void doSomething(@MyXPath(&quot;/ns1:foo/ns2:bar/text()&quot;) String correlationID, @Body String body) {
		// process the inbound message here
    }
}
]]></script>
</div></div><h3 id="BookInOnePage-UsingXPathBuilderWithoutanExchange">Using XPathBuilder Without an Exchange</h3><p><strong>Available as of Camel 2.3</strong></p><p>You can now use the <strong><code>org.apache.camel.builder.XPathBuilder</code></strong> without the need for an <a shape="rect" href="exchange.html">Exchange</a>. This comes handy if you want to use it as a helper to do custom XPath evaluations. It requires that you pass in a <a shape="rect" href="camelcontext.html">CamelContext</a> since a lot of the moving parts inside the&#160;<strong><code>XPathBuilder</code></strong> requires access to the Camel <a shape="rect" href="type-converter.html">Type Converter</a> and hence why <a shape="rect" href="camelcontext.html">CamelContext</a> is needed.</p><p>For example you can do something like this:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[boolean matches = XPathBuilder.xpath(&quot;/foo/bar/@xyz&quot;).matches(context, &quot;&lt;foo&gt;&lt;bar xyz=&#39;cheese&#39;/&gt;&lt;/foo&gt;&quot;));
]]></script>
</div></div><p>This will match the given predicate.</p><p>You can also evaluate for example as shown in the following three examples:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[String name = XPathBuilder.xpath(&quot;foo/bar&quot;).evaluate(context, &quot;&lt;foo&gt;&lt;bar&gt;cheese&lt;/bar&gt;&lt;/foo&gt;&quot;, String.class);
Integer number = XPathBuilder.xpath(&quot;foo/bar&quot;).evaluate(context, &quot;&lt;foo&gt;&lt;bar&gt;123&lt;/bar&gt;&lt;/foo&gt;&quot;, Integer.class);
Boolean bool = XPathBuilder.xpath(&quot;foo/bar&quot;).evaluate(context, &quot;&lt;foo&gt;&lt;bar&gt;true&lt;/bar&gt;&lt;/foo&gt;&quot;, Boolean.class);
]]></script>
</div></div><p>Evaluating with a String result is a common requirement and thus you can do it a bit simpler:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[    String name = XPathBuilder.xpath(&quot;foo/bar&quot;).evaluate(context, &quot;&lt;foo&gt;&lt;bar&gt;cheese&lt;/bar&gt;&lt;/foo&gt;&quot;);
]]></script>
</div></div><h3 id="BookInOnePage-UsingSaxonwithXPathBuilder">Using Saxon with XPathBuilder</h3><p><strong>Available as of Camel 2.3</strong></p><p>You need to add <strong><code>camel-saxon</code></strong> as dependency to your project. It's now easier to use <a shape="rect" class="external-link" href="http://saxon.sourceforge.net/" rel="nofollow">Saxon</a> with the&#160;<strong><code>XPathBuilder</code></strong> which can be done in several ways as shown below. Where as the latter ones are the easiest ones.</p><p>Using a factory</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// create a Saxon factory
XPathFactory fac = new net.sf.saxon.xpath.XPathFactoryImpl();

// create a builder to evaluate the xpath using the saxon factory
XPathBuilder builder = XPathBuilder.xpath(&quot;tokenize(/foo/bar, &#39;_&#39;)[2]&quot;).factory(fac);

// evaluate as a String result
String result = builder.evaluate(context, &quot;&lt;foo&gt;&lt;bar&gt;abc_def_ghi&lt;/bar&gt;&lt;/foo&gt;&quot;);
assertEquals(&quot;def&quot;, result);
]]></script>
</div></div>Using the object model<strong><br clear="none"></strong><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// create a builder to evaluate the xpath using saxon based on its object model uri
XPathBuilder builder = XPathBuilder.xpath(&quot;tokenize(/foo/bar, &#39;_&#39;)[2]&quot;).objectModel(&quot;http://saxon.sf.net/jaxp/xpath/om&quot;);

// evaluate as a String result
String result = builder.evaluate(context, &quot;&lt;foo&gt;&lt;bar&gt;abc_def_ghi&lt;/bar&gt;&lt;/foo&gt;&quot;);
assertEquals(&quot;def&quot;, result);
]]></script>
</div></div>The easy one<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// create a builder to evaluate the xpath using saxon
XPathBuilder builder = XPathBuilder.xpath(&quot;tokenize(/foo/bar, &#39;_&#39;)[2]&quot;).saxon();

// evaluate as a String result
String result = builder.evaluate(context, &quot;&lt;foo&gt;&lt;bar&gt;abc_def_ghi&lt;/bar&gt;&lt;/foo&gt;&quot;);
assertEquals(&quot;def&quot;, result);
]]></script>
</div></div><h3 id="BookInOnePage-SettingaCustomXPathFactoryUsingSystemProperty">Setting a Custom XPathFactory Using System Property</h3><p><strong>Available as of Camel 2.3</strong></p><p>Camel now supports reading the <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/xpath/XPathFactory.html#newInstance(java.lang.String)" rel="nofollow">JVM system property <code>javax.xml.xpath.XPathFactory</code></a> that can be used to set a custom&#160;<strong><code>XPathFactory</code></strong> to use.</p><p>This unit test shows how this can be done to use Saxon instead:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// set system property with the XPath factory to use which is Saxon 
System.setProperty(XPathFactory.DEFAULT_PROPERTY_NAME + &quot;:&quot; + &quot;http://saxon.sf.net/jaxp/xpath/om&quot;, &quot;net.sf.saxon.xpath.XPathFactoryImpl&quot;);

// create a builder to evaluate the xpath using saxon
XPathBuilder builder = XPathBuilder.xpath(&quot;tokenize(/foo/bar, &#39;_&#39;)[2]&quot;);

// evaluate as a String result
String result = builder.evaluate(context, &quot;&lt;foo&gt;&lt;bar&gt;abc_def_ghi&lt;/bar&gt;&lt;/foo&gt;&quot;);
assertEquals(&quot;def&quot;, result);
]]></script>
</div></div>Camel will log at <strong><code>INFO</code></strong> level if it uses a non default&#160;<strong><code>XPathFactory</code></strong> such as:<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[XPathBuilder  INFO  Using system property javax.xml.xpath.XPathFactory:http://saxon.sf.net/jaxp/xpath/om with value:
                    net.sf.saxon.xpath.XPathFactoryImpl when creating XPathFactory
]]></script>
</div></div><p>To use Apache Xerces you can configure the system property:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[-Djavax.xml.xpath.XPathFactory=org.apache.xpath.jaxp.XPathFactoryImpl
]]></script>
</div></div><h3 id="BookInOnePage-EnablingSaxonfromSpringDSL">Enabling Saxon from Spring DSL</h3><p><strong>Available as of Camel 2.10</strong></p><p>Similarly to Java DSL, to enable Saxon from Spring DSL you have three options:</p><p>Specifying the factory</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;xpath factoryRef=&quot;saxonFactory&quot; resultType=&quot;java.lang.String&quot;&gt;current-dateTime()&lt;/xpath&gt;
]]></script>
</div></div><p>Specifying the object model</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;xpath objectModel=&quot;http://saxon.sf.net/jaxp/xpath/om&quot; resultType=&quot;java.lang.String&quot;&gt;current-dateTime()&lt;/xpath&gt;
]]></script>
</div></div><p>Shortcut</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;xpath saxon=&quot;true&quot; resultType=&quot;java.lang.String&quot;&gt;current-dateTime()&lt;/xpath&gt;
]]></script>
</div></div><h3 id="BookInOnePage-NamespaceAuditingtoAidDebugging">Namespace Auditing to Aid Debugging</h3><p><strong>Available as of Camel 2.10</strong></p><p>A large number of XPath-related issues that users frequently face are linked to the usage of namespaces. You may have some misalignment between the namespaces present in your message and those that your XPath expression is aware of or referencing. XPath predicates or expressions that are unable to locate the XML elements and attributes due to namespaces issues may simply look like "they are not working", when in reality all there is to it is a lack of namespace definition.</p><p>Namespaces in XML are completely necessary, and while we would love to simplify their usage by implementing some magic or voodoo to wire namespaces automatically, truth is that any action down this path would disagree with the standards and would greatly hinder interoperability.</p><p>Therefore, the utmost we can do is assist you in debugging such issues by adding two new features to the XPath Expression Language and are thus accessible from both predicates and expressions.</p><h4 id="BookInOnePage-LoggingtheNamespaceContextofYourXPathExpression/Predicate">Logging the Namespace Context of Your XPath Expression/Predicate</h4><p>Every time a new XPath expression is created in the internal pool, Camel will log the namespace context of the expression under the <strong><code>org.apache.camel.builder.xml.XPathBuilder</code></strong> logger. Since Camel represents Namespace Contexts in a hierarchical fashion (parent-child relationships), the entire tree is output in a recursive manner with the following format:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[[me: {prefix -&gt; namespace}, {prefix -&gt; namespace}], [parent: [me: {prefix -&gt; namespace}, {prefix -&gt; namespace}], [parent: [me: {prefix -&gt; namespace}]]]
]]></script>
</div></div><p>Any of these options can be used to activate this logging:</p><ol><li>Enable&#160;<strong><code>TRACE</code></strong> logging on the <strong><code>org.apache.camel.builder.xml.XPathBuilder</code></strong> logger, or some parent logger such as <strong><code>org.apache.camel</code></strong> or the root logger.</li><li>Enable the <strong><code>logNamespaces</code></strong> option as indicated in <a shape="rect" href="#BookInOnePage-AuditingNamespaces">Auditing Namespaces</a>, in which case the logging will occur on the&#160;<strong><code>INFO</code></strong> level.</li></ol><p><span class="confluence-anchor-link" id="BookInOnePage-AuditingNamespaces"></span></p><h4 id="BookInOnePage-Auditingnamespaces">Auditing namespaces</h4><p>Camel is able to discover and dump all namespaces present on every incoming message before evaluating an XPath expression, providing all the richness of information you need to help you analyse and pinpoint possible namespace issues. To achieve this, it in turn internally uses another specially tailored XPath expression to extract all namespace mappings that appear in the message, displaying the prefix and the full namespace URI(s) for each individual mapping.</p><p>Some points to take into account:</p><ul><li>The implicit XML namespace (xmlns:xml="http://www.w3.org/XML/1998/namespace") is suppressed from the output because it adds no value.</li><li>Default namespaces are listed under the&#160;<strong><code>DEFAULT</code></strong> keyword in the output.</li><li>Keep in mind that namespaces can be remapped under different scopes. Think of a top-level 'a' prefix which in inner elements can be assigned a different namespace, or the default namespace changing in inner scopes. For each discovered prefix, all associated URIs are listed.</li></ul><p>You can enable this option in Java DSL and Spring DSL.</p><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[XPathBuilder.xpath(&quot;/foo:person/@id&quot;, String.class).logNamespaces()
]]></script>
</div></div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;xpath logNamespaces=&quot;true&quot; resultType=&quot;String&quot;&gt;/foo:person/@id&lt;/xpath&gt;
]]></script>
</div></div><p>The result of the auditing will be appear at the&#160;<strong><code>INFO</code></strong> level under the <strong><code>org.apache.camel.builder.xml.XPathBuilder</code></strong> logger and will look like the following:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[2012-01-16 13:23:45,878 [stSaxonWithFlag] INFO  XPathBuilder  - Namespaces discovered in message: 
{xmlns:a=[http://apache.org/camel], DEFAULT=[http://apache.org/default], 
xmlns:b=[http://apache.org/camelA, http://apache.org/camelB]}
]]></script>
</div></div><h3 id="BookInOnePage-LoadingScriptfromExternalResource.1">Loading Script from External Resource</h3><p><strong>Available as of Camel 2.11</strong></p><p>You can externalize the script and have Camel load it from a resource such as: <strong><code>classpath:</code></strong>, <code><strong>file:</strong></code> or <code><strong>http:</strong></code>.<br clear="none"> This is done using the following syntax: <code><strong>resource:scheme:location</strong></code>, e.g., to refer to a file on the classpath you can do:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).xpath(&quot;resource:classpath:myxpath.txt&quot;, String.class)
]]></script>
</div></div><h3 id="BookInOnePage-Dependencies.17">Dependencies</h3><p>The XPath language is part of camel-core.</p>
<h2 id="BookInOnePage-XQuery">XQuery</h2><p>Camel supports <a shape="rect" class="external-link" href="http://www.w3.org/TR/xquery/" rel="nofollow">XQuery</a> to allow an <a shape="rect" href="expression.html">Expression</a> or <a shape="rect" href="predicate.html">Predicate</a> to be used in the <a shape="rect" href="dsl.html">DSL</a> or <a shape="rect" href="xml-configuration.html">Xml Configuration</a>. For example you could use XQuery to create an <a shape="rect" href="predicate.html">Predicate</a> in a <a shape="rect" href="message-filter.html">Message Filter</a> or as an <a shape="rect" href="expression.html">Expression</a> for a <a shape="rect" href="recipient-list.html">Recipient List</a>.</p><h3 id="BookInOnePage-Options.2">Options</h3><div class="confluenceTableSmall"><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>allowStAX</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8.3/2.9:</strong> Whether to allow using StAX as the <code>javax.xml.transform.Source</code>.</p></td></tr></tbody></table>
</div></div><h3 id="BookInOnePage-Examples.4">Examples</h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;queue:foo&quot;).filter().
  xquery(&quot;//foo&quot;).
  to(&quot;queue:bar&quot;)
]]></script>
</div></div><p>You can also use functions inside your query, in which case you need an explicit type conversion (or you will get a org.w3c.dom.DOMException: HIERARCHY_REQUEST_ERR) by passing the Class as a second argument to the <strong>xquery()</strong> method.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;direct:start&quot;).
  recipientList().xquery(&quot;concat(&#39;mock:foo.&#39;, /person/@city)&quot;, String.class);
]]></script>
</div></div><h3 id="BookInOnePage-Variables.7">Variables</h3><p>The IN message body will be set as the <code>contextItem</code>. Besides this these Variables is also added as parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Variable</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>exchange</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Exchange</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The current Exchange</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>in.body</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Object</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The In message's body</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>out.body</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Object</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The OUT message's body (if any)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>in.headers.*</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Object</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>You can access the value of exchange.in.headers with key <strong>foo</strong> by using the variable which name is in.headers.foo</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>out.headers.*</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Object</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>You can access the value of exchange.out.headers with key <strong>foo</strong> by using the variable which name is out.headers.foo variable</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>key name</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Object</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Any exchange.properties and exchange.in.headers and any additional parameters set using <code>setParameters(Map)</code>. These parameters is added with they own key name, for instance if there is an IN header with the key name <strong>foo</strong> then its added as <strong>foo</strong>.</p></td></tr></tbody></table></div><h3 id="BookInOnePage-UsingXMLconfiguration.1">Using XML configuration</h3><p>If you prefer to configure your routes in your <a shape="rect" href="spring.html">Spring</a> XML file then you can use XPath expressions as follows</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:foo=&quot;http://example.com/person&quot;
       xsi:schemaLocation=&quot;
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd&quot;&gt;

  &lt;camelContext id=&quot;camel&quot; xmlns=&quot;http://activemq.apache.org/camel/schema/spring&quot;&gt;
    &lt;route&gt;
      &lt;from uri=&quot;activemq:MyQueue&quot;/&gt;
      &lt;filter&gt;
        &lt;xquery&gt;/foo:person[@name=&#39;James&#39;]&lt;/xquery&gt;
        &lt;to uri=&quot;mqseries:SomeOtherQueue&quot;/&gt;
      &lt;/filter&gt;
    &lt;/route&gt;
  &lt;/camelContext&gt;
&lt;/beans&gt;
]]></script>
</div></div><p>Notice how we can reuse the namespace prefixes, <strong>foo</strong> in this case, in the XPath expression for easier namespace based XQuery expressions!</p><p>When you use functions in your XQuery expression you need an explicit type conversion which is done in the xml configuration via the <strong>@type</strong> attribute:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[    &lt;xquery type=&quot;java.lang.String&quot;&gt;concat(&#39;mock:foo.&#39;, /person/@city)&lt;/xquery&gt;
]]></script>
</div></div><h3 id="BookInOnePage-UsingXQueryastransformation">Using XQuery as transformation</h3><p>We can do a message translation using transform or setBody in the route, as shown below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;direct:start&quot;).
   transform().xquery(&quot;/people/person&quot;);]]></script>
</div></div><p>Notice that xquery will use DOMResult by default, so if we want to grab the value of the person node, using text() we need to tell xquery to use String as result type, as shown:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;direct:start&quot;).
   transform().xquery(&quot;/people/person/text()&quot;, String.class);]]></script>
</div></div><p>&#160;</p><h3 id="BookInOnePage-UsingXQueryasanendpoint">Using XQuery as an endpoint</h3><p>Sometimes an XQuery expression can be quite large; it can essentally be used for <a shape="rect" href="templating.html">Templating</a>. So you may want to use an <a shape="rect" href="xquery-endpoint.html">XQuery Endpoint</a> so you can route using XQuery templates.</p><p>The following example shows how to take a message of an ActiveMQ queue (MyQueue) and transform it using XQuery and send it to MQSeries.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[  &lt;camelContext id=&quot;camel&quot; xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;
    &lt;route&gt;
      &lt;from uri=&quot;activemq:MyQueue&quot;/&gt;
      &lt;to uri=&quot;xquery:com/acme/someTransform.xquery&quot;/&gt;
      &lt;to uri=&quot;mqseries:SomeOtherQueue&quot;/&gt;
    &lt;/route&gt;
  &lt;/camelContext&gt;
]]></script>
</div></div><h3 id="BookInOnePage-Examples.5">Examples</h3><p>Here is a simple <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-saxon/src/test/java/org/apache/camel/builder/saxon/XQueryFilterTest.java">example</a> using an XQuery expression as a predicate in a <a shape="rect" href="message-filter.html">Message Filter</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;direct:start&quot;).filter().xquery(&quot;/person[@name=&#39;James&#39;]&quot;).to(&quot;mock:result&quot;);
]]></script>
</div></div><p>This <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-saxon/src/test/java/org/apache/camel/builder/saxon/XQueryWithNamespacesFilterTest.java">example</a> uses XQuery with namespaces as a predicate in a <a shape="rect" href="message-filter.html">Message Filter</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
Namespaces ns = new Namespaces(&quot;c&quot;, &quot;http://acme.com/cheese&quot;);

from(&quot;direct:start&quot;).
        filter().xquery(&quot;/c:person[@name=&#39;James&#39;]&quot;, ns).
        to(&quot;mock:result&quot;);
]]></script>
</div></div><h3 id="BookInOnePage-LearningXQuery">Learning XQuery</h3><p>XQuery is a very powerful language for querying, searching, sorting and returning XML. For help learning XQuery try these tutorials</p><ul><li>Mike Kay's <a shape="rect" class="external-link" href="http://www.stylusstudio.com/xquery_primer.html" rel="nofollow">XQuery Primer</a></li><li>the W3Schools <a shape="rect" class="external-link" href="http://www.w3schools.com/xquery/default.asp" rel="nofollow">XQuery Tutorial</a></li></ul><p>You might also find the <a shape="rect" class="external-link" href="http://www.w3.org/TR/xpath-functions/" rel="nofollow">XQuery function reference</a> useful</p><h3 id="BookInOnePage-Loadingscriptfromexternalresource.4">Loading script from external resource</h3><p><strong>Available as of Camel 2.11</strong></p><p>You can externalize the script and have Camel load it from a resource such as <code>"classpath:"</code>, <code>"file:"</code>, or <code>"http:"</code>.<br clear="none"> This is done using the following syntax: <code>"resource:scheme:location"</code>, eg to refer to a file on the classpath you can do:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[.setHeader(&quot;myHeader&quot;).xquery(&quot;resource:classpath:myxquery.txt&quot;, String.class)
]]></script>
</div></div><h3 id="BookInOnePage-Dependencies.18">Dependencies</h3><p>To use XQuery in your camel routes you need to add the a dependency on <strong>camel-saxon</strong> which implements the XQuery language.</p><p>If you use maven you could just add the following to your pom.xml, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-saxon&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div>
<div class="chapter" id="chapter-dataformat-Appendix"></div>
<h1 id="BookInOnePage-DataFormatAppendix">Data Format Appendix</h1>

<h2 id="BookInOnePage-DataFormat">Data Format</h2>

<p>Camel supports a pluggable DataFormat to allow messages to be marshalled to and from binary or text formats to support a kind of <a shape="rect" href="message-translator.html">Message Translator</a>.</p>

<p>The following data formats are currently supported:</p>

<ul><li>Standard JVM object marshalling<ul><li><a shape="rect" href="serialization.html">Serialization</a></li><li><a shape="rect" href="string.html">String</a></li></ul></li></ul><ul><li>Object marshalling<ul><li><a shape="rect" href="avro.html">Avro</a></li><li><a shape="rect" href="boon.html">Boon</a></li><li><a shape="rect" href="hessian.html">Hessian</a></li><li><a shape="rect" href="json.html">JSON</a></li><li><a shape="rect" href="protobuf.html">Protobuf</a></li><li><a shape="rect" href="yaml-data-format.html">YAML</a></li></ul></li></ul><ul><li>Object/XML marshalling<ul><li><a shape="rect" href="castor.html">Castor</a></li><li><a shape="rect" href="jaxb.html">JAXB</a></li><li><a shape="rect" href="xmlbeans.html">XmlBeans</a></li><li><a shape="rect" href="xstream.html">XStream</a></li><li><a shape="rect" href="jibx.html">JiBX</a></li><li><a shape="rect" href="jackson-xml.html">Jackson XML</a></li></ul></li></ul><ul><li>Object/XML/Webservice marshalling<ul><li><a shape="rect" href="soap.html">SOAP</a></li></ul></li></ul><ul><li>Direct JSON / XML marshalling<ul><li><a shape="rect" href="xmljson.html">XmlJson</a></li></ul></li></ul><ul><li>Flat data structure marshalling<ul><li><a shape="rect" href="beanio.html">BeanIO</a></li><li><a shape="rect" href="bindy.html">Bindy</a></li><li><a shape="rect" href="csv.html">CSV</a></li><li><a shape="rect" href="edi.html">EDI</a></li><li><a shape="rect" href="flatpack-dataformat.html">Flatpack DataFormat</a></li><li><a shape="rect" href="univocity-parsers-formats.html">uniVocity-parsers formats</a></li></ul></li></ul><ul><li>Domain specific marshalling<ul><li><a shape="rect" href="hl7-dataformat.html">HL7 DataFormat</a></li></ul></li></ul><ul><li>Compression<ul><li><a shape="rect" href="gzip-data-format.html">GZip data format</a></li><li><a shape="rect" href="zip-dataformat.html">Zip DataFormat</a></li><li><a shape="rect" href="zip-file-dataformat.html">Zip File DataFormat</a></li><li><a shape="rect" href="lzf-data-format.html">LZF Data Format</a></li></ul></li></ul><ul><li>Security<ul><li><a shape="rect" href="crypto.html">Crypto</a></li><li><a shape="rect" href="crypto.html">PGP</a></li><li><a shape="rect" href="xmlsecurity-dataformat.html">XMLSecurity DataFormat</a></li></ul></li></ul><ul><li>Misc.<ul><li><a shape="rect" href="base64.html">Base64</a></li><li><a shape="rect" href="custom-dataformat.html">Custom DataFormat</a> - to use your own custom implementation</li><li><a shape="rect" href="mime-multipart.html">MIME-Multipart</a></li><li><a shape="rect" href="rss.html">RSS</a></li><li><a shape="rect" href="tidymarkup.html">TidyMarkup</a></li><li><a shape="rect" href="syslog.html">Syslog</a></li><li><a shape="rect" href="ical.html">ICal</a></li><li><a shape="rect" href="barcode-data-format.html">Barcode </a>- to read and generate barcodes (QR-Code, PDF417, ...)</li></ul></li></ul>

<p>And related is the following:</p>
<ul class="alternate"><li><a shape="rect" href="dataformat-component.html">DataFormat Component</a> for working with <a shape="rect" href="data-format.html">Data Format</a>s as if it was a regular <a shape="rect" href="component.html">Component</a> supporting <a shape="rect" href="endpoint.html">Endpoint</a>s and <a shape="rect" href="uris.html">URIs</a>.</li><li><a shape="rect" href="dozer-type-conversion.html">Dozer Type Conversion</a> using Dozer for type converting POJOs</li></ul>


<h3 id="BookInOnePage-Unmarshalling">Unmarshalling</h3>

<p>If you receive a message from one of the Camel <a shape="rect" href="components.html">Components</a> such as <a shape="rect" href="file2.html">File</a>, <a shape="rect" href="http.html">HTTP</a> or <a shape="rect" href="jms.html">JMS</a> you often want to unmarshal the payload into some bean so that you can process it using some <a shape="rect" href="bean-integration.html">Bean Integration</a> or perform <a shape="rect" href="predicate.html">Predicate</a> evaluation and so forth. To do this use the <strong>unmarshal</strong> word in the <a shape="rect" href="dsl.html">DSL</a> in Java or the <a shape="rect" href="xml-configuration.html">Xml Configuration</a>.</p>

<p>For example</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
DataFormat jaxb = new JaxbDataFormat(&quot;com.acme.model&quot;);

from(&quot;activemq:My.Queue&quot;).
  unmarshal(jaxb).
  to(&quot;mqseries:Another.Queue&quot;);
]]></script>
</div></div>

<p>The above uses a named DataFormat of <em>jaxb</em> which is configured with a number of Java package names. You can if you prefer use a named reference to a data format which can then be defined in your <a shape="rect" href="registry.html">Registry</a> such as via your <a shape="rect" href="spring.html">Spring</a> XML file.</p>

<p>You can also use the DSL itself to define the data format as you use it. For example the following uses Java serialization to unmarshal a binary file then send it as an ObjectMessage to <a shape="rect" href="activemq.html">ActiveMQ</a></p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;file://foo/bar&quot;).
  unmarshal().serialization().
  to(&quot;activemq:Some.Queue&quot;);
]]></script>
</div></div>

<h3 id="BookInOnePage-Marshalling">Marshalling</h3>

<p>Marshalling is the opposite of unmarshalling, where a bean is marshalled into some binary or textual format for transmission over some transport via a Camel <a shape="rect" href="component.html">Component</a>. Marshalling is used in the same way as unmarshalling above; in the <a shape="rect" href="dsl.html">DSL</a> you can use a DataFormat instance, you can configure the DataFormat dynamically using the DSL or you can refer to a named instance of the format in the <a shape="rect" href="registry.html">Registry</a>.</p>

<p>The following example unmarshals via serialization then marshals using a named JAXB data format to perform a kind of <a shape="rect" href="message-translator.html">Message Translator</a></p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;file://foo/bar&quot;).
  unmarshal().serialization(). 
  marshal(&quot;jaxb&quot;).
  to(&quot;activemq:Some.Queue&quot;);
]]></script>
</div></div>


<h3 id="BookInOnePage-UsingSpringXML">Using Spring XML</h3>

<p>This example shows how to configure the data type just once and reuse it on multiple routes</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;camelContext id=&quot;camel&quot; xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;
  &lt;dataFormats&gt;
    &lt;jaxb id=&quot;myJaxb&quot; prettyPrint=&quot;true&quot; contextPath=&quot;org.apache.camel.example&quot;/&gt;
  &lt;/dataFormats&gt;

  &lt;route&gt;
    &lt;from uri=&quot;direct:start&quot;/&gt;
    &lt;marshal ref=&quot;myJaxb&quot;/&gt;
    &lt;to uri=&quot;direct:marshalled&quot;/&gt;
  &lt;/route&gt;
  &lt;route&gt;
    &lt;from uri=&quot;direct:marshalled&quot;/&gt;
    &lt;unmarshal ref=&quot;myJaxb&quot;/&gt;
    &lt;to uri=&quot;mock:result&quot;/&gt;
  &lt;/route&gt;

&lt;/camelContext&gt;
]]></script>
</div></div>

<p>You can also define reusable data formats as Spring beans </p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;bean id=&quot;myJaxb&quot; class=&quot;org.apache.camel.model.dataformat.JaxbDataFormat&quot;&gt;
  &lt;property name=&quot;prettyPrint&quot; value=&quot;true&quot;/&gt;
  &lt;property name=&quot;contextPath&quot; value=&quot;org.apache.camel.example&quot;/&gt;
&lt;/bean&gt;  
]]></script>
</div></div>

<h2 id="BookInOnePage-Serialization">Serialization</h2>

<p>Serialization is a <a shape="rect" href="data-format.html">Data Format</a> which uses the standard Java Serialization mechanism to unmarshal a binary payload into Java objects or to marshal Java objects into a binary blob.<br clear="none">
 For example the following uses Java serialization to unmarshal a binary file then send it as an ObjectMessage to <a shape="rect" href="activemq.html">ActiveMQ</a></p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;file://foo/bar&quot;).
  unmarshal().serialization().
  to(&quot;activemq:Some.Queue&quot;);
]]></script>
</div></div>

<h3 id="BookInOnePage-Dependencies.19">Dependencies</h3>

<p>This data format is provided in <strong>camel-core</strong> so no additional dependencies is needed.</p>
<h2 id="BookInOnePage-JAXB">JAXB</h2><p>JAXB is a <a shape="rect" href="data-format.html">Data Format</a> which uses the JAXB2 XML marshalling standard which is included in Java 6 to unmarshal an XML payload into Java objects or to marshal Java objects into an XML payload.</p><h3 id="BookInOnePage-UsingtheJavaDSL">Using the Java DSL</h3><p>For example the following uses a named DataFormat of <em>jaxb</em> which is configured with a number of Java package names to initialize the <a shape="rect" class="external-link" href="http://java.sun.com/javase/6/docs/api/javax/xml/bind/JAXBContext.html" rel="nofollow">JAXBContext</a>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[DataFormat jaxb = new JaxbDataFormat(&quot;com.acme.model&quot;);

from(&quot;activemq:My.Queue&quot;).
  unmarshal(jaxb).
  to(&quot;mqseries:Another.Queue&quot;);
]]></script>
</div></div><p>You can if you prefer use a named reference to a data format which can then be defined in your <a shape="rect" href="registry.html">Registry</a> such as via your <a shape="rect" href="spring.html">Spring</a> XML file. e.g.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;activemq:My.Queue&quot;).
  unmarshal(&quot;myJaxbDataType&quot;).
  to(&quot;mqseries:Another.Queue&quot;);
]]></script>
</div></div><h3 id="BookInOnePage-UsingSpringXML.1">Using Spring XML</h3><p>The following example shows how to use JAXB to unmarshal using <a shape="rect" href="spring.html">Spring</a> configuring the jaxb data type</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;camelContext id=&quot;camel&quot; xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;
  &lt;route&gt;
    &lt;from uri=&quot;direct:start&quot;/&gt;
    &lt;unmarshal&gt;
      &lt;jaxb prettyPrint=&quot;true&quot; contextPath=&quot;org.apache.camel.example&quot;/&gt;
    &lt;/unmarshal&gt;
    &lt;to uri=&quot;mock:result&quot;/&gt;
  &lt;/route&gt;
&lt;/camelContext&gt;
]]></script>
</div></div>This example shows how to configure the data type just once and reuse it on multiple routes.<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;camelContext id=&quot;camel&quot; xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;
  &lt;dataFormats&gt;
    &lt;jaxb id=&quot;myJaxb&quot; prettyPrint=&quot;true&quot; contextPath=&quot;org.apache.camel.example&quot;/&gt;
  &lt;/dataFormats&gt;

  &lt;route&gt;
    &lt;from uri=&quot;direct:start&quot;/&gt;
    &lt;marshal ref=&quot;myJaxb&quot;/&gt;
    &lt;to uri=&quot;direct:marshalled&quot;/&gt;
  &lt;/route&gt;
  &lt;route&gt;
    &lt;from uri=&quot;direct:marshalled&quot;/&gt;
    &lt;unmarshal ref=&quot;myJaxb&quot;/&gt;
    &lt;to uri=&quot;mock:result&quot;/&gt;
  &lt;/route&gt;

&lt;/camelContext&gt;
]]></script>
</div></div><div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Multiple context paths</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>It is possible to use this data format with more than one context path. You can specify context path using <code>:</code> as separator, for example <code>com.mycompany:com.mycompany2</code>. Note that this is handled by JAXB implementation and might change if you use different vendor than RI.</p></div></div><h3 id="BookInOnePage-Partialmarshalling/unmarshalling">Partial marshalling/unmarshalling</h3><p><strong>This feature is new to Camel 2.2.0.</strong><br clear="none"> JAXB 2 supports marshalling and unmarshalling XML tree fragments. By default JAXB looks for <code>@XmlRootElement</code> annotation on given class to operate on whole XML tree. This is useful but not always - sometimes generated code does not have @XmlRootElement annotation, sometimes you need unmarshall only part of tree.<br clear="none"> In that case you can use partial unmarshalling. To enable this behaviours you need set property <code>partClass</code>. Camel will pass this class to JAXB's unmarshaler.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;camelContext id=&quot;camel&quot; xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;
    &lt;route&gt;
        &lt;from uri=&quot;direct:marshal&quot;/&gt;
        &lt;marshal&gt;
            &lt;jaxb prettyPrint=&quot;false&quot; contextPath=&quot;org.apache.camel.example&quot;
                partClass=&quot;org.apache.camel.example.PurchaseOrder&quot;
                fragment=&quot;true&quot;
                partNamespace=&quot;{http://example.camel.org/apache}po&quot; /&gt;
        &lt;/marshal&gt;
        &lt;to uri=&quot;mock:marshal&quot;/&gt;
    &lt;/route&gt;
    &lt;route&gt;
        &lt;from uri=&quot;direct:unmarshal&quot;/&gt;
        &lt;unmarshal&gt;
            &lt;jaxb prettyPrint=&quot;false&quot; contextPath=&quot;org.apache.camel.example&quot;
                partClass=&quot;org.apache.camel.example.Partial&quot; /&gt;
        &lt;/unmarshal&gt;
        &lt;to uri=&quot;mock:unmarshal&quot;/&gt;
    &lt;/route&gt;
&lt;/camelContext&gt;
]]></script>
</div></div>For marshalling you have to add <code>partNamespace</code> attribute with QName of destination namespace. Example of Spring DSL you can find above.<h3 id="BookInOnePage-Fragment">Fragment</h3><p><strong>This feature is new to Camel 2.8.0.</strong><br clear="none"> JaxbDataFormat has new property fragment which can set the the <code>Marshaller.JAXB_FRAGMENT</code> encoding property on the JAXB Marshaller. If you don't want the JAXB Marshaller to generate the XML declaration, you can set this option to be true. The default value of this property is false.</p><h3 id="BookInOnePage-IgnoringtheNonXMLCharacter">Ignoring the NonXML Character</h3><p><strong>This feature is new to Camel 2.2.0.</strong><br clear="none"> JaxbDataFromat supports to ignore the <a shape="rect" class="external-link" href="http://www.w3.org/TR/2004/REC-xml-20040204/#NT-Char" rel="nofollow">NonXML Character</a>, you just need to set the filterNonXmlChars property to be true, JaxbDataFormat will replace the NonXML character with " " when it is marshaling or unmarshaling the message. You can also do it by setting the <a shape="rect" href="exchange.html">Exchange</a> property <code>Exchange.FILTER_NON_XML_CHARS</code>.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><th colspan="1" rowspan="1" class="confluenceTh"><p>JDK 1.5</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>JDK 1.6+</p></th></tr><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Filtering in use</p></th><td colspan="1" rowspan="1" class="confluenceTd"><p>StAX API and implementation</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td></tr><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Filtering not in use</p></th><td colspan="1" rowspan="1" class="confluenceTd"><p>StAX API only</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td></tr></tbody></table></div><p>This feature has been tested with Woodstox 3.2.9 and Sun JDK 1.6 StAX implementation.</p><p><strong>New for Camel 2.12.1</strong><br clear="none"> JaxbDataFormat now allows you to customize the XMLStreamWriter used to marshal the stream to XML. Using this configuration, you can add your own stream writer to completely remove, escape, or replace non-xml characters.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[   JaxbDataFormat customWriterFormat = new JaxbDataFormat(&quot;org.apache.camel.foo.bar&quot;);
  customWriterFormat.setXmlStreamWriterWrapper(new TestXmlStreamWriter());
]]></script>
</div></div><p>The following example shows using the Spring DSL and also enabling Camel's NonXML filtering:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;bean id=&quot;testXmlStreamWriterWrapper&quot; class=&quot;org.apache.camel.jaxb.TestXmlStreamWriter&quot;/&gt;
&lt;jaxb filterNonXmlChars=&quot;true&quot;  contextPath=&quot;org.apache.camel.foo.bar&quot; xmlStreamWriterWrapper=&quot;#testXmlStreamWriterWrapper&quot; /&gt;
]]></script>
</div></div><h3 id="BookInOnePage-WorkingwiththeObjectFactory">Working with the ObjectFactory</h3><p>If you use XJC to create the java class from the schema, you will get an ObjectFactory for you JAXB context. Since the ObjectFactory uses <a shape="rect" class="external-link" href="http://java.sun.com/javase/6/docs/api/javax/xml/bind/JAXBElement.html" rel="nofollow">JAXBElement</a> to hold the reference of the schema and element instance value, jaxbDataformat will ignore the JAXBElement by default and you will get the element instance value instead of the JAXBElement object form the unmarshaled message body. <br clear="none"> If you want to get the JAXBElement object form the unmarshaled message body, you need to set the JaxbDataFormat object's ignoreJAXBElement property to be false.</p><h3 id="BookInOnePage-Settingencoding">Setting encoding</h3><p>You can set the <strong>encoding</strong> option to use when marshalling. Its the <code>Marshaller.JAXB_ENCODING</code> encoding property on the JAXB Marshaller.<br clear="none"> You can setup which encoding to use when you declare the JAXB data format. You can also provide the encoding in the <a shape="rect" href="exchange.html">Exchange</a> property <code>Exchange.CHARSET_NAME</code>. This property will overrule the encoding set on the JAXB data format.</p><p>In this Spring DSL we have defined to use <code>iso-8859-1</code> as the encoding:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;camelContext id=&quot;camel&quot; xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;
    &lt;route&gt;
        &lt;from uri=&quot;direct:start&quot;/&gt;
        &lt;marshal&gt;
            &lt;jaxb prettyPrint=&quot;false&quot; encoding=&quot;iso-8859-1&quot; contextPath=&quot;org.apache.camel.example&quot;/&gt;
        &lt;/marshal&gt;
        &lt;to uri=&quot;mock:result&quot;/&gt;
    &lt;/route&gt;
&lt;/camelContext&gt;
]]></script>
</div></div><h3 id="BookInOnePage-Controllingnamespaceprefixmapping">Controlling namespace prefix mapping</h3><p><strong>Available as of Camel 2.11</strong></p><p>When marshalling using <a shape="rect" href="jaxb.html">JAXB</a> or <a shape="rect" href="soap.html">SOAP</a> then the JAXB implementation will automatic assign namespace prefixes, such as ns2, ns3, ns4 etc. To control this mapping, Camel allows you to refer to a map which contains the desired mapping.</p><p>Notice this requires having JAXB-RI 2.1 or better (from SUN) on the classpath, as the mapping functionality is dependent on the implementation of JAXB, whether its supported.</p><p>For example in Spring XML we can define a Map with the mapping. In the mapping file below, we map SOAP to use soap as prefix. While our custom namespace "http://www.mycompany.com/foo/2" is not using any prefix.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[  &lt;util:map id=&quot;myMap&quot;&gt;
    &lt;entry key=&quot;http://www.w3.org/2003/05/soap-envelope&quot; value=&quot;soap&quot;/&gt;
    &lt;!-- we dont want any prefix for our namespace --&gt;
    &lt;entry key=&quot;http://www.mycompany.com/foo/2&quot; value=&quot;&quot;/&gt;
  &lt;/util:map&gt;
]]></script>
</div></div><p>To use this in <a shape="rect" href="jaxb.html">JAXB</a> or <a shape="rect" href="soap.html">SOAP</a> you refer to this map, using the <code>namespacePrefixRef</code> attribute as shown below. Then Camel will lookup in the <a shape="rect" href="registry.html">Registry</a> a <code>java.util.Map</code> with the id "myMap", which was what we defined above.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[  &lt;marshal&gt;
    &lt;soapjaxb version=&quot;1.2&quot; contextPath=&quot;com.mycompany.foo&quot; namespacePrefixRef=&quot;myMap&quot;/&gt;
  &lt;/marshal&gt;
]]></script>
</div></div><h3 id="BookInOnePage-Schemavalidation">Schema validation</h3><p><strong>Available as of Camel 2.11</strong></p><p>The JAXB <a shape="rect" href="data-format.html">Data Format</a> supports validation by marshalling and unmarshalling from/to XML. Your can use the prefix <strong>classpath:</strong>, <strong>file:* or *http:</strong> to specify how the resource should by resolved. You can separate multiple schema files by using the <strong>','</strong> character.</p><div class="confluence-information-macro confluence-information-macro-information"><p class="title">Known issue</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Camel 2.11.0 and 2.11.1 has a known issue by validation multiple <code>Exchange</code>'s in parallel. See <a shape="rect" class="external-link" href="https://issues.apache.org/jira/browse/CAMEL-6630">CAMEL-6630</a>. This is fixed with Camel 2.11.2/2.12.0.</p></div></div><p>Using the Java DSL, you can configure it in the following way:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[JaxbDataFormat jaxbDataFormat = new JaxbDataFormat();
jaxbDataFormat.setContextPath(Person.class.getPackage().getName());
jaxbDataFormat.setSchema(&quot;classpath:person.xsd,classpath:address.xsd&quot;);
]]></script>
</div></div><p>You can do the same using the XML DSL:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;marshal&gt;
    &lt;jaxb id=&quot;jaxb&quot; schema=&quot;classpath:person.xsd,classpath:address.xsd&quot;/&gt;
&lt;/marshal&gt;
]]></script>
</div></div><p>Camel will create and pool the underling <code>SchemaFactory</code> instances on the fly, because the <code>SchemaFactory</code> shipped with the JDK is not thread safe.<br clear="none"> However, if you have a <code>SchemaFactory</code> implementation which is thread safe, you can configure the JAXB data format to use this one:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[JaxbDataFormat jaxbDataFormat = new JaxbDataFormat();
jaxbDataFormat.setSchemaFactory(thradSafeSchemaFactory);
]]></script>
</div></div><h3 id="BookInOnePage-SchemaLocation">Schema Location</h3><p><strong>Available as of Camel 2.14</strong></p><p>The JAXB&#160;<a shape="rect" href="data-format.html">Data Format</a>&#160;supports to specify the SchemaLocation when marshaling the XML.&#160;</p><p>Using the Java DSL, you can configure it in the following way:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[JaxbDataFormat jaxbDataFormat = new JaxbDataFormat();
jaxbDataFormat.setContextPath(Person.class.getPackage().getName());
jaxbDataFormat.setSchemaLocation(&quot;schema/person.xsd&quot;);
]]></script>
</div></div><p>You can do the same using the XML DSL:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;marshal&gt;
    &lt;jaxb id=&quot;jaxb&quot; schemaLocation=&quot;schema/person.xsd&quot;/&gt;
&lt;/marshal&gt;]]></script>
</div></div><h3 id="BookInOnePage-MarshaldatathatisalreadyXML">Marshal data that is already XML</h3><p><strong>Available as of Camel 2.14.1</strong></p><div>The JAXB marshaller requires that the message body is JAXB compatible, eg its a JAXBElement, eg a java instance that has JAXB annotations, or extend JAXBElement. There can be situations where the message body is already in XML, eg from a String type. There is a new option&#160;<code>mustBeJAXBElement</code> you can set to false, to relax this check, so the JAXB marshaller only attempts to marshal JAXBElements (javax.xml.bind.JAXBIntrospector#isElement returns true). And in those situations the marshaller fallbacks to marshal the message body as-is.</div><div><h3 id="BookInOnePage-XmlRootElementobjects"><span style="color: rgb(51,51,51);">XmlRootElement objects</span></h3><p><strong>Available as of Camel 2.17.2</strong></p><p>The JAXB <a shape="rect" href="data-format.html">Data Format</a> option objectFactory has a default value equals to false. This is related to a performance degrading. For more information look at the issue <a shape="rect" class="external-link" href="https://issues.apache.org/jira/browse/CAMEL-10043">CAMEL-10043</a></p><p>For the marshalling of <span style="color: rgb(51,51,51);">non-XmlRootElement JaxB objects</span> you'll need to <span style="color: rgb(51,51,51);">call JaxbDataFormat#setObjectFactory(true)</span></p></div><h3 id="BookInOnePage-Dependencies.20">Dependencies</h3><p>To use JAXB in your camel routes you need to add the a dependency on <strong>camel-jaxb</strong> which implements this data format.</p><p>If you use maven you could just add the following to your pom.xml, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-jaxb&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div>
<h2 id="BookInOnePage-XmlBeans">XmlBeans</h2>

<p>XmlBeans is a <a shape="rect" href="data-format.html">Data Format</a> which uses the <a shape="rect" class="external-link" href="http://xmlbeans.apache.org/">XmlBeans library</a> to unmarshal an XML payload into Java objects or to marshal Java objects into an XML payload.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;activemq:My.Queue&quot;).
  unmarshal().xmlBeans().
  to(&quot;mqseries:Another.Queue&quot;);
]]></script>
</div></div>

<h3 id="BookInOnePage-Dependencies.21">Dependencies</h3>

<p>To use XmlBeans in your camel routes you need to add the dependency on <strong>camel-xmlbeans</strong> which implements this data format. </p>

<p>If you use maven you could just add the following to your pom.xml, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-xmlbeans&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
  &lt;!-- use the same version as your Camel core version --&gt;
&lt;/dependency&gt;
]]></script>
</div></div>
<h2 id="BookInOnePage-XStream">XStream</h2><p>XStream is a <a shape="rect" href="data-format.html">Data Format</a> which uses the <a shape="rect" class="external-link" href="http://xstream.codehaus.org/" rel="nofollow">XStream library</a> to marshal and unmarshal Java objects to and from XML.</p><p>To use XStream in your camel routes you need to add the a dependency on&#160;<strong>camel-xstream</strong>&#160;which implements this data format.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code>&#160;for this component:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-xstream&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
  &lt;!-- use the same version as your Camel core version --&gt;
&lt;/dependency&gt;
]]></script>
</div></div><h3 id="BookInOnePage-UsingtheJavaDSL.1">Using the Java DSL</h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[// lets turn Object messages into XML then send to MQSeries
from(&quot;activemq:My.Queue&quot;).
  marshal().xstream().
  to(&quot;mqseries:Another.Queue&quot;);
]]></script>
</div></div><p>If you would like to configure the <code>XStream</code> instance used by the Camel for the message transformation, you can simply pass a reference to that instance on the DSL level.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[XStream xStream = new XStream();
xStream.aliasField(&quot;money&quot;, PurchaseOrder.class, &quot;cash&quot;);
// new Added setModel option since Camel 2.14
xStream.setModel(&quot;NO_REFERENCES&quot;);
...

from(&quot;direct:marshal&quot;).
  marshal(new XStreamDataFormat(xStream)).
  to(&quot;mock:marshaled&quot;);
]]></script>
</div></div><h3 id="BookInOnePage-XMLInputFactoryandXMLOutputFactory">XMLInputFactory and XMLOutputFactory</h3><p><a shape="rect" class="external-link" href="http://xstream.codehaus.org/" rel="nofollow">The XStream library</a> uses the <code>javax.xml.stream.XMLInputFactory</code> and <code>javax.xml.stream.XMLOutputFactory</code>, you can control which implementation of this factory should be used.</p><p>The Factory is discovered using this algorithm:<br clear="none"> 1. Use the <code>javax.xml.stream.XMLInputFactory</code> , <code>javax.xml.stream.XMLOutputFactory</code> system property.<br clear="none"> 2. Use the <code>lib/xml.stream.properties</code> file in the <code>JRE_HOME</code> directory.<br clear="none"> 3. Use the Services API, if available, to determine the classname by looking in the <code>META-INF/services/javax.xml.stream.XMLInputFactory</code>, <code>META-INF/services/javax.xml.stream.XMLOutputFactory</code> files in jars available to the JRE.<br clear="none"> 4. Use the platform default XMLInputFactory,XMLOutputFactory instance.</p><h3 id="BookInOnePage-HowtosettheXMLencodinginXstreamDataFormat?">How to set the XML encoding in Xstream DataFormat?</h3><p>From Camel 2.2.0, you can set the encoding of XML in Xstream DataFormat by setting the Exchange's property with the key <code>Exchange.CHARSET_NAME</code>, or setting the encoding property on Xstream from DSL or Spring config.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;activemq:My.Queue&quot;).
  marshal().xstream(&quot;UTF-8&quot;).
  to(&quot;mqseries:Another.Queue&quot;);
]]></script>
</div></div><p></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;camelContext id=&quot;camel&quot; xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;
    
    &lt;!-- we define the json xstream data formats to be used (xstream is default) --&gt;
    &lt;dataFormats&gt;
        &lt;xstream id=&quot;xstream-utf8&quot; encoding=&quot;UTF-8&quot; permissions=&quot;org.apache.camel.dataformat.stream.*&quot;/&gt;
        &lt;xstream id=&quot;xstream-default&quot; permissions=&quot;org.apache.camel.dataformat.stream.*&quot;/&gt;
    &lt;/dataFormats&gt;

    &lt;route&gt;
        &lt;from uri=&quot;direct:in&quot;/&gt;
        &lt;marshal ref=&quot;xstream-default&quot;/&gt;
        &lt;to uri=&quot;mock:result&quot;/&gt;
    &lt;/route&gt;

    &lt;route&gt;
        &lt;from uri=&quot;direct:in-UTF-8&quot;/&gt;
        &lt;marshal ref=&quot;xstream-utf8&quot;/&gt;
        &lt;to uri=&quot;mock:result&quot;/&gt;
    &lt;/route&gt;

&lt;/camelContext&gt;
]]></script>
</div></div><h3 id="BookInOnePage-SettingthetypepermissionsofXstreamDataFormat">Setting the type permissions of Xstream DataFormat</h3><p>In Camel, one can always use its own processing step in the route to filter and block certain XML documents to be routed to the XStream's unmarhall step. From Camel 2.16.1, 2.15.5, you can set&#160;<a shape="rect" class="external-link" href="http://x-stream.github.io/security.html" rel="nofollow">XStream's type permissions</a>&#160;to automatically allow or deny the instantiation of certain types.</p><p>The default type permissions setting used by Camel denies all types except for those from java.lang and java.util packages. This setting can be changed by setting System property org.apache.camel.xstream.permissions. Its value is a string of comma-separated permission terms, each representing a type being allowed or denied, depending on whether the term is prefixed with '+' (note '+' may be omitted) or with '-', respectively.</p><p>Each term may contain a wildcard character '*'. For example, value "-*,java.lang.*,java.util.*" indicates denying all types except for java.lang.* and java.util.* classes. Setting this value to an empty string "" reverts to the default XStream's type permissions handling which denies certain blacklisted classes and allow others.</p><p>The type permissions setting can be extended at an individual XStream DataFormat instance by setting its type permissions property.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[    &lt;dataFormats&gt;
        &lt;xstream id=&quot;xstream-default&quot; 
                 permissions=&quot;org.apache.camel.samples.xstream.*&quot;/&gt;
        ...


]]></script>
</div></div>
<h2 id="BookInOnePage-CSV">CSV</h2><p>The CSV <a shape="rect" href="data-format.html">Data Format</a> uses <a shape="rect" class="external-link" href="http://commons.apache.org/proper/commons-csv/">Apache Commons CSV</a> to handle CSV payloads (Comma Separated Values) such as those exported/imported by Excel.</p><p>As of Camel 2.15.0, it now uses the&#160;<a shape="rect" class="external-link" href="http://commons.apache.org/proper/commons-csv/archives/1.1/index.html">Apache Commons CSV 1.1</a> which is based on a completely different set of options.</p><h3 id="BookInOnePage-AvailableoptionsuntilCamel2.15">Available options until Camel 2.15</h3><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>config</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>CSVConfig</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Can be used to set a custom <code>CSVConfig</code> object.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>strategy</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>CSVStrategy</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Can be used to set a custom <code>CSVStrategy</code>; the default is <code>CSVStrategy.DEFAULT_STRATEGY</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>autogenColumns</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether or not columns are auto-generated in the resulting CSV. The default value is <code>true</code>; subsequent messages use the previously created columns with new fields being added at the end of the line.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>delimiter</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>String</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.4:</strong> The column delimiter to use; the default value is "<code>,</code>".</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>skipFirstLine</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Whether or not to skip the first line of CSV input when unmarshalling (e.g. if the content has headers on the first line); the default value is <code>false</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">lazyLoad</td><td colspan="1" rowspan="1" class="confluenceTd">boolean</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.12.2:</strong><span><span>&#160;Whether or not to </span></span><span style="line-height: 1.4285715;">Sequential access CSV input through an iterator which could avoid OOM exception when processing huge CSV file; </span><span>the default value is false </span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">useMaps</td><td colspan="1" rowspan="1" class="confluenceTd">boolean</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.13:</strong> Whether to use List&lt;Map&gt; when unmarshalling instead of List&lt;List&gt;.</td></tr></tbody></table></div><h3 id="BookInOnePage-AvailableoptionsasofCamel2.15">Available options as of Camel 2.15</h3><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh">Option</th><th colspan="1" rowspan="1" class="confluenceTh">Type</th><th colspan="1" rowspan="1" class="confluenceTh">Description</th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>format</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>CSVFormat</code></td><td colspan="1" rowspan="1" class="confluenceTd">The reference format to use, it will be updated with the other format options, the default value is <code>CSVFormat.DEFAULT</code></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>commentMarkerDisabled</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>boolean</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Disables the comment marker of the reference format.</p><p>This option is <code>false</code> by default.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>commentMarker</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>Character</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Overrides the comment marker of the reference format.</p><p>This option is <code>null</code> by default. When <code>null</code> it keeps the value of the reference format which is <code>null</code> for <code>CSVFormat.DEFAULT</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>delimiter</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>Character</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Overrides the delimiter of the reference format.</p><p>This option is <code>null</code> by defaut. <span>When </span><code>null</code><span> it keeps the value of the reference format which is </span><code>','</code><span> for </span><code>CSVFormat.DEFAULT</code><span>.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>escapeDisabled</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>boolean</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Disables the escape character of the reference format.</p><p>This option is <code>false</code> by default.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>escape</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>Character</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Overrides the escape character of the reference format.</p><p>This option is <code>null</code> by default. <span>When </span><code>null</code><span> it keeps the value of the reference format which is </span><code>null</code><span> for </span><code>CSVFormat.DEFAULT</code><span>.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>headerDisabled</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>boolean</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Disables the header of the reference format.</p><p>This option is <code>false</code> by default.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>header</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>String[]</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Overrides the header of the reference format.</p><p>This option is <code>null</code> by default. <span>When </span><code>null</code><span> it keeps the value of the reference format which is </span><code>null</code><span> for </span><code>CSVFormat.DEFAULT</code><span>.</span></p><p>In the XML DSL, this option is configured using children&#160;<code>&lt;header&gt;</code>&#160;tags:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;csv &gt;
    &lt;header&gt;orderId&lt;/header&gt;
    &lt;header&gt;amount&lt;/header&gt;
&lt;/csv&gt;]]></script>
</div></div></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>allowMissingColumnNames</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>Boolean</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Overrides the missing column names behavior of the reference format.</p><p>This option is <code>null</code> by default. <span>When </span><code>null</code><span> it keeps the value of the reference format which is </span><code>false</code><span> for </span><code>CSVFormat.DEFAULT</code><span>.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>ignoreEmptyLines</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>Boolean</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Overrides the empty line behavior of the reference format.</p><p><span>This option is </span><code>null</code><span> by default. <span>When </span><code>null</code><span> it keeps the value of the reference format which is </span><code>true</code><span> for </span><code>CSVFormat.DEFAULT</code><span>.</span></span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>ignoreSurroundingSpaces</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>Boolean</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Overrides the surrounding spaces behavior of the reference format.</p><p><span>This option is </span><code>null</code><span> by default. <span>When </span><code>null</code><span> it keeps the value of the reference format which is </span><code>false</code><span> for </span><code>CSVFormat.DEFAULT</code><span>.</span></span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>nullStringDisabled</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>boolean</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Disables the null string representation of the reference format.</p><p>This option is <code>false</code> by default.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>nullString</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>String</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Overrides the null string representation of the reference format.</p><p><span>This option is </span><code>null</code><span> by default. <span>When </span><code>null</code><span> it keeps the value of the reference format which is </span><code>null</code><span> for </span><code>CSVFormat.DEFAULT</code><span>.</span></span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>quoteDisabled</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>boolean</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Disables the quote of the reference format.</p><p><span>This option is </span><code>false</code><span> by default.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>quote</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>Character</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Overrides the quote symbol of the reference format.</p><p><span>This option is </span><code>null</code><span> by default. <span>When </span><code>null</code><span> it keeps the value of the reference format which is </span><code>'"'</code><span> (double quote) for </span><code>CSVFormat.DEFAULT</code><span>.</span></span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>quoteMode</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>QuoteMode</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Overrides the quote mode of the reference format.</p><p><span>This option is </span><code>null</code><span> by default. <span>When </span><code>null</code><span> it keeps the value of the reference format which is </span><code>null</code><span> for </span><code>CSVFormat.DEFAULT</code><span>.</span></span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>recordSeparatorDisabled</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>boolean</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Disables the record separator of the reference format.</p><p><span>This option is </span><code>false</code><span> by default.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>recordSeparator</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>String</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Overrides the record separator of the reference format.</p><p><span>This option is </span><code>null</code><span> by default. <span>When </span><code>null</code><span> it keeps the value of the reference format which is </span><code>\r\n</code><span> (CRLF) for </span><code>CSVFormat.DEFAULT</code><span>.</span></span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>skipHeaderRecord</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>Boolean</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Overrides the header record behavior of the reference format.</p><p><span>This option is </span><code>null</code><span> by default. <span>When </span><code>null</code><span> it keeps the value of the reference format which is </span><code>false</code><span> for </span><code>CSVFormat.DEFAULT</code><span>.</span></span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>lazyLoad</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>boolean</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether the unmarshalling should produce an iterator that reads the lines on the fly or if all the lines must be read at one.</p><p>This option is&#160;<code>false</code>&#160;by default.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>useMaps</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>boolean</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether the unmarshalling should produce maps for the lines values instead of lists. It requires to have header (either defined or collected).</p><p>This options is&#160;<code>false</code>&#160;by default.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>recordConverter</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>CsvRecordConverter</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sets the record converter to use. If defines the <code>useMaps</code> options is disabled.</p><p><span>This option is </span><code>null</code><span> by default.</span></p></td></tr></tbody></table></div><h3 id="BookInOnePage-MarshallingaMaptoCSV">Marshalling a Map to CSV</h3><p>The component allows you to marshal a Java Map (or any other message type that can be <a shape="rect" href="type-converter.html">converted</a> in a Map) into a CSV payload.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd">Considering the following body</td><td colspan="1" rowspan="1" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[Map&lt;String, Object&gt; body = new LinkedHashMap&lt;&gt;();
body.put(&quot;foo&quot;, &quot;abc&quot;);
body.put(&quot;bar&quot;, 123);]]></script>
</div></div></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">and this Java route definition</td><td colspan="1" rowspan="1" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;direct:start&quot;)
    .marshal().csv()
    .to(&quot;mock:result&quot;);]]></script>
</div></div></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">or this XML route definition</td><td colspan="1" rowspan="1" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;route&gt;
    &lt;from uri=&quot;direct:start&quot; /&gt;
    &lt;marshal&gt;
        &lt;csv /&gt;
    &lt;/marshal&gt;
    &lt;to uri=&quot;mock:result&quot; /&gt;
&lt;/route&gt;]]></script>
</div></div></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">then it will produce</td><td colspan="1" rowspan="1" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[abc,123]]></script>
</div></div></td></tr></tbody></table></div><h3 id="BookInOnePage-UnmarshallingaCSVmessageintoaJavaList"><span style="font-size: 16.0px;line-height: 1.5625;">Unmarshalling a CSV message into a Java List</span></h3><p>Unmarshalling will transform a CSV messsage into a Java List with CSV file lines (containing another List with all the field values).</p><p><span style="line-height: 1.4285715;">An example: we have a CSV file with names of persons, their IQ and their current activity.</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[Jack Dalton, 115, mad at Averell
Joe Dalton, 105, calming Joe
William Dalton, 105, keeping Joe from killing Averell
Averell Dalton, 80, playing with Rantanplan
Lucky Luke, 120, capturing the Daltons]]></script>
</div></div><p>We can now use the CSV component to unmarshal this file:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;file:src/test/resources/?fileName=daltons.csv&amp;noop=true&quot;)
    .unmarshal().csv()
    .to(&quot;mock:daltons&quot;);]]></script>
</div></div><p>The resulting message will contain a <code>List&lt;List&lt;String&gt;&gt;</code> like...</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[List&lt;List&lt;String&gt;&gt; data = (List&lt;List&lt;String&gt;&gt;) exchange.getIn().getBody();
for (List&lt;String&gt; line : data) {
    LOG.debug(String.format(&quot;%s has an IQ of %s and is currently %s&quot;, line.get(0), line.get(1), line.get(2)));
}]]></script>
</div></div><h3 id="BookInOnePage-MarshallingaList&lt;Map&gt;toCSV">Marshalling a List&lt;Map&gt; to CSV</h3><p><strong>Available as of Camel 2.1</strong></p><p>If you have multiple rows of data you want to be marshalled into CSV format you can now store the message payload as a <code>List&lt;Map&lt;String, Object&gt;&gt;</code> object where the list contains a Map for each row.</p><h3 id="BookInOnePage-FilePollerofCSV,thenunmarshaling">File Poller of CSV, then unmarshaling</h3><p>Given a bean which can handle the incoming data...</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>MyCsvHandler.java</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[// Some comments here
public void doHandleCsvData(List&lt;List&lt;String&gt;&gt; csvData)
{
    // do magic here
}
]]></script>
</div></div><p>... your route then looks as follows</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;route&gt;
        &lt;!-- poll every 10 seconds --&gt;
        &lt;from uri=&quot;file:///some/path/to/pickup/csvfiles?delete=true&amp;amp;consumer.delay=10000&quot; /&gt;
        &lt;unmarshal&gt;&lt;csv /&gt;&lt;/unmarshal&gt;
        &lt;to uri=&quot;bean:myCsvHandler?method=doHandleCsvData&quot; /&gt;
&lt;/route&gt;
]]></script>
</div></div><h3 id="BookInOnePage-Marshalingwithapipeasdelimiter">Marshaling with a pipe as delimiter</h3><p>&#160;</p><p>&#160;</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd">Considering the following body</td><td colspan="1" rowspan="1" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[Map&lt;String, Object&gt; body = new LinkedHashMap&lt;&gt;();
body.put(&quot;foo&quot;, &quot;abc&quot;);
body.put(&quot;bar&quot;, 123);]]></script>
</div></div></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><span>and this Java route definition</span></td><td colspan="1" rowspan="1" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[// Camel version &lt; 2.15
CsvDataFormat oldCSV = new CsvDataFormat();
oldCSV.setDelimiter(&quot;|&quot;);
from(&quot;direct:start&quot;)
    .marshal(oldCSV)
    .to(&quot;mock:result&quot;)

// Camel version &gt;= 2.15
from(&quot;direct:start&quot;)
    .marshal(new CsvDataFormat().setDelimiter(&#39;|&#39;))
    .to(&quot;mock:result&quot;)]]></script>
</div></div></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><span>or this XML route definition</span></td><td colspan="1" rowspan="1" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;route&gt;
  &lt;from uri=&quot;direct:start&quot; /&gt;
  &lt;marshal&gt;
    &lt;csv delimiter=&quot;|&quot; /&gt;
  &lt;/marshal&gt;
  &lt;to uri=&quot;mock:result&quot; /&gt;
&lt;/route&gt;]]></script>
</div></div></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><span>then it will produce</span></td><td colspan="1" rowspan="1" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[abc|123]]></script>
</div></div></td></tr></tbody></table></div><h3 id="BookInOnePage-UsingautogenColumns,configRefandstrategyRefattributesinsideXMLDSL">Using autogenColumns, configRef and strategyRef attributes inside XML DSL</h3><p><strong>Available as of Camel 2.9.2 / 2.10 and deleted for Camel 2.15</strong></p><p>You can customize the CSV <a shape="rect" href="data-format.html">Data Format</a> to make use of your own <code>CSVConfig</code> and/or <code>CSVStrategy</code>. Also note that the default value of the <code>autogenColumns</code> option is true. The following example should illustrate this customization.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;route&gt;
  &lt;from uri=&quot;direct:start&quot; /&gt;
  &lt;marshal&gt;
    &lt;!-- make use of a strategy other than the default one which is &#39;org.apache.commons.csv.CSVStrategy.DEFAULT_STRATEGY&#39; --&gt;
    &lt;csv autogenColumns=&quot;false&quot; delimiter=&quot;|&quot; configRef=&quot;csvConfig&quot; strategyRef=&quot;excelStrategy&quot; /&gt;
  &lt;/marshal&gt;
  &lt;convertBodyTo type=&quot;java.lang.String&quot; /&gt;
  &lt;to uri=&quot;mock:result&quot; /&gt;
&lt;/route&gt;

&lt;bean id=&quot;csvConfig&quot; class=&quot;org.apache.commons.csv.writer.CSVConfig&quot;&gt;
  &lt;property name=&quot;fields&quot;&gt;
    &lt;list&gt;
      &lt;bean class=&quot;org.apache.commons.csv.writer.CSVField&quot;&gt;
        &lt;property name=&quot;name&quot; value=&quot;orderId&quot; /&gt;
      &lt;/bean&gt;
      &lt;bean class=&quot;org.apache.commons.csv.writer.CSVField&quot;&gt;
        &lt;property name=&quot;name&quot; value=&quot;amount&quot; /&gt;
      &lt;/bean&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id=&quot;excelStrategy&quot; class=&quot;org.springframework.beans.factory.config.FieldRetrievingFactoryBean&quot;&gt;
  &lt;property name=&quot;staticField&quot; value=&quot;org.apache.commons.csv.CSVStrategy.EXCEL_STRATEGY&quot; /&gt;
&lt;/bean&gt;
]]></script>
</div></div><h3 id="BookInOnePage-UsingskipFirstLineoptionwhileunmarshaling">Using skipFirstLine option while unmarshaling</h3><p><strong>Available as of Camel 2.10 and deleted for Camel 2.15</strong></p><p>You can instruct the CSV <a shape="rect" href="data-format.html">Data Format</a> to skip the first line which contains the CSV headers. Using the Spring/XML DSL:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;route&gt;
  &lt;from uri=&quot;direct:start&quot; /&gt;
  &lt;unmarshal&gt;
    &lt;csv skipFirstLine=&quot;true&quot; /&gt;
  &lt;/unmarshal&gt;
  &lt;to uri=&quot;bean:myCsvHandler?method=doHandleCsv&quot; /&gt;
&lt;/route&gt;
]]></script>
</div></div><p>Or the Java DSL:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[CsvDataFormat csv = new CsvDataFormat();
csv.setSkipFirstLine(true);

from(&quot;direct:start&quot;)
  .unmarshal(csv)
.to(&quot;bean:myCsvHandler?method=doHandleCsv&quot;);
]]></script>
</div></div><h3 id="BookInOnePage-Unmarshalingwithapipeasdelimiter">Unmarshaling with a pipe as delimiter</h3><p>Using the Spring/XML DSL:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;route&gt;
  &lt;from uri=&quot;direct:start&quot; /&gt;
  &lt;unmarshal&gt;
    &lt;csv delimiter=&quot;|&quot; /&gt;
  &lt;/unmarshal&gt;
  &lt;to uri=&quot;bean:myCsvHandler?method=doHandleCsv&quot; /&gt;
&lt;/route&gt;
]]></script>
</div></div><p>Or the Java DSL:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[CsvDataFormat csv = new CsvDataFormat();
CSVStrategy strategy = CSVStrategy.DEFAULT_STRATEGY;
strategy.setDelimiter(&#39;|&#39;);
csv.setStrategy(strategy);

from(&quot;direct:start&quot;)
  .unmarshal(csv)
  .to(&quot;bean:myCsvHandler?method=doHandleCsv&quot;);
]]></script>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[CsvDataFormat csv = new CsvDataFormat();
csv.setDelimiter(&quot;|&quot;);

from(&quot;direct:start&quot;)
  .unmarshal(csv)
  .to(&quot;bean:myCsvHandler?method=doHandleCsv&quot;);
]]></script>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[CsvDataFormat csv = new CsvDataFormat();
CSVConfig csvConfig = new CSVConfig();
csvConfig.setDelimiter(&quot;;&quot;);
csv.setConfig(csvConfig);

from(&quot;direct:start&quot;)
  .unmarshal(csv)
  .to(&quot;bean:myCsvHandler?method=doHandleCsv&quot;);
]]></script>
</div></div><div class="confluence-information-macro confluence-information-macro-information"><p class="title">Issue in CSVConfig</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>It looks like that</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[CSVConfig csvConfig = new CSVConfig();
csvConfig.setDelimiter(&#39;;&#39;);
]]></script>
</div></div><p>doesn't work. You have to set the delimiter as a String!</p></div></div><h3 id="BookInOnePage-Dependencies.22">Dependencies</h3><p>To use CSV in your Camel routes you need to add a dependency on <strong>camel-csv</strong>, which implements this data format.</p><p>If you use Maven you can just add the following to your pom.xml, substituting the version number for the latest and greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-csv&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div>
The String <a shape="rect" href="data-format.html">Data Format</a> is a textual based format that supports encoding. 

<h3 id="BookInOnePage-Options.3">Options</h3>
<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Option </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> charset </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> null </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> To use a specific charset for encoding. If not provided Camel will use the JVM default charset. </p></td></tr></tbody></table></div>


<h3 id="BookInOnePage-Marshal">Marshal</h3>
<p>In this example we marshal the file content to String object in UTF-8 encoding.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;file://data.csv&quot;).marshal().string(&quot;UTF-8&quot;).to(&quot;jms://myqueue&quot;);
]]></script>
</div></div>

<h3 id="BookInOnePage-Unmarshal">Unmarshal</h3>
<p>In this example we unmarshal the payload from the JMS queue to a String object using UTF-8 encoding, before its processed by the newOrder processor. </p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;jms://queue/order&quot;).unmarshal().string(&quot;UTF-8&quot;).processRef(&quot;newOrder&quot;);
]]></script>
</div></div>

<h3 id="BookInOnePage-Dependencies.23">Dependencies</h3>

<p>This data format is provided in <strong>camel-core</strong> so no additional dependencies is needed.</p>
<h3 id="BookInOnePage-HL7DataFormat">HL7 DataFormat</h3><p>The <a shape="rect" href="hl7.html">HL7</a> component ships with a HL7 data format that can be used to marshal or unmarshal HL7 model objects.</p><ul class="alternate"><li><code>marshal</code> = from Message to byte stream (can be used when responding using the HL7 MLLP codec)</li><li><code>unmarshal</code> = from byte stream to Message (can be used when receiving streamed data from the HL7 MLLP</li></ul><p>To use the data format, simply instantiate an instance and invoke the marshal or unmarshal operation in the route builder:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[  DataFormat hl7 = new HL7DataFormat();
  ...
  from(&quot;direct:hl7in&quot;).marshal(hl7).to(&quot;jms:queue:hl7out&quot;);
]]></script>
</div></div><p>In the sample above, the HL7 is marshalled from a HAPI Message object to a byte stream and put on a JMS queue.<br clear="none"> The next example is the opposite:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[  DataFormat hl7 = new HL7DataFormat();
  ...
  from(&quot;jms:queue:hl7out&quot;).unmarshal(hl7).to(&quot;patientLookupService&quot;);
]]></script>
</div></div><p>Here we unmarshal the byte stream into a HAPI Message object that is passed to our patient lookup service.</p><div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Serializable messages</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>As of HAPI 2.0 (used by <strong>Camel 2.11</strong>), the HL7v2 model classes are fully serializable. So you can put HL7v2 messages directly into a JMS queue (i.e. without calling <code>marshal()</code> and read them again directly from the queue (i.e. without calling <code>unmarshal()</code>.</p></div></div><div class="confluence-information-macro confluence-information-macro-note"><p class="title">Segment separators</p><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>As of <strong>Camel 2.11</strong>, <code>unmarshal</code> does not automatically fix segment separators anymore by converting <code>\n</code> to <code>\r</code>. If you <br clear="none"> need this conversion, <code>org.apache.camel.component.hl7.HL7#convertLFToCR</code> provides a handy <code>Expression</code> for this purpose.</p></div></div><div class="confluence-information-macro confluence-information-macro-note"><p class="title">Charset</p><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>As of <strong>Camel 2.14.1</strong>, both <code>marshal and unmarshal</code> evaluate the charset provided in the field&#160;<code>MSH-18</code>. If this field is empty, by default the charset contained in the corresponding Camel charset property/header is assumed. You can even change this default behavior by overriding the <code>guessCharsetName</code> method when inheriting from the <code>HL7DataFormat</code> class.</p></div></div><p>&#160;</p><p>There is a shorthand syntax in Camel for well-known data formats that are commonly used.<br clear="none"> Then you don't need to create an instance of the <code>HL7DataFormat</code> object:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[  from(&quot;direct:hl7in&quot;).marshal().hl7().to(&quot;jms:queue:hl7out&quot;);
  from(&quot;jms:queue:hl7out&quot;).unmarshal().hl7().to(&quot;patientLookupService&quot;);
]]></script>
</div></div><p>&#160;</p><p>&#160;</p>
<h2 id="BookInOnePage-EDIDataFormat">EDI DataFormat</h2>

<p>We encourage end users to look at the <a shape="rect" class="external-link" href="http://milyn.codehaus.org/Home" rel="nofollow">Smooks</a> which supports EDI and Camel natively.</p>
<h2 id="BookInOnePage-FlatpackDataFormat">Flatpack DataFormat</h2>
<p>The <a shape="rect" href="flatpack.html">Flatpack</a> component ships with the Flatpack data format that can be used to format between fixed width or delimited text messages to a <code>List</code> of rows as <code>Map</code>. </p>
<ul class="alternate"><li>marshal = from <code>List&lt;Map&lt;String, Object&gt;&gt;</code> to <code>OutputStream</code> (can be converted to <code>String</code>)</li><li>unmarshal = from <code>java.io.InputStream</code> (such as a <code>File</code> or <code>String</code>) to a <code>java.util.List</code> as an <code>org.apache.camel.component.flatpack.DataSetList</code> instance.<br clear="none">
The result of the operation will contain all the data. If you need to process each row one by one you can split the exchange, using <a shape="rect" href="splitter.html">Splitter</a>.</li></ul>


<p><strong>Notice:</strong> The Flatpack library does currently not support header and trailers for the marshal operation.</p>

<h3 id="BookInOnePage-Options.4">Options</h3>
<p>The data format has the following options:</p>
<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Option </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>definition</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>null</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The flatpack pzmap configuration file. Can be omitted in simpler situations, but its preferred to use the pzmap. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>fixed</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Delimited or fixed. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>ignoreFirstRecord</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Whether the first line is ignored for delimited files (for the column headers). </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>textQualifier</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>"</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> If the text is qualified with a char such as <code>"</code>. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>delimiter</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>,</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The delimiter char (could be <code>;</code> <code>,</code> or similar) </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>parserFactory</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>null</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Uses the default Flatpack parser factory. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>allowShortLines</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.9.7 and 2.10.5 onwards</strong>: Allows for lines to be shorter than expected and ignores the extra characters. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>ignoreExtraColumns</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.9.7 and 2.10.5 onwards</strong>: Allows for lines to be longer than expected and ignores the extra characters. </p></td></tr></tbody></table></div>


<h3 id="BookInOnePage-Usage">Usage</h3>
<p>To use the data format, simply instantiate an instance and invoke the marshal or unmarshal operation in the route builder:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
  FlatpackDataFormat fp = new FlatpackDataFormat();
  fp.setDefinition(new ClassPathResource(&quot;INVENTORY-Delimited.pzmap.xml&quot;));
  ...
  from(&quot;file:order/in&quot;).unmarshal(df).to(&quot;seda:queue:neworder&quot;);
]]></script>
</div></div>
<p>The sample above will read files from the <code>order/in</code> folder and unmarshal the input using the Flatpack configuration file <code>INVENTORY-Delimited.pzmap.xml</code> that configures the structure of the files. The result is a <code>DataSetList</code> object we store on the SEDA queue.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
FlatpackDataFormat df = new FlatpackDataFormat();
df.setDefinition(new ClassPathResource(&quot;PEOPLE-FixedLength.pzmap.xml&quot;));
df.setFixed(true);
df.setIgnoreFirstRecord(false);

from(&quot;seda:people&quot;).marshal(df).convertBodyTo(String.class).to(&quot;jms:queue:people&quot;);
]]></script>
</div></div>
<p>In the code above we marshal the data from a Object representation as a <code>List</code> of rows as <code>Maps</code>. The rows as <code>Map</code> contains the column name as the key, and the the corresponding value. This structure can be created in Java code from e.g. a processor. We marshal the data according to the Flatpack format and convert the result as a <code>String</code> object and store it on a JMS queue.</p>

<h3 id="BookInOnePage-Dependencies.24">Dependencies</h3>

<p>To use Flatpack in your camel routes you need to add the a dependency on <strong>camel-flatpack</strong> which implements this data format. </p>

<p>If you use maven you could just add the following to your pom.xml, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-flatpack&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div>
<h2 id="BookInOnePage-JSON">JSON</h2><p>JSON is a <a shape="rect" href="data-format.html">Data Format</a> to marshal and unmarshal Java objects to and from <a shape="rect" class="external-link" href="http://www.json.org/" rel="nofollow">JSON</a>.</p><p>For JSON to object marshalling, Camel provides integration with three popular JSON libraries:</p><ul class="alternate"><li>The <a shape="rect" class="external-link" href="http://xstream.codehaus.org/" rel="nofollow">XStream library</a> and <a shape="rect" class="external-link" href="http://jettison.codehaus.org/" rel="nofollow">Jettsion </a></li><li>The <a shape="rect" class="external-link" href="https://github.com/FasterXML/jackson" rel="nofollow">Jackson library</a></li><li><strong>Camel 2.10:</strong> The <a shape="rect" class="external-link" href="http://code.google.com/p/google-gson/" rel="nofollow">GSon library</a></li></ul><p>Every library requires adding the special camel component (see "Dependency..." paragraphs further down). By default Camel uses the XStream library.</p><div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Direct, bi-directional JSON &lt;=&gt; XML conversions</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>As of Camel 2.10, Camel supports direct, bi-directional JSON &lt;=&gt; XML conversions via the <a shape="rect" href="xmljson.html">camel-xmljson</a> data format, which is documented separately.</p></div></div><h3 id="BookInOnePage-UsingJSONdataformatwiththeXStreamlibrary">Using JSON data format with the XStream library</h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[// lets turn Object messages into json then send to MQSeries
from(&quot;activemq:My.Queue&quot;).
  marshal().json().
  to(&quot;mqseries:Another.Queue&quot;);
]]></script>
</div></div><h3 id="BookInOnePage-UsingJSONdataformatwiththeJacksonlibrary">Using JSON data format with the Jackson library</h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[// lets turn Object messages into json then send to MQSeries
from(&quot;activemq:My.Queue&quot;).
  marshal().json(JsonLibrary.Jackson).
  to(&quot;mqseries:Another.Queue&quot;);
]]></script>
</div></div><h3 id="BookInOnePage-UsingJSONdataformatwiththeGSONlibrary">Using JSON data format with the GSON library</h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[// lets turn Object messages into json then send to MQSeries
from(&quot;activemq:My.Queue&quot;).
  marshal().json(JsonLibrary.Gson).
  to(&quot;mqseries:Another.Queue&quot;);
]]></script>
</div></div><h4 id="BookInOnePage-UsingJSONinSpringDSL">Using JSON in Spring DSL</h4><p>When using <a shape="rect" href="data-format.html">Data Format</a> in Spring DSL you need to declare the data formats first. This is done in the <strong>DataFormats</strong> XML tag.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[        &lt;dataFormats&gt;
            &lt;!-- here we define a Json data format with the id jack and that it should use the TestPojo as the class type when
                 doing unmarshal. The unmarshalTypeName is optional, if not provided Camel will use a Map as the type --&gt;
            &lt;json id=&quot;jack&quot; library=&quot;Jackson&quot; unmarshalTypeName=&quot;org.apache.camel.component.jackson.TestPojo&quot;/&gt;
        &lt;/dataFormats&gt;
]]></script>
</div></div><p>And then you can refer to this id in the route:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[       &lt;route&gt;
            &lt;from uri=&quot;direct:back&quot;/&gt;
            &lt;unmarshal ref=&quot;jack&quot;/&gt;
            &lt;to uri=&quot;mock:reverse&quot;/&gt;
        &lt;/route&gt;
]]></script>
</div></div><h3 id="BookInOnePage-ExcludingPOJOfieldsfrommarshalling">Excluding POJO fields from marshalling</h3><p><strong>As of Camel 2.10</strong><br clear="none"> When marshalling a POJO to JSON you might want to exclude certain fields from the JSON output. With Jackson you can use <a shape="rect" class="external-link" href="http://wiki.fasterxml.com/JacksonJsonViews" rel="nofollow">JSON views</a> to accomplish this. First create one or more marker classes.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
public class Views {

    static class Age { }
    static class Weight { }
}
]]></script>
</div></div>Use the marker classes with the <code>@JsonView</code> annotation to include/exclude certain fields. The annotation also works on getters.<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
@JsonView(Views.Age.class)
private int age = 30;

private int height = 190;

@JsonView(Views.Weight.class)
private int weight = 70;
]]></script>
</div></div>Finally use the Camel <code>JacksonDataFormat</code> to marshall the above POJO to JSON.<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;direct:inPojoAgeView&quot;).marshal().json(TestPojoView.class, Views.Age.class);
]]></script>
</div></div>Note that the weight field is missing in the resulting JSON:<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[{&quot;age&quot;:30, &quot;weight&quot;:70}
]]></script>
</div></div><p>The GSON library supports a similar feature through the notion of <a shape="rect" class="external-link" href="http://google-gson.googlecode.com/svn/trunk/gson/docs/javadocs/com/google/gson/ExclusionStrategy.html" rel="nofollow">ExclusionStrategies</a>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
/**
 * Strategy to exclude {@link ExcludeAge} annotated fields
 */
protected static class AgeExclusionStrategy implements ExclusionStrategy {

    @Override
    public boolean shouldSkipField(FieldAttributes f) {
        return f.getAnnotation(ExcludeAge.class) != null;
    }

    @Override
    public boolean shouldSkipClass(Class&lt;?&gt; clazz) {
        return false;
    }
}
]]></script>
</div></div>The <code>GsonDataFormat</code> accepts an <code>ExclusionStrategy</code> in its constructor:<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
GsonDataFormat ageExclusionFormat = new GsonDataFormat(TestPojoExclusion.class);
ageExclusionFormat.setExclusionStrategies(Arrays.&lt;ExclusionStrategy&gt;asList(new AgeExclusionStrategy()));
from(&quot;direct:inPojoExcludeAge&quot;).marshal(ageExclusionFormat);
]]></script>
</div></div>The line above will exclude fields annotated with <code>@ExcludeAge</code> when marshalling to JSON.<h3 id="BookInOnePage-Configuringfieldnamingpolicy">Configuring field naming policy</h3><p><strong>Available as of Camel 2.11</strong></p><p>The GSON library supports specifying policies and strategies for mapping from json to POJO fields. A common naming convention is to map json fields using lower case with underscores.</p><p>We may have this JSON string</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[{
  &quot;id&quot; : 123,
  &quot;first_name&quot; : &quot;Donald&quot;
  &quot;last_name&quot; : &quot;Duck&quot;
}
]]></script>
</div></div><p>Which we want to map to a POJO that has getter/setters as</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>PersonPojo.java</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public class PersonPojo {

    private int id;
    private String firstName;
    private String lastName;

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public String getFirstName() {
        return firstName;
    }

    public void setFirstName(String firstName) {
        this.firstName = firstName;
    }

    public String getLastName() {
        return lastName;
    }

    public void setLastName(String lastName) {
        this.lastName = lastName;
    }
}
]]></script>
</div></div><p>Then we can configure the <code>org.apache.camel.component.gson.GsonDataFormat</code> in a Spring XML files as shown below. Notice we use <code>fieldNamingPolicy</code> property to set the field mapping. This property is an enum from GSon <code>com.google.gson.FieldNamingPolicy</code> which has a number of pre defined mappings. If you need full control you can use the property <code>FieldNamingStrategy</code> and implement a custom <code>com.google.gson.FieldNamingStrategy</code> where you can control the mapping.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Configuring GsonDataFromat in Spring XML file</b></div><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[    &lt;!-- define the gson data format, where we configure the data format using the properties --&gt;
    &lt;bean id=&quot;gson&quot; class=&quot;org.apache.camel.component.gson.GsonDataFormat&quot;&gt;
        &lt;!-- we want to unmarshal to person pojo --&gt;
        &lt;property name=&quot;unmarshalType&quot; value=&quot;org.apache.camel.component.gson.PersonPojo&quot;/&gt;
        &lt;!-- we want to map fields to use lower case and underscores --&gt;
        &lt;property name=&quot;fieldNamingPolicy&quot; value=&quot;LOWER_CASE_WITH_UNDERSCORES&quot;/&gt;
    &lt;/bean&gt;
]]></script>
</div></div><p>And use it in Camel routes by referring to its bean id as shown:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Using gson from Camel Routes</b></div><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[   &lt;camelContext xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;

        &lt;route&gt;
            &lt;from uri=&quot;direct:inPojo&quot;/&gt;
            &lt;marshal ref=&quot;gson&quot;/&gt;
        &lt;/route&gt;

        &lt;route&gt;
            &lt;from uri=&quot;direct:backPojo&quot;/&gt;
            &lt;unmarshal ref=&quot;gson&quot;/&gt;
        &lt;/route&gt;

    &lt;/camelContext&gt;
]]></script>
</div></div><h3 id="BookInOnePage-Include/ExcludefieldsusingthejsonViewattributewithJacksonDataFormat">Include/Exclude fields using the <code>jsonView</code> attribute with <code>JacksonDataFormat</code></h3><p><strong>Available as of Camel 2.12</strong></p><p>As an example of using this attribute you can instead of:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[JacksonDataFormat ageViewFormat = new JacksonDataFormat(TestPojoView.class, Views.Age.class);
from(&quot;direct:inPojoAgeView&quot;).
  marshal(ageViewFormat);
]]></script>
</div></div><p>Directly specify your <a shape="rect" class="external-link" href="http://wiki.fasterxml.com/JacksonJsonViews" rel="nofollow">JSON view</a> inside the Java DSL as:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;direct:inPojoAgeView&quot;).
  marshal().json(TestPojoView.class, Views.Age.class);
]]></script>
</div></div><p>And the same in XML DSL:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;from uri=&quot;direct:inPojoAgeView&quot;/&gt;
  &lt;marshal&gt;
    &lt;json library=&quot;Jackson&quot; unmarshalTypeName=&quot;org.apache.camel.component.jackson.TestPojoView&quot; jsonView=&quot;org.apache.camel.component.jackson.Views$Age&quot;/&gt;
  &lt;/marshal&gt;
]]></script>
</div></div><h3 id="BookInOnePage-SettingserializationincludeoptionforJacksonmarshal">Setting serialization include option for Jackson marshal</h3><p><strong>Available as of Camel 2.13.3/2.14</strong></p><p>If you want to marshal a pojo to JSON, and the pojo has some fields with null values. And you want to skip these null values, then you need to set either an annotation on the pojo,&#160;</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@JsonInclude(Include.NON_NULL)
public class MyPojo {
   ...
}]]></script>
</div></div><p>But this requires you to include that annotation in your pojo source code. You can also configure the Camel JsonDataFormat to set the include option, as shown below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[JacksonDataFormat format = new JacksonDataFormat();
format.setInclude(&quot;NON_NULL&quot;);]]></script>
</div></div><p>Or from XML DSL you configure this as</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[    &lt;dataFormats&gt;
      &lt;json id=&quot;json&quot; library=&quot;Jackson&quot; include=&quot;NON_NULL&quot;/&gt;
    &lt;/dataFormats&gt;]]></script>
</div></div><h3 id="BookInOnePage-UnmarshallingfromjsontoPOJOwithdynamicclassname">Unmarshalling from json to POJO with dynamic class name</h3><p><strong>Available as of Camel 2.14</strong></p><p>If you use jackson to unmarshal json to POJO, then you can now specify a header in the message that indicate which class name to unmarshal to.<br clear="none"><span style="line-height: 1.4285715;">The header has key </span><code style="line-height: 1.4285715;">CamelJacksonUnmarshalType</code><span style="line-height: 1.4285715;">&#160;if that header is present in the message, then Jackson will use that as FQN for the POJO class to unmarshal the json payload as. Notice that behavior is enabled out of the box from Camel 2.14 onwards.&#160;</span></p><p><span style="line-height: 1.4285715;">&#160;</span><span style="line-height: 1.4285715;">For JMS end users there is the JMSType header from the JMS spec that indicates that also. To enable support for JMSType you would need to turn that on, on the jackson data format as shown:</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[JacksonDataFormat format = new JacksonDataFormat();
format.setAllowJmsType(true);]]></script>
</div></div><p>Or from XML DSL you configure this as</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[    &lt;dataFormats&gt;
      &lt;json id=&quot;json&quot; library=&quot;Jackson&quot; allowJmsType=&quot;true&quot;/&gt;
    &lt;/dataFormats&gt;]]></script>
</div></div><h3 id="BookInOnePage-UnmarshallingfromjsontoList&lt;Map&gt;orList&lt;pojo&gt;">Unmarshalling from json to List&lt;Map&gt; or List&lt;pojo&gt;</h3><p><strong>Available as of Camel 2.14</strong></p><p>If you are using Jackson to unmarshal json to a list of map/pojo, you can now specify this by setting&#160;<code>useList="true"</code> or use the&#160;<code>org.apache.camel.component.jackson.ListJacksonDataFormat</code>. For example with Java you can do as shown below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[JacksonDataFormat format = new ListJacksonDataFormat();
// or
JacksonDataFormat format = new JacksonDataFormat();
format.useList();
// and you can specify the pojo class type also
format.setUnmarshalType(MyPojo.class);]]></script>
</div></div><p>And if you use XML DSL then you configure to use list using <code>useList</code> attribute as shown below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[    &lt;dataFormats&gt;
      &lt;json id=&quot;json&quot; library=&quot;Jackson&quot; useList=&quot;true&quot;/&gt;
    &lt;/dataFormats&gt;]]></script>
</div></div><p>And you can specify the pojo type also</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[    &lt;dataFormats&gt;
      &lt;json id=&quot;json&quot; library=&quot;Jackson&quot; useList=&quot;true&quot; unmarshalTypeName=&quot;com.foo.MyPojo&quot;/&gt;
    &lt;/dataFormats&gt;]]></script>
</div></div><h3 id="BookInOnePage-UsingcustomJacksonObjectMapper">Using custom Jackson ObjectMapper</h3><p><strong>Available as of Camel 2.17</strong></p><p>You can use custom Jackson ObjectMapper instance, can be configured as shown below.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[    &lt;dataFormats&gt;
      &lt;json id=&quot;json&quot; library=&quot;Jackson&quot; objectMapper=&quot;myMapper&quot;/&gt;
    &lt;/dataFormats&gt;]]></script>
</div></div><p>Where myMapper is the id of the custom instance that Camel will lookup in the&#160;<a shape="rect" href="registry.html">Registry</a></p><h3 id="BookInOnePage-UsingcustomJacksonmodules">Using custom Jackson modules</h3><p><strong>Available as of Camel 2.15</strong></p><p>You can use custom Jackson modules by specifying the class names of those using the moduleClassNames option as shown below.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[    &lt;dataFormats&gt;
      &lt;json id=&quot;json&quot; library=&quot;Jackson&quot; useList=&quot;true&quot; unmarshalTypeName=&quot;com.foo.MyPojo&quot; moduleClassNames=&quot;com.foo.MyModule,com.foo.MyOtherModule&quot;/&gt;
    &lt;/dataFormats&gt;]]></script>
</div></div><p>When using&#160;moduleClassNames then the custom jackson modules are not configured, by created using default constructor and used as-is. If a custom module needs any custom configuration, then an instance of the module can be created and configured, and then use modulesRefs to refer to the module as shown below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[    &lt;bean id=&quot;myJacksonModule&quot; class=&quot;com.foo.MyModule&quot;&gt;
      ... // configure the module as you want
    &lt;/bean&gt;

    &lt;dataFormats&gt;
      &lt;json id=&quot;json&quot; library=&quot;Jackson&quot; useList=&quot;true&quot; unmarshalTypeName=&quot;com.foo.MyPojo&quot; moduleRefs=&quot;myJacksonModule&quot;/&gt;
    &lt;/dataFormats&gt;]]></script>
</div></div><p>&#160;Multiple modules can be specified separated by comma, such as moduleRefs="myJacksonModule,myOtherModule"</p><h3 id="BookInOnePage-EnablingordisablefeaturesusingJackson">Enabling or disable features using Jackson</h3><p><strong>Available as of Camel 2.15</strong></p><p>Jackson has a number of features you can enable or disable, which its ObjectMapper uses. For example to disable failing on unknown properties when marshalling, you can configure this using the disableFeatures:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[ &lt;dataFormats&gt;
      &lt;json id=&quot;json&quot; library=&quot;Jackson&quot; unmarshalTypeName=&quot;com.foo.MyPojo&quot; disableFeatures=&quot;FAIL_ON_UNKNOWN_PROPERTIES&quot;/&gt;
 &lt;/dataFormats&gt;]]></script>
</div></div><p>You can disable multiple features by separating the values using comma. The values for the features must be the name of the enums from Jackson from the following enum classes</p><ul><li>com.fasterxml.jackson.databind.SerializationFeature</li><li>com.fasterxml.jackson.databind.DeserializationFeature</li><li>com.fasterxml.jackson.databind.MapperFeature</li></ul><p>To enable a feature use the enableFeatures options instead.</p><p>From Java code you can use the type safe methods from camel-jackson module:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[JacksonDataFormat df = new JacksonDataFormat(MyPojo.class);
df.disableFeature(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);
df.disableFeature(DeserializationFeature.FAIL_ON_NULL_FOR_PRIMITIVES);]]></script>
</div></div><h3 id="BookInOnePage-ConvertingMapstoPOJOusingJackson">Converting Maps to POJO using Jackson</h3><p>Available since <strong>Camel 2.16</strong>. Jackson <code>ObjectMapper</code> can be used to convert maps to POJO objects. Jackson component comes with the data converter that can be used to convert <code>java.util.Map</code> instance to non-String, non-primitive and non-Number objects.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[Map&lt;String, Object&gt; invoiceData = new HashMap&lt;String, Object&gt;();
invoiceData.put(&quot;netValue&quot;, 500);
producerTemplate.sendBody(&quot;direct:mapToInvoice&quot;, invoiceData);
...
// Later in the processor
Invoice invoice = exchange.getIn().getBody(Invoice.class);]]></script>
</div></div><p>If there is a single <code>ObjectMapper</code> instance available in the Camel registry, it will used by the converter to perform the conversion. Otherwise the default mapper will be used. &#160;</p><h3 id="BookInOnePage-FormattedJSONmarshalling(pretty-printing)">Formatted JSON marshalling (pretty-printing)</h3><p><strong>Available as of Camel 2.16</strong></p><p>Using the <code>prettyPrint</code> option&#160;one can output a well formatted JSON while marshalling:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[ &lt;dataFormats&gt;
      &lt;json id=&quot;xstream&quot; prettyPrint=&quot;true&quot;/&gt;
      &lt;json id=&quot;jackson&quot; prettyPrint=&quot;true&quot; library=&quot;Jackson&quot;/&gt;
      &lt;json id=&quot;gson&quot; prettyPrint=&quot;true&quot; library=&quot;Gson&quot;/&gt;
 &lt;/dataFormats&gt;]]></script>
</div></div><p><span style="line-height: 1.5625;">And in Java DSL:</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;direct:inPretty&quot;).marshal().json(true);

from(&quot;direct:inPretty&quot;).marshal().json(JsonLibrary.Jackson, true);

from(&quot;direct:inPretty&quot;).marshal().json(JsonLibrary.Gson, true);]]></script>
</div></div><p><span style="line-height: 1.5625;">Please note that as of Camel 2.16 there&#8217;re 5 different overloaded <code>json()</code> DSL methods which support the <code>prettyPrint</code> option in combination with other settings for <code>JsonLibrary</code>, <code>unmarshalType</code>, <code>jsonView</code> etc.&#160;</span></p><h3 id="BookInOnePage-"><span style="line-height: 1.5625;">&#160;</span></h3><h3 id="BookInOnePage-IntegratingJacksonwithCamel'sTypeConverters">Integrating Jackson with Camel's&#160;TypeConverters</h3><h3 id="BookInOnePage-.1"><span style="line-height: 1.5625;">&#160;</span></h3><p><strong>Available as of Camel 2.17</strong></p><p><span style="line-height: 1.5625;">The&#160;<code>camel-jackson</code> module allows to integrate Jackson as a&#160;<a shape="rect" href="type-converter.html">Type Converter</a> in the Camel registry. This works in similar ways that&#160;<code>camel-jaxb</code>&#160;integrates with the type converter as well. However&#160;<code>camel-jackson</code> must be explicit enabled, which is done by setting some options on the&#160;<code>CamelContext</code> properties, as shown below:</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[// enable Jackson json type converter
getContext().getProperties().put(&quot;CamelJacksonEnableTypeConverter&quot;, &quot;true&quot;);
// allow Jackson json to convert to pojo types also (by default jackson only converts to String and other simple types)
getContext().getProperties().put(&quot;CamelJacksonTypeConverterToPojo&quot;, &quot;true&quot;);]]></script>
</div></div><p>The&#160;<code>camel-jackson</code> type converter integrates with JAXB which means you can annotate POJO class with&#160;JAXB annotations that Jackson can leverage.&#160;</p><p><span style="line-height: 1.5625;"><br clear="none"></span></p><h3 id="BookInOnePage-DependenciesforXStream"><span style="line-height: 1.5625;">Dependencies for XStream</span></h3><p>To use JSON in your camel routes you need to add the a dependency on <strong>camel-xstream</strong> which implements this data format.</p><p>If you use maven you could just add the following to your pom.xml, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-xstream&lt;/artifactId&gt;
  &lt;version&gt;2.9.2&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div><h3 id="BookInOnePage-DependenciesforJackson">Dependencies for Jackson</h3><p>To use JSON in your camel routes you need to add the a dependency on <strong>camel-jackson</strong> which implements this data format.</p><p>If you use maven you could just add the following to your pom.xml, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-jackson&lt;/artifactId&gt;
  &lt;version&gt;2.9.2&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div><h3 id="BookInOnePage-DependenciesforGSON">Dependencies for GSON</h3><p>To use JSON in your camel routes you need to add the a dependency on <strong>camel-gson</strong> which implements this data format.</p><p>If you use maven you could just add the following to your pom.xml, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-gson&lt;/artifactId&gt;
  &lt;version&gt;2.10.0&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div>
The Zip <a shape="rect" href="data-format.html">Data Format</a> is a message compression and de-compression format. Messages marshalled using Zip compression can be unmarshalled using Zip decompression just prior to being consumed at the endpoint. The compression capability is quite useful when you deal with large XML and Text based payloads. It facilitates more optimal use of network bandwidth while incurring a small cost in order to compress and decompress payloads at the endpoint.<div class="confluence-information-macro confluence-information-macro-information"><p class="title">About using with Files</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>The Zip data format, does not (yet) have special support for files. Which means that when using big files, the entire file content is loaded into memory.<br clear="none"> This is subject to change in the future, to allow a streaming based solution to have a low memory footprint.</p></div></div><h3 id="BookInOnePage-Options.5">Options</h3><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>compressionLevel</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>null</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To specify a specific compression Level use <code>java.util.zip.Deflater</code> settings. The possible settings are&#160; <br clear="none" class="atl-forced-newline"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; - <code>Deflater.BEST_SPEED</code> <br clear="none" class="atl-forced-newline"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; - <code>Deflater.BEST_COMPRESSION</code> <br clear="none" class="atl-forced-newline"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; - <code>Deflater.DEFAULT_COMPRESSION</code> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> If compressionLevel is not explicitly specified the compressionLevel employed is <code>Deflater.DEFAULT_COMPRESSION</code></p></td></tr></tbody></table></div><h3 id="BookInOnePage-Marshal.1">Marshal</h3><p>In this example we marshal a regular text/XML payload to a compressed payload employing zip compression <code>Deflater.BEST_COMPRESSION</code> and send it an ActiveMQ queue called MY_QUEUE.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;direct:start&quot;).marshal().zip(Deflater.BEST_COMPRESSION).to(&quot;activemq:queue:MY_QUEUE&quot;);
]]></script>
</div></div><p>Alternatively if you would like to use the default setting you could send it as</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;direct:start&quot;).marshal().zip().to(&quot;activemq:queue:MY_QUEUE&quot;);
]]></script>
</div></div><h3 id="BookInOnePage-Unmarshal.1">Unmarshal</h3><p>In this example we unmarshal&#160;a zipped&#160;payload from an ActiveMQ queue called MY_QUEUE&#160;to its original format,&#160;and forward it for&#160;processing&#160;to the UnZippedMessageProcessor. Note that the compression Level employed during the marshalling should be identical to the one employed during unmarshalling to avoid errors.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;activemq:queue:MY_QUEUE&quot;).unmarshal().zip().process(new UnZippedMessageProcessor());
]]></script>
</div></div><h3 id="BookInOnePage-Dependencies.25">Dependencies</h3><p>This data format is provided in <strong>camel-core</strong> so no additional dependencies are needed.</p>
<h2 id="BookInOnePage-TidyMarkup">TidyMarkup</h2>

<p>TidyMarkup is a <a shape="rect" href="data-format.html">Data Format</a> that uses the <a shape="rect" class="external-link" href="http://www.ccil.org/~cowan/XML/tagsoup/" rel="nofollow">TagSoup</a> to tidy up HTML. It can be used to parse ugly HTML and return it as pretty wellformed HTML.</p>

<div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Camel eats our own -dog food- soap</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>We had some issues in our pdf <a shape="rect" href="manual.html">Manual</a> where we had some strange symbols. So <a shape="rect" class="external-link" href="http://janstey.blogspot.com/" rel="nofollow">Jonathan</a> used this data format to tidy up the wiki html pages that are used as base for rendering the pdf manuals. And then the mysterious symbols vanished.</p></div></div> 

<p><a shape="rect" href="tidymarkup.html">TidyMarkup</a> only supports the <strong>unmarshal</strong> operation as we really don't want to turn well formed HTML into ugly HTML <img class="emoticon emoticon-smile" src="https://cwiki.apache.org/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/icons/emoticons/smile.png" data-emoticon-name="smile" alt="(smile)"></p>

<h3 id="BookInOnePage-JavaDSLExample">Java DSL Example</h3>
<p>An example where the consumer provides some HTML</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;file://site/inbox&quot;).unmarshal().tidyMarkup().to(&quot;file://site/blogs&quot;);
]]></script>
</div></div>

<h3 id="BookInOnePage-SpringXMLExample">Spring XML Example</h3>
<p>The following example shows how to use <a shape="rect" href="tidymarkup.html">TidyMarkup</a> to unmarshal using Spring</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;camelContext id=&quot;camel&quot; xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;
  &lt;route&gt;
    &lt;from uri=&quot;file://site/inbox&quot;/&gt;
    &lt;unmarshal&gt;
      &lt;tidyMarkup/&gt;
    &lt;/unmarshal&gt;
    &lt;to uri=&quot;file://site/blogs&quot;/&gt;
  &lt;/route&gt;
&lt;/camelContext&gt;
]]></script>
</div></div>


<h3 id="BookInOnePage-Dependencies.26">Dependencies</h3>

<p>To use TidyMarkup in your camel routes you need to add the a dependency on <strong>camel-tagsoup</strong> which implements this data format. </p>

<p>If you use maven you could just add the following to your pom.xml, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-tagsoup&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div>
<h2 id="BookInOnePage-Bindy">Bindy</h2><p>The goal of this component is to allow the parsing/binding of non-structured data (or to be more precise non-XML data)<br clear="none"> to/from Java Beans that have binding mappings defined with annotations. Using Bindy, you can bind data from sources such as :</p><ul class="alternate"><li>CSV records,</li><li>Fixed-length records,</li><li>FIX messages,</li><li>or almost any other non-structured data</li></ul><p>to one or many Plain Old Java Object (POJO). Bindy converts the data according to the type of the java property. POJOs can be linked together with one-to-many relationships available in some cases. Moreover, for data type like Date, Double, Float, Integer, Short, Long and BigDecimal, you can provide the pattern to apply during the formatting of the property.</p><p>For the BigDecimal numbers, you can also define the precision and the decimal or grouping separators.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Format Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Pattern example</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Link</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>Date</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>DateFormat</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>"dd-MM-yyyy"</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/text/SimpleDateFormat.html" rel="nofollow">http://java.sun.com/j2se/1.5.0/docs/api/java/text/SimpleDateFormat.html</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>Decimal*</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Decimalformat</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>"##.###.###"</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/text/DecimalFormat.html" rel="nofollow">http://java.sun.com/j2se/1.5.0/docs/api/java/text/DecimalFormat.html</a></p></td></tr></tbody></table></div><p>Decimal* = Double, Integer, Float, Short, Long</p><div class="confluence-information-macro confluence-information-macro-note"><p class="title">Format supported</p><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>This first release only support comma separated values fields and key value pair fields (e.g. : FIX messages).</p></div></div><p>To work with camel-bindy, you must first define your model in a package (e.g. com.acme.model) and for each model class (e.g. Order, Client, Instrument, ...) add the required annotations (described hereafter) to the Class or field.</p><div class="confluence-information-macro confluence-information-macro-note"><p class="title">Multiple models</p><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>If you use multiple models, each model has to be placed in it's own package to prevent unpredictable results.</p><p>From <strong>Camel 2.16</strong> onwards this is no longer the case, as you can safely have multiple models in the same package, as you configure bindy using class names instead of package names now.</p></div></div><h2 id="BookInOnePage-Annotations.2">Annotations</h2><p>The annotations created allow to map different concept of your model to the POJO like :</p><ul class="alternate"><li>Type of record (csv, key value pair (e.g. FIX message), fixed length ...),</li><li>Link (to link object in another object),</li><li>DataField and their properties (int, type, ...),</li><li>KeyValuePairField (for key = value format like we have in FIX financial messages),</li><li>Section (to identify header, body and footer section),</li><li>OneToMany</li></ul><p>This section will describe them :</p><h3 id="BookInOnePage-1.CsvRecord">1. CsvRecord</h3><p>The CsvRecord annotation is used to identified the root class of the model. It represents a record = a line of a CSV file and can be linked to several children model classes.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Annotation name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Record type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Level</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>CsvRecord</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>csv</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Class</p></td></tr></tbody></table></div><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Parameter name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Info</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>separator</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>string</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>mandatory - can be ',' or ';' or 'anything'. This value is interpreted as a regular expression. If you want to use a sign which has a special meaning in regular expressions, e.g. the '|' sign, than you have to mask it, like ' <br clear="none" class="atl-forced-newline"> |'</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>skipFirstLine</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - default value = false - allow to skip the first line of the CSV file</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>crlf</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>string</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - possible values = WINDOWS,UNIX,MAC, or custom; default value = WINDOWS - allow to define the carriage return character to use. If you specify a value other than the three listed before, the value you enter (custom) will be used as the CRLF character(s)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>generateHeaderColumns</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - default value = false - uses to generate the header columns of the CSV generates</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>autospanLine</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.13/2.12.2:</strong> optional - default value = false - if enabled then the last column is auto spanned to end of line, for example if its a comment, etc this allows the line to contain all characters, also the delimiter char.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>isOrdered</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - default value = false - allow to change the order of the fields when CSV is generated</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>quote</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>String</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8.3/2.9:</strong> option - allow to specify a quote character of the fields when CSV is generated</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>This annotation is associated to the root class of the model and must be declared one time.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">quoting</td><td colspan="1" rowspan="1" class="confluenceTd">boolean</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.11:</strong>optional - default value = false -&#160;Indicate if the values must be quoted when marshaling when CSV is generated.</td></tr></tbody></table></div><p><strong>case 1 : separator = ','</strong></p><p>The separator used to segregate the fields in the CSV record is ',' :</p><p>10, J, Pauline, M, XD12345678, Fortis Dynamic 15/15, 2500, USD,08-01-2009</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord( separator = &quot;,&quot; )
public Class Order {
...
}
]]></script>
</div></div><p><strong>case 2 : separator = ';'</strong></p><p>Compare to the previous case, the separator here is ';' instead of ',' :</p><p>10; J; Pauline; M; XD12345678; Fortis Dynamic 15/15; 2500; USD; 08-01-2009</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord( separator = &quot;;&quot; )
public Class Order {
...
}
]]></script>
</div></div><p><strong>case 3 : separator = '|'</strong></p><p>Compare to the previous case, the separator here is '|' instead of ';' :</p><p>10| J| Pauline| M| XD12345678| Fortis Dynamic 15/15| 2500| USD| 08-01-2009</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord( separator = &quot;\\|&quot; )
public Class Order {
...
}
]]></script>
</div></div><p><strong>case 4 : separator = '\",\"'</strong><br clear="none"> <strong>Applies for Camel 2.8.2 or older</strong></p><p>When the field to be parsed of the CSV record contains ',' or ';' which is also used as separator, we whould find another strategy<br clear="none"> to tell camel bindy how to handle this case. To define the field containing the data with a comma, you will use simple or double quotes<br clear="none"> as delimiter (e.g : '10', 'Street 10, NY', 'USA' or "10", "Street 10, NY", "USA").<br clear="none"> Remark : In this case, the first and last character of the line which are a simple or double quotes will removed by bindy</p><p>"10","J","Pauline"," M","XD12345678","Fortis Dynamic 15,15" 2500","USD","08-01-2009"</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord( separator = &quot;\&quot;,\&quot;&quot; )
public Class Order {
...
}
]]></script>
</div></div><p>From <strong>Camel 2.8.3/2.9 or never</strong> bindy will automatic detect if the record is enclosed with either single or double quotes and automatic remove those quotes when unmarshalling from CSV to Object. Therefore do <strong>not</strong> include the quotes in the separator, but simple do as below:</p><p>"10","J","Pauline"," M","XD12345678","Fortis Dynamic 15,15" 2500","USD","08-01-2009"</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord( separator = &quot;,&quot; )
public Class Order {
...
}
]]></script>
</div></div><p>Notice that if you want to marshal from Object to CSV and use quotes, then you need to specify which quote character to use, using the <code>quote</code> attribute on the @CsvRecord as shown below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord( separator = &quot;,&quot;, quote = &quot;\&quot;&quot; )
public Class Order {
...
}
]]></script>
</div></div><p><strong>case 5 : separator &amp; skipfirstline</strong></p><p>The feature is interesting when the client wants to have in the first line of the file, the name of the data fields :</p><p>order id, client id, first name, last name, isin code, instrument name, quantity, currency, date</p><p>To inform bindy that this first line must be skipped during the parsing process, then we use the attribute :</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord(separator = &quot;,&quot;, skipFirstLine = true)
public Class Order {
...
}
]]></script>
</div></div><p><strong>case 6 : generateHeaderColumns</strong></p><p>To add at the first line of the CSV generated, the attribute generateHeaderColumns must be set to true in the annotation like this :</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord( generateHeaderColumns = true )
public Class Order {
...
}
]]></script>
</div></div><p>As a result, Bindy during the unmarshaling process will generate CSV like this :</p><p>order id, client id, first name, last name, isin code, instrument name, quantity, currency, date<br clear="none"> 10, J, Pauline, M, XD12345678, Fortis Dynamic 15/15, 2500, USD,08-01-2009</p><p><strong>case 7 : carriage return</strong></p><p>If the platform where camel-bindy will run is not Windows but Macintosh or Unix, than you can change the crlf property like this. Three values are available : WINDOWS, UNIX or MAC</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord(separator = &quot;,&quot;, crlf=&quot;MAC&quot;)
public Class Order {
...
}
]]></script>
</div></div><p>Additionally, if for some reason you need to add a different line ending character, you can opt to specify it using the crlf parameter. In the following example, we can end the line with a comma followed by the newline character:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord(separator = &quot;,&quot;, crlf=&quot;,\n&quot;)
public Class Order {
...
}
]]></script>
</div></div><p><strong>case 8 : isOrdered</strong></p><p>Sometimes, the order to follow during the creation of the CSV record from the model is different from the order used during the parsing. Then, in this case, we can use the attribute isOrdered = true to indicate this in combination with attribute 'position' of the DataField annotation.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord(isOrdered = true)
public Class Order {

   @DataField(pos = 1, position = 11)
   private int orderNr;

   @DataField(pos = 2, position = 10)
   private String clientNr;

...
}
]]></script>
</div></div><p>Remark : pos is used to parse the file, stream while positions is used to generate the CSV</p><h3 id="BookInOnePage-2.Link">2. Link</h3><p>The link annotation will allow to link objects together.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Annotation name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Record type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Level</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Link</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>all</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Class &amp; Property</p></td></tr></tbody></table></div><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Parameter name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Info</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>linkType</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>LinkType</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - by default the value is LinkType.oneToOne - so you are not obliged to mention it</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Only one-to-one relation is allowed.</p></td></tr></tbody></table></div><p>e.g : If the model Class Client is linked to the Order class, then use annotation Link in the Order class like this :</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Property Link</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord(separator = &quot;,&quot;)
public class Order {

    @DataField(pos = 1)
    private int orderNr;

    @Link
    private Client client;
...
]]></script>
</div></div><p>AND for the class Client :</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Class Link</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@Link
public class Client {
...
}
]]></script>
</div></div><h3 id="BookInOnePage-3.DataField">3. DataField</h3><p>The DataField annotation defines the property of the field. Each datafield is identified by its position in the record, a type (string, int, date, ...) and optionally of a pattern</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Annotation name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Record type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Level</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>DataField</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>all</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Property</p></td></tr></tbody></table></div><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Parameter name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Info</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>pos</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>int</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>mandatory - The <strong>input</strong> position of the field. digit number starting from 1 to ... - See the position parameter.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>pattern</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>string</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - default value = "" - will be used to format Decimal, Date, ...</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>length</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>int</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - represents the length of the field for fixed length format</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>precision</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>int</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - represents the precision to be used when the Decimal number will be formatted/parsed</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>pattern</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>string</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - default value = "" - is used by the Java formatter (SimpleDateFormat by example) to format/validate data. If using pattern, then setting locale on bindy data format is recommended. Either set to a known locale such as "us" or use "default" to use platform default locale. Notice that "default" requires Camel 2.14/2.13.3/2.12.5.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>position</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>int</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - must be used when the position of the field in the CSV generated (output message) must be different compare to input position (pos). See the pos parameter.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>required</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - default value = "false"</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>trim</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - default value = "false"</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>defaultValue</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>string</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> optional - default value = "" - defines the field's default value when the respective CSV field is empty/not available</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>impliedDecimalSeparator</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> optional - default value = "false" - Indicates if there is a decimal point implied at a specified location</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>lengthPos</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>int</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11</strong>: optional - can be used to identify&#160;a data field in a fixed-length record that defines the fixed length for this field</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>delimiter</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>string</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> optional - can be used to demarcate the end of a variable-length field within a fixed-length record</p></td></tr></tbody></table></div><p><strong>case 1 : pos</strong></p><p>This parameter/attribute represents the position of the field in the csv record</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Position</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord(separator = &quot;,&quot;)
public class Order {

    @DataField(pos = 1)
    private int orderNr;

    @DataField(pos = 5)
    private String isinCode;

...
}
]]></script>
</div></div><p>As you can see in this example the position starts at '1' but continues at '5' in the class Order. The numbers from '2' to '4' are defined in the class Client (see here after).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Position continues in another model class</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public class Client {

    @DataField(pos = 2)
    private String clientNr;

    @DataField(pos = 3)
    private String firstName;

    @DataField(pos = 4)
    private String lastName;
...
}
]]></script>
</div></div><p><strong>case 2 : pattern</strong></p><p>The pattern allows to enrich or validates the format of your data</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Pattern</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord(separator = &quot;,&quot;)
public class Order {

    @DataField(pos = 1)
    private int orderNr;

    @DataField(pos = 5)
    private String isinCode;

    @DataField(name = &quot;Name&quot;, pos = 6)
    private String instrumentName;

    @DataField(pos = 7, precision = 2)
    private BigDecimal amount;

    @DataField(pos = 8)
    private String currency;

    @DataField(pos = 9, pattern = &quot;dd-MM-yyyy&quot;) -- pattern used during parsing or when the date is created
    private Date orderDate;
...
}
]]></script>
</div></div><p><strong>case 3 : precision</strong></p><p>The precision is helpful when you want to define the decimal part of your number</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Precision</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord(separator = &quot;,&quot;)
public class Order {

    @DataField(pos = 1)
    private int orderNr;

    @Link
    private Client client;

    @DataField(pos = 5)
    private String isinCode;

    @DataField(name = &quot;Name&quot;, pos = 6)
    private String instrumentName;

    @DataField(pos = 7, precision = 2) -- precision
    private BigDecimal amount;

    @DataField(pos = 8)
    private String currency;

    @DataField(pos = 9, pattern = &quot;dd-MM-yyyy&quot;)
    private Date orderDate;
...
}
]]></script>
</div></div><p><strong>case 4 : Position is different in output</strong></p><p>The position attribute will inform bindy how to place the field in the CSV record generated. By default, the position used corresponds to the position defined with the attribute 'pos'. If the position is different (that means that we have an asymetric processus comparing marshaling from unmarshaling) than we can use 'position' to indicate this.</p><p>Here is an example</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Position is different in output</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord(separator = &quot;,&quot;)
public class Order {
@CsvRecord(separator = &quot;,&quot;, isOrdered = true)
public class Order {

    // Positions of the fields start from 1 and not from 0

    @DataField(pos = 1, position = 11)
    private int orderNr;

    @DataField(pos = 2, position = 10)
    private String clientNr;

    @DataField(pos = 3, position = 9)
    private String firstName;

    @DataField(pos = 4, position = 8)
    private String lastName;

    @DataField(pos = 5, position = 7)
    private String instrumentCode;

    @DataField(pos = 6, position = 6)
    private String instrumentNumber;
...
}
]]></script>
</div></div><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>This attribute of the annotation @DataField must be used in combination with attribute isOrdered = true of the annotation @CsvRecord</p></div></div><p><strong>case 5 : required</strong></p><p>If a field is mandatory, simply use the attribute 'required' setted to true</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Required</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord(separator = &quot;,&quot;)
public class Order {

    @DataField(pos = 1)
    private int orderNr;

    @DataField(pos = 2, required = true)
    private String clientNr;

    @DataField(pos = 3, required = true)
    private String firstName;

    @DataField(pos = 4, required = true)
    private String lastName;
...
}
]]></script>
</div></div><p>If this field is not present in the record, than an error will be raised by the parser with the following information :</p><p>Some fields are missing (optional or mandatory), line :</p><p><strong>case 6 : trim</strong></p><p>If a field has leading and/or trailing spaces which should be removed before they are processed, simply use the attribute 'trim' setted to true</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Trim</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord(separator = &quot;,&quot;)
public class Order {

    @DataField(pos = 1, trim = true)
    private int orderNr;

    @DataField(pos = 2, trim = true)
    private Integer clientNr;

    @DataField(pos = 3, required = true)
    private String firstName;

    @DataField(pos = 4)
    private String lastName;
...
}
]]></script>
</div></div><p><strong>case 7 : defaultValue</strong></p><p>If a field is not defined then uses the value indicated by the defaultValue attribute</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Default value</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord(separator = &quot;,&quot;)
public class Order {

    @DataField(pos = 1)
    private int orderNr;

    @DataField(pos = 2)
    private Integer clientNr;

    @DataField(pos = 3, required = true)
    private String firstName;

    @DataField(pos = 4, defaultValue = &quot;Barin&quot;)
    private String lastName;
...
}
]]></script>
</div></div><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>This attribute is only applicable to optional fields.</p></div></div><h3 id="BookInOnePage-4.FixedLengthRecord">4. FixedLengthRecord</h3><p>The FixedLengthRecord annotation is used to identified the root class of the model. It represents a record = a line of a file/message containing data fixed length formatted and can be linked to several children model classes. This format is a bit particular beause data of a field can be aligned to the right or to the left.<br clear="none"> When the size of the data does not fill completely the length of the field, we can then add 'padd' characters.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Annotation name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Record type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Level</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FixedLengthRecord</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>fixed</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Class</p></td></tr></tbody></table></div><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Parameter name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Info</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>crlf</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>string</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - possible values = WINDOWS,UNIX,MAC, or custom; default value = WINDOWS - allow to define the carriage return character to use. If you specify a value other than the three listed before, the value you enter (custom) will be used as the CRLF character(s)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>paddingChar</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>char</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>mandatory - default value = ' '</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>length</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>int</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>mandatory = size of the fixed length record</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>hasHeader</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11</strong> - optional - Indicates that the record(s) of this type may be preceded by a single header record at the beginning of the file / stream</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>hasFooter</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11</strong> - optional - Indicates that the record(s) of this type may be followed by a single footer record at the end of the file / stream</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>skipHeader</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11</strong> - optional - Configures the data format to skip marshalling / unmarshalling of the header record. Configure this parameter on the primary record (e.g., not the header or footer).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>skipFooter</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11</strong> - optional - Configures the data format to skip marshalling / unmarshalling of the footer record Configure this parameter on the primary record (e.g., not the header or footer)..</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>isHeader</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11</strong> - optional - Identifies this FixedLengthRecord as a header record</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>isFooter</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11</strong> - optional - Identifies this FixedLengthRecords as a footer record</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>ignoreTrailingChars</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.1</strong> - optional - Indicates that characters beyond the last mapped filed can be ignored when unmarshalling / parsing.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>This annotation is associated to the root class of the model and must be declared one time.</p></td></tr></tbody></table></div><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>The hasHeader/hasFooter parameters are mutually exclusive with isHeader/isFooter. A record may not be both a header/footer and a primary fixed-length record.</p></div></div><p><strong>case 1 : Simple fixed length record</strong></p><p>This simple example shows how to design the model to parse/format a fixed message</p><p>10A9PaulineMISINXD12345678BUYShare2500.45USD01-08-2009</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Fixed-simple</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[   @FixedLengthRecord(length=54, paddingChar=&#39; &#39;)
    public static class Order {

        @DataField(pos = 1, length=2)
        private int orderNr;

        @DataField(pos = 3, length=2)
        private String clientNr;

        @DataField(pos = 5, length=7)
        private String firstName;

        @DataField(pos = 12, length=1, align=&quot;L&quot;)
        private String lastName;

        @DataField(pos = 13, length=4)
        private String instrumentCode;

        @DataField(pos = 17, length=10)
        private String instrumentNumber;

        @DataField(pos = 27, length=3)
        private String orderType;

        @DataField(pos = 30, length=5)
        private String instrumentType;

        @DataField(pos = 35, precision = 2, length=7)
        private BigDecimal amount;

        @DataField(pos = 42, length=3)
        private String currency;

        @DataField(pos = 45, length=10, pattern = &quot;dd-MM-yyyy&quot;)
        private Date orderDate;
        ...
]]></script>
</div></div><p><strong>case 2 : Fixed length record with alignment and padding</strong></p><p>This more elaborated example show how to define the alignment for a field and how to assign a padding character which is ' ' here''</p><p>10A9 PaulineM ISINXD12345678BUYShare2500.45USD01-08-2009</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Fixed-padding-align</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[   @FixedLengthRecord(length=60, paddingChar=&#39; &#39;)
    public static class Order {

        @DataField(pos = 1, length=2)
        private int orderNr;

        @DataField(pos = 3, length=2)
        private String clientNr;

        @DataField(pos = 5, length=9)
        private String firstName;

        @DataField(pos = 14, length=5, align=&quot;L&quot;)   // align text to the LEFT zone of the block
        private String lastName;

        @DataField(pos = 19, length=4)
        private String instrumentCode;

        @DataField(pos = 23, length=10)
        private String instrumentNumber;

        @DataField(pos = 33, length=3)
        private String orderType;

        @DataField(pos = 36, length=5)
        private String instrumentType;

        @DataField(pos = 41, precision = 2, length=7)
        private BigDecimal amount;

        @DataField(pos = 48, length=3)
        private String currency;

        @DataField(pos = 51, length=10, pattern = &quot;dd-MM-yyyy&quot;)
        private Date orderDate;
        ...
]]></script>
</div></div><p><strong>case 3 : Field padding</strong></p><p>Sometimes, the default padding defined for record cannnot be applied to the field as we have a number format where we would like to padd with '0' instead of ' '. In this case, you can use in the model the attribute paddingField to set this value.</p><p>10A9 PaulineM ISINXD12345678BUYShare000002500.45USD01-08-2009</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Fixed-padding-field</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[    @FixedLengthRecord(length = 65, paddingChar = &#39; &#39;)
    public static class Order {

        @DataField(pos = 1, length = 2)
        private int orderNr;

        @DataField(pos = 3, length = 2)
        private String clientNr;

        @DataField(pos = 5, length = 9)
        private String firstName;

        @DataField(pos = 14, length = 5, align = &quot;L&quot;)
        private String lastName;

        @DataField(pos = 19, length = 4)
        private String instrumentCode;

        @DataField(pos = 23, length = 10)
        private String instrumentNumber;

        @DataField(pos = 33, length = 3)
        private String orderType;

        @DataField(pos = 36, length = 5)
        private String instrumentType;

        @DataField(pos = 41, precision = 2, length = 12, paddingChar = &#39;0&#39;)
        private BigDecimal amount;

        @DataField(pos = 53, length = 3)
        private String currency;

        @DataField(pos = 56, length = 10, pattern = &quot;dd-MM-yyyy&quot;)
        private Date orderDate;
        ...
]]></script>
</div></div><p><strong>case 4: Fixed length record with delimiter</strong></p><p>Fixed-length records sometimes have delimited content within the record. The firstName and lastName fields are delimited with the '^' character in the following example:</p><p>10A9Pauline^M^ISINXD12345678BUYShare000002500.45USD01-08-2009</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Fixed-delimited</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[    @FixedLengthRecord()
    public static class Order {

        @DataField(pos = 1, length = 2)
        private int orderNr;

        @DataField(pos = 2, length = 2)
        private String clientNr;

        @DataField(pos = 3, delimiter = &quot;^&quot;)
        private String firstName;

        @DataField(pos = 4, delimiter = &quot;^&quot;)
        private String lastName;

        @DataField(pos = 5, length = 4)
        private String instrumentCode;

        @DataField(pos = 6, length = 10)
        private String instrumentNumber;

        @DataField(pos = 7, length = 3)
        private String orderType;

        @DataField(pos = 8, length = 5)
        private String instrumentType;

        @DataField(pos = 9, precision = 2, length = 12, paddingChar = &#39;0&#39;)
        private BigDecimal amount;

        @DataField(pos = 10, length = 3)
        private String currency;

        @DataField(pos = 11, length = 10, pattern = &quot;dd-MM-yyyy&quot;)
        private Date orderDate;
]]></script>
</div></div><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>As of <strong>Camel 2.11</strong> the 'pos' value(s) in a fixed-length record may optionally be defined using ordinal, sequential values instead of precise column numbers.</p></div></div><p><strong>case 5 : Fixed length record with record-defined field length</strong></p><p>Occasionally a fixed-length record may contain a field that define the expected length of another field within the same record. In the following example the length of the instrumentNumber field value is defined by the value of instrumentNumberLen field in the record.</p><p>10A9Pauline^M^ISIN10XD12345678BUYShare000002500.45USD01-08-2009</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Fixed-delimited</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[    @FixedLengthRecord()
    public static class Order {

        @DataField(pos = 1, length = 2)
        private int orderNr;

        @DataField(pos = 2, length = 2)
        private String clientNr;

        @DataField(pos = 3, delimiter = &quot;^&quot;)
        private String firstName;

        @DataField(pos = 4, delimiter = &quot;^&quot;)
        private String lastName;

        @DataField(pos = 5, length = 4)
        private String instrumentCode;

        @DataField(pos = 6, length = 2, align = &quot;R&quot;, paddingChar = &#39;0&#39;)
        private int instrumentNumberLen;
        
        @DataField(pos = 7, lengthPos=6)
        private String instrumentNumber;

        @DataField(pos = 8, length = 3)
        private String orderType;

        @DataField(pos = 9, length = 5)
        private String instrumentType;

        @DataField(pos = 10, precision = 2, length = 12, paddingChar = &#39;0&#39;)
        private BigDecimal amount;

        @DataField(pos = 11, length = 3)
        private String currency;

        @DataField(pos = 12, length = 10, pattern = &quot;dd-MM-yyyy&quot;)
        private Date orderDate;
]]></script>
</div></div><p><strong>case 6 : Fixed length record with header and footer</strong></p><p>Bindy will discover fixed-length header and footer records that are configured as part of the model &#8211; provided that the annotated classes exist either in the same package as the primary @FixedLengthRecord class, or within one of the configured scan packages. The following text illustrates two fixed-length records that are bracketed by a header record and footer record.</p><p>101-08-2009<br clear="none"> 10A9 PaulineM ISINXD12345678BUYShare000002500.45USD01-08-2009<br clear="none"> 10A9 RichN ISINXD12345678BUYShare000002700.45USD01-08-2009<br clear="none"> 9000000002</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Fixed-header-and-footer-main-class</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@FixedLengthRecord(hasHeader = true, hasFooter = true)
public class Order {

    @DataField(pos = 1, length = 2)
    private int orderNr;

    @DataField(pos = 2, length = 2)
    private String clientNr;

    @DataField(pos = 3, length = 9)
    private String firstName;

    @DataField(pos = 4, length = 5, align = &quot;L&quot;)
    private String lastName;

    @DataField(pos = 5, length = 4)
    private String instrumentCode;

    @DataField(pos = 6, length = 10)
    private String instrumentNumber;

    @DataField(pos = 7, length = 3)
    private String orderType;

    @DataField(pos = 8, length = 5)
    private String instrumentType;

    @DataField(pos = 9, precision = 2, length = 12, paddingChar = &#39;0&#39;)
    private BigDecimal amount;

    @DataField(pos = 10, length = 3)
    private String currency;

    @DataField(pos = 11, length = 10, pattern = &quot;dd-MM-yyyy&quot;)
    private Date orderDate;
...
}


@FixedLengthRecord(isHeader = true)
public  class OrderHeader {
    @DataField(pos = 1, length = 1)
    private int recordType = 1;
    
    @DataField(pos = 2, length = 10, pattern = &quot;dd-MM-yyyy&quot;)
    private Date recordDate;
    
...
}


@FixedLengthRecord(isFooter = true)
public class OrderFooter {
    
    @DataField(pos = 1, length = 1)
    private int recordType = 9;
    
    @DataField(pos = 2, length = 9, align = &quot;R&quot;, paddingChar = &#39;0&#39;)
    private int numberOfRecordsInTheFile;

...
}

]]></script>
</div></div><p><strong>case 7 : Skipping content when parsing a fixed length record. (Camel 2.11.1)</strong></p><p>It is common to integrate with systems that provide fixed-length records containing more information than needed for the target use case. It is useful in this situation to skip the declaration and parsing of those fields that we do not need. To accomodate this, Bindy will skip forward to the next mapped field within a record if the 'pos' value of the next declared field is beyond the cursor position of the last parsed field. Using absolute 'pos' locations for the fields of interest (instead of ordinal values) causes Bindy to skip content between two fields.</p><p>Similarly, it is possible that none of the content beyond some field is of interest. In this case, you can tell Bindy to skip parsing of everything beyond the last mapped field by setting the <strong>ignoreTrailingChars</strong> property on the @FixedLengthRecord declaration.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@FixedLengthRecord(ignoreTrailingChars = true)
public static class Order {

        @DataField(pos = 1, length = 2)
        private int orderNr;

        @DataField(pos = 3, length = 2)
        private String clientNr;

    ... any characters that appear beyond the last mapped field will be ignored

}
]]></script>
</div></div><h3 id="BookInOnePage-5.Message">5. Message</h3><p>The Message annotation is used to identified the class of your model who will contain key value pairs fields. This kind of format is used mainly in Financial Exchange Protocol Messages (FIX). Nevertheless, this annotation can be used for any other format where data are identified by keys. The key pair values are separated each other by a separator which can be a special character like a tab delimitor (unicode representation : \u0009) or a start of heading (unicode representation : \u0001)</p><div class="confluence-information-macro confluence-information-macro-note"><p class="title">"FIX information"</p><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>More information about FIX can be found on this web site : <a shape="rect" class="external-link" href="http://www.fixprotocol.org/" rel="nofollow">http://www.fixprotocol.org/</a>. To work with FIX messages, the model must contain a Header and Trailer classes linked to the root message class which could be a Order class. This is not mandatory but will be very helpful when you will use camel-bindy in combination with camel-fix which is a Fix gateway based on quickFix project <a shape="rect" class="external-link" href="http://www.quickfixj.org/" rel="nofollow">http://www.quickfixj.org/</a>.</p></div></div><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Annotation name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Record type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Level</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Message</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>key value pair</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Class</p></td></tr></tbody></table></div><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Parameter name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Info</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>pairSeparator</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>string</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>mandatory - can be '=' or ';' or 'anything'</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>keyValuePairSeparair</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>string</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>mandatory - can be '\u0001', '\u0009', '#' or 'anything'</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>crlf</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>string</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - possible values = WINDOWS,UNIX,MAC, or custom; default value = WINDOWS - allow to define the carriage return character to use. If you specify a value other than the three listed before, the value you enter (custom) will be used as the CRLF character(s)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>type</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>string</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - define the type of message (e.g. FIX, EMX, ...)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>version</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>string</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - version of the message (e.g. 4.1)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>isOrdered</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - default value = false - allow to change the order of the fields when FIX message is generated</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>This annotation is associated to the message class of the model and must be declared one time.</p></td></tr></tbody></table></div><p><strong>case 1 : separator = 'u0001'</strong></p><p>The separator used to segregate the key value pair fields in a FIX message is the ASCII '01' character or in unicode format '\u0001'. This character must be escaped a second time to avoid a java runtime error. Here is an example :</p><p>8=FIX.4.1 9=20 34=1 35=0 49=INVMGR 56=BRKR 1=BE.CHM.001 11=CHM0001-01 22=4 ...</p><p>and how to use the annotation</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>FIX - message</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@Message(keyValuePairSeparator = &quot;=&quot;, pairSeparator = &quot;\u0001&quot;, type=&quot;FIX&quot;, version=&quot;4.1&quot;)
public class Order {
...
}
]]></script>
</div></div><div class="confluence-information-macro confluence-information-macro-note"><p class="title">Look at test cases</p><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>The ASCII character like tab, ... cannot be displayed in WIKI page. So, have a look to the test case of camel-bindy to see exactly how the FIX message looks like (src\test\data\fix\fix.txt) and the Order, Trailer, Header classes (src\test\java\org\apache\camel\dataformat\bindy\model\fix\simple\Order.java)</p></div></div><h3 id="BookInOnePage-6.KeyValuePairField">6. KeyValuePairField</h3><p>The KeyValuePairField annotation defines the property of a key value pair field. Each KeyValuePairField is identified by a tag (= key) and its value associated, a type (string, int, date, ...), optionaly a pattern and if the field is required</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Annotation name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Record type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Level</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>KeyValuePairField</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Key Value Pair - FIX</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Property</p></td></tr></tbody></table></div><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Parameter name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Info</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>tag</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>int</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>mandatory - digit number identifying the field in the message - must be unique</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>pattern</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>string</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - default value = "" - will be used to format Decimal, Date, ...</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>precision</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>int</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - digit number - represents the precision to be used when the Decimal number will be formatted/parsed</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>position</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>int</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - must be used when the position of the key/tag in the FIX message must be different</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>required</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - default value = "false"</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>impliedDecimalSeparator</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> optional - default value = "false" - Indicates if there is a decimal point implied at a specified location</p></td></tr></tbody></table></div><p><strong>case 1 : tag</strong></p><p>This parameter represents the key of the field in the message</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>FIX message - Tag</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@Message(keyValuePairSeparator = &quot;=&quot;, pairSeparator = &quot;\u0001&quot;, type=&quot;FIX&quot;, version=&quot;4.1&quot;)
public class Order {

    @Link Header header;

    @Link Trailer trailer;

    @KeyValuePairField(tag = 1) // Client reference
    private String Account;

    @KeyValuePairField(tag = 11) // Order reference
    private String ClOrdId;

    @KeyValuePairField(tag = 22) // Fund ID type (Sedol, ISIN, ...)
    private String IDSource;

    @KeyValuePairField(tag = 48) // Fund code
    private String SecurityId;

    @KeyValuePairField(tag = 54) // Movement type ( 1 = Buy, 2 = sell)
    private String Side;

    @KeyValuePairField(tag = 58) // Free text
    private String Text;

...
}
]]></script>
</div></div><p><strong>case 2 : Different position in output</strong></p><p>If the tags/keys that we will put in the FIX message must be sorted according to a predefine order, then use the attribute 'position' of the annotation @KeyValuePairField</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>FIX message - Tag - sort</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@Message(keyValuePairSeparator = &quot;=&quot;, pairSeparator = &quot;\\u0001&quot;, type = &quot;FIX&quot;, version = &quot;4.1&quot;, isOrdered = true)
public class Order {

    @Link Header header;

    @Link Trailer trailer;

    @KeyValuePairField(tag = 1, position = 1) // Client reference
    private String account;

    @KeyValuePairField(tag = 11, position = 3) // Order reference
    private String clOrdId;

...
}
]]></script>
</div></div><h3 id="BookInOnePage-7.Section">7. Section</h3><p>In FIX message of fixed length records, it is common to have different sections in the representation of the information : header, body and section. The purpose of the annotation @Section is to inform bindy about which class of the model represents the header (= section 1), body (= section 2) and footer (= section 3)</p><p>Only one attribute/parameter exists for this annotation.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Annotation name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Record type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Level</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Section</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>FIX</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Class</p></td></tr></tbody></table></div><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Parameter name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Info</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>number</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>int</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>digit number identifying the section position</p></td></tr></tbody></table></div><p><strong>case 1 : Section</strong></p><p>A. Definition of the header section</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>FIX message - Section - Header</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@Section(number = 1)
public class Header {

    @KeyValuePairField(tag = 8, position = 1) // Message Header
    private String beginString;

    @KeyValuePairField(tag = 9, position = 2) // Checksum
    private int bodyLength;
...
}
]]></script>
</div></div><p>B. Definition of the body section</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>FIX message - Section - Body</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@Section(number = 2)
@Message(keyValuePairSeparator = &quot;=&quot;, pairSeparator = &quot;\\u0001&quot;, type = &quot;FIX&quot;, version = &quot;4.1&quot;, isOrdered = true)
public class Order {

    @Link Header header;

    @Link Trailer trailer;

    @KeyValuePairField(tag = 1, position = 1) // Client reference
    private String account;

    @KeyValuePairField(tag = 11, position = 3) // Order reference
    private String clOrdId;
]]></script>
</div></div><p>C. Definition of the footer section</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>FIX message - Section - Footer</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@Section(number = 3)
public class Trailer {

    @KeyValuePairField(tag = 10, position = 1)
    // CheckSum
    private int checkSum;

    public int getCheckSum() {
        return checkSum;
    }
]]></script>
</div></div><h3 id="BookInOnePage-8.OneToMany">8. OneToMany</h3><p>The purpose of the annotation @OneToMany is to allow to work with a List&lt;?&gt; field defined a POJO class or from a record containing repetitive groups.</p><div class="confluence-information-macro confluence-information-macro-note"><p class="title">Restrictions OneToMany</p><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Be careful, the one to many of bindy does not allow to handle repetitions defined on several levels of the hierarchy</p></div></div><p>The relation OneToMany ONLY WORKS in the following cases :</p><ul class="alternate"><li>Reading a FIX message containing repetitive groups (= group of tags/keys)</li><li>Generating a CSV with repetitive data</li></ul><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Annotation name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Record type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Level</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>OneToMany</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>all</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>property</p></td></tr></tbody></table></div><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Parameter name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Info</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>mappedTo</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>string</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>optional - string - class name associated to the type of the List&lt;Type of the Class&gt;</p></td></tr></tbody></table></div><p><strong>case 1 : Generating CSV with repetitive data</strong></p><p>Here is the CSV output that we want :</p><p>Claus,Ibsen,Camel in Action 1,2010,35<br clear="none"> Claus,Ibsen,Camel in Action 2,2012,35<br clear="none"> Claus,Ibsen,Camel in Action 3,2013,35<br clear="none"> Claus,Ibsen,Camel in Action 4,2014,35</p><p>Remark : the repetitive data concern the title of the book and its publication date while first, last name and age are common</p><p>and the classes used to modeling this. The Author class contains a List of Book.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Generate CSV with repetitive data</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[@CsvRecord(separator=&quot;,&quot;)
public class Author {

	@DataField(pos = 1)
	private String firstName;

	@DataField(pos = 2)
	private String lastName;

	@OneToMany
	private List&lt;Book&gt; books;

	@DataField(pos = 5)
	private String Age;
...


public class Book {

	@DataField(pos = 3)
	private String title;

	@DataField(pos = 4)
	private String year;
]]></script>
</div></div><p>Very simple isn't it !!!</p><p><strong>case 2 : Reading FIX message containing group of tags/keys</strong></p><p>Here is the message that we would like to process in our model :</p><p>"8=FIX 4.19=2034=135=049=INVMGR56=BRKR"<br clear="none"> "1=BE.CHM.00111=CHM0001-0158=this is a camel - bindy test"<br clear="none"> "22=448=BE000124567854=1"<br clear="none"> "22=548=BE000987654354=2"<br clear="none"> "22=648=BE000999999954=3"<br clear="none"> "10=220"</p><p>tags 22, 48 and 54 are repeated</p><p>and the code</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Reading FIX message containing group of tags/keys</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[public class Order {

    @Link Header header;

    @Link Trailer trailer;

    @KeyValuePairField(tag = 1) // Client reference
    private String account;

    @KeyValuePairField(tag = 11) // Order reference
    private String clOrdId;

    @KeyValuePairField(tag = 58) // Free text
    private String text;

    @OneToMany(mappedTo = &quot;org.apache.camel.dataformat.bindy.model.fix.complex.onetomany.Security&quot;)
    List&lt;Security&gt; securities;
...

public class Security {

    @KeyValuePairField(tag = 22) // Fund ID type (Sedol, ISIN, ...)
    private String idSource;

    @KeyValuePairField(tag = 48) // Fund code
    private String securityCode;

    @KeyValuePairField(tag = 54) // Movement type ( 1 = Buy, 2 = sell)
    private String side;

]]></script>
</div></div><h3 id="BookInOnePage-UsingtheJavaDSL.2">Using the Java DSL</h3><p>The next step consists in instantiating the DataFormat <em>bindy</em> class associated with this record type and providing Java package name(s) as parameter.</p><p>For example the following uses the class <code>BindyCsvDataFormat</code> (who correspond to the class associated with the CSV record type) which is configured with "com.acme.model"<br clear="none"> package name to initialize the model objects configured in this package.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[// Camel 2.15 or older (configure by package name)
DataFormat bindy = new BindyCsvDataFormat(&quot;com.acme.model&quot;);


// Camel 2.16 onwards (configure by class name)
DataFormat bindy = new BindyCsvDataFormat(com.acme.model.MyModel.class);]]></script>
</div></div><h4 id="BookInOnePage-Settinglocale">Setting locale</h4><p>Bindy supports configuring the locale on the dataformat, such as&#160;</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[// Camel 2.15 or older (configure by package name)
BindyCsvDataFormat bindy = new BindyCsvDataFormat(&quot;com.acme.model&quot;);
// Camel 2.16 onwards (configure by class name)
BindyCsvDataFormat bindy = new BindyCsvDataFormat(com.acme.model.MyModel.class);

bindy.setLocale(&quot;us&quot;);]]></script>
</div></div><p>Or to use the platform default locale then use "default" as the locale name. Notice this requires Camel 2.14/2.13.3/2.12.5.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[// Camel 2.15 or older (configure by package name)
BindyCsvDataFormat bindy = new BindyCsvDataFormat(&quot;com.acme.model&quot;);
// Camel 2.16 onwards (configure by class name)
BindyCsvDataFormat bindy = new BindyCsvDataFormat(com.acme.model.MyModel.class);

bindy.setLocale(&quot;default&quot;);]]></script>
</div></div><p>for older releases you can set it using Java code as shown</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[// Camel 2.15 or older (configure by package name)
BindyCsvDataFormat bindy = new BindyCsvDataFormat(&quot;com.acme.model&quot;);
// Camel 2.16 onwards (configure by class name)
BindyCsvDataFormat bindy = new BindyCsvDataFormat(com.acme.model.MyModel.class);


bindy.setLocale(Locale.getDefault().getISO3Country());]]></script>
</div></div><h4 id="BookInOnePage-Unmarshaling">Unmarshaling</h4><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;file://inbox&quot;)
  .unmarshal(bindy)
  .to(&quot;direct:handleOrders&quot;);
]]></script>
</div></div><p>Alternatively, you can use a named reference to a data format which can then be defined in your <a shape="rect" href="registry.html">Registry</a> e.g. your <a shape="rect" href="spring.html">Spring</a> XML file:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;file://inbox&quot;)
  .unmarshal(&quot;myBindyDataFormat&quot;)
  .to(&quot;direct:handleOrders&quot;);
]]></script>
</div></div><p>The Camel route will pick-up files in the inbox directory, unmarshall CSV records into a collection of model objects and send the collection<br clear="none"> to the route referenced by 'handleOrders'.</p><p>The collection returned is a <strong>List of Map</strong> objects. Each Map within the list contains the model objects that were marshalled out of each line of the CSV. The reason behind this is that <em>each line can correspond to more than one object</em>. This can be confusing when you simply expect one object to be returned per line.</p><p>Each object can be retrieve using its class name.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[    List&lt;Map&lt;String, Object&gt;&gt; unmarshaledModels = (List&lt;Map&lt;String, Object&gt;&gt;) exchange.getIn().getBody();

    int modelCount = 0;
    for (Map&lt;String, Object&gt; model : unmarshaledModels) {
	  for (String className : model.keySet()) {
	     Object obj = model.get(className);
	     LOG.info(&quot;Count : &quot; + modelCount + &quot;, &quot; + obj.toString());
	  }
	 modelCount++;
    }

    LOG.info(&quot;Total CSV records received by the csv bean : &quot; + modelCount);
]]></script>
</div></div><p>Assuming that you want to extract a single Order object from this map for processing in a route, you could use a combination of a <a shape="rect" href="splitter.html">Splitter</a> and a <a shape="rect" href="processor.html">Processor</a> as per the following:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;file://inbox&quot;)
    .unmarshal(bindy)
    .split(body())
        .process(new Processor() {
            public void process(Exchange exchange) throws Exception {
                Message in = exchange.getIn();
                Map&lt;String, Object&gt; modelMap = (Map&lt;String, Object&gt;) in.getBody();
                in.setBody(modelMap.get(Order.class.getCanonicalName()));
            }
        })
        .to(&quot;direct:handleSingleOrder&quot;)
    .end();
]]></script>
</div></div><p>Take care of the fact that Bindy uses CHARSET_NAME property or the CHARSET_NAME header as define in the Exchange interface to do a characterset conversion of the inputstream received for unmarshalling. In some producers (e.g. file-endpoint) you can define a characterset. The characterset conversion can already been done by this producer. Sometimes you need to remove this property or header from the exchange before sending it to the unmarshal. If you don't remove it the conversion might be done twice which might lead to unwanted results.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;file://inbox?charset=Cp922&quot;)
  .removeProperty(Exchange.CHARSET_NAME)
  .unmarshal(&quot;myBindyDataFormat&quot;)
  .to(&quot;direct:handleOrders&quot;);]]></script>
</div></div><h4 id="BookInOnePage-Marshaling">Marshaling</h4><p>To generate CSV records from a collection of model objects, you create the following route :</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;direct:handleOrders&quot;)
   .marshal(bindy)
   .to(&quot;file://outbox&quot;)
]]></script>
</div></div><h3 id="BookInOnePage-UsingSpringXML.2">Using Spring XML</h3><p>This is really easy to use Spring as your favorite DSL language to declare the routes to be used for camel-bindy. The following example shows two routes where the first will pick-up records from files, unmarshal the content and bind it to their model. The result is then send to a pojo (doing nothing special) and place them into a queue.</p><p>The second route will extract the pojos from the queue and marshal the content to generate a file containing the csv record. The example above is for using Camel 2.16 onwards.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>spring dsl</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
	xsi:schemaLocation=&quot;
       http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring
       http://camel.apache.org/schema/spring/camel-spring.xsd&quot;&gt;

        &lt;!-- Queuing engine - ActiveMq - work locally in mode virtual memory --&gt;
	&lt;bean id=&quot;activemq&quot; class=&quot;org.apache.activemq.camel.component.ActiveMQComponent&quot;&gt;
		&lt;property name=&quot;brokerURL&quot; value=&quot;vm://localhost:61616&quot;/&gt;
	&lt;/bean&gt;


	&lt;camelContext xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;


        &lt;dataFormats&gt;
          &lt;bindy id=&quot;bindyDataformat&quot; type=&quot;Csv&quot; classType=&quot;org.apache.camel.bindy.model.Order&quot;/&gt;
        &lt;/dataFormats&gt;

		&lt;route&gt;
			&lt;from uri=&quot;file://src/data/csv/?noop=true&quot; /&gt;
			&lt;unmarshal ref=&quot;bindyDataformat&quot; /&gt;
			&lt;to uri=&quot;bean:csv&quot; /&gt;
			&lt;to uri=&quot;activemq:queue:in&quot; /&gt;
		&lt;/route&gt;

		&lt;route&gt;
			&lt;from uri=&quot;activemq:queue:in&quot; /&gt;
			&lt;marshal ref=&quot;bindyDataformat&quot; /&gt;
			&lt;to uri=&quot;file://src/data/csv/out/&quot; /&gt;
		&lt;/route&gt;
	&lt;/camelContext&gt;
&lt;/beans&gt;
]]></script>
</div></div><div class="confluence-information-macro confluence-information-macro-note"><p class="title">Be careful</p><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Please verify that your model classes implements serializable otherwise the queue manager will raise an error</p></div></div><h3 id="BookInOnePage-Dependencies.27">Dependencies</h3><p>To use Bindy in your camel routes you need to add the a dependency on <strong>camel-bindy</strong> which implements this data format.</p><p>If you use maven you could just add the following to your pom.xml, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-bindy&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div>
<h2 id="BookInOnePage-XMLSecurityDataFormat">XMLSecurity Data Format</h2><p>The XMLSecurity Data Format facilitates encryption and decryption of XML payloads at the Document, Element, and Element Content levels (including simultaneous multi-node encryption/decryption using XPath). To sign messages using the XML Signature specification, please see the Camel XML Security <a shape="rect" href="xml-security-component.html">component</a>.</p><p>The encryption capability is based on formats supported using the Apache XML Security (Santuario) project. Symmetric encryption/decryption is currently supported using Triple-DES and AES (128, 192, and 256) encryption formats. Additional formats can be easily added later as needed. This capability allows Camel users to encrypt/decrypt payloads while being dispatched or received along a route.</p><p><strong>Available as of Camel 2.9</strong><br clear="none"> The XMLSecurity Data Format supports asymmetric key encryption. In this encryption model a symmetric key is generated and used to perform XML content encryption or decryption. This "content encryption key" is then itself encrypted using an asymmetric encryption algorithm that leverages the recipient's public key as the "key encryption key". Use of an asymmetric key encryption algorithm ensures that only the holder of the recipient's private key can access the generated symmetric encryption key. Thus, only the private key holder can decode the message. The XMLSecurity Data Format handles all of the logic required to encrypt and decrypt the message content and encryption key(s) using asymmetric key encryption.</p><p>The XMLSecurity Data Format also has improved support for namespaces when processing the XPath queries that select content for encryption. A namespace definition mapping can be included as part of the data format configuration. This enables true namespace matching, even if the prefix values in the XPath query and the target xml document are not equivalent strings.</p><h3 id="BookInOnePage-BasicOptions">Basic Options</h3><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>secureTag</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The XPath reference to the XML Element selected for encryption/decryption. If no tag is specified, the entire payload is encrypted/decrypted.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>secureTagContents</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A boolean value to specify whether the XML Element is to be encrypted or the contents of the XML Element</p><ul><li><code>false</code> = Element Level</li><li><code>true</code> = Element Content Level</li></ul></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>passPhrase</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A String used as passPhrase to encrypt/decrypt content. The passPhrase has to be provided. If no passPhrase is specified, a default passPhrase is used. The passPhrase needs to be put together in conjunction with the appropriate encryption algorithm. For example using <code>TRIPLEDES</code> the passPhase can be a <code>"Only another 24 Byte key"</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>xmlCipherAlgorithm</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>TRIPLEDES</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The cipher algorithm to be used for encryption/decryption of the XML message content. The available choices are:</p><ul><li><code>XMLCipher.TRIPLEDES</code></li><li><code>XMLCipher.AES_128</code></li><li><code>XMLCipher.AES_128_GCM</code> <strong>Camel 2.12</strong></li><li><code>XMLCipher.AES_192</code></li><li><code>XMLCipher.AES_192_GCM</code> <strong>Camel 2.12</strong></li><li><code>XMLCipher.AES_256</code></li><li><code>XMLCipher.AES_256_GCM</code> <strong>Camel 2.12</strong></li><li>XMLCipher.SEED_128 <strong>Camel 2.15</strong></li><li>XMLCipher.CAMELLIA_128, XMLCipher.CAMELLIA_192, XMLCipher.CAMELLIA_256 <strong>Camel 2.15</strong></li></ul></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>namespaces</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A map of namespace values indexed by prefix. The index values must match the prefixes used in the <code>secureTag</code> XPath query.</p></td></tr></tbody></table></div><h3 id="BookInOnePage-AsymmetricEncryptionOptions">Asymmetric Encryption Options</h3><p>These options can be applied in addition to relevant the Basic options to use asymmetric key encryption.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>recipientKeyAlias</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The key alias to be used when retrieving the recipient's public or private key from a KeyStore when performing asymmetric key encryption or decryption.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>keyCipherAlgorithm</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12</strong> <code>XMLCipher.RSA_OAEP</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The cipher algorithm to be used for encryption/decryption of the asymmetric key. The available choices are:</p><ul><li><code>XMLCipher.RSA_v1dot5</code></li><li><code>XMLCipher.RSA_OAEP</code></li><li><code>XMLCipher.RSA_OAEP_11</code></li></ul></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>keyOrTrustStoreParameters</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Configuration options for creating and loading a KeyStore instance that represents the sender's trustStore or recipient's keyStore.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>keyPassword</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.2 / 2.11:</strong> The password to be used for retrieving the private key from the KeyStore. This key is used for asymmetric decryption.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>digestAlgorithm</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>XMLCipher.SHA1</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12</strong> The digest algorithm to use with the RSA OAEP algorithm. The available choices are:</p><ul><li><code>XMLCipher.SHA1</code></li><li><code>XMLCipher.SHA256</code></li><li><code>XMLCipher.SHA512</code></li></ul></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>mgfAlgorithm</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>EncryptionConstants.MGF1_SHA1</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12</strong> The MGF Algorithm to use with the RSA OAEP algorithm. The available choices are:</p><ul><li><code>EncryptionConstants.MGF1_SHA1</code></li><li><code>EncryptionConstants.MGF1_SHA256</code></li><li><code>EncryptionConstants.MGF1_SHA512</code></li></ul></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">addKeyValueForEncryptedKey</td><td colspan="1" rowspan="1" class="confluenceTd">true</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.14.1 </strong>Whether to add the public key used to encrypt the session key as a KeyValue in the EncryptedKey structure or not.</td></tr></tbody></table></div><h4 id="BookInOnePage-KeyCipherAlgorithm">Key Cipher Algorithm</h4><p>As of Camel 2.12.0, the default Key Cipher Algorithm is now XMLCipher.RSA_OAEP instead of XMLCipher.RSA_v1dot5. Usage of XMLCipher.RSA_v1dot5 is discouraged due to various attacks. Requests that use RSA v1.5 as the key cipher algorithm will be rejected unless it has been explicitly configured as the key cipher algorithm.</p><h3 id="BookInOnePage-Marshal.2">Marshal</h3><p>In order to encrypt the payload, the <code>marshal</code> processor needs to be applied on the route followed by the <strong><code>secureXML()</code></strong> tag.</p><h3 id="BookInOnePage-Unmarshal.2">Unmarshal</h3><p>In order to decrypt the payload, the <code>unmarshal</code> processor needs to be applied on the route followed by the <strong><code>secureXML()</code></strong> tag.</p><h3 id="BookInOnePage-Examples.6">Examples</h3><p>Given below are several examples of how marshalling could be performed at the Document, Element, and Content levels.</p><h4 id="BookInOnePage-FullPayloadencryption/decryption">Full Payload encryption/decryption</h4><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[from(&quot;direct:start&quot;)
    .marshal().secureXML()
    .unmarshal().secureXML()
    .to(&quot;direct:end&quot;);
]]></script>
</div></div><h4 id="BookInOnePage-PartialPayloadContentOnlyencryption/decryption">Partial Payload Content Only encryption/decryption</h4><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[String tagXPATH = &quot;//cheesesites/italy/cheese&quot;;
boolean secureTagContent = true;
...
from(&quot;direct:start&quot;)
    .marshal().secureXML(tagXPATH, secureTagContent)
    .unmarshal().secureXML(tagXPATH, secureTagContent)
    .to(&quot;direct:end&quot;);
]]></script>
</div></div><h4 id="BookInOnePage-PartialMultiNodePayloadContentOnlyencryption/decryption">Partial Multi Node Payload Content Only encryption/decryption</h4><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[String tagXPATH = &quot;//cheesesites/*/cheese&quot;;
boolean secureTagContent = true;
...
from(&quot;direct:start&quot;)
    .marshal().secureXML(tagXPATH, secureTagContent)
    .unmarshal().secureXML(tagXPATH, secureTagContent)
    .to(&quot;direct:end&quot;);
]]></script>
</div></div><h4 id="BookInOnePage-PartialPayloadContentOnlyencryption/decryptionwithchoiceofpassPhrase(password)">Partial Payload Content Only encryption/decryption with choice of passPhrase(password)</h4><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[String tagXPATH = &quot;//cheesesites/italy/cheese&quot;;
boolean secureTagContent = true;
...
String passPhrase = &quot;Just another 24 Byte key&quot;;
from(&quot;direct:start&quot;)
    .marshal().secureXML(tagXPATH, secureTagContent, passPhrase)
    .unmarshal().secureXML(tagXPATH, secureTagContent, passPhrase)
    .to(&quot;direct:end&quot;);
]]></script>
</div></div><h4 id="BookInOnePage-PartialPayloadContentOnlyencryption/decryptionwithpassPhrase(password)andAlgorithm">Partial Payload Content Only encryption/decryption with passPhrase(password) and Algorithm</h4><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[import org.apache.xml.security.encryption.XMLCipher;
....
String tagXPATH = &quot;//cheesesites/italy/cheese&quot;;
boolean secureTagContent = true;
String passPhrase = &quot;Just another 24 Byte key&quot;;
String algorithm= XMLCipher.TRIPLEDES;
from(&quot;direct:start&quot;)
    .marshal().secureXML(tagXPATH, secureTagContent, passPhrase, algorithm)
    .unmarshal().secureXML(tagXPATH, secureTagContent, passPhrase, algorithm)
    .to(&quot;direct:end&quot;);
]]></script>
</div></div><h4 id="BookInOnePage-PartialPayloadContentwithNamespacesupport">Partial Payload Content with Namespace support</h4><h5 id="BookInOnePage-JavaDSL">Java DSL</h5><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[final Map&lt;String, String&gt; namespaces = new HashMap&lt;String, String&gt;();
namespaces.put(&quot;cust&quot;, &quot;http://cheese.xmlsecurity.camel.apache.org/&quot;);

final KeyStoreParameters tsParameters = new KeyStoreParameters();
tsParameters.setPassword(&quot;password&quot;);
tsParameters.setResource(&quot;sender.ts&quot;);

context.addRoutes(new RouteBuilder() {
    public void configure() {
        from(&quot;direct:start&quot;)
           .marshal().secureXML(&quot;//cust:cheesesites/italy&quot;, namespaces, true, &quot;recipient&quot;,
                                testCypherAlgorithm, XMLCipher.RSA_v1dot5, tsParameters)
           .to(&quot;mock:encrypted&quot;);
    }
}
]]></script>
</div></div><h5 id="BookInOnePage-SpringXML">Spring XML</h5><p>A namespace prefix that is defined as part of the <code>camelContext</code> definition can be re-used in context within the data format <code>secureTag</code> attribute of the <code>secureXML</code> element.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;camelContext id=&quot;springXmlSecurityDataFormatTestCamelContext&quot; 
              xmlns=&quot;http://camel.apache.org/schema/spring&quot;
              xmlns:cheese=&quot;http://cheese.xmlsecurity.camel.apache.org/&quot;&gt;        
    &lt;route&gt;
        &lt;from uri=&quot;direct://start&quot;/&gt;
            &lt;marshal&gt;
                &lt;secureXML secureTag=&quot;//cheese:cheesesites/italy&quot;
                           secureTagContents=&quot;true&quot;/&gt;
            &lt;/marshal&gt; 
            ...
]]></script>
</div></div><h4 id="BookInOnePage-AsymmetricKeyEncryption">Asymmetric Key Encryption</h4><h5 id="BookInOnePage-SpringXMLSender">Spring XML Sender</h5><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;!--  trust store configuration --&gt;                          
&lt;camel:keyStoreParameters id=&quot;trustStoreParams&quot; resource=&quot;./sender.ts&quot; password=&quot;password&quot;/&gt;

&lt;camelContext id=&quot;springXmlSecurityDataFormatTestCamelContext&quot; 
              xmlns=&quot;http://camel.apache.org/schema/spring&quot;
              xmlns:cheese=&quot;http://cheese.xmlsecurity.camel.apache.org/&quot;&gt;        
    &lt;route&gt;
        &lt;from uri=&quot;direct://start&quot;/&gt;
            &lt;marshal&gt;
                &lt;secureXML secureTag=&quot;//cheese:cheesesites/italy&quot;
                           secureTagContents=&quot;true&quot;
                           xmlCipherAlgorithm=&quot;http://www.w3.org/2001/04/xmlenc#aes128-cbc&quot;       
                           keyCipherAlgorithm=&quot;http://www.w3.org/2001/04/xmlenc#rsa-1_5&quot;
                           recipientKeyAlias=&quot;recipient&quot;
                           keyOrTrustStoreParametersId=&quot;trustStoreParams&quot;/&gt;
            &lt;/marshal&gt; 
            ...
]]></script>
</div></div><h5 id="BookInOnePage-SpringXMLRecipient">Spring XML Recipient</h5><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[ 
&lt;!--  key store configuration --&gt;
&lt;camel:keyStoreParameters id=&quot;keyStoreParams&quot; resource=&quot;./recipient.ks&quot; password=&quot;password&quot; /&gt;

&lt;camelContext id=&quot;springXmlSecurityDataFormatTestCamelContext&quot; 
              xmlns=&quot;http://camel.apache.org/schema/spring&quot;
              xmlns:cheese=&quot;http://cheese.xmlsecurity.camel.apache.org/&quot;&gt;
    &lt;route&gt;    
        &lt;from uri=&quot;direct://encrypted&quot;/&gt;
            &lt;unmarshal&gt;
                &lt;secureXML secureTag=&quot;//cheese:cheesesites/italy&quot;
                           secureTagContents=&quot;true&quot;
                           xmlCipherAlgorithm=&quot;http://www.w3.org/2001/04/xmlenc#aes128-cbc&quot;
                           keyCipherAlgorithm=&quot;http://www.w3.org/2001/04/xmlenc#rsa-1_5&quot;
                           recipientKeyAlias=&quot;recipient&quot;
                           keyOrTrustStoreParametersId=&quot;keyStoreParams&quot;
                           keyPassword=&quot;privateKeyPassword&quot; /&gt;
            &lt;/unmarshal&gt;
            ...
]]></script>
</div></div><h3 id="BookInOnePage-Dependencies.28">Dependencies</h3><p>This data format is provided within the <strong>camel-xmlsecurity</strong> component.</p>
The GZip <a shape="rect" href="data-format.html">Data Format</a> is a message compression and de-compression format. It uses the same deflate algorithm that is used in <a shape="rect" href="zip-dataformat.html">Zip DataFormat</a>, although some additional headers are provided. This format is produced by popular <code>gzip</code>/<code>gunzip</code> tool. Messages marshalled using GZip compression can be unmarshalled using GZip decompression just prior to being consumed at the endpoint. The compression capability is quite useful when you deal with large XML and Text based payloads or when you read messages previously comressed using <code>gzip</code> tool.

<h3 id="BookInOnePage-Options.6">Options</h3>

<p>There are no options provided for this data format.</p>

<h3 id="BookInOnePage-Marshal.3">Marshal</h3>

<p>In this example we marshal a regular text/XML payload to a compressed payload employing gzip compression format and send it an ActiveMQ queue called MY_QUEUE.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;direct:start&quot;).marshal().gzip().to(&quot;activemq:queue:MY_QUEUE&quot;);
]]></script>
</div></div>

<h3 id="BookInOnePage-Unmarshal.3">Unmarshal</h3>

<p>In this example we unmarshal&#160;a gzipped&#160;payload from an ActiveMQ queue called MY_QUEUE&#160;to its original format,&#160;and forward it for&#160;processing&#160;to the <code>UnGZippedMessageProcessor</code>. </p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;activemq:queue:MY_QUEUE&quot;).unmarshal().gzip().process(new UnGZippedMessageProcessor()); 
]]></script>
</div></div>

<h3 id="BookInOnePage-Dependencies.29">Dependencies</h3>

<p>This data format is provided in <strong>camel-core</strong> so no additional dependencies is needed.</p>
<h2 id="BookInOnePage-Castor">Castor</h2>
<p><strong>Available as of Camel 2.1</strong></p>

<p>Castor is a <a shape="rect" href="data-format.html">Data Format</a> which uses the <a shape="rect" class="external-link" href="http://www.castor.org/" rel="nofollow">Castor XML library</a> to unmarshal an XML payload into Java objects or to marshal Java objects into an XML payload.</p>

<p>As usually you can use either Java DSL or Spring XML to work with Castor Data Format. </p>

<h3 id="BookInOnePage-UsingtheJavaDSL.3">Using the Java DSL</h3>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;direct:order&quot;).
  marshal().castor().
  to(&quot;activemq:queue:order&quot;);
]]></script>
</div></div>

<p>For example the following uses a named DataFormat of Castor which uses default Castor data binding features.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
CastorDataFormat castor = new CastorDataFormat ();

from(&quot;activemq:My.Queue&quot;).
  unmarshal(castor).
  to(&quot;mqseries:Another.Queue&quot;);
]]></script>
</div></div>



<p>If you prefer to use a named reference to a data format which can then be defined in your Registry such as via your Spring XML file. e.g.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
from(&quot;activemq:My.Queue&quot;).
  unmarshal(&quot;mycastorType&quot;).
  to(&quot;mqseries:Another.Queue&quot;);
]]></script>
</div></div>



<p>If you want to override default mapping schema by providing a mapping file you can set it as follows.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
CastorDataFormat castor = new CastorDataFormat ();
castor.setMappingFile(&quot;mapping.xml&quot;);
]]></script>
</div></div>


<p>Also if you want to have more control on Castor Marshaller and Unmarshaller you can access them as below.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
castor.getMarshaller();
castor.getUnmarshaller();
]]></script>
</div></div>



<h3 id="BookInOnePage-UsingSpringXML.3">Using Spring XML</h3>
<p>The following example shows how to use Castor to unmarshal using Spring configuring the castor data type</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;camelContext id=&quot;camel&quot; xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;
  &lt;route&gt;
    &lt;from uri=&quot;direct:start&quot;/&gt;
    &lt;unmarshal&gt;
      &lt;castor validation=&quot;true&quot; /&gt;
    &lt;/unmarshal&gt;
    &lt;to uri=&quot;mock:result&quot;/&gt;
  &lt;/route&gt;
&lt;/camelContext&gt;
]]></script>
</div></div>

<p>This example shows how to configure the data type just once and reuse it on multiple routes. You have to set the &lt;castor&gt; element directly in &lt;camelContext&gt;.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;camelContext&gt;
&lt;camelContext id=&quot;camel&quot; xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;
  &lt;dataFormats&gt;
    &lt;castor id=&quot;myCastor&quot;/&gt;
  &lt;/dataFormats&gt;

  &lt;route&gt;
    &lt;from uri=&quot;direct:start&quot;/&gt;
    &lt;marshal ref=&quot;myCastor&quot;/&gt;
    &lt;to uri=&quot;direct:marshalled&quot;/&gt;
  &lt;/route&gt;
  &lt;route&gt;
    &lt;from uri=&quot;direct:marshalled&quot;/&gt;
    &lt;unmarshal ref=&quot;myCastor&quot;/&gt;
    &lt;to uri=&quot;mock:result&quot;/&gt;
  &lt;/route&gt;

&lt;/camelContext&gt;
]]></script>
</div></div>


<h3 id="BookInOnePage-Options.7">Options</h3>
<p>Castor supports the following options</p>

<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Option </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Type </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> encoding </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> String </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> UTF-8 </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Encoding to use when marshalling an Object to XML </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> validation </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Boolean </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> false </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Whether validation is turned on or off. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> mappingFile </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> String </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> null </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Path to a Castor mapping file to load from the classpath. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> packages </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> String[] </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> null </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Add additional packages to Castor XmlContext </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> classNames </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> String[] </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> null </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Add additional class names to Castor XmlContext </p></td></tr></tbody></table></div>


<h3 id="BookInOnePage-Dependencies.30">Dependencies</h3>

<p>To use Castor in your camel routes you need to add the a dependency on <strong>camel-castor</strong> which implements this data format. </p>

<p>If you use maven you could just add the following to your pom.xml, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-castor&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div>
<h1 id="BookInOnePage-Protobuf-ProtocolBuffers">Protobuf - Protocol Buffers</h1>

<p>"Protocol Buffers - Google's data interchange format"</p>

<div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Available from Camel 2.2</p></div></div>

<p>Camel provides a <a shape="rect" href="data-format.html">Data Format</a> to serialse between Java and the Protocol Buffer protocol.  The project's site details why you may wish to <a shape="rect" class="external-link" href="http://code.google.com/apis/protocolbuffers/docs/overview.html" rel="nofollow">choose this format over xml</a>.  Protocol Buffer is language-neutral and platform-neutral, so messages produced by your Camel routes may be consumed by other language implementations.</p>

<p><a shape="rect" class="external-link" href="http://code.google.com/apis/protocolbuffers/" rel="nofollow">API Site</a><br clear="none">
<a shape="rect" class="external-link" href="http://code.google.com/p/protobuf/" rel="nofollow">Protobuf Implementation</a><br clear="none">
<a shape="rect" class="external-link" href="http://code.google.com/apis/protocolbuffers/docs/javatutorial.html" rel="nofollow">Protobuf Java Tutorial</a></p>

<h2 id="BookInOnePage-Protobufoverview">Protobuf overview</h2>

<p>This quick overview of how to use Protobuf. For more detail see the <a shape="rect" class="external-link" href="http://code.google.com/apis/protocolbuffers/docs/javatutorial.html" rel="nofollow">complete tutorial</a></p>

<h3 id="BookInOnePage-Definingtheprotoformat">Defining the proto format</h3>

<p>The first step is to define the format for the body of your exchange.  This is defined in a .proto file as so:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>addressbook.proto</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[

package org.apache.camel.component.protobuf;

option java_package = &quot;org.apache.camel.component.protobuf&quot;;
option java_outer_classname = &quot;AddressBookProtos&quot;;

message Person {
  required string name = 1;
  required int32 id = 2;
  optional string email = 3;

  enum PhoneType {
    MOBILE = 0;
    HOME = 1;
    WORK = 2;
  }

  message PhoneNumber {
    required string number = 1;
    optional PhoneType type = 2 [default = HOME];
  }

  repeated PhoneNumber phone = 4;
}

message AddressBook {
  repeated Person person = 1;
}

]]></script>
</div></div>

<h3 id="BookInOnePage-GeneratingJavaclasses">Generating Java classes</h3>

<p>The Protobuf SDK provides a compiler which will generate the Java classes for the format we defined in our .proto file.  You can run the compiler for any additional supported languages you require.</p>

<p><code>protoc --java_out=. ./addressbook.proto</code></p>

<p>This will generate a single Java class named AddressBookProtos which contains inner classes for Person and AddressBook.  Builders are also implemented for you.  The generated classes implement com.google.protobuf.Message which is required by the serialisation mechanism.  For this reason it important that only these classes are used in the body of your exchanges.  Camel will throw an exception on route creation if you attempt to tell the <a shape="rect" href="data-format.html">Data Format</a> to use a class that does not implement com.google.protobuf.Message.  Use the generated builders to translate the data from any of your existing domain classes.</p>

<h2 id="BookInOnePage-JavaDSL.1">Java DSL</h2>

<p>You can use create the ProtobufDataFormat instance and pass it to Camel DataFormat marshal and unmarsha API like this.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
   ProtobufDataFormat format = new ProtobufDataFormat(Person.getDefaultInstance());

   from(&quot;direct:in&quot;).marshal(format);
   from(&quot;direct:back&quot;).unmarshal(format).to(&quot;mock:reverse&quot;);
]]></script>
</div></div>

<p>Or use the DSL protobuf() passing the unmarshal default instance or default instance class name like this.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
   // You don&#39;t need to specify the default instance for protobuf marshaling               
   from(&quot;direct:marshal&quot;).marshal().protobuf();
   from(&quot;direct:unmarshalA&quot;).unmarshal().
       protobuf(&quot;org.apache.camel.dataformat.protobuf.generated.AddressBookProtos$Person&quot;).
       to (&quot;mock:reverse&quot;);
                
   from(&quot;direct:unmarshalB&quot;).unmarshal().protobuf(Person.getDefaultInstance()).to(&quot;mock:reverse&quot;);
]]></script>
</div></div>


<h2 id="BookInOnePage-SpringDSL">Spring DSL</h2>

<p>The following example shows how to use Castor to unmarshal using Spring configuring the protobuf data type</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;camelContext id=&quot;camel&quot; xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;
  &lt;route&gt;
    &lt;from uri=&quot;direct:start&quot;/&gt;
    &lt;unmarshal&gt;
      &lt;protobuf instanceClass=&quot;org.apache.camel.dataformat.protobuf.generated.AddressBookProtos$Person&quot; /&gt;
    &lt;/unmarshal&gt;
    &lt;to uri=&quot;mock:result&quot;/&gt;
  &lt;/route&gt;
&lt;/camelContext&gt;
]]></script>
</div></div>

<h3 id="BookInOnePage-Dependencies.31">Dependencies</h3>

<p>To use Protobuf in your camel routes you need to add the a dependency on <strong>camel-protobuf</strong> which implements this data format. </p>

<p>If you use maven you could just add the following to your pom.xml, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-protobuf&lt;/artifactId&gt;
  &lt;version&gt;2.2.0&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div>
<h2 id="BookInOnePage-SOAPDataFormat">SOAP DataFormat</h2>
<p><strong>Available as of Camel 2.3</strong></p>

<p>SOAP is a <a shape="rect" href="data-format.html">Data Format</a> which uses JAXB2 and JAX-WS annotations to marshal and unmarshal SOAP payloads. It provides the basic features of Apache CXF without need for the CXF Stack.</p>

<div class="confluence-information-macro confluence-information-macro-information"><p class="title">Supported SOAP versions</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>SOAP 1.1 is supported by default. SOAP 1.2 is supported from Camel 2.11 onwards.</p></div></div>

<div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Namespace prefix mapping</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>See <a shape="rect" href="jaxb.html">JAXB</a> for details how you can control namespace prefix mappings when marshalling using <a shape="rect" href="soap.html">SOAP</a> data format.</p></div></div>

<h3 id="BookInOnePage-ElementNameStrategy">ElementNameStrategy</h3>

<p>An element name strategy is used for two purposes. The first is to find a xml element name for a given object and soap action when marshaling the object into a SOAP message. The second is to find an Exception class for a given soap fault name.</p>

<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Strategy </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Usage </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> QNameStrategy </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Uses a fixed qName that is configured on instantiation. Exception lookup is not supported </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> TypeNameStrategy </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Uses the name and namespace from the @XMLType annotation of the given type. If no namespace is set then package-info is used. Exception lookup is not supported </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> ServiceInterfaceStrategy </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Uses information from a webservice interface to determine the type name and to find the exception class for a SOAP fault</p></td></tr></tbody></table></div>


<p>If you have generated the web service stub code with cxf-codegen or a similar tool then you probably will want to use the ServiceInterfaceStrategy. In the case you have no annotated service interface you should use QNameStrategy or TypeNameStrategy.</p>

<h3 id="BookInOnePage-UsingtheJavaDSL.4">Using the Java DSL</h3>

<p>The following example uses a named DataFormat of <em>soap</em> which is configured with the package com.example.customerservice to initialize the <a shape="rect" class="external-link" href="http://java.sun.com/javase/6/docs/api/javax/xml/bind/JAXBContext.html" rel="nofollow">JAXBContext</a>. The second parameter is the ElementNameStrategy. The route is able to marshal normal objects as well as exceptions.  (Note the below just sends a SOAP Envelope to a queue. A web service provider would actually need to be listening to the queue for a SOAP call to actually occur, in which case it would be a one way SOAP request. If you need request reply then you should look at the next example.)</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
SoapJaxbDataFormat soap = new SoapJaxbDataFormat(&quot;com.example.customerservice&quot;, new ServiceInterfaceStrategy(CustomerService.class));
from(&quot;direct:start&quot;)
  .marshal(soap)
  .to(&quot;jms:myQueue&quot;);
]]></script>
</div></div>

<div class="confluence-information-macro confluence-information-macro-tip"><p class="title">See also</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>As the SOAP dataformat inherits from the <a shape="rect" href="jaxb.html">JAXB</a> dataformat most settings apply here as well</p></div></div>

<h4 id="BookInOnePage-UsingSOAP1.2">Using SOAP 1.2</h4>
<p><strong>Available as of Camel 2.11</strong></p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
SoapJaxbDataFormat soap = new SoapJaxbDataFormat(&quot;com.example.customerservice&quot;, new ServiceInterfaceStrategy(CustomerService.class));
soap.setVersion(&quot;1.2&quot;);
from(&quot;direct:start&quot;)
  .marshal(soap)
  .to(&quot;jms:myQueue&quot;);
]]></script>
</div></div>

<p>When using XML DSL there is a version attribute you can set on the &lt;soapjaxb&gt; element.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    &lt;!-- Defining a ServiceInterfaceStrategy for retrieving the element name when marshalling --&gt;
    &lt;bean id=&quot;myNameStrategy&quot; class=&quot;org.apache.camel.dataformat.soap.name.ServiceInterfaceStrategy&quot;&gt;
    	&lt;constructor-arg value=&quot;com.example.customerservice.CustomerService&quot;/&gt;
	&lt;constructor-arg value=&quot;true&quot;/&gt;
    &lt;/bean&gt;
]]></script>
</div></div>

<p>And in the Camel route</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;route&gt;
  &lt;from uri=&quot;direct:start&quot;/&gt;
  &lt;marshal&gt;
    &lt;soapjaxb contentPath=&quot;com.example.customerservice&quot; version=&quot;1.2&quot; elementNameStrategyRef=&quot;myNameStrategy&quot;/&gt;
  &lt;/marshal&gt;
  &lt;to uri=&quot;jms:myQueue&quot;/&gt;
&lt;/route&gt;
]]></script>
</div></div>


<h3 id="BookInOnePage-Multi-partMessages">Multi-part Messages</h3>
<p><strong>Available as of Camel 2.8.1</strong> </p>

<p>Multi-part SOAP messages are supported by the ServiceInterfaceStrategy. The ServiceInterfaceStrategy must be initialized with a service interface definition that is annotated in accordance with JAX-WS 2.2 and meets the requirements of the Document Bare style. The target method must meet the following criteria, as per the JAX-WS specification:  1) it must have at most one <code>in</code> or <code>in/out</code> non-header parameter, 2) if it has a return type other than <code>void</code> it must have no <code>in/out</code> or <code>out</code> non-header parameters, 3) if it it has a return type of <code>void</code> it must have at most one <code>in/out</code> or <code>out</code> non-header parameter.</p>

<p>The ServiceInterfaceStrategy should be initialized with a boolean parameter that indicates whether the mapping strategy applies to the request parameters or response parameters.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
ServiceInterfaceStrategy strat =  new ServiceInterfaceStrategy(com.example.customerservice.multipart.MultiPartCustomerService.class, true);
SoapJaxbDataFormat soapDataFormat = new SoapJaxbDataFormat(&quot;com.example.customerservice.multipart&quot;, strat);
]]></script>
</div></div>

<h4 id="BookInOnePage-Multi-partRequest">Multi-part Request</h4>

<p>The payload parameters for a multi-part request are initiazlied using a <code>BeanInvocation</code> object that reflects the signature of the target operation. The camel-soap DataFormat maps the content in the <code>BeanInvocation</code> to fields in the SOAP header and body in accordance with the JAX-WS mapping when the <code>marshal()</code> processor is invoked. </p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
BeanInvocation beanInvocation = new BeanInvocation();

// Identify the target method
beanInvocation.setMethod(MultiPartCustomerService.class.getMethod(&quot;getCustomersByName&quot;, 
    GetCustomersByName.class, com.example.customerservice.multipart.Product.class));

// Populate the method arguments
GetCustomersByName getCustomersByName = new GetCustomersByName();
getCustomersByName.setName(&quot;Dr. Multipart&quot;);
                
Product product = new Product();
product.setName(&quot;Multiuse Product&quot;);
product.setDescription(&quot;Useful for lots of things.&quot;);
                
Object[] args = new Object[] {getCustomersByName, product};

// Add the arguments to the bean invocation
beanInvocation.setArgs(args);

// Set the bean invocation object as the message body
exchange.getIn().setBody(beanInvocation); 
]]></script>
</div></div>

<h4 id="BookInOnePage-Multi-partResponse">Multi-part Response</h4>

<p>A multi-part soap response may include an element in the soap body and will have one or more elements in the soap header.  The camel-soap DataFormat will unmarshall the element in the soap body (if it exists) and place it onto the body of the out message in the exchange.  Header elements will <strong>not</strong> be marshaled into their JAXB mapped object types.  Instead, these elements are placed into the camel out message header <code>org.apache.camel.dataformat.soap.UNMARSHALLED_HEADER_LIST</code>. The elements will appear either as element instance values, or as JAXBElement values, depending upon the setting for the <code>ignoreJAXBElement</code> property. This property is inherited from camel-jaxb.</p>

<p>You can also have the camel-soap DataFormate ignore header content all-together by setting the <code>ignoreUnmarshalledHeaders</code> value to <code>true</code>. </p>

<h4 id="BookInOnePage-HolderObjectmapping">Holder Object mapping</h4>

<p>JAX-WS specifies the use of a type-parameterized <code>javax.xml.ws.Holder</code> object for <code>In/Out</code> and <code>Out</code> parameters.  A <code>Holder</code> object may be used when building the <code>BeanInvocation</code>, or you may use an instance of the parameterized-type directly.  The camel-soap DataFormat marshals Holder values in accordance with the JAXB mapping for the class of the <code>Holder</code>'s value.  No mapping is provided for <code>Holder</code> objects in an unmarshalled response.</p>

<h3 id="BookInOnePage-Examples.7">Examples</h3>

<h4 id="BookInOnePage-Webserviceclient">Webservice client</h4>

<p>The following route supports marshalling the request and unmarshalling a response or fault. </p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
String WS_URI = &quot;cxf://http://myserver/customerservice?serviceClass=com.example.customerservice&amp;dataFormat=MESSAGE&quot;;
SoapJaxbDataFormat soapDF = new SoapJaxbDataFormat(&quot;com.example.customerservice&quot;, new ServiceInterfaceStrategy(CustomerService.class));
from(&quot;direct:customerServiceClient&quot;)
  .onException(Exception.class)
    .handled(true)
    .unmarshal(soapDF)
  .end()
  .marshal(soapDF)
  .to(WS_URI)
  .unmarshal(soapDF);
]]></script>
</div></div>

<p>The below snippet creates a proxy for the service interface and makes a SOAP call to the above route. </p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
import org.apache.camel.Endpoint;
import org.apache.camel.component.bean.ProxyHelper;
...

Endpoint startEndpoint = context.getEndpoint(&quot;direct:customerServiceClient&quot;);
ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
// CustomerService below is the service endpoint interface, *not* the javax.xml.ws.Service subclass
CustomerService proxy = ProxyHelper.createProxy(startEndpoint, classLoader, CustomerService.class);
GetCustomersByNameResponse response = proxy.getCustomersByName(new GetCustomersByName());
]]></script>
</div></div>

<h4 id="BookInOnePage-WebserviceServer">Webservice Server</h4>

<p>Using the following route sets up a webservice server that listens on jms queue customerServiceQueue and processes requests using the class CustomerServiceImpl. The customerServiceImpl of course should implement the interface CustomerService. Instead of directly instantiating the server class it could be defined in a spring context as a regular bean.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
SoapJaxbDataFormat soapDF = new SoapJaxbDataFormat(&quot;com.example.customerservice&quot;, new ServiceInterfaceStrategy(CustomerService.class));
CustomerService serverBean = new CustomerServiceImpl();
from(&quot;jms://queue:customerServiceQueue&quot;)
  .onException(Exception.class)
    .handled(true)
    .marshal(soapDF)
  .end()
  .unmarshal(soapDF)
  .bean(serverBean)
  .marshal(soapDF);
]]></script>
</div></div>

<h3 id="BookInOnePage-Dependencies.32">Dependencies</h3>

<p>To use the SOAP dataformat in your camel routes you need to add the following dependency to your pom.</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-soap&lt;/artifactId&gt;
  &lt;version&gt;2.3.0&lt;/version&gt;
&lt;/dependency&gt;
]]></script>
</div></div>
<h2 id="BookInOnePage-Crypto">Crypto</h2><p><strong>Available as of Camel 2.3</strong><br clear="none"> <strong>PGP Available as of Camel 2.9</strong></p><p>The Crypto <a shape="rect" href="data-format.html">Data Format</a> integrates the Java Cryptographic Extension into Camel, allowing simple and flexible encryption and decryption of messages using Camel's familiar marshall and unmarshal formatting mechanism. It assumes marshalling to mean encryption to cyphertext and unmarshalling to mean decryption back to the original plaintext. This data format implements only symmetric (shared-key) encryption and decyption.</p><h3 id="BookInOnePage-Options.8">Options</h3><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>algorithm</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>DES/CBC/PKCS5Padding</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The JCE algorithm name indicating the cryptographic algorithm that will be used.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>algorithmParameterSpec</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>java.security.spec.AlgorithmParameterSpec</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A JCE AlgorithmParameterSpec used to initialize the Cipher.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bufferSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Integer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>4096</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the size of the buffer used in the signature process.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cryptoProvider</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The name of the JCE Security Provider that should be used.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>initializationVector</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>byte[]</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A byte array containing the Initialization Vector that will be used to initialize the Cipher.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>inline</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Flag indicating that the configured IV should be inlined into the encrypted data stream.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>macAlgorithm</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The JCE algorithm name indicating the Message Authentication algorithm.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>shouldAppendHMAC</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Flag indicating that a Message Authentication Code should be calculated and appended to the encrypted data.</p></td></tr></tbody></table></div><h3 id="BookInOnePage-BasicUsage">Basic Usage</h3><p>At its most basic all that is required to encrypt/decrypt an exchange is a shared secret key. If one or more instances of the Crypto data format are configured with this key the format can be used to encrypt the payload in one route (or part of one) and decrypted in another. For example, using the Java DSL as follows:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
KeyGenerator generator = KeyGenerator.getInstance(&quot;DES&quot;);

CryptoDataFormat cryptoFormat = new CryptoDataFormat(&quot;DES&quot;, generator.generateKey());

from(&quot;direct:basic-encryption&quot;)
    .marshal(cryptoFormat)
    .to(&quot;mock:encrypted&quot;)
    .unmarshal(cryptoFormat)
    .to(&quot;mock:unencrypted&quot;);
]]></script>
</div></div>In Spring the dataformat is configured first and then used in routes<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;camelContext id=&quot;camel&quot; xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;
  &lt;dataFormats&gt;
    &lt;crypto id=&quot;basic&quot; algorithm=&quot;DES&quot; keyRef=&quot;desKey&quot; /&gt;
  &lt;/dataFormats&gt;
    ...
  &lt;route&gt;
    &lt;from uri=&quot;direct:basic-encryption&quot; /&gt;
    &lt;marshal ref=&quot;basic&quot; /&gt;
    &lt;to uri=&quot;mock:encrypted&quot; /&gt;
    &lt;unmarshal ref=&quot;basic&quot; /&gt;
    &lt;to uri=&quot;mock:unencrypted&quot; /&gt;
  &lt;/route&gt;
&lt;/camelContext&gt;
]]></script>
</div></div><h3 id="BookInOnePage-SpecifyingtheEncryptionAlgorithm">Specifying the Encryption Algorithm</h3><p>Changing the algorithm is a matter of supplying the JCE algorithm name. If you change the algorithm you will need to use a compatible key.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
KeyGenerator generator = KeyGenerator.getInstance(&quot;DES&quot;);

CryptoDataFormat cryptoFormat = new CryptoDataFormat(&quot;DES&quot;, generator.generateKey());
cryptoFormat.setShouldAppendHMAC(true);
cryptoFormat.setMacAlgorithm(&quot;HmacMD5&quot;);

from(&quot;direct:hmac-algorithm&quot;)
    .marshal(cryptoFormat)
    .to(&quot;mock:encrypted&quot;)
    .unmarshal(cryptoFormat)
    .to(&quot;mock:unencrypted&quot;);
]]></script>
</div></div>A list of the available algorithms in Java 7 is available via the <a shape="rect" class="external-link" href="http://docs.oracle.com/javase/7/docs/technotes/guides/security/StandardNames.html" rel="nofollow">Java Cryptography Architecture Standard Algorithm Name Documentation</a>.<h3 id="BookInOnePage-SpecifyinganInitializationVector">Specifying an Initialization Vector</h3><p>Some crypto algorithms, particularly block algorithms, require configuration with an initial block of data known as an Initialization Vector. In the JCE this is passed as an AlgorithmParameterSpec when the Cipher is initialized. To use such a vector with the CryptoDataFormat you can configure it with a byte[] containing the required data e.g.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
KeyGenerator generator = KeyGenerator.getInstance(&quot;DES&quot;);
byte[] initializationVector = new byte[] {0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07};

CryptoDataFormat cryptoFormat = new CryptoDataFormat(&quot;DES/CBC/PKCS5Padding&quot;, generator.generateKey());
cryptoFormat.setInitializationVector(initializationVector);

from(&quot;direct:init-vector&quot;)
    .marshal(cryptoFormat)
    .to(&quot;mock:encrypted&quot;)
    .unmarshal(cryptoFormat)
    .to(&quot;mock:unencrypted&quot;);
]]></script>
</div></div>or with spring, suppling a reference to a byte[]<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;crypto id=&quot;initvector&quot; algorithm=&quot;DES/CBC/PKCS5Padding&quot; keyRef=&quot;desKey&quot; initVectorRef=&quot;initializationVector&quot; /&gt;
]]></script>
</div></div>The same vector is required in both the encryption and decryption phases. As it is not necessary to keep the IV a secret, the DataFormat allows for it to be inlined into the encrypted data and subsequently read out in the decryption phase to initialize the Cipher. To inline the IV set the /oinline flag.<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
KeyGenerator generator = KeyGenerator.getInstance(&quot;DES&quot;);
byte[] initializationVector = new byte[] {0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07};
SecretKey key = generator.generateKey();

CryptoDataFormat cryptoFormat = new CryptoDataFormat(&quot;DES/CBC/PKCS5Padding&quot;, key);
cryptoFormat.setInitializationVector(initializationVector);
cryptoFormat.setShouldInlineInitializationVector(true);
CryptoDataFormat decryptFormat = new CryptoDataFormat(&quot;DES/CBC/PKCS5Padding&quot;, key);
decryptFormat.setShouldInlineInitializationVector(true);

from(&quot;direct:inline&quot;)
    .marshal(cryptoFormat)
    .to(&quot;mock:encrypted&quot;)
    .unmarshal(decryptFormat)
    .to(&quot;mock:unencrypted&quot;);
]]></script>
</div></div>or with spring.<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;crypto id=&quot;inline&quot; algorithm=&quot;DES/CBC/PKCS5Padding&quot; keyRef=&quot;desKey&quot; initVectorRef=&quot;initializationVector&quot;
  inline=&quot;true&quot; /&gt;
&lt;crypto id=&quot;inline-decrypt&quot; algorithm=&quot;DES/CBC/PKCS5Padding&quot; keyRef=&quot;desKey&quot; inline=&quot;true&quot; /&gt;
]]></script>
</div></div>For more information of the use of Initialization Vectors, consult<ul><li><a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/Initialization_vector" rel="nofollow">http://en.wikipedia.org/wiki/Initialization_vector</a></li><li><a shape="rect" class="external-link" href="http://www.herongyang.com/Cryptography/" rel="nofollow">http://www.herongyang.com/Cryptography/</a></li><li><a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation" rel="nofollow">http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation</a></li></ul><h3 id="BookInOnePage-HashedMessageAuthenticationCodes(HMAC)">Hashed Message Authentication Codes (HMAC)</h3><p>To avoid attacks against the encrypted data while it is in transit the CryptoDataFormat can also calculate a Message Authentication Code for the encrypted exchange contents based on a configurable MAC algorithm. The calculated HMAC is appended to the stream after encryption. It is separated from the stream in the decryption phase. The MAC is recalculated and verified against the transmitted version to insure nothing was tampered with in transit.For more information on Message Authentication Codes see <a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/HMAC" rel="nofollow">http://en.wikipedia.org/wiki/HMAC</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
KeyGenerator generator = KeyGenerator.getInstance(&quot;DES&quot;);

CryptoDataFormat cryptoFormat = new CryptoDataFormat(&quot;DES&quot;, generator.generateKey());
cryptoFormat.setShouldAppendHMAC(true);

from(&quot;direct:hmac&quot;)
    .marshal(cryptoFormat)
    .to(&quot;mock:encrypted&quot;)
    .unmarshal(cryptoFormat)
    .to(&quot;mock:unencrypted&quot;);
]]></script>
</div></div>or with spring.<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;crypto id=&quot;hmac&quot; algorithm=&quot;DES&quot; keyRef=&quot;desKey&quot; shouldAppendHMAC=&quot;true&quot; /&gt;
]]></script>
</div></div>By default the HMAC is calculated using the HmacSHA1 mac algorithm though this can be easily changed by supplying a different algorithm name. See <a shape="rect" class="unresolved" href="#">here</a> for how to check what algorithms are available through the configured security providers<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
KeyGenerator generator = KeyGenerator.getInstance(&quot;DES&quot;);

CryptoDataFormat cryptoFormat = new CryptoDataFormat(&quot;DES&quot;, generator.generateKey());
cryptoFormat.setShouldAppendHMAC(true);
cryptoFormat.setMacAlgorithm(&quot;HmacMD5&quot;);

from(&quot;direct:hmac-algorithm&quot;)
    .marshal(cryptoFormat)
    .to(&quot;mock:encrypted&quot;)
    .unmarshal(cryptoFormat)
    .to(&quot;mock:unencrypted&quot;);
]]></script>
</div></div>or with spring.<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;crypto id=&quot;hmac-algorithm&quot; algorithm=&quot;DES&quot; keyRef=&quot;desKey&quot; macAlgorithm=&quot;HmacMD5&quot; shouldAppendHMAC=&quot;true&quot; /&gt;
]]></script>
</div></div><h3 id="BookInOnePage-SupplyingKeysDynamically">Supplying Keys Dynamically</h3><p>When using a Recipient list or similar EIP the recipient of an exchange can vary dynamically. Using the same key across all recipients may neither be feasible or desirable. It would be useful to be able to specify keys dynamically on a per exchange basis. The exchange could then be dynamically enriched with the key of its target recipient before being processed by the data format. To facilitate this the DataFormat allow for keys to be supplied dynamically via the message headers below</p><ul><li><code>CryptoDataFormat.KEY</code> <code>"CamelCryptoKey"</code></li></ul><p></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
CryptoDataFormat cryptoFormat = new CryptoDataFormat(&quot;DES&quot;, null);
/**
 * Note: the header containing the key should be cleared after
 * marshalling to stop it from leaking by accident and
 * potentially being compromised. The processor version below is
 * arguably better as the key is left in the header when you use
 * the DSL leaks the fact that camel encryption was used.
 */
from(&quot;direct:key-in-header-encrypt&quot;)
    .marshal(cryptoFormat)
    .removeHeader(CryptoDataFormat.KEY)
    .to(&quot;mock:encrypted&quot;);

from(&quot;direct:key-in-header-decrypt&quot;).unmarshal(cryptoFormat).process(new Processor() {
    public void process(Exchange exchange) throws Exception {
        exchange.getIn().getHeaders().remove(CryptoDataFormat.KEY);
        exchange.getOut().copyFrom(exchange.getIn());
    }
}).to(&quot;mock:unencrypted&quot;);
]]></script>
</div></div>or with spring.<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;crypto id=&quot;nokey&quot; algorithm=&quot;DES&quot; /&gt;
]]></script>
</div></div><h3 id="BookInOnePage-PGPMessage">PGP Message</h3><p>The PGP Data Formater can create and decrypt/verify PGP Messages of the following PGP packet structure (entries in brackets are optional and ellipses indicate repetition, comma represents &#160;sequential composition, and vertical bar separates alternatives):</p><p>&#160; &#160; Public Key Encrypted Session Key ..., Symmetrically Encrypted Data | Sym. Encrypted and Integrity Protected Data, (Compressed Data,) (One Pass Signature ...,)&#160;Literal Data, (Signature ...,)</p><p><strong>Since Camel 2.16</strong>.<strong>0</strong> the Compressed Data packet is optional, before it was mandatory.</p><p>&#160;</p><h3 id="BookInOnePage-PGPDataFormatOptions">PGPDataFormat Options</h3><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>keyUserid</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The user ID of the key in the PGP keyring used during encryption. See also option <code>keyUserids</code>. Can also be only a part of a user ID. For example, if the user ID is "Test User &lt;test@camel.com&gt;" then you can use the part "Test User" or "&lt;test@camel.com&gt;" to address the user ID.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>keyUserids</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>List&lt;String&gt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since camel 2.12.2</strong>: PGP allows to encrypt the symmetric key by several asymmetric public receiver keys. You can specify here the User IDs or parts of User IDs of several public keys contained in the PGP keyring. If you just have one User ID, then you can also use the option <code>keyUserid</code>. The User ID specified in <code>keyUserid</code> and the User IDs in <code>keyUserids</code> will be merged together and the corresponding public keys will be used for the encryption.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>password</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Password used when opening the private key (not used for encryption).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>keyFileName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Filename of the keyring; must be accessible as a classpath resource (but you can specify a location in the file system by using the "file:" prefix).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>encryptionKeyRing</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>byte[]</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since camel 2.12.1</strong>: encryption keyring; you can not set the keyFileName and encryptionKeyRing at the same time.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>signatureKeyUserid</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.11.0</strong>; optional User ID of the key in the PGP keyring used for signing (during encryption) or signature verification (during decryption). During the signature verification process the specified User ID restricts the public keys from the public keyring which can be used for the verification. If no User ID is specified for the signature verficiation then any public key in the public keyring can be used for the verification. Can also be only a part of a user ID. For example, if the user ID is "Test User &lt;test@camel.com&gt;" then you can use the part "Test User" or "&lt;test@camel.com&gt;" to address the User ID.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>signatureKeyUserids</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>List&lt;String&gt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.12.3</strong>: optional list of User IDs of the key in the PGP keyring used for signing (during encryption) or signature verification (during decryption). You can specify here the User IDs or parts of User IDs of several keys contained in the PGP keyring. If you just have one User ID, then you can also use the option <code>keyUserid</code>. The User ID specified in <code>keyUserid</code> and the User IDs in <code>keyUserids</code> will be merged together and the corresponding keys will be used for the signing or signature verification. If the specified User IDs reference several keys then for each key a signature is added to the PGP result during the encryption-signing process. In the decryption-verifying process the list of User IDs restricts the list of public keys which can be used for signature verification. If the list of User IDs is empty then any public key in the public keyring can be used for the signature verification.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>signaturePassword</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.11.0</strong>: optional password used when opening the private key used for signing (during encryption).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>signatureKeyFileName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.11.0</strong>: optional filename of the keyring to use for signing (during encryption) or for signature verification (during decryption); must be accessible as a classpath resource (but you can specify a location in the file system by using the "file:" prefix).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>signatureKeyRing</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>byte[]</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since camel 2.12.1</strong>: signature keyring; you can not set the signatureKeyFileName and signatureKeyRing at the same time.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>algorithm</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>int</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>SymmetricKeyAlgorithmTags.CAST5</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since camel 2.12.2</strong>: symmetric key encryption algorithm; possible values are defined in <code>org.bouncycastle.bcpg.SymmetricKeyAlgorithmTags</code>; for example 2 (= TRIPLE DES), 3 (= CAST5), 4 (= BLOWFISH), 6 (= DES), 7 (= AES_128). Only relevant for encrypting.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>compressionAlgorithm</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>int</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CompressionAlgorithmTags.ZIP</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since camel 2.12.2</strong>: compression algorithm; possible values are defined in <code>org.bouncycastle.bcpg.CompressionAlgorithmTags</code>; for example 0 (= UNCOMPRESSED), 1 (= ZIP), 2 (= ZLIB), 3 (= BZIP2). Only relevant for encrypting.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hashAlgorithm</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>int</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>HashAlgorithmTags.SHA1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since camel 2.12.2</strong>: signature hash algorithm; possible values are defined in <code>org.bouncycastle.bcpg.HashAlgorithmTags</code>; for example 2 (= SHA1), 8 (= SHA256), 9 (= SHA384), 10 (= SHA512), 11 (=SHA224). Only relevant for signing.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>armored</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>This option will cause PGP to base64 encode the encrypted text, making it available for copy/paste, etc.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>integrity</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Adds an integrity check/sign into the encryption file.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>passphraseAccessor</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code><a shape="rect" class="external-link" href="https://github.com/apache/camel/blob/master/components/camel-crypto/src/main/java/org/apache/camel/converter/crypto/PGPPassphraseAccessor.java" rel="nofollow">PGPPassphraseAccessor</a></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.12.2</strong>: provides passphrases corresponding to user Ids. If no passpharase can be found from the option <code>password</code> or <code>signaturePassword</code> and from the headers <code>CamelPGPDataFormatKeyPassword</code> or <code>CamelPGPDataFormatSignatureKeyPassword</code> then the passphrase is fetched from the passphrase accessor. You provide a bean which implements the interface <a shape="rect" class="external-link" href="https://github.com/apache/camel/blob/master/components/camel-crypto/src/main/java/org/apache/camel/converter/crypto/PGPPassphraseAccessor.java" rel="nofollow">PGPPassphraseAccessor</a>. A default implementation is given by <a shape="rect" class="external-link" href="https://github.com/apache/camel/blob/master/components/camel-crypto/src/main/java/org/apache/camel/converter/crypto/DefaultPGPPassphraseAccessor.java" rel="nofollow">DefaultPGPPassphraseAccessor</a>. The passphrase accessor is especially useful in the decrypt case; see chapter 'PGP Decrypting/Verifying of Messages Encrypted/Signed by Different Private/Public Keys' below.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>signatureVerificationOption</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>"optional"</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.13.0</strong>: controls the behavior for verifying the signature during unmarshaling. There are three values possible:</p><ul><li><code>"optional"</code>: The PGP message may or may not contain signatures; if it does contain signatures, then a signature verification is executed. Use the constant PGPKeyAccessDataFormat.SIGNATURE_VERIFICATION_OPTION_OPTIONAL.</li><li><code>"required"</code>: The PGP message must contain at least one signature; if this is not the case an exception (PGPException) is thrown. A signature verification is executed. Use the constant PGPKeyAccessDataFormat.SIGNATURE_VERIFICATION_OPTION_REQUIRED.</li><li><code>"ignore"</code>: Contained signatures in the PGP message are ignored; no signature verification is executed. Use the constant PGPKeyAccessDataFormat.SIGNATURE_VERIFICATION_OPTION_IGNORE.</li><li><code>"no_signature_allowed"</code>: The PGP message must not contain a signature; otherwise an exception (PGPException) is thrown. Use the constant PGPKeyAccessDataFormat.SIGNATURE_VERIFICATION_OPTION_NO_SIGNATURE_ALLOWED.</li></ul></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>FileName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>String</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>"_CONSOLE"</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since camel 2.15.0</strong>: Sets the file name for the literal data packet. Can be overwritten by the&#160; header {@link Exchange#FILE_NAME}.</p><p>"<code>_CONSOLE</code>" indicates that the message is considered to be "for your eyes only". This advises that the message data is unusually sensitive, and the receiving program should process it more carefully, perhaps avoiding storing the received data to disk, for example.Only used for marshaling.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>withCompressedDataPacket</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.16.0</strong>: Indicator whether the PGP Message shall be created with or without a Compressed Data packet. If the value is set to false, then no Compressed Data packet is added and the compressionAlgorithm value is ignored. Only used for marshaling.</p></td></tr></tbody></table></div><h3 id="BookInOnePage-PGPDataFormatMessageHeaders">PGPDataFormat Message Headers</h3><p>You can override the PGPDataFormat options by applying below headers into message dynamically.</p><p>&#160;</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelPGPDataFormatKeyFileName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.11.0</strong>; filename of the keyring; will override existing setting directly on the PGPDataFormat.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelPGPDataFormatEncryptionKeyRing</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>byte[]</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.12.1</strong>; the encryption keyring; will override existing setting directly on the PGPDataFormat.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelPGPDataFormatKeyUserid</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.11.0</strong>; the User ID of the key in the PGP keyring; will override existing setting directly on the PGPDataFormat.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelPGPDataFormatKeyUserids</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>List&lt;String&gt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since camel 2.12.2</strong>: the User IDs of the key in the PGP keyring; will override existing setting directly on the PGPDataFormat.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelPGPDataFormatKeyPassword</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.11.0</strong>; password used when opening the private key; will override existing setting directly on the PGPDataFormat.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelPGPDataFormatSignatureKeyFileName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.11.0</strong>; filename of the signature keyring; will override existing setting directly on the PGPDataFormat.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelPGPDataFormatSignatureKeyRing</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>byte[]</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.12.1</strong>; the signature keyring; will override existing setting directly on the PGPDataFormat.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelPGPDataFormatSignatureKeyUserid</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.11.0</strong>; the User ID of the signature key in the PGP keyring; will override existing setting directly on the PGPDataFormat.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>CamelPGPDataFormatSignatureKeyUserids</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>List&lt;String&gt;</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Since Camel 2.12.3</strong>; the User IDs of the signature keys in the PGP keyring; will override existing setting directly on the PGPDataFormat.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelPGPDataFormatSignatureKeyPassword</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.11.0</strong>; password used when opening the signature private key; will override existing setting directly on the PGPDataFormat.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelPGPDataFormatEncryptionAlgorithm</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>int</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.12.2</strong>; symmetric key encryption algorithm; will override existing setting directly on the PGPDataFormat.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelPGPDataFormatSignatureHashAlgorithm</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>int</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.12.2</strong>; signature hash algorithm; will override existing setting directly on the PGPDataFormat.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelPGPDataFormatCompressionAlgorithm</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>int</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.12.2</strong>; compression algorithm; will override existing setting directly on the PGPDataFormat.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelPGPDataFormatNumberOfEncryptionKeys</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>Integer</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Since</strong>&#160;<strong>Camel 2.12.3;&#160; </strong>number of public keys used for encrypting the symmectric key, set by PGPDataFormat during encryptiion process</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelPGPDataFormatNumberOfSigningKeys</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>Integer</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Since</strong>&#160;<strong>Camel 2.12.3;&#160; </strong>number of private keys used for creating signatures, set by PGPDataFormat during signing process</td></tr></tbody></table></div><h3 id="BookInOnePage-EncryptingwithPGPDataFormat">Encrypting with PGPDataFormat</h3><p>The following sample uses the popular PGP format for encrypting/decrypting files using the <a shape="rect" class="external-link" href="http://www.bouncycastle.org/java.html" rel="nofollow">Bouncy Castle Java libraries</a>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
// Public Key FileName
String keyFileName = getKeyFileName();
// Private Key FileName
String keyFileNameSec = getKeyFileNameSec();
// Keyring Userid Used to Encrypt
String keyUserid = getKeyUserId();
// Private key password
String keyPassword = getKeyPassword();

from(&quot;direct:inline&quot;).marshal().pgp(keyFileName, keyUserid).to(&quot;mock:encrypted&quot;).unmarshal()
        .pgp(keyFileNameSec, null, keyPassword).to(&quot;mock:unencrypted&quot;);
]]></script>
</div></div>The following sample performs signing + encryption, and then signature verification + decryption. It uses the same keyring for both signing and encryption, but you can obviously use different keys:<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
PGPDataFormat pgpSignAndEncrypt = new PGPDataFormat();
pgpSignAndEncrypt.setKeyFileName(keyFileName);
pgpSignAndEncrypt.setKeyUserid(keyUserid);
pgpSignAndEncrypt.setSignatureKeyFileName(keyFileNameSec);
PGPPassphraseAccessor passphraseAccessor = getPassphraseAccessor();
pgpSignAndEncrypt.setSignatureKeyUserid(&quot;Super &lt;sdude@nowhere.net&gt;&quot;); // must be the exact user Id because passphrase is searched in accessor
pgpSignAndEncrypt.setPassphraseAccessor(passphraseAccessor);
pgpSignAndEncrypt.setProvider(getProvider());
pgpSignAndEncrypt.setAlgorithm(getAlgorithm());
pgpSignAndEncrypt.setHashAlgorithm(getHashAlgorithm());
pgpSignAndEncrypt.setCompressionAlgorithm(getCompressionAlgorithm());

PGPDataFormat pgpVerifyAndDecrypt = new PGPDataFormat();
pgpVerifyAndDecrypt.setKeyFileName(keyFileNameSec);
pgpVerifyAndDecrypt.setPassword(keyPassword);
pgpVerifyAndDecrypt.setSignatureKeyFileName(keyFileName);
pgpVerifyAndDecrypt.setProvider(getProvider());
pgpVerifyAndDecrypt.setSignatureKeyUserid(keyUserid); // restrict verification to public keys with certain User ID

from(&quot;direct:inline-sign&quot;).marshal(pgpSignAndEncrypt).to(&quot;mock:encrypted&quot;).unmarshal(pgpVerifyAndDecrypt)
        .to(&quot;mock:unencrypted&quot;);
]]></script>
</div></div>Or using Spring:<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;dataFormats&gt;
  &lt;!-- will load the file from classpath by default, but you can prefix with file: to load from file system --&gt;
  &lt;pgp id=&quot;encrypt&quot; keyFileName=&quot;org/apache/camel/component/crypto/pubring.gpg&quot;
       keyUserid=&quot;sdude@nowhere.net&quot;/&gt;
  &lt;pgp id=&quot;decrypt&quot; keyFileName=&quot;org/apache/camel/component/crypto/secring.gpg&quot;
       password=&quot;sdude&quot;/&gt;
&lt;/dataFormats&gt;

&lt;route&gt;
  &lt;from uri=&quot;direct:inline&quot;/&gt;
  &lt;marshal ref=&quot;encrypt&quot;/&gt;
  &lt;to uri=&quot;mock:encrypted&quot;/&gt;
  &lt;unmarshal ref=&quot;decrypt&quot;/&gt;
  &lt;to uri=&quot;mock:unencrypted&quot;/&gt;
&lt;/route&gt;
]]></script>
</div></div><h4 id="BookInOnePage-Toworkwiththepreviousexampleyouneedthefollowing">To work with the previous example you need the following</h4><ul><li>A public keyring file which contains the public keys used to encrypt the data</li><li>A private keyring file which contains the keys used to decrypt the data</li><li>The keyring password</li></ul><h4 id="BookInOnePage-Managingyourkeyring">Managing your keyring</h4><p>To manage the keyring, I use the command line tools, I find this to be the simplest approach in managing the keys. There are also Java libraries available from <a shape="rect" class="external-link" href="http://www.bouncycastle.org/java.html" rel="nofollow">http://www.bouncycastle.org/java.html</a> if you would prefer to do it that way.</p><ol><li><p>Install the command line utilities on linux</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[apt-get install gnupg]]></script>
</div></div></li><li><p>Create your keyring, entering a secure password</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[gpg --gen-key]]></script>
</div></div></li><li><p>If you need to import someone elses public key so that you can encrypt a file for them.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[gpg --import &lt;filename.key]]></script>
</div></div></li><li><p>The following files should now exist and can be used to run the example</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[ls -l ~/.gnupg/pubring.gpg ~/.gnupg/secring.gpg]]></script>
</div></div></li></ol><h3 id="BookInOnePage-PGPDecrypting/VerifyingofMessagesEncrypted/SignedbyDifferentPrivate/PublicKeys">PGP Decrypting/Verifying of Messages Encrypted/Signed by Different Private/Public Keys</h3><p>Since <strong>Camel 2.12.2</strong>.</p><p>A PGP Data Formater can decrypt/verify messages which have been encrypted by different public keys or signed by different private keys. Just, provide the corresponding private keys in the secret keyring, the corresponding public keys in the public keyring, and the passphrases in the passphrase accessor.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[Map&lt;String, String&gt; userId2Passphrase = new HashMap&lt;String, String&gt;(2);
// add passphrases of several private keys whose corresponding public keys have been used to encrypt the messages
userId2Passphrase.put(&quot;UserIdOfKey1&quot;,&quot;passphrase1&quot;); // you must specify the exact User ID!
userId2Passphrase.put(&quot;UserIdOfKey2&quot;,&quot;passphrase2&quot;);
PGPPassphraseAccessor passphraseAccessor = new PGPPassphraseAccessorDefault(userId2Passphrase);

PGPDataFormat pgpVerifyAndDecrypt = new PGPDataFormat();
pgpVerifyAndDecrypt.setPassphraseAccessor(passphraseAccessor);
// the method getSecKeyRing() provides the secret keyring as byte array containing the private keys
pgpVerifyAndDecrypt.setEncryptionKeyRing(getSecKeyRing()); // alternatively you can use setKeyFileName(keyfileName)
// the method getPublicKeyRing() provides the public keyring as byte array containing the public keys
pgpVerifyAndDecrypt.setSignatureKeyRing((getPublicKeyRing());  // alternatively you can use setSignatureKeyFileName(signatgureKeyfileName)
// it is not necessary to specify the encryption or signer  User Id
 
from(&quot;direct:start&quot;)
         ...     
        .unmarshal(pgpVerifyAndDecrypt) // can decrypt/verify messages encrypted/signed by different private/public keys
        ...            
]]></script>
</div></div><ul><li>The functionality is especially useful to support the key exchange. If you want to exchange the private key for decrypting you can accept for a period of time messages which are either encrypted with the old or new corresponding public key. Or if the sender wants to exchange his signer private key, you can accept for a period of time, the old or new signer key.</li><li>Technical background: The PGP encrypted data contains a Key ID of the public key which was used to encrypt the data. This Key ID can be used to locate the private key in the secret keyring to decrypt the data. The same mechanism is also used to locate the public key for verifying a signature. Therefore you no longer must specify User IDs for the unmarshaling.</li></ul><h3 id="BookInOnePage-RestrictingtheSignerIdentitiesduringPGPSignatureVerification">Restricting the Signer Identities during PGP Signature Verification</h3><p>Since&#160;<strong>Camel 2.12.3.</strong></p><p>If you verify a signature you not only want to verify the correctness of the signature but you also want check that the signature comes from a certain identity or a specific set of identities. Therefore it is possible to restrict the number of public keys from the public keyring which can be used for the verification of a signature. &#160;</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Signature User IDs</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[// specify the User IDs of the expected signer identities
 List&lt;String&gt; expectedSigUserIds = new ArrayList&lt;String&gt;();
 expectedSigUserIds.add(&quot;Trusted company1&quot;);
 expectedSigUserIds.add(&quot;Trusted company2&quot;);

 PGPDataFormat pgpVerifyWithSpecificKeysAndDecrypt = new PGPDataFormat();
 pgpVerifyWithSpecificKeysAndDecrypt.setPassword(&quot;my password&quot;); // for decrypting with private key
 pgpVerifyWithSpecificKeysAndDecrypt.setKeyFileName(keyfileName);
 pgpVerifyWithSpecificKeysAndDecrypt.setSignatureKeyFileName(signatgureKeyfileName);
 pgpVerifyWithSpecificKeysAndDecrypt.setSignatureKeyUserids(expectedSigUserIds); // if you have only one signer identity then you can also use setSignatureKeyUserid(&quot;expected Signer&quot;)

from(&quot;direct:start&quot;)
         ...     
        .unmarshal(pgpVerifyWithSpecificKeysAndDecrypt)
        ...      ]]></script>
</div></div><ul><li>If the PGP content has several signatures the verification is successful as soon as one signature can be verified.</li><li>If you do not want to restrict the signer identities for verification then do not specify the signature key User IDs. In this case all public keys in the public keyring are taken into account.</li></ul><h3 id="BookInOnePage-SeveralSignaturesinOnePGPDataFormat">Several Signatures in One PGP Data Format</h3><p>Since&#160;<strong>Camel 2.12.3.</strong></p><p>The PGP specification allows that one PGP data format can contain several signatures from different keys. Since Camel 2.13.3 it is possible to create such kind of PGP content via specifying signature User IDs which relate to several private keys in the secret keyring.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Several Signatures</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[ PGPDataFormat pgpSignAndEncryptSeveralSignerKeys = new PGPDataFormat();
 pgpSignAndEncryptSeveralSignerKeys.setKeyUserid(keyUserid); // for encrypting, you can also use setKeyUserids if you want to encrypt with several keys
 pgpSignAndEncryptSeveralSignerKeys.setKeyFileName(keyfileName);
 pgpSignAndEncryptSeveralSignerKeys.setSignatureKeyFileName(signatgureKeyfileName);
 pgpSignAndEncryptSeveralSignerKeys.setSignaturePassword(&quot;sdude&quot;); // here we assume that all private keys have the same password, if this is not the case then you can use setPassphraseAccessor

 List&lt;String&gt; signerUserIds = new ArrayList&lt;String&gt;();
 signerUserIds.add(&quot;company old key&quot;);
 signerUserIds.add(&quot;company new key&quot;);
 pgpSignAndEncryptSeveralSignerKeys.setSignatureKeyUserids(signerUserIds);

from(&quot;direct:start&quot;)
         ...     
        .marshal(pgpSignAndEncryptSeveralSignerKeys)
        ...      ]]></script>
</div></div><h3 id="BookInOnePage-SupportofSub-KeysandKeyFlagsinPGPDataFormatMarshaler">Support of Sub-Keys and Key Flags in PGP Data Format Marshaler</h3><p>Since&#160;<strong>Camel 2.12.3.<br clear="none"></strong>An <a shape="rect" class="external-link" href="https://tools.ietf.org/html/rfc4880#section-12.1" rel="nofollow">OpenPGP V4 key</a> can have a primary key and sub-keys. The usage of the keys is indicated by the so called <a shape="rect" class="external-link" href="https://tools.ietf.org/html/rfc4880#section-5.2.3.21" rel="nofollow">Key Flags</a>. For example, you can have a primary key with two sub-keys; the primary key shall only be used for certifying other keys (Key Flag 0x01), the first sub-key&#160; shall only be used for signing (Key Flag 0x02), and the second sub-key shall only be used for encryption (Key Flag 0x04 or 0x08). The PGP Data Format marshaler takes into account these Key Flags of the primary key and sub-keys in order to determine the right key for signing and encryption. This is necessary because the primary key and its sub-keys have the same User IDs.</p><h3 id="BookInOnePage-SupportofCustomKeyAccessors">Support of Custom Key Accessors</h3><p>Since <strong>Camel 2.13.0.<br clear="none"></strong>You can implement custom key accessors for encryption/signing. The above PGPDataFormat class selects in a certain predefined way the keys which should be used for signing/encryption or verifying/decryption. If you have special requirements how your keys should be selected you should use the <a shape="rect" class="external-link" href="https://github.com/apache/camel/blob/master/components/camel-crypto/src/main/java/org/apache/camel/converter/crypto/PGPKeyAccessDataFormat.java" rel="nofollow">PGPKeyAccessDataFormat</a> class instead and implement the interfaces <a shape="rect" class="external-link" href="https://github.com/apache/camel/blob/master/components/camel-crypto/src/main/java/org/apache/camel/converter/crypto/PGPPublicKeyAccessor.java" rel="nofollow">PGPPublicKeyAccessor</a> and <a shape="rect" class="external-link" href="https://github.com/apache/camel/blob/master/components/camel-crypto/src/main/java/org/apache/camel/converter/crypto/PGPSecretKeyAccessor.java" rel="nofollow">PGPSecretKeyAccessor</a> as beans. There are default implementations <a shape="rect" class="external-link" href="https://github.com/apache/camel/blob/master/components/camel-crypto/src/main/java/org/apache/camel/converter/crypto/DefaultPGPPublicKeyAccessor.java" rel="nofollow">DefaultPGPPublicKeyAccessor</a> and <a shape="rect" class="external-link" href="https://github.com/apache/camel/blob/master/components/camel-crypto/src/main/java/org/apache/camel/converter/crypto/DefaultPGPSecretKeyAccessor.java" rel="nofollow">DefaultPGPSecretKeyAccessor</a> which cache the keys, so that not every time the keyring is parsed when the processor is called.</p><p>PGPKeyAccessDataFormat has the same options as PGPDataFormat except password, keyFileName, encryptionKeyRing, signaturePassword, signatureKeyFileName, and signatureKeyRing.</p><h3 id="BookInOnePage-Dependencies.33">Dependencies</h3><p>To use the <a shape="rect" href="crypto.html">Crypto</a> dataformat in your camel routes you need to add the following dependency to your pom.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-crypto&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
  &lt;!-- use the same version as your Camel core version --&gt;
&lt;/dependency&gt;
]]></script>
</div></div><h3 id="BookInOnePage-SeeAlso.8">See Also</h3><ul><li><a shape="rect" href="data-format.html">Data Format</a></li><li><a shape="rect" href="crypto-digital-signatures.html">Crypto (Digital Signatures)</a></li><li><a shape="rect" class="external-link" href="http://www.bouncycastle.org/java.html" rel="nofollow">http://www.bouncycastle.org/java.html</a></li></ul>
<h2 id="BookInOnePage-SyslogDataFormat">Syslog DataFormat</h2><p><strong>Available as of Camel 2.6</strong></p><p>The <strong>syslog</strong> dataformat is used for working with <a shape="rect" class="external-link" href="http://www.ietf.org/rfc/rfc3164.txt" rel="nofollow">RFC3164</a>&#160;and RFC5424 messages.</p><p>This component supports the following:</p><ul class="alternate"><li>UDP consumption of syslog messages</li><li>Agnostic data format using either plain String objects or SyslogMessage model objects.</li><li><a shape="rect" href="type-converter.html">Type Converter</a> from/to SyslogMessage and String</li><li>Integration with the <a shape="rect" href="mina.html">camel-mina</a> component.</li><li>Integration with the <a shape="rect" href="netty.html">camel-netty</a> component.</li><li><strong>Camel 2.14:</strong> Encoder and decoder for the&#160;<a shape="rect" href="netty.html">camel-netty</a>&#160;component.</li><li><strong>Camel 2.14:</strong>&#160;Support for RFC5424 also.</li></ul><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;dependency&gt;
    &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
    &lt;artifactId&gt;camel-syslog&lt;/artifactId&gt;
    &lt;version&gt;x.x.x&lt;/version&gt;
    &lt;!-- use the same version as your Camel core version --&gt;
&lt;/dependency&gt;
]]></script>
</div></div><h3 id="BookInOnePage-RFC3164Syslogprotocol">RFC3164 Syslog protocol</h3><p>Syslog uses the user datagram protocol (UDP) <a shape="rect" class="unresolved" href="#">1</a> as its underlying transport layer mechanism. <br clear="none"> The UDP port that has been assigned to syslog is 514.</p><p>To expose a Syslog listener service we reuse the existing <a shape="rect" href="mina.html">camel-mina</a> component or <a shape="rect" href="netty.html">camel-netty</a> where we just use the <code>Rfc3164SyslogDataFormat</code> to marshal and unmarshal messages. Notice that from&#160;<strong>Camel 2.14</strong> onwards the syslog dataformat is renamed to <code>SyslogDataFormat</code>.</p><h3 id="BookInOnePage-RFC5424Syslogprotocol">RFC5424 Syslog protocol</h3><p><strong>Available as of Camel 2.14</strong></p><p>To expose a Syslog listener service we reuse the existing&#160;<a shape="rect" href="mina.html">camel-mina</a>&#160;component or&#160;<a shape="rect" href="netty.html">camel-netty</a>&#160;where we just use the&#160;<code>SyslogDataFormat</code>&#160;to marshal and unmarshal messages</p><h4 id="BookInOnePage-ExposingaSysloglistener">Exposing a Syslog listener</h4><p>In our Spring XML file, we configure an endpoint to listen for udp messages on port 10514, note that in netty we disable the defaultCodec, this <br clear="none"> will allow a fallback to a NettyTypeConverter and delivers the message as an InputStream:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;camelContext id=&quot;myCamel&quot; xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;

    &lt;dataFormats&gt;
          &lt;syslog id=&quot;mySyslog&quot;/&gt;
    &lt;/dataFormats&gt;

    &lt;route&gt;
          &lt;from uri=&quot;netty:udp://localhost:10514?sync=false&amp;amp;allowDefaultCodec=false&quot;/&gt;
          &lt;unmarshal ref=&quot;mySyslog&quot;/&gt;
          &lt;to uri=&quot;mock:stop1&quot;/&gt;
    &lt;/route&gt;

&lt;/camelContext&gt;
]]></script>
</div></div><p>The same route using <a shape="rect" href="mina.html">camel-mina</a></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;camelContext id=&quot;myCamel&quot; xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;

    &lt;dataFormats&gt;
          &lt;syslog id=&quot;mySyslog&quot;/&gt;
    &lt;/dataFormats&gt;

    &lt;route&gt;
          &lt;from uri=&quot;mina:udp://localhost:10514&quot;/&gt;
          &lt;unmarshal ref=&quot;mySyslog&quot;/&gt;
          &lt;to uri=&quot;mock:stop1&quot;/&gt;
    &lt;/route&gt;

&lt;/camelContext&gt;
]]></script>
</div></div><h4 id="BookInOnePage-Sendingsyslogmessagestoaremotedestination">Sending syslog messages to a remote destination</h4><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[&lt;camelContext id=&quot;myCamel&quot; xmlns=&quot;http://camel.apache.org/schema/spring&quot;&gt;

    &lt;dataFormats&gt;
        &lt;syslog id=&quot;mySyslog&quot;/&gt;
    &lt;/dataFormats&gt;

    &lt;route&gt;
        &lt;from uri=&quot;direct:syslogMessages&quot;/&gt;
        &lt;marshal ref=&quot;mySyslog&quot;/&gt;
        &lt;to uri=&quot;mina:udp://remotehost:10514&quot;/&gt;
    &lt;/route&gt;

&lt;/camelContext&gt;
]]></script>
</div></div><p></p><h3 id="BookInOnePage-SeeAlso.9">See Also</h3>
<ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul>
<div class="chapter" id="chapter-pattern-appendix"><h1 id="BookInOnePage-PatternAppendix">Pattern Appendix</h1><p>There now follows a breakdown of the various <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/toc.html" rel="nofollow">Enterprise Integration Patterns</a> that Camel supports</p><h2 id="BookInOnePage-MessagingSystems.1">Messaging Systems</h2><h3 id="BookInOnePage-MessageChannel">Message Channel</h3><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/MessageChannel.html" rel="nofollow">Message Channel</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a>. The Message Channel is an internal implementation detail of the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Endpoint.html">Endpoint</a> interface and all interactions with the Message Channel are via the Endpoint interfaces.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/MessageChannelSolution.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/MessageChannelSolution.gif"></span></p><p><strong style="font-size: 16.0px;line-height: 1.5625;"><br clear="none"></strong></p><p><strong style="font-size: 16.0px;line-height: 1.5625;">Example</strong></p><p>In JMS, Message Channels are represented by topics and queues such as the following</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter">jms:queue:foo</script> 
 </div>
</div><p>&#160;</p><p>This message channel can be then used within the <a shape="rect" href="jms.html">JMS</a>&#160;component</p><p><strong style="line-height: 1.4285715;">Using the&#160;<a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">to(&amp;quot;jms:queue:foo&amp;quot;)</script> 
 </div>
</div><p><strong><br clear="none"></strong></p><p><strong>Using the&#160;<a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;to uri=&amp;quot;jms:queue:foo&amp;quot;/&amp;gt;</script> 
 </div>
</div><p>&#160;</p><p>For more details see</p><ul><li><a shape="rect" href="message.html">Message</a></li><li><a shape="rect" href="message-endpoint.html">Message Endpoint</a></li></ul><p></p><h4 id="BookInOnePage-UsingThisPattern">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-Message">Message</h3><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/Message.html" rel="nofollow">Message</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> using the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Message.html">Message</a> interface. </p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/MessageSolution.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/MessageSolution.gif"></span></p><p>To support various message <a shape="rect" href="exchange-pattern.html">exchange patterns</a> like one way <a shape="rect" href="event-message.html">Event Message</a> and <a shape="rect" href="request-reply.html">Request Reply</a> messages Camel uses an <a shape="rect" href="exchange.html">Exchange</a> interface which has a <strong>pattern</strong> property which can be set to <strong>InOnly</strong> for an <a shape="rect" href="event-message.html">Event Message</a> which has a single inbound Message, or <strong>InOut</strong> for a <a shape="rect" href="request-reply.html">Request Reply</a> where there is an inbound and outbound message.</p><p>Here is a basic example of sending a Message to a route in <strong>InOnly</strong> and <strong>InOut</strong> modes</p><p><strong>Requestor Code</strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> //InOnly getContext().createProducerTemplate().sendBody(&amp;quot;direct:startInOnly&amp;quot;, &amp;quot;Hello World&amp;quot;); //InOut String result = (String) getContext().createProducerTemplate().requestBody(&amp;quot;direct:startInOut&amp;quot;, &amp;quot;Hello World&amp;quot;); </script> 
 </div>
</div><p><strong>Route Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:startInOnly&amp;quot;).inOnly(&amp;quot;bean:process&amp;quot;); from(&amp;quot;direct:startInOut&amp;quot;).inOut(&amp;quot;bean:process&amp;quot;); </script> 
 </div>
</div><p><strong>Route Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:startInOnly&amp;quot;/&amp;gt; &amp;lt;inOnly uri=&amp;quot;bean:process&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:startInOut&amp;quot;/&amp;gt; &amp;lt;inOut uri=&amp;quot;bean:process&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-UsingThisPattern.1">Using This Pattern</h4><p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-PipesandFilters">Pipes and Filters</h3><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/PipesAndFilters.html" rel="nofollow">Pipes and Filters</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> in various ways.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/PipesAndFilters.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/PipesAndFilters.gif"></span></p><p>With Camel you can split your processing across multiple independent <a shape="rect" href="endpoint.html">Endpoint</a> instances which can then be chained together.</p><h4 id="BookInOnePage-UsingRoutingLogic">Using Routing Logic</h4><p>You can create pipelines of logic using multiple <a shape="rect" href="endpoint.html">Endpoint</a> or <a shape="rect" href="message-translator.html">Message Translator</a> instances as follows</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:a&amp;quot;).pipeline(&amp;quot;direct:x&amp;quot;, &amp;quot;direct:y&amp;quot;, &amp;quot;direct:z&amp;quot;, &amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>Though pipeline is the default mode of operation when you specify multiple outputs in Camel. The opposite to pipeline is multicast; which fires the same message into each of its outputs. (See the example below).</p><p>In Spring XML you can use the &lt;pipeline/&gt; element</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:SomeQueue&amp;quot;/&amp;gt; &amp;lt;pipeline&amp;gt; &amp;lt;bean ref=&amp;quot;foo&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;bar&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;activemq:OutputQueue&amp;quot;/&amp;gt; &amp;lt;/pipeline&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>In the above the pipeline element is actually unnecessary, you could use this...</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:SomeQueue&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;foo&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;bar&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;activemq:OutputQueue&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>Its just a bit more explicit. However if you wish to use &lt;multicast/&gt; to avoid a pipeline - to send the same message into multiple pipelines - then the &lt;pipeline/&gt; element comes into its own.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:SomeQueue&amp;quot;/&amp;gt; &amp;lt;multicast&amp;gt; &amp;lt;pipeline&amp;gt; &amp;lt;bean ref=&amp;quot;something&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;log:Something&amp;quot;/&amp;gt; &amp;lt;/pipeline&amp;gt; &amp;lt;pipeline&amp;gt; &amp;lt;bean ref=&amp;quot;foo&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;bar&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;activemq:OutputQueue&amp;quot;/&amp;gt; &amp;lt;/pipeline&amp;gt; &amp;lt;/multicast&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>In the above example we are routing from a single <a shape="rect" href="endpoint.html">Endpoint</a> to a list of different endpoints specified using <a shape="rect" href="uris.html">URIs</a>. If you find the above a bit confusing, try reading about the <a shape="rect" href="architecture.html">Architecture</a> or try the <a shape="rect" href="examples.html">Examples</a></p><h4 id="BookInOnePage-UsingThisPattern.2">Using This Pattern</h4><p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-MessageRouter">Message Router</h3><p>The <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/MessageRouter.html" rel="nofollow">Message Router</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> allows you to consume from an input destination, evaluate some predicate then choose the right output destination.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/MessageRouter.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/MessageRouter.gif"></span></p><p>The following example shows how to route a request from an input <strong>queue:a</strong> endpoint to either <strong>queue:b</strong>, <strong>queue:c</strong> or <strong>queue:d</strong> depending on the evaluation of various <a shape="rect" href="predicate.html">Predicate</a> expressions</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> RouteBuilder builder = new RouteBuilder() { public void configure() { errorHandler(deadLetterChannel(&amp;quot;mock:error&amp;quot;)); from(&amp;quot;direct:a&amp;quot;) .choice() .when(header(&amp;quot;foo&amp;quot;).isEqualTo(&amp;quot;bar&amp;quot;)) .to(&amp;quot;direct:b&amp;quot;) .when(header(&amp;quot;foo&amp;quot;).isEqualTo(&amp;quot;cheese&amp;quot;)) .to(&amp;quot;direct:c&amp;quot;) .otherwise() .to(&amp;quot;direct:d&amp;quot;); } }; </script> 
 </div>
</div><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext errorHandlerRef=&amp;quot;errorHandler&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:a&amp;quot;/&amp;gt; &amp;lt;choice&amp;gt; &amp;lt;when&amp;gt; &amp;lt;xpath&amp;gt;$foo = &amp;#39;bar&amp;#39;&amp;lt;/xpath&amp;gt; &amp;lt;to uri=&amp;quot;direct:b&amp;quot;/&amp;gt; &amp;lt;/when&amp;gt; &amp;lt;when&amp;gt; &amp;lt;xpath&amp;gt;$foo = &amp;#39;cheese&amp;#39;&amp;lt;/xpath&amp;gt; &amp;lt;to uri=&amp;quot;direct:c&amp;quot;/&amp;gt; &amp;lt;/when&amp;gt; &amp;lt;otherwise&amp;gt; &amp;lt;to uri=&amp;quot;direct:d&amp;quot;/&amp;gt; &amp;lt;/otherwise&amp;gt; &amp;lt;/choice&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-Choicewithoutotherwise">Choice without otherwise</h4><p>If you use a <code>choice</code> without adding an <code>otherwise</code>, any unmatched exchanges will be dropped by default. </p><h4 id="BookInOnePage-UsingThisPattern.3">Using This Pattern</h4><p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-MessageTranslator">Message Translator</h3><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/MessageTranslator.html" rel="nofollow">Message Translator</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> by using an arbitrary <a shape="rect" href="processor.html">Processor</a> in the routing logic, by using a <a shape="rect" href="bean-integration.html">bean</a> to perform the transformation, or by using transform() in the DSL. You can also use a <a shape="rect" href="data-format.html">Data Format</a> to marshal and unmarshal messages in different encodings.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/MessageTranslator.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/MessageTranslator.gif"></span></p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><p>You can transform a message using Camel's <a shape="rect" href="bean-integration.html">Bean Integration</a> to call any method on a bean in your <a shape="rect" href="registry.html">Registry</a> such as your <a shape="rect" href="spring.html">Spring</a> XML configuration file as follows</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;activemq:SomeQueue&amp;quot;). beanRef(&amp;quot;myTransformerBean&amp;quot;, &amp;quot;myMethodName&amp;quot;). to(&amp;quot;mqseries:AnotherQueue&amp;quot;); </script> 
 </div>
</div><p>Where the "myTransformerBean" would be defined in a Spring XML file or defined in JNDI etc. You can omit the method name parameter from beanRef() and the <a shape="rect" href="bean-integration.html">Bean Integration</a> will try to deduce the method to invoke from the message exchange.</p><p>or you can add your own explicit <a shape="rect" href="processor.html">Processor</a> to do the transformation</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;).process(new Processor() { public void process(Exchange exchange) { Message in = exchange.getIn(); in.setBody(in.getBody(String.class) + &amp;quot; World!&amp;quot;); } }).to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>or you can use the DSL to explicitly configure the transformation</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;).transform(body().append(&amp;quot; World!&amp;quot;)).to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p><strong>Use Spring XML</strong></p><p>You can also use <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a> to do a transformation. Basically any <a shape="rect" href="expression.html">Expression</a> language can be substituted inside the transform element as shown below</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;transform&amp;gt; &amp;lt;simple&amp;gt;${in.body} extra data!&amp;lt;/simple&amp;gt; &amp;lt;/transform&amp;gt; &amp;lt;to uri=&amp;quot;mock:end&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><p>Or you can use the <a shape="rect" href="bean-integration.html">Bean Integration</a> to invoke a bean</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:Input&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;myBeanName&amp;quot; method=&amp;quot;doTransform&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;activemq:Output&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>You can also use <a shape="rect" href="templating.html">Templating</a> to consume a message from one destination, transform it with something like <a shape="rect" href="velocity.html">Velocity</a> or <a shape="rect" href="xquery.html">XQuery</a> and then send it on to another destination. For example using InOnly (one way messaging)</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;activemq:My.Queue&amp;quot;). to(&amp;quot;velocity:com/acme/MyResponse.vm&amp;quot;). to(&amp;quot;activemq:Another.Queue&amp;quot;); </script> 
 </div>
</div><p>If you want to use InOut (request-reply) semantics to process requests on the <strong>My.Queue</strong> queue on <a shape="rect" href="activemq.html">ActiveMQ</a> with a template generated response, then sending responses back to the JMSReplyTo Destination you could use this.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;activemq:My.Queue&amp;quot;). to(&amp;quot;velocity:com/acme/MyResponse.vm&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-UsingThisPattern.4">Using This Pattern</h4><p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><ul class="alternate"><li><a shape="rect" href="content-enricher.html">Content Enricher</a></li><li><a shape="rect" href="using-getin-or-getout-methods-on-exchange.html">Using getIn or getOut methods on Exchange</a></li></ul><h3 id="BookInOnePage-MessageEndpoint">Message Endpoint</h3><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/MessageEndpoint.html" rel="nofollow">Message Endpoint</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> using the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Endpoint.html">Endpoint</a> interface.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/MessageEndpointSolution.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/MessageEndpointSolution.gif"></span></p><p>When using the <a shape="rect" href="dsl.html">DSL</a> to create <a shape="rect" href="routes.html">Routes</a> you typically refer to Message Endpoints by their <a shape="rect" href="uris.html">URIs</a> rather than directly using the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Endpoint.html">Endpoint</a> interface. Its then a responsibility of the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/CamelContext.html">CamelContext</a> to create and activate the necessary Endpoint instances using the available <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Component.html">Component</a> implementations.</p><h4 id="BookInOnePage-Example.6">Example</h4><p>The following example route demonstrates the use of a <a shape="rect" href="https://cwiki.apache.org/confluence/display/SM/File">File</a> Consumer Endpoint and <a shape="rect" href="jms.html">JMS</a> Producer Endpoint</p><p><strong><br clear="none"></strong></p><p><strong>Using the&#160;<a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://local/router/messages/foo&amp;quot;) .to(&amp;quot;jms:queue:foo&amp;quot;);</script> 
 </div>
</div><p>&#160;</p><p><strong><strong>Using the&#160;<a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;file://local/router/messages/foo&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;jms:queue:foo&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt;</script> 
 </div>
</div><p>&#160;</p><h3 id="BookInOnePage-DynamicTo">Dynamic To</h3><p><strong>Available as of Camel 2.16</strong></p><p>There is a new &lt;toD&gt; that allows to send a message to a dynamic computed&#160;<a shape="rect" href="endpoint.html">Endpoint</a> using one or more&#160;<a shape="rect" href="expression.html">Expression</a> that are concat together. By default the&#160;<a shape="rect" href="simple.html">Simple</a> language is used to compute the&#160;endpoint. For example to send a message to a endpoint defined by a header you can do</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;toD uri=&amp;quot;${header.foo}&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt;</script> 
 </div>
</div><p>And in Java DSL</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .toD(&amp;quot;${header.foo}&amp;quot;);</script> 
 </div>
</div><p>&#160;</p><p>You can also prefix the uri with a value because by default the uri is evaluated using the&#160;<a shape="rect" href="simple.html">Simple</a> language</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;toD uri=&amp;quot;mock:${header.foo}&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt;</script> 
 </div>
</div><p>And in Java DSL</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .toD(&amp;quot;mock:${header.foo}&amp;quot;);</script> 
 </div>
</div><p>In the example above we compute an endpoint that has prefix "mock:" and then the header foo is appended. So for example if the header foo has value order, then the endpoint is computed as "mock:order".</p><p>You can also use other languages than <a shape="rect" href="simple.html">Simple</a>&#160;such as&#160;<a shape="rect" href="xpath.html">XPath</a>&#160;- this requires to prefix with language: as shown below (simple language is the default language). If you do not specify language: then the endpoint is a component name. And in some cases there is both a component and language with the same name such as xquery.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;toD uri=&amp;quot;language:xpath:/order/@uri&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt;</script> 
 </div>
</div><p>This is done by specifying the name of the language followed by a colon.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .toD(&amp;quot;language:xpath:/order/@uri&amp;quot;);</script> 
 </div>
</div><p>You can also concat multiple&#160;<a shape="rect" href="language.html">Language</a>(s) together using the plus sign&#160;<code>+</code> such as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;toD uri=&amp;quot;jms:${header.base}+language:xpath:/order/@id&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt;</script> 
 </div>
</div><p>In the example above the uri is a combination of&#160;<a shape="rect" href="simple.html">Simple</a>&#160;language and&#160;<a shape="rect" href="xpath.html">XPath</a>&#160;where the first part is simple (simple is default language). And then the plus sign separate to another language, where we specify the language name followed by a colon</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .toD(&amp;quot;jms:${header.base}+language:xpath:/order/@id&amp;quot;);</script> 
 </div>
</div><p>You can concat as many languages as you want, just separate them with the plus sign</p><p>The Dynamic To has a few options you can configure</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh">Name</th><th colspan="1" rowspan="1" class="confluenceTh">Default Value</th><th colspan="1" rowspan="1" class="confluenceTh">Description</th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">uri</td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Mandatory:</strong> The uri to use. See above</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">pattern</td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd">To set a specific <a shape="rect" href="exchange-pattern.html">Exchange Pattern</a> to use when sending to the endpoint. The original MEP is restored afterwards.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">cacheSize</td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><span style="color: rgb(0,0,0);">Allows to configure the cache size for the&#160;</span><code>ProducerCache</code><span style="color: rgb(0,0,0);">&#160;which caches producers for reuse. Will by default use the default cache size which is 1000. Setting the value to -1 allows to turn off the cache all together.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">ignoreInvalidEndpoint</td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><span style="color: rgb(0,0,0);">Whether to ignore an endpoint URI that could not be resolved. If disabled, Camel will throw an exception identifying the invalid endpoint URI.</span></td></tr></tbody></table>
</div><p>&#160;</p><p>For more details see</p><ul><li><a shape="rect" href="recipient-list.html">Recipient List</a></li><li><a shape="rect" href="message.html">Message</a></li><li><a shape="rect" href="wire-tap.html">Wire Tap</a><br clear="none"><br clear="none"></li></ul><p></p><h4 id="BookInOnePage-UsingThisPattern.5">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h2 id="BookInOnePage-MessagingChannels.1">Messaging Channels</h2><h3 id="BookInOnePage-PointtoPointChannel">Point to Point Channel</h3><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/PointToPointChannel.html" rel="nofollow">Point to Point Channel</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> using the following components</p><ul><li><a shape="rect" href="seda.html">SEDA</a> for in-VM seda based messaging</li><li><a shape="rect" href="jms.html">JMS</a> for working with JMS Queues for high performance, clustering and load balancing</li><li><a shape="rect" href="jpa.html">JPA</a> for using a database as a simple message queue</li><li><a shape="rect" href="xmpp.html">XMPP</a> for point-to-point communication over XMPP (Jabber)</li><li>and others</li></ul><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/PointToPointSolution.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/PointToPointSolution.gif"></span></p><p>The following example demonstrates point to point messaging using the&#160;<a shape="rect" href="jms.html">JMS</a>&#160;component&#160;</p><p><strong>Using the&#160;<a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;jms:queue:foo&amp;quot;);</script> 
 </div>
</div><p>&#160;</p><p><strong><strong>Using the&#160;<a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;jms:queue:foo&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt;</script> 
 </div>
</div><p>&#160;</p><p>&#160;</p><p></p><h4 id="BookInOnePage-UsingThisPattern.6">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-PublishSubscribeChannel">Publish Subscribe Channel</h3><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/PublishSubscribeChannel.html" rel="nofollow">Publish Subscribe Channel</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> using for example the following components:</p><ul><li><a shape="rect" href="jms.html">JMS</a> for working with JMS Topics for high performance, clustering and load balancing</li><li><a shape="rect" href="xmpp.html">XMPP</a> when using rooms for group communication</li><li><a shape="rect" href="seda.html">SEDA</a> for working with SEDA in the same <a shape="rect" href="camelcontext.html">CamelContext</a> which can work in pub-sub, but allowing multiple consumers.</li><li><a shape="rect" href="vm.html">VM</a> as SEDA but for intra-JVM.</li></ul><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/PublishSubscribeSolution.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/PublishSubscribeSolution.gif"></span></p><h4 id="BookInOnePage-UsingRoutingLogic.1">Using Routing Logic</h4><p>Another option is to explicitly list the publish-subscribe relationship in your routing logic; this keeps the producer and consumer decoupled but lets you control the fine grained routing configuration using the <a shape="rect" href="dsl.html">DSL</a> or <a shape="rect" href="xml-configuration.html">Xml Configuration</a>.</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> RouteBuilder builder = new RouteBuilder() { public void configure() { errorHandler(deadLetterChannel(&amp;quot;mock:error&amp;quot;)); from(&amp;quot;direct:a&amp;quot;) .multicast().to(&amp;quot;direct:b&amp;quot;, &amp;quot;direct:c&amp;quot;, &amp;quot;direct:d&amp;quot;); } }; </script> 
 </div>
</div><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext errorHandlerRef=&amp;quot;errorHandler&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:a&amp;quot;/&amp;gt; &amp;lt;multicast&amp;gt; &amp;lt;to uri=&amp;quot;direct:b&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:c&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:d&amp;quot;/&amp;gt; &amp;lt;/multicast&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-UsingThisPattern.7">Using This Pattern</h4><p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h2 id="BookInOnePage-DeadLetterChannel">Dead Letter Channel</h2><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/DeadLetterChannel.html" rel="nofollow">Dead Letter Channel</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> using the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/DeadLetterChannel.html">DeadLetterChannel</a> processor which is an <a shape="rect" href="error-handler.html">Error Handler</a>.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/DeadLetterChannelSolution.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/DeadLetterChannelSolution.gif"></span></p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Difference between Dead Letter Channel and Default Error Handler</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The Default Error Handler does very little: it ends the Exchange immediately and propagates the thrown Exception back to the caller.</p>
  <p>The Dead Letter Channel lets you control behaviors including redelivery, whether to propagate the thrown Exception to the caller (the <strong>handled</strong> option), and where the (failed) Exchange should now be routed to.</p>
  <p>The Dead Letter Channel is also by default configured to not be verbose in the logs, so when a message is handled and moved to the dead letter endpoint, then there is nothing logged. If you want some level of logging you can use the various options on the redelivery policy / dead letter channel to configure this. For example if you want the message history then set logExhaustedMessageHistory=true (and logHandled=true for Camel 2.15.x or older).</p>
  <p>When the DeadLetterChannel moves a message to the dead letter endpoint, any new Exception thrown is by default handled by the dead letter channel as well. This ensures that the DeadLetterChannel will always succeed. From <strong>Camel 2.15</strong> onwards this behavior can be changed by setting the option deadLetterHandleNewException=false. Then if a new Exception is thrown, then the dead letter channel will fail and propagate back that new Exception (which is the behavior of the default error handler). When a new Exception occurs then the dead letter channel logs this at WARN level. This can be turned off by setting logNewException=false.</p>
 </div>
</div><h3 id="BookInOnePage-Redelivery">Redelivery</h3><p>It is common for a temporary outage or database deadlock to cause a message to fail to process; but the chances are if its tried a few more times with some time delay then it will complete fine. So we typically wish to use some kind of redelivery policy to decide how many times to try redeliver a message and how long to wait before redelivery attempts.</p><p>The <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/RedeliveryPolicy.html">RedeliveryPolicy</a> defines how the message is to be redelivered. You can customize things like</p><ul><li>how many times a message is attempted to be redelivered before it is considered a failure and sent to the dead letter channel</li><li>the initial redelivery timeout</li><li>whether or not exponential backoff is used (i.e. the time between retries increases using a backoff multiplier)</li><li>whether to use collision avoidance to add some randomness to the timings</li><li>delay pattern (see below for details)</li><li><strong>Camel 2.11:</strong> whether to allow redelivery during stopping/shutdown</li></ul><p>Once all attempts at redelivering the message fails then the message is forwarded to the dead letter queue.</p><h3 id="BookInOnePage-AboutmovingExchangetodeadletterqueueandusinghandled">About moving Exchange to dead letter queue and using handled</h3><p><strong>Handled</strong> on <a shape="rect" href="dead-letter-channel.html">Dead Letter Channel</a></p><p>When all attempts of redelivery have failed the <a shape="rect" href="exchange.html">Exchange</a> is moved to the dead letter queue (the dead letter endpoint). The exchange is then complete and from the client point of view it was processed. As such the <a shape="rect" href="dead-letter-channel.html">Dead Letter Channel</a> have handled the <a shape="rect" href="exchange.html">Exchange</a>.</p><p>For instance configuring the dead letter channel as:</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">errorHandler(deadLetterChannel(&amp;quot;jms:queue:dead&amp;quot;) .maximumRedeliveries(3).redeliveryDelay(5000)); </script> 
 </div>
</div><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route errorHandlerRef=&amp;quot;myDeadLetterErrorHandler&amp;quot;&amp;gt; ... &amp;lt;/route&amp;gt; &amp;lt;bean id=&amp;quot;myDeadLetterErrorHandler&amp;quot; class=&amp;quot;org.apache.camel.builder.DeadLetterChannelBuilder&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;deadLetterUri&amp;quot; value=&amp;quot;jms:queue:dead&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;redeliveryPolicy&amp;quot; ref=&amp;quot;myRedeliveryPolicyConfig&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;myRedeliveryPolicyConfig&amp;quot; class=&amp;quot;org.apache.camel.processor.RedeliveryPolicy&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;maximumRedeliveries&amp;quot; value=&amp;quot;3&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;redeliveryDelay&amp;quot; value=&amp;quot;5000&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>The <a shape="rect" href="dead-letter-channel.html">Dead Letter Channel</a> above will clear the caused exception (<code>setException(null)</code>), by moving the caused exception to a property on the <a shape="rect" href="exchange.html">Exchange</a>, with the key <code>Exchange.EXCEPTION_CAUGHT</code>. Then the <a shape="rect" href="exchange.html">Exchange</a> is moved to the <code>"jms:queue:dead"</code> destination and the client will not notice the failure.</p><h3 id="BookInOnePage-AboutmovingExchangetodeadletterqueueandusingtheoriginalmessage">About moving Exchange to dead letter queue and using the original message</h3><p>The option <strong>useOriginalMessage</strong> is used for routing the original input message instead of the current message that potentially is modified during routing.</p><p>For instance if you have this route:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;jms:queue:order:input&amp;quot;) .to(&amp;quot;bean:validateOrder&amp;quot;) .to(&amp;quot;bean:transformOrder&amp;quot;) .to(&amp;quot;bean:handleOrder&amp;quot;); </script> 
 </div>
</div><p>The route listen for JMS messages and validates, transforms and handle it. During this the <a shape="rect" href="exchange.html">Exchange</a> payload is transformed/modified. So in case something goes wrong and we want to move the message to another JMS destination, then we can configure our <a shape="rect" href="dead-letter-channel.html">Dead Letter Channel</a> with the <strong>useOriginalMessage</strong> option. But when we move the <a shape="rect" href="exchange.html">Exchange</a> to this destination we do not know in which state the message is in. Did the error happen in before the transformOrder or after? So to be sure we want to move the original input message we received from <code>jms:queue:order:input</code>. So we can do this by enabling the <strong>useOriginalMessage</strong> option as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // will use original body errorHandler(deadLetterChannel(&amp;quot;jms:queue:dead&amp;quot;) .useOriginalMessage().maximumRedeliveries(5).redeliverDelay(5000); </script> 
 </div>
</div><p>Then the messages routed to the <code>jms:queue:dead</code> is the original input. If we want to manually retry we can move the JMS message from the failed to the input queue, with no problem as the message is the same as the original we received.</p><h3 id="BookInOnePage-OnRedelivery">OnRedelivery</h3><p>When <a shape="rect" href="dead-letter-channel.html">Dead Letter Channel</a> is doing redeliver its possible to configure a <a shape="rect" href="processor.html">Processor</a> that is executed just <strong>before</strong> every redelivery attempt. This can be used for the situations where you need to alter the message before its redelivered. See below for sample.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">onException and onRedeliver</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>We also support for per <a shape="rect" href="exception-clause.html"><strong>onException</strong></a> to set a <strong>onRedeliver</strong>. That means you can do special on redelivery for different exceptions, as opposed to onRedelivery set on <a shape="rect" href="dead-letter-channel.html">Dead Letter Channel</a> can be viewed as a global scope.</p>
 </div>
</div><h3 id="BookInOnePage-Redeliverydefaultvalues">Redelivery default values</h3><p>Redelivery is disabled by default.</p><p>The default redeliver policy will use the following values:</p><ul><li>maximumRedeliveries=0</li><li>redeliverDelay=1000L (1 second)</li><li>maximumRedeliveryDelay = 60 * 1000L (60 seconds)</li><li>And the exponential backoff and collision avoidance is turned off.</li><li>The retriesExhaustedLogLevel are set to LoggingLevel.ERROR</li><li>The retryAttemptedLogLevel are set to LoggingLevel.DEBUG</li><li>Stack traces is logged for exhausted messages from Camel 2.2 onwards.</li><li>Handled exceptions is not logged from Camel 2.3 onwards</li><li>logExhaustedMessageHistory is true for default error handler, and false for dead letter channel.</li><li>logExhaustedMessageBody <strong>Camel 2.17:</strong>&#160;is disabled by default to avoid logging sensitive message body/header details. If this option is true, then&#160;logExhaustedMessageHistory must also be true.</li></ul><p>The maximum redeliver delay ensures that a delay is never longer than the value, default 1 minute. This can happen if you turn on the exponential backoff.</p><p>The maximum redeliveries is the number of <strong>re</strong> delivery attempts. By default Camel will try to process the exchange 1 + 5 times. 1 time for the normal attempt and then 5 attempts as redeliveries.<br clear="none"> Setting the maximumRedeliveries to a negative value such as -1 will then always redelivery (unlimited).<br clear="none"> Setting the maximumRedeliveries to 0 will disable any re delivery attempt.</p><p>Camel will log delivery failures at the DEBUG logging level by default. You can change this by specifying retriesExhaustedLogLevel and/or retryAttemptedLogLevel. See <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/camel-core/src/test/java/org/apache/camel/builder/ExceptionBuilderWithRetryLoggingLevelSetTest.java">ExceptionBuilderWithRetryLoggingLevelSetTest</a> for an example.</p><p>You can turn logging of stack traces on/off. If turned off Camel will still log the redelivery attempt. Its just much less verbose.</p><h4 id="BookInOnePage-RedeliverDelayPattern">Redeliver Delay Pattern</h4><p>Delay pattern is used as a single option to set a range pattern for delays. If used then the following options does not apply: (delay, backOffMultiplier, useExponentialBackOff, useCollisionAvoidance, maximumRedeliveryDelay).</p><p>The idea is to set groups of ranges using the following syntax: <code>limit:delay;limit 2:delay 2;limit 3:delay 3;...;limit N:delay N</code></p><p>Each group has two values separated with colon</p><ul class="alternate"><li>limit = upper limit</li><li>delay = delay in millis<br clear="none"> And the groups is again separated with semi colon.<br clear="none"> The rule of thumb is that the next groups should have a higher limit than the previous group.</li></ul><p>Lets clarify this with an example:<br clear="none"> <code>delayPattern=5:1000;10:5000;20:20000</code></p><p>That gives us 3 groups:</p><ul class="alternate"><li>5:1000</li><li>10:5000</li><li>20:20000</li></ul><p>Resulting in these delays for redelivery attempt:</p><ul class="alternate"><li>Redelivery attempt number 1..4 = 0 millis (as the first group start with 5)</li><li>Redelivery attempt number 5..9 = 1000 millis (the first group)</li><li>Redelivery attempt number 10..19 = 5000 millis (the second group)</li><li>Redelivery attempt number 20.. = 20000 millis (the last group)</li></ul><p>Note: The first redelivery attempt is 1, so the first group should start with 1 or higher.</p><p>You can start a group with limit 1 to eg have a starting delay: <code>delayPattern=1:1000;5:5000</code></p><ul class="alternate"><li>Redelivery attempt number 1..4 = 1000 millis (the first group)</li><li>Redelivery attempt number 5.. = 5000 millis (the last group)</li></ul><p>There is no requirement that the next delay should be higher than the previous. You can use any delay value you like. For example with <code>delayPattern=1:5000;3:1000</code> we start with 5 sec delay and then later reduce that to 1 second.</p><h3 id="BookInOnePage-Redeliveryheader">Redelivery header</h3><p>When a message is redelivered the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/camel-core/apidocs/org/apache/camel/processor/DeadLetterChannel.html">DeadLetterChannel</a> will append a customizable header to the message to indicate how many times its been redelivered. <br clear="none"> Before Camel 2.6: The header is <strong>CamelRedeliveryCounter</strong>, which is also defined on the <code>Exchange.REDELIVERY_COUNTER</code>.<br clear="none"> Starting with 2.6: The header <strong>CamelRedeliveryMaxCounter</strong>, which is also defined on the <code>Exchange.REDELIVERY_MAX_COUNTER</code>, contains the maximum redelivery setting. This header is absent if you use <code>retryWhile</code> or have unlimited maximum redelivery configured.</p><p>And a boolean flag whether it is being redelivered or not (first attempt)<br clear="none"> The header <strong>CamelRedelivered</strong> contains a boolean if the message is redelivered or not, which is also defined on the <code>Exchange.REDELIVERED</code>.</p><p>Dynamically calculated delay from the exchange<br clear="none"> In Camel 2.9 and 2.8.2: The header is <strong>CamelRedeliveryDelay</strong>, which is also defined on the <code>Exchange.REDELIVERY_DELAY</code>.<br clear="none"> Is this header is absent, normal redelivery rules apply.</p><h4 id="BookInOnePage-Whichendpointfailed">Which endpoint failed</h4><p><strong>Available as of Camel 2.1</strong></p><p>When Camel routes messages it will decorate the <a shape="rect" href="exchange.html">Exchange</a> with a property that contains the <strong>last</strong> endpoint Camel send the <a shape="rect" href="exchange.html">Exchange</a> to:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">String lastEndpointUri = exchange.getProperty(Exchange.TO_ENDPOINT, String.class); </script> 
 </div>
</div><p>The <code>Exchange.TO_ENDPOINT</code> have the constant value <code>CamelToEndpoint</code>.</p><p>This information is updated when Camel sends a message to any endpoint. So if it exists its the <strong>last</strong> endpoint which Camel send the Exchange to.</p><p>When for example processing the <a shape="rect" href="exchange.html">Exchange</a> at a given <a shape="rect" href="endpoint.html">Endpoint</a> and the message is to be moved into the dead letter queue, then Camel also decorates the Exchange with another property that contains that <strong>last</strong> endpoint:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">String failedEndpointUri = exchange.getProperty(Exchange.FAILURE_ENDPOINT, String.class); </script> 
 </div>
</div><p>The <code>Exchange.FAILURE_ENDPOINT</code> have the constant value <code>CamelFailureEndpoint</code>.</p><p>This allows for example you to fetch this information in your dead letter queue and use that for error reporting.<br clear="none"> This is useable if the Camel route is a bit dynamic such as the dynamic <a shape="rect" href="recipient-list.html">Recipient List</a> so you know which endpoints failed.</p><p><strong>Notice:</strong> These information is kept on the Exchange even if the message was successfully processed by a given endpoint, and then later fails for example in a local <a shape="rect" href="bean.html">Bean</a> processing instead. So beware that this is a hint that helps pinpoint errors.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:queue:foo&amp;quot;) .to(&amp;quot;http://someserver/somepath&amp;quot;) .beanRef(&amp;quot;foo&amp;quot;); </script> 
 </div>
</div><p>Now suppose the route above and a failure happens in the <code>foo</code> bean. Then the <code>Exchange.TO_ENDPOINT</code> and <code>Exchange.FAILURE_ENDPOINT</code> will still contain the value of <code><a shape="rect" class="external-link" href="http://someserver/somepath" rel="nofollow">http://someserver/somepath</a></code>.</p><h3 id="BookInOnePage-OnPrepareFailure">OnPrepareFailure</h3><p><strong>Available as of Camel 2.16</strong></p><p>Before the exchange is sent to the dead letter queue, you can use onPrepare to allow a custom&#160;<code>Processor</code> to prepare the exchange, such as adding information why the Exchange failed. For example the following processor adds a header with the exception message</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public static class MyPrepareProcessor implements Processor { @Override public void process(Exchange exchange) throws Exception { Exception cause = exchange.getProperty(Exchange.EXCEPTION_CAUGHT, Exception.class); exchange.getIn().setHeader(&amp;quot;FailedBecause&amp;quot;, cause.getMessage()); } }</script> 
 </div>
</div><p>Then configure the error handler to use the processor as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">errorHandler(deadLetterChannel(&amp;quot;jms:dead&amp;quot;).onPrepareFailure(new MyPrepareProcessor()));</script> 
 </div>
</div><p>&#160;</p><p>Configuring this from XML DSL is as shown:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;myPrepare&amp;quot; class=&amp;quot;org.apache.camel.processor.DeadLetterChannelOnPrepareTest.MyPrepareProcessor&amp;quot;/&amp;gt; &amp;lt;errorHandler id=&amp;quot;dlc&amp;quot; type=&amp;quot;DeadLetterChannel&amp;quot; deadLetterUri=&amp;quot;jms:dead&amp;quot; onPrepareFailureRef=&amp;quot;myPrepare&amp;quot;/&amp;gt;</script> 
 </div>
</div><p>&#160;</p><p>The onPrepare is also available using the default error handler.</p><h3 id="BookInOnePage-Whichroutefailed">Which route failed</h3><p><strong>Available as of Camel 2.10.4/2.11</strong></p><p>When Camel error handler handles an error such as <a shape="rect" href="dead-letter-channel.html">Dead Letter Channel</a> or using <a shape="rect" href="exception-clause.html">Exception Clause</a> with handled=true, then Camel will decorate<br clear="none"> the <a shape="rect" href="exchange.html">Exchange</a> with the route id where the error occurred.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">String failedRouteId = exchange.getProperty(Exchange.FAILURE_ROUTE_ID, String.class); </script> 
 </div>
</div><p>The <code>Exchange.FAILURE_ROUTE_ID</code> have the constant value <code>CamelFailureRouteId</code>.</p><p>This allows for example you to fetch this information in your dead letter queue and use that for error reporting.</p><h3 id="BookInOnePage-Controlifredeliveryisallowedduringstopping/shutdown">Control if redelivery is allowed during stopping/shutdown</h3><p><strong>Available as of Camel 2.11</strong></p><p>Prior to Camel 2.10, Camel will perform redelivery while stopping a route, or shutting down Camel. This has improved a bit in Camel 2.10 onwards, as Camel will not perform redelivery attempts when shutting down aggressively (eg during <a shape="rect" href="graceful-shutdown.html">Graceful Shutdown</a> and timeout hit). From Camel 2.11 onwards there is a new option <code>allowRedeliveryWhileStopping</code> which you can use to control if redelivery is allowed or not; notice that any in progress redelivery will still be executed. This option can only disallow any redelivery to be executed <strong>after</strong> the stopping of a route/shutdown of Camel has been triggered. If a redelivery is dissallowed then a <code>RejectedExcutionException</code> is set on the <a shape="rect" href="exchange.html">Exchange</a> and the processing of the <a shape="rect" href="exchange.html">Exchange</a> stops. This means any consumer will see the <a shape="rect" href="exchange.html">Exchange</a> as failed due the <code>RejectedExecutionException</code>.</p><p>The default value is <code>true</code> to be backwards compatible as before. For example the following sample shows how to do this with Java DSL and XML DSL
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // this error handler will try up till 20 redelivery attempts with 1 second between. // however if we are stopping then do not allow any redeliver attempts. errorHandler(defaultErrorHandler() .allowRedeliveryWhileStopping(false) .maximumRedeliveries(20).redeliveryDelay(1000).retryAttemptedLogLevel(LoggingLevel.INFO)); from(&amp;quot;seda:foo&amp;quot;).routeId(&amp;quot;foo&amp;quot;) .to(&amp;quot;mock:foo&amp;quot;) .throwException(new IllegalArgumentException(&amp;quot;Forced&amp;quot;)); </script> 
  </div>
 </div>And the sample sample with XML DSL
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- notice we use the errorHandlerRef attribute to refer to the error handler to use as default --&amp;gt; &amp;lt;camelContext errorHandlerRef=&amp;quot;myErrorHandler&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;!-- configure error handler, to redeliver up till 10 times, with 1 sec delay and if we are stopping then do not allow redeliveries, to stop faster --&amp;gt; &amp;lt;errorHandler id=&amp;quot;myErrorHandler&amp;quot; type=&amp;quot;DefaultErrorHandler&amp;quot;&amp;gt; &amp;lt;redeliveryPolicy maximumRedeliveries=&amp;quot;20&amp;quot; redeliveryDelay=&amp;quot;1000&amp;quot; allowRedeliveryWhileStopping=&amp;quot;false&amp;quot; retryAttemptedLogLevel=&amp;quot;INFO&amp;quot;/&amp;gt; &amp;lt;/errorHandler&amp;gt; &amp;lt;route id=&amp;quot;foo&amp;quot;&amp;gt; &amp;lt;from uri=&amp;quot;seda:foo&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:foo&amp;quot;/&amp;gt; &amp;lt;throwException ref=&amp;quot;forced&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
  </div>
 </div><h3 id="BookInOnePage-Samples.4">Samples</h3><p>The following example shows how to configure the Dead Letter Channel configuration using the <a shape="rect" href="dsl.html">DSL</a>
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> RouteBuilder builder = new RouteBuilder() { public void configure() { // using dead letter channel with a seda queue for errors errorHandler(deadLetterChannel(&amp;quot;seda:errors&amp;quot;)); // here is our route from(&amp;quot;seda:a&amp;quot;).to(&amp;quot;seda:b&amp;quot;); } }; </script> 
  </div>
 </div>You can also configure the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/RedeliveryPolicy.html">RedeliveryPolicy</a> as this example shows
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> RouteBuilder builder = new RouteBuilder() { public void configure() { // configures dead letter channel to use seda queue for errors and use at most 2 redelveries // and exponential backoff errorHandler(deadLetterChannel(&amp;quot;seda:errors&amp;quot;).maximumRedeliveries(2).useExponentialBackOff()); // here is our route from(&amp;quot;seda:a&amp;quot;).to(&amp;quot;seda:b&amp;quot;); } }; </script> 
  </div>
 </div><h3 id="BookInOnePage-HowcanImodifytheExchangebeforeredelivery?">How can I modify the Exchange before redelivery?</h3><p>We support directly in <a shape="rect" href="dead-letter-channel.html">Dead Letter Channel</a> to set a <a shape="rect" href="processor.html">Processor</a> that is executed <strong>before</strong> each redelivery attempt.</p><p>When <a shape="rect" href="dead-letter-channel.html">Dead Letter Channel</a> is doing redeliver its possible to configure a <a shape="rect" href="processor.html">Processor</a> that is executed just <strong>before</strong> every redelivery attempt. This can be used for the situations where you need to alter the message before its redelivered.</p><p>Here we configure the <a shape="rect" href="dead-letter-channel.html">Dead Letter Channel</a> to use our processor <code>MyRedeliveryProcessor</code> to be executed before each redelivery.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // we configure our Dead Letter Channel to invoke // MyRedeliveryProcessor before a redelivery is // attempted. This allows us to alter the message before errorHandler(deadLetterChannel(&amp;quot;mock:error&amp;quot;).maximumRedeliveries(5) .onRedelivery(new MyRedeliverProcessor()) // setting delay to zero is just to make unit testing faster .redeliveryDelay(0L)); </script> 
  </div>
 </div>And this is the processor <code>MyRedeliveryProcessor</code> where we alter the message.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // This is our processor that is executed before every redelivery attempt // here we can do what we want in the java code, such as altering the message public class MyRedeliverProcessor implements Processor { public void process(Exchange exchange) throws Exception { // the message is being redelivered so we can alter it // we just append the redelivery counter to the body // you can of course do all kind of stuff instead String body = exchange.getIn().getBody(String.class); int count = exchange.getIn().getHeader(Exchange.REDELIVERY_COUNTER, Integer.class); exchange.getIn().setBody(body + count); // the maximum redelivery was set to 5 int max = exchange.getIn().getHeader(Exchange.REDELIVERY_MAX_COUNTER, Integer.class); assertEquals(5, max); } } </script> 
  </div>
 </div><h3 id="BookInOnePage-HowcanIlogwhatcausedtheDeadLetterChanneltobeinvoked?">How can I log what caused the Dead Letter Channel to be invoked?</h3><p>You often need to know what went wrong that caused the Dead Letter Channel to be used and it does not offer logging for this purpose. So the Dead Letter Channel's endpoint can be set to a endpoint of our own (such as&#160;<code>direct:deadLetterChannel</code>). We write a route to accept this Exchange and log the Exception, then forward on to where we want the failed Exchange moved to (which might be a DLQ queue for instance). See also&#160;<a shape="rect" class="external-link" href="http://stackoverflow.com/questions/13711462/logging-camel-exceptions-and-sending-to-the-dead-letter-channel" rel="nofollow">http://stackoverflow.com/questions/13711462/logging-camel-exceptions-and-sending-to-the-dead-letter-channel</a></p><p></p><h4 id="BookInOnePage-UsingThisPattern.8">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><ul class="alternate"><li><a shape="rect" href="error-handler.html">Error Handler</a></li><li><a shape="rect" href="exception-clause.html">Exception Clause</a></li></ul><h3 id="BookInOnePage-GuaranteedDelivery">Guaranteed Delivery</h3><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/GuaranteedMessaging.html" rel="nofollow">Guaranteed Delivery</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> using among others the following components:</p><ul><li><a shape="rect" href="file2.html">File</a> for using file systems as a persistent store of messages</li><li><a shape="rect" href="jms.html">JMS</a> when using persistent delivery (the default) for working with JMS Queues and Topics for high performance, clustering and load balancing</li><li><a shape="rect" href="jpa.html">JPA</a> for using a database as a persistence layer, or use any of the many other database component such as <a shape="rect" href="sql.html">SQL</a>, <a shape="rect" href="jdbc.html">JDBC</a>, <a shape="rect" href="ibatis.html">iBATIS</a>/<a shape="rect" href="mybatis.html">MyBatis</a>, <a shape="rect" href="hibernate.html">Hibernate</a></li><li><a shape="rect" href="hawtdb.html">HawtDB</a> for a lightweight key-value persistent store</li></ul><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/GuaranteedMessagingSolution.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/GuaranteedMessagingSolution.gif"></span></p><h4 id="BookInOnePage-Example.7">Example</h4><p>The following example demonstrates illustrates the use of&#160;<a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/GuaranteedMessaging.html" rel="nofollow">Guaranteed Delivery</a>&#160;within the&#160;<a shape="rect" href="jms.html">JMS</a>&#160;component. By default, a message is not considered successfully delivered until the recipient has persisted the message locally guaranteeing its receipt in the event the destination becomes unavailable.</p><p><strong>Using the&#160;<a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;jms:queue:foo&amp;quot;);</script> 
 </div>
</div><p>&#160;</p><p><strong><strong>Using the&#160;<a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;jms:queue:foo&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt;</script> 
 </div>
</div><p></p><h4 id="BookInOnePage-UsingThisPattern.9">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-MessageBus">Message Bus</h3><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/PointToPointChannel.html" rel="nofollow">Message Bus</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a>. You could view Camel as a Message Bus itself as it allows producers and consumers to be decoupled.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/MessageBusSolution.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/MessageBusSolution.gif"></span></p><p>Folks often assume that a Message Bus is a JMS though so you may wish to refer to the <a shape="rect" href="jms.html">JMS</a> component for traditional MOM support.<br clear="none"> Also worthy of note is the <a shape="rect" href="xmpp.html">XMPP</a> component for supporting messaging over XMPP (Jabber)</p><p>Of course there are also ESB products such as <a shape="rect" class="external-link" href="http://servicemix.apache.org/home.html">Apache ServiceMix</a> which serve as full fledged message busses.<br clear="none"> You can interact with <a shape="rect" class="external-link" href="http://servicemix.apache.org/home.html">Apache ServiceMix</a> from Camel in many ways, but in particular you can use the <a shape="rect" href="nmr.html">NMR</a> or <a shape="rect" href="jbi.html">JBI</a> component to access the ServiceMix message bus directly.</p><p>&#160;</p><h4 id="BookInOnePage-Example.8">Example</h4><p>The following demonstrates how the Camel message bus can be used to communicate with consumers and producers</p><p><strong><br clear="none"></strong></p><p><strong>Using the&#160;<a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .pollEnrich(&amp;quot;file:inbox?fileName=data.txt&amp;quot;) .to(&amp;quot;jms:queue:foo&amp;quot;);</script> 
 </div>
</div><p>&#160;</p><p><strong><strong>Using the&#160;<a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;pollEnrich uri=&amp;quot;file:inbox?fileName=data.txt&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;jms:queue:foo&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt;</script> 
 </div>
</div><p></p><h4 id="BookInOnePage-UsingThisPattern.10">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-MessageConstruction.1">Message Construction</h3><h2 id="BookInOnePage-EventMessage">Event Message</h2><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/EventMessage.html" rel="nofollow">Event Message</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> by supporting the <a shape="rect" href="exchange-pattern.html">Exchange Pattern</a> on a <a shape="rect" href="message.html">Message</a> which can be set to <strong>InOnly</strong> to indicate a oneway event message. Camel <a shape="rect" href="components.html">Components</a> then implement this pattern using the underlying transport or protocols.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/EventMessageSolution.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/EventMessageSolution.gif"></span></p><p>The default behaviour of many <a shape="rect" href="components.html">Components</a> is InOnly such as for <a shape="rect" href="jms.html">JMS</a>, <a shape="rect" href="file2.html">File</a> or <a shape="rect" href="seda.html">SEDA</a></p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Related</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>See the related <a shape="rect" href="request-reply.html">Request Reply</a> message.</p>
 </div>
</div><h3 id="BookInOnePage-ExplicitlyspecifyingInOnly">Explicitly specifying InOnly</h3><p>If you are using a component which defaults to InOut you can override the <a shape="rect" href="exchange-pattern.html">Exchange Pattern</a> for an endpoint using the pattern property.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">foo:bar?exchangePattern=InOnly </script> 
 </div>
</div><p>From 2.0 onwards on Camel you can specify the <a shape="rect" href="exchange-pattern.html">Exchange Pattern</a> using the DSL.</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;mq:someQueue&amp;quot;). setExchangePattern(ExchangePattern.InOnly). bean(Foo.class); </script> 
 </div>
</div><p>or you can invoke an endpoint with an explicit pattern</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;mq:someQueue&amp;quot;). inOnly(&amp;quot;mq:anotherQueue&amp;quot;); </script> 
 </div>
</div><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;mq:someQueue&amp;quot;/&amp;gt; &amp;lt;inOnly uri=&amp;quot;bean:foo&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;mq:someQueue&amp;quot;/&amp;gt; &amp;lt;inOnly uri=&amp;quot;mq:anotherQueue&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p></p><h4 id="BookInOnePage-UsingThisPattern.11">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h2 id="BookInOnePage-RequestReply">Request Reply</h2><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/RequestReply.html" rel="nofollow">Request Reply</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> by supporting the <a shape="rect" href="exchange-pattern.html">Exchange Pattern</a> on a <a shape="rect" href="message.html">Message</a> which can be set to <strong>InOut</strong> to indicate a request/reply. Camel <a shape="rect" href="components.html">Components</a> then implement this pattern using the underlying transport or protocols.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/RequestReply.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/RequestReply.gif"></span></p><p>For example when using <a shape="rect" href="jms.html">JMS</a> with InOut the component will by default perform these actions</p><ul><li>create by default a temporary inbound queue</li><li>set the JMSReplyTo destination on the request message</li><li>set the JMSCorrelationID on the request message</li><li>send the request message</li><li>consume the response and associate the inbound message to the request using the JMSCorrelationID (as you may be performing many concurrent request/responses).</li></ul><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Related</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body"> 
  <p>See the related <a shape="rect" href="event-message.html">Event Message</a> message</p>
 </div>
</div><h3 id="BookInOnePage-ExplicitlyspecifyingInOut">Explicitly specifying InOut</h3><p>When consuming messages from <a shape="rect" href="jms.html">JMS</a> a Request-Reply is indicated by the presence of the <strong>JMSReplyTo</strong> header.</p><p>You can explicitly force an endpoint to be in Request Reply mode by setting the exchange pattern on the URI. e.g.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> jms:MyQueue?exchangePattern=InOut </script> 
 </div>
</div><p>You can specify the exchange pattern in DSL rule or Spring configuration.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // Send to an endpoint using InOut from(&amp;quot;direct:testInOut&amp;quot;).inOut(&amp;quot;mock:result&amp;quot;); // Send to an endpoint using InOut from(&amp;quot;direct:testInOnly&amp;quot;).inOnly(&amp;quot;mock:result&amp;quot;); // Set the exchange pattern to InOut, then send it from direct:inOnly to mock:result endpoint from(&amp;quot;direct:testSetToInOnlyThenTo&amp;quot;) .setExchangePattern(ExchangePattern.InOnly) .to(&amp;quot;mock:result&amp;quot;); from(&amp;quot;direct:testSetToInOutThenTo&amp;quot;) .setExchangePattern(ExchangePattern.InOut) .to(&amp;quot;mock:result&amp;quot;); // Or we can pass the pattern as a parameter to the to() method from(&amp;quot;direct:testToWithInOnlyParam&amp;quot;).to(ExchangePattern.InOnly, &amp;quot;mock:result&amp;quot;); from(&amp;quot;direct:testToWithInOutParam&amp;quot;).to(ExchangePattern.InOut, &amp;quot;mock:result&amp;quot;); from(&amp;quot;direct:testToWithRobustInOnlyParam&amp;quot;).to(ExchangePattern.RobustInOnly, &amp;quot;mock:result&amp;quot;); // Set the exchange pattern to InOut, then send it on from(&amp;quot;direct:testSetExchangePatternInOnly&amp;quot;) .setExchangePattern(ExchangePattern.InOnly).to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;!-- Send the exchange as InOnly --&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:testInOut&amp;quot;/&amp;gt; &amp;lt;inOut uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;!-- Send the exchange as InOnly --&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:testInOnly&amp;quot;/&amp;gt; &amp;lt;inOnly uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;!-- lets set the exchange pattern then send it on --&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:testSetToInOnlyThenTo&amp;quot;/&amp;gt; &amp;lt;setExchangePattern pattern=&amp;quot;InOnly&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:testSetToInOutThenTo&amp;quot;/&amp;gt; &amp;lt;setExchangePattern pattern=&amp;quot;InOut&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:testSetExchangePatternInOnly&amp;quot;/&amp;gt; &amp;lt;setExchangePattern pattern=&amp;quot;InOnly&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;!-- Lets pass the pattern as an argument in the to element --&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:testToWithInOnlyParam&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot; pattern=&amp;quot;InOnly&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:testToWithInOutParam&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot; pattern=&amp;quot;InOut&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:testToWithRobustInOnlyParam&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot; pattern=&amp;quot;RobustInOnly&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-UsingThisPattern.12">Using This Pattern</h4><p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-CorrelationIdentifier">Correlation Identifier</h3><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/CorrelationIdentifier.html" rel="nofollow">Correlation Identifier</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> by getting or setting a header on a <a shape="rect" href="message.html">Message</a>.</p><p>When working with the <a shape="rect" href="activemq.html">ActiveMQ</a> or <a shape="rect" href="jms.html">JMS</a> components the correlation identifier header is called <strong>JMSCorrelationID</strong>. You can add your own correlation identifier to any message exchange to help correlate messages together to a single conversation (or business process).</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/CorrelationIdentifierSolution.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/CorrelationIdentifierSolution.gif"></span></p><p>The use of a Correlation Identifier is key to working with the <a shape="rect" href="bam.html">Camel Business Activity Monitoring Framework</a> and can also be highly useful when testing with simulation or canned data such as with the <a shape="rect" href="mock.html">Mock testing framework</a></p><p>Some <a shape="rect" href="eip.html">EIP</a> patterns will spin off a sub message, and in those cases, Camel will add a correlation id on the <a shape="rect" href="exchange.html">Exchange</a> as a property with they key <code>Exchange.CORRELATION_ID</code>, which links back to the source <a shape="rect" href="exchange.html">Exchange</a>. For example the <a shape="rect" href="splitter.html">Splitter</a>, <a shape="rect" href="multicast.html">Multicast</a>, <a shape="rect" href="recipient-list.html">Recipient List</a>, and <a shape="rect" href="wire-tap.html">Wire Tap</a> EIP does this.</p><p>The following example demonstrates using the Camel JMSMessageID as the Correlation Identifier within a request/reply pattern in the&#160;<a shape="rect" href="jms.html">JMS</a>&#160;component</p><p><strong>Using the&#160;<a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .to(ExchangePattern.InOut,&amp;quot;jms:queue:foo?useMessageIDAsCorrelationID=true&amp;quot;) .to(&amp;quot;mock:result&amp;quot;);</script> 
 </div>
</div><p>&#160;</p><p><strong><strong>Using the&#160;<a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;jms:queue:foo?useMessageIDAsCorrelationID=true&amp;quot; pattern=&amp;quot;InOut&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt;</script> 
 </div>
</div><h4 id="BookInOnePage-SeeAlso.10">See Also</h4><ul><li><a shape="rect" href="bam.html">BAM</a></li></ul><h2 id="BookInOnePage-ReturnAddress">Return Address</h2><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/ReturnAddress.html" rel="nofollow">Return Address</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> by using the <code>JMSReplyTo</code> header.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/ReturnAddressSolution.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/ReturnAddressSolution.gif"></span></p><p>For example when using <a shape="rect" href="jms.html">JMS</a> with InOut the component will by default return to the address given in <code>JMSReplyTo</code>.</p><p><strong>Requestor Code</strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> getMockEndpoint(&amp;quot;mock:bar&amp;quot;).expectedBodiesReceived(&amp;quot;Bye World&amp;quot;); template.sendBodyAndHeader(&amp;quot;direct:start&amp;quot;, &amp;quot;World&amp;quot;, &amp;quot;JMSReplyTo&amp;quot;, &amp;quot;queue:bar&amp;quot;); </script> 
 </div>
</div><p><strong>Route Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;).to(&amp;quot;activemq:queue:foo?preserveMessageQos=true&amp;quot;); from(&amp;quot;activemq:queue:foo&amp;quot;).transform(body().prepend(&amp;quot;Bye &amp;quot;)); from(&amp;quot;activemq:queue:bar?disableReplyTo=true&amp;quot;).to(&amp;quot;mock:bar&amp;quot;); </script> 
 </div>
</div><p><strong>Route Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;activemq:queue:foo?preserveMessageQos=true&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:queue:foo&amp;quot;/&amp;gt; &amp;lt;transform&amp;gt; &amp;lt;simple&amp;gt;Bye ${in.body}&amp;lt;/simple&amp;gt; &amp;lt;/transform&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:queue:bar?disableReplyTo=true&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:bar&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>For a complete example of this pattern, see this <a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/components/camel-jms/src/test/java/org/apache/camel/component/jms/JmsInOnlyWithReplyToAsHeaderTest.java?view=markup">junit test case</a></p><h4 id="BookInOnePage-UsingThisPattern.13">Using This Pattern</h4><p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h2 id="BookInOnePage-MessageRouting.1">Message Routing</h2><h3 id="BookInOnePage-ContentBasedRouter">Content Based Router</h3><p>The <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/ContentBasedRouter.html" rel="nofollow">Content Based Router</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> allows you to route messages to the correct destination based on the contents of the message exchanges.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/ContentBasedRouter.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/ContentBasedRouter.gif"></span></p><p>The following example shows how to route a request from an input <strong>seda:a</strong> endpoint to either <strong>seda:b</strong>, <strong>seda:c</strong> or <strong>seda:d</strong> depending on the evaluation of various <a shape="rect" href="predicate.html">Predicate</a> expressions</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><p>&#160;</p><p><strong><br clear="none"></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">RouteBuilder builder = new RouteBuilder() { public void configure() { errorHandler(deadLetterChannel(&amp;quot;mock:error&amp;quot;)); from(&amp;quot;direct:a&amp;quot;) .choice() .when(header(&amp;quot;foo&amp;quot;).isEqualTo(&amp;quot;bar&amp;quot;)) .to(&amp;quot;direct:b&amp;quot;) .when(header(&amp;quot;foo&amp;quot;).isEqualTo(&amp;quot;cheese&amp;quot;)) .to(&amp;quot;direct:c&amp;quot;) .otherwise() .to(&amp;quot;direct:d&amp;quot;); } };</script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>See <a shape="rect" href="why-can-i-not-use-when-or-otherwise-in-a-java-camel-route.html">Why can I not use when or otherwise in a Java Camel route</a> if you have problems with the Java DSL, accepting using <code>when</code> or <code>otherwise</code>.</p>
 </div>
</div><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><div class="line number1 index0 alt2">
 <p>&#160;</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext errorHandlerRef=&amp;quot;errorHandler&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:a&amp;quot;/&amp;gt; &amp;lt;choice&amp;gt; &amp;lt;when&amp;gt; &amp;lt;xpath&amp;gt;$foo = &amp;#39;bar&amp;#39;&amp;lt;/xpath&amp;gt; &amp;lt;to uri=&amp;quot;direct:b&amp;quot;/&amp;gt; &amp;lt;/when&amp;gt; &amp;lt;when&amp;gt; &amp;lt;xpath&amp;gt;$foo = &amp;#39;cheese&amp;#39;&amp;lt;/xpath&amp;gt; &amp;lt;to uri=&amp;quot;direct:c&amp;quot;/&amp;gt; &amp;lt;/when&amp;gt; &amp;lt;otherwise&amp;gt; &amp;lt;to uri=&amp;quot;direct:d&amp;quot;/&amp;gt; &amp;lt;/otherwise&amp;gt; &amp;lt;/choice&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt;</script> 
  </div>
 </div>
 <p><span style="line-height: 1.4285715;">For further examples of this pattern in use you could look at the </span><a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/ChoiceTest.java?view=markup" style="line-height: 1.4285715;">junit test case</a></p>
</div><p></p><h4 id="BookInOnePage-UsingThisPattern.14">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-MessageFilter">Message Filter</h3><p>The <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/Filter.html" rel="nofollow">Message Filter</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> allows you to filter messages</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/MessageFilter.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/MessageFilter.gif"></span></p><p>The following example shows how to create a Message Filter route consuming messages from an endpoint called <strong>queue:a</strong>, which if the <a shape="rect" href="predicate.html">Predicate</a> is true will be dispatched to <strong>queue:b</strong></p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> RouteBuilder builder = new RouteBuilder() { public void configure() { errorHandler(deadLetterChannel(&amp;quot;mock:error&amp;quot;)); from(&amp;quot;direct:a&amp;quot;) .filter(header(&amp;quot;foo&amp;quot;).isEqualTo(&amp;quot;bar&amp;quot;)) .to(&amp;quot;direct:b&amp;quot;); } }; </script> 
 </div>
</div><p>You can, of course, use many different <a shape="rect" href="predicate.html">Predicate</a> languages such as <a shape="rect" href="xpath.html">XPath</a>, <a shape="rect" href="xquery.html">XQuery</a>, <a shape="rect" href="sql.html">SQL</a> or various <a shape="rect" href="scripting-languages.html">Scripting Languages</a>. Here is an <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/XPathFilterTest.java">XPath example</a></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;). filter().xpath(&amp;quot;/person[@name=&amp;#39;James&amp;#39;]&amp;quot;). to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>Here is another example of using a bean to define the filter behavior</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .filter().method(MyBean.class, &amp;quot;isGoldCustomer&amp;quot;).to(&amp;quot;mock:result&amp;quot;).end() .to(&amp;quot;mock:end&amp;quot;); public static class MyBean { public boolean isGoldCustomer(@Header(&amp;quot;level&amp;quot;) String level) { return level.equals(&amp;quot;gold&amp;quot;); } } </script> 
 </div>
</div><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext errorHandlerRef=&amp;quot;errorHandler&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:a&amp;quot;/&amp;gt; &amp;lt;filter&amp;gt; &amp;lt;xpath&amp;gt;$foo = &amp;#39;bar&amp;#39;&amp;lt;/xpath&amp;gt; &amp;lt;to uri=&amp;quot;direct:b&amp;quot;/&amp;gt; &amp;lt;/filter&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><p>You can also use a method call expression (to call a method on a bean) in the Message Filter, as shown below:</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd">
     <div class="container">
      <div class="line number1 index0 alt2">
       &lt;bean id="myBean" class="com.foo.MyBean"/&gt;
      </div>
      <div class="line number1 index0 alt2">
       <code class="xml plain">&lt;</code>
       <code class="xml keyword">camelContext</code>
       <code class="xml plain"> xmlns="<a shape="rect" class="external-link" href="http://camel.apache.org/schema/spring%22">http://camel.apache.org/schema/spring"</a>&gt;</code>
      </div>
      <div class="line number2 index1 alt1">
       <code class="xml spaces">&#160;&#160;&#160;&#160;</code>
       <code class="xml plain">&lt;</code>
       <code class="xml keyword">route</code>
       <code class="xml plain">&gt;</code>
      </div>
      <div class="line number3 index2 alt2">
       <code class="xml spaces">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</code>
       <code class="xml plain">&lt;</code>
       <code class="xml keyword">from</code> 
       <code class="xml plain">uri="<a shape="rect" class="external-link" href="http://directa%22/" rel="nofollow">direct:a"/</a>&gt;</code>
      </div>
      <div class="line number4 index3 alt1">
       <code class="xml spaces">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</code>
       <code class="xml plain">&lt;</code>
       <code class="xml keyword">filter</code>
       <code class="xml plain">&gt;</code>
      </div>
      <div class="line number5 index4 alt2">
       <code class="xml spaces">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</code>
       <code class="xml plain">&lt;</code>
       <code class="xml keyword">method ref="myBean" method="isGoldCustomer"/</code>
       <code class="xml plain">&gt;</code>
      </div>
      <div class="line number6 index5 alt1">
       <code class="xml spaces">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</code>
       <code class="xml plain">&lt;</code>
       <code class="xml keyword">to</code> 
       <code class="xml plain">uri="<a shape="rect" class="external-link" href="http://directb%22/" rel="nofollow">direct:b"/</a>&gt;</code>
      </div>
      <div class="line number7 index6 alt2">
       <code class="xml spaces">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</code>
       <code class="xml plain">&lt;/</code>
       <code class="xml keyword">filter</code>
       <code class="xml plain">&gt;</code>
      </div>
      <div class="line number8 index7 alt1">
       <code class="xml spaces">&#160;&#160;&#160;&#160;</code>
       <code class="xml plain">&lt;/</code>
       <code class="xml keyword">route</code>
       <code class="xml plain">&gt;</code>
      </div>
      <div class="line number9 index8 alt2">
       <code class="xml plain">&lt;/</code>
       <code class="xml keyword">camelContext</code>
       <code class="xml plain">&gt;</code>
      </div>
      <div>
       <code class="xml plain"><br clear="none"></code>
      </div>
     </div></td></tr></tbody></table>
</div><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">filtered endpoint required inside &lt;/filter&gt; tag</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>make sure you put the endpoint you want to filter (&lt;to uri="seda:b"/&gt;, etc.) before the closing &lt;/filter&gt; tag or the filter will not be applied (in 2.8+, omitting this will result in an error)</p>
 </div>
</div><p>For further examples of this pattern in use you could look at the <a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/FilterTest.java?view=markup">junit test case</a></p><h4 id="BookInOnePage-Usingstop"><span style="line-height: 1.5;">Using stop</span><strong style="line-height: 1.4285715;"><br clear="none"></strong></h4><p>Stop is a bit different than a message filter as it will filter out all messages and end the route entirely (filter only applies to its child processor). Stop is convenient to use in a <a shape="rect" href="content-based-router.html">Content Based Router</a> when you for example need to stop further processing in one of the predicates.</p><p>In the example below we do not want to route messages any further that has the word <code>Bye</code> in the message body. Notice how we prevent this in the when predicate by using the <code>.stop()</code>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) .choice() .when(body().contains(&amp;quot;Hello&amp;quot;)).to(&amp;quot;mock:hello&amp;quot;) .when(body().contains(&amp;quot;Bye&amp;quot;)).to(&amp;quot;mock:bye&amp;quot;).stop() .otherwise().to(&amp;quot;mock:other&amp;quot;) .end() .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-Knowingifwasfilteredornot">Knowing if <a shape="rect" href="exchange.html">Exchange</a> was filtered or not</h4><p><strong>Available as of Camel 2.5</strong></p><p>The <a shape="rect" href="message-filter.html">Message Filter</a> EIP will add a property on the <a shape="rect" href="exchange.html">Exchange</a> that states if it was filtered or not.</p><p>The property has the key <code>Exchange.FILTER_MATCHED</code>, which has the String value of <code>CamelFilterMatched</code>. Its value is a boolean indicating <code>true</code> or <code>false</code>. If the value is <code>true</code> then the <a shape="rect" href="exchange.html">Exchange</a> was routed in the filter block. This property will be visible within the <a shape="rect" href="message-filter.html">Message Filter</a> block who's <a shape="rect" href="predicate.html">Predicate</a> matches (value set to <code>true</code>), and to the steps immediately following the <a shape="rect" href="message-filter.html">Message Filter</a> with the value set based on the results of the last <a shape="rect" href="message-filter.html">Message Filter</a> <a shape="rect" href="predicate.html">Predicate</a> evaluated.</p><p></p><h4 id="BookInOnePage-UsingThisPattern.15">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h2 id="BookInOnePage-DynamicRouter">Dynamic Router</h2><p>The <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/DynamicRouter.html" rel="nofollow">Dynamic Router</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> allows you to route messages while avoiding the dependency of the router on all possible destinations while maintaining its efficiency.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/DynamicRouter.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/DynamicRouter.gif"></span></p><p>In <strong>Camel 2.5</strong> we introduced a <code>dynamicRouter</code> in the DSL which is like a dynamic <a shape="rect" href="routing-slip.html">Routing Slip</a> which evaluates the slip <em>on-the-fly</em>.</p><div class="confluence-information-macro confluence-information-macro-warning">
 <p class="title">Beware</p>
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>You must ensure the expression used for the <code>dynamicRouter</code> such as a bean, will return <code>null</code> to indicate the end. Otherwise the <code>dynamicRouter</code> will keep repeating endlessly.</p>
 </div>
</div><h3 id="BookInOnePage-Options.9">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default Value </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>uriDelimiter</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>,</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Delimiter used if the <a shape="rect" href="expression.html">Expression</a> returned multiple endpoints. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>ignoreInvalidEndpoints</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> If an endpoint uri could not be resolved, should it be ignored. Otherwise Camel will thrown an exception stating the endpoint uri is not valid. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>cacheSize</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>1000</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.13.1/2.12.4:</strong> Allows to configure the cache size for the <code>ProducerCache</code> which caches producers for reuse in the routing slip. Will by default use the default cache size which is 1000. Setting the value to -1 allows to turn off the cache all together. </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-DynamicRouterinCamel2.5onwards">Dynamic Router in Camel 2.5 onwards</h3><p>From Camel 2.5 the <a shape="rect" href="dynamic-router.html">Dynamic Router</a> will set a property (Exchange.SLIP_ENDPOINT) on the <a shape="rect" href="exchange.html">Exchange</a> which contains the current endpoint as it advanced though the slip. This allows you to know how far we have processed in the slip. (It's a slip because the <a shape="rect" href="dynamic-router.html">Dynamic Router</a> implementation is based on top of <a shape="rect" href="routing-slip.html">Routing Slip</a>).</p><h4 id="BookInOnePage-JavaDSL.2">Java DSL</h4><p>In Java DSL you can use the <code>dynamicRouter</code> as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) // use a bean as the dynamic router .dynamicRouter(method(DynamicRouterTest.class, &amp;quot;slip&amp;quot;)); </script> 
 </div>
</div><p>Which will leverage a <a shape="rect" href="bean.html">Bean</a> to compute the slip <em>on-the-fly</em>, which could be implemented as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> /** * Use this method to compute dynamic where we should route next. * * @param body the message body * @return endpoints to go, or &amp;lt;tt&amp;gt;null&amp;lt;/tt&amp;gt; to indicate the end */ public String slip(String body) { bodies.add(body); invoked++; if (invoked == 1) { return &amp;quot;mock:a&amp;quot;; } else if (invoked == 2) { return &amp;quot;mock:b,mock:c&amp;quot;; } else if (invoked == 3) { return &amp;quot;direct:foo&amp;quot;; } else if (invoked == 4) { return &amp;quot;mock:result&amp;quot;; } // no more so return null return null; } </script> 
 </div>
</div><p>Mind that this example is only for show and tell. The current implementation is not thread safe. You would have to store the state on the <a shape="rect" href="exchange.html">Exchange</a>, to ensure thread safety, as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> /** * Use this method to compute dynamic where we should route next. * * @param body the message body * @param properties the exchange properties where we can store state between invocations * @return endpoints to go, or &amp;lt;tt&amp;gt;null&amp;lt;/tt&amp;gt; to indicate the end */ public String slip(String body, @Properties Map&amp;lt;String, Object&amp;gt; properties) { bodies.add(body); // get the state from the exchange properties and keep track how many times // we have been invoked int invoked = 0; Object current = properties.get(&amp;quot;invoked&amp;quot;); if (current != null) { invoked = Integer.valueOf(current.toString()); } invoked++; // and store the state back on the properties properties.put(&amp;quot;invoked&amp;quot;, invoked); if (invoked == 1) { return &amp;quot;mock:a&amp;quot;; } else if (invoked == 2) { return &amp;quot;mock:b,mock:c&amp;quot;; } else if (invoked == 3) { return &amp;quot;direct:foo&amp;quot;; } else if (invoked == 4) { return &amp;quot;mock:result&amp;quot;; } // no more so return null return null; } </script> 
 </div>
</div><p>You could also store state as message headers, but they are not guaranteed to be preserved during routing, where as properties on the <a shape="rect" href="exchange.html">Exchange</a> are. Although there was a bug in the method call expression, see the warning below.</p><div class="confluence-information-macro confluence-information-macro-warning">
 <p class="title">Using beans to store state</p>
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Mind that in Camel 2.9.2 or older, when using a <a shape="rect" href="bean.html">Bean</a> the state is not propagated, so you will have to use a <a shape="rect" href="processor.html">Processor</a> instead. This is fixed in Camel 2.9.3 onwards.</p>
 </div>
</div><h4 id="BookInOnePage-SpringXML.1">Spring XML</h4><p>The same example in Spring XML would be:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;mySlip&amp;quot; class=&amp;quot;org.apache.camel.processor.DynamicRouterTest&amp;quot;/&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;dynamicRouter&amp;gt; &amp;lt;!-- use a method call on a bean as dynamic router --&amp;gt; &amp;lt;method ref=&amp;quot;mySlip&amp;quot; method=&amp;quot;slip&amp;quot;/&amp;gt; &amp;lt;/dynamicRouter&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:foo&amp;quot;/&amp;gt; &amp;lt;transform&amp;gt;&amp;lt;constant&amp;gt;Bye World&amp;lt;/constant&amp;gt;&amp;lt;/transform&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-@DynamicRouterannotation">@DynamicRouter annotation</h4><p>You can also use the <code>@DynamicRouter</code> annotation, for example the Camel 2.4 example below could be written as follows. The <code>route</code> method would then be invoked repeatedly as the message is processed dynamically. The idea is to return the next endpoint uri where to go. Return <code>null</code> to indicate the end. You can return multiple endpoints if you like, just as the <a shape="rect" href="routing-slip.html">Routing Slip</a>, where each endpoint is separated by a delimiter.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public class MyDynamicRouter { @Consume(uri = &amp;quot;activemq:foo&amp;quot;) @DynamicRouter public String route(@XPath(&amp;quot;/customer/id&amp;quot;) String customerId, @Header(&amp;quot;Location&amp;quot;) String location, Document body) { // query a database to find the best match of the endpoint based on the input parameteres // return the next endpoint uri, where to go. Return null to indicate the end. } } </script> 
 </div>
</div><h3 id="BookInOnePage-DynamicRouterinCamel2.4orolder">Dynamic Router in Camel 2.4 or older</h3><p>The simplest way to implement this is to use the <a shape="rect" href="recipientlist-annotation.html">RecipientList Annotation</a> on a Bean method to determine where to route the message.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public class MyDynamicRouter { @Consume(uri = &amp;quot;activemq:foo&amp;quot;) @RecipientList public List&amp;lt;String&amp;gt; route(@XPath(&amp;quot;/customer/id&amp;quot;) String customerId, @Header(&amp;quot;Location&amp;quot;) String location, Document body) { // query a database to find the best match of the endpoint based on the input parameteres ... } } </script> 
 </div>
</div><p>In the above we can use the <a shape="rect" href="parameter-binding-annotations.html">Parameter Binding Annotations</a> to bind different parts of the <a shape="rect" href="message.html">Message</a> to method parameters or use an <a shape="rect" href="expression.html">Expression</a> such as using <a shape="rect" href="xpath.html">XPath</a> or <a shape="rect" href="xquery.html">XQuery</a>.</p><p>The method can be invoked in a number of ways as described in the <a shape="rect" href="bean-integration.html">Bean Integration</a> such as</p><ul><li><a shape="rect" href="pojo-producing.html">POJO Producing</a></li><li><a shape="rect" href="spring-remoting.html">Spring Remoting</a></li><li><a shape="rect" href="bean.html">Bean</a> component</li></ul><p></p><h4 id="BookInOnePage-UsingThisPattern.16">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-RecipientList">Recipient List</h3><p>The <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/RecipientList.html" rel="nofollow">Recipient List</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> allows you to route messages to a number of dynamically specified recipients.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/RecipientList.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/RecipientList.gif"></span></p><p>The recipients will receive a copy of the <strong>same</strong> <a shape="rect" href="exchange.html">Exchange</a>, and Camel will execute them sequentially.</p><h3 id="BookInOnePage-Options.10">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>delimiter</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>,</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Delimiter used if the <a shape="rect" href="expression.html">Expression</a> returned multiple endpoints (like "<span style="color: rgb(0,0,0);">direct:foo,direct:bar"</span>). From <strong>Camel 2.13</strong> onwards this can be disabled by setting delimiter to "false".</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>strategyRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>An <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/aggregate/AggregationStrategy.html">AggregationStrategy</a> that will assemble the replies from recipients into a single outgoing message from the <a shape="rect" href="recipient-list.html">Recipient List</a>. By default Camel will use the last reply as the outgoing message. From <strong>Camel 2.12</strong> onwards you can also use a POJO as the <code>AggregationStrategy</code>, see the <a shape="rect" href="aggregator2.html">Aggregator</a> page for more details. If an exception is thrown from the aggregate method in the AggregationStrategy, then by default, that exception&#160;is not handled by the error handler. The error handler can be enabled to react if enabling the shareUnitOfWork option.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>strategyMethodName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> This option can be used to explicitly declare the method name to use, when using POJOs as the <code>AggregationStrategy</code>. See the <a shape="rect" href="aggregator2.html">Aggregator</a><span>&#160;</span>page for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>strategyMethodAllowNull</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> If this option is <code>false</code> then the aggregate method is not used if there was no data to enrich. If this option is <code>true</code> then <code>null</code> is used as the <code>oldExchange</code> (when no data to enrich), when using POJOs as the <code>AggregationStrategy</code>. See the <a shape="rect" href="aggregator2.html">Aggregator</a> page for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>parallelProcessing</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.2:</strong> If enabled, messages are sent to the recipients concurrently. Note that the calling thread will still wait until all messages have been fully processed before it continues; it is the sending and processing of replies from recipients which happens in parallel.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>parallelAggregate</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.14:</strong> If enabled then the <code>aggregate</code> method on <code>AggregationStrategy</code> can be called concurrently. Notice that this would require the implementation of <code>AggregationStrategy</code> to be implemented as thread-safe. By default this is <code>false</code> meaning that Camel synchronizes the call to the <code>aggregate</code> method. Though in some use-cases this can be used to archive higher performance when the <code>AggregationStrategy</code> is implemented as thread-safe.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>executorServiceRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.2:</strong> A custom <a shape="rect" href="threading-model.html">Thread Pool</a> to use for parallel processing. Note that enabling this option implies parallel processing, so you need not enable that option as well.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>stopOnException</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.2:</strong> Whether to immediately stop processing when an exception occurs. If disabled, Camel will send the message to all recipients regardless of any individual failures. You can process exceptions in an <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/aggregate/AggregationStrategy.html">AggregationStrategy</a> implementation, which supports full control of error handling.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ignoreInvalidEndpoints</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> Whether to ignore an endpoint URI that could not be resolved. If disabled, Camel will throw an exception identifying the invalid endpoint URI.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>streaming</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> If enabled, Camel will process replies out-of-order - that is, in the order received in reply from each recipient. If disabled, Camel will process replies in the same order as specified by the <a shape="rect" href="expression.html">Expression</a>. <span style="color: rgb(0,0,0);">So this specifies whether the response messages are aggregated as they come in, or</span><span> i</span><span style="color: rgb(0,0,0);">n the exact order as the recipient list was evaluated. </span>Only relevant if you enable parallelProcessing.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>timeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> Specifies a processing timeout in milliseconds. If the <a shape="rect" href="recipient-list.html">Recipient List</a> hasn't been able to send and process all replies within this timeframe, then the timeout triggers and the <a shape="rect" href="recipient-list.html">Recipient List</a> breaks out, with message flow continuing to the next element. Note that if you provide a <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/aggregate/TimeoutAwareAggregationStrategy.html">TimeoutAwareAggregationStrategy</a>, its <code>timeout</code> method is invoked before breaking out. <strong>Beware:</strong> If the timeout is reached with running tasks still remaining, certain tasks (for which it is difficult for Camel to shut down in a graceful manner) may continue to run. So use this option with caution. We may be able to improve this functionality in future Camel releases.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>onPrepareRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> A custom <a shape="rect" href="processor.html">Processor</a> to prepare the copy of the <a shape="rect" href="exchange.html">Exchange</a> each recipient will receive. This allows you to perform arbitrary transformations, such as deep-cloning the message payload (or any other custom logic).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>shareUnitOfWork</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> Whether the unit of work should be shared. See <a shape="rect" href="splitter.html#Splitter-Sharingunitofwork">the same option on Splitter</a> for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cacheSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.13.1/2.12.4:</strong> Allows to configure the cache size for the <code>ProducerCache</code> which caches producers for reuse in the recipient list. Will by default use the default cache size which is 1000. Setting the value to -1 allows to turn off the cache completely.</p></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-StaticRecipientList">Static Recipient List</h4><p>The following example shows how to route a request from an input <strong>queue:a</strong> endpoint to a static list of destinations</p><p><strong>Using Annotations</strong><br clear="none"> You can use the <a shape="rect" href="recipientlist-annotation.html">RecipientList Annotation</a> on a POJO to create a Dynamic Recipient List. For more details see the <a shape="rect" href="bean-integration.html">Bean Integration</a>.</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong>
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> RouteBuilder builder = new RouteBuilder() { public void configure() { errorHandler(deadLetterChannel(&amp;quot;mock:error&amp;quot;)); from(&amp;quot;direct:a&amp;quot;) .multicast().to(&amp;quot;direct:b&amp;quot;, &amp;quot;direct:c&amp;quot;, &amp;quot;direct:d&amp;quot;); } }; </script> 
  </div>
 </div><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext errorHandlerRef=&amp;quot;errorHandler&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:a&amp;quot;/&amp;gt; &amp;lt;multicast&amp;gt; &amp;lt;to uri=&amp;quot;direct:b&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:c&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:d&amp;quot;/&amp;gt; &amp;lt;/multicast&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
  </div>
 </div><h4 id="BookInOnePage-DynamicRecipientList">Dynamic Recipient List</h4><p>Usually one of the main reasons for using the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/RecipientList.html" rel="nofollow">Recipient List</a> pattern is that the list of recipients is dynamic and calculated at runtime. The following example demonstrates how to create a dynamic recipient list using an <a shape="rect" href="expression.html">Expression</a> (which in this case extracts a named header value dynamically) to calculate the list of endpoints which are either of type <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Endpoint.html">Endpoint</a> or are converted to a String and then resolved using the endpoint <a shape="rect" href="uris.html">URIs</a>.</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong>
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> RouteBuilder builder = new RouteBuilder() { public void configure() { errorHandler(deadLetterChannel(&amp;quot;mock:error&amp;quot;)); from(&amp;quot;direct:a&amp;quot;) .recipientList(header(&amp;quot;foo&amp;quot;)); } }; </script> 
  </div>
 </div>The above assumes that the header contains a list of endpoint URIs. The following takes a single string header and tokenizes it
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:a&amp;quot;).recipientList( header(&amp;quot;recipientListHeader&amp;quot;).tokenize(&amp;quot;,&amp;quot;)); </script> 
  </div>
 </div><h5 id="BookInOnePage-Iteratablevalue">Iteratable value</h5><p>The dynamic list of recipients that are defined in the header must be iterable such as:</p><ul class="alternate"><li><code>java.util.Collection</code></li><li><code>java.util.Iterator</code></li><li>arrays</li><li><code>org.w3c.dom.NodeList</code></li><li>a single String with values separated by comma</li><li>any other type will be regarded as a single value</li></ul><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong>
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext errorHandlerRef=&amp;quot;errorHandler&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:a&amp;quot;/&amp;gt; &amp;lt;recipientList&amp;gt; &amp;lt;xpath&amp;gt;$foo&amp;lt;/xpath&amp;gt; &amp;lt;/recipientList&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
  </div>
 </div>For further examples of this pattern in action you could take a look at one of the <a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/RecipientListTest.java?view=markup">junit test cases</a>.<h5 id="BookInOnePage-UsingdelimiterinSpringXML">Using delimiter in Spring XML</h5><p>In Spring DSL you can set the <code>delimiter</code> attribute for setting a delimiter to be used if the header value is a single String with multiple separated endpoints. By default Camel uses comma as delimiter, but this option lets you specify a custom delimiter to use instead.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:a&amp;quot; /&amp;gt; &amp;lt;!-- use comma as a delimiter for String based values --&amp;gt; &amp;lt;recipientList delimiter=&amp;quot;,&amp;quot;&amp;gt; &amp;lt;header&amp;gt;myHeader&amp;lt;/header&amp;gt; &amp;lt;/recipientList&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div>So if <strong>myHeader</strong> contains a String with the value <code>"activemq:queue:foo, activemq:topic:hello , log:bar"</code> then Camel will split the String using the delimiter given in the XML that was comma, resulting into 3 endpoints to send to. You can use spaces between the endpoints as Camel will trim the value when it lookup the endpoint to send to.<p>Note: In Java DSL you use the <code>tokenizer</code> to achieve the same. The route above in Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:a&amp;quot;).recipientList(header(&amp;quot;myHeader&amp;quot;).tokenize(&amp;quot;,&amp;quot;)); </script> 
 </div>
</div><p>In <strong>Camel 2.1</strong> its a bit easier as you can pass in the delimiter as 2nd parameter:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:a&amp;quot;).recipientList(header(&amp;quot;myHeader&amp;quot;), &amp;quot;#&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-Sendingtomultiplerecipientsinparallel">Sending to multiple recipients in parallel</h3><p><strong>Available as of Camel 2.2</strong></p><p>The <a shape="rect" href="recipient-list.html">Recipient List</a> now supports <code>parallelProcessing</code> that for example <a shape="rect" href="splitter.html">Splitter</a> also supports. You can use it to use a thread pool to have concurrent tasks sending the <a shape="rect" href="exchange.html">Exchange</a> to multiple recipients concurrently.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:a&amp;quot;).recipientList(header(&amp;quot;myHeader&amp;quot;)).parallelProcessing(); </script> 
 </div>
</div><p>And in Spring XML it is an attribute on the recipient list tag.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:a&amp;quot;/&amp;gt; &amp;lt;recipientList parallelProcessing=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;header&amp;gt;myHeader&amp;lt;/header&amp;gt; &amp;lt;/recipientList&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Stopcontinuingincaseonerecipientfailed">Stop continuing in case one recipient failed</h3><p><strong>Available as of Camel 2.2</strong></p><p>The <a shape="rect" href="recipient-list.html">Recipient List</a> now supports <code>stopOnException</code> that for example <a shape="rect" href="splitter.html">Splitter</a> also supports. You can use it to stop sending to any further recipients in case any recipient failed.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:a&amp;quot;).recipientList(header(&amp;quot;myHeader&amp;quot;)).stopOnException(); </script> 
 </div>
</div><p>And in Spring XML its an attribute on the recipient list tag.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:a&amp;quot;/&amp;gt; &amp;lt;recipientList stopOnException=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;header&amp;gt;myHeader&amp;lt;/header&amp;gt; &amp;lt;/recipientList&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p><strong>Note:</strong> You can combine <code>parallelProcessing</code> and <code>stopOnException</code> and have them both <code>true</code>.</p><h3 id="BookInOnePage-Ignoreinvalidendpoints">Ignore invalid endpoints</h3><p><strong>Available as of Camel 2.3</strong></p><p>The <a shape="rect" href="recipient-list.html">Recipient List</a> now supports <code>ignoreInvalidEndpoints</code> (like the <a shape="rect" href="routing-slip.html">Routing Slip</a>). You can use it to skip endpoints which are invalid.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:a&amp;quot;).recipientList(header(&amp;quot;myHeader&amp;quot;)).ignoreInvalidEndpoints(); </script> 
 </div>
</div><p>And in Spring XML it is an attribute on the recipient list tag.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:a&amp;quot;/&amp;gt; &amp;lt;recipientList ignoreInvalidEndpoints=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;header&amp;gt;myHeader&amp;lt;/header&amp;gt; &amp;lt;/recipientList&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>Then let us say the <code>myHeader</code> contains the following two endpoints <code>direct:foo,xxx:bar</code>. The first endpoint is valid and works. However the second one is invalid and will just be ignored. Camel logs at INFO level about it, so you can see why the endpoint was invalid.</p><h3 id="BookInOnePage-UsingcustomAggregationStrategy">Using custom <code>AggregationStrategy</code></h3><p><strong>Available as of Camel 2.2</strong></p><p>You can now use your own <code>AggregationStrategy</code> with the <a shape="rect" href="recipient-list.html">Recipient List</a>. However this is rarely needed. What it is good for is that in case you are using <a shape="rect" href="request-reply.html">Request Reply</a> messaging then the replies from the recipients can be aggregated. By default Camel uses <code>UseLatestAggregationStrategy</code> which just keeps that last received reply. If you must remember all the bodies that all the recipients sent back, then you can use your own custom aggregator that keeps those. It is the same principle as with the <a shape="rect" href="aggregator.html">Aggregator</a> EIP so check it out for details.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:a&amp;quot;) .recipientList(header(&amp;quot;myHeader&amp;quot;)).aggregationStrategy(new MyOwnAggregationStrategy()) .to(&amp;quot;direct:b&amp;quot;); </script> 
 </div>
</div><p>And in Spring XML it is again an attribute on the recipient list tag.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:a&amp;quot;/&amp;gt; &amp;lt;recipientList strategyRef=&amp;quot;myStrategy&amp;quot;&amp;gt; &amp;lt;header&amp;gt;myHeader&amp;lt;/header&amp;gt; &amp;lt;/recipientList&amp;gt; &amp;lt;to uri=&amp;quot;direct:b&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;bean id=&amp;quot;myStrategy&amp;quot; class=&amp;quot;com.mycompany.MyOwnAggregationStrategy&amp;quot;/&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-KnowingwhichendpointwhenusingcustomAggregationStrategy">Knowing which endpoint when using custom <code>AggregationStrategy</code></h4><p><strong>Available as of Camel 2.12</strong></p><p>When using a custom <code>AggregationStrategy</code> then the <code>aggregate</code> method is always invoked in sequential order (also if parallel processing is enabled) of the endpoints the <a shape="rect" href="recipient-list.html">Recipient List</a> is using. However from Camel 2.12 onwards this is easier to know as the <code>newExchange</code> <a shape="rect" href="exchange.html">Exchange</a>&#160;now has a property stored (key is <code>Exchange.RECIPIENT_LIST_ENDPOINT</code> with the uri of the <a shape="rect" href="endpoint.html">Endpoint</a>. So you know which endpoint you are aggregating from. The code block shows how to access this property in your <a shape="rect" href="aggregator2.html">Aggregator</a>.&#160;</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> @Override public Exchange aggregate(Exchange oldExchange, Exchange newExchange) { String uri = newExchange.getProperty(Exchange.RECIPIENT_LIST_ENDPOINT, String.class); ... } </script> 
 </div>
</div><h3 id="BookInOnePage-Usingcustomthreadpool">Using custom thread pool</h3><p><strong>Available as of Camel 2.2</strong></p><p>A thread pool is only used for <code>parallelProcessing</code>. You supply your own custom thread pool via the <code>ExecutorServiceStrategy</code> (see Camel's <a shape="rect" href="threading-model.html">Threading Model</a>), the same way you would do it for the <code>aggregationStrategy</code>. By default Camel uses a thread pool with 10 threads (subject to change in future versions).</p><h3 id="BookInOnePage-Usingmethodcallasrecipientlist">Using method call as recipient list</h3><p>You can use a <a shape="rect" href="bean.html">Bean</a> to provide the recipients, for example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:queue:test&amp;quot;).recipientList().method(MessageRouter.class, &amp;quot;routeTo&amp;quot;); </script> 
 </div>
</div><p>And then <code>MessageRouter</code>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public class MessageRouter { public String routeTo() { String queueName = &amp;quot;activemq:queue:test2&amp;quot;; return queueName; } } </script> 
 </div>
</div><p>When you use a <a shape="rect" href="bean.html">Bean</a> then do <strong>not</strong>&#160;use the <code>@RecipientList</code> annotation as this will in fact add yet another recipient list, so you end up having two. Do <strong>not</strong> do the following.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public class MessageRouter { @RecipientList public String routeTo() { String queueName = &amp;quot;activemq:queue:test2&amp;quot;; return queueName; } } </script> 
 </div>
</div><p>You should only use the snippet above (using <code>@RecipientList</code>) if you just route to a <a shape="rect" href="bean.html">Bean</a> which you then want to act as a recipient list.<br clear="none"> So the original route can be changed to:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:queue:test&amp;quot;).bean(MessageRouter.class, &amp;quot;routeTo&amp;quot;); </script> 
 </div>
</div><p>Which then would invoke the routeTo method and detect that it is annotated with <code>@RecipientList</code> and then act accordingly as if it was a recipient list EIP.</p><h3 id="BookInOnePage-Usingtimeout">Using timeout</h3><p><strong>Available as of Camel 2.5</strong></p><p>If you use <code>parallelProcessing</code> then you can configure a total <code>timeout</code> value in millis. Camel will then process the messages in parallel until the timeout is hit. This allows you to continue processing if one message consumer is slow. For example you can set a timeout value of 20 sec.</p><div class="confluence-information-macro confluence-information-macro-warning">
 <p class="title">Tasks may keep running</p>
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>If the timeout is reached with running tasks still remaining, certain tasks for which it is difficult for Camel to shut down in a graceful manner may continue to run. So use this option with a bit of care. We may be able to improve this functionality in future Camel releases.</p>
 </div>
</div><p>For example in the unit test below you can see that we multicast the message to 3 destinations. We have a timeout of 2 seconds, which means only the last two messages can be completed within the timeframe. This means we will only aggregate the last two which yields a result aggregation which outputs <code>"BC"</code>.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) .multicast(new AggregationStrategy() { public Exchange aggregate(Exchange oldExchange, Exchange newExchange) { if (oldExchange == null) { return newExchange; } String body = oldExchange.getIn().getBody(String.class); oldExchange.getIn().setBody(body + newExchange.getIn().getBody(String.class)); return oldExchange; } }) .parallelProcessing().timeout(250).to(&amp;quot;direct:a&amp;quot;, &amp;quot;direct:b&amp;quot;, &amp;quot;direct:c&amp;quot;) // use end to indicate end of multicast route .end() .to(&amp;quot;mock:result&amp;quot;); from(&amp;quot;direct:a&amp;quot;).delay(1000).to(&amp;quot;mock:A&amp;quot;).setBody(constant(&amp;quot;A&amp;quot;)); from(&amp;quot;direct:b&amp;quot;).to(&amp;quot;mock:B&amp;quot;).setBody(constant(&amp;quot;B&amp;quot;)); from(&amp;quot;direct:c&amp;quot;).to(&amp;quot;mock:C&amp;quot;).setBody(constant(&amp;quot;C&amp;quot;)); </script> 
  </div>
 </div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Timeout in other EIPs</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>This <code>timeout</code> feature is also supported by <a shape="rect" href="splitter.html">Splitter</a> and both <code>multicast</code> and <code>recipientList</code>.</p>
 </div>
</div><p>By default if a timeout occurs the <code>AggregationStrategy</code> is not invoked. However you can implement a special version</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>TimeoutAwareAggregationStrategy</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public interface TimeoutAwareAggregationStrategy extends AggregationStrategy { /** * A timeout occurred * * @param oldExchange the oldest exchange (is &amp;lt;tt&amp;gt;null&amp;lt;/tt&amp;gt; on first aggregation as we only have the new exchange) * @param index the index * @param total the total * @param timeout the timeout value in millis */ void timeout(Exchange oldExchange, int index, int total, long timeout); </script> 
 </div>
</div><p>This allows you to deal with the timeout in the <code>AggregationStrategy</code> if you really need to.</p><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Timeout is total</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The timeout is total, which means that after X time, Camel will aggregate the messages which have completed within the timeframe. The remainders will be cancelled. Camel will also only invoke the <code>timeout</code> method in the <code>TimeoutAwareAggregationStrategy</code> once, for the first index which caused the timeout.</p>
 </div>
</div><h3 id="BookInOnePage-UsingonPreparetoexecutecustomlogicwhenpreparingmessages">Using onPrepare to execute custom logic when preparing messages</h3><p><strong>Available as of Camel 2.8</strong></p><p>See details at <a shape="rect" href="multicast.html">Multicast</a></p><h3 id="BookInOnePage-UsingExchangePatterninrecipients">Using ExchangePattern in recipients</h3><p><strong>Available as of Camel 2.15</strong></p><p>The recipient list will by default use the current&#160;<a shape="rect" href="exchange-pattern.html">Exchange Pattern</a>. Though one can imagine use-cases where one wants to send a message to a recipient using a different exchange pattern. For example you may have a route that initiates as an InOnly route, but want to use InOut exchange pattern with a recipient list. To do this in earlier Camel releases, you would need to change the&#160;exchange pattern before the recipient list, or use onPrepare option to alter the pattern. From Camel 2.15 onwards, you can configure the exchange pattern directly in the recipient endpoints.</p><p>For example in the route below we pick up new files (which will be started as InOnly) and then route to a recipient list. As we want to use InOut with the ActiveMQ (JMS) endpoint we can now specify this using the exchangePattern=InOut option. Then the response from the JMS request/reply will then be continued routed, and thus the response is what will be stored in as a file in the outbox directory.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file:inbox&amp;quot;) // the exchange pattern is InOnly initially when using a file route .recipientList().constant(&amp;quot;activemq:queue:inbox?exchangePattern=InOut&amp;quot;) .to(&amp;quot;file:outbox&amp;quot;);</script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-note">
 <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The recipient list will not alter the original exchange pattern. So in the example above the exchange pattern will still be InOnly when the message is routed to the file:outbox endpoint.</p>
  <p>If you want to alter the exchange pattern permanently then use the .setExchangePattern option. See more details at <a shape="rect" href="request-reply.html">Request Reply</a> and <a shape="rect" href="event-message.html">Event Message</a>.</p>
 </div>
</div><p>&#160;</p><p>&#160;</p><p></p><h4 id="BookInOnePage-UsingThisPattern.17">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-Splitter">Splitter</h3><p>The <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/Sequencer.html" rel="nofollow">Splitter</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> allows you split a message into a number of pieces and process them individually</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/Sequencer.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/Sequencer.gif"></span></p><p>You need to specify a Splitter as <code>split()</code>. In earlier versions of Camel, you need to use <code>splitter()</code>.</p><h3 id="BookInOnePage-Options.11">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>strategyRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refers to an <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/aggregate/AggregationStrategy.html">AggregationStrategy</a> to be used to assemble the replies from the sub-messages, into a single outgoing message from the <a shape="rect" href="splitter.html">Splitter</a>. See the defaults described below in <em><a shape="rect" href="#BookInOnePage-WhattheSplitterreturns">What the Splitter returns</a></em>. From <strong>Camel 2.12</strong> onwards you can also use a POJO as the <code>AggregationStrategy</code>, see the <a shape="rect" href="aggregator2.html">Aggregate</a> page for more details. If an exception is thrown from the aggregate method in the AggregationStrategy, then by default, that exception&#160;is not handled by the error handler. The error handler can be enabled to react if enabling the shareUnitOfWork option.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>strategyMethodName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> This option can be used to explicit declare the method name to use, when using POJOs as the <code>AggregationStrategy</code>. See the <a shape="rect" href="aggregator2.html">Aggregate</a> page for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>strategyMethodAllowNull</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> If this option is <code>false</code> then the aggregate method is not used for the very first splitted message. If this option is <code>true</code> then <code>null</code> values is used as the <code>oldExchange</code> (for the very first message splitted), when using POJOs as the <code>AggregationStrategy</code>. See the <a shape="rect" href="aggregator2.html">Aggregate</a> page for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>parallelProcessing</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If enabled then processing the sub-messages occurs concurrently. Note the caller thread will still wait until all sub-messages has been fully processed, before it continues.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>parallelAggregate</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.14:</strong> If enabled then the <code>aggregate</code> method on <code>AggregationStrategy</code> can be called concurrently. Notice that this would require the implementation of <code>AggregationStrategy</code> to be implemented as thread-safe. By default this is <code>false</code> meaning that Camel synchronizes the call to the <code>aggregate</code> method. Though in some use-cases this can be used to achieve higher performance when the <code>AggregationStrategy</code> is implemented as thread-safe.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>executorServiceRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refers to a custom <a shape="rect" href="threading-model.html">Thread Pool</a> to be used for parallel processing. Notice if you set this option, then parallel processing is automatically implied, and you do not have to enable that option as well.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>stopOnException</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.2:</strong> Whether or not to stop continue processing immediately when an exception occurred. If disable, then Camel continue splitting and process the sub-messages regardless if one of them failed. You can deal with exceptions in the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/aggregate/AggregationStrategy.html">AggregationStrategy</a> class where you have full control how to handle that.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>streaming</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If enabled then Camel will split in a streaming fashion, which means it will split the input message in chunks. This reduces the memory overhead. For example if you split big messages its recommended to enable streaming. If streaming is enabled then the sub-message replies will be aggregated out-of-order, eg in the order they come back. If disabled, Camel will process sub-message replies in the same order as they where splitted.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>timeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> Sets a total timeout specified in millis. If the <a shape="rect" href="recipient-list.html">Recipient List</a> hasn't been able to split and process all replies within the given timeframe, then the timeout triggers and the <a shape="rect" href="splitter.html">Splitter</a> breaks out and continues. Notice if you provide a <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/aggregate/TimeoutAwareAggregationStrategy.html">TimeoutAwareAggregationStrategy</a> then the <code>timeout</code> method is invoked before breaking out. If the timeout is reached with running tasks still remaining, certain tasks for which it is difficult for Camel to shut down in a graceful manner may continue to run. So use this option with a bit of care. We may be able to improve this functionality in future Camel releases.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>onPrepareRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> Refers to a custom <a shape="rect" href="processor.html">Processor</a> to prepare the sub-message of the <a shape="rect" href="exchange.html">Exchange</a>, before its processed. This allows you to do any custom logic, such as deep-cloning the message payload if that's needed etc.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>shareUnitOfWork</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> Whether the unit of work should be shared. See further below for more details.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Exchangeproperties">Exchange properties</h3><p>The following properties are set on each Exchange that are split:</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>property</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSplitIndex</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>int</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A split counter that increases for each Exchange being split. The counter starts from 0.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSplitSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>int</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The total number of Exchanges that was splitted. This header is not applied for stream based splitting. From <strong>Camel 2.9</strong> onwards this header is also set in stream based splitting, but only on the completed Exchange.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSplitComplete</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.4:</strong> Whether or not this Exchange is the last.</p></td></tr></tbody></table>
</div><h3 id="BookInOnePage-Examples.8">Examples</h3><p>The following example shows how to take a request from the <strong>direct:a</strong> endpoint the split it into pieces using an <a shape="rect" href="expression.html">Expression</a>, then forward each piece to <strong>direct:b</strong></p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong>
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> RouteBuilder builder = new RouteBuilder() { public void configure() { errorHandler(deadLetterChannel(&amp;quot;mock:error&amp;quot;)); from(&amp;quot;direct:a&amp;quot;) .split(body(String.class).tokenize(&amp;quot;\n&amp;quot;)) .to(&amp;quot;direct:b&amp;quot;); } }; </script> 
  </div>
 </div>The splitter can use any <a shape="rect" href="expression.html">Expression</a> language so you could use any of the <a shape="rect" href="languages-supported.html">Languages Supported</a> such as <a shape="rect" href="xpath.html">XPath</a>, <a shape="rect" href="xquery.html">XQuery</a>, <a shape="rect" href="sql.html">SQL</a> or one of the <a shape="rect" href="scripting-languages.html">Scripting Languages</a> to perform the split. e.g.<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:my.queue&amp;quot;).split(xpath(&amp;quot;//foo/bar&amp;quot;)).convertBodyTo(String.class).to(&amp;quot;file://some/directory&amp;quot;) </script> 
 </div>
</div><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong>
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext errorHandlerRef=&amp;quot;errorHandler&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:a&amp;quot;/&amp;gt; &amp;lt;split&amp;gt; &amp;lt;xpath&amp;gt;/invoice/lineItems&amp;lt;/xpath&amp;gt; &amp;lt;to uri=&amp;quot;direct:b&amp;quot;/&amp;gt; &amp;lt;/split&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
  </div>
 </div>For further examples of this pattern in use you could look at one of the <a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/SplitterTest.java?view=markup">junit test case</a><h3 id="BookInOnePage-SplittingaCollection,IteratororArray">Splitting a Collection, Iterator or Array</h3><p>A common use case is to split a Collection, Iterator or Array from the <span class="confluence-link">message</span>. In the sample below we simply use an&#160;<a shape="rect" href="expression.html">Expression</a> to identify the value to split.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:splitUsingBody&amp;quot;).split(body()).to(&amp;quot;mock:result&amp;quot;); from(&amp;quot;direct:splitUsingHeader&amp;quot;).split(header(&amp;quot;foo&amp;quot;)).to(&amp;quot;mock:result&amp;quot;);&nbsp;</script> 
 </div>
</div><p>In Spring XML you can use the <a shape="rect" href="simple.html">Simple</a> language to identify the value to split.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;split&amp;gt; &amp;lt;simple&amp;gt;${body}&amp;lt;/simple&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/split&amp;gt; &amp;lt;split&amp;gt; &amp;lt;simple&amp;gt;${header.foo}&amp;lt;/simple&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/split&amp;gt; &nbsp;</script> 
 </div>
</div><h3 id="BookInOnePage-UsingTokenizerfrom*">Using Tokenizer from <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a>*</h3><p>You can use the tokenizer expression in the Spring DSL to split bodies or headers using a token. This is a common use-case, so we provided a special <strong>tokenizer</strong> tag for this.<br clear="none"> In the sample below we split the body using a @ as separator. You can of course use comma or space or even a regex pattern, also set regex=true.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;split&amp;gt; &amp;lt;tokenize token=&amp;quot;@&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/split&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
  </div>
 </div><h3 id="BookInOnePage-WhattheSplitterreturns">What the Splitter returns</h3><p><strong>Camel 2.2 or older:</strong><br clear="none"> The <a shape="rect" href="splitter.html">Splitter</a> will by default return the <strong>last</strong> splitted message.</p><p><strong>Camel 2.3 and newer</strong><br clear="none"> The <a shape="rect" href="splitter.html">Splitter</a> will by default return the original input message.</p><p><strong>For all versions</strong><br clear="none"> You can override this by suppling your own strategy as an <code>AggregationStrategy</code>. There is a sample on this page (Split aggregate request/reply sample). Notice its the same strategy as the <a shape="rect" href="aggregator.html">Aggregator</a> supports. This <a shape="rect" href="splitter.html">Splitter</a> can be viewed as having a build in light weight <a shape="rect" href="aggregator.html">Aggregator</a>.</p><h3 id="BookInOnePage-Parallelexecutionofdistinct'parts'">Parallel execution of distinct 'parts'</h3><p>If you want to execute all parts in parallel you can use special notation of <code>split()</code> with two arguments, where the second one is a <strong>boolean</strong> flag if processing should be parallel. e.g.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">XPathBuilder xPathBuilder = new XPathBuilder(&amp;quot;//foo/bar&amp;quot;); from(&amp;quot;activemq:my.queue&amp;quot;).split(xPathBuilder, true).to(&amp;quot;activemq:my.parts&amp;quot;); </script> 
 </div>
</div><p>The boolean option has been refactored into a builder method <code>parallelProcessing</code> so its easier to understand what the route does when we use a method instead of true|false.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">XPathBuilder xPathBuilder = new XPathBuilder(&amp;quot;//foo/bar&amp;quot;); from(&amp;quot;activemq:my.queue&amp;quot;).split(xPathBuilder).parallelProcessing().to(&amp;quot;activemq:my.parts&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-Streambased">Stream based</h3><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Splitting big XML payloads</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The XPath engine in Java and <a shape="rect" href="xquery.html">saxon</a> will load the entire XML content into memory. And thus they are not well suited for very big XML payloads.<br clear="none"> Instead you can use a custom <a shape="rect" href="expression.html">Expression</a> which will iterate the XML payload in a streamed fashion. From Camel 2.9 onwards you can use the Tokenizer language<br clear="none"> which supports this when you supply the start and end tokens. From Camel 2.14, you can use the XMLTokenizer language which is <span>specifically </span>provided for tokenizing XML documents.</p>
 </div>
</div><p>You can split streams by enabling the streaming mode using the <code>streaming</code> builder method.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:streaming&amp;quot;).split(body().tokenize(&amp;quot;,&amp;quot;)).streaming().to(&amp;quot;activemq:my.parts&amp;quot;); </script> 
 </div>
</div><p>You can also supply your custom splitter to use with streaming like this:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">import static org.apache.camel.builder.ExpressionBuilder.beanExpression; from(&amp;quot;direct:streaming&amp;quot;) .split(beanExpression(new MyCustomIteratorFactory(), &amp;quot;iterator&amp;quot;)) .streaming().to(&amp;quot;activemq:my.parts&amp;quot;) </script> 
 </div>
</div><h4 id="BookInOnePage-StreamingbigXMLpayloadsusingTokenizerlanguage">Streaming big XML payloads using Tokenizer language</h4><p>There are two tokenizers that can be used to tokenize an XML payload. The first tokenizer uses the same principle as in the text tokenizer to scan the XML payload and extract a sequence of tokens.</p><p><strong>Available as of Camel 2.9</strong><br clear="none"> If you have a big XML payload, from a file source, and want to split it in streaming mode, then you can use the Tokenizer language with start/end tokens to do this with low memory footprint.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">StAX component</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The Camel <a shape="rect" href="stax.html">StAX</a> component can also be used to split big XML files in a streaming mode. See more details at <a shape="rect" href="stax.html">StAX</a>.</p>
 </div>
</div><p>For example you may have a XML payload structured as follows</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;orders&amp;gt; &amp;lt;order&amp;gt; &amp;lt;!-- order stuff here --&amp;gt; &amp;lt;/order&amp;gt; &amp;lt;order&amp;gt; &amp;lt;!-- order stuff here --&amp;gt; &amp;lt;/order&amp;gt; ... &amp;lt;order&amp;gt; &amp;lt;!-- order stuff here --&amp;gt; &amp;lt;/order&amp;gt; &amp;lt;/orders&amp;gt; </script> 
 </div>
</div><p>Now to split this big file using <a shape="rect" href="xpath.html">XPath</a> would cause the entire content to be loaded into memory. So instead we can use the Tokenizer language to do this as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;file:inbox&amp;quot;) .split().tokenizeXML(&amp;quot;order&amp;quot;).streaming() .to(&amp;quot;activemq:queue:order&amp;quot;); </script> 
 </div>
</div><p>In XML DSL the route would be as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;file:inbox&amp;quot;/&amp;gt; &amp;lt;split streaming=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;tokenize token=&amp;quot;order&amp;quot; xml=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;activemq:queue:order&amp;quot;/&amp;gt; &amp;lt;/split&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>Notice the <code>tokenizeXML</code> method which will split the file using the tag name of the child node (more precisely speaking, the local name of the element without its namespace prefix if any), which mean it will grab the content between the <code>&lt;order&gt;</code> and <code>&lt;/order&gt;</code> tags (incl. the tokens). So for example a splitted message would be as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;order&amp;gt; &amp;lt;!-- order stuff here --&amp;gt; &amp;lt;/order&amp;gt; </script> 
 </div>
</div><p>If you want to inherit namespaces from a root/parent tag, then you can do this as well by providing the name of the root/parent tag:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;file:inbox&amp;quot;/&amp;gt; &amp;lt;split streaming=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;tokenize token=&amp;quot;order&amp;quot; inheritNamespaceTagName=&amp;quot;orders&amp;quot; xml=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;activemq:queue:order&amp;quot;/&amp;gt; &amp;lt;/split&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>And in Java DSL its as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;file:inbox&amp;quot;) .split().tokenizeXML(&amp;quot;order&amp;quot;, &amp;quot;orders&amp;quot;).streaming() .to(&amp;quot;activemq:queue:order&amp;quot;); </script> 
 </div>
</div><p><span style="line-height: 1.4285715;">Available as of Camel 2.13.1, you can set the above inheritNamsepaceTagName property to "*" to&#160;include the preceding context in each token (i.e., generating each token enclosed in its ancestor elements). It is noted that each token must share the same ancestor elements in this case.</span></p><p><span style="line-height: 1.4285715;">The above tokenizer works well on simple structures but has some inherent limitations in handling more complex XML structures.</span></p><p><strong>Available as of Camel 2.14</strong></p><p>The second tokenizer uses a StAX parser to overcome these limitations. This tokenizer recognizes XML namespaces and also handles simple and complex XML structures more naturally and efficiently.&#160;</p><p>To split using this tokenizer at {<a shape="rect" rel="nofollow">urn:shop}order</a>, we can write</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> Namespaces ns = new Namespaces(&amp;quot;ns1&amp;quot;, &amp;quot;urn:shop&amp;quot;); ... from(&amp;quot;file:inbox&amp;quot;) .split().xtokenize(&amp;quot;//ns1:order&amp;quot;, &amp;#39;i&amp;#39;, ns).streaming() .to(&amp;quot;activemq:queue:order)</script> 
 </div>
</div><p><span style="line-height: 1.4285715;">Two arguments control the behavior of the tokenizer. The first argument specifies the element using a path notation. This path notation uses a subset of xpath with wildcard support. The second argument represents the extraction mode. The available extraction modes are:</span></p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh">mode</th><th colspan="1" rowspan="1" class="confluenceTh">description</th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">i</td><td colspan="1" rowspan="1" class="confluenceTd">injecting the contextual namespace bindings into the extracted token (default)</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">w</td><td colspan="1" rowspan="1" class="confluenceTd">wrapping the extracted token in its ancestor context</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">u</td><td colspan="1" rowspan="1" class="confluenceTd">unwrapping the extracted token to its child content</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">t</td><td colspan="1" rowspan="1" class="confluenceTd">extracting the text content of the specified element</td></tr></tbody></table>
</div><p><span style="line-height: 1.4285715;">&#160;</span><span style="line-height: 1.4285715;">Having an input XML</span></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;m:orders xmlns:m=&amp;quot;urn:shop&amp;quot; xmlns:cat=&amp;quot;urn:shop:catalog&amp;quot;&amp;gt; &amp;lt;m:order&amp;gt;&amp;lt;id&amp;gt;123&amp;lt;/id&amp;gt;&amp;lt;date&amp;gt;2014-02-25&amp;lt;/date&amp;gt;...&amp;lt;/m:order&amp;gt; ...</script> 
 </div>
</div><p><span style="line-height: 1.4285715;">Each mode will result in the following tokens,&#160;</span></p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd">i</td><td colspan="1" rowspan="1" class="confluenceTd"><pre>&lt;m:order xmlns:m="urn:shop" xmlns:cat="urn:shop:catalog"&gt;&lt;id&gt;123&lt;/id&gt;&lt;date&gt;2014-02-25&lt;/date&gt;...&lt;/m:order&gt;</pre></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">w</td><td colspan="1" rowspan="1" class="confluenceTd"><pre>&lt;m:orders xmlns:m="urn:shop" xmlns:cat="urn:shop:catalog"&gt;
  &lt;m:order&gt;&lt;id&gt;123&lt;/id&gt;&lt;date&gt;2014-02-25&lt;/date&gt;...&lt;/m:order&gt;&lt;/m:orders&gt;</pre></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">u</td><td colspan="1" rowspan="1" class="confluenceTd"><pre>&lt;id&gt;123&lt;/id&gt;&lt;date&gt;2014-02-25&lt;/date&gt;...</pre></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">t</td><td colspan="1" rowspan="1" class="confluenceTd"><pre>1232014-02-25...</pre></td></tr></tbody></table>
</div><p><span style="line-height: 1.4285715;">&#160;</span><span style="line-height: 1.4285715;">In XML DSL, the equivalent route would be written as follows:</span></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext xmlns:ns1=&amp;quot;urn:shop&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;file:inbox&amp;quot;/&amp;gt; &amp;lt;split streaming=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;xtokenize&amp;gt;//ns1:order&amp;lt;/xtokenize&amp;gt; &amp;lt;to uri=&amp;quot;activemq:queue:order&amp;quot;/&amp;gt; &amp;lt;/split&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt;</script> 
 </div>
</div><p><span style="line-height: 1.4285715;">&#160;</span><span style="line-height: 1.4285715;">or setting the extraction mode explicitly as</span></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> ... &amp;lt;xtokenize mode=&amp;quot;i&amp;quot;&amp;gt;//ns1:order&amp;lt;/xtokenize&amp;gt; ...</script> 
 </div>
</div><p>Note that this StAX based tokenizer's uses StAX Location API and requires a StAX Reader implementation (e.g., woodstox) that correctly returns the offset position pointing to the beginning of each event triggering segment (e.g., the offset position of '&lt;' at each start and end element event). If you use a StAX Reader which does not implement that API correctly it results in invalid xml snippets after the split. For example the snippet could be wrong terminated:</p><pre>&lt;Start&gt;...&lt;&lt;/Start&gt; .... &lt;Start&gt;...&lt;/&lt;/Start&gt;</pre><h4 id="BookInOnePage-SplittingfilesbygroupingNlinestogether">Splitting files by grouping N lines together</h4><p><strong>Available as of Camel 2.10</strong></p><p>The <a shape="rect" href="tokenizer.html">Tokenizer</a> language has a new option <code>group</code> that allows you to group N parts together, for example to split big files into chunks of 1000 lines.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;file:inbox&amp;quot;) .split().tokenize(&amp;quot;\n&amp;quot;, 1000).streaming() .to(&amp;quot;activemq:queue:order&amp;quot;); </script> 
 </div>
</div><p>And in XML DSL</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;file:inbox&amp;quot;/&amp;gt; &amp;lt;split streaming=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;tokenize token=&amp;quot;\n&amp;quot; group=&amp;quot;1000&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;activemq:queue:order&amp;quot;/&amp;gt; &amp;lt;/split&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>The <code>group</code> option is a number that must be a positive number that dictates how many groups to combine together. Each part will be combined using the token.<br clear="none"> So in the example above the message being sent to the activemq order queue, will contain 1000 lines, and each line separated by the token (which is a new line token).<br clear="none"> The output when using the <code>group</code> option is always a <code>java.lang.String</code> type.</p><h4 id="BookInOnePage-Specifyingacustomaggregationstrategy">Specifying a custom aggregation strategy</h4><p>This is specified similar to the <a shape="rect" href="aggregator.html">Aggregator</a>.</p><h4 id="BookInOnePage-SpecifyingacustomThreadPoolExecutor">Specifying a custom ThreadPoolExecutor</h4><p>You can customize the underlying ThreadPoolExecutor used in the parallel splitter. In the Java DSL try something like this:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">XPathBuilder xPathBuilder = new XPathBuilder(&amp;quot;//foo/bar&amp;quot;); ExecutorService pool = ... from(&amp;quot;activemq:my.queue&amp;quot;) .split(xPathBuilder).executorService(pool) .to(&amp;quot;activemq:my.parts&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-UsingaPojotodothesplitting">Using a Pojo to do the splitting</h4><p>As the <a shape="rect" href="splitter.html">Splitter</a> can use any <a shape="rect" href="expression.html">Expression</a> to do the actual splitting we leverage this fact and use a <strong>method</strong> expression to invoke a <a shape="rect" href="bean.html">Bean</a> to get the splitted parts.<br clear="none"> The <a shape="rect" href="bean.html">Bean</a> should return a value that is iterable such as: <code>java.util.Collection, java.util.Iterator</code> or an array. <br clear="none"> So the returned value, will then be used by Camel at runtime, to split the message.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Streaming mode and using pojo</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>When you have enabled the streaming mode, then you should return a <code>Iterator</code> to ensure streamish fashion. For example if the message is a big file, then by using an iterator, that returns a piece of the file in chunks, in the <code>next</code> method of the <code>Iterator</code> ensures low memory footprint. This avoids the need for reading the entire content into memory. For an example see the source code for the <a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/camel/trunk/camel-core/src/main/java/org/apache/camel/support/TokenPairExpressionIterator.java">TokenizePair</a> implementation.</p>
 </div>
</div><p>In the route we define the <a shape="rect" href="expression.html">Expression</a> as a method call to invoke our <a shape="rect" href="bean.html">Bean</a> that we have registered with the id mySplitterBean in the <a shape="rect" href="registry.html">Registry</a>.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:body&amp;quot;) // here we use a POJO bean mySplitterBean to do the split of the payload .split().method(&amp;quot;mySplitterBean&amp;quot;, &amp;quot;splitBody&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); from(&amp;quot;direct:message&amp;quot;) // here we use a POJO bean mySplitterBean to do the split of the message // with a certain header value .split().method(&amp;quot;mySplitterBean&amp;quot;, &amp;quot;splitMessage&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>And the logic for our <a shape="rect" href="bean.html">Bean</a> is as simple as. Notice we use Camel <a shape="rect" href="bean-binding.html">Bean Binding</a> to pass in the message body as a String object.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public class MySplitterBean { /** * The split body method returns something that is iteratable such as a java.util.List. * * @param body the payload of the incoming message * @return a list containing each part splitted */ public List&amp;lt;String&amp;gt; splitBody(String body) { // since this is based on an unit test you can of cause // use different logic for splitting as Camel have out // of the box support for splitting a String based on comma // but this is for show and tell, since this is java code // you have the full power how you like to split your messages List&amp;lt;String&amp;gt; answer = new ArrayList&amp;lt;String&amp;gt;(); String[] parts = body.split(&amp;quot;,&amp;quot;); for (String part : parts) { answer.add(part); } return answer; } /** * The split message method returns something that is iteratable such as a java.util.List. * * @param header the header of the incoming message with the name user * @param body the payload of the incoming message * @return a list containing each part splitted */ public List&amp;lt;Message&amp;gt; splitMessage(@Header(value = &amp;quot;user&amp;quot;) String header, @Body String body) { // we can leverage the Parameter Binding Annotations // http://camel.apache.org/parameter-binding-annotations.html // to access the message header and body at same time, // then create the message that we want, splitter will // take care rest of them. // *NOTE* this feature requires Camel version &amp;gt;= 1.6.1 List&amp;lt;Message&amp;gt; answer = new ArrayList&amp;lt;Message&amp;gt;(); String[] parts = header.split(&amp;quot;,&amp;quot;); for (String part : parts) { DefaultMessage message = new DefaultMessage(); message.setHeader(&amp;quot;user&amp;quot;, part); message.setBody(body); answer.add(message); } return answer; } } </script> 
  </div>
 </div><h4 id="BookInOnePage-Splitaggregaterequest/replysample">Split aggregate request/reply sample</h4><p>This sample shows how you can split an <a shape="rect" href="exchange.html">Exchange</a>, process each splitted message, aggregate and return a combined response to the original caller using request/reply.</p><p>The route below illustrates this and how the split supports a <strong>aggregationStrategy</strong> to hold the in progress processed messages:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // this routes starts from the direct:start endpoint // the body is then splitted based on @ separator // the splitter in Camel supports InOut as well and for that we need // to be able to aggregate what response we need to send back, so we provide our // own strategy with the class MyOrderStrategy. from(&amp;quot;direct:start&amp;quot;) .split(body().tokenize(&amp;quot;@&amp;quot;), new MyOrderStrategy()) // each splitted message is then send to this bean where we can process it .to(&amp;quot;bean:MyOrderService?method=handleOrder&amp;quot;) // this is important to end the splitter route as we do not want to do more routing // on each splitted message .end() // after we have splitted and handled each message we want to send a single combined // response back to the original caller, so we let this bean build it for us // this bean will receive the result of the aggregate strategy: MyOrderStrategy .to(&amp;quot;bean:MyOrderService?method=buildCombinedResponse&amp;quot;) </script> 
  </div>
 </div>And the OrderService bean is as follows:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public static class MyOrderService { private static int counter; /** * We just handle the order by returning a id line for the order */ public String handleOrder(String line) { LOG.debug(&amp;quot;HandleOrder: &amp;quot; + line); return &amp;quot;(id=&amp;quot; + ++counter + &amp;quot;,item=&amp;quot; + line + &amp;quot;)&amp;quot;; } /** * We use the same bean for building the combined response to send * back to the original caller */ public String buildCombinedResponse(String line) { LOG.debug(&amp;quot;BuildCombinedResponse: &amp;quot; + line); return &amp;quot;Response[&amp;quot; + line + &amp;quot;]&amp;quot;; } } </script> 
  </div>
 </div>And our custom <strong>aggregationStrategy</strong> that is responsible for holding the in progress aggregated message that after the splitter is ended will be sent to the <strong>buildCombinedResponse</strong> method for final processing before the combined response can be returned to the waiting caller.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> /** * This is our own order aggregation strategy where we can control * how each splitted message should be combined. As we do not want to * loos any message we copy from the new to the old to preserve the * order lines as long we process them */ public static class MyOrderStrategy implements AggregationStrategy { public Exchange aggregate(Exchange oldExchange, Exchange newExchange) { // put order together in old exchange by adding the order from new exchange if (oldExchange == null) { // the first time we aggregate we only have the new exchange, // so we just return it return newExchange; } String orders = oldExchange.getIn().getBody(String.class); String newLine = newExchange.getIn().getBody(String.class); LOG.debug(&amp;quot;Aggregate old orders: &amp;quot; + orders); LOG.debug(&amp;quot;Aggregate new order: &amp;quot; + newLine); // put orders together separating by semi colon orders = orders + &amp;quot;;&amp;quot; + newLine; // put combined order back on old to preserve it oldExchange.getIn().setBody(orders); // return old as this is the one that has all the orders gathered until now return oldExchange; } } </script> 
  </div>
 </div>So lets run the sample and see how it works.<br clear="none"> We send an <a shape="rect" href="exchange.html">Exchange</a> to the <strong>direct:start</strong> endpoint containing a IN body with the String value: <code>A@B@C</code>. The flow is:<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">HandleOrder: A HandleOrder: B Aggregate old orders: (id=1,item=A) Aggregate new order: (id=2,item=B) HandleOrder: C Aggregate old orders: (id=1,item=A);(id=2,item=B) Aggregate new order: (id=3,item=C) BuildCombinedResponse: (id=1,item=A);(id=2,item=B);(id=3,item=C) Response to caller: Response[(id=1,item=A);(id=2,item=B);(id=3,item=C)] </script> 
 </div>
</div><h3 id="BookInOnePage-Stopprocessingincaseofexception">Stop processing in case of exception</h3><p><strong>Available as of Camel 2.1</strong></p><p>The <a shape="rect" href="splitter.html">Splitter</a> will by default continue to process the entire <a shape="rect" href="exchange.html">Exchange</a> even in case of one of the splitted message will thrown an exception during routing.<br clear="none"> For example if you have an <a shape="rect" href="exchange.html">Exchange</a> with 1000 rows that you split and route each sub message. During processing of these sub messages an exception is thrown at the 17th. What Camel does by default is to process the remainder 983 messages. You have the chance to remedy or handle this in the <code>AggregationStrategy</code>.</p><p>But sometimes you just want Camel to stop and let the exception be propagated back, and let the Camel error handler handle it. You can do this in Camel 2.1 by specifying that it should stop in case of an exception occurred. This is done by the <code>stopOnException</code> option as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) .split(body().tokenize(&amp;quot;,&amp;quot;)).stopOnException() .process(new MyProcessor()) .to(&amp;quot;mock:split&amp;quot;); </script> 
 </div>
</div><p>And using XML DSL you specify it as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;split stopOnException=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;tokenize token=&amp;quot;,&amp;quot;/&amp;gt; &amp;lt;process ref=&amp;quot;myProcessor&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:split&amp;quot;/&amp;gt; &amp;lt;/split&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-UsingonPreparetoexecutecustomlogicwhenpreparingmessages.1">Using onPrepare to execute custom logic when preparing messages</h3><p><strong>Available as of Camel 2.8</strong></p><p>See details at <a shape="rect" href="multicast.html">Multicast</a></p><h3 id="BookInOnePage-Sharingunitofwork">Sharing unit of work</h3><p><strong>Available as of Camel 2.8</strong></p><p>The <a shape="rect" href="splitter.html">Splitter</a> will by default not share unit of work between the parent exchange and each splitted exchange. This means each sub exchange has its own individual unit of work.</p><p>For example you may have an use case, where you want to split a big message. And you want to regard that process as an atomic isolated operation that either is a success or failure. In case of a failure you want that big message to be moved into a <a shape="rect" href="dead-letter-channel.html">dead letter queue</a>. To support this use case, you would have to share the unit of work on the <a shape="rect" href="splitter.html">Splitter</a>.</p><p>Here is an example in Java DSL
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> errorHandler(deadLetterChannel(&amp;quot;mock:dead&amp;quot;).useOriginalMessage() .maximumRedeliveries(3).redeliveryDelay(0)); from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;mock:a&amp;quot;) // share unit of work in the splitter, which tells Camel to propagate failures from // processing the splitted messages back to the result of the splitter, which allows // it to act as a combined unit of work .split(body().tokenize(&amp;quot;,&amp;quot;)).shareUnitOfWork() .to(&amp;quot;mock:b&amp;quot;) .to(&amp;quot;direct:line&amp;quot;) .end() .to(&amp;quot;mock:result&amp;quot;); from(&amp;quot;direct:line&amp;quot;) .to(&amp;quot;log:line&amp;quot;) .process(new MyProcessor()) .to(&amp;quot;mock:line&amp;quot;); </script> 
  </div>
 </div>Now in this example what would happen is that in case there is a problem processing each sub message, the error handler will kick in (yes error handling still applies for the sub messages). <strong>But</strong> what doesn't happen is that if a sub message fails all redelivery attempts (its exhausted), then its <strong>not</strong> moved into that dead letter queue. The reason is that we have shared the unit of work, so the sub message will report the error on the shared unit of work. When the <a shape="rect" href="splitter.html">Splitter</a> is done, it checks the state of the shared unit of work and checks if any errors occurred. And if an error occurred it will set the exception on the <a shape="rect" href="exchange.html">Exchange</a> and mark it for rollback. The error handler will yet again kick in, as the <a shape="rect" href="exchange.html">Exchange</a> has been marked as rollback and it had an exception as well. No redelivery attempts is performed (as it was marked for rollback) and the <a shape="rect" href="exchange.html">Exchange</a> will be moved into the <a shape="rect" href="dead-letter-channel.html">dead letter queue</a>.<p>Using this from XML DSL is just as easy as you just have to set the shareUnitOfWork attribute to true:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext errorHandlerRef=&amp;quot;dlc&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;!-- define error handler as DLC, with use original message enabled --&amp;gt; &amp;lt;errorHandler id=&amp;quot;dlc&amp;quot; type=&amp;quot;DeadLetterChannel&amp;quot; deadLetterUri=&amp;quot;mock:dead&amp;quot; useOriginalMessage=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;redeliveryPolicy maximumRedeliveries=&amp;quot;3&amp;quot; redeliveryDelay=&amp;quot;0&amp;quot;/&amp;gt; &amp;lt;/errorHandler&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:a&amp;quot;/&amp;gt; &amp;lt;!-- share unit of work in the splitter, which tells Camel to propagate failures from processing the splitted messages back to the result of the splitter, which allows it to act as a combined unit of work --&amp;gt; &amp;lt;split shareUnitOfWork=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;tokenize token=&amp;quot;,&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:b&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:line&amp;quot;/&amp;gt; &amp;lt;/split&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;!-- route for processing each splitted line --&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:line&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;log:line&amp;quot;/&amp;gt; &amp;lt;process ref=&amp;quot;myProcessor&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:line&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
  </div>
 </div><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Implementation of shared unit of work</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>So in reality the unit of work is not shared as a single object instance. Instead <code>SubUnitOfWork</code> is attached to their parent, and issues callback to the parent about their status (commit or rollback). This may be refactored in Camel 3.0 where larger API changes can be done.</p>
 </div>
</div><p></p><h4 id="BookInOnePage-UsingThisPattern.18">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-Aggregator">Aggregator</h3><p><strong>This applies for Camel version 2.3 or newer. If you use an older version then use this <a shape="rect" href="aggregator.html">Aggregator</a> link instead.</strong></p><p>The <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/Aggregator.html" rel="nofollow">Aggregator</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> allows you to combine a number of messages together into a single message.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/Aggregator.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/Aggregator.gif"></span></p><p>A correlation <a shape="rect" href="expression.html">Expression</a> is used to determine the messages which should be aggregated together. If you want to aggregate all messages into a single message, just use a constant expression. An AggregationStrategy is used to combine all the message exchanges for a single correlation key into a single message exchange.</p><h3 id="BookInOnePage-Aggregatoroptions">Aggregator options</h3><p>The aggregator supports the following options:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>correlationExpression</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Mandatory <a shape="rect" href="expression.html">Expression</a> which evaluates the correlation key to use for aggregation. The <a shape="rect" href="exchange.html">Exchange</a> which has the same correlation key is aggregated together. If the correlation key could not be evaluated an Exception is thrown. You can disable this by using the <code>ignoreBadCorrelationKeys</code> option.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>aggregationStrategy</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Mandatory <code>AggregationStrategy</code> which is used to <em>merge</em> the incoming <a shape="rect" href="exchange.html">Exchange</a> with the existing already merged exchanges. At first call the <code>oldExchange</code> parameter is <code>null</code>. On subsequent invocations the <code>oldExchange</code> contains the merged exchanges and <code>newExchange</code> is of course the new incoming Exchange. From <strong>Camel 2.9.2</strong> onwards the strategy can also be a <code>TimeoutAwareAggregationStrategy</code> implementation, supporting the timeout callback, see further below for more details. From <strong>Camel 2.16</strong> onwards the strategy can also be a <code>PreCompletionAwareAggregationStrategy</code> implementation which then runs the completion check in pre-completion mode. See further below for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>strategyRef</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A reference to lookup the <code>AggregationStrategy</code> in the <a shape="rect" href="registry.html">Registry</a>. From <strong>Camel 2.12</strong> onwards you can also use a POJO as the <code>AggregationStrategy</code>, see further below for details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>strategyMethodName</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> This option can be used to explicit declare the method name to use, when using POJOs as the <code>AggregationStrategy</code>. See further below for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>strategyMethodAllowNull</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> If this option is <code>false</code> then the aggregate method is not used for the very first aggregation. If this option is <code>true</code> then <code>null</code> values is used as the <code>oldExchange</code> (at the very first aggregation), when using POJOs as the <code>AggregationStrategy</code>. See further below for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>completionSize</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Number of messages aggregated before the aggregation is complete. This option can be set as either a fixed value or using an <a shape="rect" href="expression.html">Expression</a> which allows you to evaluate a size dynamically - will use <code>Integer</code> as result. If both are set Camel will fallback to use the fixed value if the <a shape="rect" href="expression.html">Expression</a> result was <code>null</code> or <code>0</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>completionTimeout</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Time in millis that an aggregated exchange should be inactive before its complete. This option can be set as either a fixed value or using an <a shape="rect" href="expression.html">Expression</a> which allows you to evaluate a timeout dynamically - will use <code>Long</code> as result. If both are set Camel will fallback to use the fixed value if the <a shape="rect" href="expression.html">Expression</a> result was <code>null</code> or <code>0</code>. You cannot use this option together with completionInterval, only one of the two can be used.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>completionInterval</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A repeating period in millis by which the aggregator will complete all current aggregated exchanges. Camel has a background task which is triggered every period. You cannot use this option together with completionTimeout, only one of them can be used.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>completionPredicate</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A <a shape="rect" href="predicate.html">Predicate</a> to indicate when an aggregated exchange is complete. Starting in <strong>Camel 2.15</strong>, if this is not specified and the AggregationStrategy object implements Predicate, the aggregationStrategy object will be used as the completionPredicate.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>completionFromBatchConsumer</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>This option is if the exchanges are coming from a <a shape="rect" href="batch-consumer.html">Batch Consumer</a>. Then when enabled the <a shape="rect" href="aggregator2.html">Aggregator2</a> will use the batch size determined by the <a shape="rect" href="batch-consumer.html">Batch Consumer</a> in the message header <code>CamelBatchSize</code>. See more details at <a shape="rect" href="batch-consumer.html">Batch Consumer</a>. This can be used to aggregate all files consumed from a <a shape="rect" href="file2.html">File</a> endpoint in that given poll.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>forceCompletionOnStop</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9</strong> Indicates to complete all current aggregated exchanges when the context is stopped</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">completeAllOnStop</td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong>&#160;Indicates to wait to complete all current and partial (pending) aggregated exchanges when the context is stopped. This also means that we will wait for all pending exchanges which are stored in the&#160;aggregation repository&#160;to complete so the repository is empty before we can stop. &#160;You may want to enable this when using the memory based aggregation repository that is memory based only,&#160;and do not store data on disk. When this option is enabled, then the aggregator is waiting to complete&#160;all those exchanges before its stopped, when stopping CamelContext or the route using it.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>eagerCheckCompletion</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether or not to eager check for completion when a new incoming <a shape="rect" href="exchange.html">Exchange</a> has been received. This option influences the behavior of the <code>completionPredicate</code> option as the <a shape="rect" href="exchange.html">Exchange</a> being passed in changes accordingly. When <code>false</code> the <a shape="rect" href="exchange.html">Exchange</a> passed in the <a shape="rect" href="predicate.html">Predicate</a> is the <em>aggregated</em> Exchange which means any information you may store on the aggregated Exchange from the <code>AggregationStrategy</code> is available for the <a shape="rect" href="predicate.html">Predicate</a>. When <code>true</code> the <a shape="rect" href="exchange.html">Exchange</a> passed in the <a shape="rect" href="predicate.html">Predicate</a> is the <em>incoming</em> <a shape="rect" href="exchange.html">Exchange</a>, which means you can access data from the incoming Exchange.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>groupExchanges</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If enabled then Camel will group all aggregated Exchanges into a single combined <code>org.apache.camel.impl.GroupedExchange</code> holder class that holds all the aggregated Exchanges. And as a result only one Exchange is being sent out from the aggregator. Can be used to combine many incoming Exchanges into a single output Exchange without coding a custom <code>AggregationStrategy</code> yourself. <strong>Important:</strong> This option does <strong>not</strong> support persistent repository with the aggregator. See further below for an example and more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>ignoreInvalidCorrelationKeys</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether or not to ignore correlation keys which could not be evaluated to a value. By default Camel will throw an Exception, but you can enable this option and ignore the situation instead.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>closeCorrelationKeyOnCompletion</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether or not too <em>late</em> Exchanges should be accepted or not. You can enable this to indicate that if a correlation key has already been completed, then any new exchanges with the same correlation key be denied. Camel will then throw a <code>closedCorrelationKeyException</code> exception. When using this option you pass in a <code>integer</code> which is a number for a LRUCache which keeps that last X number of closed correlation keys. You can pass in 0 or a negative value to indicate a unbounded cache. By passing in a number you are ensured that cache won't grow too big if you use a log of different correlation keys.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>discardOnCompletionTimeout</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> Whether or not exchanges which complete due to a timeout should be discarded. If enabled then when a timeout occurs the aggregated message will <strong>not</strong> be sent out but dropped (discarded).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>aggregationRepository</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Allows you to plugin you own implementation of <code>org.apache.camel.spi.AggregationRepository</code> which keeps track of the current inflight aggregated exchanges. Camel uses by default a memory based implementation.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>aggregationRepositoryRef</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Reference to lookup a <code>aggregationRepository</code> in the <a shape="rect" href="registry.html">Registry</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>parallelProcessing</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>When aggregated are completed they are being send out of the aggregator. This option indicates whether or not Camel should use a thread pool with multiple threads for concurrency. If no custom thread pool has been specified then Camel creates a default pool with 10 concurrent threads.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>executorService</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If using <code>parallelProcessing</code> you can specify a custom thread pool to be used. In fact also if you are not using <code>parallelProcessing</code> this custom thread pool is used to send out aggregated exchanges as well.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>executorServiceRef</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Reference to lookup a <code>executorService</code> in the <a shape="rect" href="registry.html">Registry</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>timeoutCheckerExecutorService</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> If using either of the <code>completionTimeout</code>, <code>completionTimeoutExpression</code>, or <code>completionInterval</code> options a background thread is created to check for the completion for every aggregator. Set this option to provide a custom thread pool to be used rather than creating a new thread for every aggregator.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>timeoutCheckerExecutorServiceRef</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> Reference to lookup a <code>timeoutCheckerExecutorService</code> in the <a shape="rect" href="registry.html">Registry</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>optimisticLocking</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> Turns on using optimistic locking, which requires the <code>aggregationRepository</code> being used, is supporting this by implementing the <code>org.apache.camel.spi.OptimisticLockingAggregationRepository</code> interface.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>optimisticLockRetryPolicy</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.1:</strong> Allows to configure retry settings when using optimistic locking.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-ExchangeProperties">Exchange Properties</h3><p>The following properties are set on each aggregated Exchange:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelAggregatedSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>int</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The total number of Exchanges aggregated into this combined Exchange.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelAggregatedCompletedBy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>String</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Indicator how the aggregation was completed as a value of either: <code>predicate</code>, <code>size</code>, <code>strategy</code>, <code>consumer</code>, <code>timeout</code>, <code>forceCompletion</code> or <code>interval</code>.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-AboutAggregationStrategy">About AggregationStrategy</h3><p>The <code>AggregationStrategy</code> is used for aggregating the old (lookup by its correlation id) and the new exchanges together into a single exchange. Possible implementations include performing some kind of combining or delta processing, such as adding line items together into an invoice or just using the newest exchange and removing old exchanges such as for state tracking or market data prices; where old values are of little use.</p><p>Notice the aggregation strategy is a mandatory option and must be provided to the aggregator.</p><p>Here are a few example AggregationStrategy implementations that should help you create your own custom strategy.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">//simply combines Exchange String body values using &amp;#39;+&amp;#39; as a delimiter class StringAggregationStrategy implements AggregationStrategy { public Exchange aggregate(Exchange oldExchange, Exchange newExchange) { if (oldExchange == null) { return newExchange; } String oldBody = oldExchange.getIn().getBody(String.class); String newBody = newExchange.getIn().getBody(String.class); oldExchange.getIn().setBody(oldBody + &amp;quot;+&amp;quot; + newBody); return oldExchange; } } //simply combines Exchange body values into an ArrayList&amp;lt;Object&amp;gt; class ArrayListAggregationStrategy implements AggregationStrategy { public Exchange aggregate(Exchange oldExchange, Exchange newExchange) { Object newBody = newExchange.getIn().getBody(); ArrayList&amp;lt;Object&amp;gt; list = null; if (oldExchange == null) { list = new ArrayList&amp;lt;Object&amp;gt;(); list.add(newBody); newExchange.getIn().setBody(list); return newExchange; } else { list = oldExchange.getIn().getBody(ArrayList.class); list.add(newBody); return oldExchange; } } } </script> 
 </div>
</div><h3 id="BookInOnePage-Aboutcompletion">About completion</h3><p>When aggregation <a shape="rect" href="exchange.html">Exchange</a>s at some point you need to indicate that the aggregated exchanges is complete, so they can be send out of the aggregator. Camel allows you to indicate completion in various ways as follows:</p><ul class="alternate"><li>completionTimeout - Is an inactivity timeout in which is triggered if no new exchanges have been aggregated for that particular correlation key within the period.</li><li>completionInterval - Once every X period all the current aggregated exchanges are completed.</li><li>completionSize - Is a number indicating that after X aggregated exchanges it's complete.</li><li>completionPredicate - Runs a <a shape="rect" href="predicate.html">Predicate</a> when a new exchange is aggregated to determine if we are complete or not. Staring in&#160;<strong>Camel 2.15</strong>, the configured aggregationStrategy can implement the Predicate interface and will be used as the completionPredicate if no completionPredicate is configured. From&#160;<strong>Camel 2.16</strong>, the configured aggregationStrategy can implement&#160;<code>PreCompletionAwareAggregationStrategy</code> and will be used as the completionPredicate in pre-complete check mode. See further below for more details.</li><li>completionFromBatchConsumer - Special option for <a shape="rect" href="batch-consumer.html">Batch Consumer</a> which allows you to complete when all the messages from the batch has been aggregated.</li><li>forceCompletionOnStop - <strong>Camel 2.9</strong> Indicates to complete all current aggregated exchanges when the context is stopped</li><li>Using a&#160;<code>AggregateController</code> -&#160;<strong>Camel 2.16</strong> which allows to use an external source to complete groups or all groups. This can be done using Java or JMX API.</li></ul><p>Notice that all the completion ways are per correlation key. And you can combine them in any way you like. It's basically the first which triggers that wins. So you can use a completion size together with a completion timeout. Only completionTimeout and completionInterval cannot be used at the same time.</p><p>Notice the completion is a mandatory option and must be provided to the aggregator. If not provided Camel will thrown an Exception on startup.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Callbacks</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>See the <code>TimeoutAwareAggregationStrategy</code> and <code>CompletionAwareAggregationStrategy</code> extensions to <code>AggregationStrategy</code> that has callbacks when the aggregated Exchange was completed and if a timeout occurred.</p>
 </div>
</div><h3 id="BookInOnePage-Pre-completionmode">Pre-completion mode</h3><p><strong>available as of Camel 2.16</strong></p><p>There can be use-cases where you want the incoming <a shape="rect" href="exchange.html">Exchange</a>&#160;to determine if the correlation group should pre-complete, and then the incoming <a shape="rect" href="exchange.html">Exchange</a>&#160;is starting a new group from scratch. To determine this the&#160;<code>AggregationStrategy</code> can implement&#160;<code>PreCompletionAwareAggregationStrategy</code> which has a&#160;<code>preComplete</code> method:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> /** * Determines if the aggregation should complete the current group, and start a new group, or the aggregation * should continue using the current group. * * @param oldExchange the oldest exchange (is &amp;lt;tt&amp;gt;null&amp;lt;/tt&amp;gt; on first aggregation as we only have the new exchange) * @param newExchange the newest exchange (can be &amp;lt;tt&amp;gt;null&amp;lt;/tt&amp;gt; if there was no data possible to acquire) * @return &amp;lt;tt&amp;gt;true&amp;lt;/tt&amp;gt; to complete current group and start a new group, or &amp;lt;tt&amp;gt;false&amp;lt;/tt&amp;gt; to keep using current */ boolean preComplete(Exchange oldExchange, Exchange newExchange);</script> 
 </div>
</div><p>If the preComplete method returns true, then the existing groups is completed (without aggregating the incoming exchange (newExchange). And then the newExchange is used to start the correlation group from scratch so the group would contain only that new incoming exchange. This is known as pre-completion mode. And when the aggregation is in pre-completion mode, then only the following completions are in use</p><ul style="list-style-type: square;"><li>aggregationStrategy must implement&#160;<code>PreCompletionAwareAggregationStrategy</code>&#160;xxx</li><li>completionTimeout or completionInterval can also be used as fallback completions</li><li>any other completion are not used (such as by size, from batch consumer etc)</li><li>eagerCheckCompletion is implied as true, but the option has no effect</li></ul><h3 id="BookInOnePage-PersistentAggregationRepository">Persistent AggregationRepository</h3><p>The aggregator provides a pluggable repository which you can implement your own <code>org.apache.camel.spi.AggregationRepository</code>.<br clear="none"> If you need persistent repository then you can use either Camel <a shape="rect" href="hawtdb.html">HawtDB</a>, <a shape="rect" href="leveldb.html">LevelDB</a>, or <a shape="rect" href="sql-component.html">SQL Component</a> components.</p><h3 id="BookInOnePage-Examples.9">Examples</h3><p>See some examples from the old <a shape="rect" href="aggregator.html">Aggregator</a> which is somewhat similar to this new aggregator.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Setting options in Spring XML</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Many of the options are configurable as attributes on the <code>&lt;aggregate&gt;</code> tag when using Spring XML.</p>
 </div>
</div><h4 id="BookInOnePage-UsingcompletionTimeout">Using completionTimeout</h4><p>In this example we want to aggregate all incoming messages and after 3 seconds of inactivity we want the aggregation to complete. This is done using the <code>completionTimeout</code> option as shown:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) // aggregate all exchanges correlated by the id header. // Aggregate them using the BodyInAggregatingStrategy strategy which // and after 3 seconds of inactivity them timeout and complete the aggregation // and send it to mock:aggregated .aggregate(header(&amp;quot;id&amp;quot;), new BodyInAggregatingStrategy()).completionTimeout(3000) .to(&amp;quot;mock:aggregated&amp;quot;); </script> 
  </div>
 </div>And the same example using Spring XML:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;aggregate strategyRef=&amp;quot;aggregatorStrategy&amp;quot; completionTimeout=&amp;quot;3000&amp;quot;&amp;gt; &amp;lt;correlationExpression&amp;gt; &amp;lt;simple&amp;gt;header.id&amp;lt;/simple&amp;gt; &amp;lt;/correlationExpression&amp;gt; &amp;lt;to uri=&amp;quot;mock:aggregated&amp;quot;/&amp;gt; &amp;lt;/aggregate&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;bean id=&amp;quot;aggregatorStrategy&amp;quot; class=&amp;quot;org.apache.camel.processor.BodyInAggregatingStrategy&amp;quot;/&amp;gt; </script> 
  </div>
 </div><h4 id="BookInOnePage-UsingTimeoutAwareAggregationStrategy">Using TimeoutAwareAggregationStrategy</h4><p><strong>Available as of Camel 2.9.2</strong></p><p>If your aggregation strategy implements <code>TimeoutAwareAggregationStrategy</code>, then Camel will invoke the <code>timeout</code> method when the timeout occurs. Notice that the values for index and total parameters will be -1, and the timeout parameter will be provided only if configured as a fixed value. You must <strong>not</strong> throw any exceptions from the <code>timeout</code> method.</p><h4 id="BookInOnePage-UsingCompletionAwareAggregationStrategy">Using CompletionAwareAggregationStrategy</h4><p><strong>Available as of Camel 2.9.3</strong></p><p>If your aggregation strategy implements <code>CompletionAwareAggregationStrategy</code>, then Camel will invoke the <code>onComplete</code> method when the aggregated Exchange is completed. This allows you to do any last minute custom logic such as to cleanup some resources, or additional work on the exchange as it's now completed.<br clear="none"> You must <strong>not</strong> throw any exceptions from the <code>onCompletion</code> method.</p><h4 id="BookInOnePage-UsingcompletionSize">Using completionSize</h4><p>In this example we want to aggregate all incoming messages and when we have 3 messages aggregated (in the same correlation group) we want the aggregation to complete. This is done using the <code>completionSize</code> option as shown:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) // aggregate all exchanges correlated by the id header. // Aggregate them using the BodyInAggregatingStrategy strategy which // and after 3 messages has been aggregated then complete the aggregation // and send it to mock:aggregated .aggregate(header(&amp;quot;id&amp;quot;), new BodyInAggregatingStrategy()).completionSize(3) .to(&amp;quot;mock:aggregated&amp;quot;); </script> 
  </div>
 </div>And the same example using Spring XML:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;aggregate strategyRef=&amp;quot;aggregatorStrategy&amp;quot; completionSize=&amp;quot;3&amp;quot;&amp;gt; &amp;lt;correlationExpression&amp;gt; &amp;lt;simple&amp;gt;header.id&amp;lt;/simple&amp;gt; &amp;lt;/correlationExpression&amp;gt; &amp;lt;to uri=&amp;quot;mock:aggregated&amp;quot;/&amp;gt; &amp;lt;/aggregate&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;bean id=&amp;quot;aggregatorStrategy&amp;quot; class=&amp;quot;org.apache.camel.processor.BodyInAggregatingStrategy&amp;quot;/&amp;gt; </script> 
  </div>
 </div><h4 id="BookInOnePage-UsingcompletionPredicate">Using completionPredicate</h4><p>In this example we want to aggregate all incoming messages and use a <a shape="rect" href="predicate.html">Predicate</a> to determine when we are complete. The <a shape="rect" href="predicate.html">Predicate</a> can be evaluated using either the aggregated exchange (default) or the incoming exchange. We will give an example for both situations. We start with the default situation as shown:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) // aggregate all exchanges correlated by the id header. // Aggregate them using the BodyInAggregatingStrategy strategy which // and when the aggregated body contains A+B+C then complete the aggregation // and send it to mock:aggregated .aggregate(header(&amp;quot;id&amp;quot;), new BodyInAggregatingStrategy()).completionPredicate(body().contains(&amp;quot;A+B+C&amp;quot;)) .to(&amp;quot;mock:aggregated&amp;quot;); </script> 
  </div>
 </div>And the same example using Spring XML:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;aggregate strategyRef=&amp;quot;aggregatorStrategy&amp;quot;&amp;gt; &amp;lt;correlationExpression&amp;gt; &amp;lt;simple&amp;gt;header.id&amp;lt;/simple&amp;gt; &amp;lt;/correlationExpression&amp;gt; &amp;lt;completionPredicate&amp;gt; &amp;lt;simple&amp;gt;${body} contains &amp;#39;A+B+C&amp;#39;&amp;lt;/simple&amp;gt; &amp;lt;/completionPredicate&amp;gt; &amp;lt;to uri=&amp;quot;mock:aggregated&amp;quot;/&amp;gt; &amp;lt;/aggregate&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;bean id=&amp;quot;aggregatorStrategy&amp;quot; class=&amp;quot;org.apache.camel.processor.BodyInAggregatingStrategy&amp;quot;/&amp;gt; </script> 
  </div>
 </div>And the other situation where we use the <code>eagerCheckCompletion</code> option to tell Camel to use the incoming Exchange. Notice how we can just test in the completion predicate that the incoming message is the <em>END</em> message:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) // aggregate all exchanges correlated by the id header. // Aggregate them using the BodyInAggregatingStrategy strategy // do eager checking which means the completion predicate will use the incoming exchange // which allows us to trigger completion when a certain exchange arrived which is the // END message .aggregate(header(&amp;quot;id&amp;quot;), new BodyInAggregatingStrategy()) .eagerCheckCompletion().completionPredicate(body().isEqualTo(&amp;quot;END&amp;quot;)) .to(&amp;quot;mock:aggregated&amp;quot;); </script> 
  </div>
 </div>And the same example using Spring XML:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;aggregate strategyRef=&amp;quot;aggregatorStrategy&amp;quot; eagerCheckCompletion=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;correlationExpression&amp;gt; &amp;lt;simple&amp;gt;header.id&amp;lt;/simple&amp;gt; &amp;lt;/correlationExpression&amp;gt; &amp;lt;completionPredicate&amp;gt; &amp;lt;simple&amp;gt;${body} == &amp;#39;END&amp;#39;&amp;lt;/simple&amp;gt; &amp;lt;/completionPredicate&amp;gt; &amp;lt;to uri=&amp;quot;mock:aggregated&amp;quot;/&amp;gt; &amp;lt;/aggregate&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;bean id=&amp;quot;aggregatorStrategy&amp;quot; class=&amp;quot;org.apache.camel.processor.BodyInAggregatingStrategy&amp;quot;/&amp;gt; </script> 
  </div>
 </div><h4 id="BookInOnePage-UsingdynamiccompletionTimeout">Using dynamic completionTimeout</h4><p>In this example we want to aggregate all incoming messages and after a period of inactivity we want the aggregation to complete. The period should be computed at runtime based on the <code>timeout</code> header in the incoming messages. This is done using the <code>completionTimeout</code> option as shown:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) // aggregate all exchanges correlated by the id header. // Aggregate them using the BodyInAggregatingStrategy strategy which // and the timeout header contains the timeout in millis of inactivity them timeout and complete the aggregation // and send it to mock:aggregated .aggregate(header(&amp;quot;id&amp;quot;), new BodyInAggregatingStrategy()).completionTimeout(header(&amp;quot;timeout&amp;quot;)) .to(&amp;quot;mock:aggregated&amp;quot;); </script> 
  </div>
 </div>And the same example using Spring XML:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;aggregate strategyRef=&amp;quot;aggregatorStrategy&amp;quot;&amp;gt; &amp;lt;correlationExpression&amp;gt; &amp;lt;simple&amp;gt;header.id&amp;lt;/simple&amp;gt; &amp;lt;/correlationExpression&amp;gt; &amp;lt;completionTimeout&amp;gt; &amp;lt;header&amp;gt;timeout&amp;lt;/header&amp;gt; &amp;lt;/completionTimeout&amp;gt; &amp;lt;to uri=&amp;quot;mock:aggregated&amp;quot;/&amp;gt; &amp;lt;/aggregate&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;bean id=&amp;quot;aggregatorStrategy&amp;quot; class=&amp;quot;org.apache.camel.processor.BodyInAggregatingStrategy&amp;quot;/&amp;gt; </script> 
  </div>
 </div><strong>Note:</strong> You can also add a fixed timeout value and Camel will fallback to use this value if the dynamic value was <code>null</code> or <code>0</code>.<h4 id="BookInOnePage-UsingdynamiccompletionSize">Using dynamic completionSize</h4><p>In this example we want to aggregate all incoming messages based on a dynamic size per correlation key. The size is computed at runtime based on the <code>mySize</code> header in the incoming messages. This is done using the <code>completionSize</code> option as shown:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) // aggregate all exchanges correlated by the id header. // Aggregate them using the BodyInAggregatingStrategy strategy which // and the header mySize determines the number of aggregated messages should trigger the completion // and send it to mock:aggregated .aggregate(header(&amp;quot;id&amp;quot;), new BodyInAggregatingStrategy()).completionSize(header(&amp;quot;mySize&amp;quot;)) .to(&amp;quot;mock:aggregated&amp;quot;); </script> 
  </div>
 </div>And the same example using Spring XML:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;aggregate strategyRef=&amp;quot;aggregatorStrategy&amp;quot;&amp;gt; &amp;lt;correlationExpression&amp;gt; &amp;lt;simple&amp;gt;header.id&amp;lt;/simple&amp;gt; &amp;lt;/correlationExpression&amp;gt; &amp;lt;completionSize&amp;gt; &amp;lt;header&amp;gt;mySize&amp;lt;/header&amp;gt; &amp;lt;/completionSize&amp;gt; &amp;lt;to uri=&amp;quot;mock:aggregated&amp;quot;/&amp;gt; &amp;lt;/aggregate&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;bean id=&amp;quot;aggregatorStrategy&amp;quot; class=&amp;quot;org.apache.camel.processor.BodyInAggregatingStrategy&amp;quot;/&amp;gt; </script> 
  </div>
 </div><strong>Note:</strong> You can also add a fixed size value and Camel will fallback to use this value if the dynamic value was <code>null</code> or <code>0</code>.<p></p><h4 id="BookInOnePage-UsingThisPattern.19">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h4 id="BookInOnePage-CompletingcurrentgroupdecidedfromtheAggregationStrategy">Completing current group decided from the AggregationStrategy</h4><p><strong>Available as of Camel 2.15</strong></p><p>The&#160;<code>AggregationStrategy</code> can now included a property on the returned&#160;<code>Exchange</code> that contains a boolean to indicate if the current group should be completed. This allows to overrule any existing completion predicates / sizes / timeouts etc, and complete the group.</p><p>For example the following logic (from an unit test) will complete the group if the message body size is larger than 5. This is done by setting the property&#160;<span style="line-height: 1.4285715;">Exchange.AGGREGATION_COMPLETE_CURRENT_GROUP to true.</span></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public final class MyCompletionStrategy implements AggregationStrategy { @Override public Exchange aggregate(Exchange oldExchange, Exchange newExchange) { if (oldExchange == null) { return newExchange; } String body = oldExchange.getIn().getBody(String.class) + &amp;quot;+&amp;quot; + newExchange.getIn().getBody(String.class); oldExchange.getIn().setBody(body); if (body.length() &amp;gt;= 5) { oldExchange.setProperty(Exchange.AGGREGATION_COMPLETE_CURRENT_GROUP, true); } return oldExchange; } }</script> 
 </div>
</div><p>&#160;</p><h4 id="BookInOnePage-ManuallyForcetheCompletionofAllAggregatedExchangesImmediately">Manually Force the Completion of All Aggregated Exchanges Immediately</h4><p><strong>Available as of Camel 2.9</strong><br clear="none"> You can manually trigger completion of all current aggregated exchanges by sending a message containing the header Exchange.AGGREGATION_COMPLETE_ALL_GROUPS set to true. The message is considered a signal message only, the message headers/contents will not be processed otherwise.</p><p><strong>Available as of Camel 2.11</strong><br clear="none"> You can alternatively set the header Exchange.AGGREGATION_COMPLETE_ALL_GROUPS_INCLUSIVE to true to trigger completion of all groups after processing the current message.</p><h4 id="BookInOnePage-UsingaList&lt;V&gt;inAggregationStrategy">Using a List&lt;V&gt; in AggregationStrategy</h4><p><strong>Available as of Camel 2.11</strong></p><p>If you want to aggregate some value from the messages &lt;V&gt; into a List&lt;V&gt; then we have added a <code>org.apache.camel.processor.aggregate.AbstractListAggregationStrategy</code> abstract class in <strong>Camel 2.11</strong> that makes this easier. The completed Exchange that is sent out of the aggregator will contain the List&lt;V&gt; in the message body.</p><p>For example to aggregate a List&lt;Integer&gt; you can extend this class as shown below, and implement the <code>getValue</code> method:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> /** * Our strategy just group a list of integers. */ public final class MyListOfNumbersStrategy extends AbstractListAggregationStrategy&amp;lt;Integer&amp;gt; { @Override public Integer getValue(Exchange exchange) { // the message body contains a number, so just return that as-is return exchange.getIn().getBody(Integer.class); } } </script> 
  </div>
 </div><h3 id="BookInOnePage-UsingAggregateController">Using AggregateController</h3><p><strong>Available as of Camel 2.16</strong></p><p>The&#160;<code>org.apache.camel.processor.aggregate.AggregateController</code> allows you to control the aggregate at runtime using Java or JMX API. This can be used to force completing groups of exchanges, or query its current runtime statistics.</p><p>The aggregator provides a default implementation if no custom have been configured, which can be accessed using&#160;<code>getAggregateController()</code>&#160;method. Though it may be easier to configure a controller in the route using aggregateController as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">private AggregateController controller = new DefaultAggregateController(); &nbsp; from(&amp;quot;direct:start&amp;quot;) .aggregate(header(&amp;quot;id&amp;quot;), new MyAggregationStrategy()).completionSize(10).id(&amp;quot;myAggregator&amp;quot;) .aggregateController(controller) .to(&amp;quot;mock:aggregated&amp;quot;);</script> 
 </div>
</div><p>Then there is API on AggregateController to force completion. For example to complete a group with key foo</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">int groups = controller.forceCompletionOfGroup(&amp;quot;foo&amp;quot;);</script> 
 </div>
</div><p>The number return would be the number of groups completed. In this case it would be 1 if the foo group existed and was completed. If foo does not exists then 0 is returned.</p><p>There is also an api to complete all groups</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">int groups = controller.forceCompletionOfAllGroups();</script> 
 </div>
</div><p>&#160;</p><p>To configure this from XML DSL</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;myController&amp;quot; class=&amp;quot;org.apache.camel.processor.aggregate.DefaultAggregateController&amp;quot;/&amp;gt; &nbsp; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;aggregate strategyRef=&amp;quot;myAppender&amp;quot; completionSize=&amp;quot;10&amp;quot; aggregateControllerRef=&amp;quot;myController&amp;quot;&amp;gt; &amp;lt;correlationExpression&amp;gt; &amp;lt;header&amp;gt;id&amp;lt;/header&amp;gt; &amp;lt;/correlationExpression&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/aggregate&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt;</script> 
 </div>
</div><p>&#160;</p><p>There is also JMX API on the aggregator which is available under the processors node in the Camel JMX tree.</p><p>&#160;</p><h3 id="BookInOnePage-UsingGroupedExchanges">Using GroupedExchanges</h3><p>In the route below we group all the exchanges together using <code>groupExchanges()</code>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) // aggregate all using same expression .aggregate(constant(true)) // wait for 0.5 seconds to aggregate .completionTimeout(500L) // group the exchanges so we get one single exchange containing all the others .groupExchanges() .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>As a result we have one outgoing <a shape="rect" href="exchange.html">Exchange</a> being routed the the "mock:result" endpoint. The exchange is a holder containing all the incoming Exchanges.<br clear="none"> To get access to these exchanges you need to access them from a property on the outgoing exchange as shown:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">List&amp;lt;Exchange&amp;gt; grouped = out.getProperty(Exchange.GROUPED_EXCHANGE, List.class); </script> 
 </div>
</div><p>From <strong>Camel 2.13</strong> onwards this behavior has changed to store these exchanges directly on the message body which is more intuitive:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">List&amp;lt;Exchange&amp;gt; grouped = exchange.getIn().getBody(List.class); </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-information">
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Notice the old way using the property is still present in <strong>Camel 2.13</strong> onwards, but its considered deprecated and to be removed in Camel 3.0 onwards.</p>
 </div>
</div><h3 id="BookInOnePage-UsingPOJOsasAggregationStrategy">Using POJOs as AggregationStrategy</h3><p><strong>Available as of Camel 2.12</strong></p><div class="confluence-information-macro confluence-information-macro-tip">
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>You can use POJOs as AggregationStrategy with the other <a shape="rect" href="eip.html">EIP</a>s that supports aggregation, such as <a shape="rect" href="splitter.html">Splitter</a>, <a shape="rect" href="recipient-list.html">Recipient List</a>, etc.</p>
 </div>
</div><p>To use the <code>AggregationStrategy</code> you had to implement the <code>org.apache.camel.processor.aggregate.AggregationStrategy</code> interface, which means your logic would be tied to the Camel API. From <strong>Camel 2.12</strong> onwards you can use a POJO for the logic and let Camel adapt to your POJO. To use a POJO a convention must be followed:</p><ul class="alternate"><li>there must be a public method to use</li><li>the method must not be void</li><li>the method can be static or non-static</li><li>the method must have 2 or more parameters</li><li>the parameters is paired so the first 50% is applied to the <code>oldExchange</code> and the reminder 50% is for the <code>newExchange</code></li><li>.. meaning that there must be an equal number of parameters, eg 2, 4, 6 etc.</li></ul><p>The paired methods is expected to be ordered as follows:</p><ul class="alternate"><li>the first parameter is the message body</li><li>the 2nd parameter is a Map of the headers</li><li>the 3rd parameter is a Map of the Exchange properties</li></ul><p>This convention is best explained with some examples.</p><p>In the method below, we have only 2 parameters, so the 1st parameter is the body of the <code>oldExchange</code>, and the 2nd is paired to the body of the <code>newExchange</code>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public String append(String existing, String next) { return existing + next; } </script> 
 </div>
</div><p>In the method below, we have only 4 parameters, so the 1st parameter is the body of the <code>oldExchange</code>, and the 2nd is the Map of the <code>oldExchange} headers, and the 3rd is paired to the body of the {{newExchange</code>, and the 4th parameter is the Map of the <code>newExchange</code> headers:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public String append(String existing, Map existingHeaders, String next, Map nextHeaders) { return existing + next; } </script> 
 </div>
</div><p>And finally if we have 6 parameters the we also have the properties of the <a shape="rect" href="exchange.html">Exchange</a>s:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public String append(String existing, Map existingHeaders, Map existingProperties, String next, Map nextHeaders, Map nextProperties) { return existing + next; } </script> 
 </div>
</div><p>To use this with the <a shape="rect" href="aggregator2.html">Aggregate</a> EIP we can use a POJO with the aggregate logic as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public class MyBodyAppender { public String append(String existing, String next) { return next + existing; } } </script> 
 </div>
</div><p>And then in the Camel route we create an instance of our bean, and then refer to the bean in the route using <code>bean</code> method from <code>org.apache.camel.util.toolbox.AggregationStrategies</code> as shown:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> private MyBodyAppender appender = new MyBodyAppender(); public void configure() throws Exception { from(&amp;quot;direct:start&amp;quot;) .aggregate(constant(true), AggregationStrategies.bean(appender, &amp;quot;append&amp;quot;)) .completionSize(3) .to(&amp;quot;mock:result&amp;quot;); } </script> 
 </div>
</div><p>We can also provide the bean type directly:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public void configure() throws Exception { from(&amp;quot;direct:start&amp;quot;) .aggregate(constant(true), AggregationStrategies.bean(MyBodyAppender.class, &amp;quot;append&amp;quot;)) .completionSize(3) .to(&amp;quot;mock:result&amp;quot;); } </script> 
 </div>
</div><p>And if the bean has only one method we do not need to specify the name of the method:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public void configure() throws Exception { from(&amp;quot;direct:start&amp;quot;) .aggregate(constant(true), AggregationStrategies.bean(MyBodyAppender.class)) .completionSize(3) .to(&amp;quot;mock:result&amp;quot;); } </script> 
 </div>
</div><p>And the <code>append</code> method could be static:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public class MyBodyAppender { public static String append(String existing, String next) { return next + existing; } } </script> 
 </div>
</div><p>If you are using XML DSL then we need to declare a &lt;bean&gt; with the POJO:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;myAppender&amp;quot; class=&amp;quot;com.foo.MyBodyAppender&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>And in the Camel route we use <code>strategyRef</code> to refer to the bean by its id, and the <code>strategyMethodName</code> can be used to define the method name to call:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;aggregate strategyRef=&amp;quot;myAppender&amp;quot; strategyMethodName=&amp;quot;append&amp;quot; completionSize=&amp;quot;3&amp;quot;&amp;gt; &amp;lt;correlationExpression&amp;gt; &amp;lt;constant&amp;gt;true&amp;lt;/constant&amp;gt; &amp;lt;/correlationExpression&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/aggregate&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><p>When using XML DSL you must define the POJO as a &lt;bean&gt;.</p><h4 id="BookInOnePage-Aggregatingwhennodata">Aggregating when no data</h4><p>By default when using POJOs as AggregationStrategy, then the method is <strong>only</strong> invoked when there is data to be aggregated (by default). You can use the option <code>strategyMethodAllowNull</code> to configure this. Where as without using POJOs then you may have <code>null</code> as <code>oldExchange</code> or <code>newExchange</code> parameters. For example the <a shape="rect" href="aggregator2.html">Aggregate</a> EIP will invoke the <code>AggregationStrategy</code> with <code>oldExchange</code> as null, for the first <a shape="rect" href="exchange.html">Exchange</a> incoming to the aggregator. And then for subsequent <a shape="rect" href="exchange.html">Exchange</a>s then <code>oldExchange</code> and <code>newExchange</code> parameters are both not null.</p><h5 id="BookInOnePage-Examplewithandnodata">Example with <a shape="rect" href="content-enricher.html">Content Enricher</a> and no data</h5><p>Though with POJOs as AggregationStrategy we made this simpler and only call the method when <code>oldExchange</code> and <code>newExchange</code> is not null, as that would be the most common use-case. If you need to allow <code>oldExchange</code> or <code>newExchange</code> to be null, then you can configure this with the POJO using the <code>AggregationStrategyBeanAdapter</code> as shown below. On the bean adapter we call <code>setAllowNullNewExchange</code> to allow the new exchange to be null.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public void configure() throws Exception { AggregationStrategyBeanAdapter myStrategy = new AggregationStrategyBeanAdapter(appender, &amp;quot;append&amp;quot;); myStrategy.setAllowNullOldExchange(true); myStrategy.setAllowNullNewExchange(true); from(&amp;quot;direct:start&amp;quot;) .pollEnrich(&amp;quot;seda:foo&amp;quot;, 1000, myStrategy) .to(&amp;quot;mock:result&amp;quot;); } </script> 
 </div>
</div><p>This can be configured a bit easier using the <code>beanAllowNull</code> method from <code>AggregationStrategies</code> as shown:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public void configure() throws Exception { from(&amp;quot;direct:start&amp;quot;) .pollEnrich(&amp;quot;seda:foo&amp;quot;, 1000, AggregationStrategies.beanAllowNull(appender, &amp;quot;append&amp;quot;)) .to(&amp;quot;mock:result&amp;quot;); } </script> 
 </div>
</div><p>Then the <code>append</code> method in the POJO would need to deal with the situation that <code>newExchange</code> can be null:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public class MyBodyAppender { public String append(String existing, String next) { if (next == null) { return &amp;quot;NewWasNull&amp;quot; + existing; } else { return existing + next; } } } </script> 
 </div>
</div><p>In the example above we use the <a shape="rect" href="content-enricher.html">Content Enricher</a> EIP using <code>pollEnrich</code>. The <code>newExchange</code> will be null in the situation we could not get any data from the "seda:foo" endpoint, and therefore the timeout was hit after 1 second. So if we need to do some special merge logic we would need to set <code>setAllowNullNewExchange=true</code>, so the <code>append</code> method will be invoked. If we do not do that then when the timeout was hit, then the append method would normally not be invoked, meaning the <a shape="rect" href="content-enricher.html">Content Enricher</a> did not merge/change the message.</p><p>In XML DSL you would configure the <code>strategyMethodAllowNull</code> option and set it to true as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;aggregate strategyRef=&amp;quot;myAppender&amp;quot; strategyMethodName=&amp;quot;append&amp;quot; strategyMethodAllowNull=&amp;quot;true&amp;quot; completionSize=&amp;quot;3&amp;quot;&amp;gt; &amp;lt;correlationExpression&amp;gt; &amp;lt;constant&amp;gt;true&amp;lt;/constant&amp;gt; &amp;lt;/correlationExpression&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/aggregate&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><h5 id="BookInOnePage-Differentbodytypes">Different body types</h5><p>When for example using <code>strategyMethodAllowNull</code> as true, then the parameter types of the message bodies does not have to be the same. For example suppose we want to aggregate from a <code>com.foo.User</code> type to a <code>List&lt;String&gt;</code> that contains the user name. We could code a POJO doing this as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public static final class MyUserAppender { public List addUsers(List names, User user) { if (names == null) { names = new ArrayList(); } names.add(user.getName()); return names; } } </script> 
 </div>
</div><p>Notice that the return type is a List which we want to contain the user names. The 1st parameter is the list of names, and then notice the 2nd parameter is the incoming <code>com.foo.User</code> type.</p><h3 id="BookInOnePage-Seealso.1">See also</h3><ul class="alternate"><li>The <a shape="rect" href="loan-broker-example.html">Loan Broker Example</a> which uses an aggregator</li><li><a shape="rect" class="external-link" href="http://tmielke.blogspot.com/2009/01/using-camel-aggregator-correctly.html" rel="nofollow">Blog post by Torsten Mielke</a> about using the aggregator correctly.</li><li>The old <a shape="rect" href="aggregator.html">Aggregator</a></li><li><a shape="rect" href="hawtdb.html">HawtDB</a>, <a shape="rect" href="leveldb.html">LevelDB</a> or <a shape="rect" href="sql-component.html">SQL Component</a> for persistence support</li><li><a shape="rect" href="aggregate-example.html">Aggregate Example</a> for an example application</li></ul><h3 id="BookInOnePage-Resequencer">Resequencer</h3><p>The <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/Resequencer.html" rel="nofollow">Resequencer</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> allows you to reorganise messages based on some comparator. By default in Camel we use an <a shape="rect" href="expression.html">Expression</a> to create the comparator; so that you can compare by a message header or the body or a piece of a message etc.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/Resequencer.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/Resequencer.gif"></span></p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Change in Camel 2.7</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The <code>&lt;batch-config&gt;</code> and <code>&lt;stream-config&gt;</code> tags in XML DSL in the Resequencer EIP must now be configured in the top, and not in the bottom. So if you use those, then move them up just below the <code>&lt;resequence&gt;</code> EIP starts in the XML. If you are using Camel older than 2.7, then those configs should be at the bottom.</p>
 </div>
</div><p>Camel supports two resequencing algorithms:</p><ul><li><strong>Batch resequencing</strong> collects messages into a batch, sorts the messages and sends them to their output.</li><li><strong>Stream resequencing</strong> re-orders (continuous) message streams based on the detection of gaps between messages.</li></ul><p>By default the <a shape="rect" href="resequencer.html">Resequencer</a> does not support duplicate messages and will only keep the last message, in case a message arrives with the same message expression. However in the batch mode you can enable it to allow duplicates.</p><h3 id="BookInOnePage-BatchResequencing">Batch Resequencing</h3><p>The following example shows how to use the batch-processing resequencer so that messages are sorted in order of the <strong>body()</strong> expression. That is messages are collected into a batch (either by a maximum number of messages per batch or using a timeout) then they are sorted in order and then sent out to their output.</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong>
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) .resequence().body() .to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>This is equivalent to<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .resequence(body()).batch() .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>The batch-processing resequencer can be further configured via the <code>size()</code> and <code>timeout()</code> methods.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .resequence(body()).batch().size(300).timeout(4000L) .to(&amp;quot;mock:result&amp;quot;) </script> 
 </div>
</div><p>This sets the batch size to 300 and the batch timeout to 4000 ms (by default, the batch size is 100 and the timeout is 1000 ms). Alternatively, you can provide a configuration object.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .resequence(body()).batch(new BatchResequencerConfig(300, 4000L)) .to(&amp;quot;mock:result&amp;quot;) </script> 
 </div>
</div><p>So the above example will reorder messages from endpoint <strong>direct:a</strong> in order of their bodies, to the endpoint <strong>mock:result</strong>. <br clear="none"> Typically you'd use a header rather than the body to order things; or maybe a part of the body. So you could replace this expression with</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">resequencer(header(&amp;quot;mySeqNo&amp;quot;)) </script> 
 </div>
</div><p>for example to reorder messages using a custom sequence number in the header <code>mySeqNo</code>.</p><p>You can of course use many different <a shape="rect" href="expression.html">Expression</a> languages such as <a shape="rect" href="xpath.html">XPath</a>, <a shape="rect" href="xquery.html">XQuery</a>, <a shape="rect" href="sql.html">SQL</a> or various <a shape="rect" href="scripting-languages.html">Scripting Languages</a>.</p><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext id=&amp;quot;camel&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot; /&amp;gt; &amp;lt;resequence&amp;gt; &amp;lt;simple&amp;gt;body&amp;lt;/simple&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot; /&amp;gt; &amp;lt;!-- batch-config can be ommitted for default (batch) resequencer settings --&amp;gt; &amp;lt;batch-config batchSize=&amp;quot;300&amp;quot; batchTimeout=&amp;quot;4000&amp;quot; /&amp;gt; &amp;lt;/resequence&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-AllowDuplicates">Allow Duplicates</h4><p><strong>Available as of Camel 2.4</strong></p><p>In the <code>batch</code> mode, you can now allow duplicates. In Java DSL there is a <code>allowDuplicates()</code> method and in Spring XML there is an <code>allowDuplicates=true</code> attribute on the <code>&lt;batch-config/&gt;</code> you can use to enable it.</p><h4 id="BookInOnePage-Reverse">Reverse</h4><p><strong>Available as of Camel 2.4</strong></p><p>In the <code>batch</code> mode, you can now reverse the expression ordering. By default the order is based on 0..9,A..Z, which would let messages with low numbers be ordered first, and thus also also outgoing first. In some cases you want to reverse order, which is now possible.</p><p>In Java DSL there is a <code>reverse()</code> method and in Spring XML there is an <code>reverse=true</code> attribute on the <code>&lt;batch-config/&gt;</code> you can use to enable it.</p><h4 id="BookInOnePage-ResequenceJMSmessagesbasedonJMSPriority">Resequence JMS messages based on JMSPriority</h4><p><strong>Available as of Camel 2.4</strong></p><p>It's now much easier to use the <a shape="rect" href="resequencer.html">Resequencer</a> to resequence messages from <a shape="rect" href="jms.html">JMS</a> queues based on <code>JMSPriority</code>. For that to work you need to use the two new options <code>allowDuplicates</code> and <code>reverse</code>.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;jms:queue:foo&amp;quot;) // sort by JMSPriority by allowing duplicates (message can have same JMSPriority) // and use reverse ordering so 9 is first output (most important), and 0 is last // use batch mode and fire every 3th second .resequence(header(&amp;quot;JMSPriority&amp;quot;)).batch().timeout(3000).allowDuplicates().reverse() .to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>Notice this is <strong>only</strong> possible in the <code>batch</code> mode of the <a shape="rect" href="resequencer.html">Resequencer</a>.<h4 id="BookInOnePage-Ignoreinvalidexchanges">Ignore invalid exchanges</h4><p><strong>Available as of Camel 2.9</strong></p><p>The <a shape="rect" href="resequencer.html">Resequencer</a> EIP will from Camel 2.9 onwards throw a <code>CamelExchangeException</code> if the incoming <a shape="rect" href="exchange.html">Exchange</a> is not valid for the resequencer - ie. the expression cannot be evaluated, such as a missing header. You can use the option <code>ignoreInvalidExchanges</code> to ignore these exceptions which means the <a shape="rect" href="resequencer.html">Resequencer</a> will then skip the invalid <a shape="rect" href="exchange.html">Exchange</a>.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) .resequence(header(&amp;quot;seqno&amp;quot;)).batch().timeout(1000) // ignore invalid exchanges (they are discarded) .ignoreInvalidExchanges() .to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>This option is available for both batch and stream resequencer.<h4 id="BookInOnePage-RejectOldExchanges">Reject Old Exchanges</h4><p><strong>Available as of Camel 2.11</strong></p><p>This option can be used to prevent out of order messages from being sent regardless of the event that delivered messages downstream (capacity, timeout, etc). If enabled using <code>rejectOld()</code>, the <a shape="rect" href="resequencer.html">Resequencer</a> will throw a <code>MessageRejectedException</code> when an incoming <a shape="rect" href="exchange.html">Exchange</a> is "older" (based on the Comparator) than the last delivered message. This provides an extra level of control with regards to delayed message ordering.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .onException(MessageRejectedException.class).handled(true).to(&amp;quot;mock:error&amp;quot;).end() .resequence(header(&amp;quot;seqno&amp;quot;)).stream().timeout(1000).rejectOld() .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>This option is available for the stream resequencer only.</p><h3 id="BookInOnePage-StreamResequencing">Stream Resequencing</h3><p>The next example shows how to use the stream-processing resequencer. Messages are re-ordered based on their sequence numbers given by a <code>seqnum</code> header using gap detection and timeouts on the level of individual messages.</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong>
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;).resequence(header(&amp;quot;seqnum&amp;quot;)).stream().to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>The stream-processing resequencer can be further configured via the <code>capacity()</code> and <code>timeout()</code> methods.<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .resequence(header(&amp;quot;seqnum&amp;quot;)).stream().capacity(5000).timeout(4000L) .to(&amp;quot;mock:result&amp;quot;) </script> 
 </div>
</div><p>This sets the resequencer's capacity to 5000 and the timeout to 4000 ms (by default, the capacity is 1000 and the timeout is 1000 ms). Alternatively, you can provide a configuration object.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .resequence(header(&amp;quot;seqnum&amp;quot;)).stream(new StreamResequencerConfig(5000, 4000L)) .to(&amp;quot;mock:result&amp;quot;) </script> 
 </div>
</div><p>The stream-processing resequencer algorithm is based on the detection of gaps in a message stream rather than on a fixed batch size. Gap detection in combination with timeouts removes the constraint of having to know the number of messages of a sequence (i.e. the batch size) in advance. Messages must contain a unique sequence number for which a predecessor and a successor is known. For example a message with the sequence number 3 has a predecessor message with the sequence number 2 and a successor message with the sequence number 4. The message sequence 2,3,5 has a gap because the successor of 3 is missing. The resequencer therefore has to retain message 5 until message 4 arrives (or a timeout occurs).</p><p>If the maximum time difference between messages (with successor/predecessor relationship with respect to the sequence number) in a message stream is known, then the resequencer's timeout parameter should be set to this value. In this case it is guaranteed that all messages of a stream are delivered in correct order to the next processor. The lower the timeout value is compared to the out-of-sequence time difference the higher is the probability for out-of-sequence messages delivered by this resequencer. Large timeout values should be supported by sufficiently high capacity values. The capacity parameter is used to prevent the resequencer from running out of memory.</p><p>By default, the stream resequencer expects <code>long</code> sequence numbers but other sequence numbers types can be supported as well by providing a custom expression.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public class MyFileNameExpression implements Expression { public String getFileName(Exchange exchange) { return exchange.getIn().getBody(String.class); } public Object evaluate(Exchange exchange) { // parser the file name with YYYYMMDD-DNNN pattern String fileName = getFileName(exchange); String[] files = fileName.split(&amp;quot;-D&amp;quot;); Long answer = Long.parseLong(files[0]) * 1000 + Long.parseLong(files[1]); return answer; } public &amp;lt;T&amp;gt; T evaluate(Exchange exchange, Class&amp;lt;T&amp;gt; type) { Object result = evaluate(exchange); return exchange.getContext().getTypeConverter().convertTo(type, result); } } </script> 
  </div>
 </div>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;).resequence(new MyFileNameExpression()).stream().timeout(100).to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>or custom comparator via the <code>comparator()</code> method<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">ExpressionResultComparator&amp;lt;Exchange&amp;gt; comparator = new MyComparator(); from(&amp;quot;direct:start&amp;quot;) .resequence(header(&amp;quot;seqnum&amp;quot;)).stream().comparator(comparator) .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>or via a <code>StreamResequencerConfig</code> object.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">ExpressionResultComparator&amp;lt;Exchange&amp;gt; comparator = new MyComparator(); StreamResequencerConfig config = new StreamResequencerConfig(100, 1000L, comparator); from(&amp;quot;direct:start&amp;quot;) .resequence(header(&amp;quot;seqnum&amp;quot;)).stream(config) .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext id=&amp;quot;camel&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;resequence&amp;gt; &amp;lt;simple&amp;gt;in.header.seqnum&amp;lt;/simple&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot; /&amp;gt; &amp;lt;stream-config capacity=&amp;quot;5000&amp;quot; timeout=&amp;quot;4000&amp;quot;/&amp;gt; &amp;lt;/resequence&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-FurtherExamples">Further Examples</h3><p>For further examples of this pattern in use you could look at the <a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/ResequencerTest.java?view=markup">batch-processing resequencer junit test case</a> and the <a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/StreamResequencerTest.java?view=markup">stream-processing resequencer junit test case</a></p><p></p><h4 id="BookInOnePage-UsingThisPattern.20">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-ComposedMessageProcessor">Composed Message Processor</h3><p>The <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/DistributionAggregate.html" rel="nofollow">Composed Message Processor</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> allows you to process a composite message by splitting it up, routing the sub-messages to appropriate destinations and the re-aggregating the responses back into a single message.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/DistributionAggregate.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/DistributionAggregate.gif"></span></p><p>In Camel we provide two solutions</p><ul class="alternate"><li>using both a <a shape="rect" href="splitter.html">Splitter</a> and <a shape="rect" href="aggregator2.html">Aggregator</a> EIPs</li><li>using only a <a shape="rect" href="splitter.html">Splitter</a></li></ul><p>The difference is when using only a <a shape="rect" href="splitter.html">Splitter</a> it aggregates back all the splitted messages into the same aggregation group, eg like a fork/join pattern.<br clear="none"> Whereas using the <a shape="rect" href="aggregator2.html">Aggregator</a> allows you group into multiple groups, a pattern which provides more options.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body"> 
  <p>Using the splitter alone is often easier and possibly a better solution. So take a look at this first, before involving the aggregator.</p>
 </div>
</div><h3 id="BookInOnePage-ExampleusingbothSplitterandAggregator">Example using both Splitter and Aggregator</h3><p>In this example we want to check that a multipart order can be filled. Each part of the order requires a check at a different inventory.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // split up the order so individual OrderItems can be validated by the appropriate bean from(&amp;quot;direct:start&amp;quot;) .split().body() .choice() .when().method(&amp;quot;orderItemHelper&amp;quot;, &amp;quot;isWidget&amp;quot;) .to(&amp;quot;bean:widgetInventory&amp;quot;) .otherwise() .to(&amp;quot;bean:gadgetInventory&amp;quot;) .end() .to(&amp;quot;seda:aggregate&amp;quot;); // collect and re-assemble the validated OrderItems into an order again from(&amp;quot;seda:aggregate&amp;quot;) .aggregate(new MyOrderAggregationStrategy()).header(&amp;quot;orderId&amp;quot;).completionTimeout(1000L) .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;split&amp;gt; &amp;lt;simple&amp;gt;body&amp;lt;/simple&amp;gt; &amp;lt;choice&amp;gt; &amp;lt;when&amp;gt; &amp;lt;method bean=&amp;quot;orderItemHelper&amp;quot; method=&amp;quot;isWidget&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:widgetInventory&amp;quot;/&amp;gt; &amp;lt;/when&amp;gt; &amp;lt;otherwise&amp;gt; &amp;lt;to uri=&amp;quot;bean:gadgetInventory&amp;quot;/&amp;gt; &amp;lt;/otherwise&amp;gt; &amp;lt;/choice&amp;gt; &amp;lt;to uri=&amp;quot;seda:aggregate&amp;quot;/&amp;gt; &amp;lt;/split&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;seda:aggregate&amp;quot;/&amp;gt; &amp;lt;aggregate strategyRef=&amp;quot;myOrderAggregatorStrategy&amp;quot; completionTimeout=&amp;quot;1000&amp;quot;&amp;gt; &amp;lt;correlationExpression&amp;gt; &amp;lt;simple&amp;gt;header.orderId&amp;lt;/simple&amp;gt; &amp;lt;/correlationExpression&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/aggregate&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>To do this we split up the order using a <a shape="rect" href="splitter.html">Splitter</a>. The <a shape="rect" href="splitter.html">Splitter</a> then sends individual <code>OrderItems</code> to a <a shape="rect" href="content-based-router.html">Content Based Router</a> which checks the item type. Widget items get sent for checking in the <code>widgetInventory</code> bean and gadgets get sent to the <code>gadgetInventory</code> bean. Once these <code>OrderItems</code> have been validated by the appropriate bean, they are sent on to the <a shape="rect" href="aggregator2.html">Aggregator</a> which collects and re-assembles the validated <code>OrderItems</code> into an order again.</p><p>When an order is sent it contains a header with the order id. We use this fact when we aggregate, as we configure this <code>.header("orderId")</code> on the <code>aggregate</code> DSL to instruct Camel to use the header with the key <code>orderId</code> as correlation expression.</p><p>For full details, check the example source here:</p><p><a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/ComposedMessageProcessorTest.java">camel-core/src/test/java/org/apache/camel/processor/ComposedMessageProcessorTest.java</a></p><h3 id="BookInOnePage-ExampleusingonlySplitter">Example using only Splitter</h3><p>In this example we want to split an incoming order using the <a shape="rect" href="splitter.html">Splitter</a> eip, transform each order line, and then combine the order lines into a new order message.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // this routes starts from the direct:start endpoint // the body is then splitted based on @ separator // the splitter in Camel supports InOut as well and for that we need // to be able to aggregate what response we need to send back, so we provide our // own strategy with the class MyOrderStrategy. from(&amp;quot;direct:start&amp;quot;) .split(body().tokenize(&amp;quot;@&amp;quot;), new MyOrderStrategy()) // each splitted message is then send to this bean where we can process it .to(&amp;quot;bean:MyOrderService?method=handleOrder&amp;quot;) // this is important to end the splitter route as we do not want to do more routing // on each splitted message .end() // after we have splitted and handled each message we want to send a single combined // response back to the original caller, so we let this bean build it for us // this bean will receive the result of the aggregate strategy: MyOrderStrategy .to(&amp;quot;bean:MyOrderService?method=buildCombinedResponse&amp;quot;) </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Using XML</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body"> 
  <p>If you use XML, then the &lt;split&gt; tag offers the strategyRef attribute to refer to your custom <code>AggregationStrategy</code></p>
 </div>
</div><p>The bean with the methods to transform the order line and process the order as well:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public static class MyOrderService { private static int counter; /** * We just handle the order by returning a id line for the order */ public String handleOrder(String line) { LOG.debug(&amp;quot;HandleOrder: &amp;quot; + line); return &amp;quot;(id=&amp;quot; + ++counter + &amp;quot;,item=&amp;quot; + line + &amp;quot;)&amp;quot;; } /** * We use the same bean for building the combined response to send * back to the original caller */ public String buildCombinedResponse(String line) { LOG.debug(&amp;quot;BuildCombinedResponse: &amp;quot; + line); return &amp;quot;Response[&amp;quot; + line + &amp;quot;]&amp;quot;; } } </script> 
 </div>
</div><p>And the <code>AggregationStrategy</code> we use with the <a shape="rect" href="splitter.html">Splitter</a> eip to combine the orders back again (eg fork/join):</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> /** * This is our own order aggregation strategy where we can control * how each splitted message should be combined. As we do not want to * loos any message we copy from the new to the old to preserve the * order lines as long we process them */ public static class MyOrderStrategy implements AggregationStrategy { public Exchange aggregate(Exchange oldExchange, Exchange newExchange) { // put order together in old exchange by adding the order from new exchange if (oldExchange == null) { // the first time we aggregate we only have the new exchange, // so we just return it return newExchange; } String orders = oldExchange.getIn().getBody(String.class); String newLine = newExchange.getIn().getBody(String.class); LOG.debug(&amp;quot;Aggregate old orders: &amp;quot; + orders); LOG.debug(&amp;quot;Aggregate new order: &amp;quot; + newLine); // put orders together separating by semi colon orders = orders + &amp;quot;;&amp;quot; + newLine; // put combined order back on old to preserve it oldExchange.getIn().setBody(orders); // return old as this is the one that has all the orders gathered until now return oldExchange; } } </script> 
 </div>
</div><h4 id="BookInOnePage-UsingThisPattern.21">Using This Pattern</h4><p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-Scatter-Gather">Scatter-Gather</h3><p>The <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/BroadcastAggregate.html" rel="nofollow">Scatter-Gather</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> allows you to route messages to a number of dynamically specified recipients and re-aggregate the responses back into a single message.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/BroadcastAggregate.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/BroadcastAggregate.gif"></span></p><h4 id="BookInOnePage-DynamicScatter-GatherExample">Dynamic Scatter-Gather Example</h4><p>In this example we want to get the best quote for beer from several different vendors. We use a dynamic <a shape="rect" href="recipient-list.html">Recipient List</a> to get the request for a quote to all vendors and an <a shape="rect" href="aggregator.html">Aggregator</a> to pick the best quote out of all the responses. The routes for this are defined as:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;recipientList&amp;gt; &amp;lt;header&amp;gt;listOfVendors&amp;lt;/header&amp;gt; &amp;lt;/recipientList&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;seda:quoteAggregator&amp;quot;/&amp;gt; &amp;lt;aggregate strategyRef=&amp;quot;aggregatorStrategy&amp;quot; completionTimeout=&amp;quot;1000&amp;quot;&amp;gt; &amp;lt;correlationExpression&amp;gt; &amp;lt;header&amp;gt;quoteRequestId&amp;lt;/header&amp;gt; &amp;lt;/correlationExpression&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/aggregate&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><p>So in the first route you see that the <a shape="rect" href="recipient-list.html">Recipient List</a> is looking at the <code>listOfVendors</code> header for the list of recipients. So, we need to send a message like</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> Map&amp;lt;String, Object&amp;gt; headers = new HashMap&amp;lt;String, Object&amp;gt;(); headers.put(&amp;quot;listOfVendors&amp;quot;, &amp;quot;bean:vendor1, bean:vendor2, bean:vendor3&amp;quot;); headers.put(&amp;quot;quoteRequestId&amp;quot;, &amp;quot;quoteRequest-1&amp;quot;); template.sendBodyAndHeaders(&amp;quot;direct:start&amp;quot;, &amp;quot;&amp;lt;quote_request item=\&amp;quot;beer\&amp;quot;/&amp;gt;&amp;quot;, headers); </script> 
 </div>
</div><p>This message will be distributed to the following <a shape="rect" href="endpoint.html">Endpoint</a>s: <code>bean:vendor1</code>, <code>bean:vendor2</code>, and <code>bean:vendor3</code>. These are all beans which look like</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public class MyVendor { private int beerPrice; @Produce(uri = &amp;quot;seda:quoteAggregator&amp;quot;) private ProducerTemplate quoteAggregator; public MyVendor(int beerPrice) { this.beerPrice = beerPrice; } public void getQuote(@XPath(&amp;quot;/quote_request/@item&amp;quot;) String item, Exchange exchange) throws Exception { if (&amp;quot;beer&amp;quot;.equals(item)) { exchange.getIn().setBody(beerPrice); quoteAggregator.send(exchange); } else { throw new Exception(&amp;quot;No quote available for &amp;quot; + item); } } } </script> 
 </div>
</div><p>and are loaded up in Spring like</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;aggregatorStrategy&amp;quot; class=&amp;quot;org.apache.camel.spring.processor.scattergather.LowestQuoteAggregationStrategy&amp;quot;/&amp;gt; &amp;lt;bean id=&amp;quot;vendor1&amp;quot; class=&amp;quot;org.apache.camel.spring.processor.scattergather.MyVendor&amp;quot;&amp;gt; &amp;lt;constructor-arg&amp;gt; &amp;lt;value&amp;gt;1&amp;lt;/value&amp;gt; &amp;lt;/constructor-arg&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;vendor2&amp;quot; class=&amp;quot;org.apache.camel.spring.processor.scattergather.MyVendor&amp;quot;&amp;gt; &amp;lt;constructor-arg&amp;gt; &amp;lt;value&amp;gt;2&amp;lt;/value&amp;gt; &amp;lt;/constructor-arg&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;vendor3&amp;quot; class=&amp;quot;org.apache.camel.spring.processor.scattergather.MyVendor&amp;quot;&amp;gt; &amp;lt;constructor-arg&amp;gt; &amp;lt;value&amp;gt;3&amp;lt;/value&amp;gt; &amp;lt;/constructor-arg&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>Each bean is loaded with a different price for beer. When the message is sent to each bean endpoint, it will arrive at the <code>MyVendor.getQuote</code> method. This method does a simple check whether this quote request is for beer and then sets the price of beer on the exchange for retrieval at a later step. The message is forwarded on to the next step using <a shape="rect" href="pojo-producing.html">POJO Producing</a> (see the @Produce annotation).</p><p>At the next step we want to take the beer quotes from all vendors and find out which one was the best (i.e. the lowest!). To do this we use an <a shape="rect" href="aggregator.html">Aggregator</a> with a custom aggregation strategy. The <a shape="rect" href="aggregator.html">Aggregator</a> needs to be able to compare only the messages from this particular quote; this is easily done by specifying a correlationExpression equal to the value of the quoteRequestId header. As shown above in the message sending snippet, we set this header to <code>quoteRequest-1</code>. This correlation value should be unique or you may include responses that are not part of this quote. To pick the lowest quote out of the set, we use a custom aggregation strategy like </p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public class LowestQuoteAggregationStrategy implements AggregationStrategy { public Exchange aggregate(Exchange oldExchange, Exchange newExchange) { // the first time we only have the new exchange if (oldExchange == null) { return newExchange; } if (oldExchange.getIn().getBody(int.class) &amp;lt; newExchange.getIn().getBody(int.class)) { return oldExchange; } else { return newExchange; } } } </script> 
 </div>
</div><p>Finally, we expect to get the lowest quote of $1 out of $1, $2, and $3.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> result.expectedBodiesReceived(1); // expect the lowest quote </script> 
 </div>
</div><p>You can find the full example source here:</p><p><a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-spring/src/test/java/org/apache/camel/spring/processor/scattergather/">camel-spring/src/test/java/org/apache/camel/spring/processor/scattergather/</a><br clear="none"> <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-spring/src/test/resources/org/apache/camel/spring/processor/scattergather/scatter-gather.xml">camel-spring/src/test/resources/org/apache/camel/spring/processor/scattergather/scatter-gather.xml</a></p><h4 id="BookInOnePage-StaticScatter-GatherExample">Static Scatter-Gather Example</h4><p>You can lock down which recipients are used in the Scatter-Gather by using a static <a shape="rect" href="recipient-list.html">Recipient List</a>. It looks something like this</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;).multicast().to(&amp;quot;seda:vendor1&amp;quot;, &amp;quot;seda:vendor2&amp;quot;, &amp;quot;seda:vendor3&amp;quot;); from(&amp;quot;seda:vendor1&amp;quot;).to(&amp;quot;bean:vendor1&amp;quot;).to(&amp;quot;seda:quoteAggregator&amp;quot;); from(&amp;quot;seda:vendor2&amp;quot;).to(&amp;quot;bean:vendor2&amp;quot;).to(&amp;quot;seda:quoteAggregator&amp;quot;); from(&amp;quot;seda:vendor3&amp;quot;).to(&amp;quot;bean:vendor3&amp;quot;).to(&amp;quot;seda:quoteAggregator&amp;quot;); from(&amp;quot;seda:quoteAggregator&amp;quot;) .aggregate(header(&amp;quot;quoteRequestId&amp;quot;), new LowestQuoteAggregationStrategy()).to(&amp;quot;mock:result&amp;quot;) </script> 
 </div>
</div><p>A full example of the static Scatter-Gather configuration can be found in the <a shape="rect" href="loan-broker-example.html">Loan Broker Example</a>.</p><h4 id="BookInOnePage-UsingThisPattern.22">Using This Pattern</h4><p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-RoutingSlip">Routing Slip</h3><p>The <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/RoutingTable.html" rel="nofollow">Routing Slip</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> allows you to route a message consecutively through a series of processing steps where the sequence of steps is not known at design time and can vary for each message.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/RoutingTableSimple.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/RoutingTableSimple.gif"></span></p><h3 id="BookInOnePage-Options.12">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default Value </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>uriDelimiter</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>,</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Delimiter used if the <a shape="rect" href="expression.html">Expression</a> returned multiple endpoints. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>ignoreInvalidEndpoints</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> If an endpoint uri could not be resolved, should it be ignored. Otherwise Camel will throw an exception stating the endpoint uri is not valid. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>cacheSize</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>1000</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.13.1/2.12.4:</strong> Allows to configure the cache size for the <code>ProducerCache</code> which caches producers for reuse in the routing slip. Will by default use the default cache size which is 1000. Setting the value to -1 allows to turn off the cache all together. </p></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-Example.9">Example</h4><p>The following route will take any messages sent to the <a shape="rect" class="external-link" href="http://activemq.apache.org">Apache ActiveMQ</a> queue <strong>SomeQueue</strong> and pass them into the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/RoutingTable.html" rel="nofollow">Routing Slip</a> pattern.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:SomeQueue&amp;quot;).routingSlip(&amp;quot;aRoutingSlipHeader&amp;quot;); </script> 
 </div>
</div><p>Messages will be checked for the existance of the "aRoutingSlipHeader" header. The value of this header should be a comma-delimited list of endpoint <a shape="rect" href="uris.html">URIs</a> you wish the message to be routed to. The <a shape="rect" href="message.html">Message</a> will be routed in a <a shape="rect" href="pipes-and-filters.html">pipeline</a> fashion (i.e. one after the other).</p><p>From Camel 2.5 the <a shape="rect" href="routing-slip.html">Routing Slip</a> will set a property (<code>Exchange.SLIP_ENDPOINT</code>) on the <a shape="rect" href="exchange.html">Exchange</a> which contains the current endpoint as it advanced though the slip. This allows you to <em>know</em> how far we have processed in the slip.</p><p>The <a shape="rect" href="routing-slip.html">Routing Slip</a> will compute the slip <strong>beforehand</strong> which means, the slip is only computed once. If you need to compute the slip <em>on-the-fly</em> then use the <a shape="rect" href="dynamic-router.html">Dynamic Router</a> pattern instead.</p><h4 id="BookInOnePage-Configurationoptions">Configuration options</h4><p>Here we set the header name and the URI delimiter to something different.</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:c&amp;quot;).routingSlip(header(&amp;quot;aRoutingSlipHeader&amp;quot;), &amp;quot;#&amp;quot;); </script> 
 </div>
</div><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext id=&amp;quot;buildRoutingSlip&amp;quot; xmlns=&amp;quot;http://activemq.apache.org/camel/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:c&amp;quot;/&amp;gt; &amp;lt;routingSlip uriDelimiter=&amp;quot;#&amp;quot;&amp;gt; &amp;lt;header&amp;gt;aRoutingSlipHeader&amp;lt;/header&amp;gt; &amp;lt;/routingSlip&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Ignoreinvalidendpoints.1">Ignore invalid endpoints</h3><p><strong>Available as of Camel 2.3</strong></p><p>The <a shape="rect" href="routing-slip.html">Routing Slip</a> now supports <code>ignoreInvalidEndpoints</code> which the <a shape="rect" href="recipient-list.html">Recipient List</a> also supports. You can use it to skip endpoints which are invalid.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:a&amp;quot;).routingSlip(&amp;quot;myHeader&amp;quot;).ignoreInvalidEndpoints(); </script> 
 </div>
</div><p>And in Spring XML its an attribute on the recipient list tag.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:a&amp;quot;/&amp;gt; &amp;lt;routingSlip ignoreInvalidEndpoints=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;header&amp;gt;myHeader&amp;lt;/header&amp;gt; &amp;lt;/routingSlip&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>Then lets say the <code>myHeader</code> contains the following two endpoints <code>direct:foo,xxx:bar</code>. The first endpoint is valid and works. However the 2nd is invalid and will just be ignored. Camel logs at INFO level, so you can see why the endpoint was invalid.</p><h3 id="BookInOnePage-Expressionsupporting">Expression supporting</h3><p><strong>Available as of Camel 2.4</strong></p><p>The <a shape="rect" href="routing-slip.html">Routing Slip</a> now supports to take the expression parameter as the <a shape="rect" href="recipient-list.html">Recipient List</a> does. You can tell Camel the expression that you want to use to get the routing slip.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:a&amp;quot;).routingSlip(header(&amp;quot;myHeader&amp;quot;)).ignoreInvalidEndpoints(); </script> 
 </div>
</div><p>And in Spring XML its an attribute on the recipient list tag.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:a&amp;quot;/&amp;gt; &amp;lt;!--NOTE from Camel 2.4.0, you need to specify the expression element inside of the routingSlip element --&amp;gt; &amp;lt;routingSlip ignoreInvalidEndpoints=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;header&amp;gt;myHeader&amp;lt;/header&amp;gt; &amp;lt;/routingSlip&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-FurtherExamples.1">Further Examples</h4><p>For further examples of this pattern in use you could look at the <a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/routingslip">routing slip test cases</a>.</p><p></p><h4 id="BookInOnePage-UsingThisPattern.23">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-Throttler">Throttler</h3><p>The Throttler Pattern allows you to ensure that a specific endpoint does not get overloaded, or that we don't exceed an agreed SLA with some external service.</p><h3 id="BookInOnePage-Options.13">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default Value </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>maximumRequestsPerPeriod</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Maximum number of requests per period to throttle. This option must be provided as a positive number. Notice, in the XML DSL, from <strong>Camel 2.8</strong> onwards this option is configured using an <a shape="rect" href="expression.html">Expression</a> instead of an attribute. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>timePeriodMillis</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>1000</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The time period in milliseconds, in which the throttler will allow at most <code>maximumRequestsPerPeriod</code> number of messages. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>asyncDelayed</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.4:</strong> If enabled then any messages which is delayed happens asynchronously using a scheduled thread pool. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>executorServiceRef</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.4:</strong> Refers to a custom <a shape="rect" href="threading-model.html">Thread Pool</a> to be used if <code>asyncDelay</code> has been enabled. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>callerRunsWhenRejected</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.4:</strong> Is used if <code>asyncDelayed</code> was enabled. This controls if the caller thread should execute the task if the thread pool rejected the task. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>rejectExecution</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.14:</strong> If this option is true, throttler throws a ThrottlerRejectExecutionException when the request rate exceeds the limit. </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Examples.10">Examples</h3><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;seda:a&amp;quot;).throttle(3).timePeriodMillis(10000).to(&amp;quot;log:result&amp;quot;, &amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>So the above example will throttle messages all messages received on <strong>seda:a</strong> before being sent to <strong>mock:result</strong> ensuring that a maximum of 3 messages are sent in any 10 second window.</p><p>Note that since <code>timePeriodMillis</code> defaults to 1000 milliseconds, just setting the <code>maximumRequestsPerPeriod</code> has the effect of setting the maximum number of requests per second. So to throttle requests at 100 requests per second between two endpoints, it would look more like this...</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;seda:a&amp;quot;).throttle(100).to(&amp;quot;seda:b&amp;quot;); </script> 
 </div>
</div><p>For further examples of this pattern in use you could look at the <a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/ThrottlerTest.java?view=markup">junit test case</a></p><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><h4 id="BookInOnePage-Camel2.7.xorolder">Camel 2.7.x or older</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;seda:a&amp;quot; /&amp;gt; &amp;lt;throttle maximumRequestsPerPeriod=&amp;quot;3&amp;quot; timePeriodMillis=&amp;quot;10000&amp;quot;&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot; /&amp;gt; &amp;lt;/throttle&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-Camel2.8onwards">Camel 2.8 onwards</h4><p>In Camel 2.8 onwards you must set the maximum period as an <a shape="rect" href="expression.html">Expression</a> as shown below where we use a <a shape="rect" href="constant.html">Constant</a> expression:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;seda:a&amp;quot;/&amp;gt; &amp;lt;!-- throttle 3 messages per 10 sec --&amp;gt; &amp;lt;throttle timePeriodMillis=&amp;quot;10000&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;3&amp;lt;/constant&amp;gt; &amp;lt;to uri=&amp;quot;log:result&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/throttle&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Dynamicallychangingmaximumrequestsperperiod">Dynamically changing maximum requests per period</h3><p><strong>Available as of Camel 2.8</strong> <br clear="none"> Since we use an <a shape="rect" href="expression.html">Expression</a> you can adjust this value at runtime, for example you can provide a header with the value. At runtime Camel evaluates the expression and converts the result to a <code>java.lang.Long</code> type. In the example below we use a header from the message to determine the maximum requests per period. If the header is absent, then the <a shape="rect" href="throttler.html">Throttler</a> uses the old value. So that allows you to only provide a header if the value is to be changed:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:expressionHeader&amp;quot;/&amp;gt; &amp;lt;throttle timePeriodMillis=&amp;quot;500&amp;quot;&amp;gt; &amp;lt;!-- use a header to determine how many messages to throttle per 0.5 sec --&amp;gt; &amp;lt;header&amp;gt;throttleValue&amp;lt;/header&amp;gt; &amp;lt;to uri=&amp;quot;log:result&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/throttle&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Asynchronousdelaying">Asynchronous delaying</h3><p><strong>Available as of Camel 2.4</strong></p><p>You can let the <a shape="rect" href="throttler.html">Throttler</a> use non blocking asynchronous delaying, which means Camel will use a scheduler to schedule a task to be executed in the future. The task will then continue routing. This allows the caller thread to not block and be able to service other messages, etc.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;seda:a&amp;quot;).throttle(100).asyncDelayed().to(&amp;quot;seda:b&amp;quot;); </script> 
 </div>
</div><p></p><h4 id="BookInOnePage-UsingThisPattern.24">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h2 id="BookInOnePage-SamplingThrottler">Sampling Throttler</h2><p><strong>Available as of Camel 2.1</strong></p><p>A sampling throttler allows you to extract a sample of the exchanges from the traffic through a route.<br clear="none"> It is configured with a sampling period during which only a single exchange is allowed to pass through. All other exchanges will be stopped.</p><p>Will by default use a sample period of 1 seconds. </p><h3 id="BookInOnePage-Options.14">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default Value </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>messageFrequency</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Samples the message every N'th message. You can only use either frequency or period. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>samplePeriod</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>1</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Samples the message every N'th period. You can only use either frequency or period. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>units</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>SECOND</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Time unit as an enum of <code>java.util.concurrent.TimeUnit</code> from the JDK. </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Samples.5">Samples</h3><p>You use this EIP with the <code>sample</code> DSL as show in these samples.</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong><br clear="none"> These samples also show how you can use the different syntax to configure the sampling period:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:sample&amp;quot;) .sample() .to(&amp;quot;mock:result&amp;quot;); from(&amp;quot;direct:sample-configured&amp;quot;) .sample(1, TimeUnit.SECONDS) .to(&amp;quot;mock:result&amp;quot;); from(&amp;quot;direct:sample-configured-via-dsl&amp;quot;) .sample().samplePeriod(1).timeUnits(TimeUnit.SECONDS) .to(&amp;quot;mock:result&amp;quot;); from(&amp;quot;direct:sample-messageFrequency&amp;quot;) .sample(10) .to(&amp;quot;mock:result&amp;quot;); from(&amp;quot;direct:sample-messageFrequency-via-dsl&amp;quot;) .sample().sampleMessageFrequency(5) .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong><br clear="none"> And the same example in Spring XML is:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:sample&amp;quot;/&amp;gt; &amp;lt;sample samplePeriod=&amp;quot;1&amp;quot; units=&amp;quot;seconds&amp;quot;&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/sample&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:sample-messageFrequency&amp;quot;/&amp;gt; &amp;lt;sample messageFrequency=&amp;quot;10&amp;quot;&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/sample&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:sample-messageFrequency-via-dsl&amp;quot;/&amp;gt; &amp;lt;sample messageFrequency=&amp;quot;5&amp;quot;&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/sample&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>And since it uses a default of 1 second you can omit this configuration in case you also want to use 1 second</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:sample&amp;quot;/&amp;gt; &amp;lt;!-- will by default use 1 second period --&amp;gt; &amp;lt;sample&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/sample&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-UsingThisPattern.25">Using This Pattern</h4><p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-SeeAlso.11">See Also</h3><ul class="alternate"><li><a shape="rect" href="throttler.html">Throttler</a></li><li><a shape="rect" href="aggregator.html">Aggregator</a></li></ul><h3 id="BookInOnePage-Delayer">Delayer</h3><p>The Delayer Pattern allows you to delay the delivery of messages to some destination.</p><div class="confluence-information-macro confluence-information-macro-information">
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The expression is a value in millis to wait from the current time, so the expression should just be <code>3000</code>.<br clear="none"> However you can use a long value for a fixed value to indicate the delay in millis.<br clear="none"> See the Spring DSL samples for Delayer.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-warning">
 <p class="title">Using Delayer in Java DSL</p>
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>See this ticket: <a shape="rect" class="external-link" href="https://issues.apache.org/jira/browse/CAMEL-2654">https://issues.apache.org/jira/browse/CAMEL-2654</a></p>
 </div>
</div><h3 id="BookInOnePage-Options.15">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default Value </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>asyncDelayed</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.4:</strong> If enabled then delayed messages happens asynchronously using a scheduled thread pool. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>executorServiceRef</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.4:</strong> Refers to a custom <a shape="rect" href="threading-model.html">Thread Pool</a> to be used if <code>asyncDelay</code> has been enabled. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>callerRunsWhenRejected</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.4:</strong> Is used if <code>asyncDelayed</code> was enabled. This controls if the caller thread should execute the task if the thread pool rejected the task. </p></td></tr></tbody></table> 
 </div>
</div><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><p>The example below will delay all messages received on <strong>seda:b</strong> 1 second before sending them to <strong><a shape="rect" class="external-link" href="http://mockresult" rel="nofollow">mock:result</a></strong>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;seda:b&amp;quot;).delay(1000).to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>You can just delay things a fixed amount of time from the point at which the delayer receives the message. For example to delay things 2 seconds</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">delayer(2000) </script> 
 </div>
</div><p>The above assume that the delivery order is maintained and that the messages are delivered in delay order. If you want to reorder the messages based on delivery time, you can use the <a shape="rect" href="resequencer.html">Resequencer</a> with this pattern. For example</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:someQueue&amp;quot;).resequencer(header(&amp;quot;MyDeliveryTime&amp;quot;)).delay(&amp;quot;MyRedeliveryTime&amp;quot;).to(&amp;quot;activemq:aDelayedQueue&amp;quot;); </script> 
 </div>
</div><p>You can of course use many different <a shape="rect" href="expression.html">Expression</a> languages such as <a shape="rect" href="xpath.html">XPath</a>, <a shape="rect" href="xquery.html">XQuery</a>, <a shape="rect" href="sql.html">SQL</a> or various <a shape="rect" href="scripting-languages.html">Scripting Languages</a>. For example to delay the message for the time period specified in the header, use the following syntax:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:someQueue&amp;quot;).delay(header(&amp;quot;delayValue&amp;quot;)).to(&amp;quot;activemq:aDelayedQueue&amp;quot;); </script> 
 </div>
</div><p>And to delay processing using the <a shape="rect" href="simple.html">Simple</a> language you can use the following DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:someQueue&amp;quot;).delay(simple(&amp;quot;${body.delayProperty}&amp;quot;)).to(&amp;quot;activemq:aDelayedQueue&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-SpringDSL.1">Spring DSL</h4><p>The sample below demonstrates the delay in Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;myDelayBean&amp;quot; class=&amp;quot;org.apache.camel.processor.MyDelayCalcBean&amp;quot;/&amp;gt; &amp;lt;bean id=&amp;quot;exchangeAwareBean&amp;quot; class=&amp;quot;org.apache.camel.processor.ExchangeAwareDelayCalcBean&amp;quot;/&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;seda:a&amp;quot;/&amp;gt; &amp;lt;delay&amp;gt; &amp;lt;header&amp;gt;MyDelay&amp;lt;/header&amp;gt; &amp;lt;/delay&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;seda:b&amp;quot;/&amp;gt; &amp;lt;delay&amp;gt; &amp;lt;constant&amp;gt;1000&amp;lt;/constant&amp;gt; &amp;lt;/delay&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;seda:c&amp;quot;/&amp;gt; &amp;lt;delay&amp;gt; &amp;lt;method ref=&amp;quot;myDelayBean&amp;quot; method=&amp;quot;delayMe&amp;quot;/&amp;gt; &amp;lt;/delay&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;seda:d&amp;quot;/&amp;gt; &amp;lt;delay&amp;gt; &amp;lt;method ref=&amp;quot;exchangeAwareBean&amp;quot; method=&amp;quot;delayMe&amp;quot;/&amp;gt; &amp;lt;/delay&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><p>For further examples of this pattern in use you could look at the <a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/DelayerTest.java?view=markup">junit test case</a></p><h3 id="BookInOnePage-Asynchronousdelaying.1">Asynchronous delaying</h3><p><strong>Available as of Camel 2.4</strong></p><p>You can let the <a shape="rect" href="delayer.html">Delayer</a> use non blocking asynchronous delaying, which means Camel will use a scheduler to schedule a task to be executed in the future. The task will then continue routing. This allows the caller thread to not block and be able to service other messages etc.</p><h4 id="BookInOnePage-FromJavaDSL">From Java DSL</h4><p>You use the <code>asyncDelayed()</code> to enable the async behavior.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:queue:foo&amp;quot;).delay(1000).asyncDelayed().to(&amp;quot;activemq:aDelayedQueue&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-FromSpringXML">From Spring XML</h4><p>You use the <code>asyncDelayed="true"</code> attribute to enable the async behavior.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:queue:foo&amp;quot;/&amp;gt; &amp;lt;delay asyncDelayed=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;1000&amp;lt;/constant&amp;gt; &amp;lt;/delay&amp;gt; &amp;lt;to uri=&amp;quot;activemq:aDealyedQueue&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Creatingacustomdelay">Creating a custom delay</h3><p>You can use an expression to determine when to send a message using something like this</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:foo&amp;quot;). delay().method(&amp;quot;someBean&amp;quot;, &amp;quot;computeDelay&amp;quot;). to(&amp;quot;activemq:bar&amp;quot;); </script> 
 </div>
</div><p>then the bean would look like this...</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public class SomeBean { public long computeDelay() { long delay = 0; // use java code to compute a delay value in millis return delay; } } </script> 
 </div>
</div><p></p><h4 id="BookInOnePage-UsingThisPattern.26">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-SeeAlso.12">See Also</h3><ul><li><a shape="rect" href="delay-interceptor.html">Delay Interceptor</a></li></ul><h3 id="BookInOnePage-LoadBalancer">Load Balancer</h3><p>The Load Balancer Pattern allows you to delegate to one of a number of endpoints using a variety of different load balancing policies.</p><h3 id="BookInOnePage-Built-inloadbalancingpolicies">Built-in load balancing policies</h3><p>Camel provides the following policies out-of-the-box:</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Policy</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/loadbalancer/RoundRobinLoadBalancer.html">Round Robin</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The exchanges are selected from in a round robin fashion. This is a well known and classic policy, which spreads the load evenly.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/loadbalancer/RandomLoadBalancer.html">Random</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A random endpoint is selected for each exchange.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/loadbalancer/StickyLoadBalancer.html">Sticky</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sticky load balancing using an Expression to calculate a correlation key to perform the sticky load balancing; rather like jsessionid in the web or JMSXGroupID in JMS.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/loadbalancer/TopicLoadBalancer.html">Topic</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Topic which sends to all destinations (rather like JMS Topics)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/loadbalancer/FailOverLoadBalancer.html">Failover</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>In case of failures the exchange will be tried on the next endpoint.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>Weighted Round-Robin</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> The weighted load balancing policy allows you to specify a processing load distribution ratio for each server with respect to the others. In addition to the weight, endpoint selection is then further refined using <strong>round-robin</strong> distribution based on weight.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>Weighted Random</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> The weighted load balancing policy allows you to specify a processing load distribution ratio for each server with respect to others.In addition to the weight, endpoint selection is then further refined using <strong>random</strong> distribution based on weight.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>Custom</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> From Camel 2.8 onwards the preferred way of using a custom <a shape="rect" href="load-balancer.html">Load Balancer</a> is to use this policy, instead of using the @deprecated <code>ref</code> attribute.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">Circuit Breaker</td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.14:</strong> Implements the&#160;Circuit Breaker pattern as described in "Release it!" book.</p></td></tr></tbody></table>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Load balancing HTTP endpoints</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>If you are proxying and load balancing HTTP, then see <a shape="rect" href="how-to-use-camel-as-a-http-proxy-between-a-client-and-server.html">this page</a> for more details.</p>
 </div>
</div><h3 id="BookInOnePage-RoundRobin">Round Robin</h3><p>The round robin load balancer is not meant to work with failover, for that you should use the dedicated <strong>failover</strong> load balancer. The round robin load balancer will only change to next endpoint per message.</p><p>The round robin load balancer is stateful as it keeps state of which endpoint to use next time.</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong>
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;).loadBalance(). roundRobin().to(&amp;quot;mock:x&amp;quot;, &amp;quot;mock:y&amp;quot;, &amp;quot;mock:z&amp;quot;); </script> 
  </div>
 </div><strong>Using the Spring configuration</strong><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext id=&amp;quot;camel&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;loadBalance&amp;gt; &amp;lt;roundRobin/&amp;gt; &amp;lt;to uri=&amp;quot;mock:x&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:y&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:z&amp;quot;/&amp;gt; &amp;lt;/loadBalance&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><p>The above example loads balance requests from <strong>direct:start</strong> to one of the available <strong>mock endpoint</strong> instances, in this case using a round robin policy.<br clear="none"> For further examples of this pattern look at <a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/RoundRobinLoadBalanceTest.java?view=markup">this junit test case</a></p><h3 id="BookInOnePage-Failover">Failover</h3><p>The <code>failover</code> load balancer is capable of trying the next processor in case an <a shape="rect" href="exchange.html">Exchange</a> failed with an <code>exception</code> during processing.<br clear="none"> You can constrain the <code>failover</code> to activate only when one exception of a list you specify occurs. If you do not specify a list any exception will cause fail over to occur. This balancer uses the same strategy for matching exceptions as the <a shape="rect" href="exception-clause.html">Exception Clause</a> does for the <strong>onException</strong>.</p><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Enable stream caching if using streams</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>If you use streaming then you should enable <a shape="rect" href="stream-caching.html">Stream caching</a> when using the failover load balancer. This is needed so the stream can be re-read after failing over to the next processor.</p>
 </div>
</div><p>Failover offers the following options:</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>inheritErrorHandler</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>true</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> Whether or not the <a shape="rect" href="error-handler.html">Error Handler</a> configured on the route should be used. Disable this if you want failover to transfer immediately to the next endpoint. On the other hand, if you have this option enabled, then Camel will first let the <a shape="rect" href="error-handler.html">Error Handler</a> try to process the message. The <a shape="rect" href="error-handler.html">Error Handler</a> may have been configured to redeliver and use delays between attempts. If you have enabled a number of redeliveries then Camel will try to redeliver to the <strong>same</strong> endpoint, and only fail over to the next endpoint, when the <a shape="rect" href="error-handler.html">Error Handler</a> is exhausted.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>maximumFailoverAttempts</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>int</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>-1</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> A value to indicate after X failover attempts we should exhaust (give up). Use -1 to indicate never give up and continuously try to failover. Use 0 to never failover. And use e.g. 3 to failover at most 3 times before giving up. This option can be used whether or not roundRobin is enabled or not.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>roundRobin</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>false</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> Whether or not the <code>failover</code> load balancer should operate in round robin mode or not. If not, then it will <strong>always</strong> start from the first endpoint when a new message is to be processed. In other words it restart from the top for every message. If round robin is enabled, then it keeps state and will continue with the next endpoint in a round robin fashion. When using round robin it will not <em>stick</em> to last known good endpoint, it will always pick the next endpoint to use. <span>You can also enable sticky mode together with round robin, if so then it will pick the last known good endpoint </span><span>to use when starting the load balancing (instead of using the next when starting).</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">sticky</td><td colspan="1" rowspan="1" class="confluenceTd">boolean</td><td colspan="1" rowspan="1" class="confluenceTd">false</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> Whether or not the failover load balancer should operate in sticky mode or not. If not, then it will always start from the first endpoint when a new message is to be processed. In other words it restart from the top for every message. If sticky is enabled, then it keeps state and will continue with the last known good endpoint. You can also enable sticky mode together with round robin, if so then it will pick the last known good endpoint to use when starting the load balancing (instead of using the next when starting).</td></tr></tbody></table>
</div><p><strong>Camel 2.2 or older behavior</strong><br clear="none"> The current implementation of failover load balancer uses simple logic which <strong>always</strong> tries the first endpoint, and in case of an exception being thrown it tries the next in the list, and so forth. It has no state, and the next message will thus <strong>always</strong> start with the first endpoint.</p><p><strong>Camel 2.3 onwards behavior</strong><br clear="none"> The <code>failover</code> load balancer now supports round robin mode, which allows you to failover in a round robin fashion. See the <code>roundRobin</code> option.</p><div class="confluence-information-macro confluence-information-macro-note">
 <p class="title">Redelivery must be enabled</p>
 <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>In Camel 2.2 or older the failover load balancer requires you have enabled Camel <a shape="rect" href="error-handler.html">Error Handler</a> to use redelivery. In Camel 2.3 onwards this is not required as such, as you can mix and match. See the <code>inheritErrorHandler</code> option.</p>
 </div>
</div><p>Here is a sample to failover only if a <code>IOException</code> related exception was thrown:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) // here we will load balance if IOException was thrown // any other kind of exception will result in the Exchange as failed // to failover over any kind of exception we can just omit the exception // in the failOver DSL .loadBalance().failover(IOException.class) .to(&amp;quot;direct:x&amp;quot;, &amp;quot;direct:y&amp;quot;, &amp;quot;direct:z&amp;quot;); </script> 
  </div>
 </div>You can specify multiple exceptions to failover as the option is varargs, for instance:<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// enable redelivery so failover can react errorHandler(defaultErrorHandler().maximumRedeliveries(5)); from(&amp;quot;direct:foo&amp;quot;). loadBalance().failover(IOException.class, MyOtherException.class) .to(&amp;quot;direct:a&amp;quot;, &amp;quot;direct:b&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-UsingfailoverinSpringDSL">Using failover in Spring DSL</h4><p>Failover can also be used from Spring DSL and you configure it as:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route errorHandlerRef=&amp;quot;myErrorHandler&amp;quot;&amp;gt; &amp;lt;from uri=&amp;quot;direct:foo&amp;quot;/&amp;gt; &amp;lt;loadBalance&amp;gt; &amp;lt;failover&amp;gt; &amp;lt;exception&amp;gt;java.io.IOException&amp;lt;/exception&amp;gt; &amp;lt;exception&amp;gt;com.mycompany.MyOtherException&amp;lt;/exception&amp;gt; &amp;lt;/failover&amp;gt; &amp;lt;to uri=&amp;quot;direct:a&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:b&amp;quot;/&amp;gt; &amp;lt;/loadBalance&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-Usingfailoverinroundrobinmode">Using failover in round robin mode</h4><p>An example using Java DSL:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) // Use failover load balancer in stateful round robin mode // which mean it will failover immediately in case of an exception // as it does NOT inherit error handler. It will also keep retrying as // its configured to newer exhaust. .loadBalance().failover(-1, false, true). to(&amp;quot;direct:bad&amp;quot;, &amp;quot;direct:bad2&amp;quot;, &amp;quot;direct:good&amp;quot;, &amp;quot;direct:good2&amp;quot;); </script> 
  </div>
 </div>And the same example using Spring XML:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;loadBalance&amp;gt; &amp;lt;!-- failover using stateful round robin, which will keep retrying forever those 4 endpoints until success. You can set the maximumFailoverAttempt to break out after X attempts --&amp;gt; &amp;lt;failover roundRobin=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:bad&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:bad2&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:good&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:good2&amp;quot;/&amp;gt; &amp;lt;/loadBalance&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Disabled inheritErrorHandler</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>You can configure <code>inheritErrorHandler=false</code> if you want to failover to the next endpoint as fast as possible. By disabling the <a shape="rect" href="error-handler.html">Error Handler</a> you ensure it does not <em>intervene</em> which allows the <code>failover</code> load balancer to handle failover asap. By also enabling <code>roundRobin</code> mode, then it will keep retrying until it success. You can then configure the <code>maximumFailoverAttempts</code> option to a high value to let it eventually exhaust (give up) and fail.</p>
 </div>
</div><h3 id="BookInOnePage-WeightedRound-RobinandRandomLoadBalancing">Weighted Round-Robin and Random Load Balancing</h3><p><strong>Available as of Camel 2.5</strong></p><p>In many enterprise environments where server nodes of unequal processing power &amp; performance characteristics are utilized to host services and processing endpoints, it is frequently necessary to distribute processing load based on their individual server capabilities so that some endpoints are not unfairly burdened with requests. Obviously simple round-robin or random load balancing do not alleviate problems of this nature. A Weighted Round-Robin and/or Weighted Random load balancer can be used to address this problem.</p><p>The weighted load balancing policy allows you to specify a processing load distribution ratio for each server with respect to others. You can specify this as a positive processing weight for each server. A larger number indicates that the server can handle a larger load. The weight is utilized to determine the payload distribution ratio to different processing endpoints with respect to others.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Disabled inheritErrorHandler</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>As of Camel 2.6, the Weighted Load balancer usage has been further simplified, there is no need to send in distributionRatio as a List&lt;Integer&gt;. It can be simply sent as a delimited String of integer weights separated by a delimiter of choice.</p>
 </div>
</div><p>The parameters that can be used are</p><p><strong>In Camel 2.5</strong></p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>roundRobin</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>false</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The default value for round-robin is false. In the absence of this setting or parameter the load balancing algorithm used is random.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>distributionRatio</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>List&lt;Integer&gt;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>none</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The distributionRatio is a list consisting on integer weights passed in as a parameter. The distributionRatio must match the number of endpoints and/or processors specified in the load balancer list. In Camel 2.5 if endpoints do not match ratios, then a best effort distribution is attempted.</p></td></tr></tbody></table>
</div><p><strong>Available In Camel 2.6</strong></p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>roundRobin</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>boolean</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>false</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The default value for round-robin is false. In the absence of this setting or parameter the load balancing algorithm used is random.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>distributionRatio</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>String</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>none</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The distributionRatio is a delimited String consisting on integer weights separated by delimiters for example "2,3,5". The distributionRatio must match the number of endpoints and/or processors specified in the load balancer list.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>distributionRatioDelimiter</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>String</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>,</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The distributionRatioDelimiter is the delimiter used to specify the distributionRatio. If this attribute is not specified a default delimiter "," is expected as the delimiter used for specifying the distributionRatio.</p></td></tr></tbody></table>
</div><h4 id="BookInOnePage-UsingWeightedround-robin&amp;randomloadbalancing">Using Weighted round-robin &amp; random load balancing</h4><p><strong>In Camel 2.5</strong></p><p>An example using Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">ArrayList&amp;lt;integer&amp;gt; distributionRatio = new ArrayList&amp;lt;integer&amp;gt;(); distributionRatio.add(4); distributionRatio.add(2); distributionRatio.add(1); // round-robin from(&amp;quot;direct:start&amp;quot;) .loadBalance().weighted(true, distributionRatio) .to(&amp;quot;mock:x&amp;quot;, &amp;quot;mock:y&amp;quot;, &amp;quot;mock:z&amp;quot;); //random from(&amp;quot;direct:start&amp;quot;) .loadBalance().weighted(false, distributionRatio) .to(&amp;quot;mock:x&amp;quot;, &amp;quot;mock:y&amp;quot;, &amp;quot;mock:z&amp;quot;); </script> 
 </div>
</div><p>And the same example using Spring XML:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;loadBalance&amp;gt; &amp;lt;weighted roundRobin=&amp;quot;false&amp;quot; distributionRatio=&amp;quot;4 2 1&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:x&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:y&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:z&amp;quot;/&amp;gt; &amp;lt;/loadBalance&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p><strong>Available In Camel 2.6</strong></p><p>An example using Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// round-robin from(&amp;quot;direct:start&amp;quot;) .loadBalance().weighted(true, &amp;quot;4:2:1&amp;quot; distributionRatioDelimiter=&amp;quot;:&amp;quot;) .to(&amp;quot;mock:x&amp;quot;, &amp;quot;mock:y&amp;quot;, &amp;quot;mock:z&amp;quot;); //random from(&amp;quot;direct:start&amp;quot;) .loadBalance().weighted(false, &amp;quot;4,2,1&amp;quot;) .to(&amp;quot;mock:x&amp;quot;, &amp;quot;mock:y&amp;quot;, &amp;quot;mock:z&amp;quot;); </script> 
 </div>
</div><p>And the same example using Spring XML:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;loadBalance&amp;gt; &amp;lt;weighted roundRobin=&amp;quot;false&amp;quot; distributionRatio=&amp;quot;4-2-1&amp;quot; distributionRatioDelimiter=&amp;quot;-&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;mock:x&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:y&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:z&amp;quot;/&amp;gt; &amp;lt;/loadBalance&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-CustomLoadBalancer">Custom Load Balancer</h3><p>You can use a custom load balancer (eg your own implementation) also.</p><p>An example using Java DSL:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) // using our custom load balancer .loadBalance(new MyLoadBalancer()) .to(&amp;quot;mock:x&amp;quot;, &amp;quot;mock:y&amp;quot;, &amp;quot;mock:z&amp;quot;); </script> 
  </div>
 </div>And the same example using XML DSL:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- this is the implementation of our custom load balancer --&amp;gt; &amp;lt;bean id=&amp;quot;myBalancer&amp;quot; class=&amp;quot;org.apache.camel.processor.CustomLoadBalanceTest$MyLoadBalancer&amp;quot;/&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;loadBalance&amp;gt; &amp;lt;!-- refer to my custom load balancer --&amp;gt; &amp;lt;custom ref=&amp;quot;myBalancer&amp;quot;/&amp;gt; &amp;lt;!-- these are the endpoints to balancer --&amp;gt; &amp;lt;to uri=&amp;quot;mock:x&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:y&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:z&amp;quot;/&amp;gt; &amp;lt;/loadBalance&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
  </div>
 </div>Notice in the XML DSL above we use &lt;custom&gt; which is only available in <strong>Camel 2.8</strong> onwards. In older releases you would have to do as follows instead:<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;loadBalance ref=&amp;quot;myBalancer&amp;quot;&amp;gt; &amp;lt;!-- these are the endpoints to balancer --&amp;gt; &amp;lt;to uri=&amp;quot;mock:x&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:y&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:z&amp;quot;/&amp;gt; &amp;lt;/loadBalance&amp;gt; </script> 
 </div>
</div><p>To implement a custom load balancer you can extend some support classes such as <code>LoadBalancerSupport</code> and <code>SimpleLoadBalancerSupport</code>. The former supports the asynchronous routing engine, and the latter does not. Here is an example:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
   <b>Custom load balancer implementation</b>
  </div>
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public static class MyLoadBalancer extends LoadBalancerSupport { public boolean process(Exchange exchange, AsyncCallback callback) { String body = exchange.getIn().getBody(String.class); try { if (&amp;quot;x&amp;quot;.equals(body)) { getProcessors().get(0).process(exchange); } else if (&amp;quot;y&amp;quot;.equals(body)) { getProcessors().get(1).process(exchange); } else { getProcessors().get(2).process(exchange); } } catch (Throwable e) { exchange.setException(e); } callback.done(true); return true; } } </script> 
  </div>
 </div><h3 id="BookInOnePage-CircuitBreaker">Circuit Breaker</h3><p>The Circuit Breaker load balancer is a stateful pattern that monitors all calls for certain exceptions. Initially the Circuit Breaker is in closed state and passes all messages. If there are failures and the threshold is reached, it moves to open state and rejects all calls until halfOpenAfter timeout is reached. After this timeout is reached, if there is a new call, it will pass and if the result is success the Circuit Breaker will move to closed state, or to open state if there was an error.</p><p>When the circuit breaker is closed, it will throw a <code>java.util.concurrent.RejectedExecutionException</code>. This can then be caught to provide an alternate path for processing exchanges.</p><p>An example using Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .onException(RejectedExecutionException.class) .handled(true) .to(&amp;quot;mock:serviceUnavailable&amp;quot;) .end() &nbsp;.loadBalance() .circuitBreaker(2, 1000L, MyCustomException.class) .to(&amp;quot;mock:service&amp;quot;) .end(); </script> 
 </div>
</div><p>And the same example using Spring XML:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext id=&amp;quot;camel&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;onException&amp;gt; &amp;lt;exception&amp;gt;java.util.concurrent.RejectedExecutionException&amp;lt;/exception&amp;gt; &amp;lt;handled&amp;gt;&amp;lt;constant&amp;gt;true&amp;lt;/constant&amp;gt;&amp;lt;/handled&amp;gt; &amp;lt;to uri=&amp;quot;mock:serviceUnavailable&amp;quot;/&amp;gt; &amp;lt;/onException&amp;gt; &nbsp;&amp;lt;loadBalance&amp;gt; &amp;lt;circuitBreaker threshold=&amp;quot;2&amp;quot; halfOpenAfter=&amp;quot;1000&amp;quot;&amp;gt; &amp;lt;exception&amp;gt;MyCustomException&amp;lt;/exception&amp;gt; &amp;lt;/circuitBreaker&amp;gt; &amp;lt;to uri=&amp;quot;mock:service&amp;quot;/&amp;gt; &amp;lt;/loadBalance&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><p></p><h4 id="BookInOnePage-UsingThisPattern.27">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-Multicast">Multicast</h3><p>The Multicast allows to route the same message to a number of endpoints and process them in a different way. The main difference between the Multicast and Splitter is that Splitter will split the message into several pieces but the Multicast will not modify the request message.</p><h3 id="BookInOnePage-Options.16">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>strategyRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refers to an <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/aggregate/AggregationStrategy.html">AggregationStrategy</a> to be used to assemble the replies from the multicasts, into a single outgoing message from the <a shape="rect" href="multicast.html">Multicast</a>. By default Camel will use the last reply as the outgoing message. From <strong>Camel 2.12</strong> onwards you can also use a POJO as the <code>AggregationStrategy</code>, see the <a shape="rect" href="aggregator2.html">Aggregate</a> page for more details. If an exception is thrown from the aggregate method in the AggregationStrategy, then by default, that exception&#160;is not handled by the error handler. The error handler can be enabled to react if enabling the shareUnitOfWork option.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>strategyMethodName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> This option can be used to explicit declare the method name to use, when using POJOs as the <code>AggregationStrategy</code>. See the <a shape="rect" href="aggregator2.html">Aggregate</a> page for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>strategyMethodAllowNull</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> If this option is <code>false</code> then the aggregate method is not used if there was no data to enrich. If this option is <code>true</code> then <code>null</code> values is used as the <code>oldExchange</code> (when no data to enrich), when using POJOs as the <code>AggregationStrategy</code>. See the <a shape="rect" href="aggregator2.html">Aggregate</a> page for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>parallelProcessing</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If enabled then sending messages to the multicasts occurs concurrently. Note the caller thread will still wait until all messages has been fully processed, before it continues. Its only the sending and processing the replies from the multicasts which happens concurrently.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>parallelAggregate</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.14:</strong> If enabled then the <code>aggregate</code> method on <code>AggregationStrategy</code> can be called concurrently. Notice that this would require the implementation of <code>AggregationStrategy</code> to be implemented as thread-safe. By default this is <code>false</code> meaning that Camel synchronizes the call to the <code>aggregate</code> method. Though in some use-cases this can be used to archive higher performance when the <code>AggregationStrategy</code> is implemented as thread-safe.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>executorServiceRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refers to a custom <a shape="rect" href="threading-model.html">Thread Pool</a> to be used for parallel processing. Notice if you set this option, then parallel processing is automatic implied, and you do not have to enable that option as well.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>stopOnException</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.2:</strong> Whether or not to stop continue processing immediately when an exception occurred. If disable, then Camel will send the message to all multicasts regardless if one of them failed. You can deal with exceptions in the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/aggregate/AggregationStrategy.html">AggregationStrategy</a> class where you have full control how to handle that.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>streaming</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If enabled then Camel will process replies out-of-order, eg in the order they come back. If disabled, Camel will process replies in the same order as multicasted.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>timeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> Sets a total timeout specified in millis. If the <a shape="rect" href="multicast.html">Multicast</a> hasn't been able to send and process all replies within the given timeframe, then the timeout triggers and the <a shape="rect" href="multicast.html">Multicast</a> breaks out and continues. Notice if you provide a <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/aggregate/TimeoutAwareAggregationStrategy.html">TimeoutAwareAggregationStrategy</a> then the <code>timeout</code> method is invoked before breaking out. If the timeout is reached with running tasks still remaining, certain tasks for which it is difficult for Camel to shut down in a graceful manner may continue to run. So use this option with a bit of care. We may be able to improve this functionality in future Camel releases.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>onPrepareRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> Refers to a custom <a shape="rect" href="processor.html">Processor</a> to prepare the copy of the <a shape="rect" href="exchange.html">Exchange</a> each multicast will receive. This allows you to do any custom logic, such as deep-cloning the message payload if that's needed etc.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>shareUnitOfWork</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> Whether the unit of work should be shared. See the same option on <a shape="rect" href="splitter.html">Splitter</a> for more details.</p></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-Example.10">Example</h4><p>The following example shows how to take a request from the <strong>direct:a</strong> endpoint , then multicast these request to <strong>direct:x</strong>, <strong>direct:y</strong>, <strong>direct:z</strong>.</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong>
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:a&amp;quot;).multicast().to(&amp;quot;direct:x&amp;quot;, &amp;quot;direct:y&amp;quot;, &amp;quot;direct:z&amp;quot;); </script> 
  </div>
 </div>By default Multicast invokes each endpoint sequentially. If parallel processing is desired, simply use<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:a&amp;quot;).multicast().parallelProcessing().to(&amp;quot;direct:x&amp;quot;, &amp;quot;direct:y&amp;quot;, &amp;quot;direct:z&amp;quot;); </script> 
 </div>
</div><p>In case of using InOut MEP, an AggregationStrategy is used for aggregating all reply messages. The default is to only use the latest reply message and discard any earlier replies. The aggregation strategy is configurable:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .multicast(new MyAggregationStrategy()) .parallelProcessing().timeout(500).to(&amp;quot;direct:a&amp;quot;, &amp;quot;direct:b&amp;quot;, &amp;quot;direct:c&amp;quot;) .end() .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-Stopprocessingincaseofexception.1">Stop processing in case of exception</h3><p><strong>Available as of Camel 2.1</strong></p><p>The <a shape="rect" href="multicast.html">Multicast</a> will by default continue to process the entire <a shape="rect" href="exchange.html">Exchange</a> even in case one of the multicasted messages will thrown an exception during routing.<br clear="none"> For example if you want to multicast to 3 destinations and the 2nd destination fails by an exception. What Camel does by default is to process the remainder destinations. You have the chance to remedy or handle this in the <code>AggregationStrategy</code>.</p><p>But sometimes you just want Camel to stop and let the exception be propagated back, and let the Camel error handler handle it. You can do this in Camel 2.1 by specifying that it should stop in case of an exception occurred. This is done by the <code>stopOnException</code> option as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) .multicast() .stopOnException().to(&amp;quot;direct:foo&amp;quot;, &amp;quot;direct:bar&amp;quot;, &amp;quot;direct:baz&amp;quot;) .end() .to(&amp;quot;mock:result&amp;quot;); from(&amp;quot;direct:foo&amp;quot;).to(&amp;quot;mock:foo&amp;quot;); from(&amp;quot;direct:bar&amp;quot;).process(new MyProcessor()).to(&amp;quot;mock:bar&amp;quot;); from(&amp;quot;direct:baz&amp;quot;).to(&amp;quot;mock:baz&amp;quot;); </script> 
 </div>
</div><p>And using XML DSL you specify it as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;multicast stopOnException=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;to uri=&amp;quot;direct:foo&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:bar&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:baz&amp;quot;/&amp;gt; &amp;lt;/multicast&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:foo&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:foo&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:bar&amp;quot;/&amp;gt; &amp;lt;process ref=&amp;quot;myProcessor&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:bar&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:baz&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:baz&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-UsingonPreparetoexecutecustomlogicwhenpreparingmessages.2">Using onPrepare to execute custom logic when preparing messages</h3><p><strong>Available as of Camel 2.8</strong></p><p>The <a shape="rect" href="multicast.html">Multicast</a> will copy the source <a shape="rect" href="exchange.html">Exchange</a> and multicast each copy. However the copy is a shallow copy, so in case you have mutateable message bodies, then any changes will be visible by the other copied messages. If you want to use a deep clone copy then you need to use a custom <code>onPrepare</code> which allows you to do this using the <a shape="rect" href="processor.html">Processor</a> interface.</p><p>Notice the <code>onPrepare</code> can be used for any kind of custom logic which you would like to execute before the <a shape="rect" href="exchange.html">Exchange</a> is being multicasted.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Design for immutable</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Its best practice to design for immutable objects.</p>
 </div>
</div><p>For example if you have a mutable message body as this Animal class:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
   <b>Animal</b>
  </div>
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public class Animal implements Serializable { private static final long serialVersionUID = 1L; private int id; private String name; public Animal() { } public Animal(int id, String name) { this.id = id; this.name = name; } public Animal deepClone() { Animal clone = new Animal(); clone.setId(getId()); clone.setName(getName()); return clone; } public int getId() { return id; } public void setId(int id) { this.id = id; } public String getName() { return name; } public void setName(String name) { this.name = name; } @Override public String toString() { return id + &amp;quot; &amp;quot; + name; } } </script> 
  </div>
 </div>Then we can create a deep clone processor which clones the message body:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
   <b>AnimalDeepClonePrepare</b>
  </div>
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public class AnimalDeepClonePrepare implements Processor { public void process(Exchange exchange) throws Exception { Animal body = exchange.getIn().getBody(Animal.class); // do a deep clone of the body which wont affect when doing multicasting Animal clone = body.deepClone(); exchange.getIn().setBody(clone); } } </script> 
  </div>
 </div>Then we can use the AnimalDeepClonePrepare class in the <a shape="rect" href="multicast.html">Multicast</a> route using the <code>onPrepare</code> option as shown:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
   <b>Multicast using onPrepare</b>
  </div>
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) .multicast().onPrepare(new AnimalDeepClonePrepare()).to(&amp;quot;direct:a&amp;quot;).to(&amp;quot;direct:b&amp;quot;); </script> 
  </div>
 </div>And the same example in XML DSL
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
   <b>Multicast using onPrepare</b>
  </div>
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;!-- use on prepare with multicast --&amp;gt; &amp;lt;multicast onPrepareRef=&amp;quot;animalDeepClonePrepare&amp;quot;&amp;gt; &amp;lt;to uri=&amp;quot;direct:a&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:b&amp;quot;/&amp;gt; &amp;lt;/multicast&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:a&amp;quot;/&amp;gt; &amp;lt;process ref=&amp;quot;processorA&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:a&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:b&amp;quot;/&amp;gt; &amp;lt;process ref=&amp;quot;processorB&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:b&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;!-- the on prepare Processor which performs the deep cloning --&amp;gt; &amp;lt;bean id=&amp;quot;animalDeepClonePrepare&amp;quot; class=&amp;quot;org.apache.camel.processor.AnimalDeepClonePrepare&amp;quot;/&amp;gt; &amp;lt;!-- processors used for the last two routes, as part of unit test --&amp;gt; &amp;lt;bean id=&amp;quot;processorA&amp;quot; class=&amp;quot;org.apache.camel.processor.MulticastOnPrepareTest$ProcessorA&amp;quot;/&amp;gt; &amp;lt;bean id=&amp;quot;processorB&amp;quot; class=&amp;quot;org.apache.camel.processor.MulticastOnPrepareTest$ProcessorB&amp;quot;/&amp;gt; </script> 
  </div>
 </div>Notice the <code>onPrepare</code> option is also available on other <a shape="rect" href="eip.html">EIP</a>s such as <a shape="rect" href="splitter.html">Splitter</a>, <a shape="rect" href="recipient-list.html">Recipient List</a>, and <a shape="rect" href="wire-tap.html">Wire Tap</a>.<p></p><h4 id="BookInOnePage-UsingThisPattern.28">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h2 id="BookInOnePage-Loop">Loop</h2><p>The Loop allows for processing a message a number of times, possibly in a different way for each iteration. Useful mostly during testing.</p><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Default mode</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Notice by default the loop uses the same exchange throughout the looping. So the result from the previous iteration will be used for the next (eg <a shape="rect" href="pipes-and-filters.html">Pipes and Filters</a>). From <strong>Camel 2.8</strong> onwards you can enable copy mode instead. See the options table for more details.</p>
 </div>
</div><h3 id="BookInOnePage-Options.17">Options</h3><div class="confluenceTableSmall">
 &#160;
</div><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>copy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> Whether or not copy mode is used. If <code>false</code> then the same Exchange will be used for each iteration. So the result from the previous iteration will be <em>visible</em> for the next iteration. Instead you can enable copy mode, and then each iteration <em>restarts</em> with a fresh copy of the input <a shape="rect" href="exchange.html">Exchange</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">doWhile</td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.17:</strong> Enables the while loop that loops until the predicate evaluates to false or null.</td></tr></tbody></table>
</div><h3 id="BookInOnePage-Exchangeproperties.1">Exchange properties</h3><p>For each iteration two properties are set on the <code>Exchange</code>. Processors can rely on these properties to process the <a shape="rect" href="message.html">Message</a> in different ways.</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Property</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelLoopSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Total number of loops. This is not available if running the loop in while loop mode.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelLoopIndex</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Index of the current iteration (0 based)</p></td></tr></tbody></table>
</div><h4 id="BookInOnePage-Examples.11">Examples</h4><p>The following example shows how to take a request from the <strong>direct:x</strong> endpoint, then send the message repetitively to <strong>mock:result</strong>. The number of times the message is sent is either passed as an argument to <code>loop()</code>, or determined at runtime by evaluating an expression. The expression <strong>must</strong> evaluate to an <code>int</code>, otherwise a <code>RuntimeCamelException</code> is thrown.</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><p>Pass loop count as an argument
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:a&amp;quot;).loop(8).to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>Use expression to determine loop count
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:b&amp;quot;).loop(header(&amp;quot;loop&amp;quot;)).to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>Use expression to determine loop count
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:c&amp;quot;).loop().xpath(&amp;quot;/hello/@times&amp;quot;).to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong><p>Pass loop count as an argument
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:a&amp;quot;/&amp;gt; &amp;lt;loop&amp;gt; &amp;lt;constant&amp;gt;8&amp;lt;/constant&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/loop&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div>Use expression to determine loop count
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:b&amp;quot;/&amp;gt; &amp;lt;loop&amp;gt; &amp;lt;header&amp;gt;loop&amp;lt;/header&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/loop&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div>For further examples of this pattern in use you could look at one of the <a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/LoopTest.java?view=markup">junit test case</a><h4 id="BookInOnePage-Usingcopymode">Using copy mode</h4><p><strong>Available as of Camel 2.8</strong></p><p>Now suppose we send a message to "direct:start" endpoint containing the letter A.<br clear="none"> The output of processing this route will be that, each "mock:loop" endpoint will receive "AB" as message.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) // instruct loop to use copy mode, which mean it will use a copy of the input exchange // for each loop iteration, instead of keep using the same exchange all over .loop(3).copy() .transform(body().append(&amp;quot;B&amp;quot;)) .to(&amp;quot;mock:loop&amp;quot;) .end() .to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>However if we do <strong>not</strong> enable copy mode then "mock:loop" will receive "AB", "ABB", "ABBB", etc. messages.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) // by default loop will keep using the same exchange so on the 2nd and 3rd iteration its // the same exchange that was previous used that are being looped all over .loop(3) .transform(body().append(&amp;quot;B&amp;quot;)) .to(&amp;quot;mock:loop&amp;quot;) .end() .to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>The equivalent example in XML DSL in copy mode is as follows:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;!-- enable copy mode for loop eip --&amp;gt; &amp;lt;loop copy=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;3&amp;lt;/constant&amp;gt; &amp;lt;transform&amp;gt; &amp;lt;simple&amp;gt;${body}B&amp;lt;/simple&amp;gt; &amp;lt;/transform&amp;gt; &amp;lt;to uri=&amp;quot;mock:loop&amp;quot;/&amp;gt; &amp;lt;/loop&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div><h4 id="BookInOnePage-Usingwhilemode">Using while mode</h4><p><strong>Available as of Camel 2.17</strong></p><p>The loop can act like a while loop that loops until the expression evaluates to false or null.</p><p>For example the route below loops while the length of the message body is 5 or less characters. Notice that the DSL uses&#160;<strong>loopDoWhile</strong>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .loopDoWhile(simple(&amp;quot;${body.length} &amp;lt;= 5&amp;quot;)) .to(&amp;quot;mock:loop&amp;quot;) .transform(body().append(&amp;quot;A&amp;quot;)) .end() .to(&amp;quot;mock:result&amp;quot;);</script> 
 </div>
</div><p>And the same example in XML:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;loop doWhile=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;simple&amp;gt;${body.length} &amp;amp;lt;= 5&amp;lt;/simple&amp;gt; &amp;lt;to uri=&amp;quot;mock:loop&amp;quot;/&amp;gt; &amp;lt;transform&amp;gt; &amp;lt;simple&amp;gt;A${body}&amp;lt;/simple&amp;gt; &amp;lt;/transform&amp;gt; &amp;lt;/loop&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>Notice in XML that the while loop is turned on using the <strong>doWhile</strong> attribute.</p><p>&#160;</p><p></p><h4 id="BookInOnePage-UsingThisPattern.29">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h2 id="BookInOnePage-MessageTransformation.1">Message Transformation</h2><h3 id="BookInOnePage-ContentEnricher">Content Enricher</h3><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/DataEnricher.html" rel="nofollow">Content Enricher</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> using a <a shape="rect" href="message-translator.html">Message Translator</a>, an arbitrary <a shape="rect" href="processor.html">Processor</a> in the routing logic, or using the <a shape="rect" href="#BookInOnePage-enrich-dsl">enrich</a> DSL element to enrich the message.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/DataEnricher.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/DataEnricher.gif"></span></p><h4 id="BookInOnePage-ContentenrichmentusingaMessageTranslatororaProcessor">Content enrichment using a Message Translator or a Processor</h4><p><strong>Using the</strong> <strong><a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><p>You can use <a shape="rect" href="templating.html">Templating</a> to consume a message from one destination, transform it with something like <a shape="rect" href="velocity.html">Velocity</a> or <a shape="rect" href="xquery.html">XQuery</a>, and then send it on to another destination. For example using InOnly (one way messaging)</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:My.Queue&amp;quot;). to(&amp;quot;velocity:com/acme/MyResponse.vm&amp;quot;). to(&amp;quot;activemq:Another.Queue&amp;quot;); </script> 
 </div>
</div><p>If you want to use InOut (request-reply) semantics to process requests on the <strong>My.Queue</strong> queue on <a shape="rect" href="activemq.html">ActiveMQ</a> with a template generated response, then sending responses back to the JMSReplyTo Destination you could use this:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:My.Queue&amp;quot;). to(&amp;quot;velocity:com/acme/MyResponse.vm&amp;quot;); </script> 
 </div>
</div><p>Here is a simple example using the <a shape="rect" href="dsl.html">DSL</a> directly to transform the message body
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;).setBody(body().append(&amp;quot; World!&amp;quot;)).to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>In this example we add our own <a shape="rect" href="processor.html">Processor</a> using explicit Java code
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;).process(new Processor() { public void process(Exchange exchange) { Message in = exchange.getIn(); in.setBody(in.getBody(String.class) + &amp;quot; World!&amp;quot;); } }).to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>Finally we can use <a shape="rect" href="bean-integration.html">Bean Integration</a> to use any Java method on any bean to act as the transformer<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:My.Queue&amp;quot;). beanRef(&amp;quot;myBeanName&amp;quot;, &amp;quot;myMethodName&amp;quot;). to(&amp;quot;activemq:Another.Queue&amp;quot;); </script> 
 </div>
</div><p>For further examples of this pattern in use you could look at one of the JUnit tests</p><ul><li><a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/TransformTest.java?view=markup">TransformTest</a></li><li><a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/TransformViaDSLTest.java?view=markup">TransformViaDSLTest</a></li></ul><p><strong>Using Spring XML</strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:Input&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;myBeanName&amp;quot; method=&amp;quot;doTransform&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;activemq:Output&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p><span class="confluence-anchor-link" id="BookInOnePage-enrich-dsl"></span></p><h3 id="BookInOnePage-ContentenrichmentusingtheenrichDSLelement">Content enrichment using the <code>enrich</code> DSL element</h3><p>Camel comes with two flavors of content enricher in the DSL</p><ul class="alternate"><li><code>enrich</code></li><li><code>pollEnrich</code></li></ul><p><code>enrich</code> uses a <code>Producer</code> to obtain the additional data. It is usually used for <a shape="rect" href="request-reply.html">Request Reply</a> messaging, for instance to invoke an external web service.<br clear="none"> <code>pollEnrich</code> on the other hand uses a <a shape="rect" href="polling-consumer.html">Polling Consumer</a> to obtain the additional data. It is usually used for <a shape="rect" href="event-message.html">Event Message</a> messaging, for instance to read a file or download a <a shape="rect" href="ftp2.html">FTP</a> file.</p><div class="confluence-information-macro confluence-information-macro-warning">
 <p class="title">Camel 2.15 or older - Data from current Exchange not used</p>
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p><code>pollEnrich</code> or <code>enrich</code> does <strong>not</strong> access any data from the current <a shape="rect" href="exchange.html">Exchange</a> which means when polling it cannot use any of the existing headers you may have set on the <a shape="rect" href="exchange.html">Exchange</a>. For example you cannot set a filename in the <code>Exchange.FILE_NAME</code> header and use <code>pollEnrich</code> to consume only that file. For that you <strong>must</strong> set the filename in the endpoint URI.</p>
  <p>Instead of using <code>enrich</code> you can use <a shape="rect" href="recipient-list.html">Recipient List</a> and have dynamic endpoints and define an <code>AggregationStrategy</code> on the <a shape="rect" href="recipient-list.html">Recipient List</a> which then would work as a <code>enrich</code> would do.</p>
  <p>pollEnrich only accept one message as response. That means that if you target to enrich your original message with the enricher collecting messages from a seda, ... components using an aggregation strategy. Only one response message will be aggregated with the original message.</p>
  <p>From <strong>Camel 2.16</strong> onwards both enrich and pollEnrich supports dynamic endpoints that uses an <a shape="rect" href="expression.html">Expression</a> to compute the uri, which allows to use data from the current <a shape="rect" href="exchange.html">Exchange</a>. In other words all what is told above no longer apply and it just works.</p>
 </div>
</div><h3 id="BookInOnePage-EnrichOptions">Enrich Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>uri</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The endpoint uri for the external service to enrich from. You must use either <code>uri</code> or <code>ref</code>. <strong>Important:</strong> From Camel 2.16 onwards, this option is removed, and you use an <a shape="rect" href="expression.html">Expression</a> to configure the uri, such as <a shape="rect" href="simple.html">Simple</a> or <a shape="rect" href="constant.html">Constant</a> or any other dynamic language that can compute the uri dynamically using values from the current <a shape="rect" href="exchange.html">Exchange</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ref</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refers to the endpoint for the external service to enrich from. You must use either <code>uri</code> or <code>ref</code>. <span>&#160;</span><strong>Important:</strong><span> From Camel 2.16 onwards, this option is removed, and you use an </span><a shape="rect" href="expression.html">Expression</a><span> to configure the uri, such as </span><a shape="rect" href="simple.html">Simple</a><span> or </span><a shape="rect" href="constant.html">Constant</a><span> or any other dynamic language that can compute the uri dynamically using values from the current </span><span>&#160;</span><a shape="rect" href="exchange.html">Exchange</a><span>.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">expression</td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> Mandatory. The<span>&#160;</span><a shape="rect" href="expression.html">Expression</a><span> to configure the uri, such as </span><a shape="rect" href="simple.html">Simple</a><span> or </span><a shape="rect" href="constant.html">Constant</a><span> or any other dynamic language that can compute the uri dynamically using values from the current </span><span>&#160;</span><a shape="rect" href="exchange.html">Exchange</a><span>.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>strategyRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refers to an <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/aggregate/AggregationStrategy.html">AggregationStrategy</a> to be used to merge the reply from the external service, into a single outgoing message. By default Camel will use the reply from the external service as outgoing message. From <strong>Camel 2.12</strong> onwards you can also use a POJO as the <code>AggregationStrategy</code>, see the <a shape="rect" href="aggregator2.html">Aggregate</a> page for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>strategyMethodName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> This option can be used to explicit declare the method name to use, when using POJOs as the <code>AggregationStrategy</code>. See the <a shape="rect" href="aggregator2.html">Aggregate</a> page for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>strategyMethodAllowNull</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> If this option is <code>false</code> then the aggregate method is not used if there was no data to enrich. If this option is <code>true</code> then <code>null</code> values is used as the <code>oldExchange</code> (when no data to enrich), when using POJOs as the <code>AggregationStrategy</code>. See the <a shape="rect" href="aggregator2.html">Aggregate</a> page for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>aggregateOnException</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.14:</strong> If this option is <code>false</code> then the aggregate method is <strong>not</strong> used if there was an exception thrown while trying to retrieve the data to enrich from the resource. Setting this option to <code>true</code> allows end users to control what to do if there was an exception in the <code>aggregate</code> method. For example to suppress the exception or set a custom message body etc.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>shareUnitOfWork</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> <span style="color: rgb(0,0,0);">&#160;Shares the unit of work with the parent and the resource exchange. Enrich will by default not share unit of work between the parent exchange and the resource exchange. This means the resource exchange has its own individual unit of work. See <a shape="rect" href="splitter.html">Splitter</a> for more information and example.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>cacheSize</code></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> <span style="color: rgb(0,0,0);">Allows to configure the cache size for the&#160;</span><code>ProducerCache</code><span style="color: rgb(0,0,0);">&#160;which caches producers for reuse in the enrich. Will by default use the default cache size which is 1000. Setting the value to -1 allows to turn off the cache all together.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>ignoreInvalidEndpoint</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong><span style="color: rgb(0,0,0);">&#160;Whether to ignore an endpoint URI that could not be resolved. If disabled, Camel will throw an exception identifying the invalid endpoint URI.</span></td></tr></tbody></table> 
 </div>
</div><p><strong>Using the</strong> <strong><a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">AggregationStrategy aggregationStrategy = ... from(&amp;quot;direct:start&amp;quot;) .enrich(&amp;quot;direct:resource&amp;quot;, aggregationStrategy) .to(&amp;quot;direct:result&amp;quot;); from(&amp;quot;direct:resource&amp;quot;) ... </script> 
 </div>
</div><p>The content enricher (<code>enrich</code>) retrieves additional data from a <em>resource endpoint</em> in order to enrich an incoming message (contained in the <em>original exchange</em>). An aggregation strategy is used to combine the original exchange and the <em>resource exchange</em>. The first parameter of the <code>AggregationStrategy.aggregate(Exchange, Exchange)</code> method corresponds to the the original exchange, the second parameter the resource exchange. The results from the resource endpoint are stored in the resource exchange's out-message. Here's an example template for implementing an aggregation strategy:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public class ExampleAggregationStrategy implements AggregationStrategy { public Exchange aggregate(Exchange original, Exchange resource) { Object originalBody = original.getIn().getBody(); Object resourceResponse = resource.getIn().getBody(); Object mergeResult = ... // combine original body and resource response if (original.getPattern().isOutCapable()) { original.getOut().setBody(mergeResult); } else { original.getIn().setBody(mergeResult); } return original; } } </script> 
 </div>
</div><p>Using this template the original exchange can be of any pattern. The resource exchange created by the enricher is always an in-out exchange.</p><p><strong>Using Spring XML</strong></p><p>The same example in the Spring DSL (Camel 2.15 or older)</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext id=&amp;quot;camel&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;enrich uri=&amp;quot;direct:resource&amp;quot; strategyRef=&amp;quot;aggregationStrategy&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:resource&amp;quot;/&amp;gt; ... &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;bean id=&amp;quot;aggregationStrategy&amp;quot; class=&amp;quot;...&amp;quot; /&amp;gt; </script> 
 </div>
</div><p>The same example in the Spring DSL (Camel 2.16 or newer)</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext id=&amp;quot;camel&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;enrich strategyRef=&amp;quot;aggregationStrategy&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;direct:resource&amp;lt;/constant&amp;gt; &amp;lt;/enrich&amp;gt; &amp;lt;to uri=&amp;quot;direct:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:resource&amp;quot;/&amp;gt; ... &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;bean id=&amp;quot;aggregationStrategy&amp;quot; class=&amp;quot;...&amp;quot; /&amp;gt; </script> 
 </div>
</div><p>&#160;</p><h4 id="BookInOnePage-Aggregationstrategyisoptional">Aggregation strategy is optional</h4><p>The aggregation strategy is optional. If you do not provide it Camel will by default just use the body obtained from the resource.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .enrich(&amp;quot;direct:resource&amp;quot;) .to(&amp;quot;direct:result&amp;quot;); </script> 
 </div>
</div><p>In the route above the message sent to the <code>direct:result</code> endpoint will contain the output from the <code>direct:resource</code> as we do not use any custom aggregation.</p><p>And for Spring DSL (Camel 2.15 or older) just omit the <code>strategyRef</code> attribute:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;enrich uri=&amp;quot;direct:resource&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>And for Spring DSL (Camel 2.16 or newer) just omit the&#160;<code>strategyRef</code>&#160;attribute:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;enrich&amp;gt; &amp;lt;constant&amp;gt;direct:resource&amp;lt;/constant&amp;gt; &amp;lt;/enrich&amp;gt; &amp;lt;to uri=&amp;quot;direct:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Usingdynamicuris">Using dynamic uris</h3><p><strong>Available as of Camel 2.16</strong></p><p>From Camel 2.16 onwards enrich and pollEnrich supports using dynamic uris computed based on information from the current&#160;<a shape="rect" href="exchange.html">Exchange</a>. For example to enrich from a&#160;<a shape="rect" href="http.html">HTTP</a> endpoint where the header with key orderId is used as part of the content-path of the HTTP url:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .enrich().simple(&amp;quot;http:myserver/${header.orderId}/order&amp;quot;) .to(&amp;quot;direct:result&amp;quot;); </script> 
 </div>
</div><p>And in XML DSL</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;enrich&amp;gt; &amp;lt;simple&amp;gt;http:myserver/${header.orderId}/order&amp;lt;/simple&amp;gt; &amp;lt;/enrich&amp;gt; &amp;lt;to uri=&amp;quot;direct:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-ContentenrichmentusingpollEnrich">Content enrichment using <code>pollEnrich</code></h3><p>The <code>pollEnrich</code> works just as the <code>enrich</code> however as it uses a <a shape="rect" href="polling-consumer.html">Polling Consumer</a> we have 3 methods when polling</p><ul class="alternate"><li>receive</li><li>receiveNoWait</li><li>receive(timeout)</li></ul><h3 id="BookInOnePage-PollEnrichOptions">PollEnrich Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>uri</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The endpoint uri for the external service to enrich from. You must use either <code>uri</code> or <code>ref</code>. <strong>Important:</strong><span> From Camel 2.16 onwards, this option is removed, and you use an </span><a shape="rect" href="expression.html">Expression</a><span> to configure the uri, such as </span><a shape="rect" href="simple.html">Simple</a><span> or </span><a shape="rect" href="constant.html">Constant</a><span> or any other dynamic language that can compute the uri dynamically using values from the current </span><span>&#160;</span><a shape="rect" href="exchange.html">Exchange</a><span>.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ref</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refers to the endpoint for the external service to enrich from. You must use either <code>uri</code> or <code>ref</code>. <strong>Important:</strong><span> From Camel 2.16 onwards, this option is removed, and you use an </span><a shape="rect" href="expression.html">Expression</a><span> to configure the uri, such as </span><a shape="rect" href="simple.html">Simple</a><span> or </span><a shape="rect" href="constant.html">Constant</a><span> or any other dynamic language that can compute the uri dynamically using values from the current </span><span>&#160;</span><a shape="rect" href="exchange.html">Exchange</a><span>.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>expression</code></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong><span> Mandatory. The</span><span>&#160;</span><a shape="rect" href="expression.html">Expression</a><span> to configure the uri, such as </span><a shape="rect" href="simple.html">Simple</a><span> or </span><a shape="rect" href="constant.html">Constant</a><span> or any other dynamic language that can compute the uri dynamically using values from the current </span><span>&#160;</span><a shape="rect" href="exchange.html">Exchange</a><span>.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>strategyRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Refers to an <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/aggregate/AggregationStrategy.html">AggregationStrategy</a> to be used to merge the reply from the external service, into a single outgoing message. By default Camel will use the reply from the external service as outgoing message. From <strong>Camel 2.12</strong> onwards you can also use a POJO as the <code>AggregationStrategy</code>, see the <a shape="rect" href="aggregator2.html">Aggregate</a> page for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>strategyMethodName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> This option can be used to explicit declare the method name to use, when using POJOs as the <code>AggregationStrategy</code>. See the <a shape="rect" href="aggregator2.html">Aggregate</a> page for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>strategyMethodAllowNull</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> If this option is <code>false</code> then the aggregate method is not used if there was no data to enrich. If this option is <code>true</code> then <code>null</code> values is used as the <code>oldExchange</code> (when no data to enrich), when using POJOs as the <code>AggregationStrategy</code>. See the <a shape="rect" href="aggregator2.html">Aggregate</a> page for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>timeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>-1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Timeout in millis when polling from the external service. See below for important details about the timeout.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>aggregateOnException</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.14:</strong> If this option is <code>false</code> then the aggregate method is <strong>not</strong> used if there was an exception thrown while trying to retrieve the data to enrich from the resource. Setting this option to <code>true</code> allows end users to control what to do if there was an exception in the <code>aggregate</code> method. For example to suppress the exception or set a custom message body etc.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>cacheSize</code></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> <span style="color: rgb(0,0,0);">Allows to configure the cache size for the&#160;</span><code>ConsumerCache</code><span style="color: rgb(0,0,0);">&#160;which caches consumers for reuse in the pollEnrich. Will by default use the default cache size which is 1000. Setting the value to -1 allows to turn off the cache all together.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>ignoreInvalidEndpoint</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong><span style="color: rgb(0,0,0);">&#160;Whether to ignore an endpoint URI that could not be resolved. If disabled, Camel will throw an exception identifying the invalid endpoint URI.</span></td></tr></tbody></table> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Good practice to use timeout value</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>By default Camel will use the <code>receive</code>. Which may block until there is a message available. It is therefore recommended to always provide a timeout value, to make this clear that we may wait for a message, until the timeout is hit.</p>
 </div>
</div><p>If there is no data then the <code>newExchange</code> in the aggregation strategy is <code>null</code>.</p><p>You can pass in a timeout value that determines which method to use</p><ul class="alternate"><li>if timeout is -1 or other negative number then <code>receive</code> is selected (<strong>Important:</strong> the <code>receive</code> method may block if there is no message)</li><li>if timeout is 0 then <code>receiveNoWait</code> is selected</li><li>otherwise <code>receive(timeout)</code> is selected</li></ul><p>The timeout values is in millis.</p><div class="confluence-information-macro confluence-information-macro-warning">
 <p class="title">Camel 2.15 or older - Data from current Exchange not used</p>
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p><code>pollEnrich</code> does <strong>not</strong> access any data from the current <a shape="rect" href="exchange.html">Exchange</a> which means when polling it cannot use any of the existing headers you may have set on the <a shape="rect" href="exchange.html">Exchange</a>. For example you cannot set a filename in the <code>Exchange.FILE_NAME</code> header and use <code>pollEnrich</code> to consume only that file. For that you <strong>must</strong> set the filename in the endpoint URI.</p>
  <p><span>From </span><strong>Camel 2.16</strong><span> onwards both enrich and pollEnrich supports dynamic endpoints that uses an </span><a shape="rect" href="expression.html">Expression</a><span> to compute the uri, which allows to use data from the current </span><a shape="rect" href="exchange.html">Exchange</a><span>. In other words all what is told above no longer apply and it just works.</span></p>
 </div>
</div><h4 id="BookInOnePage-Example.11">Example</h4><p>In this example we enrich the message by loading the content from the file named inbox/data.txt.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .pollEnrich(&amp;quot;file:inbox?fileName=data.txt&amp;quot;) .to(&amp;quot;direct:result&amp;quot;); </script> 
 </div>
</div><p>And in XML DSL (Camel 2.15 or older) you do:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;pollEnrich uri=&amp;quot;file:inbox?fileName=data.txt&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>And in XML DSL (Camel 2.16 or newer) you do:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;pollEnrich&amp;gt; &amp;lt;constant&amp;gt;file:inbox?fileName=data.txt&amp;lt;/constant&amp;gt; &amp;lt;/pollEnrich&amp;gt; &amp;lt;to uri=&amp;quot;direct:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>&#160;</p><p>If there is no file then the message is empty. We can use a timeout to either wait (potentially forever) until a file exists, or use a timeout to wait a certain period.</p><p>For example to wait up to 5 seconds you can do (Camel 2.15 or older):</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;pollEnrich uri=&amp;quot;file:inbox?fileName=data.txt&amp;quot; timeout=&amp;quot;5000&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>For example to wait up to 5 seconds you can do (Camel 2.16 or newer):</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;pollEnrich timeout=&amp;quot;5000&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;file:inbox?fileName=data.txt&amp;lt;/constant&amp;gt; &amp;lt;/pollEnrich&amp;gt; &amp;lt;to uri=&amp;quot;direct:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Usingdynamicuris.1">Using dynamic uris</h3><p><strong>Available as of Camel 2.16</strong></p><p>From Camel 2.16 onwards enrich and pollEnrich supports using dynamic uris computed based on information from the current&#160;<a shape="rect" href="exchange.html">Exchange</a>. For example to pollEnrich from an endpoint that uses a header to indicate a&#160;<a shape="rect" href="seda.html">SEDA</a>&#160;queue name:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .pollEnrich().simple(&amp;quot;seda:${header.name}&amp;quot;) .to(&amp;quot;direct:result&amp;quot;); </script> 
 </div>
</div><p>And in XML DSL</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;pollEnrich&amp;gt; &amp;lt;simple&amp;gt;seda:${header.name}&amp;lt;/simple&amp;gt; &amp;lt;/pollEnrich&amp;gt; &amp;lt;to uri=&amp;quot;direct:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p></p><h4 id="BookInOnePage-UsingThisPattern.30">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-ContentFilter">Content Filter</h3><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/ContentFilter.html" rel="nofollow">Content Filter</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> using one of the following mechanisms in the routing logic to transform content from the inbound message.</p><ul><li><a shape="rect" href="message-translator.html">Message Translator</a></li><li>invoking a <a shape="rect" href="bean-integration.html">Java bean</a></li><li><a shape="rect" href="processor.html">Processor</a> object</li></ul><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/ContentFilter.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/ContentFilter.gif"></span></p><p>A common way to filter messages is to use an <a shape="rect" href="expression.html">Expression</a> in the <a shape="rect" href="dsl.html">DSL</a> like <a shape="rect" href="xquery.html">XQuery</a>, <a shape="rect" href="sql.html">SQL</a> or one of the supported <a shape="rect" href="scripting-languages.html">Scripting Languages</a>.</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><p>Here is a simple example using the <a shape="rect" href="dsl.html">DSL</a> directly</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;).setBody(body().append(&amp;quot; World!&amp;quot;)).to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>In this example we add our own <a shape="rect" href="processor.html">Processor</a></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;).process(new Processor() { public void process(Exchange exchange) { Message in = exchange.getIn(); in.setBody(in.getBody(String.class) + &amp;quot; World!&amp;quot;); } }).to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>For further examples of this pattern in use you could look at one of the JUnit tests</p><ul><li><a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/TransformTest.java?view=markup">TransformTest</a></li><li><a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/TransformViaDSLTest.java?view=markup">TransformViaDSLTest</a></li></ul><p><strong>Using Spring XML</strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:Input&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;myBeanName&amp;quot; method=&amp;quot;doTransform&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;activemq:Output&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>You can also use XPath to filter out part of the message you are interested in:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:Input&amp;quot;/&amp;gt; &amp;lt;setBody&amp;gt;&amp;lt;xpath resultType=&amp;quot;org.w3c.dom.Document&amp;quot;&amp;gt;//foo:bar&amp;lt;/xpath&amp;gt;&amp;lt;/setBody&amp;gt; &amp;lt;to uri=&amp;quot;activemq:Output&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-UsingThisPattern.31">Using This Pattern</h4><p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-ClaimCheck">Claim Check</h3><p>The <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/StoreInLibrary.html" rel="nofollow">Claim Check</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> allows you to replace message content with a claim check (a unique key), which can be used to retrieve the message content at a later time. The message content is stored temporarily in a persistent store like a database or file system. This pattern is very useful when message content is very large (thus it would be expensive to send around) and not all components require all information. </p><p>It can also be useful in situations where you cannot trust the information with an outside party; in this case, you can use the Claim Check to hide the sensitive portions of data. </p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/StoreInLibrary.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/StoreInLibrary.gif"></span></p><h4 id="BookInOnePage-Example.12">Example</h4><p>In this example we want to replace a message body with a claim check, and restore the body at a later step.</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;).to(&amp;quot;bean:checkLuggage&amp;quot;, &amp;quot;mock:testCheckpoint&amp;quot;, &amp;quot;bean:dataEnricher&amp;quot;, &amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;pipeline&amp;gt; &amp;lt;to uri=&amp;quot;bean:checkLuggage&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:testCheckpoint&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:dataEnricher&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/pipeline&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>The example route is pretty simple - its just a <a shape="rect" href="pipes-and-filters.html">Pipeline</a>. In a real application you would have some other steps where the <code>mock:testCheckpoint</code> endpoint is in the example.</p><p>The message is first sent to the <code>checkLuggage</code> bean which looks like</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public static final class CheckLuggageBean { public void checkLuggage(Exchange exchange, @Body String body, @XPath(&amp;quot;/order/@custId&amp;quot;) String custId) { // store the message body into the data store, using the custId as the claim check dataStore.put(custId, body); // add the claim check as a header exchange.getIn().setHeader(&amp;quot;claimCheck&amp;quot;, custId); // remove the body from the message exchange.getIn().setBody(null); } } </script> 
 </div>
</div><p>This bean stores the message body into the data store, using the <code>custId</code> as the claim check. In this example, we're just using a <code>HashMap</code> to store the message body; in a real application you would use a database or file system, etc. Next the claim check is added as a message header for use later. Finally we remove the body from the message and pass it down the pipeline. </p><p>The next step in the pipeline is the <code>mock:testCheckpoint</code> endpoint which is just used to check that the message body is removed, claim check added, etc.</p><p>To add the message body back into the message, we use the <code>dataEnricher</code> bean which looks like</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public static final class DataEnricherBean { public void addDataBackIn(Exchange exchange, @Header(&amp;quot;claimCheck&amp;quot;) String claimCheck) { // query the data store using the claim check as the key and add the data // back into the message body exchange.getIn().setBody(dataStore.get(claimCheck)); // remove the message data from the data store dataStore.remove(claimCheck); // remove the claim check header exchange.getIn().removeHeader(&amp;quot;claimCheck&amp;quot;); } } </script> 
 </div>
</div><p>This bean queries the data store using the claim check as the key and then adds the data back into the message. The message body is then removed from the data store and finally the claim check is removed. Now the message is back to what we started with!</p><p>For full details, check the example source here:</p><p><a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/ClaimCheckTest.java">camel-core/src/test/java/org/apache/camel/processor/ClaimCheckTest.java</a></p><h4 id="BookInOnePage-UsingThisPattern.32">Using This Pattern</h4><p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-Normalizer">Normalizer</h3><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/Normalizer.html" rel="nofollow">Normalizer</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> by using a <a shape="rect" href="message-router.html">Message Router</a> in front of a number of <a shape="rect" href="message-translator.html">Message Translator</a> instances.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/NormalizerDetail.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/NormalizerDetail.gif"></span></p><h4 id="BookInOnePage-Example.13">Example</h4><p>This example shows a Message Normalizer that converts two types of XML messages into a common format. Messages in this common format are then filtered.</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // we need to normalize two types of incoming messages from(&amp;quot;direct:start&amp;quot;) .choice() .when().xpath(&amp;quot;/employee&amp;quot;).to(&amp;quot;bean:normalizer?method=employeeToPerson&amp;quot;) .when().xpath(&amp;quot;/customer&amp;quot;).to(&amp;quot;bean:normalizer?method=customerToPerson&amp;quot;) .end() .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>In this case we're using a Java bean as the normalizer. The class looks like this</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public class MyNormalizer { public void employeeToPerson(Exchange exchange, @XPath(&amp;quot;/employee/name/text()&amp;quot;) String name) { exchange.getOut().setBody(createPerson(name)); } public void customerToPerson(Exchange exchange, @XPath(&amp;quot;/customer/@name&amp;quot;) String name) { exchange.getOut().setBody(createPerson(name)); } private String createPerson(String name) { return &amp;quot;&amp;lt;person name=\&amp;quot;&amp;quot; + name + &amp;quot;\&amp;quot;/&amp;gt;&amp;quot;; } } </script> 
 </div>
</div><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><p>The same example in the Spring DSL</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;choice&amp;gt; &amp;lt;when&amp;gt; &amp;lt;xpath&amp;gt;/employee&amp;lt;/xpath&amp;gt; &amp;lt;to uri=&amp;quot;bean:normalizer?method=employeeToPerson&amp;quot;/&amp;gt; &amp;lt;/when&amp;gt; &amp;lt;when&amp;gt; &amp;lt;xpath&amp;gt;/customer&amp;lt;/xpath&amp;gt; &amp;lt;to uri=&amp;quot;bean:normalizer?method=customerToPerson&amp;quot;/&amp;gt; &amp;lt;/when&amp;gt; &amp;lt;/choice&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;bean id=&amp;quot;normalizer&amp;quot; class=&amp;quot;org.apache.camel.processor.MyNormalizer&amp;quot;/&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-SeeAlso.13">See Also</h4><ul><li><a shape="rect" href="message-router.html">Message Router</a></li><li><a shape="rect" href="content-based-router.html">Content Based Router</a></li><li><a shape="rect" href="message-translator.html">Message Translator</a></li></ul><h4 id="BookInOnePage-UsingThisPattern.33">Using This Pattern</h4><p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h2 id="BookInOnePage-Sort">Sort</h2><p>Sort can be used to sort a message. Imagine you consume text files and before processing each file you want to be sure the content is sorted.</p><p>Sort will by default sort the body using a default comparator that handles numeric values or uses the string representation. You can provide your own comparator, and even an expression to return the value to be sorted. Sort requires the value returned from the expression evaluation is convertible to <code>java.util.List</code> as this is required by the JDK sort operation.</p><h3 id="BookInOnePage-Options.18">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default Value </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>comparatorRef</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Refers to a custom <code>java.util.Comparator</code> to use for sorting the message body. Camel will by default use a comparator which does a A..Z sorting. </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-UsingfromJavaDSL">Using from Java DSL</h3><p>In the route below it will read the file content and tokenize by line breaks so each line can be sorted. </p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;file://inbox&amp;quot;).sort(body().tokenize(&amp;quot;\n&amp;quot;)).to(&amp;quot;bean:MyServiceBean.processLine&amp;quot;); </script> 
 </div>
</div><p>You can pass in your own comparator as a 2nd argument:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;file://inbox&amp;quot;).sort(body().tokenize(&amp;quot;\n&amp;quot;), new MyReverseComparator()).to(&amp;quot;bean:MyServiceBean.processLine&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-UsingfromSpringDSL">Using from Spring DSL</h3><p>In the route below it will read the file content and tokenize by line breaks so each line can be sorted. </p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>Camel 2.7 or better</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;file://inbox&amp;quot;/&amp;gt; &amp;lt;sort&amp;gt; &amp;lt;simple&amp;gt;body&amp;lt;/simple&amp;gt; &amp;lt;/sort&amp;gt; &amp;lt;beanRef ref=&amp;quot;myServiceBean&amp;quot; method=&amp;quot;processLine&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>Camel 2.6 or older</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;file://inbox&amp;quot;/&amp;gt; &amp;lt;sort&amp;gt; &amp;lt;expression&amp;gt; &amp;lt;simple&amp;gt;body&amp;lt;/simple&amp;gt; &amp;lt;/expression&amp;gt; &amp;lt;/sort&amp;gt; &amp;lt;beanRef ref=&amp;quot;myServiceBean&amp;quot; method=&amp;quot;processLine&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>And to use our own comparator we can refer to it as a spring bean:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>Camel 2.7 or better</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;file://inbox&amp;quot;/&amp;gt; &amp;lt;sort comparatorRef=&amp;quot;myReverseComparator&amp;quot;&amp;gt; &amp;lt;simple&amp;gt;body&amp;lt;/simple&amp;gt; &amp;lt;/sort&amp;gt; &amp;lt;beanRef ref=&amp;quot;MyServiceBean&amp;quot; method=&amp;quot;processLine&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;bean id=&amp;quot;myReverseComparator&amp;quot; class=&amp;quot;com.mycompany.MyReverseComparator&amp;quot;/&amp;gt; </script> 
 </div>
</div><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>Camel 2.6 or older</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;file://inbox&amp;quot;/&amp;gt; &amp;lt;sort comparatorRef=&amp;quot;myReverseComparator&amp;quot;&amp;gt; &amp;lt;expression&amp;gt; &amp;lt;simple&amp;gt;body&amp;lt;/simple&amp;gt; &amp;lt;/expression&amp;gt; &amp;lt;/sort&amp;gt; &amp;lt;beanRef ref=&amp;quot;MyServiceBean&amp;quot; method=&amp;quot;processLine&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;bean id=&amp;quot;myReverseComparator&amp;quot; class=&amp;quot;com.mycompany.MyReverseComparator&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>Besides <code>&lt;simple&gt;</code>, you can supply an expression using any <a shape="rect" href="languages.html">language</a> you like, so long as it returns a list.</p><h4 id="BookInOnePage-UsingThisPattern.34">Using This Pattern</h4><p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h2 id="BookInOnePage-MessagingEndpoints.1">Messaging Endpoints</h2><h3 id="BookInOnePage-MessagingMapper">Messaging Mapper</h3><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/MessagingMapper.html" rel="nofollow">Messaging Mapper</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> by using either <a shape="rect" href="message-translator.html">Message Translator</a> pattern or the <a shape="rect" href="type-converter.html">Type Converter</a> module.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/MessagingMapperClassDiagram.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/MessagingMapperClassDiagram.gif"></span></p><h4 id="BookInOnePage-Example.14">Example</h4><p>The following example demonstrates the use of a&#160;<a shape="rect" href="bean.html">Bean</a> component to map between two messaging system</p><p><strong>Using the&#160;<a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:foo&amp;quot;) .beanRef(&amp;quot;transformerBean&amp;quot;, &amp;quot;transform&amp;quot;) .to(&amp;quot;jms:bar&amp;quot;);</script> 
 </div>
</div><p>&#160;</p><p><strong><strong>Using the&#160;<a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:foo&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;transformerBean&amp;quot; method=&amp;quot;transform&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;jms:bar&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt;</script> 
 </div>
</div><h4 id="BookInOnePage-Seealso.2">See also</h4><ul><li><a shape="rect" href="message-translator.html">Message Translator</a></li><li><a shape="rect" href="type-converter.html">Type Converter</a></li><li><a shape="rect" href="cxf.html">CXF</a> for JAX-WS support for binding business logic to messaging &amp; web services</li><li><a shape="rect" href="pojo.html">Pojo</a></li><li><a shape="rect" href="bean.html">Bean</a></li></ul><p></p><h4 id="BookInOnePage-UsingThisPattern.35">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-EventDrivenConsumer">Event Driven Consumer</h3><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/EventDrivenConsumer.html" rel="nofollow">Event Driven Consumer</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a>. The default consumer model is event based (i.e. asynchronous) as this means that the Camel container can then manage pooling, threading and concurrency for you in a declarative manner.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/EventDrivenConsumerSolution.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/EventDrivenConsumerSolution.gif"></span></p><p>The Event Driven Consumer is implemented by consumers implementing the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Processor.html">Processor</a> interface which is invoked by the <a shape="rect" href="message-endpoint.html">Message Endpoint</a> when a <a shape="rect" href="message.html">Message</a> is available for processing.</p><h4 id="BookInOnePage-Example.15">Example</h4><p>The following demonstrates a&#160;<a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Processor.html">Processor</a>&#160;defined in the Camel &#160;<a shape="rect" href="registry.html">Registry</a>&#160;which is invoked when an event occurs from a&#160;<a shape="rect" href="jms.html">JMS</a> queue</p><p><strong><br clear="none"></strong></p><p><strong>Using the&#160;<a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;jms:queue:foo&amp;quot;) .processRef(&amp;quot;processor&amp;quot;);</script> 
 </div>
</div><p>&#160;</p><p><strong><strong>Using the&#160;<a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;jms:queue:foo&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;processor&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt;</script> 
 </div>
</div><p>&#160;</p><p>For more details see</p><ul><li><a shape="rect" href="message.html">Message</a></li><li><a shape="rect" href="message-endpoint.html">Message Endpoint</a></li></ul><p></p><h4 id="BookInOnePage-UsingThisPattern.36">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-PollingConsumer">Polling Consumer</h3><p>Camel supports implementing the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/PollingConsumer.html" rel="nofollow">Polling Consumer</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> using the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/PollingConsumer.html">PollingConsumer</a> interface which can be created via the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Endpoint.html#createPollingConsumer()">Endpoint.createPollingConsumer()</a> method.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/PollingConsumerSolution.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/PollingConsumerSolution.gif"></span></p><p>In Java:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Endpoint endpoint = context.getEndpoint(&amp;quot;activemq:my.queue&amp;quot;); PollingConsumer consumer = endpoint.createPollingConsumer(); Exchange exchange = consumer.receive(); </script> 
 </div>
</div><p>The <strong><code>ConsumerTemplate</code></strong> (discussed below) is also available.</p><p>There are three main polling methods on <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/PollingConsumer.html">PollingConsumer</a></p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Method name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/PollingConsumer.html#receive()">receive()</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Waits until a message is available and then returns it; potentially blocking forever</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/PollingConsumer.html#receive(long)">receive(long)</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Attempts to receive a message exchange, waiting up to the given timeout and returning null if no message exchange could be received within the time available</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/PollingConsumer.html#receiveNoWait()">receiveNoWait()</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Attempts to receive a message exchange immediately without waiting and returning null if a message exchange is not available yet</p></td></tr></tbody></table>
</div><h3 id="BookInOnePage-EventDrivenPollingConsumerOptions">EventDrivenPollingConsumer Options</h3><p>The&#160;<strong><code>EventDrivePollingConsumer</code></strong> (the default implementation) supports the following options:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>pollingConsumerQueueSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.14/2.13.1/2.12.4:</strong> The queue size for the internal hand-off queue between the polling consumer, and producers sending data into the queue.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>pollingConsumerBlockWhenFull</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.14/2.13.1/2.12/4:</strong> Whether to block any producer if the internal queue is full.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><span><code>pollingConsumerBlockTimeout</code></span></td><td colspan="1" rowspan="1" class="confluenceTd">0</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> To use a timeout (in milliseconds) when the producer is blocked if the internal queue is full. If the value is&#160;<strong><code>0</code></strong> or negative then no timeout is in use. If a timeout is triggered then a&#160;<strong><code>ExchangeTimedOutException</code></strong> is thrown.</td></tr></tbody></table> 
 </div>
</div><p>Notice that some Camel&#160;<a shape="rect" href="components.html">Components</a>&#160;has their own implementation of&#160;<strong><code>PollingConsumer</code></strong> and therefore do not support the options above.</p><p>You can configure these options in endpoints&#160;<a shape="rect" href="uris.html">URIs</a>, such as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Endpoint endpoint = context.getEndpoint(&amp;quot;file:inbox?pollingConsumerQueueSize=50&amp;quot;); PollingConsumer consumer = endpoint.createPollingConsumer(); Exchange exchange = consumer.receive(5000);</script> 
 </div>
</div><h3 id="BookInOnePage-ConsumerTemplate">ConsumerTemplate</h3><p>The <strong><code>ConsumerTemplate</code></strong> is a template much like Spring's&#160;<strong><code>JmsTemplate</code></strong> or&#160;<strong><code>JdbcTemplate</code></strong> supporting the <a shape="rect" href="polling-consumer.html">Polling Consumer</a> EIP. With the template you can consume <a shape="rect" href="exchange.html">Exchange</a>s from an <a shape="rect" href="endpoint.html">Endpoint</a>. The template supports the three operations listed above. However, it also includes convenient methods for returning the body, etc <strong><code>consumeBody</code></strong>.</p><p>Example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Exchange exchange = consumerTemplate.receive(&amp;quot;activemq:my.queue&amp;quot;); </script> 
 </div>
</div><p>Or to extract and get the body you can do:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Object body = consumerTemplate.receiveBody(&amp;quot;activemq:my.queue&amp;quot;); </script> 
 </div>
</div><p>And you can provide the body type as a parameter and have it returned as the type:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">String body = consumerTemplate.receiveBody(&amp;quot;activemq:my.queue&amp;quot;, String.class); </script> 
 </div>
</div><p>You get hold of a <strong><code>ConsumerTemplate</code></strong> from the <strong><code>CamelContext</code></strong> with the <strong><code>createConsumerTemplate</code></strong> operation:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">ConsumerTemplate consumer = context.createConsumerTemplate(); </script> 
 </div>
</div><h4 id="BookInOnePage-UsingConsumerTemplatewithSpringDSL">Using ConsumerTemplate with Spring DSL</h4><p>With the Spring DSL we can declare the consumer in the&#160;<strong><code>CamelContext</code></strong> with the <strong><code>consumerTemplate</code></strong> tag, just like the <strong><code>ProducerTemplate</code></strong>. The example below illustrates this:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;!-- define a producer template --&amp;gt; &amp;lt;template id=&amp;quot;producer&amp;quot;/&amp;gt; &amp;lt;!-- define a consumer template --&amp;gt; &amp;lt;consumerTemplate id=&amp;quot;consumer&amp;quot;/&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;seda:foo&amp;quot;/&amp;gt; &amp;lt;to id=&amp;quot;result&amp;quot; uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
  </div>
 </div>Then we can get leverage Spring to inject the <strong><code>ConsumerTemplate</code></strong> in our java class. The code below is part of an unit test but it shows how the consumer and producer can work together.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> @ContextConfiguration public class SpringConsumerTemplateTest extends SpringRunWithTestSupport { @Autowired private ProducerTemplate producer; @Autowired private ConsumerTemplate consumer; @EndpointInject(ref = &amp;quot;result&amp;quot;) private MockEndpoint mock; @Test public void testConsumeTemplate() throws Exception { // we expect Hello World received in our mock endpoint mock.expectedBodiesReceived(&amp;quot;Hello World&amp;quot;); // we use the producer template to send a message to the seda:start endpoint producer.sendBody(&amp;quot;seda:start&amp;quot;, &amp;quot;Hello World&amp;quot;); // we consume the body from seda:start String body = consumer.receiveBody(&amp;quot;seda:start&amp;quot;, String.class); assertEquals(&amp;quot;Hello World&amp;quot;, body); // and then we send the body again to seda:foo so it will be routed to the mock // endpoint so our unit test can complete producer.sendBody(&amp;quot;seda:foo&amp;quot;, body); // assert mock received the body mock.assertIsSatisfied(); } } </script> 
  </div>
 </div><h4 id="BookInOnePage-TimerBasedPollingConsumer">Timer Based Polling Consumer</h4><p>In this sample we use a <a shape="rect" href="timer.html">Timer</a> to schedule a route to be started every 5th second and invoke our bean&#160;<strong><code>MyCoolBean</code></strong> where we implement the business logic for the <a shape="rect" href="polling-consumer.html">Polling Consumer</a>. Here we want to consume all messages from a JMS queue, process the message and send them to the next queue.</p><p>First we setup our route as:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> MyCoolBean cool = new MyCoolBean(); cool.setProducer(template); cool.setConsumer(consumer); from(&amp;quot;timer://foo?period=5000&amp;quot;).bean(cool, &amp;quot;someBusinessLogic&amp;quot;); from(&amp;quot;activemq:queue.foo&amp;quot;).to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>And then we have out logic in our bean:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public static class MyCoolBean { private int count; private ConsumerTemplate consumer; private ProducerTemplate producer; public void setConsumer(ConsumerTemplate consumer) { this.consumer = consumer; } public void setProducer(ProducerTemplate producer) { this.producer = producer; } public void someBusinessLogic() { // loop to empty queue while (true) { // receive the message from the queue, wait at most 3 sec String msg = consumer.receiveBody(&amp;quot;activemq:queue.inbox&amp;quot;, 3000, String.class); if (msg == null) { // no more messages in queue break; } // do something with body msg = &amp;quot;Hello &amp;quot; + msg; // send it to the next queue producer.sendBodyAndHeader(&amp;quot;activemq:queue.foo&amp;quot;, msg, &amp;quot;number&amp;quot;, count++); } } } </script> 
  </div>
 </div><h3 id="BookInOnePage-ScheduledPollComponents">Scheduled Poll Components</h3><p>Quite a few inbound Camel endpoints use a scheduled poll pattern to receive messages and push them through the Camel processing routes. That is to say externally from the client the endpoint appears to use an <a shape="rect" href="event-driven-consumer.html">Event Driven Consumer</a> but internally a scheduled poll is used to monitor some kind of state or resource and then fire message exchanges.</p><p>Since this a such a common pattern, polling components can extend the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/impl/ScheduledPollConsumer.html">ScheduledPollConsumer</a> base class which makes it simpler to implement this pattern. There is also the <a shape="rect" href="quartz.html">Quartz Component</a> which provides scheduled delivery of messages using the Quartz enterprise scheduler.</p><p>For more details see:</p><ul><li><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/PollingConsumer.html">PollingConsumer</a></li><li>Scheduled Polling Components
  <ul><li><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/impl/ScheduledPollConsumer.html">ScheduledPollConsumer</a></li><li><a shape="rect" href="scheduler.html">Scheduler</a></li><li><a shape="rect" href="atom.html">Atom</a></li><li><a shape="rect" href="beanstalk.html">Beanstalk</a></li><li><a shape="rect" href="file2.html">File</a></li><li><a shape="rect" href="ftp2.html">FTP</a></li><li><a shape="rect" href="hbase.html">hbase</a></li><li><a shape="rect" href="ibatis.html">iBATIS</a></li><li><a shape="rect" href="jpa.html">JPA</a></li><li><a shape="rect" href="mail.html">Mail</a></li><li><a shape="rect" href="mybatis.html">MyBatis</a></li><li><a shape="rect" href="quartz.html">Quartz</a></li><li><a shape="rect" href="snmp.html">SNMP</a></li><li><a shape="rect" href="aws-s3.html">AWS-S3</a></li><li><a shape="rect" href="aws-sqs.html">AWS-SQS</a></li></ul></li></ul><h3 id="BookInOnePage-ScheduledPollConsumerOptions">ScheduledPollConsumer Options</h3><p>The&#160;<strong><code>ScheduledPollConsumer</code></strong> supports the following options:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>backoffErrorThreshold</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> The number of subsequent error polls (failed due some error) that should happen before the <strong><code>backoffMultipler</code></strong> should kick-in.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>backoffIdleThreshold</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> The number of subsequent idle polls that should happen before the <strong><code>backoffMultipler</code></strong> should kick-in.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>backoffMultiplier</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> To let the scheduled polling consumer back-off if there has been a number of subsequent idles/errors in a row. The multiplier is then the number of polls that will be skipped before the next actual attempt is happening again. When this option is in use then <strong><code>backoffIdleThreshold</code></strong> and/or <strong><code>backoffErrorThreshold</code></strong> must also be configured.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>delay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>500</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Milliseconds before the next poll.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>greedy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.6/2.11.1:</strong> If greedy is enabled, then the&#160;<strong><code>ScheduledPollConsumer</code></strong> will run immediately again, if the previous run polled 1 or more messages.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>initialDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Milliseconds before the first poll starts.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>pollStrategy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p>A pluggable <strong><code>org.apache.camel.PollingConsumerPollingStrategy</code></strong> allowing you to provide your custom implementation to control error handling usually occurred during the <strong><code>poll</code></strong> operation <em><strong>before</strong></em> an <a shape="rect" href="exchange.html">Exchange</a> has been created and routed in Camel. In other words the error occurred while the polling was gathering information, for instance access to a file network failed so Camel cannot access it to scan for files.</p><p>The default implementation will log the caused exception at <strong><code>WARN</code></strong> level and ignore it.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>runLoggingLevel</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>TRACE</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> The consumer logs a start/complete log line when it polls. This option allows you to configure the logging level for that.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>scheduledExecutorService</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Allows for configuring a custom/shared thread pool to use for the consumer. By default each consumer has its own single threaded thread pool. This option allows you to share a thread pool among multiple consumers.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>scheduler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> Allow to plugin a custom <strong><code>org.apache.camel.spi.ScheduledPollConsumerScheduler</code></strong> to use as the scheduler for firing when the polling consumer runs. The default implementation uses the <strong><code>ScheduledExecutorService</code></strong> and there is a <a shape="rect" href="quartz2.html">Quartz2</a>, and <a shape="rect" href="spring.html">Spring</a> based which supports CRON expressions. <strong>Notice:</strong> If using a custom scheduler then the options for <strong><code>initialDelay</code>, <code>useFixedDelay</code></strong>, <strong><code>timeUnit</code></strong> and <strong><code>scheduledExecutorService</code></strong> may not be in use. Use the text <strong><code>quartz2</code></strong> to refer to use the <a shape="rect" href="quartz2.html">Quartz2</a> scheduler; and use the text <code>spring</code> to use the <a shape="rect" href="spring.html">Spring</a> based; and use the text <strong><code>#myScheduler</code></strong> to refer to a custom scheduler by its id in the <a shape="rect" href="registry.html">Registry</a>.</p><p>See <a shape="rect" href="quartz2.html">Quartz2</a> page for an example.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>scheduler.xxx</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> To configure additional properties when using a custom <strong><code>scheduler</code></strong> or any of the <a shape="rect" href="quartz2.html">Quartz2</a>, <a shape="rect" href="spring.html">Spring</a> based scheduler.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sendEmptyMessageWhenIdle</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> If the polling consumer did not poll any files, you can enable this option to send an empty message (no body) instead.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>startScheduler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether the scheduler should be auto started.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>timeUnit</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>TimeUnit.MILLISECONDS</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Time unit for <strong><code>initialDelay</code></strong> and <strong><code>delay</code></strong> options.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>useFixedDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Controls if fixed delay or fixed rate is used. See <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ScheduledExecutorService.html" rel="nofollow">ScheduledExecutorService</a> in JDK for details. In <strong>Camel 2.7.x</strong> or older the default value is <strong><code>false</code></strong>.</p><p>From <strong>Camel 2.8</strong>: the default value is <strong><code>true</code></strong>.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-UsingbackofftoLettheSchedulerbeLessAggressive">Using&#160;<code>backoff</code> to Let the Scheduler be Less Aggressive</h3><p><strong>Available as of Camel 2.12</strong></p><p>The scheduled <a shape="rect" href="polling-consumer.html">Polling Consumer</a> is by default static by using the same poll frequency whether or not there is messages to pickup or not.</p><p>From <strong>Camel 2.12</strong>: you can configure the scheduled <a shape="rect" href="polling-consumer.html">Polling Consumer</a> to be more dynamic by using <strong><code>backoff</code></strong>. This allows the scheduler to skip N number of polls when it becomes idle, or there has been X number of errors in a row. See more details in the table above for the <strong><code>backoffXXX</code></strong> options.</p><p>For example to let a FTP consumer back-off if its becoming idle for a while you can do:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;ftp://myserver?username=foo&amp;amp;passowrd=secret?delete=true&amp;amp;delay=5s&amp;amp;backoffMultiplier=6&amp;amp;backoffIdleThreshold=5&amp;quot;) .to(&amp;quot;bean:processFile&amp;quot;); </script> 
 </div>
</div><p>In this example, the FTP consumer will poll for new FTP files every 5th second. But if it has been idle for 5 attempts in a row, then it will back-off using a multiplier of 6, which means it will now poll every 5 x 6 = 30th second instead. When the consumer eventually pickup a file, then the back-off will reset, and the consumer will go back and poll every 5th second again.</p><p>Camel will log at <strong><code>DEBUG</code></strong> level using <strong><code>org.apache.camel.impl.ScheduledPollConsumer</code></strong> when back-off is kicking-in.</p><h3 id="BookInOnePage-AboutErrorHandlingandScheduledPollingConsumers">About Error Handling and Scheduled Polling Consumers</h3><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/impl/ScheduledPollConsumer.html">ScheduledPollConsumer</a> is scheduled based and its <strong><code>run</code></strong> method is invoked periodically based on schedule settings. But errors can also occur when a poll is being executed. For instance if Camel should poll a file network, and this network resource is not available then a <strong><code>java.io.IOException</code></strong> could occur. As this error happens <strong>before</strong> any <a shape="rect" href="exchange.html">Exchange</a> has been created and prepared for routing, then the regular <a shape="rect" href="error-handling-in-camel.html">Error handling in Camel</a> does not apply. So what does the consumer do then? Well the exception is propagated back to the <strong><code>run</code></strong> method where its handled. Camel will by default log the exception at <strong><code>WARN</code></strong> level and then ignore it. At next schedule the error could have been resolved and thus being able to poll the endpoint successfully.</p><h3 id="BookInOnePage-UsingaCustomScheduler">Using a Custom Scheduler</h3><p><strong>Available as of Camel 2.12:</strong></p><p>The SPI interface <strong><code>org.apache.camel.spi.ScheduledPollConsumerScheduler</code></strong> allows to implement a custom scheduler to control when the <a shape="rect" href="polling-consumer.html">Polling Consumer</a> runs. The default implementation is based on the JDKs <strong><code>ScheduledExecutorService</code></strong> with a single thread in the thread pool. There is a CRON based implementation in the <a shape="rect" href="quartz2.html">Quartz2</a>, and <a shape="rect" href="spring.html">Spring</a> components.</p><p>For an example of developing and using a custom scheduler, see the unit test <strong><code>org.apache.camel.component.file.FileConsumerCustomSchedulerTest</code></strong> from the source code in <strong><code>camel-core</code></strong>.</p><h4 id="BookInOnePage-ErrorHandlingWhenUsingPollingConsumerPollStrategy">Error Handling When Using&#160;<code>PollingConsumerPollStrategy</code></h4><p><strong><code>org.apache.camel.PollingConsumerPollStrategy</code></strong> is a pluggable strategy that you can configure on the <strong><code>ScheduledPollConsumer</code></strong>. The default implementation <strong><code>org.apache.camel.impl.DefaultPollingConsumerPollStrategy</code></strong> will log the caused exception at <strong><code>WARN</code></strong> level and then ignore this issue.</p><p>The strategy interface provides the following three methods:</p><ul class="alternate"><li><strong><code>begin</code></strong><br clear="none">
  <ul class="alternate"><li><code>void begin(Consumer consumer, Endpoint endpoint)</code></li></ul></li><li><strong><code>begin</code></strong>&#160;(<strong>Camel 2.3</strong>)
  <ul class="alternate"><li><code>boolean begin(Consumer consumer, Endpoint endpoint)</code></li></ul></li><li><strong><code>commit</code></strong><br clear="none">
  <ul class="alternate"><li><code>void commit(Consumer consumer, Endpoint endpoint)</code></li></ul></li><li><strong><code>commit</code></strong>&#160;(<strong>Camel 2.6</strong>)
  <ul class="alternate"><li><code>void commit(Consumer consumer, Endpoint endpoint, int polledMessages)</code></li></ul></li><li><strong><code>rollback</code></strong><br clear="none">
  <ul class="alternate"><li><code>boolean rollback(Consumer consumer, Endpoint endpoint, int retryCounter, Exception e) throws Exception</code></li></ul></li></ul><p>In <strong>Camel 2.3</strong>: the begin method returns a&#160;<strong><code>boolean</code></strong> which indicates whether or not to skipping polling. So you can implement your custom logic and return <strong><code>false</code></strong> if you do not want to poll this time.</p><p>In <strong>Camel 2.6</strong>: the commit method has an additional parameter containing the number of message that was actually polled. For example if there was no messages polled, the value would be zero, and you can react accordingly.</p><p>The most interesting is the <strong><code>rollback</code></strong> as it allows you do handle the caused exception and decide what to do.</p><p>For instance if we want to provide a retry feature to a scheduled consumer we can implement the <strong><code>PollingConsumerPollStrategy</code></strong> method and put the retry logic in the <strong><code>rollback</code></strong> method. Lets just retry up till three times:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public boolean rollback(Consumer consumer, Endpoint endpoint, int retryCounter, Exception e) throws Exception { if (retryCounter &amp;lt; 3) { // return true to tell Camel that it should retry the poll immediately return true; } // okay we give up do not retry anymore return false; }</script> 
 </div>
</div><p>Notice that we are given the <strong><code>Consumer</code></strong> as a parameter. We could use this to <em>restart</em> the consumer as we can invoke stop and start:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// error occurred lets restart the consumer, that could maybe resolve the issue consumer.stop(); consumer.start(); </script> 
 </div>
</div><p><strong>Note:</strong> if you implement the <strong><code>begin</code></strong> operation make sure to avoid throwing exceptions as in such a case the <strong><code>poll</code></strong> operation is not invoked and Camel will invoke the <strong><code>rollback</code></strong> directly.</p><h4 id="BookInOnePage-ConfiguringantoUsePollingConsumerPollStrategy">Configuring an <a shape="rect" href="endpoint.html">Endpoint</a> to Use <code>PollingConsumerPollStrategy</code></h4><p>To configure an <a shape="rect" href="endpoint.html">Endpoint</a> to use a custom <strong><code>PollingConsumerPollStrategy</code></strong> you use the option <strong><code>pollStrategy</code></strong>. For example in the file consumer below we want to use our custom strategy defined in the <a shape="rect" href="registry.html">Registry</a> with the bean id <strong><code>myPoll</code></strong>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://inbox/?pollStrategy=#myPoll&amp;quot;) .to(&amp;quot;activemq:queue:inbox&amp;quot;) </script> 
 </div>
</div><p></p><h4 id="BookInOnePage-UsingThisPattern.37">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-SeeAlso.14">See Also</h3><ul class="alternate"><li><a shape="rect" href="pojo-consuming.html">POJO Consuming</a></li><li><a shape="rect" href="batch-consumer.html">Batch Consumer</a></li></ul><h3 id="BookInOnePage-CompetingConsumers">Competing Consumers</h3><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/CompetingConsumers.html" rel="nofollow">Competing Consumers</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> using a few different components.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/CompetingConsumers.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/CompetingConsumers.gif"></span></p><p>You can use the following components to implement competing consumers:-</p><ul><li><a shape="rect" href="seda.html">Seda</a> for SEDA based concurrent processing using a thread pool</li><li><a shape="rect" href="jms.html">JMS</a> for distributed SEDA based concurrent processing with queues which support reliable load balancing, failover and clustering.</li></ul><h3 id="BookInOnePage-EnablingCompetingConsumerswithJMS">Enabling Competing Consumers with JMS</h3><p>To enable Competing Consumers you just need to set the <strong>concurrentConsumers</strong> property on the <a shape="rect" href="jms.html">JMS</a> endpoint.</p><p>For example</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;jms:MyQueue?concurrentConsumers=5&amp;quot;).bean(SomeBean.class); </script> 
 </div>
</div><p>or in Spring DSL</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;jms:MyQueue?concurrentConsumers=5&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:someBean&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>Or just run multiple JVMs of any <a shape="rect" href="activemq.html">ActiveMQ</a> or <a shape="rect" href="jms.html">JMS</a> route <img class="emoticon emoticon-smile" src="https://cwiki.apache.org/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/icons/emoticons/smile.png" data-emoticon-name="smile" alt="(smile)"></p><h4 id="BookInOnePage-UsingThisPattern.38">Using This Pattern</h4><p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-MessageDispatcher">Message Dispatcher</h3><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/MessageDispatcher.html" rel="nofollow">Message Dispatcher</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> using various approaches.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/MessageDispatcher.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/MessageDispatcher.gif"></span></p><p>You can use a component like <a shape="rect" href="jms.html">JMS</a> with selectors to implement a <a shape="rect" href="selective-consumer.html">Selective Consumer</a> as the Message Dispatcher implementation. Or you can use an <a shape="rect" href="endpoint.html">Endpoint</a> as the Message Dispatcher itself and then use a <a shape="rect" href="content-based-router.html">Content Based Router</a> as the Message Dispatcher.</p><p>&#160;</p><h4 id="BookInOnePage-Example.16">Example</h4><p>The following example demonstrates <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/MessageDispatcher.html" rel="nofollow">Message Dispatcher</a>&#160;pattern&#160;using the&#160;<a shape="rect" href="competing-consumers.html">Competing Consumers</a> functionality&#160;of the&#160;<a shape="rect" href="jms.html">JMS</a>&#160;component to offload messages to a&#160;<a shape="rect" href="content-based-router.html">Content Based Router</a>&#160;and custom&#160;<a shape="rect" href="processor.html">Processors</a>&#160;registered in the Camel&#160;<a shape="rect" href="registry.html">Registry</a>&#160;running in separate threads from originating consumer.</p><p>&#160;</p><p><strong>Using the&#160;<a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;jms:queue:foo?concurrentConsumers=5&amp;quot;) .threads(5) .choice() .when(header(&amp;quot;type&amp;quot;).isEqualTo(&amp;quot;A&amp;quot;)) .processRef(&amp;quot;messageDispatchProcessorA&amp;quot;) .when(header(&amp;quot;type&amp;quot;).isEqualTo(&amp;quot;B&amp;quot;)) .processRef(&amp;quot;messageDispatchProcessorB&amp;quot;) .when(header(&amp;quot;type&amp;quot;).isEqualTo(&amp;quot;C&amp;quot;)) .processRef(&amp;quot;messageDispatchProcessorC&amp;quot;) .otherwise() .to(&amp;quot;jms:queue:invalidMessageType&amp;quot;);</script> 
 </div>
</div><p>&#160;</p><p><strong><strong>Using the&#160;<a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;jms:queue:foo?concurrentConsumers=5&amp;quot;/&amp;gt; &amp;lt;threads poolSize=&amp;quot;5&amp;quot;&amp;gt; &amp;lt;choice&amp;gt; &amp;lt;when&amp;gt; &amp;lt;simple&amp;gt;${in.header.type} == &amp;#39;A&amp;#39;&amp;lt;/simple&amp;gt; &amp;lt;to ref=&amp;quot;messageDispatchProcessorA&amp;quot;/&amp;gt; &amp;lt;/when&amp;gt; &amp;lt;when&amp;gt; &amp;lt;simple&amp;gt;${in.header.type} == &amp;#39;B&amp;#39;&amp;lt;/simple&amp;gt; &amp;lt;to ref=&amp;quot;messageDispatchProcessorB&amp;quot;/&amp;gt; &amp;lt;/when&amp;gt; &amp;lt;when&amp;gt; &amp;lt;simple&amp;gt;${in.header.type} == &amp;#39;C&amp;#39;&amp;lt;/simple&amp;gt; &amp;lt;to ref=&amp;quot;messageDispatchProcessorC&amp;quot;/&amp;gt; &amp;lt;/when&amp;gt; &amp;lt;otherwise&amp;gt; &amp;lt;to uri=&amp;quot;jms:queue:invalidMessageType&amp;quot;/&amp;gt; &amp;lt;/choice&amp;gt; &amp;lt;/threads&amp;gt; &amp;lt;/route&amp;gt;</script> 
 </div>
</div><h4 id="BookInOnePage-SeeAlso.15">See Also</h4><ul><li><a shape="rect" href="jms.html">JMS</a></li><li><a shape="rect" href="selective-consumer.html">Selective Consumer</a></li><li><a shape="rect" href="content-based-router.html">Content Based Router</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li></ul><p>&#160;</p><p></p><h4 id="BookInOnePage-UsingThisPattern.39">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-SelectiveConsumer">Selective Consumer</h3><p>The <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/MessageSelector.html" rel="nofollow">Selective Consumer</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> can be implemented in two ways</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/MessageSelectorSolution.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/MessageSelectorSolution.gif"></span></p><p>The first solution is to provide a Message Selector to the underlying <a shape="rect" href="uris.html">URIs</a> when creating your consumer. For example when using <a shape="rect" href="jms.html">JMS</a> you can specify a selector parameter so that the message broker will only deliver messages matching your criteria.</p><p>The other approach is to use a <a shape="rect" href="message-filter.html">Message Filter</a> which is applied; then if the filter matches the message your consumer is invoked as shown in the following example</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> RouteBuilder builder = new RouteBuilder() { public void configure() { errorHandler(deadLetterChannel(&amp;quot;mock:error&amp;quot;)); from(&amp;quot;direct:a&amp;quot;) .filter(header(&amp;quot;foo&amp;quot;).isEqualTo(&amp;quot;bar&amp;quot;)) .process(myProcessor); } }; </script> 
 </div>
</div><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;myProcessor&amp;quot; class=&amp;quot;org.apache.camel.builder.MyProcessor&amp;quot;/&amp;gt; &amp;lt;camelContext errorHandlerRef=&amp;quot;errorHandler&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:a&amp;quot;/&amp;gt; &amp;lt;filter&amp;gt; &amp;lt;xpath&amp;gt;$foo = &amp;#39;bar&amp;#39;&amp;lt;/xpath&amp;gt; &amp;lt;process ref=&amp;quot;myProcessor&amp;quot;/&amp;gt; &amp;lt;/filter&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-UsingThisPattern.40">Using This Pattern</h4><p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-DurableSubscriber">Durable Subscriber</h3><p>Camel supports the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/DurableSubscription.html" rel="nofollow">Durable Subscriber</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> using the <a shape="rect" href="jms.html">JMS</a> component which supports publish &amp; subscribe using Topics with support for non-durable and durable subscribers.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/DurableSubscriptionSolution.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/DurableSubscriptionSolution.gif"></span></p><p>Another alternative is to combine the <a shape="rect" href="message-dispatcher.html">Message Dispatcher</a> or <a shape="rect" href="content-based-router.html">Content Based Router</a> with <a shape="rect" href="file2.html">File</a> or <a shape="rect" href="jpa.html">JPA</a> components for durable subscribers then something like <a shape="rect" href="seda.html">Seda</a> for non-durable.</p><p>Here is a simple example of creating durable subscribers to a <a shape="rect" href="jms.html">JMS</a> topic</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;).to(&amp;quot;activemq:topic:foo&amp;quot;); from(&amp;quot;activemq:topic:foo?clientId=1&amp;amp;durableSubscriptionName=bar1&amp;quot;).to(&amp;quot;mock:result1&amp;quot;); from(&amp;quot;activemq:topic:foo?clientId=2&amp;amp;durableSubscriptionName=bar2&amp;quot;).to(&amp;quot;mock:result2&amp;quot;); </script> 
 </div>
</div><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;activemq:topic:foo&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:topic:foo?clientId=1&amp;amp;durableSubscriptionName=bar1&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result1&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:topic:foo?clientId=2&amp;amp;durableSubscriptionName=bar2&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result2&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>Here is another example of <a shape="rect" href="jms.html">JMS</a> durable subscribers, but this time using <a shape="rect" class="external-link" href="http://activemq.apache.org/virtual-destinations.html">virtual topics</a> (recommended by AMQ over durable subscriptions)</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;).to(&amp;quot;activemq:topic:VirtualTopic.foo&amp;quot;); from(&amp;quot;activemq:queue:Consumer.1.VirtualTopic.foo&amp;quot;).to(&amp;quot;mock:result1&amp;quot;); from(&amp;quot;activemq:queue:Consumer.2.VirtualTopic.foo&amp;quot;).to(&amp;quot;mock:result2&amp;quot;); </script> 
 </div>
</div><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;activemq:topic:VirtualTopic.foo&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:queue:Consumer.1.VirtualTopic.foo&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result1&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:queue:Consumer.2.VirtualTopic.foo&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result2&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-SeeAlso.16">See Also</h4><ul><li><a shape="rect" href="jms.html">JMS</a></li><li><a shape="rect" href="file2.html">File</a></li><li><a shape="rect" href="jpa.html">JPA</a></li><li><a shape="rect" href="message-dispatcher.html">Message Dispatcher</a></li><li><a shape="rect" href="selective-consumer.html">Selective Consumer</a></li><li><a shape="rect" href="content-based-router.html">Content Based Router</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li></ul><h4 id="BookInOnePage-UsingThisPattern.41">Using This Pattern</h4><p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-IdempotentConsumer">Idempotent Consumer</h3><p>The <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/IdempotentReceiver.html" rel="nofollow">Idempotent Consumer</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> is used to filter out duplicate messages.</p><p>This pattern is implemented using the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/idempotent/IdempotentConsumer.html">IdempotentConsumer</a> class. This uses an <a shape="rect" href="expression.html">Expression</a> to calculate a unique message ID string for a given message exchange; this ID can then be looked up in the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/spi/IdempotentRepository.html">IdempotentRepository</a> to see if it has been seen before; if it has the message is consumed; if its not then the message is processed and the ID is added to the repository.</p><p>The Idempotent Consumer essentially acts like a <a shape="rect" href="message-filter.html">Message Filter</a> to filter out duplicates.</p><p>Camel will add the message id eagerly to the repository to detect duplication also for Exchanges currently in progress.<br clear="none"> On completion Camel will remove the message id from the repository if the Exchange failed, otherwise it stays there.</p><p>Camel provides the following Idempotent Consumer implementations:</p><ul class="alternate"><li>MemoryIdempotentRepository</li><li><a shape="rect" href="file2.html">FileIdempotentRepository</a></li><li><a shape="rect" href="hazelcast-component.html">HazelcastIdempotentRepository</a> (<strong>Available as of Camel 2.8</strong>)</li><li><a shape="rect" href="sql-component.html">JdbcMessageIdRepository</a> (<strong>Available as of Camel 2.7</strong>)</li><li><a shape="rect" href="jpa.html">JpaMessageIdRepository</a></li><li><p><a shape="rect" href="infinispan.html">InfinispanIdempotentRepository</a> (<strong>Available as of Camel 2.13.0)</strong></p></li><li><p><a shape="rect" href="jcache.html">JCacheIdempotentRepository</a><strong>&#160;(<strong>Available as of Camel 2.17.0)</strong></strong></p></li><li><p><a shape="rect" href="spring.html">SpringCacheIdempotentRepository</a>&#160;<strong>(<strong>Available as of Camel 2.17.1)</strong></strong><strong><strong><br clear="none"></strong></strong></p></li><li><p><strong><strong><a shape="rect" href="ehcache.html">EhcacheIdempotentRepository</a>&#160;<strong>(<strong>Available as of Camel 2.18.0)</strong></strong><br clear="none"></strong></strong></p></li></ul><h3 id="BookInOnePage-Options.19">Options</h3><p>The Idempotent Consumer has the following options:</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>eager</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>true</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Eager controls whether Camel adds the message to the repository before or after the exchange has been processed. If enabled before then Camel will be able to detect duplicate messages even when messages are currently in progress. By disabling Camel will only detect duplicates when a message has successfully been processed.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>messageIdRepositoryRef</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A reference to a <code>IdempotentRepository</code> to lookup in the registry. This option is mandatory when using XML DSL.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>skipDuplicate</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>true</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> Sets whether to skip duplicate messages. If set to <code>false</code> then the message will be continued. However the <a shape="rect" href="exchange.html">Exchange</a> has been marked as a duplicate by having the <code>Exchange.DUPLICATE_MESSAG</code> exchange property set to a <code>Boolean.TRUE</code> value.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>removeOnFailure</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>true</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> Sets whether to remove the id of an Exchange that failed.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">completionEager</td><td colspan="1" rowspan="1" class="confluenceTd">false</td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16:</strong> Sets whether to complete the idempotent consumer eager or when the exchange is done.</p><p>If this option is true to complete eager, then the idempotent consumer will trigger its completion when the exchange reached the end of the block of the idempotent consumer pattern. So if the exchange is continued routed after the block ends, then whatever happens there does not affect the state.</p><p>If this option is false (default) to not complete eager, then the idempotent consumer will complete when the exchange is done being routed. So if the exchange is continued routed after the block ends, then whatever happens there also affect the state. For example if the exchange failed due to an exception, then the state of the idempotent consumer will be a rollback.</p></td></tr></tbody></table>
</div><h3 id="BookInOnePage-Usingthe"><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></h3><p>The following example will use the header <strong>myMessageId</strong> to filter out duplicates
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> RouteBuilder builder = new RouteBuilder() { public void configure() { errorHandler(deadLetterChannel(&amp;quot;mock:error&amp;quot;)); from(&amp;quot;direct:a&amp;quot;) .idempotentConsumer(header(&amp;quot;myMessageId&amp;quot;), MemoryIdempotentRepository.memoryIdempotentRepository(200)) .to(&amp;quot;direct:b&amp;quot;); } }; </script> 
  </div>
 </div>The above <a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/camel/trunk/camel-core/src/test/java/org/apache/camel/builder/RouteBuilderTest.java">example</a> will use an in-memory based <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/processor/idempotent/MessageIdRepository.html">MessageIdRepository</a> which can easily run out of memory and doesn't work in a clustered environment. So you might prefer to use the JPA based implementation which uses a database to store the message IDs which have been processed
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;).idempotentConsumer( header(&amp;quot;messageId&amp;quot;), jpaMessageIdRepository(lookup(EntityManagerFactory.class), PROCESSOR_NAME) ).to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>In the above <a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/camel/trunk/components/camel-jpa/src/test/java/org/apache/camel/processor/jpa/JpaIdempotentConsumerTest.java">example</a> we are using the header <strong>messageId</strong> to filter out duplicates and using the collection <strong>myProcessorName</strong> to indicate the Message ID Repository to use. This name is important as you could process the same message by many different processors; so each may require its own logical Message ID Repository.<p>For further examples of this pattern in use you could look at the <a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/IdempotentConsumerTest.java?view=markup">junit test case</a></p><h3 id="BookInOnePage-SpringXMLexample">Spring XML example</h3><p>The following example will use the header <strong>myMessageId</strong> to filter out duplicates
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- repository for the idempotent consumer --&amp;gt; &amp;lt;bean id=&amp;quot;myRepo&amp;quot; class=&amp;quot;org.apache.camel.processor.idempotent.MemoryIdempotentRepository&amp;quot;/&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;idempotentConsumer messageIdRepositoryRef=&amp;quot;myRepo&amp;quot;&amp;gt; &amp;lt;!-- use the messageId header as key for identifying duplicate messages --&amp;gt; &amp;lt;header&amp;gt;messageId&amp;lt;/header&amp;gt; &amp;lt;!-- if not a duplicate send it to this mock endpoint --&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/idempotentConsumer&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
  </div>
 </div><h3 id="BookInOnePage-Howtohandleduplicatemessagesintheroute">How to handle duplicate messages in the route</h3><p><strong>Available as of Camel 2.8</strong></p><p>You can now set the <code>skipDuplicate</code> option to <code>false</code> which instructs the idempotent consumer to route duplicate messages as well. However the duplicate message has been marked as duplicate by having a property on the <a shape="rect" href="exchange.html">Exchange</a> set to true. We can leverage this fact by using a <a shape="rect" href="content-based-router.html">Content Based Router</a> or <a shape="rect" href="message-filter.html">Message Filter</a> to detect this and handle duplicate messages.</p><p>For example in the following example we use the <a shape="rect" href="message-filter.html">Message Filter</a> to send the message to a duplicate endpoint, and then stop continue routing that message.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
   <b>Filter duplicate messages</b>
  </div>
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) // instruct idempotent consumer to not skip duplicates as we will filter then our self .idempotentConsumer(header(&amp;quot;messageId&amp;quot;)).messageIdRepository(repo).skipDuplicate(false) .filter(property(Exchange.DUPLICATE_MESSAGE).isEqualTo(true)) // filter out duplicate messages by sending them to someplace else and then stop .to(&amp;quot;mock:duplicate&amp;quot;) .stop() .end() // and here we process only new messages (no duplicates) .to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>The sample example in XML DSL would be:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
   <b>Filter duplicate messages</b>
  </div>
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- idempotent repository, just use a memory based for testing --&amp;gt; &amp;lt;bean id=&amp;quot;myRepo&amp;quot; class=&amp;quot;org.apache.camel.processor.idempotent.MemoryIdempotentRepository&amp;quot;/&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;!-- we do not want to skip any duplicate messages --&amp;gt; &amp;lt;idempotentConsumer messageIdRepositoryRef=&amp;quot;myRepo&amp;quot; skipDuplicate=&amp;quot;false&amp;quot;&amp;gt; &amp;lt;!-- use the messageId header as key for identifying duplicate messages --&amp;gt; &amp;lt;header&amp;gt;messageId&amp;lt;/header&amp;gt; &amp;lt;!-- we will to handle duplicate messages using a filter --&amp;gt; &amp;lt;filter&amp;gt; &amp;lt;!-- the filter will only react on duplicate messages, if this property is set on the Exchange --&amp;gt; &amp;lt;exchangeProperty&amp;gt;CamelDuplicateMessage&amp;lt;/exchangeProperty&amp;gt; &amp;lt;!-- and send the message to this mock, due its part of an unit test --&amp;gt; &amp;lt;!-- but you can of course do anything as its part of the route --&amp;gt; &amp;lt;to uri=&amp;quot;mock:duplicate&amp;quot;/&amp;gt; &amp;lt;!-- and then stop --&amp;gt; &amp;lt;stop/&amp;gt; &amp;lt;/filter&amp;gt; &amp;lt;!-- here we route only new messages --&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/idempotentConsumer&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
  </div>
 </div><h3 id="BookInOnePage-Howtohandleduplicatemessageinaclusteredenvironmentwithadatagrid">How to handle duplicate message in a clustered environment with a data grid</h3><p><strong>Available as of Camel 2.8</strong></p><p>If you have running Camel in a clustered environment, a in memory idempotent repository doesn't work (see above). You can setup either a central database or use the idempotent consumer implementation based on the <a shape="rect" class="external-link" href="http://www.hazelcast.com/" rel="nofollow">Hazelcast</a> data grid. Hazelcast finds the nodes over multicast (which is default - configure Hazelcast for tcp-ip) and creates automatically a map based repository:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> HazelcastIdempotentRepository idempotentRepo = new HazelcastIdempotentRepository(&amp;quot;myrepo&amp;quot;); from(&amp;quot;direct:in&amp;quot;).idempotentConsumer(header(&amp;quot;messageId&amp;quot;), idempotentRepo).to(&amp;quot;mock:out&amp;quot;); </script> 
 </div>
</div><p>You have to define how long the repository should hold each message id (default is to delete it never). To avoid that you run out of memory you should create an eviction strategy based on the <a shape="rect" class="external-link" href="http://www.hazelcast.com/documentation.jsp#MapEviction" rel="nofollow">Hazelcast configuration</a>. For additional information see <a shape="rect" href="hazelcast-component.html">camel-hazelcast</a>.</p><p>See this <a shape="rect" href="hazelcast-idempotent-repository-tutorial.html">little tutorial</a>, how setup such an idempotent repository on two cluster nodes using Apache Karaf.</p><p><strong>Available as of Camel <strong> 2.13.0</strong></strong></p><p>Another option for using Idempotent Consumer in a clustered environment is Infinispan. Infinispan is a data grid with replication and distribution clustering support. For additional information see<strong> <a shape="rect" href="infinispan.html">camel-infinispan</a>.<br clear="none"></strong></p><p></p><h4 id="BookInOnePage-UsingThisPattern.42">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-TransactionalClient">Transactional Client</h3><p>Camel recommends supporting the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/TransactionalClient.html" rel="nofollow">Transactional Client</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> using spring transactions.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/TransactionalClientSolution.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/TransactionalClientSolution.gif"></span></p><p>Transaction Oriented Endpoints like <a shape="rect" href="jms.html">JMS</a> support using a transaction for both inbound and outbound message exchanges. Endpoints that support transactions will participate in the current transaction context that they are called from.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Configuration of Redelivery</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The redelivery in transacted mode is <strong>not</strong> handled by Camel but by the backing system (the transaction manager). In such cases you should resort to the backing system how to configure the redelivery.</p>
 </div>
</div><p>You should use the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-spring/apidocs/org/apache/camel/spring/SpringRouteBuilder.html">SpringRouteBuilder</a> to setup the routes since you will need to setup the spring context with the TransactionTemplates that will define the transaction manager configuration and policies.</p><p>For inbound endpoint to be transacted, they normally need to be configured to use a Spring PlatformTransactionManager. In the case of the JMS component, this can be done by looking it up in the spring context.</p><p>You first define needed object in the spring configuration.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;jmsTransactionManager&amp;quot; class=&amp;quot;org.springframework.jms.connection.JmsTransactionManager&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;jmsConnectionFactory&amp;quot; /&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;jmsConnectionFactory&amp;quot; class=&amp;quot;org.apache.activemq.ActiveMQConnectionFactory&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;brokerURL&amp;quot; value=&amp;quot;tcp://localhost:61616&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>Then you look them up and use them to create the JmsComponent.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> PlatformTransactionManager transactionManager = (PlatformTransactionManager) spring.getBean(&amp;quot;jmsTransactionManager&amp;quot;); ConnectionFactory connectionFactory = (ConnectionFactory) spring.getBean(&amp;quot;jmsConnectionFactory&amp;quot;); JmsComponent component = JmsComponent.jmsComponentTransacted(connectionFactory, transactionManager); component.getConfiguration().setConcurrentConsumers(1); ctx.addComponent(&amp;quot;activemq&amp;quot;, component); </script> 
 </div>
</div><h4 id="BookInOnePage-TransactionPolicies">Transaction Policies</h4><p>Outbound endpoints will automatically enlist in the current transaction context. But what if you do not want your outbound endpoint to enlist in the same transaction as your inbound endpoint? The solution is to add a Transaction Policy to the processing route. You first have to define transaction policies that you will be using. The policies use a spring TransactionTemplate under the covers for declaring the transaction demarcation to use. So you will need to add something like the following to your spring xml:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;PROPAGATION_REQUIRED&amp;quot; class=&amp;quot;org.apache.camel.spring.spi.SpringTransactionPolicy&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;transactionManager&amp;quot; ref=&amp;quot;jmsTransactionManager&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;PROPAGATION_REQUIRES_NEW&amp;quot; class=&amp;quot;org.apache.camel.spring.spi.SpringTransactionPolicy&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;transactionManager&amp;quot; ref=&amp;quot;jmsTransactionManager&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;propagationBehaviorName&amp;quot; value=&amp;quot;PROPAGATION_REQUIRES_NEW&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>Then in your <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-spring/apidocs/org/apache/camel/spring/SpringRouteBuilder.html">SpringRouteBuilder</a>, you just need to create new SpringTransactionPolicy objects for each of the templates.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public void configure() { ... Policy requried = bean(SpringTransactionPolicy.class, &amp;quot;PROPAGATION_REQUIRED&amp;quot;)); Policy requirenew = bean(SpringTransactionPolicy.class, &amp;quot;PROPAGATION_REQUIRES_NEW&amp;quot;)); ... } </script> 
 </div>
</div><p>Once created, you can use the Policy objects in your processing routes:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // Send to bar in a new transaction from(&amp;quot;activemq:queue:foo&amp;quot;).policy(requirenew).to(&amp;quot;activemq:queue:bar&amp;quot;); // Send to bar without a transaction. from(&amp;quot;activemq:queue:foo&amp;quot;).policy(notsupported ).to(&amp;quot;activemq:queue:bar&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-OSGiBlueprint">OSGi Blueprint</h4><p>If you are using <a shape="rect" href="using-osgi-blueprint-with-camel.html">OSGi Blueprint</a> then you most likely have to explicit declare a policy and refer to the policy from the transacted in the route.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;required&amp;quot; class=&amp;quot;org.apache.camel.spring.spi.SpringTransactionPolicy&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;transactionManager&amp;quot; ref=&amp;quot;jmsTransactionManager&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;propagationBehaviorName&amp;quot; value=&amp;quot;PROPAGATION_REQUIRED&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>And then refer to "required" from the route:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:queue:foo&amp;quot;/&amp;gt; &amp;lt;transacted ref=&amp;quot;required&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;activemq:queue:bar&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-DatabaseSample">Database Sample</h3><p>In this sample we want to ensure that two endpoints is under transaction control. These two endpoints inserts data into a database.<br clear="none"> The sample is in its full as a <a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/components/camel-spring/src/test/java/org/apache/camel/spring/interceptor/TransactionalClientDataSourceMinimalConfigurationTest.java?view=log">unit test</a>.</p><p>First of all we setup the usual spring stuff in its configuration file. Here we have defined a DataSource to the HSQLDB and a most importantly&#160;the Spring DataSource TransactionManager that is doing the heavy lifting of ensuring our transactional policies. You are of course free to use any&#160;of the Spring based TransactionManager, eg. if you are in a full blown J2EE container you could use JTA or the WebLogic or WebSphere specific managers.</p><p>As we use the new convention over configuration we do <strong>not</strong> need to configure a transaction policy bean, so we do not have any <code>PROPAGATION_REQUIRED</code> beans.&#160;All the beans needed to be configured is <strong>standard</strong> Spring beans only, eg. there are no Camel specific configuration at all.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- this example uses JDBC so we define a data source --&amp;gt; &amp;lt;jdbc:embedded-database id=&amp;quot;dataSource&amp;quot; type=&amp;quot;DERBY&amp;quot;&amp;gt; &amp;lt;jdbc:script location=&amp;quot;classpath:sql/init.sql&amp;quot; /&amp;gt; &amp;lt;/jdbc:embedded-database&amp;gt; &amp;lt;!-- spring transaction manager --&amp;gt; &amp;lt;!-- this is the transaction manager Camel will use for transacted routes --&amp;gt; &amp;lt;bean id=&amp;quot;txManager&amp;quot; class=&amp;quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;dataSource&amp;quot; ref=&amp;quot;dataSource&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;!-- bean for book business logic --&amp;gt; &amp;lt;bean id=&amp;quot;bookService&amp;quot; class=&amp;quot;org.apache.camel.spring.interceptor.BookService&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;dataSource&amp;quot; ref=&amp;quot;dataSource&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
  </div>
 </div>Then we are ready to define our Camel routes. We have two routes: 1 for success conditions, and 1 for a forced rollback condition.<br clear="none"> This is after all based on a unit test. Notice that we mark each route as transacted using the <strong>transacted</strong> tag.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:okay&amp;quot;/&amp;gt; &amp;lt;!-- we mark this route as transacted. Camel will lookup the spring transaction manager and use it by default. We can optimally pass in arguments to specify a policy to use that is configured with a spring transaction manager of choice. However Camel supports convention over configuration as we can just use the defaults out of the box and Camel that suites in most situations --&amp;gt; &amp;lt;transacted/&amp;gt; &amp;lt;setBody&amp;gt; &amp;lt;constant&amp;gt;Tiger in Action&amp;lt;/constant&amp;gt; &amp;lt;/setBody&amp;gt; &amp;lt;bean ref=&amp;quot;bookService&amp;quot;/&amp;gt; &amp;lt;setBody&amp;gt; &amp;lt;constant&amp;gt;Elephant in Action&amp;lt;/constant&amp;gt; &amp;lt;/setBody&amp;gt; &amp;lt;bean ref=&amp;quot;bookService&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:fail&amp;quot;/&amp;gt; &amp;lt;!-- we mark this route as transacted. See comments above. --&amp;gt; &amp;lt;transacted/&amp;gt; &amp;lt;setBody&amp;gt; &amp;lt;constant&amp;gt;Tiger in Action&amp;lt;/constant&amp;gt; &amp;lt;/setBody&amp;gt; &amp;lt;bean ref=&amp;quot;bookService&amp;quot;/&amp;gt; &amp;lt;setBody&amp;gt; &amp;lt;constant&amp;gt;Donkey in Action&amp;lt;/constant&amp;gt; &amp;lt;/setBody&amp;gt; &amp;lt;bean ref=&amp;quot;bookService&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
  </div>
 </div>That is all that is needed to configure a Camel route as being transacted. Just remember to use the <strong>transacted</strong> DSL. The rest is standard Spring XML to setup the transaction manager.<h3 id="BookInOnePage-JMSSample">JMS Sample</h3><p>In this sample we want to listen for messages on a queue and process the messages with our business logic java code and send them along. Since its based on a <a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/components/camel-jms/src/test/java/org/apache/camel/component/jms/tx/TransactionMinimalConfigurationTest.java?view=log">unit test</a> the destination is a mock endpoint.</p><p>First we configure the standard Spring XML to declare a JMS connection factory, a JMS transaction manager and our ActiveMQ component that we use in our routing.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- setup JMS connection factory --&amp;gt; &amp;lt;bean id=&amp;quot;poolConnectionFactory&amp;quot; class=&amp;quot;org.apache.activemq.pool.PooledConnectionFactory&amp;quot; init-method=&amp;quot;start&amp;quot; destroy-method=&amp;quot;stop&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;maxConnections&amp;quot; value=&amp;quot;8&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;jmsConnectionFactory&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;jmsConnectionFactory&amp;quot; class=&amp;quot;org.apache.activemq.ActiveMQConnectionFactory&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;brokerURL&amp;quot; value=&amp;quot;vm://localhost?broker.persistent=false&amp;amp;amp;broker.useJmx=false&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;!-- setup spring jms TX manager --&amp;gt; &amp;lt;bean id=&amp;quot;jmsTransactionManager&amp;quot; class=&amp;quot;org.springframework.jms.connection.JmsTransactionManager&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;poolConnectionFactory&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;!-- define our activemq component --&amp;gt; &amp;lt;bean id=&amp;quot;activemq&amp;quot; class=&amp;quot;org.apache.activemq.camel.component.ActiveMQComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;poolConnectionFactory&amp;quot;/&amp;gt; &amp;lt;!-- define the jms consumer/producer as transacted --&amp;gt; &amp;lt;property name=&amp;quot;transacted&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;!-- setup the transaction manager to use --&amp;gt; &amp;lt;!-- if not provided then Camel will automatic use a JmsTransactionManager, however if you for instance use a JTA transaction manager then you must configure it --&amp;gt; &amp;lt;property name=&amp;quot;transactionManager&amp;quot; ref=&amp;quot;jmsTransactionManager&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
  </div>
 </div>And then we configure our routes. Notice that all we have to do is mark the route as transacted using the <strong>transacted</strong> tag.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;!-- disable JMX during testing --&amp;gt; &amp;lt;jmxAgent id=&amp;quot;agent&amp;quot; disabled=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;route&amp;gt; &amp;lt;!-- 1: from the jms queue --&amp;gt; &amp;lt;from uri=&amp;quot;activemq:queue:okay&amp;quot;/&amp;gt; &amp;lt;!-- 2: mark this route as transacted --&amp;gt; &amp;lt;transacted/&amp;gt; &amp;lt;!-- 3: call our business logic that is myProcessor --&amp;gt; &amp;lt;process ref=&amp;quot;myProcessor&amp;quot;/&amp;gt; &amp;lt;!-- 4: if success then send it to the mock --&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;bean id=&amp;quot;myProcessor&amp;quot; class=&amp;quot;org.apache.camel.component.jms.tx.JMSTransactionalClientTest$MyProcessor&amp;quot;/&amp;gt; </script> 
  </div>
 </div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Transaction error handler</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>When a route is marked as transacted using <strong>transacted</strong> Camel will automatic use the <a shape="rect" href="transactionerrorhandler.html">TransactionErrorHandler</a> as <a shape="rect" href="error-handler.html">Error Handler</a>. It supports basically the same feature set as the <a shape="rect" href="defaulterrorhandler.html">DefaultErrorHandler</a>, so you can for instance use <a shape="rect" href="exception-clause.html">Exception Clause</a> as well.</p>
 </div>
</div><h3 id="BookInOnePage-IntegrationTestingwithSpring">Integration Testing with Spring</h3><div class="confluence-information-macro confluence-information-macro-note">
 <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>An Integration Test here means a test runner class annotated <code>@RunWith(SpringJUnit4ClassRunner.class).</code></p>
 </div>
</div><p><span style="line-height: 1.4285715;">When following the Spring Transactions documentation it is tempting to annotate your integration test with&#160;</span><code style="line-height: 1.4285715;">@Transactional</code><span style="line-height: 1.4285715;"> then seed your database before firing up the route to be tested and sending a message in. This is incorrect as Spring will have an in-progress transaction, and Camel will wait on this before proceeding, leading to the route timing out.</span></p><p>Instead, remove the <code>@Transactional</code> annotation from the test method and seed the test data within a&#160;<code>TransactionTemplate</code> execution which will ensure the data is committed to the database before Camel attempts to pick up and use the transaction manager. A simple example&#160;<a shape="rect" class="external-link" href="https://github.com/rajivj2/example2/blob/master/src/test/java/com/example/NotificationRouterIT.java" rel="nofollow">can be found on GitHub</a>.</p><p>Spring's transactional model ensures each transaction is bound to one thread. A Camel route may invoke additional threads which is where the blockage may occur. This is not a fault of Camel but as the programmer you must be aware of the consequences of beginning a transaction in a test thread and expecting a separate thread created by your Camel route to be participate, which it cannot. You can, in your test, mock the parts that cause separate threads to avoid this issue.</p><h2 id="BookInOnePage-Usingmultiplerouteswithdifferentpropagationbehaviors">Using multiple routes with different propagation behaviors</h2><p><strong>Available as of Camel 2.2</strong><br clear="none"> Suppose you want to route a message through two routes and by which the 2nd route should run in its own transaction. How do you do that? You use propagation behaviors for that where you configure it as follows:</p><ul class="alternate"><li>The first route use <code>PROPAGATION_REQUIRED</code></li><li>The second route use <code>PROPAGATION_REQUIRES_NEW</code></li></ul><p>This is configured in the Spring XML file:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;PROPAGATION_REQUIRED&amp;quot; class=&amp;quot;org.apache.camel.spring.spi.SpringTransactionPolicy&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;transactionManager&amp;quot; ref=&amp;quot;txManager&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;propagationBehaviorName&amp;quot; value=&amp;quot;PROPAGATION_REQUIRED&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;PROPAGATION_REQUIRES_NEW&amp;quot; class=&amp;quot;org.apache.camel.spring.spi.SpringTransactionPolicy&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;transactionManager&amp;quot; ref=&amp;quot;txManager&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;propagationBehaviorName&amp;quot; value=&amp;quot;PROPAGATION_REQUIRES_NEW&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
  </div>
 </div>Then in the routes you use transacted DSL to indicate which of these two propagations it uses.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:mixed&amp;quot;) // using required .transacted(&amp;quot;PROPAGATION_REQUIRED&amp;quot;) // all these steps will be okay .setBody(constant(&amp;quot;Tiger in Action&amp;quot;)).bean(&amp;quot;bookService&amp;quot;) .setBody(constant(&amp;quot;Elephant in Action&amp;quot;)).bean(&amp;quot;bookService&amp;quot;) // continue on route 2 .to(&amp;quot;direct:mixed2&amp;quot;); from(&amp;quot;direct:mixed2&amp;quot;) // tell Camel that if this route fails then only rollback this last route // by using (rollback only *last*) .onException(Exception.class).markRollbackOnlyLast().end() // using a different propagation which is requires new .transacted(&amp;quot;PROPAGATION_REQUIRES_NEW&amp;quot;) // this step will be okay .setBody(constant(&amp;quot;Lion in Action&amp;quot;)).bean(&amp;quot;bookService&amp;quot;) // this step will fail with donkey .setBody(constant(&amp;quot;Donkey in Action&amp;quot;)).bean(&amp;quot;bookService&amp;quot;); </script> 
  </div>
 </div>Notice how we have configured the <code>onException</code> in the 2nd route to indicate in case of any exceptions we should handle it and just rollback this transaction. This is done using the <code>markRollbackOnlyLast</code> which tells Camel to only do it for the current transaction and not globally.<h4 id="BookInOnePage-SeeAlso.17">See Also</h4><ul><li><a shape="rect" href="error-handling-in-camel.html">Error handling in Camel</a></li><li><a shape="rect" href="transactionerrorhandler.html">TransactionErrorHandler</a></li><li><a shape="rect" href="error-handler.html">Error Handler</a></li><li><a shape="rect" href="jms.html">JMS</a></li></ul><p></p><h4 id="BookInOnePage-UsingThisPattern.43">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-MessagingGateway">Messaging Gateway</h3><p>Camel has several endpoint components that support the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/MessagingGateway.html" rel="nofollow">Messaging Gateway</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a>.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/MessagingGatewaySolution.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/MessagingGatewaySolution.gif"></span></p><p>Components like <a shape="rect" href="bean.html">Bean</a> and <a shape="rect" href="cxf.html">CXF</a> provide a a way to bind a Java interface to the message exchange.</p><p>However you may want to read the <a shape="rect" href="using-camelproxy.html">Using CamelProxy</a> documentation as a true <a shape="rect" href="messaging-gateway.html">Messaging Gateway</a> EIP solution.<br clear="none"> Another approach is to use <code>@Produce</code> which you can read about in <a shape="rect" href="pojo-producing.html">POJO Producing</a> which also can be used as a <a shape="rect" href="messaging-gateway.html">Messaging Gateway</a> EIP solution.</p><p>&#160;</p><h4 id="BookInOnePage-Example.17">Example</h4><p>The following example how the&#160;<a shape="rect" href="cxf.html">CXF</a>&#160;and&#160;<a shape="rect" href="bean.html">Bean</a>&#160;components can be used to abstract the developer from the underlying messaging system API</p><p><strong><br clear="none"></strong></p><p><strong>Using the&#160;<a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;cxf:bean:soapMessageEndpoint&amp;quot;) .to(&amp;quot;bean:testBean?method=processSOAP&amp;quot;);</script> 
 </div>
</div><p>&#160;</p><p><strong><strong>Using the&#160;<a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;cxf:bean:soapMessageEndpoint&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:testBean?method=processSOAP&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt;</script> 
 </div>
</div><h4 id="BookInOnePage-SeeAlso.18">See Also</h4><ul><li><a shape="rect" href="bean.html">Bean</a></li><li><a shape="rect" href="cxf.html">CXF</a></li><li><a shape="rect" href="using-camelproxy.html">Using CamelProxy</a></li><li><a shape="rect" href="pojo-producing.html">POJO Producing</a></li><li><a shape="rect" href="spring-remoting.html">Spring Remoting</a></li></ul><p></p><h4 id="BookInOnePage-UsingThisPattern.44">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-ServiceActivator">Service Activator</h3><p>Camel has several endpoint components that support the <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/MessagingAdapter.html" rel="nofollow">Service Activator</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a>.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/MessagingAdapterSolution.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/MessagingAdapterSolution.gif"></span></p><p>Components like <a shape="rect" href="bean.html">Bean</a>, <a shape="rect" href="cxf.html">CXF</a> and <a shape="rect" href="pojo.html">Pojo</a> provide a a way to bind the message exchange to a Java interface/service where the route defines the endpoints and wires it up to the bean.</p><p>In addition you can use the <a shape="rect" href="bean-integration.html">Bean Integration</a> to wire messages to a bean using annotation. </p><p>Here is a simple example of using a <a shape="rect" href="direct.html">Direct</a> endpoint to create a messaging interface to a <a shape="rect" href="pojo.html">Pojo</a> <a shape="rect" href="bean.html">Bean</a> service.</p><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:invokeMyService&amp;quot;).to(&amp;quot;bean:myService&amp;quot;); </script> 
 </div>
</div><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:invokeMyService&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:myService&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-SeeAlso.19">See Also</h4><ul><li><a shape="rect" href="bean.html">Bean</a></li><li><a shape="rect" href="pojo.html">Pojo</a></li><li><a shape="rect" href="cxf.html">CXF</a></li></ul><h4 id="BookInOnePage-UsingThisPattern.45">Using This Pattern</h4><p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h2 id="BookInOnePage-SystemManagement.1">System Management</h2><h3 id="BookInOnePage-Detour">Detour</h3><p>The <a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/Detour.html" rel="nofollow">Detour</a> from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a> allows you to send messages through additional steps if a control condition is met. It can be useful for turning on extra validation, testing, debugging code when needed.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/Detour.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/Detour.gif"></span></p><h4 id="BookInOnePage-Example.18">Example</h4><p>In this example we essentially have a route like <code>from("direct:start").to("mock:result")</code> with a conditional detour to the <code>mock:detour</code> endpoint in the middle of the route..</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;).choice() .when().method(&amp;quot;controlBean&amp;quot;, &amp;quot;isDetour&amp;quot;).to(&amp;quot;mock:detour&amp;quot;).end() .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;choice&amp;gt; &amp;lt;when&amp;gt; &amp;lt;method bean=&amp;quot;controlBean&amp;quot; method=&amp;quot;isDetour&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:detour&amp;quot;/&amp;gt; &amp;lt;/when&amp;gt; &amp;lt;/choice&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>whether the detour is turned on or off is decided by the <code>ControlBean</code>. So, when the detour is on the message is routed to <code>mock:detour</code> and then <code>mock:result</code>. When the detour is off, the message is routed to <code>mock:result</code>.</p><p>For full details, check the example source here:</p><p><a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/DetourTest.java">camel-core/src/test/java/org/apache/camel/processor/DetourTest.java</a></p><h4 id="BookInOnePage-UsingThisPattern.46">Using This Pattern</h4><p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h3 id="BookInOnePage-WireTap">Wire Tap</h3><p><a shape="rect" class="external-link" href="http://www.enterpriseintegrationpatterns.com/WireTap.html" rel="nofollow">Wire Tap</a> (from the <a shape="rect" href="enterprise-integration-patterns.html">EIP patterns</a>) allows you to route messages to a separate location while they are being forwarded to the ultimate destination.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.enterpriseintegrationpatterns.com/img/WireTap.gif" data-image-src="http://www.enterpriseintegrationpatterns.com/img/WireTap.gif"></span></p><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Streams</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>If you <a shape="rect" href="wire-tap.html">Wire Tap</a> a stream message body then you should consider enabling <a shape="rect" href="stream-caching.html">Stream caching</a> to ensure the message body can be read at each endpoint. See more details at <a shape="rect" href="stream-caching.html">Stream caching</a>.</p>
 </div>
</div><h3 id="BookInOnePage-Options.20">Options</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>uri</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Mandatory:</strong> The URI of the endpoint to which the wire-tapped message will be sent. From <strong>Camel 2.16</strong> onwards support dynamic to uris like documented in <a shape="rect" class="external-link" href="http://camel.apache.org/message-endpoint.html" style="line-height: 1.4285715;">Message Endpoint</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>executorServiceRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Reference identifier of a custom <a shape="rect" href="threading-model.html">Thread Pool</a> to use when processing the wire-tapped messages. If not set, Camel will use a default thread pool.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>processorRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Reference identifier of a custom <a shape="rect" href="processor.html">Processor</a> to use for creating a new message (e.g., the "send a new message" mode). See below.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>copy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3</strong>: Whether to copy the <a shape="rect" href="exchange.html">Exchange</a> before wire-tapping the message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>onPrepareRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> Reference identifier of a custom <a shape="rect" href="processor.html">Processor</a> to prepare the copy of the <a shape="rect" href="exchange.html">Exchange</a> to be wire-tapped. This allows you to do any custom logic, such as deep-cloning the message payload.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>cacheSize</code></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><span style="color: rgb(0,0,0);"><strong>Camel 2.16:</strong> Allows to configure the cache size for the&#160;</span><code>ProducerCache</code><span style="color: rgb(0,0,0);">&#160;which caches producers for reuse. Will by default use the default cache size which is 1000. Setting the value to -1 allows to turn off the cache all together.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>ignoreInvalidEndpoint</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> <span style="color: rgb(0,0,0);">Whether to ignore an endpoint URI that could not be resolved. If disabled, Camel will throw an exception identifying the invalid endpoint URI.</span></td></tr></tbody></table>
</div><h3 id="BookInOnePage-WireTapthreadpool">WireTap thread pool</h3><p>The <a shape="rect" href="wire-tap.html">Wire Tap</a> uses a thread pool to process the tapped messages. This thread pool will by default use the settings detailed at <a shape="rect" href="threading-model.html">Threading Model</a>. In particular, when the pool is exhausted (with all threads utilized), further wiretaps will be executed synchronously by the calling thread. To remedy this, you can configure an explicit thread pool on the <a shape="rect" href="wire-tap.html">Wire Tap</a> having either a different rejection policy, a larger worker queue, or more worker threads.</p><h3 id="BookInOnePage-WireTapnode">WireTap node</h3><p>Camel's Wire Tap node supports two flavors when tapping an <a shape="rect" href="exchange.html">Exchange</a>:</p><p>-With the traditional Wire Tap, Camel will copy the original <a shape="rect" href="exchange.html">Exchange</a> and set its <a shape="rect" href="exchange-pattern.html">Exchange Pattern</a> to InOnly, as we want the tapped <a shape="rect" href="exchange.html">Exchange</a> to be sent in a fire and forget style. The tapped <a shape="rect" href="exchange.html">Exchange</a> is then sent in a separate thread so it can run in parallel with the original. Beware that only the Exchange is copied - Wire Tap won't do a deep clone (unless you specify a custom processor via <em>onPrepareRef</em> which does that). So all copies could share objects from the original Exchange.</p><p>-Camel also provides an option of sending a new <a shape="rect" href="exchange.html">Exchange</a> allowing you to populate it with new values.</p><h4 id="BookInOnePage-Sendingacopy(traditionalwiretap)">Sending a copy (traditional wiretap)</h4><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong>
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;log:foo&amp;quot;) .wireTap(&amp;quot;direct:tap&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;log:foo&amp;quot;/&amp;gt; &amp;lt;wireTap uri=&amp;quot;direct:tap&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div><h4 id="BookInOnePage-Sendinganew">Sending a new <a shape="rect" href="exchange.html">Exchange</a></h4><p><strong>Using the <a shape="rect" href="fluent-builders.html">Fluent Builders</a></strong><br clear="none"> Camel supports either a processor or an <a shape="rect" href="expression.html">Expression</a> to populate the new <a shape="rect" href="exchange.html">Exchange</a>. Using a processor gives you full power over how the <a shape="rect" href="exchange.html">Exchange</a> is populated as you can set properties, headers, et cetera. An <a shape="rect" href="expression.html">Expression</a> can only be used to set the IN body.</p><p>From <strong>Camel 2.3</strong> onwards the <a shape="rect" href="expression.html">Expression</a> or <a shape="rect" href="processor.html">Processor</a> is pre-populated with a copy of the original <a shape="rect" href="exchange.html">Exchange</a>, which allows you to access the original message when you prepare a new <a shape="rect" href="exchange.html">Exchange</a> to be sent. You can use the <code>copy</code> option (enabled by default) to indicate whether you want this. If you set <code>copy=false</code>, then it works as in Camel 2.2 or older where the <a shape="rect" href="exchange.html">Exchange</a> will be empty.</p><p>Below is the processor variation. This example is from Camel 2.3, where we disable <code>copy</code> by passing in <code>false</code> to create a new, empty <a shape="rect" href="exchange.html">Exchange</a>.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) .wireTap(&amp;quot;direct:foo&amp;quot;, false, new Processor() { public void process(Exchange exchange) throws Exception { exchange.getIn().setBody(&amp;quot;Bye World&amp;quot;); exchange.getIn().setHeader(&amp;quot;foo&amp;quot;, &amp;quot;bar&amp;quot;); } }).to(&amp;quot;mock:result&amp;quot;); from(&amp;quot;direct:foo&amp;quot;).to(&amp;quot;mock:foo&amp;quot;); </script> 
  </div>
 </div>Here is the <a shape="rect" href="expression.html">Expression</a> variation. This example is from Camel 2.3, where we disable <code>copy</code> by passing in <code>false</code> to create a new, empty <a shape="rect" href="exchange.html">Exchange</a>.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) .wireTap(&amp;quot;direct:foo&amp;quot;, false, constant(&amp;quot;Bye World&amp;quot;)) .to(&amp;quot;mock:result&amp;quot;); from(&amp;quot;direct:foo&amp;quot;).to(&amp;quot;mock:foo&amp;quot;); </script> 
  </div>
 </div><strong>Using the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a></strong><br clear="none"> The processor variation, which uses a <strong>processorRef</strong> attribute to refer to a Spring bean by ID:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start2&amp;quot;/&amp;gt; &amp;lt;wireTap uri=&amp;quot;direct:foo&amp;quot; processorRef=&amp;quot;myProcessor&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div>Here is the <a shape="rect" href="expression.html">Expression</a> variation, where the expression is defined in the <strong>body</strong> tag:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;wireTap uri=&amp;quot;direct:foo&amp;quot;&amp;gt; &amp;lt;body&amp;gt;&amp;lt;constant&amp;gt;Bye World&amp;lt;/constant&amp;gt;&amp;lt;/body&amp;gt; &amp;lt;/wireTap&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div>This variation accesses the body of the original message and creates a new <a shape="rect" href="exchange.html">Exchange</a> based on the <a shape="rect" href="expression.html">Expression</a>. It will create a new Exchange and have the body contain <code>"Bye ORIGINAL BODY MESSAGE HERE"</code>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;wireTap uri=&amp;quot;direct:foo&amp;quot;&amp;gt; &amp;lt;body&amp;gt;&amp;lt;simple&amp;gt;Bye ${body}&amp;lt;/simple&amp;gt;&amp;lt;/body&amp;gt; &amp;lt;/wireTap&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div><h4 id="BookInOnePage-FurtherExample">Further Example</h4><p>For another example of this pattern, refer to the <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/WireTapTest.java">wire tap test case</a>.</p><h3 id="BookInOnePage-UsingDynamicUris">Using Dynamic Uris</h3><p><strong>Available as of Camel 2.16:</strong></p><p>For example to wire tap to a dynamic uri, then it supports the same dynamic uris as documented in&#160;<a shape="rect" href="message-endpoint.html">Message Endpoint</a>. For example to wire tap to a JMS queue where the header ID is part of the queue name</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .wireTap(&amp;quot;jms:queue:backup-${header.id}&amp;quot;) .to(&amp;quot;bean:doSomething&amp;quot;);</script> 
 </div>
</div><p>&#160;</p><h3 id="BookInOnePage-SendinganewandsetheadersinDSL">Sending a new <a shape="rect" href="exchange.html">Exchange</a> and set headers in DSL</h3><p><strong>Available as of Camel 2.8</strong></p><p>If you send a new message using <a shape="rect" href="wire-tap.html">Wire Tap</a>, then you could only set the message body using an <a shape="rect" href="expression.html">Expression</a> from the DSL. If you also need to set headers, you would have to use a <a shape="rect" href="processor.html">Processor</a>. In Camel 2.8 onwards, you can now set headers as well in the DSL.</p><p>The following example sends a new message which has</p><ul class="alternate"><li>"Bye World" as message body</li><li>a header with key "id" with the value 123</li><li>a header with key "date" which has current date as value</li></ul><h4 id="BookInOnePage-JavaDSL.3">Java DSL</h4><p>
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) // tap a new message and send it to direct:tap // the new message should be Bye World with 2 headers .wireTap(&amp;quot;direct:tap&amp;quot;) // create the new tap message body and headers .newExchangeBody(constant(&amp;quot;Bye World&amp;quot;)) .newExchangeHeader(&amp;quot;id&amp;quot;, constant(123)) .newExchangeHeader(&amp;quot;date&amp;quot;, simple(&amp;quot;${date:now:yyyyMMdd}&amp;quot;)) .end() // here we continue routing the original messages .to(&amp;quot;mock:result&amp;quot;); // this is the tapped route from(&amp;quot;direct:tap&amp;quot;) .to(&amp;quot;mock:tap&amp;quot;); </script> 
  </div>
 </div><h4 id="BookInOnePage-XMLDSL">XML DSL</h4><p>The XML DSL is slightly different than Java DSL in how you configure the message body and headers using &lt;body&gt; and &lt;setHeader&gt;:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;!-- tap a new message and send it to direct:tap --&amp;gt; &amp;lt;!-- the new message should be Bye World with 2 headers --&amp;gt; &amp;lt;wireTap uri=&amp;quot;direct:tap&amp;quot;&amp;gt; &amp;lt;!-- create the new tap message body and headers --&amp;gt; &amp;lt;body&amp;gt;&amp;lt;constant&amp;gt;Bye World&amp;lt;/constant&amp;gt;&amp;lt;/body&amp;gt; &amp;lt;setHeader headerName=&amp;quot;id&amp;quot;&amp;gt;&amp;lt;constant&amp;gt;123&amp;lt;/constant&amp;gt;&amp;lt;/setHeader&amp;gt; &amp;lt;setHeader headerName=&amp;quot;date&amp;quot;&amp;gt;&amp;lt;simple&amp;gt;${date:now:yyyyMMdd}&amp;lt;/simple&amp;gt;&amp;lt;/setHeader&amp;gt; &amp;lt;/wireTap&amp;gt; &amp;lt;!-- here we continue routing the original message --&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div><h3 id="BookInOnePage-UsingonPreparetoexecutecustomlogicwhenpreparingmessages.3">Using onPrepare to execute custom logic when preparing messages</h3><p><strong>Available as of Camel 2.8</strong></p><p>See details at <a shape="rect" href="multicast.html">Multicast</a></p><p></p><h4 id="BookInOnePage-UsingThisPattern.47">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p><h2 id="BookInOnePage-Log">Log</h2><p>How can I log the processing of a <a shape="rect" href="message.html">Message</a>?</p><p>Camel provides many ways to log the fact that you are processing a message. Here are just a few examples:</p><ul class="alternate"><li>You can use the <a shape="rect" href="log.html">Log</a> component which logs the Message content.</li><li>You can use the <a shape="rect" href="tracer.html">Tracer</a> which trace logs message flow.</li><li>You can also use a <a shape="rect" href="processor.html">Processor</a> or <a shape="rect" href="bean.html">Bean</a> and log from Java code.</li><li>You can use the <code>log</code> DSL.</li></ul><h3 id="BookInOnePage-UsinglogDSL">Using log DSL</h3><p>In <strong>Camel 2.2</strong> you can use the <code>log</code> DSL which allows you to use <a shape="rect" href="simple.html">Simple</a> language to construct a dynamic message which gets logged.<br clear="none"> For example you can do</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;).log(&amp;quot;Processing ${id}&amp;quot;).to(&amp;quot;bean:foo&amp;quot;); </script> 
 </div>
</div><p>Which will construct a String message at runtime using the <a shape="rect" href="simple.html">Simple</a> language. The log message will by logged at <code>INFO</code> level using the route id as the log name. By default a route is named <code>route-1</code>, <code>route-2</code> etc. But you can use the <code>routeId("myCoolRoute")</code> to set a route name of choice.</p><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Difference between log in the DSL and [Log] component</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The <code>log</code> DSL is much lighter and meant for logging human logs such as <code>Starting to do ...</code> etc. It can only log a message based on the <a shape="rect" href="simple.html">Simple</a> language. On the other hand <a shape="rect" href="log.html">Log</a> component is a full fledged component which involves using endpoints and etc. The <a shape="rect" href="log.html">Log</a> component is meant for logging the Message itself and you have many URI options to control what you would like to be logged.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Using Logger instance from the the Registry</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>As of <strong>Camel 2.12.4/2.13.1</strong>, if no logger name or logger instance is passed to log DSL, there is a Registry lookup performed to find single instance of&#160;<code>org.slf4j.Logger</code>. If such an instance is found, it is used instead of creating a new logger instance. If more instances are found, the behavior defaults to creating a new instance of logger.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Logging message body with streamed messages</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>If the message body is stream based, then logging the message body, may cause the message body to be <em>empty</em> afterwards. See this <a shape="rect" href="why-is-my-message-body-empty.html">FAQ</a>. For streamed messages you can use <a shape="rect" href="stream-caching.html">Stream caching</a> to allow logging the message body and be able to read the message body afterwards again.</p>
 </div>
</div><p>The log DSL have overloaded methods to set the logging level and/or name as well.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;).log(LoggingLevel.DEBUG, &amp;quot;Processing ${id}&amp;quot;).to(&amp;quot;bean:foo&amp;quot;); </script> 
 </div>
</div><p>and to set a logger name</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;).log(LoggingLevel.DEBUG, &amp;quot;com.mycompany.MyCoolRoute&amp;quot;, &amp;quot;Processing ${id}&amp;quot;).to(&amp;quot;bean:foo&amp;quot;); </script> 
 </div>
</div><p>Since <strong>Camel 2.12.4/2.13.1</strong> the logger instance may be used as well:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;).log(LoggingLeven.DEBUG, org.slf4j.LoggerFactory.getLogger(&amp;quot;com.mycompany.mylogger&amp;quot;), &amp;quot;Processing ${id}&amp;quot;).to(&amp;quot;bean:foo&amp;quot;);</script> 
 </div>
</div><p>For example you can use this to log the file name being processed if you consume files.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://target/files&amp;quot;).log(LoggingLevel.DEBUG, &amp;quot;Processing file ${file:name}&amp;quot;).to(&amp;quot;bean:foo&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-UsinglogDSLfromSpring">Using log DSL from Spring</h4><p>In Spring DSL it is also easy to use log DSL as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route id=&amp;quot;foo&amp;quot;&amp;gt; &amp;lt;from uri=&amp;quot;direct:foo&amp;quot;/&amp;gt; &amp;lt;log message=&amp;quot;Got ${body}&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:foo&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>The log tag has attributes to set the <code>message</code>, <code>loggingLevel</code> and <code>logName</code>. For example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route id=&amp;quot;baz&amp;quot;&amp;gt; &amp;lt;from uri=&amp;quot;direct:baz&amp;quot;/&amp;gt; &amp;lt;log message=&amp;quot;Me Got ${body}&amp;quot; loggingLevel=&amp;quot;FATAL&amp;quot; logName=&amp;quot;com.mycompany.MyCoolRoute&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:baz&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>Since&#160;<strong>Camel 2.12.4/2.13.1</strong> it is possible to reference logger instance. For example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;myLogger&amp;quot; class=&amp;quot;org.slf4j.LoggerFactory&amp;quot; factory-method=&amp;quot;getLogger&amp;quot; xmlns=&amp;quot;http://www.springframework.org/schema/beans&amp;quot;&amp;gt; &amp;lt;constructor-arg value=&amp;quot;com.mycompany.mylogger&amp;quot; /&amp;gt; &amp;lt;/bean&amp;gt; &nbsp;&amp;lt;route id=&amp;quot;moo&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;from uri=&amp;quot;direct:moo&amp;quot;/&amp;gt; &amp;lt;log message=&amp;quot;Me Got ${body}&amp;quot; loggingLevel=&amp;quot;INFO&amp;quot; loggerRef=&amp;quot;myLogger&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:baz&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-Configuringlognameglobally">Configuring log name globally</h4><p><strong>Available as of Camel 2.17</strong></p><p>By default the log name is the route id. If you want to use a different log name, you would need to configure the logName option. However if you have many logs and you want all of them to use the same log name, then you would need to set that logName option on all of them.</p><p>With Camel 2.17 onwards you can configure a global log name that is used instead of the route id, eg</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">CamelContext context = ... context.getProperties().put(Exchange.LOG_EIP_NAME, &amp;quot;com.foo.myapp&amp;quot;);</script> 
 </div>
</div><p>And in XML</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext ...&amp;gt; &amp;lt;properties&amp;gt; &amp;lt;property key=&amp;quot;CamelLogEipName&amp;quot; value=&amp;quot;com.foo.myapp&amp;quot;/&amp;gt; &amp;lt;/properties&amp;gt;</script> 
 </div>
</div><p>&#160;</p><h4 id="BookInOnePage-Usingslf4jMarker">Using slf4j Marker</h4><p><strong>Available as of Camel 2.9</strong></p><p>You can specify a marker name in the DSL</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route id=&amp;quot;baz&amp;quot;&amp;gt; &amp;lt;from uri=&amp;quot;direct:baz&amp;quot;/&amp;gt; &amp;lt;log message=&amp;quot;Me Got ${body}&amp;quot; loggingLevel=&amp;quot;FATAL&amp;quot; logName=&amp;quot;com.mycompany.MyCoolRoute&amp;quot; marker=&amp;quot;myMarker&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:baz&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt;</script> 
 </div>
</div><h4 id="BookInOnePage-UsinglogDSLinOSGi">Using log DSL in OSGi</h4><p><strong>Improvement as of Camel 2.12.4/2.13.1</strong></p><p>When using log DSL inside OSGi (e.g., in Karaf), the underlying logging mechanisms are provided by PAX logging. It searches for a bundle which invokes&#160;<code>org.slf4j.LoggerFactory.getLogger()</code> method and associates the bundle with the logger instance. Passing only logger name to log DSL results in associating&#160;<code>camel-core</code> bundle with the logger instance created.</p><p>In some scenarios it is required that the bundle associated with logger should be the bundle which contains route definition. This is possible using provided logger instance both for Java DSL and Spring DSL (see the examples above).</p><p></p><h4 id="BookInOnePage-UsingThisPattern.48">Using This Pattern</h4> <p>If you would like to use this EIP Pattern then please read the <a shape="rect" href="getting-started.html">Getting Started</a>, you may also find the <a shape="rect" href="architecture.html">Architecture</a> useful particularly the description of <a shape="rect" href="endpoint.html">Endpoint</a> and <a shape="rect" href="uris.html">URIs</a>. Then you could try out some of the <a shape="rect" href="examples.html">Examples</a> first before trying this pattern out.</p></div>
<div class="chapter" id="chapter-component-appendix"><h1 id="BookInOnePage-ComponentAppendix">Component Appendix</h1><p>There now follows the documentation on each Camel component.</p><h2 id="BookInOnePage-ActiveMQComponent">ActiveMQ Component</h2><p>The ActiveMQ component allows messages to be sent to a <a shape="rect" class="external-link" href="http://java.sun.com/products/jms/" rel="nofollow">JMS</a> Queue or Topic or messages to be consumed from a JMS Queue or Topic using <a shape="rect" class="external-link" href="http://activemq.apache.org/" title="The most popular and powerful open source message broker">Apache ActiveMQ</a>.</p><p>This component is based on <a shape="rect" href="jms.html">JMS Component</a> and uses Spring's JMS support for declarative transactions, using Spring's <code>JmsTemplate</code> for sending and a <code>MessageListenerContainer</code> for consuming. All the options from the <a shape="rect" href="jms.html">JMS</a> component also applies for this component.</p><p>To use this component make sure you have the <code>activemq.jar</code> or <code>activemq-core.jar</code> on your classpath along with any Camel dependencies such as <code>camel-core.jar</code>, <code>camel-spring.jar</code> and <code>camel-jms.jar</code>.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Transacted and caching</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>See section <em>Transactions and Cache Levels</em> below on <a shape="rect" href="jms.html">JMS</a> page if you are using transactions with <a shape="rect" href="jms.html">JMS</a> as it can impact performance.</p>
 </div>
</div><h3 id="BookInOnePage-URIformat.1">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">activemq:[queue:|topic:]destinationName </script> 
 </div>
</div><p>Where <strong>destinationName</strong> is an ActiveMQ queue or topic name. By default, the <strong>destinationName</strong> is interpreted as a queue name. For example, to connect to the queue, <code>FOO.BAR</code>, use:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">activemq:FOO.BAR </script> 
 </div>
</div><p>You can include the optional <code>queue:</code> prefix, if you prefer:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">activemq:queue:FOO.BAR </script> 
 </div>
</div><p>To connect to a topic, you must include the <code>topic:</code> prefix. For example, to connect to the topic, <code>Stocks.Prices</code>, use:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">activemq:topic:Stocks.Prices </script> 
 </div>
</div><h3 id="BookInOnePage-Options.21">Options</h3><p>See Options on the <a shape="rect" href="jms.html">JMS</a> component as all these options also apply for this component.</p><h3 id="BookInOnePage-ConfiguringtheConnectionFactory">Configuring the Connection Factory</h3><p>This <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/activemq/trunk/activemq-camel/src/test/java/org/apache/activemq/camel/component/ActiveMQRouteTest.java">test case</a> shows how to add an ActiveMQComponent to the <a shape="rect" href="camelcontext.html">CamelContext</a> using the <a shape="rect" class="external-link" href="http://activemq.apache.org/maven/5.5.0/activemq-camel/apidocs/org/apache/activemq/camel/component/ActiveMQComponent.html#activeMQComponent%28java.lang.String%29"><code>activeMQComponent()</code> method</a> while specifying the <a shape="rect" class="external-link" href="http://activemq.apache.org/configuring-transports.html">brokerURL</a> used to connect to ActiveMQ.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">camelContext.addComponent(&amp;quot;activemq&amp;quot;, activeMQComponent(&amp;quot;vm://localhost?broker.persistent=false&amp;quot;)); </script> 
 </div>
</div><h3 id="BookInOnePage-ConfiguringtheConnectionFactoryusingSpringXML">Configuring the Connection Factory using Spring XML</h3><p>You can configure the ActiveMQ broker URL on the ActiveMQComponent as follows</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;beans xmlns=&amp;quot;http://www.springframework.org/schema/beans&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xsi:schemaLocation=&amp;quot; http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd&amp;quot;&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;bean id=&amp;quot;activemq&amp;quot; class=&amp;quot;org.apache.activemq.camel.component.ActiveMQComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;brokerURL&amp;quot; value=&amp;quot;tcp://somehost:61616&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;/beans&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Usingconnectionpooling">Using connection pooling</h3><p>When sending to an ActiveMQ broker using Camel it's recommended to use a pooled connection factory to efficiently handle pooling of JMS connections, sessions and producers. This is documented on the <a shape="rect" class="external-link" href="http://activemq.apache.org/spring-support.html">ActiveMQ Spring Support </a> page.</p><p>You can grab ActiveMQ's <code>org.apache.activemq.pool.PooledConnectionFactory</code> with Maven:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.activemq&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;activemq-pool&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;5.6.0&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><p>And then setup the <strong>activemq</strong> Camel component as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;jmsConnectionFactory&amp;quot; class=&amp;quot;org.apache.activemq.ActiveMQConnectionFactory&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;brokerURL&amp;quot; value=&amp;quot;tcp://localhost:61616&amp;quot; /&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;pooledConnectionFactory&amp;quot; class=&amp;quot;org.apache.activemq.pool.PooledConnectionFactory&amp;quot; init-method=&amp;quot;start&amp;quot; destroy-method=&amp;quot;stop&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;maxConnections&amp;quot; value=&amp;quot;8&amp;quot; /&amp;gt; &amp;lt;property name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;jmsConnectionFactory&amp;quot; /&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;jmsConfig&amp;quot; class=&amp;quot;org.apache.camel.component.jms.JmsConfiguration&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;pooledConnectionFactory&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;concurrentConsumers&amp;quot; value=&amp;quot;10&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;activemq&amp;quot; class=&amp;quot;org.apache.activemq.camel.component.ActiveMQComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;configuration&amp;quot; ref=&amp;quot;jmsConfig&amp;quot;/&amp;gt; &amp;lt;!-- if we are using transacted then enable CACHE_CONSUMER (if not using XA) to run faster see more details at: http://camel.apache.org/jms &amp;lt;property name=&amp;quot;transacted&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;cacheLevelName&amp;quot; value=&amp;quot;CACHE_CONSUMER&amp;quot; /&amp;gt; --&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-note">
 <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Notice the <strong>init</strong> and <strong>destroy</strong> methods on the pooled connection factory. This is important to ensure the connection pool is properly started and shutdown.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Important information about when using transactions</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>If you are using transactions then see more details at <a shape="rect" href="jms.html">JMS</a>. And remember to set <code>cacheLevelName</code> to <code>CACHE_CONSUMER</code> if you are not using XA transactions. This can dramatically improve performance.</p>
 </div>
</div><p>The <code>PooledConnectionFactory</code> will then create a connection pool with up to 8 connections in use at the same time. Each connection can be shared by many sessions. There is an option named <code>maximumActive</code> you can use to configure the maximum number of sessions per connection; the default value is <code>500</code>. From <strong>ActiveMQ 5.7</strong> onwards the option has been renamed to better reflect its purpose, being named as <code>maximumActiveSessionPerConnection</code>. Notice the <code>concurrentConsumers</code> is set to a higher value than <code>maxConnections</code> is. This is okay, as each consumer is using a session, and as a session can share the same connection, we are in the safe. In this example we can have 8 * 500 = 4000 active sessions at the same time.</p><h3 id="BookInOnePage-InvokingMessageListenerPOJOsinaCamelroute">Invoking MessageListener POJOs in a Camel route</h3><p>The ActiveMQ component also provides a helper <a shape="rect" href="type-converter.html">Type Converter</a> from a JMS MessageListener to a <a shape="rect" href="processor.html">Processor</a>. This means that the <a shape="rect" href="bean.html">Bean</a> component is capable of invoking any JMS MessageListener bean directly inside any route.</p><p>So for example you can create a MessageListener in JMS like this:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public class MyListener implements MessageListener { public void onMessage(Message jmsMessage) { // ... } } </script> 
 </div>
</div><p>Then use it in your Camel route as follows</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://foo/bar&amp;quot;). bean(MyListener.class); </script> 
 </div>
</div><p>That is, you can reuse any of the Camel <a shape="rect" href="components.html">Components</a> and easily integrate them into your JMS <code>MessageListener</code> POJO!</p><h3 id="BookInOnePage-UsingActiveMQDestinationOptions">Using ActiveMQ Destination Options</h3><p><strong>Available as of ActiveMQ 5.6</strong></p><p>You can configure the <a shape="rect" class="external-link" href="http://activemq.apache.org/destination-options.html">Destination Options</a> in the endpoint uri, using the "destination." prefix. For example to mark a consumer as exclusive, and set its prefetch size to 50, you can do as follows:</p><p>&#160;</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;from uri=&amp;quot;activemq:foo?destination.consumer.exclusive=true&amp;amp;amp;destination.consumer.prefetchSize=50&amp;quot;/&amp;gt;</script> 
 </div>
</div><h3 id="BookInOnePage-ConsumingAdvisoryMessages">Consuming Advisory Messages</h3><p>ActiveMQ can generate <a shape="rect" class="external-link" href="http://activemq.apache.org/advisory-message.html">Advisory messages </a> which are put in topics that you can consume. Such messages can help you send alerts in case you detect slow consumers or to build statistics (number of messages/produced per day, etc.) The following Spring DSL example shows you how to read messages from a topic.</p><p>The below route starts by reading the topic <em>ActiveMQ.Advisory.Connection</em>. To watch another topic, simply change the name according to the name provided in ActiveMQ Advisory Messages documentation. The parameter mapJmsMessage=false allows for converting the org.apache.activemq.command.ActiveMqMessage object from the jms queue. Next, the body received is converted into a String for the purposes of this example and a carriage return is added. Finally, the string is added to a file</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:topic:ActiveMQ.Advisory.Connection?mapJmsMessage=false&amp;quot; /&amp;gt; &amp;lt;convertBodyTo type=&amp;quot;java.lang.String&amp;quot;/&amp;gt; &amp;lt;transform&amp;gt; &amp;lt;simple&amp;gt;${in.body}&amp;amp;#13;&amp;lt;/simple&amp;gt; &amp;lt;/transform&amp;gt; &amp;lt;to uri=&amp;quot;file://data/activemq/?fileExist=Append&amp;amp;amp;fileName=advisoryConnection-${date:now:yyyyMMdd}.txt&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>If you consume a message on a queue, you should see the following files under the data/activemq folder :</p><p>advisoryConnection-20100312.txt<br clear="none"> advisoryProducer-20100312.txt</p><p>and containing string:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">ActiveMQMessage {commandId = 0, responseRequired = false, messageId = ID:dell-charles-3258-1268399815140 -1:0:0:0:221, originalDestination = null, originalTransactionId = null, producerId = ID:dell-charles-3258-1268399815140-1:0:0:0, destination = topic://ActiveMQ.Advisory.Connection, transactionId = null, expiration = 0, timestamp = 0, arrival = 0, brokerInTime = 1268403383468, brokerOutTime = 1268403383468, correlationId = null, replyTo = null, persistent = false, type = Advisory, priority = 0, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = null, marshalledProperties = org.apache.activemq.util.ByteSequence@17e2705, dataStructure = ConnectionInfo {commandId = 1, responseRequired = true, connectionId = ID:dell-charles-3258-1268399815140-2:50, clientId = ID:dell-charles-3258-1268399815140-14:0, userName = , password = *****, brokerPath = null, brokerMasterConnector = false, manageable = true, clientMaster = true}, redeliveryCounter = 0, size = 0, properties = {originBrokerName=master, originBrokerId=ID:dell-charles-3258-1268399815140-0:0, originBrokerURL=vm://master}, readOnlyProperties = true, readOnlyBody = true, droppable = false} </script> 
 </div>
</div><h3 id="BookInOnePage-GettingComponentJAR">Getting Component JAR</h3><p>You will need this dependency</p><ul class="alternate"><li><code>activemq-camel</code></li></ul><p><a shape="rect" href="activemq.html">ActiveMQ</a> is an extension of the <a shape="rect" href="jms.html">JMS</a> component released with the <a shape="rect" class="external-link" href="http://activemq.apache.org">ActiveMQ project</a>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.activemq&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;activemq-camel&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;5.6.0&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.20">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><div class="error">
 <span class="error">Unable to render {include}</span> The included page could not be found.
</div><h2 id="BookInOnePage-AMQP">AMQP</h2><p>The <strong style="line-height: 1.42857;">amqp:</strong> component supports the <a shape="rect" class="external-link" href="http://www.amqp.org/" style="line-height: 1.42857;" rel="nofollow">AMQP 1.0 protocol</a> using the JMS Client API of the <a shape="rect" class="external-link" href="https://github.com/apache/qpid-jms/" rel="nofollow">Qpid</a> project. In case you want to use <strong>AMQP 0.9</strong> (in particular RabbitMQ) you might also be interested in the <a shape="rect" href="rabbitmq.html">Camel RabbitMQ</a> component. Please keep in mind that prior to the <strong>Camel 2.17.0</strong> AMQP component supported <strong>AMQP 0.9</strong> and above, however since <strong>Camel 2.17.0</strong> it supports only <strong>AMQP 1.0</strong>.</p><p>Maven users will need to add the following dependency to their <strong><code>pom.xml</code></strong> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-amqp&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;${camel.version}&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.2">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">amqp:[queue:|topic:]destinationName[?options] </script> 
 </div>
</div><h3 id="BookInOnePage-AMQPOptions">AMQP Options</h3><p>You can specify all of the various configuration options of the <a shape="rect" href="jms.html">JMS</a> component after the destination name.</p><h3 id="BookInOnePage-Usage.1">Usage</h3><p>As AMQP component inherits from the JMS component. The usage of the former is almost identical to the latter:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>Using AMQP component</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// Consuming from AMQP queue from(&amp;quot;amqp:queue:incoming&amp;quot;) .to(...); &nbsp; // Sending message to the AMQP topic from(...) .to(&amp;quot;amqp:topic:notify&amp;quot;);</script> 
 </div>
</div><h3 id="BookInOnePage-ConfiguringAMQPcomponent"><span style="line-height: 1.5;">Configuring AMQP component</span></h3><p>Starting from the <strong>Camel 2.16.1</strong> you can also use the <strong><code>AMQPComponent#amqp10Component(String connectionURI)</code></strong> factory method to return the <strong>AMQP 1.0</strong> component with the pre-configured&#160;topic prefix:&#160;</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>Creating AMQP 1.0 component</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> AMQPComponent amqp = AMQPComponent.amqp10Component(&amp;quot;amqp://guest:guest@localhost:5672&amp;quot;);</script> 
 </div>
</div><p>Keep in mind that starting from the <strong>Camel&#160;2.17</strong>&#160;the&#160;<strong><code>AMQPComponent#amqp10Component(String connectionURI)</code></strong>&#160;factory method has been deprecated on the behalf of the <strong><code>AMQPComponent#amqpComponent(String connectionURI)</code></strong>:&#160;</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>Creating AMQP 1.0 component</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">AMQPComponent amqp = AMQPComponent.amqpComponent(&amp;quot;amqp://localhost:5672&amp;quot;); &nbsp; AMQPComponent authorizedAmqp = AMQPComponent.amqpComponent(&amp;quot;amqp://localhost:5672&amp;quot;, &amp;quot;user&amp;quot;, &amp;quot;password&amp;quot;);</script> 
 </div>
</div><p>Starting from <strong>Camel 2.17</strong>, in order to automatically configure the AMQP component, you can also add an instance of&#160;<strong><code>org.apache.camel.component.amqp.AMQPConnectionDetails</code></strong> to the registry. For example for Spring Boot you just have to define&#160;bean:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>AMQP connection details auto-configuration</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">@Bean AMQPConnectionDetails amqpConnection() { return new AMQPConnectionDetails(&amp;quot;amqp://lcoalhost:5672&amp;quot;); } &nbsp; @Bean AMQPConnectionDetails securedAmqpConnection() { return new AMQPConnectionDetails(&amp;quot;amqp://lcoalhost:5672&amp;quot;, &amp;quot;username&amp;quot;, &amp;quot;password&amp;quot;); }</script> 
 </div>
</div><p>&#160;</p><p>You can also rely on the <a shape="rect" href="properties.html">Camel properties</a> to read the AMQP connection details. The factory method&#160;<strong><code>AMQPConnectionDetails.discoverAMQP()</code></strong>&#160;attempts to read Camel properties in a Kubernetes-like convention, just as demonstrated on the snippet below:</p><p>&#160;</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>AMQP connection details auto-configuration</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">export AMQP_SERVICE_HOST = &amp;quot;mybroker.com&amp;quot; export AMQP_SERVICE_PORT = &amp;quot;6666&amp;quot; export AMQP_SERVICE_USERNAME = &amp;quot;username&amp;quot; export AMQP_SERVICE_PASSWORD = &amp;quot;password&amp;quot; &nbsp; ... &nbsp; @Bean AMQPConnectionDetails amqpConnection() { return AMQPConnectionDetails.discoverAMQP(); } </script> 
 </div>
</div><h3 id="BookInOnePage-ConfiguringConnectionFactory">Configuring Connection Factory</h3><p>Like with any other JMS-based component, usually it's important to configure JMS connection factory. For example, you'd like to set your broker URL or set proper connection credentials. Additionally, you would always want to set some kind of pooling (or caching) on the connection factory. An example of how to do both of these tasks is shown below.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;jmsConnectionFactory&amp;quot; class=&amp;quot;org.apache.qpid.jms.JmsConnectionFactory&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;remoteURI&amp;quot; value=&amp;quot;amqp://localhost:5672&amp;quot; /&amp;gt; &amp;lt;property name=&amp;quot;username&amp;quot; value=&amp;quot;admin&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;password&amp;quot; value=&amp;quot;admin&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;jmsCachingConnectionFactory&amp;quot; class=&amp;quot;org.springframework.jms.connection.CachingConnectionFactory&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;targetConnectionFactory&amp;quot; ref=&amp;quot;jmsConnectionFactory&amp;quot; /&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;jmsConfig&amp;quot; class=&amp;quot;org.apache.camel.component.jms.JmsConfiguration&amp;quot; &amp;gt; &amp;lt;property name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;jmsCachingConnectionFactory&amp;quot; /&amp;gt; &amp;lt;property name=&amp;quot;cacheLevelName&amp;quot; value=&amp;quot;CACHE_CONSUMER&amp;quot; /&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;amqp&amp;quot; class=&amp;quot;org.apache.camel.component.amqp.AMQPComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;configuration&amp;quot; ref=&amp;quot;jmsConfig&amp;quot; /&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/blueprint&amp;quot; id=&amp;quot;simple&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;timer:simple?period=5000&amp;quot;/&amp;gt; &amp;lt;setBody&amp;gt; &amp;lt;simple&amp;gt;Hello World&amp;lt;/simple&amp;gt; &amp;lt;/setBody&amp;gt; &amp;lt;to uri=&amp;quot;amqp:test&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-UsingamqpinsideKaraf">Using amqp inside Karaf</h3><p>To use the <strong><code>amqp</code></strong> component inside Karaf use the predefined feature called <strong><code>camel-amqp</code></strong> to install the necessary bundles.</p><p>Example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter">karaf@root()&amp;gt; repo-add camel karaf@root()&amp;gt; feature:install camel-amqp</script> 
 </div>
</div><p>and the environment would be set.</p><p>Use the <strong><code>camel-blueprint</code></strong> or&#160;<strong><code>camel-spring</code></strong> features to define routes in those contexts.</p><p>&#160;</p><p></p><h3 id="BookInOnePage-SeeAlso.21">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><p>&#160;</p><h2 id="BookInOnePage-SQSComponent">SQS Component</h2><p><strong>Available as of Camel 2.6</strong></p><p>The sqs component supports sending and receiving messages to <a shape="rect" class="external-link" href="http://aws.amazon.com/sqs" rel="nofollow">Amazon's SQS</a> service.</p><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Prerequisites</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>You must have a valid Amazon Web Services developer account, and be signed up to use Amazon SQS. More information are available at <a shape="rect" class="external-link" href="http://aws.amazon.com/sqs" rel="nofollow">Amazon SQS</a>.</p>
 </div>
</div><h3 id="BookInOnePage-URIFormat">URI Format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">aws-sqs://queueName[?options] aws-sqs://queueNameOrArn[?options] (from Camel 2.18) </script> 
 </div>
</div><p>The queue will be created if they don't already exists. You can append query options to the URI in the following format: <strong><code>?options=value&amp;option2=value&amp;...</code></strong></p><h3 id="BookInOnePage-URIOptions">URI Options</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Context</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>accessKey</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Shared</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Amazon AWS Access Key.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>amazonSQSClient</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Shared</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Reference to a <strong><code>com.amazonaws.services.sqs.AmazonSQS</code></strong> in the <a shape="rect" href="registry.html">Registry</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>amazonSQSEndpoint</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Shared</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The region with which the&#160;<strong><code>aws-sqs</code></strong> client wants to work with. Only works if Camel creates the&#160;<strong><code>aws-sqs</code></strong> client, i.e., if you explicitly set <strong><code>amazonSQSClient</code></strong>, then this setting will have no effect. You would have to set it on the client you create directly</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>attributeNames</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Consumer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A list of attribute names to receive when consuming. </p><p><strong>Camel 2.17:</strong> Multiple names can be separated by comma. </p><p><strong>Camel 2.16</strong> or older: The type is a Collection so its much harder to configure and use.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>concurrentConsumers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>1</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>Consumer</code></td><td colspan="1" rowspan="1" class="confluenceTd">(<strong>as of 2.15.0</strong>) Allows you to use multiple threads to poll the SQS queue to increase throughput. You must also set t<span>he </span><strong><code>maxMessagesPerPoll</code></strong> option for this to work properly.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>defaultVisibilityTimeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Shared</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The visibility timeout (in seconds) to set in the <strong><code>com.amazonaws.services.sqs.model.CreateQueueRequest</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>delaySeconds</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Producer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.3:</strong> Delay sending messages for a number of seconds.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>deleteAfterRead</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Consumer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Delete message from SQS after it has been read (and processed by the route).</p><p>If this option is false, then the same objects will be retrieve over and over again on the polls. Therefore you need to use the <a shape="rect" href="idempotent-consumer.html">Idempotent Consumer EIP</a> in the route to filter out duplicates. You can filter using the&#160;<strong><code>S3Constants#BUCKET_NAME</code></strong> and&#160;<strong><code>S3Constants#KEY</code></strong> headers, or only the&#160;<strong><code>S3Constants#KEY</code></strong> header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>deleteIfFiltered</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Consumer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12.2, 2.13.0</strong>: Whether or not to send the&#160;<strong><code>DeleteMessage</code></strong> to the SQS queue if an exchange fails to get through a filter.</p><p>If&#160;<strong><code>false</code></strong> and exchange does not make it through a Camel filter upstream in the route, then don't send <strong><code>DeleteMessage</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>extendMessageVisibility</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Consumer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> If enabled a scheduled background task will keep extending the message visibility on SQS. This is needed if it takes a long time to process the message. If set to true<strong><code> visibilityTimeout</code></strong> must be set.</p><p>See details at <a shape="rect" class="external-link" href="http://docs.amazonwebservices.com/AWSSimpleQueueService/latest/APIReference/Query_QueryChangeMessageVisibility.html" rel="nofollow">Amazon docs</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maximumMessageSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Shared</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> The&#160;<strong><code>maximumMessageSize</code></strong> (in bytes) an SQS message can contain for this queue, to set in the <strong><code>com.amazonaws.services.sqs.model.SetQueueAttributesRequest</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxMessagesPerPoll</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Consumer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The maximum number of messages which can be received in one poll to set in the <strong><code>com.amazonaws.services.sqs.model.ReceiveMessageRequest</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>messageAttributeNames</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>null</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>Consumer</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A list of message attribute names to receive when consuming. </p><p><strong>Camel 2.17:</strong><span>&#160;</span>Multiple names can be separated by comma. <span>&#160;</span></p><p><span><strong>Camel 2.16</strong> or older: The type is a Collection so its much harder to configure and use.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>messageRetentionPeriod</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Shared</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> The&#160;<strong><code>messageRetentionPeriod</code></strong> (in seconds) a message will be retained by SQS for this queue, to set in the <strong><code>com.amazonaws.services.sqs.model.SetQueueAttributesRequest</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>proxyHost</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>null</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>Shared</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16</strong>: Specify a proxy host to be used inside the client definition.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>proxyPort</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>null</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>Shared</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16</strong>: Specify a proxy port to be used inside the client definition.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>queueOwnerAWSAccountId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Shared</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> Specify the queue owner aws account id when you need to connect the queue with different account owner.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>policy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Shared</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> The policy for this queue to set in the <strong><code>com.amazonaws.services.sqs.model.SetQueueAttributesRequest</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>receiveMessageWaitTimeSeconds</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Shared</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> If you do not specify&#160;<strong><code>WaitTimeSeconds</code></strong> in the request, the queue attribute&#160;<strong><code>ReceiveMessageWaitTimeSeconds</code></strong> is used to determine how long to wait.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>redrivePolicy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>null</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>Shared</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.15</strong>: Specify the policy that send message to&#160;<strong><code>DeadLetter</code></strong> queue. See detail at <a shape="rect" class="external-link" href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-sqs-queues-redrivepolicy.html" rel="nofollow">Amazon docs</a>.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>region</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Shared</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12.3:</strong> Specify the queue region which could be used with <strong><code>queueOwnerAWSAccountId</code></strong> to build the service URL.<br clear="none"><strong>Note</strong>: Region will still default to&#160;<strong><code>us-east-1</code></strong> if &#160;<span><strong><code>queueOwnerAWSAccountId</code></strong> is not specified</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>secretKey</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Shared</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Amazon AWS Secret Key.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>waitTimeSeconds</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Producer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> Duration in seconds (0 to 20) that the&#160;<strong><code>ReceiveMessage</code></strong> action call will wait until a message is in the queue to include in the response.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>visibilityTimeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Shared</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The duration (in seconds) that the received messages are hidden from subsequent retrieve requests after being retrieved by a&#160;<strong><code>ReceiveMessage</code></strong> request. This only make sense if its different from <strong><code>defaultVisibilityTimeout</code></strong>.</p></td></tr></tbody></table>
</div><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Required SQS component options</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>You have to provide the&#160;<strong><code>amazonSQSClient</code></strong> in the <a shape="rect" href="registry.html">Registry</a> or your&#160;<strong><code>accessKey</code></strong> and&#160;<strong><code>secretKey</code></strong> to access the <a shape="rect" class="external-link" href="http://aws.amazon.com/sqs" rel="nofollow">Amazon's SQS</a>.</p>
 </div>
</div><h3 id="BookInOnePage-BatchConsumer">Batch Consumer</h3><p>This component implements the <a shape="rect" href="batch-consumer.html">Batch Consumer</a>.</p><p>This allows you for instance to know how many messages exists in this batch and for instance let the <a shape="rect" href="aggregator.html">Aggregator</a> aggregate this number of messages.</p><h3 id="BookInOnePage-Usage.2">Usage</h3><h4 id="BookInOnePage-MessageheaderssetbytheSQSproducer">Message headers set by the SQS producer</h4><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelAwsSqsMD5OfBody</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The MD5 checksum of the Amazon SQS message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelAwsSqsMessageId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Amazon SQS message ID.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelAwsSqsDelaySeconds</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Integer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Since <strong>Camel 2.11</strong>, the delay seconds that the Amazon SQS message can be see by others.</p></td></tr></tbody></table>
</div><h4 id="BookInOnePage-MessageheaderssetbytheSQSconsumer">Message headers set by the SQS consumer</h4><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelAwsSqsMD5OfBody</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The MD5 checksum of the Amazon SQS message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelAwsSqsMessageId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Amazon SQS message ID.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelAwsSqsReceiptHandle</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Amazon SQS message receipt handle.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelAwsSqsAttributes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Map&lt;String, String&gt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Amazon SQS message attributes.</p></td></tr></tbody></table>
</div><h4 id="BookInOnePage-AdvancedAmazonSQSconfiguration">Advanced AmazonSQS configuration</h4><p>If your Camel Application is running behind a firewall or if you need to have more control over the AmazonSQS instance configuration, you can create your own instance:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">AWSCredentials awsCredentials = new BasicAWSCredentials(&amp;quot;myAccessKey&amp;quot;, &amp;quot;mySecretKey&amp;quot;); ClientConfiguration clientConfiguration = new ClientConfiguration(); clientConfiguration.setProxyHost(&amp;quot;http://myProxyHost&amp;quot;); clientConfiguration.setProxyPort(8080); AmazonSQS client = new AmazonSQSClient(awsCredentials, clientConfiguration); registry.bind(&amp;quot;client&amp;quot;, client); </script> 
 </div>
</div><p>and refer to it in your Camel aws-sqs component configuration:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;aws-sqs://MyQueue?amazonSQSClient=#client&amp;amp;delay=5000&amp;amp;maxMessagesPerPoll=5&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-Dependencies.34">Dependencies</h3><p>Maven users will need to add the following dependency to their <strong><code>pom.xml</code></strong>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>pom.xml</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-aws&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;${camel-version}&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><p>where <strong><code>${camel-version</code>}</strong> must be replaced by the actual version of Camel (2.6 or higher).</p><h3 id="BookInOnePage-JMS-styleSelectors">JMS-style Selectors</h3><p>SQS does not allow selectors, but you can effectively achieve this by using the <a shape="rect" href="message-filter.html">Camel Filter EIP</a> and setting an appropriate <strong><code>visibilityTimeout</code></strong>. When SQS dispatches a message, it will wait up to the visibility timeout before it will try to dispatch the message to a different consumer unless a&#160;<strong><code>DeleteMessage</code></strong> is received. By default, Camel will always send the&#160;<strong><code>DeleteMessage</code></strong> at the end of the route, unless the route ended in failure. To achieve appropriate filtering and not send the&#160;<strong><code>DeleteMessage</code></strong> even on successful completion of the route, use a Filter:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;aws-sqs://MyQueue?amazonSQSClient=#client&amp;amp;defaultVisibilityTimeout=5000&amp;amp;deleteIfFiltered=false&amp;quot;) .filter(&amp;quot;${header.login} == true&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>In the above code, if an exchange doesn't have an appropriate header, it will not make it through the filter AND also not be deleted from the SQS queue. After&#160;<code>5000</code> miliseconds, the message will become visible to other consumers.</p><p></p><h3 id="BookInOnePage-SeeAlso.22">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="aws.html">AWS Component</a></li></ul><h2 id="BookInOnePage-AtomComponent">Atom Component</h2><p>The <strong>atom:</strong> component is used for polling Atom feeds.</p><p>Camel will poll the feed every 60 seconds by default.<br clear="none"> <strong>Note:</strong> The component currently only supports polling (consuming) feeds.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-atom&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.3">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">atom://atomUri[?options] </script> 
 </div>
</div><p>Where <strong>atomUri</strong> is the URI to the Atom feed to poll.</p><h3 id="BookInOnePage-Options.22">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Property</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>splitEntries</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If <code>true</code> Camel will poll the feed and for the subsequent polls return each entry poll by poll. If the feed contains 7 entries then Camel will return the first entry on the first poll, the 2nd entry on the next poll, until no more entries where as Camel will do a new update on the feed. If <code>false</code> then Camel will poll a fresh feed on every invocation.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>filter</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Is only used by the split entries to filter the entries to return. Camel will default use the <code>UpdateDateFilter</code> that only return new entries from the feed. So the client consuming from the feed never receives the same entry more than once. The filter will return the entries ordered by the newest last.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>lastUpdate</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Is only used by the filter, as the starting timestamp for selection never entries (uses the <code>entry.updated</code> timestamp). Syntax format is: <code>yyyy-MM-ddTHH:MM:ss</code>. Example: <code>2007-12-24T17:45:59</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>throttleEntries</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> Sets whether all entries identified in a single feed poll should be delivered immediately. If <code>true</code>, only one entry is processed per <code>consumer.delay</code>. Only applicable when <code>splitEntries</code> is set to <code>true</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>feedHeader</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sets whether to add the Abdera Feed object as a header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sortEntries</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If <code>splitEntries</code> is <code>true</code>, this sets whether to sort those entries by updated date.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.delay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>500</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Delay in millis between each poll.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.initialDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Millis before polling starts.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.userFixedDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If <code>true</code>, use fixed delay between pools, otherwise fixed rate is used. See <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ScheduledExecutorService.html" rel="nofollow">ScheduledExecutorService</a> in JDK for details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>username</code></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> For basic authentication when polling from a HTTP feed</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>password</code></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong><span> For basic authentication when polling from a HTTP feed</span></td></tr></tbody></table> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Exchangedataformat">Exchange data format</h3><p>Camel will set the In body on the returned <code>Exchange</code> with the entries. Depending on the <code>splitEntries</code> flag Camel will either return one <code>Entry</code> or a <code>List&lt;Entry&gt;</code>.</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Behavior</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>splitEntries</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Only a single entry from the currently being processed feed is set: <code>exchange.in.body(Entry)</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>splitEntries</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The entire list of entries from the feed is set: <code>exchange.in.body(List&lt;Entry&gt;)</code></p></td></tr></tbody></table> 
 </div>
</div><p>Camel can set the <code>Feed</code> object on the In header (see <code>feedHeader</code> option to disable this):</p><h3 id="BookInOnePage-MessageHeaders">Message Headers</h3><p>Camel atom uses these headers.</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelAtomFeed</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>When consuming the <code>org.apache.abdera.model.Feed</code> object is set to this header.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Samples.6">Samples</h3><p>In this sample we poll James Strachan's blog.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;atom://http://macstrac.blogspot.com/feeds/posts/default&amp;quot;).to(&amp;quot;seda:feeds&amp;quot;); </script> 
 </div>
</div><p>In this sample we want to filter only good blogs we like to a SEDA queue. The sample also shows how to setup Camel standalone, not running in any Container or using Spring.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // This is the CamelContext that is the heart of Camel private CamelContext context; protected CamelContext createCamelContext() throws Exception { // First we register a blog service in our bean registry SimpleRegistry registry = new SimpleRegistry(); registry.put(&amp;quot;blogService&amp;quot;, new BlogService()); // Then we create the camel context with our bean registry context = new DefaultCamelContext(registry); // Then we add all the routes we need using the route builder DSL syntax context.addRoutes(createMyRoutes()); return context; } /** * This is the route builder where we create our routes using the Camel DSL */ protected RouteBuilder createMyRoutes() throws Exception { return new RouteBuilder() { public void configure() throws Exception { // We pool the atom feeds from the source for further processing in the seda queue // we set the delay to 1 second for each pool as this is a unit test also and we can // not wait the default poll interval of 60 seconds. // Using splitEntries=true will during polling only fetch one Atom Entry at any given time. // As the feed.atom file contains 7 entries, using this will require 7 polls to fetch the entire // content. When Camel have reach the end of entries it will refresh the atom feed from URI source // and restart - but as Camel by default uses the UpdatedDateFilter it will only deliver new // blog entries to &amp;quot;seda:feeds&amp;quot;. So only when James Straham updates his blog with a new entry // Camel will create an exchange for the seda:feeds. from(&amp;quot;atom:file:src/test/data/feed.atom?splitEntries=true&amp;amp;consumer.delay=1000&amp;quot;).to(&amp;quot;seda:feeds&amp;quot;); // From the feeds we filter each blot entry by using our blog service class from(&amp;quot;seda:feeds&amp;quot;).filter().method(&amp;quot;blogService&amp;quot;, &amp;quot;isGoodBlog&amp;quot;).to(&amp;quot;seda:goodBlogs&amp;quot;); // And the good blogs is moved to a mock queue as this sample is also used for unit testing // this is one of the strengths in Camel that you can also use the mock endpoint for your // unit tests from(&amp;quot;seda:goodBlogs&amp;quot;).to(&amp;quot;mock:result&amp;quot;); } }; } /** * This is the actual junit test method that does the assertion that our routes is working as expected */ @Test public void testFiltering() throws Exception { // create and start Camel context = createCamelContext(); context.start(); // Get the mock endpoint MockEndpoint mock = context.getEndpoint(&amp;quot;mock:result&amp;quot;, MockEndpoint.class); // There should be at least two good blog entries from the feed mock.expectedMinimumMessageCount(2); // Asserts that the above expectations is true, will throw assertions exception if it failed // Camel will default wait max 20 seconds for the assertions to be true, if the conditions // is true sooner Camel will continue mock.assertIsSatisfied(); // stop Camel after use context.stop(); } /** * Services for blogs */ public class BlogService { /** * Tests the blogs if its a good blog entry or not */ public boolean isGoodBlog(Exchange exchange) { Entry entry = exchange.getIn().getBody(Entry.class); String title = entry.getTitle(); // We like blogs about Camel boolean good = title.toLowerCase().contains(&amp;quot;camel&amp;quot;); return good; } } </script> 
  </div>
 </div><h3 id="BookInOnePage-SeeAlso.23">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="rss.html">RSS</a></li></ul><h2 id="BookInOnePage-BeanComponent.1">Bean Component</h2><p>The <strong>bean:</strong> component binds beans to Camel message exchanges.</p><h3 id="BookInOnePage-URIformat.4">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">bean:beanID[?options] </script> 
 </div>
</div><p>Where <strong>beanID</strong> can be any string which is used to look up the bean in the <a shape="rect" href="registry.html">Registry</a></p><h3 id="BookInOnePage-Options.23">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>method</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The method name from the bean that will be invoked. If not provided, Camel will try to determine the method itself. In case of ambiguity an exception will be thrown. See <a shape="rect" href="bean-binding.html">Bean Binding</a> for more details. From <strong>Camel 2.8</strong> onwards you can specify type qualifiers to pin-point the exact method to use for overloaded methods. From <strong>Camel 2.9</strong> onwards you can specify parameter values directly in the method syntax. See more details at <a shape="rect" href="bean-binding.html">Bean Binding</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cache</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If enabled, Camel will cache the result of the first <a shape="rect" href="registry.html">Registry</a> look-up. Cache can be enabled if the bean in the <a shape="rect" href="registry.html">Registry</a> is defined as a singleton scope.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>multiParameterArray</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How to treat the parameters which are passed from the message body; if it is <code>true</code>, the In message body should be an array of parameters.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>bean.xxx</p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p>null</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong style="line-height: 1.42857;">Camel 2.17:</strong>&#160;To configure additional options on the create bean instance from the class name. For example to configure a foo option on the bean, use bean.foo=123.</p></td></tr></tbody></table> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Using">Using</h3><p>The object instance that is used to consume messages must be explicitly registered with the <a shape="rect" href="registry.html">Registry</a>. For example, if you are using Spring you must define the bean in the Spring configuration, <code>spring.xml</code>; or if you don't use Spring, by registering the bean in JNDI.
 </p><div class="error">
  <span class="error">Error formatting macro: snippet: java.lang.IndexOutOfBoundsException: Index: 20, Size: 20</span> 
 </div>Once an endpoint has been registered, you can build Camel routes that use it to process exchanges.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // lets add simple route camelContext.addRoutes(new RouteBuilder() { public void configure() { from(&amp;quot;direct:hello&amp;quot;).transform().constant(&amp;quot;Good Bye!&amp;quot;); } }); </script> 
  </div>
 </div>A <strong>bean:</strong> endpoint cannot be defined as the input to the route; i.e. you cannot consume from it, you can only route from some inbound message <a shape="rect" href="endpoint.html">Endpoint</a> to the bean endpoint as output. So consider using a <strong>direct:</strong> or <strong>queue:</strong> endpoint as the input.<p>You can use the <code>createProxy()</code> methods on <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/bean/ProxyHelper.html">ProxyHelper</a> to create a proxy that will generate BeanExchanges and send them to any endpoint:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> ISay proxy = new ProxyBuilder(camelContext).endpoint(&amp;quot;direct:hello&amp;quot;).build(ISay.class); String rc = proxy.say(); assertEquals(&amp;quot;Good Bye!&amp;quot;, rc); </script> 
  </div>
 </div>And the same route using Spring DSL:<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:hello&amp;quot;&amp;gt; &amp;lt;to uri=&amp;quot;bean:bye&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Beanasendpoint">Bean as endpoint</h3><p>Camel also supports invoking <a shape="rect" href="bean.html">Bean</a> as an Endpoint. In the route below:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;myBean&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:results&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;bean id=&amp;quot;myBean&amp;quot; class=&amp;quot;org.apache.camel.spring.bind.ExampleBean&amp;quot;/&amp;gt; </script> 
  </div>
 </div>What happens is that when the exchange is routed to the <code>myBean</code> Camel will use the <a shape="rect" href="bean-binding.html">Bean Binding</a> to invoke the bean.<br clear="none"> The source for the bean is just a plain POJO:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public class ExampleBean { public String sayHello(String name) { return &amp;quot;Hello &amp;quot; + name + &amp;quot;!&amp;quot;; } } </script> 
  </div>
 </div>Camel will use <a shape="rect" href="bean-binding.html">Bean Binding</a> to invoke the <code>sayHello</code> method, by converting the Exchange's In body to the <code>String</code> type and storing the output of the method on the Exchange Out body.<h3 id="BookInOnePage-JavaDSLbeansyntax">Java DSL bean syntax</h3><p>Java DSL comes with syntactic sugar for the <a shape="rect" href="bean.html">Bean</a> component. Instead of specifying the bean explicitly as the endpoint (i.e. <code>to("bean:beanName")</code>) you can use the following syntax:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// Send message to the bean endpoint // and invoke method resolved using Bean Binding. from(&amp;quot;direct:start&amp;quot;).beanRef(&amp;quot;beanName&amp;quot;); // Send message to the bean endpoint // and invoke given method. from(&amp;quot;direct:start&amp;quot;).beanRef(&amp;quot;beanName&amp;quot;, &amp;quot;methodName&amp;quot;); </script> 
 </div>
</div><p>Instead of passing name of the reference to the bean (so that Camel will lookup for it in the registry), you can specify the bean itself:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// Send message to the given bean instance. from(&amp;quot;direct:start&amp;quot;).bean(new ExampleBean()); // Explicit selection of bean method to be invoked. from(&amp;quot;direct:start&amp;quot;).bean(new ExampleBean(), &amp;quot;methodName&amp;quot;); // Camel will create the instance of bean and cache it for you. from(&amp;quot;direct:start&amp;quot;).bean(ExampleBean.class); </script> 
 </div>
</div><h3 id="BookInOnePage-BeanBinding.1">Bean Binding</h3><p>How bean methods to be invoked are chosen (if they are not specified explicitly through the <strong>method</strong> parameter) and how parameter values are constructed from the <a shape="rect" href="message.html">Message</a> are all defined by the <a shape="rect" href="bean-binding.html">Bean Binding</a> mechanism which is used throughout all of the various <a shape="rect" href="bean-integration.html">Bean Integration</a> mechanisms in Camel.</p><p></p><h3 id="BookInOnePage-SeeAlso.24">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul><li><a shape="rect" href="class.html">Class</a> component</li><li><a shape="rect" href="bean-binding.html">Bean Binding</a></li><li><a shape="rect" href="bean-integration.html">Bean Integration</a></li></ul><div class="error">
 <span class="error">Unable to render {include}</span> The included page could not be found.
</div><h2 id="BookInOnePage-BrowseComponent">Browse Component</h2><p>The Browse component provides a simple <a shape="rect" href="browsableendpoint.html">BrowsableEndpoint</a> which can be useful for testing, visualisation tools or debugging. The exchanges sent to the endpoint are all available to be browsed.</p><h3 id="BookInOnePage-URIformat.5">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> browse:someName[?options] </script> 
 </div>
</div><p>Where <strong>someName</strong> can be any string to uniquely identify the endpoint.</p><h3 id="BookInOnePage-Sample">Sample</h3><p>In the route below, we insert a <code>browse:</code> component to be able to browse the Exchanges that are passing through:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;activemq:order.in&amp;quot;).to(&amp;quot;browse:orderReceived&amp;quot;).to(&amp;quot;bean:processOrder&amp;quot;); </script> 
 </div>
</div><p>We can now inspect the received exchanges from within the Java code:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> private CamelContext context; public void inspectRecievedOrders() { BrowsableEndpoint browse = context.getEndpoint(&amp;quot;browse:orderReceived&amp;quot;, BrowsableEndpoint.class); List&amp;lt;Exchange&amp;gt; exchanges = browse.getExchanges(); ... // then we can inspect the list of received exchanges from Java for (Exchange exchange : exchanges) { String payload = exchange.getIn().getBody(); ... } } </script> 
 </div>
</div><h3 id="BookInOnePage-SeeAlso.25">See Also</h3><ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-CacheComponent">Cache Component</h2><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>This component is deprecated. As of Camel 2.18.0 You should use <a shape="rect" href="ehcache.html">Ehcache</a>.</p>
 </div>
</div><p><strong>Available as of Camel 2.1</strong></p><p>The <strong>cache</strong> component enables you to perform caching operations using EHCache as the Cache Implementation. The cache itself is created on demand or if a cache of that name already exists then it is simply utilized with its original settings.</p><p>This component supports producer and event based consumer endpoints.</p><p>The Cache consumer is an event based consumer and can be used to listen and respond to specific cache activities. If you need to perform selections from a pre-existing cache, use the processors defined for the cache component.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-cache&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.6">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">cache://cacheName[?options] </script> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=#beanRef&amp;...</code></p><h3 id="BookInOnePage-Options.24">Options</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxElementsInMemory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The number of elements that may be stored in the defined cache</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>memoryStoreEvictionPolicy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>MemoryStoreEvictionPolicy.LFU</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The number of elements that may be stored in the defined cache. Options include</p>
     <ul class="alternate"><li>MemoryStoreEvictionPolicy.LFU - Least frequently used</li><li>MemoryStoreEvictionPolicy.LRU - Least recently used</li><li>MemoryStoreEvictionPolicy.FIFO - first in first out, the oldest element by creation time</li></ul></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>overflowToDisk</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies whether cache may overflow to disk</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>eternal</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sets whether elements are eternal. If eternal, timeouts are ignored and the<br clear="none" class="atl-forced-newline"> element never expires.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>timeToLiveSeconds</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>300</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The maximum time between creation time and when an element expires.<br clear="none" class="atl-forced-newline"> Is used only if the element is not eternal</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>timeToIdleSeconds</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>300</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The maximum amount of time between accesses before an element expires</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>diskPersistent</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether the disk store persists between restarts of the Virtual Machine.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>diskExpiryThreadIntervalSeconds</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>120</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The number of seconds between runs of the disk expiry thread.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cacheManagerFactory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> If you want to use a custom factory which instantiates and creates the EHCache <code>net.sf.ehcache.CacheManager</code>. <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Type:</em> abstract org.apache.camel.component.cache.CacheManagerFactory</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>eventListenerRegistry</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> Sets a list of EHCache <code>net.sf.ehcache.event.CacheEventListener</code> for all new caches- no need to define it per cache in EHCache xml config anymore. <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Type:</em> org.apache.camel.component.cache.CacheEventListenerRegistry</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cacheLoaderRegistry</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> Sets a list of <code>org.apache.camel.component.cache.CacheLoaderWrapper</code> that extends EHCache <code>net.sf.ehcache.loader.CacheLoader</code> for all new caches- no need to define it per cache in EHCache xml config anymore. <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Type:</em> org.apache.camel.component.cache.CacheLoaderRegistry</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>key</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> To configure using a cache key by default. If a key is provided in the message header, then the key from the header takes precedence.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>operation</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> To configure using an cache operation by default. If an operation in the message header, then the operation from the header takes precedence.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>objectCache</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>false</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong style="line-height: 1.42857;">Camel 2.15:</strong> Whether to turn on allowing to store non serializable objects in the cache. If this option is enabled then overflow to disk cannot be enabled as well.</p></td></tr></tbody></table>
</div><h3 id="BookInOnePage-CacheComponentoptions">Cache Component options</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>configuration</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To use a custom <code>org.apache.camel.component.cache.CacheConfiguration</code> configuration.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cacheManagerFactory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To use a custom <code>org.apache.camel.component.cache.CacheManagerFactory</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>configurationFile</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.13/2.12.3:</strong> To configure the location of the <code>ehcache.xml</code> file to use, such as <code>classpath:com/foo/mycache.xml</code> to load from classpath. If no configuration is given, then the default settings from EHCache is used.</p></td></tr></tbody></table>
</div><h3 id="BookInOnePage-Sending/ReceivingMessagesto/fromthecache"><span style="line-height: 1.5625;">Sending/Receiving Messages to/from the cache</span></h3><h4 id="BookInOnePage-MessageHeadersuptoCamel2.7">Message Headers up to Camel 2.7</h4><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CACHE_OPERATION</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The operation to be performed on the cache. Valid options are</p> 
      <ul class="alternate"><li>GET</li><li>CHECK</li><li>ADD</li><li>UPDATE</li><li>DELETE</li><li>DELETEALL<br clear="none" class="atl-forced-newline"> <code>GET</code> and <code>CHECK</code> requires <strong>Camel 2.3</strong> onwards.</li></ul></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CACHE_KEY</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The cache key used to store the Message in the cache. The cache key is optional if the CACHE_OPERATION is DELETEALL</p></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-MessageHeadersCamel2.8+">Message Headers Camel 2.8+</h4><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Header changes in Camel 2.8</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The header names and supported values have changed to be prefixed with 'CamelCache' and use mixed case. This makes them easier to identify and keep separate from other headers. The CacheConstants variable names remain unchanged, just their values have been changed. Also, these headers are now removed from the exchange after the cache operation is performed.</p>
 </div>
</div><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelCacheOperation</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The operation to be performed on the cache. The valid options are</p> 
      <ul class="alternate"><li>CamelCacheGet</li><li>CamelCacheCheck</li><li>CamelCacheAdd</li><li>CamelCacheUpdate</li><li>CamelCacheDelete</li><li>CamelCacheDeleteAll</li></ul></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelCacheKey</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The cache key used to store the Message in the cache. The cache key is optional if the CamelCacheOperation is CamelCacheDeleteAll</p></td></tr></tbody></table> 
 </div>
</div><p>The <code>CamelCacheAdd</code> and <code>CamelCacheUpdate</code> operations support additional headers:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelCacheTimeToLive</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Integer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> Time to live in seconds.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelCacheTimeToIdle</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Integer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> Time to idle in seconds.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelCacheEternal</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> Whether the content is eternal.</p></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-CacheProducer">Cache Producer</h4><p>Sending data to the cache involves the ability to direct payloads in exchanges to be stored in a pre-existing or created-on-demand cache. The mechanics of doing this involve</p><ul class="alternate"><li>setting the Message Exchange Headers shown above.</li><li>ensuring that the Message Exchange Body contains the message directed to the cache</li></ul><h4 id="BookInOnePage-CacheConsumer">Cache Consumer</h4><p>Receiving data from the cache involves the ability of the CacheConsumer to listen on a pre-existing or created-on-demand Cache using an event Listener and receive automatic notifications when any cache activity take place (i.e CamelCacheGet/CamelCacheUpdate/CamelCacheDelete/CamelCacheDeleteAll). Upon such an activity taking place</p><ul class="alternate"><li>an exchange containing Message Exchange Headers and a Message Exchange Body containing the just added/updated payload is placed and sent.</li><li>in case of a CamelCacheDeleteAll operation, the Message Exchange Header CamelCacheKey and the Message Exchange Body are not populated.</li></ul><h4 id="BookInOnePage-CacheProcessors">Cache Processors</h4><p>There are a set of nice processors with the ability to perform cache lookups and selectively replace payload content at the</p><ul class="alternate"><li>body</li><li>token</li><li>xpath level</li></ul><h3 id="BookInOnePage-CacheUsageSamples">Cache Usage Samples</h3><h4 id="BookInOnePage-Example1:Configuringthecache">Example 1: Configuring the cache</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;cache://MyApplicationCache&amp;quot; + &amp;quot;?maxElementsInMemory=1000&amp;quot; + &amp;quot;&amp;amp;memoryStoreEvictionPolicy=&amp;quot; + &amp;quot;MemoryStoreEvictionPolicy.LFU&amp;quot; + &amp;quot;&amp;amp;overflowToDisk=true&amp;quot; + &amp;quot;&amp;amp;eternal=true&amp;quot; + &amp;quot;&amp;amp;timeToLiveSeconds=300&amp;quot; + &amp;quot;&amp;amp;timeToIdleSeconds=true&amp;quot; + &amp;quot;&amp;amp;diskPersistent=true&amp;quot; + &amp;quot;&amp;amp;diskExpiryThreadIntervalSeconds=300&amp;quot;) </script> 
 </div>
</div><h4 id="BookInOnePage-Example2:Addingkeystothecache">Example 2: Adding keys to the cache</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">RouteBuilder builder = new RouteBuilder() { public void configure() { from(&amp;quot;direct:start&amp;quot;) .setHeader(CacheConstants.CACHE_OPERATION, constant(CacheConstants.CACHE_OPERATION_ADD)) .setHeader(CacheConstants.CACHE_KEY, constant(&amp;quot;Ralph_Waldo_Emerson&amp;quot;)) .to(&amp;quot;cache://TestCache1&amp;quot;) } }; </script> 
 </div>
</div><h4 id="BookInOnePage-Example2:Updatingexistingkeysinacache">Example 2: Updating existing keys in a cache</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">RouteBuilder builder = new RouteBuilder() { public void configure() { from(&amp;quot;direct:start&amp;quot;) .setHeader(CacheConstants.CACHE_OPERATION, constant(CacheConstants.CACHE_OPERATION_UPDATE)) .setHeader(CacheConstants.CACHE_KEY, constant(&amp;quot;Ralph_Waldo_Emerson&amp;quot;)) .to(&amp;quot;cache://TestCache1&amp;quot;) } }; </script> 
 </div>
</div><h4 id="BookInOnePage-Example3:Deletingexistingkeysinacache">Example 3: Deleting existing keys in a cache</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">RouteBuilder builder = new RouteBuilder() { public void configure() { from(&amp;quot;direct:start&amp;quot;) .setHeader(CacheConstants.CACHE_OPERATION, constant(CacheConstants.CACHE_DELETE)) .setHeader(CacheConstants.CACHE_KEY&amp;quot;, constant(&amp;quot;Ralph_Waldo_Emerson&amp;quot;)) .to(&amp;quot;cache://TestCache1&amp;quot;) } }; </script> 
 </div>
</div><h4 id="BookInOnePage-Example4:Deletingallexistingkeysinacache">Example 4: Deleting all existing keys in a cache</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">RouteBuilder builder = new RouteBuilder() { public void configure() { from(&amp;quot;direct:start&amp;quot;) .setHeader(CacheConstants.CACHE_OPERATION, constant(CacheConstants.CACHE_DELETEALL)) .to(&amp;quot;cache://TestCache1&amp;quot;); } }; </script> 
 </div>
</div><h4 id="BookInOnePage-Example5:NotifyinganychangesregisteringinaCachetoProcessorsandotherProducers">Example 5: Notifying any changes registering in a Cache to Processors and other Producers</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">RouteBuilder builder = new RouteBuilder() { public void configure() { from(&amp;quot;cache://TestCache1&amp;quot;) .process(new Processor() { public void process(Exchange exchange) throws Exception { String operation = (String) exchange.getIn().getHeader(CacheConstants.CACHE_OPERATION); String key = (String) exchange.getIn().getHeader(CacheConstants.CACHE_KEY); Object body = exchange.getIn().getBody(); // Do something } }) } }; </script> 
 </div>
</div><h4 id="BookInOnePage-Example6:UsingProcessorstoselectivelyreplacepayloadwithcachevalues">Example 6: Using Processors to selectively replace payload with cache values</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">RouteBuilder builder = new RouteBuilder() { public void configure() { //Message Body Replacer from(&amp;quot;cache://TestCache1&amp;quot;) .filter(header(CacheConstants.CACHE_KEY).isEqualTo(&amp;quot;greeting&amp;quot;)) .process(new CacheBasedMessageBodyReplacer(&amp;quot;cache://TestCache1&amp;quot;,&amp;quot;farewell&amp;quot;)) .to(&amp;quot;direct:next&amp;quot;); //Message Token replacer from(&amp;quot;cache://TestCache1&amp;quot;) .filter(header(CacheConstants.CACHE_KEY).isEqualTo(&amp;quot;quote&amp;quot;)) .process(new CacheBasedTokenReplacer(&amp;quot;cache://TestCache1&amp;quot;,&amp;quot;novel&amp;quot;,&amp;quot;#novel#&amp;quot;)) .process(new CacheBasedTokenReplacer(&amp;quot;cache://TestCache1&amp;quot;,&amp;quot;author&amp;quot;,&amp;quot;#author#&amp;quot;)) .process(new CacheBasedTokenReplacer(&amp;quot;cache://TestCache1&amp;quot;,&amp;quot;number&amp;quot;,&amp;quot;#number#&amp;quot;)) .to(&amp;quot;direct:next&amp;quot;); //Message XPath replacer from(&amp;quot;cache://TestCache1&amp;quot;). .filter(header(CacheConstants.CACHE_KEY).isEqualTo(&amp;quot;XML_FRAGMENT&amp;quot;)) .process(new CacheBasedXPathReplacer(&amp;quot;cache://TestCache1&amp;quot;,&amp;quot;book1&amp;quot;,&amp;quot;/books/book1&amp;quot;)) .process (new CacheBasedXPathReplacer(&amp;quot;cache://TestCache1&amp;quot;,&amp;quot;book2&amp;quot;,&amp;quot;/books/book2&amp;quot;)) .to(&amp;quot;direct:next&amp;quot;); } }; </script> 
 </div>
</div><h4 id="BookInOnePage-Example7:GettinganentryfromtheCache">Example 7: Getting an entry from the Cache</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) // Prepare headers .setHeader(CacheConstants.CACHE_OPERATION, constant(CacheConstants.CACHE_OPERATION_GET)) .setHeader(CacheConstants.CACHE_KEY, constant(&amp;quot;Ralph_Waldo_Emerson&amp;quot;)). .to(&amp;quot;cache://TestCache1&amp;quot;). // Check if entry was not found .choice().when(header(CacheConstants.CACHE_ELEMENT_WAS_FOUND).isNull()). // If not found, get the payload and put it to cache .to(&amp;quot;cxf:bean:someHeavyweightOperation&amp;quot;). .setHeader(CacheConstants.CACHE_OPERATION, constant(CacheConstants.CACHE_OPERATION_ADD)) .setHeader(CacheConstants.CACHE_KEY, constant(&amp;quot;Ralph_Waldo_Emerson&amp;quot;)) .to(&amp;quot;cache://TestCache1&amp;quot;) .end() .to(&amp;quot;direct:nextPhase&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-Example8:CheckingforanentryintheCache">Example 8: Checking for an entry in the Cache</h4><p>Note: The CHECK command tests existence of an entry in the cache but doesn't place a message in the body.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) // Prepare headers .setHeader(CacheConstants.CACHE_OPERATION, constant(CacheConstants.CACHE_OPERATION_CHECK)) .setHeader(CacheConstants.CACHE_KEY, constant(&amp;quot;Ralph_Waldo_Emerson&amp;quot;)). .to(&amp;quot;cache://TestCache1&amp;quot;). // Check if entry was not found .choice().when(header(CacheConstants.CACHE_ELEMENT_WAS_FOUND).isNull()). // If not found, get the payload and put it to cache .to(&amp;quot;cxf:bean:someHeavyweightOperation&amp;quot;). .setHeader(CacheConstants.CACHE_OPERATION, constant(CacheConstants.CACHE_OPERATION_ADD)) .setHeader(CacheConstants.CACHE_KEY, constant(&amp;quot;Ralph_Waldo_Emerson&amp;quot;)) .to(&amp;quot;cache://TestCache1&amp;quot;) .end(); </script> 
 </div>
</div><h3 id="BookInOnePage-ManagementofEHCache">Management of EHCache</h3><p><a shape="rect" class="external-link" href="http://ehcache.org/" rel="nofollow">EHCache</a> has its own statistics and management from <a shape="rect" href="camel-jmx.html">JMX</a>.</p><p>Here's a snippet on how to expose them via JMX in a Spring application context:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;ehCacheManagementService&amp;quot; class=&amp;quot;net.sf.ehcache.management.ManagementService&amp;quot; init-method=&amp;quot;init&amp;quot; lazy-init=&amp;quot;false&amp;quot;&amp;gt; &amp;lt;constructor-arg&amp;gt; &amp;lt;bean class=&amp;quot;net.sf.ehcache.CacheManager&amp;quot; factory-method=&amp;quot;getInstance&amp;quot;/&amp;gt; &amp;lt;/constructor-arg&amp;gt; &amp;lt;constructor-arg&amp;gt; &amp;lt;bean class=&amp;quot;org.springframework.jmx.support.JmxUtils&amp;quot; factory-method=&amp;quot;locateMBeanServer&amp;quot;/&amp;gt; &amp;lt;/constructor-arg&amp;gt; &amp;lt;constructor-arg value=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;constructor-arg value=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;constructor-arg value=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;constructor-arg value=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>Of course you can do the same thing in straight Java:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">ManagementService.registerMBeans(CacheManager.getInstance(), mbeanServer, true, true, true, true); </script> 
 </div>
</div><p>You can get cache hits, misses, in-memory hits, disk hits, size stats this way. You can also change CacheConfiguration parameters on the fly.</p><h3 id="BookInOnePage-CachereplicationCamel2.8+">Cache replication Camel 2.8+</h3><p>The Camel Cache component is able to distribute a cache across server nodes using several different replication mechanisms including: RMI, JGroups, JMS and Cache Server.</p><p>There are two different ways to make it work:</p><p><strong>1.</strong> You can configure <code>ehcache.xml</code> manually</p><p>OR</p><p><strong>2.</strong> You can configure these three options:</p><ul class="alternate"><li>cacheManagerFactory</li><li>eventListenerRegistry</li><li>cacheLoaderRegistry</li></ul><p>Configuring Camel Cache replication using the first option is a bit of hard work as you have to configure all caches separately. So in a situation when the all names of caches are not known, using <code>ehcache.xml</code> is not a good idea.</p><p>The second option is much better when you want to use many different caches as you do not need to define options per cache. This is because replication options are set per <code>CacheManager</code> and per <code>CacheEndpoint</code>. Also it is the only way when cache names are not know at the development phase.</p><div class="confluence-information-macro confluence-information-macro-note">
 <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>It might be useful to read the <a shape="rect" class="external-link" href="http://ehcache.org/documentation" rel="nofollow">EHCache manual</a> to get a better understanding of the Camel Cache replication mechanism.</p>
 </div>
</div><h4 id="BookInOnePage-Example:JMScachereplication">Example: JMS cache replication</h4><p>JMS replication is the most powerful and secured replication method. Used together with Camel Cache replication makes it also rather simple.<br clear="none"> An example is available on <a shape="rect" href="cachereplicationjmsexample.html">a separate page</a>.</p><h2 id="BookInOnePage-ClassComponent">Class Component</h2><p><strong>Available as of Camel 2.4</strong></p><p>The <strong>class:</strong> component binds beans to Camel message exchanges. It works in the same way as the <a shape="rect" href="bean.html">Bean</a> component but instead of looking up beans from a <a shape="rect" href="registry.html">Registry</a> it creates the bean based on the class name.</p><h3 id="BookInOnePage-URIformat.7">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">class:className[?options] </script> 
 </div>
</div><p>Where <strong>className</strong> is the fully qualified class name to create and use as bean.</p><h3 id="BookInOnePage-Options.25">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>method</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The method name that bean will be invoked. If not provided, Camel will try to pick the method itself. In case of ambiguity an exception is thrown. See <a shape="rect" href="bean-binding.html">Bean Binding</a> for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>multiParameterArray</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>How to treat the parameters which are passed from the message body; if it is <code>true</code>, the In message body should be an array of parameters.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bean.xxx</code></p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17:</strong> To configure additional options on the create bean instance from the class name. For example to configure a foo option on the bean, use bean.foo=123.</p></td></tr></tbody></table> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Using.1">Using</h3><p>You simply use the <strong>class</strong> component just as the <a shape="rect" href="bean.html">Bean</a> component but by specifying the fully qualified classname instead.<br clear="none"> For example to use the <code>MyFooBean</code> you have to do as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;).to(&amp;quot;class:org.apache.camel.component.bean.MyFooBean&amp;quot;).to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>You can also specify which method to invoke on the <code>MyFooBean</code>, for example <code>hello</code>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;).to(&amp;quot;class:org.apache.camel.component.bean.MyFooBean?method=hello&amp;quot;).to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><h2 id="BookInOnePage-Settingpropertiesonthecreatedinstance">Setting properties on the created instance</h2><p>In the endpoint uri you can specify properties to set on the created instance, for example if it has a <code>setPrefix</code> method:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // Camel 2.17 onwards from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;class:org.apache.camel.component.bean.MyPrefixBean?bean.prefix=Bye&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); &nbsp; // Camel 2.16 and older&nbsp; from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;class:org.apache.camel.component.bean.MyPrefixBean?prefix=Bye&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>And you can also use the <code style="line-height: 1.42857;">#</code> syntax to refer to properties to be looked up in the <a shape="rect" href="registry.html">Registry</a>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // Camel 2.17 onwards from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;class:org.apache.camel.component.bean.MyPrefixBean?bean.cool=#foo&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); // Camel 2.16 and older from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;class:org.apache.camel.component.bean.MyPrefixBean?cool=#foo&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>Which will lookup a bean from the <a shape="rect" href="registry.html">Registry</a> with the id <code>foo</code> and invoke the <code>setCool</code> method on the created instance of the <code>MyPrefixBean</code> class.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">See more</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>See more details at the <a shape="rect" href="bean.html">Bean</a> component as the <strong>class</strong> component works in much the same way.</p>
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.26">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul><li><a shape="rect" href="bean.html">Bean</a></li><li><a shape="rect" href="bean-binding.html">Bean Binding</a></li><li><a shape="rect" href="bean-integration.html">Bean Integration</a></li></ul><h2 id="BookInOnePage-CometdComponent">Cometd Component</h2><p>The <strong>cometd:</strong> component is a transport for working with the <a shape="rect" class="external-link" href="http://www.mortbay.org/jetty" rel="nofollow">jetty</a> implementation of the <a shape="rect" class="external-link" href="http://docs.codehaus.org/display/JETTY/Cometd+%28aka+Bayeux%29" rel="nofollow">cometd/bayeux protocol</a>.<br clear="none"> Using this component in combination with the dojo toolkit library it's possible to push Camel messages directly into the browser using an AJAX based mechanism.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-cometd&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.8">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">cometd://host:port/channelName[?options] </script> 
 </div>
</div><p>The <strong>channelName</strong> represents a topic that can be subscribed to by the Camel endpoints.</p><h3 id="BookInOnePage-Examples.12">Examples</h3><div class="preformatted panel" style="border-width: 1px;">
 <div class="preformattedContent panelContent"> 
  <pre>cometd://localhost:8080/service/mychannel
cometds://localhost:8443/service/mychannel
</pre> 
 </div>
</div><p>where <code>cometds:</code> represents an SSL configured endpoint.</p><h3 id="BookInOnePage-Options.26">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>resourceBase</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The root directory for the web resources or classpath. Use the protocol file: or classpath: depending if you want that the component loads the resource from file system or classpath. Classpath is required for OSGI deployment where the resources are packaged in the jar. Notice this option has been renamed to <code>baseResource</code> from <strong>Camel 2.7</strong> onwards.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>baseResource</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.7:</strong> The root directory for the web resources or classpath. Use the protocol file: or classpath: depending if you want that the component loads the resource from file system or classpath. Classpath is required for OSGI deployment where the resources are packaged in the jar</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>timeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>240000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The server side poll timeout in milliseconds. This is how long the server will hold a reconnect request before responding.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>interval</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The client side poll timeout in milliseconds. How long a client will wait between reconnects</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxInterval</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>30000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The max client side poll timeout in milliseconds. A client will be removed if a connection is not received in this time.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>multiFrameInterval</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1500</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The client side poll timeout, if multiple connections are detected from the same browser.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>jsonCommented</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If <code>true</code>, the server will accept JSON wrapped in a comment and will generate JSON wrapped in a comment. This is a defence against Ajax Hijacking.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>logLevel</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code>=none, <code>1</code>=info, <code>2</code>=debug.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>crossOriginFilterOn</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> If <code>true</code>, the server will support for cross-domain filtering</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>allowedOrigins</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>*</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> The origins domain that support to cross, if the <code>crosssOriginFilterOn</code> is <code>true</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>filterPath</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> The filterPath will be used by the CrossOriginFilter, if the <code>crosssOriginFilterOn</code> is <code>true</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>disconnectLocalSession</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.5/2.11.1: (Producer only)</strong>: Whether to disconnect local sessions after publishing a message to its channel. Disconnecting local session is needed as they are not swept by default by CometD, and therefore you can run out of memory. In Camel 2.16.1/2.15.5 or older the default value is true. From newer versions the default value is false.</p></td></tr></tbody></table> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><p>Here is some examples on How to pass the parameters</p><p>For file (for webapp resources located in the Web Application directory --&gt; cometd://localhost:8080?resourceBase=file./webapp<br clear="none"> For classpath (when by example the web resources are packaged inside the webapp folder --&gt; cometd://localhost:8080?resourceBase=classpath:webapp</p><h3 id="BookInOnePage-Authentication">Authentication</h3><p><strong>Available as of Camel 2.8</strong></p><p>You can configure custom <code>SecurityPolicy</code> and <code>Extension</code>'s to the <code>CometdComponent</code> which allows you to use authentication as <a shape="rect" class="external-link" href="http://cometd.org/documentation/howtos/authentication" rel="nofollow">documented here</a></p><h3 id="BookInOnePage-SettingupSSLforCometdComponent">Setting up SSL for Cometd Component</h3><h4 id="BookInOnePage-UsingtheJSSEConfigurationUtility">Using the JSSE Configuration Utility</h4><p>As of Camel 2.9, the Cometd component supports SSL/TLS configuration through the <a shape="rect" href="camel-configuration-utilities.html">Camel JSSE Configuration Utility</a>.&#160; This utility greatly decreases the amount of component specific code you need to write and is configurable at the endpoint and component levels.&#160; The following examples demonstrate how to use the utility with the Cometd component. You need to configure SSL on the CometdComponent.</p><h5 id="BookInOnePage-Programmaticconfigurationofthecomponent">Programmatic configuration of the component</h5><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">KeyStoreParameters ksp = new KeyStoreParameters(); ksp.setResource(&amp;quot;/users/home/server/keystore.jks&amp;quot;); ksp.setPassword(&amp;quot;keystorePassword&amp;quot;); KeyManagersParameters kmp = new KeyManagersParameters(); kmp.setKeyStore(ksp); kmp.setKeyPassword(&amp;quot;keyPassword&amp;quot;); TrustManagersParameters tmp = new TrustManagersParameters(); tmp.setKeyStore(ksp); SSLContextParameters scp = new SSLContextParameters(); scp.setKeyManagers(kmp); scp.setTrustManagers(tmp); CometdComponent commetdComponent = getContext().getComponent(&amp;quot;cometds&amp;quot;, CometdComponent.class); commetdComponent.setSslContextParameters(scp); </script> 
 </div>
</div><h5 id="BookInOnePage-SpringDSLbasedconfigurationofendpoint">Spring DSL based configuration of endpoint</h5><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">... &amp;lt;camel:sslContextParameters id=&amp;quot;sslContextParameters&amp;quot;&amp;gt; &amp;lt;camel:keyManagers keyPassword=&amp;quot;keyPassword&amp;quot;&amp;gt; &amp;lt;camel:keyStore resource=&amp;quot;/users/home/server/keystore.jks&amp;quot; password=&amp;quot;keystorePassword&amp;quot;/&amp;gt; &amp;lt;/camel:keyManagers&amp;gt; &amp;lt;camel:trustManagers&amp;gt; &amp;lt;camel:keyStore resource=&amp;quot;/users/home/server/keystore.jks&amp;quot; password=&amp;quot;keystorePassword&amp;quot;/&amp;gt; &amp;lt;/camel:keyManagers&amp;gt; &amp;lt;/camel:sslContextParameters&amp;gt;... &nbsp; &amp;lt;bean id=&amp;quot;cometd&amp;quot; class=&amp;quot;org.apache.camel.component.cometd.CometdComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;sslContextParameters&amp;quot; ref=&amp;quot;sslContextParameters&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; ... &amp;lt;to uri=&amp;quot;cometds://127.0.0.1:443/service/test?baseResource=file:./target/test-classes/webapp&amp;amp;timeout=240000&amp;amp;interval=0&amp;amp;maxInterval=30000&amp;amp;multiFrameInterval=1500&amp;amp;jsonCommented=true&amp;amp;logLevel=2&amp;quot;/&amp;gt;... </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.27">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-ContextComponent">Context Component</h2><p><strong>Available as of Camel 2.7</strong></p><p>The <strong>context</strong> component allows you to create new Camel Components from a CamelContext with a number of routes which is then treated as a black box, allowing you to refer to the local endpoints within the component from other CamelContexts.</p><p>It is similar to the <a shape="rect" href="routebox.html">Routebox</a> component in idea, though the Context component tries to be really simple for end users; just a simple convention over configuration approach to refer to local endpoints inside the CamelContext Component.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-context&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.9">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> context:camelContextId:localEndpointName[?options] </script> 
 </div>
</div><p>Or you can omit the "context:" prefix.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> camelContextId:localEndpointName[?options] </script> 
 </div>
</div><ul><li><strong>camelContextId</strong> is the ID you used to register the CamelContext into the <a shape="rect" href="registry.html">Registry</a>.</li><li><strong>localEndpointName</strong> can be a valid Camel URI evaluated within the black box CamelContext. Or it can be a logical name which is mapped to any local endpoints. For example if you locally have endpoints like <strong>direct:invoices</strong> and <strong>seda:purchaseOrders</strong> inside a CamelContext of id <strong>supplyChain</strong>, then you can just use the URIs <strong>supplyChain:invoices</strong> or <strong>supplyChain:purchaseOrders</strong> to omit the physical endpoint kind and use pure logical URIs.</li></ul><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Example.19">Example</h3><p>In this example we'll create a black box context, then we'll use it from another CamelContext.</p><h4 id="BookInOnePage-Definingthecontextcomponent">Defining the context component</h4><p>First you need to create a CamelContext, add some routes in it, start it and then register the CamelContext into the <a shape="rect" href="registry.html">Registry</a> (JNDI, Spring, Guice or OSGi etc).</p><p>This can be done in the usual Camel way from this <a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/components/camel-context/src/test/java/org/apache/camel/component/context/JavaDslBlackBoxTest.java?revision=1069442&amp;view=markup">test case</a> (see the createRegistry() method); this example shows Java and JNDI being used...</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // lets create our black box as a camel context and a set of routes DefaultCamelContext blackBox = new DefaultCamelContext(registry); blackBox.setName(&amp;quot;blackBox&amp;quot;); blackBox.addRoutes(new RouteBuilder() { @Override public void configure() throws Exception { // receive purchase orders, lets process it in some way then send an invoice // to our invoice endpoint from(&amp;quot;direct:purchaseOrder&amp;quot;). setHeader(&amp;quot;received&amp;quot;).constant(&amp;quot;true&amp;quot;). to(&amp;quot;direct:invoice&amp;quot;); } }); blackBox.start(); registry.bind(&amp;quot;accounts&amp;quot;, blackBox); </script> 
 </div>
</div><p>Notice in the above route we are using pure local endpoints (<strong>direct</strong> and <strong>seda</strong>). Also note we expose this CamelContext using the <strong>accounts</strong> ID. We can do the same thing in Spring via</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext id=&amp;quot;accounts&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:purchaseOrder&amp;quot;/&amp;gt; ... &amp;lt;to uri=&amp;quot;direct:invoice&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-Usingthecontextcomponent">Using the context component</h4><p>Then in another CamelContext we can then refer to this "accounts black box" by just sending to <strong>accounts:purchaseOrder</strong> and consuming from <strong>accounts:invoice</strong>.</p><p>If you prefer to be more verbose and explicit you could use <strong>context:accounts:purchaseOrder</strong> or even <strong>context:accounts:direct://purchaseOrder</strong> if you prefer. But using logical endpoint URIs is preferred as it hides the implementation detail and provides a simple logical naming scheme.</p><p>For example if we wish to then expose this accounts black box on some middleware (outside of the black box) we can do things like...</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;!-- consume from an ActiveMQ into the black box --&amp;gt; &amp;lt;from uri=&amp;quot;activemq:Accounts.PurchaseOrders&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;accounts:purchaseOrders&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;!-- lets send invoices from the black box to a different ActiveMQ Queue --&amp;gt; &amp;lt;from uri=&amp;quot;accounts:invoice&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;activemq:UK.Accounts.Invoices&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-Namingendpoints">Naming endpoints</h4><p>A context component instance can have many public input and output endpoints that can be accessed from outside it's CamelContext. When there are many it is recommended that you use logical names for them to hide the middleware as shown above.</p><p>However when there is only one input, output or error/dead letter endpoint in a component we recommend using the common posix shell names <strong>in</strong>, <strong>out</strong> and <strong>err</strong></p><h2 id="BookInOnePage-CryptocomponentforDigitalSignatures">Crypto component for Digital Signatures</h2><p><strong>Available as of Camel 2.3</strong></p><p>With Camel cryptographic endpoints and Java's Cryptographic extension it is easy to create Digital Signatures for <a shape="rect" href="exchange.html">Exchange</a>s. Camel provides a pair of flexible endpoints which get used in concert to create a signature for an exchange in one part of the exchange's workflow and then verify the signature in a later part of the workflow.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-crypto&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Introduction.6">Introduction</h3><p>Digital signatures make use of Asymmetric Cryptographic techniques to sign messages. From a (very) high level, the algorithms use pairs of complimentary keys with the special property that data encrypted with one key can only be decrypted with the other. One, the private key, is closely guarded and used to 'sign' the message while the other, public key, is shared around to anyone interested in verifying the signed messages. Messages are signed by using the private key to encrypting a digest of the message. This encrypted digest is transmitted along with the message. On the other side the verifier recalculates the message digest and uses the public key to decrypt the the digest in the signature. If both digests match the verifier knows only the holder of the private key could have created the signature.</p><p>Camel uses the Signature service from the Java Cryptographic Extension to do all the heavy cryptographic lifting required to create exchange signatures. The following are some excellent resources for explaining the mechanics of Cryptography, Message digests and Digital Signatures and how to leverage them with the JCE.</p><ul class="alternate"><li>Bruce Schneier's Applied Cryptography</li><li>Beginning Cryptography with Java by David Hook</li><li>The ever insightful Wikipedia <a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/Digital_signature" rel="nofollow">Digital_signatures</a></li></ul><h3 id="BookInOnePage-URIformat.10">URI format</h3><p>As mentioned Camel provides a pair of crypto endpoints to create and verify signatures</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">crypto:sign:name[?options] crypto:verify:name[?options] </script> 
 </div>
</div><ul><li><code>crypto:sign</code> creates the signature and stores it in the Header keyed by the constant <code>org.apache.camel.component.crypto.DigitalSignatureConstants.SIGNATURE</code>, i.e. <code>"CamelDigitalSignature"</code>.</li><li><code>crypto:verify</code> will read in the contents of this header and do the verification calculation.</li></ul><p>In order to correctly function, the sign and verify process needs a pair of keys to be shared, signing requiring a <code>PrivateKey</code> and verifying a <code>PublicKey</code> (or a <code>Certificate</code> containing one). Using the JCE it is very simple to generate these key pairs but it is usually most secure to use a KeyStore to house and share your keys. The DSL is very flexible about how keys are supplied and provides a number of mechanisms.</p><p>Note a <code>crypto:sign</code> endpoint is typically defined in one route and the complimentary <code>crypto:verify</code> in another, though for simplicity in the examples they appear one after the other. It goes without saying that both signing and verifying should be configured identically.</p><h3 id="BookInOnePage-Options.27">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>algorithm</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>SHA1WithDSA</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The name of the JCE Signature algorithm that will be used.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>alias</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>An alias name that will be used to select a key from the keystore.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bufferSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Integer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>2048</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the size of the buffer used in the signature process.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>certificate</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Certificate</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A Certificate used to verify the signature of the exchange's payload. Either this or a Public Key is required.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>keystore</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>KeyStore</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A reference to a JCE Keystore that stores keys and certificates used to sign and verify.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">keyStoreParameters <strong>Camel 2.14.1</strong></td><td colspan="1" rowspan="1" class="confluenceTd">KeyStoreParameters</td><td colspan="1" rowspan="1" class="confluenceTd">null</td><td colspan="1" rowspan="1" class="confluenceTd">A reference to a Camel KeyStoreParameters Object which wraps a Java KeyStore Object</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>provider</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The name of the JCE Security Provider that should be used.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>privateKey</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>PrivateKey</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The private key used to sign the exchange's payload.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>publicKey</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>PublicKey</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The public key used to verify the signature of the exchange's payload.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>secureRandom</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>secureRandom</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A reference to a <code>SecureRandom</code> object that will be used to initialize the Signature service.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>password</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>char[]</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The password to access the private key from the keystore</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>clearHeaders</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Remove camel crypto headers from Message after a verify operation (value can be <code>"true"</code>/<code>"false"</code>).</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Using.2">Using</h3><h4 id="BookInOnePage-1)Rawkeys">1) Raw keys</h4><p>The most basic way to way to sign and verify an exchange is with a KeyPair as follows.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:keypair&amp;quot;).to(&amp;quot;crypto:sign:basic?privateKey=#myPrivateKey&amp;quot;, &amp;quot;crypto:verify:basic?publicKey=#myPublicKey&amp;quot;, &amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>The same can be achieved with the <a shape="rect" href="spring-xml-extensions.html">Spring XML Extensions</a> using references to keys
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:keypair&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;crypto:sign:basic?privateKey=#myPrivateKey&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;crypto:verify:basic?publicKey=#myPublicKey&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div><h4 id="BookInOnePage-2)KeyStoresandAliases.">2) KeyStores and Aliases.</h4><p>The JCE provides a very versatile keystore concept for housing pairs of private keys and certificates, keeping them encrypted and password protected. They can be retrieved by applying an alias to the retrieval APIs. There are a number of ways to get keys and Certificates into a keystore, most often this is done with the external 'keytool' application. <a shape="rect" class="external-link" href="http://www.exampledepot.com/egs/java.security.cert/CreateCert.html" rel="nofollow">This</a> is a good example of using keytool to create a KeyStore with a self signed Cert and Private key.</p><p>The examples use a Keystore with a key and cert aliased by 'bob'. The password for the keystore and the key is 'letmein'</p><p>The following shows how to use a Keystore via the Fluent builders, it also shows how to load and initialize the keystore.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:keystore&amp;quot;).to(&amp;quot;crypto:sign:keystore?keystore=#keystore&amp;amp;alias=bob&amp;amp;password=letmein&amp;quot;, &amp;quot;crypto:verify:keystore?keystore=#keystore&amp;amp;alias=bob&amp;quot;, &amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>Again in Spring a ref is used to lookup an actual keystore instance.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:keystore&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;crypto:sign:keystore?keystore=#keystore&amp;amp;amp;alias=bob&amp;amp;amp;password=letmein&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;crypto:verify:keystore?keystore=#keystore&amp;amp;amp;alias=bob&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div><h4 id="BookInOnePage-3)ChangingJCEProviderandAlgorithm">3) Changing JCE Provider and Algorithm</h4><p>Changing the Signature algorithm or the Security provider is a simple matter of specifying their names. You will need to also use Keys that are compatible with the algorithm you choose.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> keyPair = getKeyPair(&amp;quot;RSA&amp;quot;); PrivateKey privateKey = keyPair.getPrivate(); PublicKey publicKey = keyPair.getPublic(); // we can set the keys explicitly on the endpoint instances. context.getEndpoint(&amp;quot;crypto:sign:rsa?algorithm=MD5withRSA&amp;quot;, DigitalSignatureEndpoint.class).setPrivateKey(privateKey); context.getEndpoint(&amp;quot;crypto:verify:rsa?algorithm=MD5withRSA&amp;quot;, DigitalSignatureEndpoint.class).setPublicKey(publicKey); from(&amp;quot;direct:algorithm&amp;quot;).to(&amp;quot;crypto:sign:rsa?algorithm=MD5withRSA&amp;quot;, &amp;quot;crypto:verify:rsa?algorithm=MD5withRSA&amp;quot;, &amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:provider&amp;quot;).to(&amp;quot;crypto:sign:provider?privateKey=#myPrivateKey&amp;amp;provider=SUN&amp;quot;, &amp;quot;crypto:verify:provider?publicKey=#myPublicKey&amp;amp;provider=SUN&amp;quot;, &amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>or
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:algorithm&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;crypto:sign:rsa?algorithm=MD5withRSA&amp;amp;amp;privateKey=#rsaPrivateKey&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;crypto:verify:rsa?algorithm=MD5withRSA&amp;amp;amp;publicKey=#rsaPublicKey&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:provider&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;crypto:sign:provider?privateKey=#myPrivateKey&amp;amp;amp;provider=SUN&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;crypto:verify:provider?publicKey=#myPublicKey&amp;amp;amp;provider=SUN&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div><h4 id="BookInOnePage-4)ChangingtheSignatureMessageHeader">4) Changing the Signature Message Header</h4><p>It may be desirable to change the message header used to store the signature. A different header name can be specified in the route definition as follows
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:signature-header&amp;quot;).to(&amp;quot;crypto:sign:another?privateKey=#myPrivateKey&amp;amp;signatureHeader=AnotherDigitalSignature&amp;quot;, &amp;quot;crypto:verify:another?publicKey=#myPublicKey&amp;amp;signatureHeader=AnotherDigitalSignature&amp;quot;, &amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>or
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:signature-header&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;crypto:sign:another?privateKey=#myPrivateKey&amp;amp;amp;signatureHeaderName=AnotherDigitalSignature&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;crypto:verify:another?publicKey=#myPublicKey&amp;amp;amp;signatureHeaderName=AnotherDigitalSignature&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div><h4 id="BookInOnePage-5)Changingthebuffersize">5) Changing the buffersize</h4><p>In case you need to update the size of the buffer...
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:buffersize&amp;quot;).to(&amp;quot;crypto:sign:buffer?privateKey=#myPrivateKey&amp;amp;buffersize=1024&amp;quot;, &amp;quot;crypto:verify:buffer?publicKey=#myPublicKey&amp;amp;buffersize=1024&amp;quot;, &amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>or
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:buffersize&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;crypto:sign:buffer?privateKey=#myPrivateKey&amp;amp;amp;bufferSize=1024&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;crypto:verify:buffer?publicKey=#myPublicKey&amp;amp;amp;bufferSize=1024&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div><h4 id="BookInOnePage-6)SupplyingKeysdynamically.">6) Supplying Keys dynamically.</h4><p>When using a Recipient list or similar EIP the recipient of an exchange can vary dynamically. Using the same key across all recipients may be neither feasible nor desirable. It would be useful to be able to specify signature keys dynamically on a per-exchange basis. The exchange could then be dynamically enriched with the key of its target recipient prior to signing. To facilitate this the signature mechanisms allow for keys to be supplied dynamically via the message headers below</p><ul><li><code>Exchange.SIGNATURE_PRIVATE_KEY</code>, <code>"CamelSignaturePrivateKey"</code></li><li><code>Exchange.SIGNATURE_PUBLIC_KEY_OR_CERT</code>, <code>"CamelSignaturePublicKeyOrCert"</code></li></ul><p>
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:headerkey-sign&amp;quot;).to(&amp;quot;crypto:sign:alias&amp;quot;); from(&amp;quot;direct:headerkey-verify&amp;quot;).to(&amp;quot;crypto:verify:alias&amp;quot;, &amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>or
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:headerkey-sign&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;crypto:sign:headerkey&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:headerkey-verify&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;crypto:verify:headerkey&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div>Even better would be to dynamically supply a keystore alias. Again the alias can be supplied in a message header<ul><li><code>Exchange.KEYSTORE_ALIAS</code>, <code>"CamelSignatureKeyStoreAlias"</code></li></ul><p>
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:alias-sign&amp;quot;).to(&amp;quot;crypto:sign:alias?keystore=#keystore&amp;quot;); from(&amp;quot;direct:alias-verify&amp;quot;).to(&amp;quot;crypto:verify:alias?keystore=#keystore&amp;quot;, &amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>or
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:alias-sign&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;crypto:sign:alias?keystore=#keystore&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:alias-verify&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;crypto:verify:alias?keystore=#keystore&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div>The header would be set as follows<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Exchange unsigned = getMandatoryEndpoint(&amp;quot;direct:alias-sign&amp;quot;).createExchange(); unsigned.getIn().setBody(payload); unsigned.getIn().setHeader(DigitalSignatureConstants.KEYSTORE_ALIAS, &amp;quot;bob&amp;quot;); unsigned.getIn().setHeader(DigitalSignatureConstants.KEYSTORE_PASSWORD, &amp;quot;letmein&amp;quot;.toCharArray()); template.send(&amp;quot;direct:alias-sign&amp;quot;, unsigned); Exchange signed = getMandatoryEndpoint(&amp;quot;direct:alias-sign&amp;quot;).createExchange(); signed.getIn().copyFrom(unsigned.getOut()); signed.getIn().setHeader(KEYSTORE_ALIAS, &amp;quot;bob&amp;quot;); template.send(&amp;quot;direct:alias-verify&amp;quot;, signed); </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.28">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul><li><a shape="rect" href="crypto.html">Crypto</a> Crypto is also available as a <a shape="rect" href="data-format.html">Data Format</a></li></ul><h2 id="BookInOnePage-CXFComponent">CXF Component</h2><div class="confluence-information-macro confluence-information-macro-note">
 <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>When using CXF as a consumer, the <a shape="rect" href="cxf-bean-component.html">CXF Bean Component</a> allows you to factor out how message payloads are received from their processing as a RESTful or SOAP web service. This has the potential of using a multitude of transports to consume web services. The bean component's configuration is also simpler and provides the fastest method to implement web services using Camel and CXF.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>When using CXF in streaming modes (see DataFormat option), then also read about <a shape="rect" href="stream-caching.html">Stream caching</a>.</p>
 </div>
</div><p>The <strong>cxf:</strong> component provides integration with <a shape="rect" href="http://cxf.apache.org">Apache CXF</a> for connecting to JAX-WS services hosted in CXF.</p><p><style type="text/css">/**/ div.rbtoc1480069174922 {padding: 0px;} div.rbtoc1480069174922 ul {list-style: disc;margin-left: 0px;} div.rbtoc1480069174922 li {margin-left: 0px;padding-left: 0px;} /**/</style>
 </p><div class="toc-macro rbtoc1480069174922"> 
  <ul class="toc-indentation"><li><a shape="rect" href="#BookInOnePage-CXFComponent">CXF Component</a> 
    <ul class="toc-indentation"><li><a shape="rect" href="#BookInOnePage-URIformat">URI format</a></li><li><a shape="rect" href="#BookInOnePage-Options">Options</a> 
      <ul class="toc-indentation"><li><a shape="rect" href="#BookInOnePage-Thedescriptionsofthedataformats">The descriptions of the dataformats</a> 
        <ul class="toc-indentation"><li><a shape="rect" href="#BookInOnePage-HowtoenableCXF'sLoggingOutInterceptorinMESSAGEmode">How to enable CXF's LoggingOutInterceptor in MESSAGE mode</a></li></ul> </li><li><a shape="rect" href="#BookInOnePage-DescriptionofrelayHeadersoption">Description of relayHeaders option</a> 
        <ul class="toc-indentation"><li><a shape="rect" href="#BookInOnePage-AvailableonlyinPOJOmode">Available only in POJO mode</a></li><li><a shape="rect" href="#BookInOnePage-ChangessinceRelease2.0">Changes since Release 2.0</a></li></ul> </li></ul> </li><li><a shape="rect" href="#BookInOnePage-ConfiguretheCXFendpointswithSpring">Configure the CXF endpoints with Spring</a></li><li><a shape="rect" href="#BookInOnePage-ConfiguringtheCXFEndpointswithApacheAriesBlueprint.">Configuring the CXF Endpoints with Apache Aries Blueprint.</a></li><li><a shape="rect" href="#BookInOnePage-Howtomakethecamel-cxfcomponentuselog4jinsteadofjava.util.logging">How to make the camel-cxf component use log4j instead of java.util.logging</a></li><li><a shape="rect" href="#BookInOnePage-Howtoletcamel-cxfresponsemessagewithxmlstartdocument">How to let camel-cxf response message with xml start document</a></li><li><a shape="rect" href="#BookInOnePage-HowtooverridetheCXFproduceraddressfrommessageheader">How to override the CXF producer address from message header</a></li><li><a shape="rect" href="#BookInOnePage-Howtoconsumeamessagefromacamel-cxfendpointinPOJOdataformat">How to consume a message from a camel-cxf endpoint in POJO data format</a></li><li><a shape="rect" href="#BookInOnePage-Howtopreparethemessageforthecamel-cxfendpointinPOJOdataformat">How to prepare the message for the camel-cxf endpoint in POJO data format</a></li><li><a shape="rect" href="#BookInOnePage-Howtodealwiththemessageforacamel-cxfendpointinPAYLOADdataformat">How to deal with the message for a camel-cxf endpoint in PAYLOAD data format</a></li><li><a shape="rect" href="#BookInOnePage-HowtogetandsetSOAPheadersinPOJOmode">How to get and set SOAP headers in POJO mode</a></li><li><a shape="rect" href="#BookInOnePage-HowtogetandsetSOAPheadersinPAYLOADmode">How to get and set SOAP headers in PAYLOAD mode</a></li><li><a shape="rect" href="#BookInOnePage-SOAPheadersarenotavailableinMESSAGEmode">SOAP headers are not available in MESSAGE mode</a></li><li><a shape="rect" href="#BookInOnePage-HowtothrowaSOAPFaultfromCamel">How to throw a SOAP Fault from Camel</a></li><li><a shape="rect" href="#BookInOnePage-Howtopropagateacamel-cxfendpoint'srequestandresponsecontext">How to propagate a camel-cxf endpoint's request and response context</a></li><li><a shape="rect" href="#BookInOnePage-AttachmentSupport">Attachment Support</a></li><li><a shape="rect" href="#BookInOnePage-StreamingSupportinPAYLOADmode">Streaming Support in PAYLOAD mode</a></li><li><a shape="rect" href="#BookInOnePage-UsingthegenericCXFDispatchmode">Using the generic CXF Dispatch mode</a></li><li><a shape="rect" href="#BookInOnePage-SeeAlso">See Also</a></li></ul> </li></ul> 
 </div><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-cxf&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">CXF dependencies</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>If you want to learn about CXF dependencies you can checkout the <code><a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/cxf/trunk/distribution/src/main/release/lib/WHICH_JARS">WHICH-JARS</a></code> text file.</p>
 </div>
</div><h3 id="BookInOnePage-URIformat.11">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">cxf:bean:cxfEndpoint[?options] </script> 
 </div>
</div><p>Where <strong>cxfEndpoint</strong> represents a bean ID that references a bean in the Spring bean registry. With this URI format, most of the endpoint details are specified in the bean definition.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">cxf://someAddress[?options] </script> 
 </div>
</div><p>Where <strong>someAddress</strong> specifies the CXF endpoint's address. With this URI format, most of the endpoint details are specified using options.</p><p>For either style above, you can append options to the URI as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">cxf:bean:cxfEndpoint?wsdlURL=wsdl/hello_world.wsdl&amp;amp;dataFormat=PAYLOAD </script> 
 </div>
</div><h3 id="BookInOnePage-Options.28">Options</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Required</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>wsdlURL</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The location of the WSDL. It is obtained from endpoint address by default. <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Example</em>: <a shape="rect" class="external-link" href="file://local/wsdl/hello.wsdl" rel="nofollow">file://local/wsdl/hello.wsdl</a> or <code>wsdl/hello.wsdl</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>serviceClass</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Yes</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The name of the SEI (Service Endpoint Interface) class. This class can have, but does not require, JSR181 annotations. <br clear="none" class="atl-forced-newline"> This option is only required by POJO mode. If the wsdlURL option is provided, serviceClass is not required for PAYLOAD and MESSAGE mode. When wsdlURL option is used without serviceClass, the serviceName and portName (endpointName for Spring configuration) options <strong>MUST</strong> be provided. It is possible to use <code>#</code> notation to reference a <code>serviceClass</code> object instance from the registry. E.g. <code>serviceClass=#beanName</code>. The <code>serviceClass</code> for a CXF producer (that is, the <code>to</code> endpoint) should be a Java interface.<br clear="none" class="atl-forced-newline"> <strong>Since 2.8,</strong> it is possible to omit both wsdlURL and serviceClass options for PAYLOAD and MESSAGE mode. When they are omitted, arbitrary XML elements can be put in CxfPayload's body in PAYLOAD mode to facilitate CXF Dispatch Mode. <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> Please be advised that the <strong>referenced object cannot be a Proxy</strong> (Spring AOP Proxy is OK) as it relies on <code>Object.getClass().getName()</code> method for non Spring AOP Proxy. <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Example</em>: <code>org.apache.camel.Hello</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>serviceName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The service name this service is implementing, it maps to the <code>wsdl:service@name</code>. <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <strong>Required</strong> for camel-cxf consumer since camel-2.2.0 or if more than one <code>serviceName</code> is present in WSDL. <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Example</em>: {http:&#173;//org.apache.camel}ServiceName</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>endpointName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The port name this service is implementing, it maps to the <code>wsdl:port@name</code>. <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <strong>Required</strong> for camel-cxf consumer since camel-2.2.0 or if more than one <code>portName</code> is present under <code>serviceName</code>. <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Example</em>: {http:&#173;//org.apache.camel}PortName</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>dataFormat</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The data type messages supported by the CXF endpoint. <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Default</em>: <code>POJO</code> <br clear="none" class="atl-forced-newline"> <em>Example</em>: <code>POJO</code>, <code>PAYLOAD</code>, <code>MESSAGE</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>relayHeaders</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Please see the <strong>Description of</strong> <code><strong>relayHeaders</strong></code> <strong>option</strong> section for this option. Should a CXF endpoint relay headers along the route. Currently only available when <code>dataFormat=POJO</code> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Default</em>: <code>true</code> <br clear="none" class="atl-forced-newline"> <em>Example</em>: <code>true</code>, <code>false</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>wrapped</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Which kind of operation that CXF endpoint producer will invoke <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Default</em>: <code>false</code> <br clear="none" class="atl-forced-newline"> <em>Example</em>: <code>true</code>, <code>false</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>wrappedStyle</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>New in 2.5.0</strong> The WSDL style that describes how parameters are represented in the SOAP body. If the value is false, CXF will chose the document-literal unwrapped style, If the value is true, CXF will chose the document-literal wrapped style <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Default</em>: <code>Null</code> <br clear="none" class="atl-forced-newline"> <em>Example</em>: <code>true</code>, <code>false</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>setDefaultBus</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Deprecated</strong> Will set the default bus when CXF endpoint create a bus by itself. This option is deprecated use defaultBus from Camel 2.16 onwards.<br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Default</em>: <code>false</code> <br clear="none" class="atl-forced-newline"> <em>Example</em>: <code>true</code>, <code>false</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><span><code>defaultBus</code><br clear="none"></span></td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd"><p><span><strong>Camel 2.16:</strong> Will set the default bus when CXF endpoint create a bus by itself </span></p><p><span><span>&#160;</span><em>Default</em><span>: </span><code>false</code><span>&#160;</span><br clear="none" class="atl-forced-newline"><span>&#160;</span><em>Example</em><span>: </span><code>true</code><span>, </span><code>false</code></span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bus</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A default bus created by CXF Bus Factory. Use <code>#</code> notation to reference a bus object from the registry. The referenced object must be an instance of <code>org.apache.cxf.Bus</code>. <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Example</em>: <code>bus=#busName</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cxfBinding</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Use <code>#</code> notation to reference a CXF binding object from the registry. The referenced object must be an instance of <code>org.apache.camel.component.cxf.CxfBinding</code> (use an instance of <code>org.apache.camel.component.cxf.DefaultCxfBinding</code>). <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Example</em>: <code>cxfBinding=#bindingName</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>headerFilterStrategy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Use <code>#</code> notation to reference a header filter strategy object from the registry. The referenced object must be an instance of <code>org.apache.camel.spi.HeaderFilterStrategy</code> (use an instance of <code>org.apache.camel.component.cxf.CxfHeaderFilterStrategy</code>). <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Example</em>: <code>headerFilterStrategy=#strategyName</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>loggingFeatureEnabled</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>New in 2.3. This option enables CXF Logging Feature which writes inbound and outbound SOAP messages to log. <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Default</em>: <code>false</code> <br clear="none" class="atl-forced-newline"> <em>Example</em>: <code>loggingFeatureEnabled</code><code>=true</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>defaultOperationName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>New in 2.4, this option will set the default operationName that will be used by the CxfProducer which invokes the remote service. <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Default</em>: <code>null</code> <br clear="none" class="atl-forced-newline"> <em>Example</em>: <code>defaultOperationName</code><code>=greetMe</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>defaultOperationNamespace</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>New in 2.4. This option will set the default operationNamespace that will be used by the CxfProducer which invokes the remote service. <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Default</em>: <code>null</code> <br clear="none" class="atl-forced-newline"> <em>Example</em>: <code>defaultOperationNamespace</code><code>=</code><code><a shape="rect" class="external-link" href="http://apache.org/hello_world_soap_http">http://apache.org/hello_world_soap_http</a></code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>synchronous</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>New in 2.5. This option will let cxf endpoint decide to use sync or async API to do the underlying work. The default value is false which means camel-cxf endpoint will try to use async API by default. <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Default</em>: <code>false</code> <br clear="none" class="atl-forced-newline"> <em>Example</em>: synchronous=true</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>publishedEndpointUrl</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>New in 2.5. This option can override the endpointUrl that published from the WSDL which can be accessed with service address url plus ?wsdl. <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Default</em>: <code>null</code> <br clear="none" class="atl-forced-newline"> <em>Example</em>: publshedEndpointUrl=<a shape="rect" class="external-link" href="http://example.com/service" rel="nofollow">http://example.com/service</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>properties.XXX</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> Allows to set custom properties to CXF in the endpoint uri. For example setting <code>properties.mtom-enabled=true</code> to enable MTOM. <code style="line-height: 1.4285715;">properties.org.apache.cxf.interceptor.OneWayProcessorInterceptor.USE_ORIGINAL_THREAD=true </code><span style="line-height: 1.4285715;">just make sure the CXF doesn't switch the thread when start the invocation.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>allowStreaming</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>New in <strong>Camel 2.8.2</strong>. This option controls whether the CXF component, when running in PAYLOAD mode (see below), will DOM parse the incoming messages into DOM Elements or keep the payload as a javax.xml.transform.Source object that would allow streaming in some cases.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>skipFaultLogging</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>New in <strong>Camel 2.11</strong>. This option controls whether the PhaseInterceptorChain skips logging the Fault that it catches.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="line-height: 1.4285715;"><code>cxfEndpointConfigurer</code><br clear="none"></span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>New in <strong>Camel 2.11</strong>. This option could apply the implementation of <code><span>org.apache.camel.component.cxf.CxfEndpointConfigurer which </span></code><span>supports to configure the CXF endpoint in </span><span>&#160;programmatic way. </span><span style="line-height: 1.4285715;">Since </span><strong style="line-height: 1.4285715;">Camel 2.15.0, </strong>user can configure the CXF server and client by implementing configure{Server|Client} method of <span><code>CxfEndpointConfigurer</code>.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>username</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>New in <strong>Camel 2.12.3</strong> This option is used to set the basic authentication information of username for the CXF client.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>password</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>New in <strong>Camel 2.12.3</strong> This option is used to set the basic authentication information of password for the CXF client.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>continuationTimeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>New in <strong>Camel 2.14.0 </strong>This option is used to set the CXF continuation timeout which could be used in CxfConsumer by default when the CXF server is using Jetty or Servlet transport. (Before <strong>Camel 2.14.0</strong>, CxfConsumer just set the continuation timeout to be 0, which means the continuation suspend operation never timeout.)</p><p><em> Default</em>: <span style="font-family: monospace;">30000</span><br clear="none" class="atl-forced-newline">&#160;<em>Example</em>: continuation=80000</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>cookieHandler</code></td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd">New in<strong> Camel 2.19.0:</strong> Configure a cookie handler to maintain a HTTP session</td></tr></tbody></table>
</div><p>The <code>serviceName</code> and <code>portName</code> are <a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/QName" rel="nofollow">QNames</a>, so if you provide them be sure to prefix them with their {namespace} as shown in the examples above.</p><h4 id="BookInOnePage-Thedescriptionsofthedataformats">The descriptions of the dataformats</h4><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>DataFormat</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>POJO</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>POJOs (Plain old Java objects) are the Java parameters to the method being invoked on the target server. Both Protocol and Logical JAX-WS handlers are supported.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>PAYLOAD</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>PAYLOAD</code> is the message payload (the contents of the <code>soap:body</code>) after message configuration in the CXF endpoint is applied. Only Protocol JAX-WS handler is supported. Logical JAX-WS handler is not supported.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>MESSAGE</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>MESSAGE</code> is the raw message that is received from the transport layer. It is not suppose to touch or change Stream, some of the CXF interceptors will be removed if you are using this kind of DataFormat so you can't see any soap headers after the camel-cxf consumer and JAX-WS handler is not supported.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CXF_MESSAGE</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>New in <strong>Camel 2.8.2</strong>, <code>CXF_MESSAGE</code> allows for invoking the full capabilities of CXF interceptors by converting the message from the transport layer into a raw SOAP message</p></td></tr></tbody></table>
</div><p>You can determine the data format mode of an exchange by retrieving the exchange property, <code>CamelCXFDataFormat</code>. The exchange key constant is defined in <code>org.apache.camel.component.cxf.CxfConstants.DATA_FORMAT_PROPERTY</code>.</p><h5 id="BookInOnePage-HowtoenableCXF'sLoggingOutInterceptorinMESSAGEmode">How to enable CXF's LoggingOutInterceptor in MESSAGE mode</h5><p>CXF's <code>LoggingOutInterceptor</code> outputs outbound message that goes on the wire to logging system (Java Util Logging). Since the <code>LoggingOutInterceptor</code> is in <code>PRE_STREAM</code> phase (but <code>PRE_STREAM</code> phase is removed in <code>MESSAGE</code> mode), you have to configure <code>LoggingOutInterceptor</code> to be run during the <code>WRITE</code> phase. The following is an example.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;loggingOutInterceptor&amp;quot; class=&amp;quot;org.apache.cxf.interceptor.LoggingOutInterceptor&amp;quot;&amp;gt; &amp;lt;!-- it really should have been user-prestream but CXF does have such phase! --&amp;gt; &amp;lt;constructor-arg value=&amp;quot;target/write&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;cxf:cxfEndpoint id=&amp;quot;serviceEndpoint&amp;quot; address=&amp;quot;http://localhost:${CXFTestSupport.port2}/LoggingInterceptorInMessageModeTest/helloworld&amp;quot; serviceClass=&amp;quot;org.apache.camel.component.cxf.HelloService&amp;quot;&amp;gt; &amp;lt;cxf:outInterceptors&amp;gt; &amp;lt;ref bean=&amp;quot;loggingOutInterceptor&amp;quot;/&amp;gt; &amp;lt;/cxf:outInterceptors&amp;gt; &amp;lt;cxf:properties&amp;gt; &amp;lt;entry key=&amp;quot;dataFormat&amp;quot; value=&amp;quot;MESSAGE&amp;quot;/&amp;gt; &amp;lt;/cxf:properties&amp;gt; &amp;lt;/cxf:cxfEndpoint&amp;gt; </script> 
  </div>
 </div><h4 id="BookInOnePage-DescriptionofrelayHeadersoption">Description of relayHeaders option</h4><p>There are <em>in-band</em> and <em>out-of-band</em> on-the-wire headers from the perspective of a JAXWS WSDL-first developer.</p><p>The <em>in-band</em> headers are headers that are explicitly defined as part of the WSDL binding contract for an endpoint such as SOAP headers.</p><p>The <em>out-of-band</em> headers are headers that are serialized over the wire, but are not explicitly part of the WSDL binding contract.</p><p>Headers relaying/filtering is bi-directional.</p><p>When a route has a CXF endpoint and the developer needs to have on-the-wire headers, such as SOAP headers, be relayed along the route to be consumed say by another JAXWS endpoint, then <code>relayHeaders</code> should be set to <code>true</code>, which is the default value.</p><h5 id="BookInOnePage-AvailableonlyinPOJOmode">Available only in POJO mode</h5><p>The <code>relayHeaders=true</code> express an intent to relay the headers. The actual decision on whether a given header is relayed is delegated to a pluggable instance that implements the <code>MessageHeadersRelay</code> interface. A concrete implementation of <code>MessageHeadersRelay</code> will be consulted to decide if a header needs to be relayed or not. There is already an implementation of <code>SoapMessageHeadersRelay</code> which binds itself to well-known SOAP name spaces. Currently only out-of-band headers are filtered, and in-band headers will always be relayed when <code>relayHeaders=true</code>. If there is a header on the wire, whose name space is unknown to the runtime, then a fall back <code>DefaultMessageHeadersRelay</code> will be used, which simply allows all headers to be relayed.</p><p>The <code>relayHeaders=false</code> setting asserts that all headers in-band and out-of-band will be dropped.</p><p>You can plugin your own <code>MessageHeadersRelay</code> implementations overriding or adding additional ones to the list of relays. In order to override a preloaded relay instance just make sure that your <code>MessageHeadersRelay</code> implementation services the same name spaces as the one you looking to override. Also note, that the overriding relay has to service all of the name spaces as the one you looking to override, or else a runtime exception on route start up will be thrown as this would introduce an ambiguity in name spaces to relay instance mappings.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;cxf:cxfEndpoint ...&amp;gt; &amp;lt;cxf:properties&amp;gt; &amp;lt;entry key=&amp;quot;org.apache.camel.cxf.message.headers.relays&amp;quot;&amp;gt; &amp;lt;list&amp;gt; &amp;lt;ref bean=&amp;quot;customHeadersRelay&amp;quot;/&amp;gt; &amp;lt;/list&amp;gt; &amp;lt;/entry&amp;gt; &amp;lt;/cxf:properties&amp;gt; &amp;lt;/cxf:cxfEndpoint&amp;gt; &amp;lt;bean id=&amp;quot;customHeadersRelay&amp;quot; class=&amp;quot;org.apache.camel.component.cxf.soap.headers.CustomHeadersRelay&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>Take a look at the tests that show how you'd be able to relay/drop headers here:</p><p><a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/camel/branches/camel-1.x/components/camel-cxf/src/test/java/org/apache/camel/component/cxf/soap/headers/CxfMessageHeadersRelayTest.java">https://svn.apache.org/repos/asf/camel/branches/camel-1.x/components/camel-cxf/src/test/java/org/apache/camel/component/cxf/soap/headers/CxfMessageHeadersRelayTest.java</a></p><h5 id="BookInOnePage-ChangessinceRelease2.0">Changes since Release 2.0</h5><ul><li><code>POJO</code> and <code>PAYLOAD</code> modes are supported. In <code>POJO</code> mode, only out-of-band message headers are available for filtering as the in-band headers have been processed and removed from header list by CXF. The in-band headers are incorporated into the <code>MessageContentList</code> in POJO mode. The <code>camel-cxf</code> component does make any attempt to remove the in-band headers from the <code>MessageContentList</code>. If filtering of in-band headers is required, please use <code>PAYLOAD</code> mode or plug in a (pretty straightforward) CXF interceptor/JAXWS Handler to the CXF endpoint.</li><li><p>The Message Header Relay mechanism has been merged into <code>CxfHeaderFilterStrategy</code>. The <code>relayHeaders</code> option, its semantics, and default value remain the same, but it is a property of <code>CxfHeaderFilterStrategy</code>.<br clear="none"> Here is an example of configuring it.
   </p><div class="code panel pdl" style="border-width: 1px;">
    <div class="codeContent panelContent pdl"> 
     <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;dropAllMessageHeadersStrategy&amp;quot; class=&amp;quot;org.apache.camel.component.cxf.common.header.CxfHeaderFilterStrategy&amp;quot;&amp;gt; &amp;lt;!-- Set relayHeaders to false to drop all SOAP headers --&amp;gt; &amp;lt;property name=&amp;quot;relayHeaders&amp;quot; value=&amp;quot;false&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
    </div>
   </div>Then, your endpoint can reference the <code>CxfHeaderFilterStrategy</code>.
   <div class="code panel pdl" style="border-width: 1px;">
    <div class="codeContent panelContent pdl"> 
     <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;cxf:bean:routerNoRelayEndpoint?headerFilterStrategy=#dropAllMessageHeadersStrategy&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;cxf:bean:serviceNoRelayEndpoint?headerFilterStrategy=#dropAllMessageHeadersStrategy&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
    </div>
   </div></li><li><p>The <code>MessageHeadersRelay</code> interface has changed slightly and has been renamed to <code>MessageHeaderFilter</code>. It is a property of <code>CxfHeaderFilterStrategy</code>. Here is an example of configuring user defined Message Header Filters:
   </p><div class="code panel pdl" style="border-width: 1px;">
    <div class="codeContent panelContent pdl"> 
     <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;customMessageFilterStrategy&amp;quot; class=&amp;quot;org.apache.camel.component.cxf.common.header.CxfHeaderFilterStrategy&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;messageHeaderFilters&amp;quot;&amp;gt; &amp;lt;list&amp;gt; &amp;lt;!-- SoapMessageHeaderFilter is the built in filter. It can be removed by omitting it. --&amp;gt; &amp;lt;bean class=&amp;quot;org.apache.camel.component.cxf.common.header.SoapMessageHeaderFilter&amp;quot;/&amp;gt; &amp;lt;!-- Add custom filter here --&amp;gt; &amp;lt;bean class=&amp;quot;org.apache.camel.component.cxf.soap.headers.CustomHeaderFilter&amp;quot;/&amp;gt; &amp;lt;/list&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;/bean&amp;gt; </script> 
    </div>
   </div></li><li><p>Other than <code>relayHeaders</code>, there are new properties that can be configured in <code>CxfHeaderFilterStrategy</code>.</p>
  <div class="table-wrap">
   <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Required</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>relayHeaders</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>All message headers will be processed by Message Header Filters <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Type</em>: <code>boolean</code> <br clear="none" class="atl-forced-newline"> <em>Default</em>: <code>true</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>relayAllMessageHeaders</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>All message headers will be propagated (without processing by Message Header Filters) <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Type</em>: <code>boolean</code> <br clear="none" class="atl-forced-newline"> <em>Default</em>: <code>false</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>allowFilterNamespaceClash</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If two filters overlap in activation namespace, the property control how it should be handled. If the value is <code>true</code>, last one wins. If the value is <code>false</code>, it will throw an exception <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <em>Type</em>: <code>boolean</code> <br clear="none" class="atl-forced-newline"> <em>Default</em>: <code>false</code></p></td></tr></tbody></table>
  </div><h3 id="BookInOnePage-ConfiguretheCXFendpointswithSpring">Configure the CXF endpoints with Spring</h3><p>You can configure the CXF endpoint with the Spring configuration file shown below, and you can also embed the endpoint into the <code>camelContext</code> tags. When you are invoking the service endpoint, you can set the <code>operationName</code> and <code>operationNamespace</code> headers to explicitly state which operation you are calling.</p>
  <div class="code panel pdl" style="border-width: 1px;">
   <div class="codeContent panelContent pdl"> 
    <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;beans xmlns=&amp;quot;http://www.springframework.org/schema/beans&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:cxf=&amp;quot;http://camel.apache.org/schema/cxf&amp;quot; xsi:schemaLocation=&amp;quot; http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://camel.apache.org/schema/cxf http://camel.apache.org/schema/cxf/camel-cxf.xsd http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd&amp;quot;&amp;gt; &amp;lt;cxf:cxfEndpoint id=&amp;quot;routerEndpoint&amp;quot; address=&amp;quot;http://localhost:9003/CamelContext/RouterPort&amp;quot; serviceClass=&amp;quot;org.apache.hello_world_soap_http.GreeterImpl&amp;quot;/&amp;gt; &amp;lt;cxf:cxfEndpoint id=&amp;quot;serviceEndpoint&amp;quot; address=&amp;quot;http://localhost:9000/SoapContext/SoapPort&amp;quot; wsdlURL=&amp;quot;testutils/hello_world.wsdl&amp;quot; serviceClass=&amp;quot;org.apache.hello_world_soap_http.Greeter&amp;quot; endpointName=&amp;quot;s:SoapPort&amp;quot; serviceName=&amp;quot;s:SOAPService&amp;quot; xmlns:s=&amp;quot;http://apache.org/hello_world_soap_http&amp;quot; /&amp;gt; &amp;lt;camelContext id=&amp;quot;camel&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;cxf:bean:routerEndpoint&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;cxf:bean:serviceEndpoint&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;/beans&amp;gt; </script> 
   </div>
  </div><p>Be sure to include the JAX-WS <code>schemaLocation</code> attribute specified on the root beans element. This allows CXF to validate the file and is required. Also note the namespace declarations at the end of the <code>&lt;cxf:cxfEndpoint/&gt;</code> tag--these are required because the combined {<code>namespace}localName</code> syntax is presently not supported for this tag's attribute values.</p><p>The <code>cxf:cxfEndpoint</code> element supports many additional attributes:</p>
  <div class="table-wrap">
   <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Value</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>PortName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The endpoint name this service is implementing, it maps to the <code>wsdl:port@name</code>. In the format of <code>ns:PORT_NAME</code> where <code>ns</code> is a namespace prefix valid at this scope.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>serviceName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The service name this service is implementing, it maps to the <code>wsdl:service@name</code>. In the format of <code>ns:SERVICE_NAME</code> where <code>ns</code> is a namespace prefix valid at this scope.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>wsdlURL</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The location of the WSDL. Can be on the classpath, file system, or be hosted remotely.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bindingId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The <code>bindingId</code> for the service model to use.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>address</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The service publish address.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bus</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The bus name that will be used in the JAX-WS endpoint.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>serviceClass</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The class name of the SEI (Service Endpoint Interface) class which could have JSR181 annotation or not.</p></td></tr></tbody></table>
  </div><p>It also supports many child elements:</p>
  <div class="table-wrap">
   <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Value</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cxf:inInterceptors</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The incoming interceptors for this endpoint. A list of <code>&lt;bean&gt;</code> or <code>&lt;ref&gt;</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cxf:inFaultInterceptors</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The incoming fault interceptors for this endpoint. A list of <code>&lt;bean&gt;</code> or <code>&lt;ref&gt;</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cxf:outInterceptors</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The outgoing interceptors for this endpoint. A list of <code>&lt;bean&gt;</code> or <code>&lt;ref&gt;</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cxf:outFaultInterceptors</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The outgoing fault interceptors for this endpoint. A list of <code>&lt;bean&gt;</code> or <code>&lt;ref&gt;</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cxf:properties</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A properties map which should be supplied to the JAX-WS endpoint. See below.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cxf:handlers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A JAX-WS handler list which should be supplied to the JAX-WS endpoint. See below.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cxf:dataBinding</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>You can specify the which <code>DataBinding</code> will be use in the endpoint. This can be supplied using the Spring <code>&lt;bean class="MyDataBinding"/&gt;</code> syntax.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cxf:binding</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>You can specify the <code>BindingFactory</code> for this endpoint to use. This can be supplied using the Spring <code>&lt;bean class="MyBindingFactory"/&gt;</code> syntax.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cxf:features</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The features that hold the interceptors for this endpoint. A list of {{&lt;bean&gt;}}s or {{&lt;ref&gt;}}s</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cxf:schemaLocations</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The schema locations for endpoint to use. A list of {{&lt;schemaLocation&gt;}}s</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cxf:serviceFactory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The service factory for this endpoint to use. This can be supplied using the Spring <code>&lt;bean class="MyServiceFactory"/&gt;</code> syntax</p></td></tr></tbody></table>
  </div>
  <div>
   &#160;
  </div></li></ul><p>You can find more advanced examples that show how to provide interceptors, properties and handlers on the CXF <a shape="rect" class="external-link" href="https://cwiki.apache.org/CXF20DOC/JAX-WS+Configuration">JAX-WS Configuration page</a>.</p><p><strong>NOTE</strong><br clear="none"> You can use cxf:properties to set the camel-cxf endpoint's dataFormat and setDefaultBus properties from spring configuration file.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;cxf:cxfEndpoint id=&amp;quot;testEndpoint&amp;quot; address=&amp;quot;http://localhost:9000/router&amp;quot; serviceClass=&amp;quot;org.apache.camel.component.cxf.HelloService&amp;quot; endpointName=&amp;quot;s:PortName&amp;quot; serviceName=&amp;quot;s:ServiceName&amp;quot; xmlns:s=&amp;quot;http://www.example.com/test&amp;quot;&amp;gt; &amp;lt;cxf:properties&amp;gt; &amp;lt;entry key=&amp;quot;dataFormat&amp;quot; value=&amp;quot;MESSAGE&amp;quot;/&amp;gt; &amp;lt;entry key=&amp;quot;setDefaultBus&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;/cxf:properties&amp;gt; &amp;lt;/cxf:cxfEndpoint&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-ConfiguringtheCXFEndpointswithApacheAriesBlueprint.">Configuring the CXF Endpoints with Apache Aries Blueprint.</h3><p>Since camel 2.8 there is support for utilizing aries blueprint dependency injection for your CXF endpoints.<br clear="none"> The schema utilized is very similar to the spring schema so the transition is fairly transparent.</p><p>Example</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;blueprint xmlns=&amp;quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:cm=&amp;quot;http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.0.0&amp;quot; xmlns:camel-cxf=&amp;quot;http://camel.apache.org/schema/blueprint/cxf&amp;quot; xmlns:cxfcore=&amp;quot;http://cxf.apache.org/blueprint/core&amp;quot; xsi:schemaLocation=&amp;quot;http://www.osgi.org/xmlns/blueprint/v1.0.0 https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd&amp;quot;&amp;gt; &amp;lt;camel-cxf:cxfEndpoint id=&amp;quot;routerEndpoint&amp;quot; address=&amp;quot;http://localhost:9001/router&amp;quot; serviceClass=&amp;quot;org.apache.servicemix.examples.cxf.HelloWorld&amp;quot;&amp;gt; &amp;lt;camel-cxf:properties&amp;gt; &amp;lt;entry key=&amp;quot;dataFormat&amp;quot; value=&amp;quot;MESSAGE&amp;quot;/&amp;gt; &amp;lt;/camel-cxf:properties&amp;gt; &amp;lt;/camel-cxf:cxfEndpoint&amp;gt; &amp;lt;camel-cxf:cxfEndpoint id=&amp;quot;serviceEndpoint&amp;quot; address=&amp;quot;http://localhost:9000/SoapContext/SoapPort&amp;quot; serviceClass=&amp;quot;org.apache.servicemix.examples.cxf.HelloWorld&amp;quot;&amp;gt; &amp;lt;/camel-cxf:cxfEndpoint&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/blueprint&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;routerEndpoint&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;log:request&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;/blueprint&amp;gt; </script> 
 </div>
</div><p>Currently the endpoint element is the first supported CXF namespacehandler.</p><p>You can also use the bean references just as in spring</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;blueprint xmlns=&amp;quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:cm=&amp;quot;http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.0.0&amp;quot; xmlns:jaxws=&amp;quot;http://cxf.apache.org/blueprint/jaxws&amp;quot; xmlns:cxf=&amp;quot;http://cxf.apache.org/blueprint/core&amp;quot; xmlns:camel=&amp;quot;http://camel.apache.org/schema/blueprint&amp;quot; xmlns:camelcxf=&amp;quot;http://camel.apache.org/schema/blueprint/cxf&amp;quot; xsi:schemaLocation=&amp;quot; http://www.osgi.org/xmlns/blueprint/v1.0.0 https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd http://cxf.apache.org/blueprint/jaxws http://cxf.apache.org/schemas/blueprint/jaxws.xsd http://cxf.apache.org/blueprint/core http://cxf.apache.org/schemas/blueprint/core.xsd &amp;quot;&amp;gt; &amp;lt;camelcxf:cxfEndpoint id=&amp;quot;reportIncident&amp;quot; address=&amp;quot;/camel-example-cxf-blueprint/webservices/incident&amp;quot; wsdlURL=&amp;quot;META-INF/wsdl/report_incident.wsdl&amp;quot; serviceClass=&amp;quot;org.apache.camel.example.reportincident.ReportIncidentEndpoint&amp;quot;&amp;gt; &amp;lt;/camelcxf:cxfEndpoint&amp;gt; &amp;lt;bean id=&amp;quot;reportIncidentRoutes&amp;quot; class=&amp;quot;org.apache.camel.example.reportincident.ReportIncidentRoutes&amp;quot; /&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/blueprint&amp;quot;&amp;gt; &amp;lt;routeBuilder ref=&amp;quot;reportIncidentRoutes&amp;quot;/&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;/blueprint&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Howtomakethecamel-cxfcomponentuselog4jinsteadofjava.util.logging">How to make the camel-cxf component use log4j instead of java.util.logging</h3><p>CXF's default logger is <code>java.util.logging</code>. If you want to change it to log4j, proceed as follows. Create a file, in the classpath, named <code>META-INF/cxf/org.apache.cxf.logger</code>. This file should contain the fully-qualified name of the class, <code>org.apache.cxf.common.logging.Log4jLogger</code>, with no comments, on a single line.</p><h3 id="BookInOnePage-Howtoletcamel-cxfresponsemessagewithxmlstartdocument">How to let camel-cxf response message with xml start document</h3><p>If you are using some SOAP client such as PHP, you will get this kind of error, because CXF doesn't add the XML start document "&lt;?xml version="1.0" encoding="utf-8"?&gt;"</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Error:sendSms: SoapFault exception: [Client] looks like we got no XML document in [...] </script> 
 </div>
</div><p>To resolved this issue, you just need to tell StaxOutInterceptor to write the XML start document for you.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> public class WriteXmlDeclarationInterceptor extends AbstractPhaseInterceptor&amp;lt;SoapMessage&amp;gt; { public WriteXmlDeclarationInterceptor() { super(Phase.PRE_STREAM); addBefore(StaxOutInterceptor.class.getName()); } public void handleMessage(SoapMessage message) throws Fault { message.put(&amp;quot;org.apache.cxf.stax.force-start-document&amp;quot;, Boolean.TRUE); } } </script> 
  </div>
 </div>You can add a customer interceptor like this and configure it into you camel-cxf endpont
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;cxf:cxfEndpoint id=&amp;quot;routerEndpoint&amp;quot; address=&amp;quot;http://localhost:${CXFTestSupport.port2}/CXFGreeterRouterTest/CamelContext/RouterPort&amp;quot; serviceClass=&amp;quot;org.apache.hello_world_soap_http.GreeterImpl&amp;quot; skipFaultLogging=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;cxf:outInterceptors&amp;gt; &amp;lt;!-- This interceptor will force the CXF server send the XML start document to client --&amp;gt; &amp;lt;bean class=&amp;quot;org.apache.camel.component.cxf.WriteXmlDeclarationInterceptor&amp;quot;/&amp;gt; &amp;lt;/cxf:outInterceptors&amp;gt; &amp;lt;cxf:properties&amp;gt; &amp;lt;!-- Set the publishedEndpointUrl which could override the service address from generated WSDL as you want --&amp;gt; &amp;lt;entry key=&amp;quot;publishedEndpointUrl&amp;quot; value=&amp;quot;http://www.simple.com/services/test&amp;quot; /&amp;gt; &amp;lt;/cxf:properties&amp;gt; &amp;lt;/cxf:cxfEndpoint&amp;gt; </script> 
  </div>
 </div>Or adding a message header for it like this if you are using <strong>Camel 2.4</strong>.<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // set up the response context which force start document Map&amp;lt;String, Object&amp;gt; map = new HashMap&amp;lt;String, Object&amp;gt;(); map.put(&amp;quot;org.apache.cxf.stax.force-start-document&amp;quot;, Boolean.TRUE); exchange.getOut().setHeader(Client.RESPONSE_CONTEXT, map); </script> 
 </div>
</div><h3 id="BookInOnePage-HowtooverridetheCXFproduceraddressfrommessageheader">How to override the CXF producer address from message header</h3><p>The&#160;<code>camel-cxf</code>&#160;producer supports to override the services address by setting the message with the key of "<span style="line-height: 1.4285715;">CamelDestinationOverrideUrl".</span></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // set up the service address from the message header to override the setting of CXF endpoint exchange.getIn().setHeader(Exchange.DESTINATION_OVERRIDE_URL, constant(getServiceAddress())); </script> 
 </div>
</div><h3 id="BookInOnePage-Howtoconsumeamessagefromacamel-cxfendpointinPOJOdataformat">How to consume a message from a camel-cxf endpoint in POJO data format</h3><p>The <code>camel-cxf</code> endpoint consumer POJO data format is based on the <a shape="rect" class="external-link" href="http://cwiki.apache.org/CXF20DOC/invokers.html">cxf invoker</a>, so the message header has a property with the name of <code>CxfConstants.OPERATION_NAME</code> and the message body is a list of the SEI method parameters.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public class PersonProcessor implements Processor { private static final Logger LOG = LoggerFactory.getLogger(PersonProcessor.class); @SuppressWarnings(&amp;quot;unchecked&amp;quot;) public void process(Exchange exchange) throws Exception { LOG.info(&amp;quot;processing exchange in camel&amp;quot;); BindingOperationInfo boi = (BindingOperationInfo)exchange.getProperty(BindingOperationInfo.class.getName()); if (boi != null) { LOG.info(&amp;quot;boi.isUnwrapped&amp;quot; + boi.isUnwrapped()); } // Get the parameters list which element is the holder. MessageContentsList msgList = (MessageContentsList)exchange.getIn().getBody(); Holder&amp;lt;String&amp;gt; personId = (Holder&amp;lt;String&amp;gt;)msgList.get(0); Holder&amp;lt;String&amp;gt; ssn = (Holder&amp;lt;String&amp;gt;)msgList.get(1); Holder&amp;lt;String&amp;gt; name = (Holder&amp;lt;String&amp;gt;)msgList.get(2); if (personId.value == null || personId.value.length() == 0) { LOG.info(&amp;quot;person id 123, so throwing exception&amp;quot;); // Try to throw out the soap fault message org.apache.camel.wsdl_first.types.UnknownPersonFault personFault = new org.apache.camel.wsdl_first.types.UnknownPersonFault(); personFault.setPersonId(&amp;quot;&amp;quot;); org.apache.camel.wsdl_first.UnknownPersonFault fault = new org.apache.camel.wsdl_first.UnknownPersonFault(&amp;quot;Get the null value of person name&amp;quot;, personFault); // Since camel has its own exception handler framework, we can&amp;#39;t throw the exception to trigger it // We just set the fault message in the exchange for camel-cxf component handling and return exchange.getOut().setFault(true); exchange.getOut().setBody(fault); return; } name.value = &amp;quot;Bonjour&amp;quot;; ssn.value = &amp;quot;123&amp;quot;; LOG.info(&amp;quot;setting Bonjour as the response&amp;quot;); // Set the response message, first element is the return value of the operation, // the others are the holders of method parameters exchange.getOut().setBody(new Object[] {null, personId, ssn, name}); } } </script> 
  </div>
 </div><h3 id="BookInOnePage-Howtopreparethemessageforthecamel-cxfendpointinPOJOdataformat">How to prepare the message for the camel-cxf endpoint in POJO data format</h3><p>The <code>camel-cxf</code> endpoint producer is based on the <a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/cxf/trunk/api/src/main/java/org/apache/cxf/endpoint/Client.java">cxf client API</a>. First you need to specify the operation name in the message header, then add the method parameters to a list, and initialize the message with this parameter list. The response message's body is a messageContentsList, you can get the result from that list.</p><p>If you don't specify the operation name in the message header, <code>CxfProducer</code> will try to use the <code>defaultOperationName </code>from <code>CxfEndpoint</code>, if there is no <code>defaultOperationName</code> set on <code>CxfEndpoint</code>, it will pickup the first operationName from the Operation list.</p><p>If you want to get the object array from the message body, you can get the body using <code>message.getbody(Object[].class)</code>, as follows:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> Exchange senderExchange = new DefaultExchange(context, ExchangePattern.InOut); final List&amp;lt;String&amp;gt; params = new ArrayList&amp;lt;String&amp;gt;(); // Prepare the request message for the camel-cxf procedure params.add(TEST_MESSAGE); senderExchange.getIn().setBody(params); senderExchange.getIn().setHeader(CxfConstants.OPERATION_NAME, ECHO_OPERATION); Exchange exchange = template.send(&amp;quot;direct:EndpointA&amp;quot;, senderExchange); org.apache.camel.Message out = exchange.getOut(); // The response message&amp;#39;s body is an MessageContentsList which first element is the return value of the operation, // If there are some holder parameters, the holder parameter will be filled in the reset of List. // The result will be extract from the MessageContentsList with the String class type MessageContentsList result = (MessageContentsList)out.getBody(); LOG.info(&amp;quot;Received output text: &amp;quot; + result.get(0)); Map&amp;lt;String, Object&amp;gt; responseContext = CastUtils.cast((Map&amp;lt;?, ?&amp;gt;)out.getHeader(Client.RESPONSE_CONTEXT)); assertNotNull(responseContext); assertEquals(&amp;quot;We should get the response context here&amp;quot;, &amp;quot;UTF-8&amp;quot;, responseContext.get(org.apache.cxf.message.Message.ENCODING)); assertEquals(&amp;quot;Reply body on Camel is wrong&amp;quot;, &amp;quot;echo &amp;quot; + TEST_MESSAGE, result.get(0)); </script> 
  </div>
 </div><h3 id="BookInOnePage-Howtodealwiththemessageforacamel-cxfendpointinPAYLOADdataformat">How to deal with the message for a camel-cxf endpoint in PAYLOAD data format</h3><p><code>PAYLOAD</code> means that you process the payload message from the SOAP envelope. You can use the <code>Header.HEADER_LIST</code> as the key to set or get the SOAP headers and use the <code>List&lt;Element&gt;</code> to set or get SOAP body elements.<br clear="none"> <code>Message.getBody()</code> will return an <code>org.apache.camel.component.cxf.CxfPayload</code> object, which has getters for SOAP message headers and Body elements. This change enables decoupling the native CXF message from the Camel message.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> protected RouteBuilder createRouteBuilder() { return new RouteBuilder() { public void configure() { from(simpleEndpointURI + &amp;quot;&amp;amp;dataFormat=PAYLOAD&amp;quot;).to(&amp;quot;log:info&amp;quot;).process(new Processor() { @SuppressWarnings(&amp;quot;unchecked&amp;quot;) public void process(final Exchange exchange) throws Exception { CxfPayload&amp;lt;SoapHeader&amp;gt; requestPayload = exchange.getIn().getBody(CxfPayload.class); List&amp;lt;Source&amp;gt; inElements = requestPayload.getBodySources(); List&amp;lt;Source&amp;gt; outElements = new ArrayList&amp;lt;Source&amp;gt;(); // You can use a customer toStringConverter to turn a CxfPayLoad message into String as you want String request = exchange.getIn().getBody(String.class); XmlConverter converter = new XmlConverter(); String documentString = ECHO_RESPONSE; Element in = new XmlConverter().toDOMElement(inElements.get(0)); // Just check the element namespace if (!in.getNamespaceURI().equals(ELEMENT_NAMESPACE)) { throw new IllegalArgumentException(&amp;quot;Wrong element namespace&amp;quot;); } if (in.getLocalName().equals(&amp;quot;echoBoolean&amp;quot;)) { documentString = ECHO_BOOLEAN_RESPONSE; checkRequest(&amp;quot;ECHO_BOOLEAN_REQUEST&amp;quot;, request); } else { documentString = ECHO_RESPONSE; checkRequest(&amp;quot;ECHO_REQUEST&amp;quot;, request); } Document outDocument = converter.toDOMDocument(documentString, exchange); outElements.add(new DOMSource(outDocument.getDocumentElement())); // set the payload header with null CxfPayload&amp;lt;SoapHeader&amp;gt; responsePayload = new CxfPayload&amp;lt;SoapHeader&amp;gt;(null, outElements, null); exchange.getOut().setBody(responsePayload); } }); } }; } </script> 
  </div>
 </div><h3 id="BookInOnePage-HowtogetandsetSOAPheadersinPOJOmode">How to get and set SOAP headers in POJO mode</h3><p><code>POJO</code> means that the data format is a "list of Java objects" when the Camel-cxf endpoint produces or consumes Camel exchanges. Even though Camel expose message body as POJOs in this mode, Camel-cxf still provides access to read and write SOAP headers. However, since CXF interceptors remove in-band SOAP headers from Header list after they have been processed, only out-of-band SOAP headers are available to Camel-cxf in POJO mode.</p><p>The following example illustrate how to get/set SOAP headers. Suppose we have a route that forwards from one Camel-cxf endpoint to another. That is, SOAP Client -&gt; Camel -&gt; CXF service. We can attach two processors to obtain/insert SOAP headers at (1) before request goes out to the CXF service and (2) before response comes back to the SOAP Client. Processor (1) and (2) in this example are InsertRequestOutHeaderProcessor and InsertResponseOutHeaderProcessor. Our route looks like this:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;cxf:bean:routerRelayEndpointWithInsertion&amp;quot;/&amp;gt; &amp;lt;process ref=&amp;quot;InsertRequestOutHeaderProcessor&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;cxf:bean:serviceRelayEndpointWithInsertion&amp;quot;/&amp;gt; &amp;lt;process ref=&amp;quot;InsertResponseOutHeaderProcessor&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div>SOAP headers are propagated to and from Camel Message headers. The Camel message header name is "org.apache.cxf.headers.Header.list" which is a constant defined in CXF (org.apache.cxf.headers.Header.HEADER_LIST). The header value is a List of CXF SoapHeader objects (org.apache.cxf.binding.soap.SoapHeader). The following snippet is the InsertResponseOutHeaderProcessor (that insert a new SOAP header in the response message). The way to access SOAP headers in both InsertResponseOutHeaderProcessor and InsertRequestOutHeaderProcessor are actually the same. The only difference between the two processors is setting the direction of the inserted SOAP header.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public static class InsertResponseOutHeaderProcessor implements Processor { public void process(Exchange exchange) throws Exception { // You should be able to get the header if exchange is routed from camel-cxf endpoint List&amp;lt;SoapHeader&amp;gt; soapHeaders = CastUtils.cast((List&amp;lt;?&amp;gt;)exchange.getIn().getHeader(Header.HEADER_LIST)); if (soapHeaders == null) { // we just create a new soap headers in case the header is null soapHeaders = new ArrayList&amp;lt;SoapHeader&amp;gt;(); } // Insert a new header String xml = &amp;quot;&amp;lt;?xml version=\&amp;quot;1.0\&amp;quot; encoding=\&amp;quot;utf-8\&amp;quot;?&amp;gt;&amp;lt;outofbandHeader &amp;quot; + &amp;quot;xmlns=\&amp;quot;http://cxf.apache.org/outofband/Header\&amp;quot; hdrAttribute=\&amp;quot;testHdrAttribute\&amp;quot; &amp;quot; + &amp;quot;xmlns:soap=\&amp;quot;http://schemas.xmlsoap.org/soap/envelope/\&amp;quot; soap:mustUnderstand=\&amp;quot;1\&amp;quot;&amp;gt;&amp;quot; + &amp;quot;&amp;lt;name&amp;gt;New_testOobHeader&amp;lt;/name&amp;gt;&amp;lt;value&amp;gt;New_testOobHeaderValue&amp;lt;/value&amp;gt;&amp;lt;/outofbandHeader&amp;gt;&amp;quot;; SoapHeader newHeader = new SoapHeader(soapHeaders.get(0).getName(), StaxUtils.read(new StringReader(xml)).getDocumentElement()); // make sure direction is OUT since it is a response message. newHeader.setDirection(Direction.DIRECTION_OUT); //newHeader.setMustUnderstand(false); soapHeaders.add(newHeader); } } </script> 
  </div>
 </div><h3 id="BookInOnePage-HowtogetandsetSOAPheadersinPAYLOADmode">How to get and set SOAP headers in PAYLOAD mode</h3><p>We've already shown how to access SOAP message (CxfPayload object) in PAYLOAD mode (See "How to deal with the message for a camel-cxf endpoint in PAYLOAD data format").</p><p>Once you obtain a CxfPayload object, you can invoke the CxfPayload.getHeaders() method that returns a List of DOM Elements (SOAP headers).
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(getRouterEndpointURI()).process(new Processor() { @SuppressWarnings(&amp;quot;unchecked&amp;quot;) public void process(Exchange exchange) throws Exception { CxfPayload&amp;lt;SoapHeader&amp;gt; payload = exchange.getIn().getBody(CxfPayload.class); List&amp;lt;Source&amp;gt; elements = payload.getBodySources(); assertNotNull(&amp;quot;We should get the elements here&amp;quot;, elements); assertEquals(&amp;quot;Get the wrong elements size&amp;quot;, 1, elements.size()); Element el = new XmlConverter().toDOMElement(elements.get(0)); elements.set(0, new DOMSource(el)); assertEquals(&amp;quot;Get the wrong namespace URI&amp;quot;, &amp;quot;http://camel.apache.org/pizza/types&amp;quot;, el.getNamespaceURI()); List&amp;lt;SoapHeader&amp;gt; headers = payload.getHeaders(); assertNotNull(&amp;quot;We should get the headers here&amp;quot;, headers); assertEquals(&amp;quot;Get the wrong headers size&amp;quot;, headers.size(), 1); assertEquals(&amp;quot;Get the wrong namespace URI&amp;quot;, ((Element)(headers.get(0).getObject())).getNamespaceURI(), &amp;quot;http://camel.apache.org/pizza/types&amp;quot;); // alternatively you can also get the SOAP header via the camel header: headers = exchange.getIn().getHeader(Header.HEADER_LIST, List.class); assertNotNull(&amp;quot;We should get the headers here&amp;quot;, headers); assertEquals(&amp;quot;Get the wrong headers size&amp;quot;, headers.size(), 1); assertEquals(&amp;quot;Get the wrong namespace URI&amp;quot;, ((Element)(headers.get(0).getObject())).getNamespaceURI(), &amp;quot;http://camel.apache.org/pizza/types&amp;quot;); } }) .to(getServiceEndpointURI()); </script> 
  </div>
 </div>Since Camel 2.16.0, you can also use the same way as described in sub-chapter "How to get and set SOAP headers in POJO mode" to set or get the SOAP headers. So, you can use now the header&#160;"org.apache.cxf.headers.Header.list" to get and set a list of SOAP headers.This does also mean that if you have a route&#160;that forwards from one Camel-cxf endpoint to another (SOAP Client -&gt; Camel -&gt; CXF service), now also the SOAP headers sent by the SOAP client are forwarded to the CXF service. If you do not want that these headers are forwarded you have to remove them in the Camel header "org.apache.cxf.headers.Header.list".<h3 id="BookInOnePage-SOAPheadersarenotavailableinMESSAGEmode">SOAP headers are not available in MESSAGE mode</h3><p>SOAP headers are not available in MESSAGE mode as SOAP processing is skipped.</p><h3 id="BookInOnePage-HowtothrowaSOAPFaultfromCamel">How to throw a SOAP Fault from Camel</h3><p>If you are using a <code>camel-cxf</code> endpoint to consume the SOAP request, you may need to throw the SOAP Fault from the camel context.<br clear="none"> Basically, you can use the <code>throwFault</code> DSL to do that; it works for <code>POJO</code>, <code>PAYLOAD</code> and <code>MESSAGE</code> data format.<br clear="none"> You can define the soap fault like this
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> SOAP_FAULT = new SoapFault(EXCEPTION_MESSAGE, Fault.FAULT_CODE_CLIENT); Element detail = SOAP_FAULT.getOrCreateDetail(); Document doc = detail.getOwnerDocument(); Text tn = doc.createTextNode(DETAIL_TEXT); detail.appendChild(tn); </script> 
  </div>
 </div>Then throw it as you like
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(routerEndpointURI).setFaultBody(constant(SOAP_FAULT)); </script> 
  </div>
 </div>If your CXF endpoint is working in the <code>MESSAGE</code> data format, you could set the the SOAP Fault message in the message body and set the response code in the message header.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(routerEndpointURI).process(new Processor() { public void process(Exchange exchange) throws Exception { Message out = exchange.getOut(); // Set the message body with the out.setBody(this.getClass().getResourceAsStream(&amp;quot;SoapFaultMessage.xml&amp;quot;)); // Set the response code here out.setHeader(org.apache.cxf.message.Message.RESPONSE_CODE, new Integer(500)); } }); </script> 
  </div>
 </div>Same for using POJO data format. You can set the SOAPFault on the out body and also indicate it's a fault by calling Message.setFault(true):
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;).onException(SoapFault.class).maximumRedeliveries(0).handled(true) .process(new Processor() { public void process(Exchange exchange) throws Exception { SoapFault fault = exchange .getProperty(Exchange.EXCEPTION_CAUGHT, SoapFault.class); exchange.getOut().setFault(true); exchange.getOut().setBody(fault); } }).end().to(serviceURI); </script> 
  </div>
 </div><h3 id="BookInOnePage-Howtopropagateacamel-cxfendpoint'srequestandresponsecontext">How to propagate a camel-cxf endpoint's request and response context</h3><p><a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/cxf/trunk/api/src/main/java/org/apache/cxf/endpoint/Client.java">cxf client API</a> provides a way to invoke the operation with request and response context. If you are using a <code>camel-cxf</code> endpoint producer to invoke the outside web service, you can set the request context and get response context with the following code:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> CxfExchange exchange = (CxfExchange)template.send(getJaxwsEndpointUri(), new Processor() { public void process(final Exchange exchange) { final List&amp;lt;String&amp;gt; params = new ArrayList&amp;lt;String&amp;gt;(); params.add(TEST_MESSAGE); // Set the request context to the inMessage Map&amp;lt;String, Object&amp;gt; requestContext = new HashMap&amp;lt;String, Object&amp;gt;(); requestContext.put(BindingProvider.ENDPOINT_ADDRESS_PROPERTY, JAXWS_SERVER_ADDRESS); exchange.getIn().setBody(params); exchange.getIn().setHeader(Client.REQUEST_CONTEXT , requestContext); exchange.getIn().setHeader(CxfConstants.OPERATION_NAME, GREET_ME_OPERATION); } }); org.apache.camel.Message out = exchange.getOut(); // The output is an object array, the first element of the array is the return value Object\[\] output = out.getBody(Object\[\].class); LOG.info(&amp;quot;Received output text: &amp;quot; + output\[0\]); // Get the response context form outMessage Map&amp;lt;String, Object&amp;gt; responseContext = CastUtils.cast((Map)out.getHeader(Client.RESPONSE_CONTEXT)); assertNotNull(responseContext); assertEquals(&amp;quot;Get the wrong wsdl opertion name&amp;quot;, &amp;quot;{http://apache.org/hello_world_soap_http}greetMe&amp;quot;, responseContext.get(&amp;quot;javax.xml.ws.wsdl.operation&amp;quot;).toString()); </script> 
 </div>
</div><h3 id="BookInOnePage-AttachmentSupport">Attachment Support</h3><p><strong>POJO Mode:</strong> Both SOAP with Attachment and MTOM are supported (see example in Payload Mode for enabling MTOM).&#160; However, SOAP with Attachment is not tested.&#160; Since attachments are marshalled and unmarshalled into POJOs, users typically do not need to deal with the attachment themself.&#160; Attachments are propagated to Camel message's attachments if the MTOM is not enabled, since 2.12.3.&#160; So, it is possible to retreive attachments by Camel Message API</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">DataHandler Message.getAttachment(String id)</script> 
 </div>
</div><p>.</p><p><strong>Payload Mode:</strong> MTOM is supported since 2.1. Attachments can be retrieved by Camel Message APIs mentioned above. SOAP with Attachment (SwA) is supported and attachments can be retrieved since 2.5. SwA is the default (same as setting the CXF endpoint property "mtom-enabled" to false).&#160;</p><p>To enable MTOM, set the CXF endpoint property "mtom-enabled" to <em>true</em>. (I believe you can only do it with Spring.)
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;cxf:cxfEndpoint id=&amp;quot;routerEndpoint&amp;quot; address=&amp;quot;http://localhost:${CXFTestSupport.port1}/CxfMtomRouterPayloadModeTest/jaxws-mtom/hello&amp;quot; wsdlURL=&amp;quot;mtom.wsdl&amp;quot; serviceName=&amp;quot;ns:HelloService&amp;quot; endpointName=&amp;quot;ns:HelloPort&amp;quot; xmlns:ns=&amp;quot;http://apache.org/camel/cxf/mtom_feature&amp;quot;&amp;gt; &amp;lt;cxf:properties&amp;gt; &amp;lt;!-- enable mtom by setting this property to true --&amp;gt; &amp;lt;entry key=&amp;quot;mtom-enabled&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;!-- set the camel-cxf endpoint data fromat to PAYLOAD mode --&amp;gt; &amp;lt;entry key=&amp;quot;dataFormat&amp;quot; value=&amp;quot;PAYLOAD&amp;quot;/&amp;gt; &amp;lt;/cxf:properties&amp;gt; </script> 
  </div>
 </div>You can produce a Camel message with attachment to send to a CXF endpoint in Payload mode.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> Exchange exchange = context.createProducerTemplate().send(&amp;quot;direct:testEndpoint&amp;quot;, new Processor() { public void process(Exchange exchange) throws Exception { exchange.setPattern(ExchangePattern.InOut); List&amp;lt;Source&amp;gt; elements = new ArrayList&amp;lt;Source&amp;gt;(); elements.add(new DOMSource(StaxUtils.read(new StringReader(MtomTestHelper.REQ_MESSAGE)).getDocumentElement())); CxfPayload&amp;lt;SoapHeader&amp;gt; body = new CxfPayload&amp;lt;SoapHeader&amp;gt;(new ArrayList&amp;lt;SoapHeader&amp;gt;(), elements, null); exchange.getIn().setBody(body); exchange.getIn().addAttachment(MtomTestHelper.REQ_PHOTO_CID, new DataHandler(new ByteArrayDataSource(MtomTestHelper.REQ_PHOTO_DATA, &amp;quot;application/octet-stream&amp;quot;))); exchange.getIn().addAttachment(MtomTestHelper.REQ_IMAGE_CID, new DataHandler(new ByteArrayDataSource(MtomTestHelper.requestJpeg, &amp;quot;image/jpeg&amp;quot;))); } }); // process response CxfPayload&amp;lt;SoapHeader&amp;gt; out = exchange.getOut().getBody(CxfPayload.class); Assert.assertEquals(1, out.getBody().size()); Map&amp;lt;String, String&amp;gt; ns = new HashMap&amp;lt;String, String&amp;gt;(); ns.put(&amp;quot;ns&amp;quot;, MtomTestHelper.SERVICE_TYPES_NS); ns.put(&amp;quot;xop&amp;quot;, MtomTestHelper.XOP_NS); XPathUtils xu = new XPathUtils(ns); Element oute = new XmlConverter().toDOMElement(out.getBody().get(0)); Element ele = (Element)xu.getValue(&amp;quot;//ns:DetailResponse/ns:photo/xop:Include&amp;quot;, oute, XPathConstants.NODE); String photoId = ele.getAttribute(&amp;quot;href&amp;quot;).substring(4); // skip &amp;quot;cid:&amp;quot; ele = (Element)xu.getValue(&amp;quot;//ns:DetailResponse/ns:image/xop:Include&amp;quot;, oute, XPathConstants.NODE); String imageId = ele.getAttribute(&amp;quot;href&amp;quot;).substring(4); // skip &amp;quot;cid:&amp;quot; DataHandler dr = exchange.getOut().getAttachment(decodingReference(photoId)); Assert.assertEquals(&amp;quot;application/octet-stream&amp;quot;, dr.getContentType()); MtomTestHelper.assertEquals(MtomTestHelper.RESP_PHOTO_DATA, IOUtils.readBytesFromStream(dr.getInputStream())); dr = exchange.getOut().getAttachment(decodingReference(imageId)); Assert.assertEquals(&amp;quot;image/jpeg&amp;quot;, dr.getContentType()); BufferedImage image = ImageIO.read(dr.getInputStream()); Assert.assertEquals(560, image.getWidth()); Assert.assertEquals(300, image.getHeight()); </script> 
  </div>
 </div>You can also consume a Camel message received from a CXF endpoint in Payload mode.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public static class MyProcessor implements Processor { @SuppressWarnings(&amp;quot;unchecked&amp;quot;) public void process(Exchange exchange) throws Exception { CxfPayload&amp;lt;SoapHeader&amp;gt; in = exchange.getIn().getBody(CxfPayload.class); // verify request assertEquals(1, in.getBody().size()); Map&amp;lt;String, String&amp;gt; ns = new HashMap&amp;lt;String, String&amp;gt;(); ns.put(&amp;quot;ns&amp;quot;, MtomTestHelper.SERVICE_TYPES_NS); ns.put(&amp;quot;xop&amp;quot;, MtomTestHelper.XOP_NS); XPathUtils xu = new XPathUtils(ns); Element body = new XmlConverter().toDOMElement(in.getBody().get(0)); Element ele = (Element)xu.getValue(&amp;quot;//ns:Detail/ns:photo/xop:Include&amp;quot;, body, XPathConstants.NODE); String photoId = ele.getAttribute(&amp;quot;href&amp;quot;).substring(4); // skip &amp;quot;cid:&amp;quot; assertEquals(MtomTestHelper.REQ_PHOTO_CID, photoId); ele = (Element)xu.getValue(&amp;quot;//ns:Detail/ns:image/xop:Include&amp;quot;, body, XPathConstants.NODE); String imageId = ele.getAttribute(&amp;quot;href&amp;quot;).substring(4); // skip &amp;quot;cid:&amp;quot; assertEquals(MtomTestHelper.REQ_IMAGE_CID, imageId); DataHandler dr = exchange.getIn().getAttachment(photoId); assertEquals(&amp;quot;application/octet-stream&amp;quot;, dr.getContentType()); MtomTestHelper.assertEquals(MtomTestHelper.REQ_PHOTO_DATA, IOUtils.readBytesFromStream(dr.getInputStream())); dr = exchange.getIn().getAttachment(imageId); assertEquals(&amp;quot;image/jpeg&amp;quot;, dr.getContentType()); MtomTestHelper.assertEquals(MtomTestHelper.requestJpeg, IOUtils.readBytesFromStream(dr.getInputStream())); // create response List&amp;lt;Source&amp;gt; elements = new ArrayList&amp;lt;Source&amp;gt;(); elements.add(new DOMSource(StaxUtils.read(new StringReader(MtomTestHelper.RESP_MESSAGE)).getDocumentElement())); CxfPayload&amp;lt;SoapHeader&amp;gt; sbody = new CxfPayload&amp;lt;SoapHeader&amp;gt;(new ArrayList&amp;lt;SoapHeader&amp;gt;(), elements, null); exchange.getOut().setBody(sbody); exchange.getOut().addAttachment(MtomTestHelper.RESP_PHOTO_CID, new DataHandler(new ByteArrayDataSource(MtomTestHelper.RESP_PHOTO_DATA, &amp;quot;application/octet-stream&amp;quot;))); exchange.getOut().addAttachment(MtomTestHelper.RESP_IMAGE_CID, new DataHandler(new ByteArrayDataSource(MtomTestHelper.responseJpeg, &amp;quot;image/jpeg&amp;quot;))); } } </script> 
  </div>
 </div><strong>Message Mode:</strong> Attachments are not supported as it does not process the message at all.<p><strong>CXF_MESSAGE Mode</strong>: MTOM is supported, and Attachments can be retrieved by Camel Message APIs mentioned above. Note that when receiving a multipart (i.e. MTOM) message the default SOAPMessage to String converter will provide the complete multipart payload on the body. If you require just the SOAP XML as a String, you can set the message body with message.getSOAPPart(), and Camel convert can do the rest of work for you.</p><h3 id="BookInOnePage-StreamingSupportinPAYLOADmode">Streaming Support in PAYLOAD mode</h3><p>In 2.8.2, the camel-cxf component now supports streaming of incoming messages when using PAYLOAD mode. Previously, the incoming messages would have been completely DOM parsed. For large messages, this is time consuming and uses a significant amount of memory. Starting in 2.8.2, the incoming messages can remain as a javax.xml.transform.Source while being routed and, if nothing modifies the payload, can then be directly streamed out to the target destination. For common "simple proxy" use cases (example: from("cxf:...").to("cxf:...")), this can provide very significant performance increases as well as significantly lowered memory requirements.</p><p>However, there are cases where streaming may not be appropriate or desired. Due to the streaming nature, invalid incoming XML may not be caught until later in the processing chain. Also, certain actions may require the message to be DOM parsed anyway (like WS-Security or message tracing and such) in which case the advantages of the streaming is limited. At this point, there are two ways to control the streaming:</p><ul><li>Endpoint property: you can add "allowStreaming=false" as an endpoint property to turn the streaming on/off.</li></ul><ul><li>Component property: the CxfComponent object also has an allowStreaming property that can set the default for endpoints created from that component.</li></ul><p>Global system property: you can add a system property of "org.apache.camel.component.cxf.streaming" to "false" to turn if off. That sets the global default, but setting the endpoint property above will override this value for that endpoint.</p><h3 id="BookInOnePage-UsingthegenericCXFDispatchmode">Using the generic CXF Dispatch mode</h3><p>From 2.8.0, the camel-cxf component supports the generic <a shape="rect" href="https://cxf.apache.org/docs/jax-ws-dispatch-api.html">CXF dispatch mode</a>&#160;that can transport messages of arbitrary structures (i.e., not bound to a specific XML schema). To use this mode, you simply omit specifying the wsdlURL and serviceClass attributes of the CXF endpoint.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;cxf:cxfEndpoint id=&amp;quot;testEndpoint&amp;quot; address=&amp;quot;http://localhost:9000/SoapContext/SoapAnyPort&amp;quot;&amp;gt; &amp;lt;cxf:properties&amp;gt; &amp;lt;entry key=&amp;quot;dataFormat&amp;quot; value=&amp;quot;PAYLOAD&amp;quot;/&amp;gt; &amp;lt;/cxf:properties&amp;gt; &amp;lt;/cxf:cxfEndpoint&amp;gt;</script> 
 </div>
</div><p>It is noted that the default CXF dispatch client does not send a specific SOAPAction header. Therefore, when the target service requires a specific SOAPAction value, it is supplied in the Camel header using the key SOAPAction (case-insensitive).</p><p>&#160;</p><p></p><h3 id="BookInOnePage-SeeAlso.29">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-CXFBeanComponent">CXF Bean Component</h2><p>The <strong>cxfbean:</strong> component allows other Camel endpoints to send exchange and invoke Web service bean objects. <strong>Currently, it only supports JAX-RS and JAX-WS (new to Camel 2.1) annotated service beans.</strong></p><div class="confluence-information-macro confluence-information-macro-information">
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p><code>CxfBeanEndpoint</code> is a <code>ProcessorEndpoint</code> so it has no consumers. It works similarly to a Bean component.</p>
 </div>
</div><p><span style="color: rgb(0,0,0);">Maven users need to add the following dependency to their pom.xml to use the CXF Bean Component:</span></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-cxf&amp;lt;/artifactId&amp;gt; &amp;lt;!-- use the same version as your Camel core version: --&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt;</script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.12">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">cxfbean:serviceBeanRef </script> 
 </div>
</div><p>Where <strong>serviceBeanRef</strong> is a registry key to look up the service bean object. If <code>serviceBeanRef</code> references a <code>List</code> object, elements of the <code>List</code> are the service bean objects accepted by the endpoint.</p><h3 id="BookInOnePage-Options.29">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Example </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Required? </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default Value </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>bus</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> CXF bus reference specified by the <code>#</code> notation. The referenced object must be an instance of <code>org.apache.cxf.Bus</code>. </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>bus=#busName</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> No </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Default bus created by CXF Bus Factory </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>cxfBeanBinding</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> CXF bean binding specified by the <code>#</code> notation. The referenced object must be an instance of <code>org.apache.camel.component.cxf.cxfbean.CxfBeanBinding</code>. </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>cxfBinding=#bindingName</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> No </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>DefaultCxfBeanBinding</code> </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>headerFilterStrategy</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Header filter strategy specified by the <code>#</code> notation. The referenced object must be an instance of <code>org.apache.camel.spi.HeaderFilterStrategy</code>. </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>headerFilterStrategy=#strategyName</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> No </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>CxfHeaderFilterStrategy</code> </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>populateFromClass</code><br clear="none" class="atl-forced-newline"> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Since 2.3, the wsdlLocation annotated in the POJO is ignored (by default) unless this option is set to&#160; <code>false.</code> Prior to 2.3, the wsdlLocation annotated in the POJO is always honored and it is not possible to ignore.<br clear="none" class="atl-forced-newline"> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code>, <code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> No </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>providers</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Since 2.5, setting the providers for the CXFRS endpoint. </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>providers=#providerRef1,#providerRef2</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> No </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>null</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>setDefaultBus</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Will set the default bus when CXF endpoint create a bus by itself. </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code>, <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> No </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Headers">Headers</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Type </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Required? </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default Value </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> In/Out </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Examples </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>CamelHttpCharacterEncoding</code> (before 2.0-m2: <code>CamelCxfBeanCharacterEncoding</code>) </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Character encoding </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>String</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> No </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> None </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> In </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> ISO-8859-1 </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>CamelContentType</code> (before 2.0-m2: <code>CamelCxfBeanContentType</code>) </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Content type </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>String</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> No </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> *<strong>/</strong>* </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> In </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>text/xml</code> </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> CamelHttpBaseUri <br clear="none" class="atl-forced-newline"> (2.0-m3 and before: <code>CamelCxfBeanRequestBasePath</code>) </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The value of this header will be set in the CXF message as the <code>Message.BASE_PATH</code> property. It is needed by CXF JAX-RS processing. Basically, it is the scheme, host and port portion of the request URI. </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>String</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Yes </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The Endpoint URI of the source endpoint in the Camel exchange </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> In </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <a shape="rect" class="external-link" href="http://localhost:9000" rel="nofollow">http://localhost:9000</a> </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>CamelHttpPath</code> (before 2.0-m2: <code>CamelCxfBeanRequestPat</code>h) </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Request URI's path </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>String</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Yes </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> None </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> In </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>consumer/123</code> </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>CamelHttpMethod</code> (before 2.0-m2: <code>CamelCxfBeanVerb</code>) </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> RESTful request verb </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>String</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Yes </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> None </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> In </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>GET</code>, <code>PUT</code>, <code>POST</code>, <code>DELETE</code> </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>CamelHttpResponseCode</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> HTTP response code </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>Integer</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> No <br clear="none" class="atl-forced-newline"> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> None </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Out <br clear="none" class="atl-forced-newline"> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> 200 <br clear="none" class="atl-forced-newline"> </p></td></tr></tbody></table> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-note">
 <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Currently, the CXF Bean component has (only) been tested with the <a shape="rect" href="jetty.html">Jetty component</a>. It understands headers from <a shape="rect" href="jetty.html">Jetty component</a> without requiring conversion.</p>
 </div>
</div><h3 id="BookInOnePage-AWorkingSample">A Working Sample</h3><p>This sample shows how to create a route that starts an embedded Jetty HTTP server. The route sends requests to a CXF Bean and invokes a JAX-RS annotated service.</p><p>First, create a route as follows: The <code>from</code> endpoint is a Jetty HTTP endpoint that is listening on port 9000. Notice that the <code>matchOnUriPrefix</code> option must be set to <code>true</code> because the RESTful request URI will not exactly match the endpoint's URI http:&#173;//localhost:9000.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from ref=&amp;quot;ep1&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;cxfbean:customerServiceBean&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;mock:endpointA&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>The <code>to</code> endpoint is a CXF Bean with bean name <code>customerServiceBean</code>. The name will be looked up from the registry. Next, we make sure our service bean is available in Spring registry. We create a bean definition in the Spring configuration. In this example, we create a List of service beans (of one element). We could have created just a single bean without a List.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;util:list id=&amp;quot;customerServiceBean&amp;quot;&amp;gt; &amp;lt;bean class=&amp;quot;org.apache.camel.component.cxf.jaxrs.testbean.CustomerService&amp;quot; /&amp;gt; &amp;lt;/util:list&amp;gt; &amp;lt;bean class=&amp;quot;org.apache.camel.wsdl_first.PersonImpl&amp;quot; id=&amp;quot;jaxwsBean&amp;quot; /&amp;gt; </script> 
 </div>
</div><p>That's it. Once the route is started, the web service is ready for business. A HTTP client can make a request and receive response.</p><h2 id="BookInOnePage-CXFRSComponent">CXFRS Component</h2><div class="confluence-information-macro confluence-information-macro-note">
 <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>When using CXF as a consumer, the <a shape="rect" href="cxf-bean-component.html">CXF Bean Component</a> allows you to factor out how message payloads are received from their processing as a RESTful or SOAP web service. This has the potential of using a multitude of transports to consume web services. The bean component's configuration is also simpler and provides the fastest method to implement web services using Camel and CXF.</p>
 </div>
</div><p>The <strong>cxfrs:</strong> component provides integration with <a shape="rect" href="http://cxf.apache.org">Apache CXF</a> for connecting to JAX-RS 1.1 and 2.0 services hosted in CXF.</p><p>Maven users will need to add the following dependency to their pom.xml for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-cxf&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.13">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">cxfrs://address?options </script> 
 </div>
</div><p>Where <strong>address</strong> represents the CXF endpoint's address</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">cxfrs:bean:rsEndpoint </script> 
 </div>
</div><p>Where <strong>rsEndpoint</strong> represents the spring bean's name which presents the CXFRS client or server</p><p>For either style above, you can append options to the URI as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">cxfrs:bean:cxfEndpoint?resourceClasses=org.apache.camel.rs.Example </script> 
 </div>
</div><h3 id="BookInOnePage-Options.30">Options</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Example</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Required?</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>default value</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>resourceClasses</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The resource classes which you want to export as REST service. Multiple classes can be separated by comma.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>resourceClasses=org.apache.camel.rs.Example1,</code><br clear="none"> <code>org.apache.camel.rs.Exchange2</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em>None</em></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>resourceClass</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Deprecated</strong>: Use <code>resourceClasses</code> The resource class which you want to export as REST service.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>resourceClass =org.apache.camel.rs.Example1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em>None</em></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpClientAPI</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>new to Camel 2.1</strong> If it is true, the CxfRsProducer will use the HttpClientAPI to invoke the service <br clear="none" class="atl-forced-newline"> If it is false, the CxfRsProducer will use the ProxyClientAPI to invoke the service</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>httpClientAPI=true</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em>true</em></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>synchronous</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>New in 2.5, this option will let CxfRsConsumer decide to use sync or async API to do the underlying work. The default value is false which means it will try to use async API by default.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>synchronous=true</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>false</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>throwExceptionOnFailure</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>New in 2.6, this option tells the CxfRsProducer to inspect return codes and will generate an Exception if the return code is larger than 207.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>throwExceptionOnFailure=true</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>true</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxClientCacheSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>New in 2.6, you can set a IN message header CamelDestinationOverrideUrl to dynamically override the target destination Web Service or REST Service defined in your routes.&#160; The implementation caches CXF clients or ClientFactoryBean in CxfProvider and CxfRsProvider.&#160; This option allows you to configure the maximum size of the cache.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>maxClientCacheSize=5</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>10</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>setDefaultBus</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>New in 2.9.0. <strong>deprecated</strong> use defaultBus option from Camel 2.16 onwards. Will set the default bus when CXF endpoint create a bus by itself</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>setDefaultBus=true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em>false</em></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>defaultBus</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> <span>Will set the default bus when CXF endpoint create a bus by itself</span></td><td colspan="1" rowspan="1" class="confluenceTd"><code>defaultBus=true</code></td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd"><em>false</em></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bus</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>New in 2.9.0. A default bus created by CXF Bus Factory. Use <code>#</code> notation to reference a bus object from the registry. The referenced object must be an instance of <code>org.apache.cxf.Bus</code>.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bus=#busName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em>None</em></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bindingStyle</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>As of 2.11</strong>. Sets how requests and responses will be mapped to/from Camel. Two values are possible:</p>
     <ul class="alternate"><li><code>SimpleConsumer</code> =&gt; see the <a shape="rect" href="#BookInOnePage-ConsumingaRESTRequest-SimpleBindingStyle">Consuming a REST Request with the Simple Binding Style</a> below.</li><li><code>Default</code> =&gt; the default style. For consumers this passes on a <code>MessageContentsList</code> to the route, requiring low-level processing in the route.</li><li><span style="font-family: monospace;">Custom</span> =&gt; allows you to specify a custom binding through the <code>binding</code> option.</li></ul></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bindingStyle=SimpleConsumer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em>Default</em></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code><span>binding</span></code></p></td><td colspan="1" rowspan="1" class="confluenceTd">Allows you to specify a custom <code>CxfRsBinding</code> implementation to perform low-level processing of the raw CXF request and response objects. The implementation must be bound in the Camel registry, and you must use the hash (#) notation to refer to it.</td><td colspan="1" rowspan="1" class="confluenceTd"><code><span>binding=#myBinding</span></code></td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd"><code>DefaultCxfRsBinding</code></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code><span style="line-height: 1.4285715;">providers</span></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong style="line-height: 1.4285715;">Since Camel 2.12.2</strong><span style="line-height: 1.4285715;"> set custom JAX-RS providers list to the CxfRs endpoint.</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>providers=#MyProviders</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em style="line-height: 1.4285715;">None</em></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code><span style="line-height: 1.4285715;">schemaLocations</span></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong style="line-height: 1.4285715;">Since Camel 2.12.2</strong><span style="line-height: 1.4285715;"> Sets the locations of the schemas which can be used to validate the incoming XML or JAXB-driven JSON.</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>schemaLocations=#MySchemaLocations</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em style="line-height: 1.4285715;">None</em></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code><span style="line-height: 1.4285715;">features</span></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong style="line-height: 1.4285715;">Since Camel 2.12.3</strong><span style="line-height: 1.4285715;"> Set the feature list to the CxfRs endpoint.</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>features=#MyFeatures</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em style="line-height: 1.4285715;">None</em></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>properties</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong style="line-height: 1.4285715;">Since Camel 2.12.4</strong><span style="line-height: 1.4285715;"> Set the properties to the CxfRs endpoint.</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>properties=#MyProperties</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em style="line-height: 1.4285715;">None</em></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>inInterceptors</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong style="line-height: 1.4285715;">Since Camel 2.12.4</strong><span style="line-height: 1.4285715;"> Set the inInterceptors to the CxfRs endpoint.</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>inInterceptors=#MyInterceptors</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em style="line-height: 1.4285715;">None</em></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>outInterceptors</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong style="line-height: 1.4285715;">Since Camel 2.12.4</strong><span style="line-height: 1.4285715;"> Set the outInterceptor to the CxfRs endpoint.</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code><span style="line-height: 1.4285715;">outInterceptors=#MyInterceptors</span></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="line-height: 1.4285715;">No</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em style="line-height: 1.4285715;">None</em></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code><span>inFaultInterceptors</span></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong style="line-height: 1.4285715;">Since Camel 2.12.4</strong><span style="line-height: 1.4285715;"> Set the inFaultInterceptors to the CxfRs endpoint.</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code><span style="line-height: 1.4285715;">inFaultInterceptors=#MyInterceptors</span></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="line-height: 1.4285715;">No</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em style="line-height: 1.4285715;">None</em></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>outFaultIntercetpros</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong style="line-height: 1.4285715;">Since Camel 2.12.4</strong><span style="line-height: 1.4285715;"> Set the outFaultInterceptors to the CxfRs endpoint.</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code><span style="line-height: 1.4285715;">outFaultInterceptors=#MyInterceptors</span></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="line-height: 1.4285715;">No</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em style="line-height: 1.4285715;">None</em></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>continuationTimeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="line-height: 1.4285715;"><strong>Since</strong>&#160;</span><strong style="line-height: 1.4285715;">Camel 2.14.0&#160;</strong><span style="line-height: 1.4285715;">This option is used to set the CXF continuation timeout which could be used in CxfConsumer by default when the CXF server is using Jetty or Servlet transport. (Before&#160;</span><strong style="line-height: 1.4285715;">Camel 2.14.0</strong><span style="line-height: 1.4285715;">, CxfConsumer just set the continuation timeout to be 0, which means the continuation suspend operation never timeout.)</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code><span style="line-height: 1.4285715;">continuationTimeout=800000</span></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em style="line-height: 1.4285715;">30000</em></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>ignoreDeleteMethodMessageBody</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Since Camel 2.14.1</strong> This option is used to tell CxfRsProducer to ignore the message body of the DELETE method when using HTTP API.</td><td colspan="1" rowspan="1" class="confluenceTd"><code><span>ignoreDeleteMethodMessageBody=true</span></code></td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd"><em>false</em></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>modelRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.14.2</strong> This option is used to specify the <a shape="rect" href="http://cxf.apache.org/docs/jax-rs-advanced-features.html#JAX-RSAdvancedFeatures-RESTfulserviceswithoutannotations">model file</a> which is useful for the resource class without annotation.</p><p><strong>Since Camel 2.15</strong> This option can point to a model file without specifying a service class for emulating document-only endpoints</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>modelRef=</code><a shape="rect" class="external-link" href="http://classpath/org/apache/camel/component/cxf/jaxrs/CustomerServiceModel.xml" style="font-family: monospace;line-height: 1.4285715;" rel="nofollow">classpath:/CustomerServiceModel.xml</a></p></td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd"><em>None</em></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="p1"><code>performInvocation</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Since Camel 2.15</strong> When the option is true, camel will perform the invocation of the resource class instance and put the response object into the exchange for further processing.</td><td colspan="1" rowspan="1" class="confluenceTd"><p class="p1"><code>performInvocation= true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd"><em>false</em></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>propagateContexts</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Since Camel 2.15</strong> When the option is true, JAXRS <a shape="rect" class="external-link" href="https://jax-rs-spec.java.net/nonav/2.0-rev-a/apidocs/javax/ws/rs/core/UriInfo.html" rel="nofollow">UriInfo</a>, <a shape="rect" class="external-link" href="https://jax-rs-spec.java.net/nonav/2.0-rev-a/apidocs/javax/ws/rs/core/HttpHeaders.html" rel="nofollow">HttpHeaders</a>, <a shape="rect" class="external-link" href="https://jax-rs-spec.java.net/nonav/2.0-rev-a/apidocs/javax/ws/rs/core/Request.html" rel="nofollow">Request</a> and <a shape="rect" class="external-link" href="https://jax-rs-spec.java.net/nonav/2.0-rev-a/apidocs/javax/ws/rs/core/SecurityContext.html" rel="nofollow">SecurityContext</a> contexts will be available to custom CXFRS processors as typed Camel exchange properties. These contexts can be used to analyze the current requests using JAX-RS API.</td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>loggingFeatureEnabled</code></td><td colspan="1" rowspan="1" class="confluenceTd">This option enables CXF Logging Feature which writes inbound and outbound REST messages to log.</td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd"><em>false</em></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>skipFaultLogging</code></td><td colspan="1" rowspan="1" class="confluenceTd">This option controls whether the <code>PhaseInterceptorChain</code> skips logging the Fault that it catches.</td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd"><em>false</em></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>loggingSizeLimit</code></td><td colspan="1" rowspan="1" class="confluenceTd">To limit the total size of number of bytes the logger will output when logging feature has been enabled.</td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd"><code>0</code></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>cookieHandler</code></td><td colspan="1" rowspan="1" class="confluenceTd">Since <strong>Camel 2.19.0</strong> Configure a cookie handler to maintain a HTTP session</td><td colspan="1" rowspan="1" class="confluenceTd"><code>cookieHandler=#exchangeCookieHandler</code></td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd"><em>None</em></td></tr></tbody></table>
</div><p>You can also configure the CXF REST endpoint through the spring configuration. Since there are lots of difference between the CXF REST client and CXF REST Server, we provide different configuration for them.<br clear="none"> Please check out the <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-cxf/src/main/resources/schema/cxfEndpoint.xsd">schema file</a> and <a shape="rect" class="external-link" href="https://cwiki.apache.org/CXF20DOC/JAX-RS">CXF JAX-RS documentation</a> for more information.</p><h3 id="BookInOnePage-HowtoconfiguretheRESTendpointinCamel">How to configure the REST endpoint in Camel</h3><p>In <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-cxf/src/main/resources/schema/cxfEndpoint.xsd">camel-cxf schema file</a>, there are two elements for the REST endpoint definition. <strong>cxf:rsServer</strong> for REST consumer, <strong>cxf:rsClient</strong> for REST producer.<br clear="none"> You can find a Camel REST service route configuration example here.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;beans xmlns=&amp;quot;http://www.springframework.org/schema/beans&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:cxf=&amp;quot;http://camel.apache.org/schema/cxf&amp;quot; xmlns:jaxrs=&amp;quot;http://cxf.apache.org/jaxrs&amp;quot; xsi:schemaLocation=&amp;quot; http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://camel.apache.org/schema/cxf http://camel.apache.org/schema/cxf/camel-cxf.xsd http://cxf.apache.org/jaxrs http://cxf.apache.org/schemas/jaxrs.xsd http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd &amp;quot;&amp;gt; &amp;lt;bean class=&amp;quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&amp;quot;/&amp;gt; &amp;lt;!-- Defined the real JAXRS back end service --&amp;gt; &amp;lt;jaxrs:server id=&amp;quot;restService&amp;quot; address=&amp;quot;http://localhost:${CXFTestSupport.port2}/CxfRsRouterTest/rest&amp;quot; staticSubresourceResolution=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;jaxrs:serviceBeans&amp;gt; &amp;lt;ref bean=&amp;quot;customerService&amp;quot;/&amp;gt; &amp;lt;/jaxrs:serviceBeans&amp;gt; &amp;lt;/jaxrs:server&amp;gt; &amp;lt;bean id=&amp;quot;jsonProvider&amp;quot; class=&amp;quot;org.apache.cxf.jaxrs.provider.json.JSONProvider&amp;quot;/&amp;gt; &amp;lt;bean id=&amp;quot;customerService&amp;quot; class=&amp;quot;org.apache.camel.component.cxf.jaxrs.testbean.CustomerService&amp;quot; /&amp;gt; &amp;lt;!-- Defined the server endpoint to create the cxf-rs consumer --&amp;gt; &amp;lt;cxf:rsServer id=&amp;quot;rsServer&amp;quot; address=&amp;quot;http://localhost:${CXFTestSupport.port1}/CxfRsRouterTest/route&amp;quot; serviceClass=&amp;quot;org.apache.camel.component.cxf.jaxrs.testbean.CustomerService&amp;quot; loggingFeatureEnabled=&amp;quot;true&amp;quot; loggingSizeLimit=&amp;quot;20&amp;quot; skipFaultLogging=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;cxf:providers&amp;gt; &amp;lt;ref bean=&amp;quot;jsonProvider&amp;quot;/&amp;gt; &amp;lt;/cxf:providers&amp;gt; &amp;lt;/cxf:rsServer&amp;gt; &amp;lt;!-- Defined the client endpoint to create the cxf-rs producer --&amp;gt; &amp;lt;cxf:rsClient id=&amp;quot;rsClient&amp;quot; address=&amp;quot;http://localhost:${CXFTestSupport.port2}/CxfRsRouterTest/rest&amp;quot; serviceClass=&amp;quot;org.apache.camel.component.cxf.jaxrs.testbean.CustomerService&amp;quot; loggingFeatureEnabled=&amp;quot;true&amp;quot; skipFaultLogging=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;cxf:providers&amp;gt; &amp;lt;ref bean=&amp;quot;jsonProvider&amp;quot;/&amp;gt; &amp;lt;/cxf:providers&amp;gt; &amp;lt;/cxf:rsClient&amp;gt; &amp;lt;!-- The camel route context --&amp;gt; &amp;lt;camelContext id=&amp;quot;camel&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;!-- Just need to ignoreDeleteMethodMessageBody --&amp;gt; &amp;lt;from uri=&amp;quot;cxfrs://bean://rsServer&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;log:body?level=INFO&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;cxfrs://bean://rsClient?ignoreDeleteMethodMessageBody=true&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;/beans&amp;gt; </script> 
  </div>
 </div><h3 id="BookInOnePage-HowtooverridetheCXFproduceraddressfrommessageheader.1">How to override the CXF producer address from message header</h3><p>The&#160;<code>camel-cxfrs</code>&#160;producer supports to override the services address by setting the message with the key of "<span>CamelDestinationOverrideUrl".</span></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // set up the service address from the message header to override the setting of CXF endpoint exchange.getIn().setHeader(Exchange.DESTINATION_OVERRIDE_URL, constant(getServiceAddress())); </script> 
 </div>
</div><h3 id="BookInOnePage-ConsumingaRESTRequest-SimpleBindingStyle">Consuming a REST Request - Simple Binding Style</h3><p><strong>Available as of Camel 2.11</strong></p><p>The <code>Default</code> binding style is rather low-level, requiring the user to manually process the <code>MessageContentsList</code> object coming into the route. Thus, it tightly couples the route logic with the method signature and parameter indices of the JAX-RS operation. Somewhat inelegant, difficult and error-prone.</p><p>In contrast, the <code>SimpleConsumer</code> binding style performs the following mappings, in order to <strong>make the request data more accessible</strong> to you within the Camel Message:</p><ul><li>JAX-RS Parameters (@HeaderParam, @QueryParam, etc.) are injected as IN message headers. The header name matches the value of the annotation.</li><li>The request entity (POJO or other type) becomes the IN message body. If a single entity cannot be identified in the JAX-RS method signature, it falls back to the original <code>MessageContentsList</code>.</li><li>Binary <code>@Multipart</code> body parts become IN message attachments, supporting <code>DataHandler</code>, <code>InputStream</code>, <code>DataSource</code> and CXF's <code>Attachment</code> class.</li><li>Non-binary <code>@Multipart</code> body parts are mapped as IN message headers. The header name matches the Body Part name.</li></ul><p>Additionally, the following rules apply to the <strong>Response mapping</strong>:</p><ul><li>If the message body type is different to <code>javax.ws.rs.core.Response</code> (user-built response), a new <code>Response</code> is created and the message body is set as the entity (so long it's not null). The response status code is taken from the <code>Exchange.HTTP_RESPONSE_CODE</code> header, or defaults to 200 OK if not present.</li><li>If the message body type is equal to <code>javax.ws.rs.core.Response</code>, it means that the user has built a custom response, and therefore it is respected and it becomes the final response.</li><li>In all cases, Camel headers permitted by custom or default <code>HeaderFilterStrategy</code> are added to the HTTP response.</li></ul><h4 id="BookInOnePage-EnablingtheSimpleBindingStyle">Enabling the Simple Binding Style</h4><p>This binding style can be activated by setting the <code>bindingStyle</code> parameter in the consumer endpoint to value <code>SimpleConsumer</code>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;cxfrs:bean:rsServer?bindingStyle=SimpleConsumer&amp;quot;) .to(&amp;quot;log:TEST?showAll=true&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-Examplesofrequestbindingwithdifferentmethodsignatures">Examples of request binding with different method signatures</h4><p>Below is a list of method signatures along with the expected result from the Simple binding.</p><p><strong><code>public Response doAction(BusinessObject request);</code></strong><br clear="none"> Request payload is placed in IN message body, replacing the original MessageContentsList.</p><p><strong><code>public Response doAction(BusinessObject request, @HeaderParam("abcd") String abcd, @QueryParam("defg") String defg);</code></strong><br clear="none"> Request payload placed in IN message body, replacing the original MessageContentsList. Both request params mapped as IN message headers with names abcd and defg.</p><p><strong><code>public Response doAction(@HeaderParam("abcd") String abcd, @QueryParam("defg") String defg);</code></strong><br clear="none"> Both request params mapped as IN message headers with names abcd and defg. The original MessageContentsList is preserved, even though it only contains the 2 parameters.</p><p><strong><code>public Response doAction(@Multipart(value="body1") BusinessObject request, @Multipart(value="body2") BusinessObject request2);</code></strong><br clear="none"> The first parameter is transferred as a header with name body1, and the second one is mapped as header body2. The original MessageContentsList is preserved as the IN message body.</p><p><strong><code>public Response doAction(InputStream abcd);</code></strong><br clear="none"> The InputStream is unwrapped from the MessageContentsList and preserved as the IN message body.</p><p><strong><code>public Response doAction(DataHandler abcd);</code></strong><br clear="none"> The DataHandler is unwrapped from the MessageContentsList and preserved as the IN message body.</p><h4 id="BookInOnePage-MoreexamplesoftheSimpleBindingStyle">More examples of the Simple Binding Style</h4><p>Given a JAX-RS resource class with this method:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> @POST @Path(&amp;quot;/customers/{type}&amp;quot;) public Response newCustomer(Customer customer, @PathParam(&amp;quot;type&amp;quot;) String type, @QueryParam(&amp;quot;active&amp;quot;) @DefaultValue(&amp;quot;true&amp;quot;) boolean active) { return null; } </script> 
 </div>
</div><p>Serviced by the following route:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;cxfrs:bean:rsServer?bindingStyle=SimpleConsumer&amp;quot;) .recipientList(simple(&amp;quot;direct:${header.operationName}&amp;quot;)); from(&amp;quot;direct:newCustomer&amp;quot;) .log(&amp;quot;Request: type=${header.type}, active=${header.active}, customerData=${body}&amp;quot;); </script> 
 </div>
</div><p>The following HTTP request with XML payload (given that the Customer DTO is JAXB-annotated):</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">POST /customers/gold?active=true Payload: &amp;lt;Customer&amp;gt; &amp;lt;fullName&amp;gt;Raul Kripalani&amp;lt;/fullName&amp;gt; &amp;lt;country&amp;gt;Spain&amp;lt;/country&amp;gt; &amp;lt;project&amp;gt;Apache Camel&amp;lt;/project&amp;gt; &amp;lt;/Customer&amp;gt; </script> 
 </div>
</div><p>Will print the message:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">Request: type=gold, active=true, customerData=&amp;lt;Customer.toString() representation&amp;gt; </script> 
 </div>
</div><p>For more examples on how to process requests and write responses can be found <a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/camel/trunk/components/camel-cxf/src/test/java/org/apache/camel/component/cxf/jaxrs/simplebinding/">here</a>.</p><h3 id="BookInOnePage-ConsumingaRESTRequest-DefaultBindingStyle">Consuming a REST Request - Default Binding Style</h3><p>The&#160;<a shape="rect" class="external-link" href="https://cwiki.apache.org/CXF20DOC/JAX-RS">CXF JAXRS front end</a> implements the <a shape="rect" class="external-link" href="https://jsr311.java.net/" rel="nofollow">JAX-RS (JSR-311) API</a>, so we can export the resources classes as a REST service. And we leverage the <a shape="rect" class="external-link" href="http://cwiki.apache.org/confluence/display/CXF20DOC/Invokers">CXF Invoker API</a> to turn a REST request into a normal Java object method invocation.<br clear="none"> Unlike the <a shape="rect" href="restlet.html">Camel Restlet</a>&#160;component, you don't need to specify the URI template within your endpoint, CXF takes care of the REST request URI to resource class method mapping according to the JSR-311 specification. All you need to do in Camel is delegate this method request to a right processor or endpoint.</p><p>Here is an example of a CXFRS route...
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> private static final String CXF_RS_ENDPOINT_URI = &amp;quot;cxfrs://http://localhost:&amp;quot; + CXT + &amp;quot;/rest?resourceClasses=org.apache.camel.component.cxf.jaxrs.testbean.CustomerServiceResource&amp;quot;; private static final String CXF_RS_ENDPOINT_URI2 = &amp;quot;cxfrs://http://localhost:&amp;quot; + CXT + &amp;quot;/rest2?resourceClasses=org.apache.camel.component.cxf.jaxrs.testbean.CustomerService&amp;quot;; private static final String CXF_RS_ENDPOINT_URI3 = &amp;quot;cxfrs://http://localhost:&amp;quot; + CXT + &amp;quot;/rest3?&amp;quot; + &amp;quot;resourceClasses=org.apache.camel.component.cxf.jaxrs.testbean.CustomerServiceNoAnnotations&amp;amp;&amp;quot; + &amp;quot;modelRef=classpath:/org/apache/camel/component/cxf/jaxrs/CustomerServiceModel.xml&amp;quot;; private static final String CXF_RS_ENDPOINT_URI4 = &amp;quot;cxfrs://http://localhost:&amp;quot; + CXT + &amp;quot;/rest4?&amp;quot; + &amp;quot;modelRef=classpath:/org/apache/camel/component/cxf/jaxrs/CustomerServiceDefaultHandlerModel.xml&amp;quot;; private static final String CXF_RS_ENDPOINT_URI5 = &amp;quot;cxfrs://http://localhost:&amp;quot; + CXT + &amp;quot;/rest5?&amp;quot; + &amp;quot;propagateContexts=true&amp;amp;&amp;quot; + &amp;quot;modelRef=classpath:/org/apache/camel/component/cxf/jaxrs/CustomerServiceDefaultHandlerModel.xml&amp;quot;; protected RouteBuilder createRouteBuilder() throws Exception { final Processor testProcessor = new TestProcessor(); final Processor testProcessor2 = new TestProcessor2(); final Processor testProcessor3 = new TestProcessor3(); return new RouteBuilder() { public void configure() { errorHandler(new NoErrorHandlerBuilder()); from(CXF_RS_ENDPOINT_URI).process(testProcessor); from(CXF_RS_ENDPOINT_URI2).process(testProcessor); from(CXF_RS_ENDPOINT_URI3).process(testProcessor); from(CXF_RS_ENDPOINT_URI4).process(testProcessor2); from(CXF_RS_ENDPOINT_URI5).process(testProcessor3); } }; } </script> 
  </div>
 </div>And the corresponding resource class used to configure the endpoint...<div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Note about resource classes</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>By default, JAX-RS resource classes are <strong>only </strong>used to configure JAX-RS properties. Methods will <strong>not</strong> be executed during routing of messages to the endpoint. Instead, it is the responsibility of the route to do all processing.</p>
  <p>Note that starting from Camel 2.15 it is also sufficient to provide an interface only as opposed to a no-op service implementation class for the default mode.</p>
  <p>Starting from Camel 2.15, if a <strong>performInvocation</strong> option is enabled, the service implementation will be invoked first, the response will be set on the Camel exchange and the route execution will continue as usual. This can be useful for</p>
  <p>integrating the existing JAX-RS implementations into Camel routes and for post-processing JAX-RS Responses in custom processors.</p>
  <p>&#160;</p>
 </div>
</div><p>
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> @Path(&amp;quot;/customerservice/&amp;quot;) public interface CustomerServiceResource { @GET @Path(&amp;quot;/customers/{id}/&amp;quot;) Customer getCustomer(@PathParam(&amp;quot;id&amp;quot;) String id); @PUT @Path(&amp;quot;/customers/&amp;quot;) Response updateCustomer(Customer customer); @Path(&amp;quot;/{id}&amp;quot;) @PUT() @Consumes({ &amp;quot;application/xml&amp;quot;, &amp;quot;text/plain&amp;quot;, &amp;quot;application/json&amp;quot; }) @Produces({ &amp;quot;application/xml&amp;quot;, &amp;quot;text/plain&amp;quot;, &amp;quot;application/json&amp;quot; }) Object invoke(@PathParam(&amp;quot;id&amp;quot;) String id, String payload); } </script> 
  </div>
 </div><h3 id="BookInOnePage-HowtoinvoketheRESTservicethroughcamel-cxfrsproducer">How to invoke the REST service through camel-cxfrs producer</h3><p>The&#160;<a shape="rect" class="external-link" href="https://cwiki.apache.org/CXF20DOC/JAX-RS">CXF JAXRS front end</a> implements <a shape="rect" class="external-link" href="https://cwiki.apache.org/CXF20DOC/JAX-RS+Client+API#JAX-RSClientAPI-Proxy-basedAPI">a proxy-based client API</a>, with this API you can invoke the remote REST service through a proxy. The&#160;<code>camel-cxfrs</code> producer is based on this <a shape="rect" class="external-link" href="https://cwiki.apache.org/CXF20DOC/JAX-RS+Client+API#JAX-RSClientAPI-Proxy-basedAPI">proxy API</a>.<br clear="none"> You just need to specify the operation name in the message header and prepare the parameter in the message body, the <span>camel-cxfrs</span>&#160;producer will generate right REST request for you.</p><p>Here is an example:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> Exchange exchange = template.send(&amp;quot;direct://proxy&amp;quot;, new Processor() { public void process(Exchange exchange) throws Exception { exchange.setPattern(ExchangePattern.InOut); Message inMessage = exchange.getIn(); setupDestinationURL(inMessage); // set the operation name inMessage.setHeader(CxfConstants.OPERATION_NAME, &amp;quot;getCustomer&amp;quot;); // using the proxy client API inMessage.setHeader(CxfConstants.CAMEL_CXF_RS_USING_HTTP_API, Boolean.FALSE); // set a customer header inMessage.setHeader(&amp;quot;key&amp;quot;, &amp;quot;value&amp;quot;); // setup the accept content type inMessage.setHeader(Exchange.ACCEPT_CONTENT_TYPE, &amp;quot;application/json&amp;quot;); // set the parameters , if you just have one parameter // camel will put this object into an Object[] itself inMessage.setBody(&amp;quot;123&amp;quot;); } }); // get the response message Customer response = (Customer) exchange.getOut().getBody(); assertNotNull(&amp;quot;The response should not be null &amp;quot;, response); assertEquals(&amp;quot;Get a wrong customer id &amp;quot;, String.valueOf(response.getId()), &amp;quot;123&amp;quot;); assertEquals(&amp;quot;Get a wrong customer name&amp;quot;, response.getName(), &amp;quot;John&amp;quot;); assertEquals(&amp;quot;Get a wrong response code&amp;quot;, 200, exchange.getOut().getHeader(Exchange.HTTP_RESPONSE_CODE)); assertEquals(&amp;quot;Get a wrong header value&amp;quot;, &amp;quot;value&amp;quot;, exchange.getOut().getHeader(&amp;quot;key&amp;quot;)); </script> 
  </div>
 </div>The&#160;<a shape="rect" class="external-link" href="https://cwiki.apache.org/CXF20DOC/JAX-RS">CXF JAXRS front end</a> also provides <a shape="rect" href="https://cwiki.apache.org/confluence/display/CXF20DOC/JAX-RS+Client+API#JAX-RSClientAPI-CXFWebClientAPI">a http centric client API</a>.&#160;You can also invoke this API from <code>camel-cxfrs</code> producer. You need to specify the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Exchange.html#HTTP_PATH">HTTP_PATH</a> and the&#160;<a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Exchange.html#HTTP_METHOD">HTTP_METHOD</a>&#160;and let the&#160;producer use the http centric client API by using the URI option <strong>httpClientAPI</strong> or by setting the message header <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-cxf/apidocs/org/apache/camel/component/cxf/CxfConstants.html#CAMEL_CXF_RS_USING_HTTP_API">CxfConstants.CAMEL_CXF_RS_USING_HTTP_API</a>. You can turn the response object to the type class specified with the message header&#160;<a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-cxf/apidocs/org/apache/camel/component/cxf/CxfConstants.html#CAMEL_CXF_RS_RESPONSE_CLASS">CxfConstants.CAMEL_CXF_RS_RESPONSE_CLASS</a>.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> Exchange exchange = template.send(&amp;quot;direct://http&amp;quot;, new Processor() { public void process(Exchange exchange) throws Exception { exchange.setPattern(ExchangePattern.InOut); Message inMessage = exchange.getIn(); setupDestinationURL(inMessage); // using the http central client API inMessage.setHeader(CxfConstants.CAMEL_CXF_RS_USING_HTTP_API, Boolean.TRUE); // set the Http method inMessage.setHeader(Exchange.HTTP_METHOD, &amp;quot;GET&amp;quot;); // set the relative path inMessage.setHeader(Exchange.HTTP_PATH, &amp;quot;/customerservice/customers/123&amp;quot;); // Specify the response class , cxfrs will use InputStream as the response object type inMessage.setHeader(CxfConstants.CAMEL_CXF_RS_RESPONSE_CLASS, Customer.class); // set a customer header inMessage.setHeader(&amp;quot;key&amp;quot;, &amp;quot;value&amp;quot;); // since we use the Get method, so we don&amp;#39;t need to set the message body inMessage.setBody(null); } }); // get the response message Customer response = (Customer) exchange.getOut().getBody(); assertNotNull(&amp;quot;The response should not be null &amp;quot;, response); assertEquals(&amp;quot;Get a wrong customer id &amp;quot;, String.valueOf(response.getId()), &amp;quot;123&amp;quot;); assertEquals(&amp;quot;Get a wrong customer name&amp;quot;, response.getName(), &amp;quot;John&amp;quot;); assertEquals(&amp;quot;Get a wrong response code&amp;quot;, 200, exchange.getOut().getHeader(Exchange.HTTP_RESPONSE_CODE)); assertEquals(&amp;quot;Get a wrong header value&amp;quot;, &amp;quot;value&amp;quot;, exchange.getOut().getHeader(&amp;quot;key&amp;quot;)); </script> 
  </div>
 </div>From Camel 2.1, we also support to specify the query parameters from cxfrs URI for the CXFRS http centric client.
 <div class="error">
  <span class="error">Error formatting macro: snippet: java.lang.IndexOutOfBoundsException: Index: 20, Size: 20</span> 
 </div>To support the Dynamical routing, you can override the URI's query parameters by using the CxfConstants.CAMEL_CXF_RS_QUERY_MAP header to set the parameter map for it.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> Map&amp;lt;String, String&amp;gt; queryMap = new LinkedHashMap&amp;lt;String, String&amp;gt;(); queryMap.put(&amp;quot;q1&amp;quot;, &amp;quot;new&amp;quot;); queryMap.put(&amp;quot;q2&amp;quot;, &amp;quot;world&amp;quot;); inMessage.setHeader(CxfConstants.CAMEL_CXF_RS_QUERY_MAP, queryMap); </script> 
  </div>
 </div><h2 id="BookInOnePage-DataSetComponent">DataSet Component</h2><p><a shape="rect" href="testing.html">Testing</a> of distributed and asynchronous processing is notoriously difficult. The <a shape="rect" href="mock.html">Mock</a>, <a shape="rect" href="test.html">Test</a> and <a shape="rect" href="dataset.html">DataSet</a> endpoints work great with the <a shape="rect" href="testing.html">Camel Testing Framework</a> to simplify your unit and integration testing using <a shape="rect" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a> and Camel's large range of <a shape="rect" href="components.html">Components</a> together with the powerful <a shape="rect" href="bean-integration.html">Bean Integration</a>.</p><p>The DataSet component provides a mechanism to easily perform load &amp; soak testing of your system. It works by allowing you to create <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/dataset/DataSet.html">DataSet instances</a> both as a source of messages and as a way to assert that the data set is received.</p><p>Camel will use the <a shape="rect" href="log.html">throughput logger</a> when sending dataset's.</p><h3 id="BookInOnePage-URIformat.14">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">dataset:name[?options] </script> 
 </div>
</div><p>Where <strong>name</strong> is used to find the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/dataset/DataSet.html">DataSet instance</a> in the <a shape="rect" href="registry.html">Registry</a></p><p>Camel ships with a support implementation of <code>org.apache.camel.component.dataset.DataSet</code>, the <code>org.apache.camel.component.dataset.DataSetSupport</code> class, that can be used as a base for implementing your own DataSet. Camel also ships with some implementations that can be used for testing: &#160;<code>org.apache.camel.component.dataset.SimpleDataSet</code>,&#160;<code><span>org.apache.camel.component.dataset.ListDataSet</span></code><span> and&#160;</span><code><span><span>org.apache.camel.component.dataset.FileDataSet</span></span></code><span><span>, all of which extend <code>DataSetSupport</code>.</span></span></p><h3 id="BookInOnePage-Options.31">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>produceDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>3</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Allows a delay in ms to be specified, which causes producers to pause in order to simulate slow producers. Uses a minimum of 3 ms delay unless you set this option to -1 to force no delay at all.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumeDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>0</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Allows a delay in ms to be specified, which causes consumers to pause in order to simulate slow consumers.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>preloadSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>0</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sets how many messages should be preloaded (sent) before the route completes its initialization.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>initialDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>1000</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.1:</strong> Time period in millis to wait before starting sending messages.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>minRate</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>0</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Wait until the DataSet contains at least this number of messages</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>dataSetIndex</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>lenient</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17:</strong> Controls the behavior of the <em>CamelDataSetIndex</em> header. The supported values are <code>strict</code>, <code>lenient</code> and <code>off</code>. The default behavior prior to <strong>Camel 2.17</strong> can be restored using <code><span>dataSetIndex</span>=strict</code></p><p>For consumers:<br clear="none"> - <code>strict</code> or <code>lenient</code> =&gt; The <em>CamelDataSetIndex</em> header will always be set<br clear="none"> - <code>off</code> =&gt; The <em>CamelDataSetIndex</em> header will not be set</p><p>For producers:<br clear="none"> - <code>strict</code> =&gt; The <em>CamelDataSetIndex</em> header must be present and the value of the header will be verified<br clear="none"> - <code>lenient</code> =&gt; If the <em>CamelDataSetIndex</em> header is present, the value of the header will be verified. If the header is not present, it will be set.<br clear="none"> - <code>off</code> =&gt;&#160;If the <em>CamelDataSetIndex</em> header is present, the value of the header will not be verified. If the header is not present, it will not be set.</p></td></tr></tbody></table> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-ConfiguringDataSet">Configuring DataSet</h3><p>Camel will lookup in the <a shape="rect" href="registry.html">Registry</a> for a bean implementing the DataSet interface. So you can register your own DataSet as:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;myDataSet&amp;quot; class=&amp;quot;com.mycompany.MyDataSet&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;size&amp;quot; value=&amp;quot;100&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Example.20">Example</h3><p>For example, to test that a set of messages are sent to a queue and then consumed from the queue without losing any messages:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// send the dataset to a queue from(&amp;quot;dataset:foo&amp;quot;).to(&amp;quot;activemq:SomeQueue&amp;quot;); // now lets test that the messages are consumed correctly from(&amp;quot;activemq:SomeQueue&amp;quot;).to(&amp;quot;dataset:foo&amp;quot;); </script> 
 </div>
</div><p>The above would look in the <a shape="rect" href="registry.html">Registry</a> to find the <strong>foo</strong> DataSet instance which is used to create the messages.</p><p>Then you create a DataSet implementation, such as using the <code>SimpleDataSet</code> as described below, configuring things like how big the data set is and what the messages look like etc. &#160;</p><p>&#160;</p><h2 id="BookInOnePage-DataSetSupport(abstractclass)"><code>DataSetSupport</code>&#160;(abstract class)</h2><p>The DataSetSupport abstract class is a nice starting point for new DataSets, and provides some useful features to derived classes.</p><h3 id="BookInOnePage-PropertiesonDataSetSupport">Properties on DataSetSupport</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Property</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>defaultHeaders</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Map&lt;String,Object&gt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the default message body. For SimpleDataSet it is a constant payload; though if you want to create custom payloads per message, create your own derivation of <code>DataSetSupport</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>outputTransformer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.Processor</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="font-family: monospace;">null</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>size</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>long</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>10</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies how many messages to send/consume.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>reportCount</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>long</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>-1</code></td><td colspan="1" rowspan="1" class="confluenceTd"><span>Specifies the number of messages to be received before reporting progress. Useful for showing progress of a large load test. If &lt; 0, then </span><code>size</code><span> / 5, if is 0 then </span><code>size</code><span>, else set to </span><code>reportCount</code><span> value.</span></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-SimpleDataSet"><code>SimpleDataSet</code></h3><p>The <code>SimpleDataSet</code> extends <code>DataSetSupport</code>, and adds a default body.</p><h3 id="BookInOnePage-AdditionalPropertiesonSimpleDataSet">Additional Properties on SimpleDataSet</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Property</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>defaultBody</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>&lt;hello&gt;world!&lt;/hello&gt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the default message body. By default, the <code>SimpleDataSet</code> produces the same constant payload for each exchange. If you want to customize the payload for each exchange, create a Camel <code>Processor</code> and configure the <code>SimpleDataSet</code> to use it by setting the <code>outputTransformer</code> property.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-ListDataSet(Camel2.17)"><code>ListDataSet (Camel 2.17)</code></h3><p>The List<code>DataSet</code>&#160;extends&#160;<code>DataSetSupport</code>, and adds a list of default bodies.</p><h3 id="BookInOnePage-AdditionalPropertiesonListDataSet">Additional Properties on ListDataSet</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Property</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>defaultBodies</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>List&lt;Object&gt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>empty LinkedList&lt;Object&gt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the default message body. By default, the <code>ListDataSet</code><span> selects a constant payload from the list of <code>defaultBodies</code> using the <code>CamelDataSetIndex</code>. If you want to customize the payload, create a Camel </span><code>Processor</code> and configure the <code>ListDataSet</code><span> to use it by setting the </span><code>outputTransformer</code><span> property.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>size</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>long</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the size of the defaultBodies list</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>Specifies how many messages to send/consume. This value can be different from the size of the <code>defaultBodies</code> list. If the value is less than the size of the <code>defaultBodies</code> list, some of the list elements will not be used. If the value is greater than the size of the <code>defaultBodies</code> list, the payload for the exchange will be selected using the modulus of the <code>CamelDataSetIndex</code> and the size of the <code>defaultBodies</code> list (i.e. <code>CamelDataSetIndex % defaultBodies.size()</code> )</span></p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-FileDataSet(Camel2.17)"><code>FileDataSet (Camel 2.17)</code></h3><p>The&#160;<code>SimpleDataSet</code>&#160;extends <code>ListDataSet</code>, and adds support for loading the bodies from a file.</p><h3 id="BookInOnePage-AdditionalPropertiesonFileDataSet">Additional Properties on FileDataSet</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Property</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sourceFile</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>File</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="font-family: monospace;">null</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the source file for payloads</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>delimiter</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="font-family: monospace;">\z</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the delimiter pattern used by a <code>java.util.Scanner</code> to split the file into multiple payloads.</p></td></tr></tbody></table> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.30">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul><li><a shape="rect" href="spring-testing.html">Spring Testing</a></li></ul><h2 id="BookInOnePage-Db4oComponent">Db4o Component</h2><p><strong>Available as of Camel 2.5</strong></p><p>The <strong>db4o:</strong> component allows you to work with <a shape="rect" class="external-link" href="http://www.db4o.com" rel="nofollow">db4o</a> NoSQL database. The camel-db4o library is provided by the <a shape="rect" class="external-link" href="http://code.google.com/p/camel-extra/" rel="nofollow">Camel Extra</a> project which hosts all *GPL related components for Camel.</p><h3 id="BookInOnePage-Sendingtotheendpoint">Sending to the endpoint</h3><p>Sending POJO object to the db4o endpoint adds and saves object into the database. The body of the message is assumed to be a POJO that has to be saved into the db40 database store.</p><h3 id="BookInOnePage-Consumingfromtheendpoint">Consuming from the endpoint</h3><p>Consuming messages removes (or updates) POJO objects in the database. This allows you to use a Db4o datastore as a logical queue; consumers take messages from the queue and then delete them to logically remove them from the queue.</p><p>If you do not wish to delete the object when it has been processed, you can specify <code>consumeDelete=false</code> on the URI. This will result in the POJO being processed each poll.</p><h3 id="BookInOnePage-URIformat.15">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> db4o:className[?options] </script> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.32">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default Value </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumeDelete</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Option for <code>Db4oConsumer</code> only. Specifies whether or not the entity is deleted after it is consumed.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>consumer.delay</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>500</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Option for consumer only. Delay in millis between each poll. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>consumer.initialDelay</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>1000</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Option for consumer only. Millis before polling starts. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>consumer.userFixedDelay</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Option for consumer only. Set to <code>true</code> to use fixed delay between polls, otherwise fixed rate is used. See <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ScheduledExecutorService.html" rel="nofollow">ScheduledExecutorService</a> in JDK for details. </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-SeeAlso.31">See Also</h3><ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-DirectComponent">Direct Component</h2><p>The <strong>direct:</strong> component provides direct, synchronous invocation of any consumers when a producer sends a message exchange.<br clear="none"> This endpoint can be used to connect existing routes in the <strong>same</strong> camel context.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Asynchronous</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The <a shape="rect" href="seda.html">SEDA</a> component provides asynchronous invocation of any consumers when a producer sends a message exchange.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Connection to other camel contexts</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The <a shape="rect" href="vm.html">VM</a> component provides connections between Camel contexts as long they run in the same <strong>JVM</strong>.</p>
 </div>
</div><h3 id="BookInOnePage-URIformat.16">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter">direct:someName[?options] </script> 
 </div>
</div><p>Where <strong>someName</strong> can be any string to uniquely identify the endpoint</p><h3 id="BookInOnePage-Options.33">Options</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th><th colspan="1" rowspan="1" class="confluenceTh">&#160;</th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>allowMultipleConsumers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>@deprecated</strong> If set to <code>false</code>, then when a second consumer is started on the endpoint, an <code>IllegalStateException</code> is thrown. <strong>Will be removed in Camel 2.1:</strong> Direct endpoint does not support multiple consumers.</p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>block</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.1:</strong> If sending a message to a direct endpoint which has no active consumer, then we can tell the producer to block and wait for the consumer to become active.</p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>timeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>30000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.1:</strong> The timeout value to use if block is enabled.</p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>failIfNoConsumers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>true</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16.0</strong>: Indicates whether the producer should fail by throwing an exception when sending to a DIRECT endpoint with no active consumers.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr></tbody></table>
</div><pre>You can append query options to the URI in the following format, ?option=value&amp;option=value&amp;...</pre><p>&#160;</p><h3 id="BookInOnePage-Samples.7">Samples</h3><p>In the route below we use the direct component to link the two routes together:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:queue:order.in&amp;quot;) .to(&amp;quot;bean:orderServer?method=validate&amp;quot;) .to(&amp;quot;direct:processOrder&amp;quot;); from(&amp;quot;direct:processOrder&amp;quot;) .to(&amp;quot;bean:orderService?method=process&amp;quot;) .to(&amp;quot;activemq:queue:order.out&amp;quot;); </script> 
 </div>
</div><p>And the sample using spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:queue:order.in&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:orderService?method=validate&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:processOrder&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:processOrder&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:orderService?method=process&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;activemq:queue:order.out&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>See also samples from the <a shape="rect" href="seda.html">SEDA</a> component, how they can be used together.</p><p></p><h3 id="BookInOnePage-SeeAlso.32">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="seda.html">SEDA</a></li><li><a shape="rect" href="vm.html">VM</a></li></ul><h2 id="BookInOnePage-DNS">DNS</h2><p><strong>Available as of Camel 2.7</strong></p><p>This is an additional component for Camel to run DNS queries, using DNSJava. The component is a thin layer on top of <a shape="rect" class="external-link" href="http://www.xbill.org/dnsjava/" rel="nofollow">DNSJava</a>.<br clear="none"> The component offers the following operations:</p><ul class="alternate"><li>ip, to resolve a domain by its ip</li><li>lookup, to lookup information about the domain</li><li>dig, to run DNS queries</li></ul><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Requires SUN JVM</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The DNSJava library requires running on the SUN JVM.<br clear="none"> If you use Apache ServiceMix or Apache Karaf, you'll need to adjust the <code>etc/jre.properties</code> file, to add <code>sun.net.spi.nameservice</code> to the list of Java platform packages exported. The server will need restarting before this change takes effect.</p>
 </div>
</div><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-dns&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.17">URI format</h3><p>The URI scheme for a DNS component is as follows</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">dns://operation[?options] </script> 
 </div>
</div><p>This component only supports producers.</p><h3 id="BookInOnePage-Options.34">Options</h3><p>None.</p><h3 id="BookInOnePage-Headers.1">Headers</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Operations</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>dns.domain</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>String</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>ip</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The domain name. Mandatory.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>dns.name</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>String</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>lookup</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The name to lookup. Mandatory.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>dns.type</p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p>lookup, dig</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The type of the lookup. Should match the values of <code>org.xbill.dns.Type</code>. Optional.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>dns.class</p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p>lookup, dig</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The DNS class of the lookup. Should match the values of <code>org.xbill.dns.DClass</code>. Optional.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>dns.query</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>String</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>dig</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The query itself. Mandatory.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>dns.server</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>String</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>dig</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The server in particular for the query. If none is given, the default one specified by the OS will be used. Optional.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Examples.13">Examples</h3><h4 id="BookInOnePage-IPlookup">IP lookup</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route id=&amp;quot;IPCheck&amp;quot;&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;dns:ip&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>This looks up a domain's IP. For example, www.example.com resolves to 192.0.32.10.<br clear="none"> The IP address to lookup must be provided in the header with key <code>"dns.domain"</code>.</p><h4 id="BookInOnePage-DNSlookup">DNS lookup</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route id=&amp;quot;IPCheck&amp;quot;&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;dns:lookup&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>This returns a set of DNS records associated with a domain.<br clear="none"> The name to lookup must be provided in the header with key <code>"dns.name"</code>.</p><h4 id="BookInOnePage-DNSDig">DNS Dig</h4><p>Dig is a Unix command-line utility to run DNS queries.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route id=&amp;quot;IPCheck&amp;quot;&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;dns:dig&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>The query must be provided in the header with key <code>"dns.query"</code>.</p><p></p><h3 id="BookInOnePage-SeeAlso.33">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-EJBComponent">EJB Component</h2><p><strong>Available as of Camel 2.4</strong></p><p>The <strong>ejb:</strong> component binds EJBs to Camel message exchanges.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-ejb&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.18">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> ejb:ejbName[?options] </script> 
 </div>
</div><p>Where <strong>ejbName</strong> can be any string which is used to look up the EJB in the Application Server JNDI <a shape="rect" href="registry.html">Registry</a></p><h3 id="BookInOnePage-Options.35">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Type </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>method</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>String</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>null</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The method name that bean will be invoked. If not provided, Camel will try to pick the method itself. In case of ambiguity an exception is thrown. See <a shape="rect" href="bean-binding.html">Bean Binding</a> for more details. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>multiParameterArray</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>boolean</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> How to treat the parameters which are passed from the message body; if it is <code>true</code>, the In message body should be an array of parameters. </p></td></tr></tbody></table> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><p>The <a shape="rect" href="ejb.html">EJB</a> component extends the <a shape="rect" href="bean.html">Bean</a> component in which most of the details from the <a shape="rect" href="bean.html">Bean</a> component applies to this component as well.</p><h3 id="BookInOnePage-BeanBinding.2">Bean Binding</h3><p>How bean methods to be invoked are chosen (if they are not specified explicitly through the <strong>method</strong> parameter) and how parameter values are constructed from the <a shape="rect" href="message.html">Message</a> are all defined by the <a shape="rect" href="bean-binding.html">Bean Binding</a> mechanism which is used throughout all of the various <a shape="rect" href="bean-integration.html">Bean Integration</a> mechanisms in Camel.</p><h3 id="BookInOnePage-Examples.14">Examples</h3><p>In the following examples we use the Greater EJB which is defined as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>GreaterLocal.java</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public interface GreaterLocal { String hello(String name); String bye(String name); } </script> 
 </div>
</div><p>And the implementation</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>GreaterImpl.java</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> @Stateless public class GreaterImpl implements GreaterLocal { public String hello(String name) { return &amp;quot;Hello &amp;quot; + name; } public String bye(String name) { return &amp;quot;Bye &amp;quot; + name; } } </script> 
 </div>
</div><h4 id="BookInOnePage-UsingJavaDSL">Using Java DSL</h4><p>In this example we want to invoke the <code>hello</code> method on the EJB. Since this example is based on an unit test using Apache OpenEJB we have to set a <code>JndiContext</code> on the <a shape="rect" href="ejb.html">EJB</a> component with the OpenEJB settings.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> @Override protected CamelContext createCamelContext() throws Exception { CamelContext answer = new DefaultCamelContext(); // enlist EJB component using the JndiContext EjbComponent ejb = answer.getComponent(&amp;quot;ejb&amp;quot;, EjbComponent.class); ejb.setContext(createEjbContext()); return answer; } private static Context createEjbContext() throws NamingException { // here we need to define our context factory to use OpenEJB for our testing Properties properties = new Properties(); properties.setProperty(Context.INITIAL_CONTEXT_FACTORY, &amp;quot;org.apache.openejb.client.LocalInitialContextFactory&amp;quot;); return new InitialContext(properties); } </script> 
 </div>
</div><p>Then we are ready to use the EJB in the Camel route:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) // invoke the greeter EJB using the local interface and invoke the hello method .to(&amp;quot;ejb:GreaterImplLocal?method=hello&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">In a real application server</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body"> 
  <p>In a real application server you most likely do not have to setup a <code>JndiContext</code> on the <a shape="rect" href="ejb.html">EJB</a> component as it will create a default <code>JndiContext</code> on the same JVM as the application server, which usually allows it to access the JNDI registry and lookup the <a shape="rect" href="ejb.html">EJB</a>s.<br clear="none"> However if you need to access a application server on a remote JVM or the likes, you have to prepare the properties beforehand.</p>
 </div>
</div><h4 id="BookInOnePage-UsingSpringXML.4">Using Spring XML</h4><p>And this is the same example using Spring XML instead:</p><p>Again since this is based on an unit test we need to setup the <a shape="rect" href="ejb.html">EJB</a> component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- setup Camel EJB component --&amp;gt; &amp;lt;bean id=&amp;quot;ejb&amp;quot; class=&amp;quot;org.apache.camel.component.ejb.EjbComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;properties&amp;quot; ref=&amp;quot;jndiProperties&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;!-- use OpenEJB context factory --&amp;gt; &amp;lt;p:properties id=&amp;quot;jndiProperties&amp;quot;&amp;gt; &amp;lt;prop key=&amp;quot;java.naming.factory.initial&amp;quot;&amp;gt;org.apache.openejb.client.LocalInitialContextFactory&amp;lt;/prop&amp;gt; &amp;lt;/p:properties&amp;gt; </script> 
 </div>
</div><p>Before we are ready to use <a shape="rect" href="ejb.html">EJB</a> in the Camel routes:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;ejb:GreaterImplLocal?method=hello&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-SeeAlso.34">See Also</h3><ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul><li><a shape="rect" href="bean.html">Bean</a></li><li><a shape="rect" href="bean-binding.html">Bean Binding</a></li><li><a shape="rect" href="bean-integration.html">Bean Integration</a></li></ul><h2 id="BookInOnePage-Esper">Esper</h2><p>The Esper component supports the <a shape="rect" class="external-link" href="http://esper.codehaus.org" rel="nofollow">Esper Library</a> for Event Stream Processing. The <strong>camel-esper</strong> library is provided by the <a shape="rect" class="external-link" href="http://code.google.com/p/camel-extra/" rel="nofollow">Camel Extra</a> project which hosts all *GPL related components for Camel.</p><h3 id="BookInOnePage-URIformat.19">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">esper:name[?options] </script> 
 </div>
</div><p>When consuming from an Esper endpoint you must specify a <strong>pattern</strong> or <strong>eql</strong> statement to query the event stream.</p><p>Pattern example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;esper://cheese?pattern=every event=MyEvent(bar=5)&amp;quot;) .to(&amp;quot;activemq:Foo&amp;quot;); </script> 
 </div>
</div><p>EQL example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;esper://esper-dom?eql=insert into DomStream select * from org.w3c.dom.Document&amp;quot;) .to(&amp;quot;log://esper-dom?level=INFO&amp;quot;); from(&amp;quot;esper://esper-dom?eql=select childNodes from DomStream&amp;quot;) .to(&amp;quot;mock:results&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-Options.36">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default Value </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>configured</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> false </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Available as of camel-extra 2.11.3:<br clear="none"> If flag is set to 'true' the default Esper configuration file (esper.cfg.xml) will be used.&#160;<br clear="none"> To configure Esper via a configuration file, please refer to the <a shape="rect" class="external-link" href="http://esper.codehaus.org/esper-4.2.0/doc/reference/en/html/configuration.html" rel="nofollow">Esper documentation</a> </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>pattern</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The <a shape="rect" class="external-link" href="http://esper.codehaus.org/esper-4.10.0/doc/reference/en-US/html/event_patterns.html" rel="nofollow">Esper Pattern expression</a> as a String to filter events </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>eql</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The <a shape="rect" class="external-link" href="http://esper.codehaus.org/esper-4.10.0/doc/reference/en-US/html/epl_clauses.html" rel="nofollow">Esper EQL expression</a> as a String to filter events </p></td></tr></tbody></table> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-EsperMessage">EsperMessage</h3><p>From <strong>Camel 2.12</strong> onwards the esper consumer stores new and old events in the <code>org.apacheextras.camel.component.esper.EsperMessage</code> message as the input <a shape="rect" href="message.html">Message</a> on the <a shape="rect" href="exchange.html">Exchange</a>. You can get access to the esper event beans from java code with:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> EventBean newEvent = exchange.getIn(EsperMessage.class).getNewEvent(); EventBean oldEvent = exchange.getIn(EsperMessage.class).getOldEvent(); </script> 
 </div>
</div><p>By default if you get the body of <code>org.apacheextras.camel.component.esper.EsperMessage</code> it returns the new <code>EventBean</code> as in previous versions.</p><h3 id="BookInOnePage-Demo">Demo</h3><p>There is a <a shape="rect" class="external-link" href="http://code.google.com/p/camel-extra/wiki/EsperDemo" rel="nofollow">demo which shows how to work with ActiveMQ, Camel and Esper</a> in the <a shape="rect" class="external-link" href="http://code.google.com/p/camel-extra/" rel="nofollow">Camel Extra</a> project</p><p></p><h3 id="BookInOnePage-SeeAlso.35">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul><li><a shape="rect" class="external-link" href="http://code.google.com/p/camel-extra/wiki/EsperDemo" rel="nofollow">Esper Camel Demo</a></li></ul><div class="error">
 <span class="error">Unable to render {include}</span> The included page could not be found.
</div><h2 id="BookInOnePage-FileComponent">File Component</h2><p>The File component provides access to file systems, allowing files to be processed by any other Camel <a shape="rect" href="components.html">Components</a> or messages from other components to be saved to disk.</p><h3 id="BookInOnePage-URIformat.20">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">file:directoryName[?options] </script> 
 </div>
</div><p>or</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">file://directoryName[?options] </script> 
 </div>
</div><p>Where&#160;<strong><code>directoryName</code></strong> represents the underlying file directory.</p><p>You can append query options to the URI in the following format, <strong><code>?option=value&amp;option=value&amp;...</code></strong></p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Only directories</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Camel supports only endpoints configured with a starting directory. So the&#160;<strong><code>directoryName</code></strong> must be a directory. If you want to consume a single file only, you can use the <strong>fileName</strong> option e.g., by setting <strong><code>fileName=thefilename</code></strong>. Also, the starting directory must not contain dynamic expressions with&#160;<strong><code>${}</code></strong> placeholders. Again use the <strong><code>fileName</code></strong> option to specify the dynamic part of the filename.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-warning">
 <p class="title">Avoid reading files currently being written by another application</p>
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Beware the JDK File IO API is a bit limited in detecting whether another application is currently writing/copying a file. And the implementation can be different depending on OS platform as well. This could lead to that Camel thinks the file is not locked by another process and start consuming it. Therefore you have to do you own investigation what suites your environment. To help with this Camel provides different <strong><code>readLock</code></strong> options and <strong><code>doneFileName</code></strong> option that you can use. See also the section <em>Consuming files from folders where others drop files directly</em>.</p>
 </div>
</div><h3 id="BookInOnePage-URIOptions.1">URI Options</h3><h4 id="BookInOnePage-Common">Common</h4><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>autoCreate</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Automatically create missing directories in the file's path name. For the file consumer, that means creating the starting directory. For the file producer, it means the directory the files should be written to.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bufferSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>128kb</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Write buffer sized in bytes.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>fileName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Use <a shape="rect" href="expression.html">Expression</a> such as <a shape="rect" href="file-language.html">File Language</a> to dynamically set the filename. For consumers, it's used as a filename filter. For producers, it's used to evaluate the filename to write. If an expression is set, it take precedence over the <strong><code>CamelFileName</code></strong> header. (<strong>Note:</strong> The header itself can also be an <a shape="rect" href="expression.html">Expression</a>). The expression options support both <strong><code>String</code></strong> and <strong><code>Expression</code></strong> types. If the expression is a <strong><code>String</code></strong> type, it is <strong>always</strong> evaluated using the <a shape="rect" href="file-language.html">File Language</a>. If the expression is an <strong><code>Expression</code></strong> type, the specified <strong><code>Expression</code></strong> type is used - this allows you, for instance, to use <a shape="rect" href="ognl.html">OGNL</a> expressions.</p><p>For the consumer, you can use it to filter filenames, so you can for instance consume today's file using the <a shape="rect" href="file-language.html">File Language</a> syntax: <strong><code>mydata-${date:now:yyyyMMdd}.txt</code></strong>. From <strong>Camel 2.11</strong> onward the producers support the <strong><code>CamelOverruleFileName</code></strong> header which takes precedence over any existing <strong><code>CamelFileName</code></strong> header; the <strong><code>CamelOverruleFileName</code></strong> is a header that is used only once, and makes it easier as this avoids to temporary store <strong><code>CamelFileName</code></strong> and have to restore it afterwards.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>flatten</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Flatten is used to flatten the file name path to strip any leading paths, so it's just the file name. This allows you to consume recursively into sub-directories, but when you eg write the files to another directory they will be written in a single directory. Setting this to <code>true</code> on the producer enforces that any file name received in <strong><code>CamelFileName</code></strong> header will be stripped for any leading paths.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>charset</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.3:</strong> this option is used to specify the encoding of the file. You can use this on the consumer, to specify the encodings of the files, which allow Camel to know the charset it should load the file content in case the file content is being accessed. Likewise when writing a file, you can use this option to specify which charset to write the file as well. See further below for a examples and more important details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>copyAndDeleteOnRenameFail</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9</strong>: whether to fallback and do a copy and delete file, in case the file could not be renamed directly. This option is not available for the <a shape="rect" href="ftp2.html">FTP</a> component.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>renameUsingCopy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.13.1</strong>: Perform rename operations using a copy and delete strategy. This is primarily used in environments where the regular rename operation is unreliable e.g., across different file systems or networks. This option takes precedence over the <strong><code>copyAndDeleteOnRenameFail</code></strong> parameter that will automatically fall back to the copy and delete strategy, but only after additional delays.</p></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-Consumer">Consumer</h4><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>initialDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Milliseconds before polling the file/directory starts.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>delay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>500</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Milliseconds before the next poll of the file/directory.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>useFixedDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Controls if fixed delay or fixed rate is used. See <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ScheduledExecutorService.html" rel="nofollow">ScheduledExecutorService</a> in JDK for details.</p><p>In <strong>Camel 2.7.x</strong> or older the default value is <strong><code>false</code>. </strong></p><p>From<strong> Camel 2.8</strong> onward the default value is <strong><code>true</code>.</strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>runLoggingLevel</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>TRACE</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> The consumer logs a start/complete log line when it polls. This option allows you to configure the logging level for that.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>recursive</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If a directory, will look for files in all the sub-directories as well.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>delete</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If <strong><code>true</code></strong>, the file will be deleted <strong>after</strong> it is processed successfully.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>noop</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If <strong><code>true</code></strong>, the file is not moved or deleted in any way. This option is good for readonly data, or for <a shape="rect" href="etl.html">ETL</a> type requirements. If <strong><code>noop=true</code></strong>, Camel will set <strong><code>idempotent=true</code></strong> as well, to avoid consuming the same files over and over again.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>preMove</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="expression.html">Expression</a> (such as <a shape="rect" href="file-language.html">File Language</a>) used to dynamically set the filename when moving it <strong>before</strong> processing. For example to move in-progress files into the <strong><code>order</code></strong> directory set this value to <strong><code>order</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>move</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>.camel</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="expression.html">Expression</a> (such as <a shape="rect" href="file-language.html">File Language</a>) used to dynamically set the filename when moving it <strong>after</strong> processing. To move files into a <strong><code>.done</code></strong> subdirectory just enter <strong><code>.done</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>moveFailed</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="expression.html">Expression</a> (such as <a shape="rect" href="file-language.html">File Language</a>) used to dynamically set a different target directory when moving files <em>in case of</em> processing (configured via <code>move</code> defined above) failed.</p><p>For example, to move files into a <strong><code>.error</code></strong> subdirectory use: <strong><code>.error</code></strong>.</p><p><strong>Note</strong>: When moving the files to the &#8220;fail&#8221; location Camel will <strong>handle</strong> the error and will not pick up the file again.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>include</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Is used to include files, if filename matches the regex pattern <span>(matching is case in-sensitive from Camel </span><strong>2.17</strong><span> onward</span><span>).</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exclude</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Is used to exclude files, if filename matches the regex pattern (matching is case in-sensitive from Camel <strong>2.17</strong> onward).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>antInclude</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Ant style filter inclusion, for example <strong><code>antInclude=*</code><code>/</code><code>.txt</code></strong>. Multiple inclusions may be specified in comma-delimited format. See <a shape="rect" href="#BookInOnePage-FilteringusingANTpathmatcher">below</a> for more details about ant path filters.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>antExclude</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Ant style filter exclusion. If both <strong><code>antInclude</code></strong> and <strong><code>antExclude</code></strong> are used, <strong><code>antExclude</code></strong> takes precedence over <strong><code>antInclude</code></strong>. Multiple exclusions may be specified in comma-delimited format. See <a shape="rect" href="#BookInOnePage-FilteringusingANTpathmatcher">below</a> for more details about ant path filters.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>antFilterCaseSensitive</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> Ant style filter which is case sensitive or not.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>idempotent</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Option to use the <a shape="rect" href="idempotent-consumer.html">Idempotent Consumer</a> EIP pattern to let Camel skip already processed files. Will by default use a memory based LRUCache that holds 1000 entries. If <strong><code>noop=true</code></strong> then idempotent will be enabled as well to avoid consuming the same files over and over again.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>idempotentKey</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Expression</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> To use a custom idempotent key. By default the absolute path of the file is used. You can use the <a shape="rect" href="file-language.html">File Language</a>, for example to use the file name and file size, you can do:</p> 
      <div class="code panel pdl" style="border-width: 1px;"> 
       <div class="codeContent panelContent pdl"> 
        <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">idempotentKey=${file:name}-${file:size}</script> 
       </div> 
      </div></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>idempotentRepository</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A pluggable repository <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/spi/IdempotentRepository.html"><code>org.apache.camel.spi.IdempotentRepository</code></a> which by default use <strong><code>MemoryMessageIdRepository</code></strong> if none is specified and <strong><code>idempotent</code></strong> is <strong><code>true</code>.</strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>inProgressRepository</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>memory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A pluggable in-progress repository <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/spi/IdempotentRepository.html"><code>org.apache.camel.spi.IdempotentRepository</code></a> . The in-progress repository is used to account the current in progress files being consumed. By default a memory based repository is used.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>filter</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Pluggable filter as a <strong><code>org.apache.camel.component.file.GenericFileFilter</code></strong> class. Will skip files if filter returns <strong><code>false</code></strong> in its <strong><code>accept()</code></strong> method. More details in section below.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>filterDirectory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.18</strong>: Filters the directory based on <a shape="rect" href="simple.html">Simple</a> language. For example to filter on current date, you can use a simple date pattern such as&#160;<strong><code>${date:now:yyyMMdd</code>}.</strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>filterFile</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.18:</strong> Filters the file based on <a shape="rect" href="simple.html">Simple</a> language. For example to filter on file size, you can use&#160;<strong><code>${file}:size &gt; 5000</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>shuffle</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16:</strong> To shuffle the list of files (sort in random order).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sorter</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Pluggable sorter as a <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/Comparator.html" rel="nofollow"><code>java.util.Comparator&lt;org.apache.camel.component.file.GenericFile&gt;</code></a> class.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sortBy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Built-in sort using the <a shape="rect" href="file-language.html">File Language</a>. Supports nested sorts, so you can have a sort by file name and as a 2nd group sort by modified date. See sorting section below for details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>readLock</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>none</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Used by consumer, to only poll the files if it has exclusive read-lock on the file e.g., the file is not in-progress or being written. Camel will wait until the file lock is granted.</p><p>This option provides the built-in strategies:</p> 
      <ul><li><strong><code>none</code></strong><span> is for no read locks at all.</span></li><li><strong><code style="line-height: 1.4285715;"> markerFile</code></strong><span style="line-height: 1.4285715;"> Camel creates a marker file&#160;<strong><code>fileName.camelLock</code></strong> and then holds a lock on it. This option is </span><strong style="line-height: 1.4285715;">not</strong><span style="line-height: 1.4285715;"> available for the </span><a shape="rect" href="ftp2.html">FTP</a><span style="line-height: 1.4285715;"> component. </span></li><li><strong><code>changed</code></strong> is using file length/modification timestamp to detect whether the file is currently being copied or not. Will at least use 1 sec. to determine this, so this option cannot consume files as fast as the others, but can be more reliable as the JDK IO API cannot always determine whether a file is currently being used by another process. The option <strong><code>readLockCheckInterval</code></strong> can be used to set the check frequency. This option is <strong>only</strong> avail for the <a shape="rect" href="ftp2.html">FTP</a> component from <strong>Camel 2.8</strong> onward. Note: from <strong>Camel 2.10.1</strong> onward the <a shape="rect" href="ftp2.html">FTP</a> option <strong><code>fastExistsCheck</code></strong> can be enabled to speedup this&#160;<strong><code>readLock</code></strong> strategy, if the FTP server support the LIST operation with a full file name (some servers may not).</li><li><strong><code>fileLock</code></strong> is for using <strong><code>java.nio.channels.FileLock</code></strong>. This option is <strong>not</strong> avail for the <a shape="rect" href="ftp2.html">FTP</a> component. This approach should be avoided when accessing a remote file system via a mount/share unless that file system supports distributed file locks.</li><li><strong><code>rename</code></strong> is for using a try to rename the file as a test if we can get exclusive read-lock.</li><li><strong><code style="line-height: 1.4285715;">idempotent</code></strong><span style="line-height: 1.4285715;"> <strong>Camel 2.16</strong> (only file component) is for using a <strong><code>idempotentRepository</code></strong> as the read-lock. This allows to use read locks that supports clustering if the idempotent repository implementation supports that. </span></li><li><strong><code>idempotent-changed</code></strong><span> <strong>Camel 2.19</strong> (only file component) is for using a <strong><code>idempotentRepository</code></strong> and changed as combined read-lock. This allows to use read locks that supports clustering if the idempotent repository implementation supports that. </span></li><li><strong><code>idempotent-rename</code></strong><span> <strong>Camel 2.19</strong> (only file component) is for using a <strong><code>idempotentRepository</code></strong> and rename as combined read-lock. This allows to use read locks that supports clustering if the idempotent repository implementation supports that. </span><span style="line-height: 1.4285715;"><br clear="none"></span></li></ul><p><strong>Warning</strong>: most of the read lock strategies are not suitable for use in clustered mode. That is, you cannot have multiple consumers attempting to read the same file in the same directory. In this case, the read locks will not function reliably. The idempotent read lock supports clustered reliably if you use a cluster aware idempotent repository implementation such as from <a shape="rect" href="hazelcast-component.html">Hazelcast Component</a> or <a shape="rect" href="infinispan.html">Infinispan</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>readLockTimeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>10000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Optional timeout in milliseconds for the <strong><code>readLock</code></strong>, if supported. If the read-lock could not be granted and the timeout triggered, then Camel will skip the file. At next poll Camel, will try the file again, and this time maybe the read-lock could be granted. Use a value of&#160;<strong><code>0</code></strong> or lower to indicate forever. In <strong>Camel 2.0</strong> the default value is <strong><code>0</code></strong>. Starting with <strong>Camel 2.1</strong> the default value is <strong><code>10000</code></strong>. Currently <strong><code>fileLock</code>, </strong><code>changed</code> and <strong><code>rename</code></strong> support the timeout.</p><p><strong>Note:</strong> for <a shape="rect" href="ftp2.html">FTP</a> the default <strong><code>readLockTimeout</code></strong> value is <strong><code>20000</code></strong> instead of <strong><code>10000</code></strong>. The&#160;<strong><code>readLockTimeout</code></strong> value must be higher than <strong><code>readLockCheckInterval</code></strong>, but a rule of thumb is to have a timeout that is at least 2 or more times higher than the <strong><code>readLockCheckInterval</code></strong>. This is needed to ensure that ample time is allowed for the read lock process to try to grab the lock before the timeout was hit.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>readLockCheckInterval</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.6:</strong> Interval in milliseconds for the read-lock, if supported by the read lock. This interval is used for sleeping between attempts to acquire the read lock. For example when using the <code>changed</code> read lock, you can set a higher interval period to cater for <em>slow writes</em>. The default of 1 sec. may be <em>too fast</em> if the producer is very slow writing the file. For <a shape="rect" href="ftp2.html">FTP</a> the default <strong><code>readLockCheckInterval</code></strong> is <strong><code>5000</code></strong>. <span>The&#160;<strong><code>readLockTimeout</code></strong> value must be higher than&#160;<strong><code>readLockCheckInterval</code></strong>, but a rule of thumb is to have a timeout that is at least 2 or more times higher than the&#160;<strong><code>readLockCheckInterval</code></strong>. This is needed to ensure that ample time is allowed for the read lock process to try to grab the lock before the timeout was hit.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>readLockMinLength</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.1:</strong> This option applied only for <strong><code>readLock=changed</code></strong>. This option allows you to configure a minimum file length. By default Camel expects the file to contain data, and thus the default value is <strong>1</strong>. You can set this option to zero, to allow consuming zero-length files.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>readLockMinAge</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.15</strong>: This option applies only to <strong><code>readLock=change</code></strong>. This option allows you to specify a minimum age a file must be before attempting to acquire the read lock. For example, use&#160;<strong><code>readLockMinAge=300s</code></strong> to require that the file is at least 5 minutes old. This can speedup the poll when the file is old enough as it will acquire the read lock immediately. Notice for FTP: file timestamps reported by FTP servers are often reported with resolution of minutes, so&#160;<strong><code>readLockMinAge</code></strong> parameter should be defined in minutes, e.g. <strong>60000</strong> for 1 minute. Notice that Camel supports specifying this as <strong><code>60s</code></strong>, or <strong><code>1m</code></strong>, etc.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>readLockLoggingLevel</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>WARN</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> Logging level used when a read lock could not be acquired. By default a&#160;<strong><code>WARN</code></strong> is logged. You can change this level, for example to OFF to not have any logging.</p><p>This option is only applicable for the <strong><code>readLock</code></strong> types:</p> 
      <ul><li><strong><code>changed</code></strong></li><li><strong><code>fileLock</code></strong></li><li><strong><code>rename</code></strong></li></ul></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>readLockMarkerFile</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.14:</strong> Whether to use marker file with the <strong><code>changed</code>, <code>rename</code></strong>, or <strong><code>exclusive</code></strong> read lock types. By default a marker file is used as well to guard against other processes picking up the same files. This behavior can be turned off by setting this option to <strong><code>false</code></strong>. For example if you do not want to write marker files to the file systems by the Camel application.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>readLockRemoveOnRollback</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16:</strong> This option applied only for <strong><code>readLock=idempotent</code></strong>. This option allows to specify whether to remove the file name entry from the idempotent repository when processing the file failed and a rollback happens. If this option is false, then the file name entry is confirmed (as if the file did a commit).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span>readLockRemoveOnCommit</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16:</strong><span> This option applied only for <strong><code>readLock=idempotent</code></strong>. This option allows to specify whether to remove the file name entry from the idempotent repository when processing the file succeeded and a commit happens. By default the file is not removed which ensures that any race-condition do not occur so another active node may attempt to grab the file. Instead the idempotent repository may support eviction strategies that you can configure to evict the file name entry after X minutes - this ensures no problems with race conditions.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>readLockDeleteOrphanLockFiles</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16:</strong> Whether or not read lock with marker files should upon startup delete any orphan read lock files, which may have been left on the file system, if Camel was not properly shutdown (such as a JVM crash). If turning this option to false then any orphaned lock file will cause Camel to not attempt to pickup that file, this could also be due another node is concurrently reading files from the same shared directory.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>directoryMustExist</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> Similar to <strong><code>startingDirectoryMustExist</code></strong> but this applies during polling recursive sub directories.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>doneFileName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.6:</strong> If provided, Camel will only consume files if a <em>done</em> file exists. This option configures what file name to use. Either you can specify a fixed name. Or you can use dynamic placeholders. The <em>done</em> file is <strong>always</strong> expected in the same folder as the original file. See <em>using done file</em> and <em>writing done file</em> sections for examples.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exclusiveReadLockStrategy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Pluggable read-lock as a <strong><code>org.apache.camel.component.file.GenericFileExclusiveReadLockStrategy</code></strong> implementation.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxMessagesPerPoll</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>An integer to define a maximum messages to gather per poll. By default no maximum is set. Can be used to set a limit of e.g.&#160;<strong><code>1000</code></strong> to avoid when starting up the server that there are thousands of files. Set a value of&#160;<strong><code>0</code></strong> or negative to disable it. See more details at <a shape="rect" href="batch-consumer.html">Batch Consumer</a>.</p><p><strong>Notice:</strong> If this option is in use then the <a shape="rect" href="file2.html">File</a> and <a shape="rect" href="ftp2.html">FTP</a> components will limit <strong>before</strong> any sorting. For example if you have 100000 files and use <strong><code>maxMessagesPerPoll=500</code></strong>, then only the first 500 files will be picked up, and then sorted. You can use the <strong><code>eagerMaxMessagesPerPoll</code></strong> option and set this to <strong><code>false</code></strong> to allow to scan all files first and then sort afterwards.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>eagerMaxMessagesPerPoll</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.3:</strong> Allows for controlling whether the limit from <strong><code>maxMessagesPerPoll</code></strong> is eager or not. If eager then the limit is during the scanning of files. Where as <code>false</code> would scan all files, and then perform sorting. Setting this option to <code>false</code> allows for sorting all files first, and then limit the poll. Mind that this requires a higher memory usage as all file details are in memory to perform the sorting.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>minDepth</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>0</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8</strong>: The minimum depth to start processing when recursively processing a directory. Using <strong><code>minDepth=1</code></strong> means the base directory. Using <strong><code>minDepth=2</code></strong> means the first sub directory.</p><p>This option is supported by <a shape="rect" href="ftp2.html">FTP</a> consumer from <strong>Camel 2.8.2, 2.9</strong> onward.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxDepth</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Integer.MAX_VALUE</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> The maximum depth to traverse when recursively processing a directory. This option is supported by <a shape="rect" href="ftp2.html">FTP</a> consumer from <strong>Camel 2.8.2, 2.9</strong> onward.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>processStrategy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A pluggable <strong><code>org.apache.camel.component.file.GenericFileProcessStrategy</code></strong> allowing you to implement your own <strong><code>readLock</code></strong> option or similar. Can also be used when special conditions must be met before a file can be consumed, such as a special <em>ready</em> file exists. If this option is set then the <strong><code>readLock</code></strong> option does not apply.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>startingDirectoryMustExist</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> Whether the starting directory must exist. Mind that the <strong><code>autoCreate</code></strong> option is default enabled, which means the starting directory is normally auto created if it doesn't exist. You can disable <strong><code>autoCreate</code></strong> and enable this to ensure the starting directory must exist. Will thrown an exception if the directory doesn't exist.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>pollStrategy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A pluggable <strong><code>org.apache.camel.spi.PollingConsumerPollStrategy</code></strong> allowing you to provide your custom implementation to control error handling that may occur during the <strong><code>poll</code></strong> operation but <em>before</em> an <a shape="rect" href="exchange.html">Exchange</a> has been created and routed by Camel. In other words the error occurred while the polling was gathering information e.g., access to a file network failed so Camel cannot access it to scan for files.</p><p>The default implementation will log the caused exception at <strong><code>WARN</code></strong> level and ignore it.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sendEmptyMessageWhenIdle</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> If the polling consumer did not poll any files, you can enable this option to send an empty message (no body) instead.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.bridgeErrorHandler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Allows for bridging the consumer to the Camel routing <a shape="rect" href="error-handler.html">Error Handler</a>, which mean any exceptions occurred while trying to pickup files, or the likes, will now be processed as a message and handled by the routing <a shape="rect" href="error-handler.html">Error Handler</a>. By default the consumer will use the <strong><code>org.apache.camel.spi.ExceptionHandler</code></strong> to deal with exceptions, that by default will be logged at <strong><code>WARN</code></strong>/<strong><code>ERROR</code></strong> level and ignored. See the following section for more details: <em>How to use the Camel error handler to deal with exceptions triggered outside the routing engine</em>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>scheduledExecutorService</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Allows for configuring a custom/shared thread pool to use for the consumer. By default each consumer has its own single threaded thread pool. This option allows you to share a thread pool among multiple file consumers.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>scheduler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> To use a custom scheduler to trigger the consumer to run. See more details at <a shape="rect" href="polling-consumer.html">Polling Consumer</a>, for example there is a <a shape="rect" href="quartz2.html">Quartz2</a>, and <a shape="rect" href="spring.html">Spring</a> based scheduler that supports CRON expressions.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>backoffMultiplier</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> To let the scheduled polling consumer backoff if there has been a number of subsequent idles/errors in a row. The multiplier is then the number of polls that will be skipped before the next actual attempt is happening again. When this option is in use then <strong><code>backoffIdleThreshold</code></strong> and/or <strong><code>backoffErrorThreshold</code></strong> must also be configured.</p><p>For more details see: <a shape="rect" href="polling-consumer.html">Polling Consumer</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>backoffIdleThreshold</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> The number of subsequent idle polls that should happen before the <strong><code>backoffMultipler</code></strong> should kick-in.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>backoffErrorThreshold</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> The number of subsequent error polls (failed due some error) that should happen before the <strong><code>backoffMultipler</code></strong> should kick-in.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>onCompletionExceptionHandler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16:</strong> To use a custom <strong><code>org.apache.camel.spi.ExceptionHandler</code></strong> to handle any thrown exceptions that happens during the file on completion process where the consumer does either a commit or rollback. The default implementation will log any exception at&#160;<strong><code>WARN</code></strong> level and ignore.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>probeContentType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17:</strong> Whether to enable probing of the content type. If enable then the consumer uses <code><strong>Files#probeContentType</strong>(<strong>java.nio.file.Path</strong>)</code> to determine the content-type of the file, and store that as a header with key <strong><code>Exchange#FILE_CONTENT_TYPE</code></strong> on the Message.</p><p><strong>Camel 2.15</strong>-<strong>2.16.x</strong> the default is true.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>extendedAttributes</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>null</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17</strong>: To enable gathering extended file attributes through&#160;<strong><code>java.nio.file.attribute</code></strong> classes using&#160;<strong><code>Files.getAttribute(ava.nio.file.Path, java.lang.String attribute)</code></strong> or&#160;<strong><code>Files.readAttributes(ava.nio.file.Path, java.lang.String attributes)</code></strong> depending on the option value. This option supports a comma delimited list of attributes to collect e.g., <strong><code>basic:creationTime</code></strong>,&#160;<strong><code>posix:group</code></strong> or simple wildcard e.g.,&#160;<strong><code>posix:*</code></strong>. If the attribute name is not prefixed, the basic attributes are queried. The result is stored as a header with key&#160;<strong><code>CamelFileExtendedAttributes</code></strong> and it is of type&#160;<strong><code>Map&lt;String, Object&gt;</code></strong> where the key is the name of the attribute e.g.,&#160;<strong><code>posix:group</code></strong> and the value is the attributed returned by the call to&#160;<strong><code>Files.getAttribute()</code></strong> or <strong><code>Files.readAttributes</code></strong>.</p></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-Defaultbehaviorforfileconsumer">Default behavior for file consumer</h4><ul><li><p>By default the file is <strong>not</strong> locked for the duration of the processing.</p></li><li><p>After the route has completed, files are moved into the<strong><code> .camel</code></strong> subdirectory, so that they appear to be deleted.</p></li><li><p>The File Consumer will always skip any file whose name starts with a dot, such as <strong><code>.</code></strong>, <strong><code>.camel</code></strong>, <strong><code>.m2</code></strong> or <strong><code>.groovy</code>.</strong></p></li><li><p>Only files (not directories) are matched for valid filename, if options such as: <strong><code>include</code></strong> or <strong><code>exclude</code></strong> are used.</p></li></ul><h4 id="BookInOnePage-Producer">Producer</h4><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>fileExist</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Override</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>What to do if a file already exists with the same name. The following values can be specified:</p> 
      <ul><li><p><strong><code>Override</code></strong> replaces the existing file.</p></li><li><p><strong><code>Append</code></strong> adds content to the existing file.&#160;</p></li><li><p><strong><code>Fail</code></strong> throws a <strong><code>GenericFileOperationException</code></strong> indicating that there is already an existing file.&#160;</p></li><li><p><strong><code>Ignore</code></strong> silently ignores the problem and <strong>does not</strong> override the existing file, but assumes everything is okay.</p></li><li><p><strong><code>Move</code></strong> (<strong>Camel 2.10.1</strong> onward) requires that the option <strong><code>moveExisting</code></strong> be configured as well. The <strong><code>eagerDeleteTargetFile</code></strong> can be used to control what to do if moving the file, and there already exists a file, otherwise causing the move operation to fail. The <strong><code>Move</code></strong> option will move any existing files, before writing the target file.&#160;</p></li><li><p><strong><code>TryRename</code> (Camel 2.11.1</strong> onward) is only applicable if <strong><code>tempFileName</code></strong> option is in use. This allows to try renaming the file from the temporary name to the actual name, without doing any exists check. This check may be faster on some file systems and especially FTP servers.</p></li></ul></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>tempPrefix</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>This option is used to write the file using a temporary name and then, after the write is complete, rename it to the real name. Can be used to identify files being written to and also avoid consumers (not using exclusive read locks) reading in progress files. Is often used by <a shape="rect" href="ftp2.html">FTP</a> when uploading big files.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>tempFileName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.1:</strong> The <strong>same</strong> as <strong><code>tempPrefix</code></strong> option but offering a more fine grained control on the naming of the temporary filename as it uses the <a shape="rect" href="file-language.html">File Language</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>moveExisting</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.1:</strong> <a shape="rect" href="expression.html">Expression</a> (such as <a shape="rect" href="file-language.html">File Language</a>) used to compute file name to use when <strong><code>fileExist=Move</code></strong> is configured. To move files into a <strong><code>backup</code></strong> subdirectory just enter <strong><code>backup</code></strong>.</p><p>This option only supports the following <a shape="rect" href="file-language.html">File Language</a> tokens:</p> 
      <ul><li><p><strong><code>file:name</code></strong></p></li><li><p><strong><code>file:name.ext</code></strong></p></li><li><p><strong><code>file:name.noext</code></strong></p></li><li><p><strong><code>file:onlyname</code></strong></p></li><li><p><strong><code>file:onlyname.noext</code></strong></p></li><li><p><strong><code>file:ext</code></strong></p></li><li><p><strong><code>file:parent</code></strong></p></li></ul><p><strong>Note</strong>: the&#160;<strong><code>file:parent</code></strong> token is not supported by the <a shape="rect" href="ftp2.html">FTP</a> component which can only move files to a directory relative to the <em>current</em> directory.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>keepLastModified</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.2:</strong> Will keep the last modified timestamp from the source file (if any). Will use the <strong><code>Exchange.FILE_LAST_MODIFIED</code></strong> header to located the timestamp. This header can contain either a <strong><code>java.util.Date</code></strong> or <strong><code>long</code></strong> with the timestamp. If the timestamp exists and the option is enabled it will set this timestamp on the written file.</p><p><strong>Note:</strong> This option only applies to the <strong>file</strong> producer. It <em>cannot</em> be used with any of the FTP producers.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>eagerDeleteTargetFile</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> Whether or not to eagerly delete any existing target file. This option only applies when you use <strong><code>fileExists=Override</code></strong> and the <strong><code>tempFileName</code></strong> option as well. You can use this to disable (set it to&#160;<strong><code>false</code></strong>) deleting the target file before the temp file is written. For example you may write big files and want the target file to exist while the temp file is being written. This ensures that the target file is only deleted at the very last moment, just before the temp file is being renamed to the target filename.</p><p>From <strong>Camel 2.10.1</strong> onward this option is also used to control whether to delete any existing files when <strong><code>fileExist=Move</code></strong> is enabled, and an existing file exists. If this option&#160;<strong><code>copyAndDeleteOnRenameFail</code></strong> is <strong><code>false</code></strong>, then an exception will be thrown if an existing file existed. When <strong><code>true</code></strong> the existing file is deleted before the move operation.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>doneFileName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.6:</strong> If provided, then Camel will write a second file (called <em>done</em> <em>file</em>) when the original file has been written. The <em>done</em> <em>file</em> will be empty. This option configures what file name to use. You can either specify a fixed name, or you can use dynamic placeholders. The <em>done</em> <em>file</em> will <strong>always</strong> be written in the same folder as the original file. See <em>writing done file</em> section for examples.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>allowNullBody</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.1:</strong> Used to specify if a null body is allowed during file writing. If set to true then an empty file will be created, when set to false, and attempting to send a null body to the file component, a&#160;<strong><code>GenericFileWriteException</code></strong> the a message 'Cannot write null body to file' will be thrown.</p><p>If&#160;<strong><code>fileExist=Override</code></strong> the file will be truncated. If&#160;<strong><code>fileExist=append</code></strong> the file will remain unchanged.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>forceWrites</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.5/2.11:</strong> Whether to force syncing writes to the file system. You can turn this off if you do not want this level of guarantee, for example if writing to logs / audit logs etc; this would yield better performance.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>chmod</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.15.0</strong>: Specify the file p<span style="line-height: 1.4285715;">ermissions which is sent by the producer</span>, the <span style="line-height: 1.4285715;">chmod value must be between&#160;<strong><code>000</code></strong> and <strong><code>777</code></strong>; If there is a leading digit like in&#160;<strong><code>0755</code></strong> we will ignore it.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>chmodDirectory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17.0:</strong> Specify the directory permissions used when the producer creates missing directories, the chmod value must be between&#160;<strong><code>000</code></strong> and <strong><code>777</code></strong>; If there is a leading digit like in&#160;<strong><code>0755</code></strong> we will ignore it.</p></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-Defaultbehaviorforfileproducer">Default behavior for file producer</h4><ul><li><p>By default it will override any existing file, if one exist with the same name.</p></li></ul><h3 id="BookInOnePage-MoveandDeleteoperations">Move and Delete operations</h3><p>Any move or delete operations is executed after (post command) the routing has completed; so during processing of the <strong><code>Exchange</code></strong> the file is still located in the inbox folder.</p><p>Lets illustrate this with an example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://inbox?move=.done&amp;quot;) .to(&amp;quot;bean:handleOrder&amp;quot;); </script> 
 </div>
</div><p>When a file is dropped in the <strong><code>inbox</code></strong> folder, the file consumer notices this and creates a new <strong><code>FileExchange</code></strong> that is routed to the <strong><code>handleOrder</code></strong> bean. The bean then processes the <strong><code>File</code></strong> object. At this point in time the file is still located in the <strong><code>inbox</code></strong> folder. After the bean completes, and thus the route is completed, the file consumer will perform the move operation and move the file to the <strong><code>.done</code></strong> sub-folder.</p><p>The <strong><code>move</code></strong> and the&#160;<strong><code>preMove</code></strong> options are considered as a directory name though if you use an expression such as <a shape="rect" href="file-language.html">File Language</a>, or <a shape="rect" href="simple.html">Simple</a> then the result of the expression evaluation is the file name to be used e.g., if you set</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">move=../backup/copy-of-${file:name}</script> 
 </div>
</div><p>then that's using the <a shape="rect" href="file-language.html">File Language</a> which we use return the file name to be used), which can be either relative or absolute. If relative, the directory is created as a sub-folder from within the folder where the file was consumed.</p><p>By default, Camel will move consumed files to the <strong><code>.camel</code></strong> sub-folder relative to the directory where the file was consumed.</p><p>If you want to delete the file after processing, the route should be:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://inobox?delete=true&amp;quot;) .to(&amp;quot;bean:handleOrder&amp;quot;); </script> 
 </div>
</div><p>We have introduced a <strong>pre</strong> move operation to move files <strong>before</strong> they are processed. This allows you to mark which files have been scanned as they are moved to this sub folder before being processed.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://inbox?preMove=inprogress&amp;quot;) .to(&amp;quot;bean:handleOrder&amp;quot;); </script> 
 </div>
</div><p>You can combine the <strong>pre</strong> move and the regular move:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://inbox?preMove=inprogress&amp;amp;move=.done&amp;quot;) .to(&amp;quot;bean:handleOrder&amp;quot;); </script> 
 </div>
</div><p>So in this situation, the file is in the <strong><code>inprogress</code></strong> folder when being processed and after it's processed, it's moved to the <strong><code>.done</code></strong> folder.</p><h4 id="BookInOnePage-FineGrainedControlUsingThemoveandpreMoveOptions">Fine Grained Control Using The <code>move</code> and&#160;<code>preMove</code> Options</h4><p>The <strong>move</strong> and <strong>preMove</strong> options are&#160;<a shape="rect" href="expression.html">Expression</a>-based, so we have the full power of the <a shape="rect" href="file-language.html">File Language</a> to do advanced configuration of the directory and name pattern.<br clear="none"> Camel will, in fact, internally convert the directory name you enter into a <a shape="rect" href="file-language.html">File Language</a> expression. So when we enter <strong><code>move=.done</code></strong> Camel will convert this into: <strong><code>${</code><code>file:parent</code><code>}/.done/${</code><code>file:onlyname</code>}</strong>. This is only done if Camel detects that you have not provided a&#160;<strong><code>$</code>{}</strong> in the option value yourself. So when you enter a&#160;<strong><code>$</code>{}</strong> Camel will <strong>not</strong> convert it and thus you have the full power.</p><p>So if we want to move the file into a backup folder with today's date as the pattern, we can do:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">move=backup/${date:now:yyyyMMdd}/${file:name} </script> 
 </div>
</div><h4 id="BookInOnePage-AboutmoveFailed">About <strong><code>moveFailed</code></strong></h4><p>The <strong><code>moveFailed</code></strong> option allows you to move files that <strong>could not</strong> be processed successfully to another location such as a error folder of your choice. For example to move the files in an error folder with a timestamp you can use <strong><code>moveFailed=/error/${</code><code>file:name.noext</code><code>}-${date:now:yyyyMMddHHmmssSSS}.${</code><code>file:ext</code>}</strong>.</p><p>See more examples at <a shape="rect" href="file-language.html">File Language</a></p><h3 id="BookInOnePage-MessageHeaders.1">Message Headers</h3><p>The following headers are supported by this component:</p><h4 id="BookInOnePage-Fileproduceronly">File producer only</h4><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelFileName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the name of the file to write (relative to the endpoint directory). This name can be a <code>String</code>; a <code>String</code> with a <a shape="rect" href="file-language.html">File Language</a> or <a shape="rect" href="simple.html">Simple</a> expression; or an <a shape="rect" href="expression.html">Expression</a> object. If it's <strong><code>null</code></strong> then Camel will auto-generate a filename based on the message unique ID.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelFileNameProduced</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The absolute file path (path + name) for the output file that was written. This header is set by Camel and its purpose is providing end-users with the name of the file that was written.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelOverruleFileName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> Is used for overruling <code>CamelFileName</code> header and use the value instead (but only once, as the producer will remove this header after writing the file). The value can be only be a String. Notice that if the option <strong><code>fileName</code></strong> has been configured, then this is still being evaluated.</p></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-Fileconsumeronly">File consumer only</h4><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelFileName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Name of the consumed file as a relative file path with offset from the starting directory configured on the endpoint.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelFileNameOnly</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Only the file name (the name with no leading paths).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelFileAbsolute</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A <code>boolean</code> option specifying whether the consumed file denotes an absolute path or not. Should normally be <code>false</code> for relative paths. Absolute paths should normally not be used but we added to the move option to allow moving files to absolute paths. But can be used elsewhere as well.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelFileAbsolutePath</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The absolute path to the file. For relative files this path holds the relative path instead.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelFilePath</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The file path. For relative files this is the starting directory + the relative filename. For absolute files this is the absolute path.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelFileRelativePath</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The relative path.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelFileParent</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The parent path.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelFileLength</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A <code>long</code> value containing the file size.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelFileLastModified</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A <code>Long</code> value containing the last modified timestamp of the file. In <strong>Camel 2.10.3 and older</strong> the type is <code>Date</code>.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-BatchConsumer.1">Batch Consumer</h3><p>This component implements the <a shape="rect" href="batch-consumer.html">Batch Consumer</a>.</p><h4 id="BookInOnePage-ExchangeProperties,fileconsumeronly">Exchange Properties, file consumer only</h4><p>As the file consumer implements the&#160;<strong><code>BatchConsumer</code></strong> it supports batching the files it polls. By batching we mean that Camel will add the following additional properties to the <a shape="rect" href="exchange.html">Exchange</a>, so you know the number of files polled, the current index, and whether the batch is already completed.</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Property</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelBatchSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The total number of files that was polled in this batch.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelBatchIndex</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The current index of the batch. Starts from 0.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelBatchComplete</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A <code>boolean</code> value indicating the last <a shape="rect" href="exchange.html">Exchange</a> in the batch. Is only <code>true</code> for the last entry.</p></td></tr></tbody></table> 
 </div>
</div><p>This allows you for instance to know how many files exist in this batch and for instance let the <a shape="rect" href="aggregator2.html">Aggregator2</a> aggregate this number of files.</p><h3 id="BookInOnePage-Usingcharset">Using&#160;<code>charset</code></h3><p><strong>Available as of Camel 2.9.3</strong><br clear="none"> The&#160;<strong><code>charset</code></strong> option allows for configuring an encoding of the files on both the consumer and producer endpoints. For example if you read utf-8 files, and want to convert the files to iso-8859-1, you can do:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file:inbox?charset=utf-8&amp;quot;) .to(&amp;quot;file:outbox?charset=iso-8859-1&amp;quot;) </script> 
 </div>
</div><p>You can also use the <strong><code>convertBodyTo</code></strong> in the route. In the example below we have still input files in utf-8 format, but we want to convert the file content to a byte array in iso-8859-1 format. And then let a bean process the data. Before writing the content to the outbox folder using the current charset.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file:inbox?charset=utf-8&amp;quot;) .convertBodyTo(byte[].class, &amp;quot;iso-8859-1&amp;quot;) .to(&amp;quot;bean:myBean&amp;quot;) .to(&amp;quot;file:outbox&amp;quot;); </script> 
 </div>
</div><p>If you omit the charset on the consumer endpoint, then Camel does not know the charset of the file, and would by default use "UTF-8". However you can configure a JVM system property to override and use a different default encoding with the key <strong><code>org.apache.camel.default.charset</code></strong>.</p><p>In the example below this could be a problem if the files is not in UTF-8 encoding, which would be the default encoding for read the files.<br clear="none"> In this example when writing the files, the content has already been converted to a byte array, and thus would write the content directly as is (without any further encodings).</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file:inbox&amp;quot;) .convertBodyTo(byte[].class, &amp;quot;iso-8859-1&amp;quot;) .to(&amp;quot;bean:myBean&amp;quot;) .to(&amp;quot;file:outbox&amp;quot;); </script> 
 </div>
</div><p>You can also override and control the encoding dynamic when writing files, by setting a property on the exchange with the key <strong><code>Exchange.CHARSET_NAME</code></strong>. For example in the route below we set the property with a value from a message header.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file:inbox&amp;quot;) .convertBodyTo(byte[].class, &amp;quot;iso-8859-1&amp;quot;) .to(&amp;quot;bean:myBean&amp;quot;) .setProperty(Exchange.CHARSET_NAME, header(&amp;quot;someCharsetHeader&amp;quot;)) .to(&amp;quot;file:outbox&amp;quot;); </script> 
 </div>
</div><p>We suggest to keep things simpler, so if you pickup files with the same encoding, and want to write the files in a specific encoding, then favor to use the <strong><code>charset</code></strong> option on the endpoints.</p><p>Notice that if you have explicit configured a <strong><code>charset</code></strong> option on the endpoint, then that configuration is used, regardless of the <strong><code>Exchange.CHARSET_NAME</code></strong> property.</p><p>If you have some issues then you can enable&#160;<strong><code>DEBUG</code></strong> logging on <strong><code>org.apache.camel.component.file</code></strong>, and Camel logs when it reads/write a file using a specific charset.<br clear="none"> For example the route below will log the following:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file:inbox?charset=utf-8&amp;quot;) .to(&amp;quot;file:outbox?charset=iso-8859-1&amp;quot;) </script> 
 </div>
</div><p>And the logs:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">DEBUG GenericFileConverter - Read file /Users/davsclaus/workspace/camel/camel-core/target/charset/input/input.txt with charset utf-8 DEBUG FileOperations - Using Reader to write file: target/charset/output.txt with charset: iso-8859-1 </script> 
 </div>
</div><h3 id="BookInOnePage-Commongotchaswithfolderandfilenames">Common gotchas with folder and filenames</h3><p>When Camel is producing files (writing files) there are a few gotchas affecting how to set a filename of your choice. By default, Camel will use the message ID as the filename, and since the message ID is normally a unique generated ID, you will end up with filenames such as: <strong><code>ID-MACHINENAME-2443-1211718892437-1-0</code></strong>. If such a filename is not desired, then you must provide a filename in the <strong><code>CamelFileName</code></strong> message header. The constant, <strong><code>Exchange.FILE_NAME</code></strong>, can also be used.</p><p>The sample code below produces files using the message ID as the filename:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:report&amp;quot;) .to(&amp;quot;file:target/reports&amp;quot;); </script> 
 </div>
</div><p>To use <strong><code>report.txt</code></strong> as the filename you have to do:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:report&amp;quot;) .setHeader(Exchange.FILE_NAME, constant(&amp;quot;report.txt&amp;quot;)) .to( &amp;quot;file:target/reports&amp;quot;); </script> 
 </div>
</div><p>... the same as above, but with <strong><code>CamelFileName</code>:</strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:report&amp;quot;) .setHeader(&amp;quot;CamelFileName&amp;quot;, constant(&amp;quot;report.txt&amp;quot;)) .to( &amp;quot;file:target/reports&amp;quot;); </script> 
 </div>
</div><p>And a syntax where we set the filename on the endpoint with the <strong><code>fileName</code></strong> URI option.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:report&amp;quot;) .to(&amp;quot;file:target/reports/?fileName=report.txt&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-FilenameExpression">Filename Expression</h3><p>Filename can be set either using the <strong>expression</strong> option or as a string-based <a shape="rect" href="file-language.html">File Language</a> expression in the <strong><code>CamelFileName</code></strong> header. See the <a shape="rect" href="file-language.html">File Language</a> for syntax and samples.</p><h3 id="BookInOnePage-Consumingfilesfromfolderswhereothersdropfilesdirectly">Consuming files from folders where others drop files directly</h3><p>Beware if you consume files from a folder where other applications write files to directly. Take a look at the different&#160;<strong><code>readLock</code></strong> options to see what suits your use cases. The best approach is however to write to another folder and after the write move the file in the drop folder. However if you write files directly to the drop folder then the option changed could better detect whether a file is currently being written/copied as it uses a file changed algorithm to see whether the file size / modification changes over a period of time. The other&#160;<strong><code>readLock</code></strong> options rely on Java File API that sadly is not always very good at detecting this. You may also want to look at the&#160;<strong><code>doneFileName</code></strong> option, which uses a marker file (done file) to signal when a file is done and ready to be consumed.</p><h3 id="BookInOnePage-Using'done'Files">Using 'done' Files</h3><p><strong>Available as of Camel 2.6</strong></p><p>See also section <em>writing done files</em> below.</p><p>If you want only to consume files when a done file exists, then you can use the <strong><code>doneFileName</code></strong> option on the endpoint.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file:bar?doneFileName=done&amp;quot;); </script> 
 </div>
</div><p>Will only consume files from the bar folder, if a done <em>file</em> exists in the same directory as the target files. Camel will automatically delete the <em>done file</em> when it's done consuming the files. From Camel <strong>2.9.3</strong> onward Camel will not automatically delete the <em>done file</em> if <strong><code>noop=true</code></strong> is configured.</p><p>However it is more common to have one <em>done file</em> per target file. This means there is a 1:1 correlation. To do this you must use dynamic placeholders in the <strong><code>doneFileName</code></strong> option. Currently Camel supports the following two dynamic tokens: <strong><code>file:name</code></strong> and <strong><code>file:name.noext</code></strong> which must be enclosed in <strong><code>$</code>{}</strong>. The consumer only supports the static part of the <em>done file</em> name as either prefix or suffix (not both).</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file:bar?doneFileName=${file:name}.done&amp;quot;); </script> 
 </div>
</div><p>In this example only files will be polled if there exists a done file with the name <em>file name</em>.done. For example</p><ul class="alternate"><li><p><strong><code>hello.txt</code></strong> - is the file to be consumed</p></li><li><p><strong><code>hello.txt.done</code></strong> - is the associated done file</p></li></ul><p>You can also use a prefix for the done file, such as:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file:bar?doneFileName=ready-${file:name}&amp;quot;); </script> 
 </div>
</div><ul class="alternate"><li><p><strong><code>hello.txt</code></strong> - is the file to be consumed</p></li><li><p><strong><code>ready-hello.txt</code></strong> - is the associated done file</p></li></ul><h3 id="BookInOnePage-Writing'done'Files">Writing 'done' Files</h3><p><strong>Available as of Camel 2.6</strong></p><p>After you have written a file you may want to write an additional <em>done</em> <em>file</em> as a kind of marker, to indicate to others that the file is finished and has been written. To do that you can use the <strong><code>doneFileName</code></strong> option on the file producer endpoint.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">.to(&amp;quot;file:bar?doneFileName=done&amp;quot;); </script> 
 </div>
</div><p>Will simply create a file named <code>done</code> in the same directory as the target file.</p><p>However it is more common to have one done file per target file. This means there is a 1:1 correlation. To do this you must use dynamic placeholders in the <strong><code>doneFileName</code></strong> option. Currently Camel supports the following two dynamic tokens: <strong><code>file:name</code></strong> and <strong><code>file:name.noext</code></strong> which must be enclosed in <strong><code>${}</code></strong>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">.to(&amp;quot;file:bar?doneFileName=done-${file:name}&amp;quot;); </script> 
 </div>
</div><p>Will for example create a file named <strong><code>done-foo.txt</code></strong> if the target file was <strong><code>foo.txt</code></strong> in the same directory as the target file.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">.to(&amp;quot;file:bar?doneFileName=${file:name}.done&amp;quot;); </script> 
 </div>
</div><p>Will for example create a file named <strong><code>foo.txt.done</code></strong> if the target file was <strong><code>foo.txt</code></strong> in the same directory as the target file.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">.to(&amp;quot;file:bar?doneFileName=${file:name.noext}.done&amp;quot;); </script> 
 </div>
</div><p>Will for example create a file named <strong><code>foo.done</code></strong> if the target file was <strong><code>foo.txt</code></strong> in the same directory as the target file.</p><h3 id="BookInOnePage-Examples.15">Examples</h3><h4 id="BookInOnePage-Readfromadirectoryandwritetoanotherdirectory">Read from a directory and write to another directory</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://inputdir/?delete=true&amp;quot;) .to(&amp;quot;file://outputdir&amp;quot;) </script> 
 </div>
</div><h4 id="BookInOnePage-Readfromadirectoryandwritetoanotherdirectoryusingaoverruledynamicname">Read from a directory and write to another directory using a overrule dynamic name</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://inputdir/?delete=true&amp;quot;) .to(&amp;quot;file://outputdir?overruleFile=copy-of-${file:name}&amp;quot;) </script> 
 </div>
</div><p>Listen on a directory and create a message for each file dropped there. Copy the contents to the <strong><code>outputdir</code></strong> and delete the file in the <strong><code>inputdir</code>.</strong></p><h4 id="BookInOnePage-Readingrecursivelyfromadirectoryandwritingtoanother">Reading recursively from a directory and writing to another</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://inputdir/?recursive=true&amp;amp;delete=true&amp;quot;) .to(&amp;quot;file://outputdir&amp;quot;) </script> 
 </div>
</div><p>Listen on a directory and create a message for each file dropped there. Copy the contents to the <strong><code>outputdir</code></strong> and delete the file in the <strong><code>inputdir</code></strong>. Will scan recursively into sub-directories. Will lay out the files in the same directory structure in the <strong><code>outputdir</code></strong> as the <strong><code>inputdir</code></strong>, including any sub-directories.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">inputdir/foo.txt inputdir/sub/bar.txt </script> 
 </div>
</div><p>Will result in the following output layout:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">outputdir/foo.txt outputdir/sub/bar.txt </script> 
 </div>
</div><h5 id="BookInOnePage-Usingflatten">Using&#160;<code>flatten</code></h5><p>If you want to store the files in the&#160;<strong><code>outputdir</code></strong> directory in the same directory, disregarding the source directory layout e.g., to flatten out the path, you just add the <strong><code>flatten=true</code></strong> option on the file producer side:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://inputdir/?recursive=true&amp;amp;delete=true&amp;quot;) .to(&amp;quot;file://outputdir?flatten=true&amp;quot;) </script> 
 </div>
</div><p>Will result in the following output layout:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">outputdir/foo.txt outputdir/bar.txt </script> 
 </div>
</div><h4 id="BookInOnePage-Readingfromadirectoryandthedefaultmoveoperation">Reading from a directory and the default move operation</h4><p>Camel will by default move any processed file into a <strong><code>.camel</code></strong> subdirectory in the directory the file was consumed from.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://inputdir/?recursive=true&amp;amp;delete=true&amp;quot;) .to(&amp;quot;file://outputdir&amp;quot;) </script> 
 </div>
</div><p>Affects the layout as follows:<br clear="none"> <strong>before</strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">inputdir/foo.txt inputdir/sub/bar.txt </script> 
 </div>
</div><p><strong>after</strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">inputdir/.camel/foo.txt inputdir/sub/.camel/bar.txt outputdir/foo.txt outputdir/sub/bar.txt </script> 
 </div>
</div><h4 id="BookInOnePage-Readfromadirectoryandprocessthemessageinjava">Read from a directory and process the message in java</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://inputdir/&amp;quot;).process(new Processor() { public void process(Exchange exchange) throws Exception { Object body = exchange.getIn().getBody(); // do some business logic with the input body } }); </script> 
 </div>
</div><p>The body will be a <strong><code>File</code></strong> object that points to the file that was just dropped into the <strong><code>inputdir</code></strong> directory.</p><h4 id="BookInOnePage-Writingtofiles">Writing to files</h4><p>Camel is of course also able to write files, i.e. produce files. In the sample below we receive some reports on the SEDA queue that we process before they are being written to a directory.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public void testToFile() throws Exception { MockEndpoint mock = getMockEndpoint(&amp;quot;mock:result&amp;quot;); mock.expectedMessageCount(1); mock.expectedFileExists(&amp;quot;target/test-reports/report.txt&amp;quot;); template.sendBody(&amp;quot;direct:reports&amp;quot;, &amp;quot;This is a great report&amp;quot;); assertMockEndpointsSatisfied(); } protected JndiRegistry createRegistry() throws Exception { // bind our processor in the registry with the given id JndiRegistry reg = super.createRegistry(); reg.bind(&amp;quot;processReport&amp;quot;, new ProcessReport()); return reg; } protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { public void configure() throws Exception { // the reports from the seda queue is processed by our processor // before they are written to files in the target/reports directory from(&amp;quot;direct:reports&amp;quot;).process(&amp;quot;processReport&amp;quot;).to(&amp;quot;file://target/test-reports&amp;quot;, &amp;quot;mock:result&amp;quot;); } }; } private static class ProcessReport implements Processor { public void process(Exchange exchange) throws Exception { String body = exchange.getIn().getBody(String.class); // do some business logic here // set the output to the file exchange.getOut().setBody(body); // set the output filename using java code logic, notice that this is done by setting // a special header property of the out exchange exchange.getOut().setHeader(Exchange.FILE_NAME, &amp;quot;report.txt&amp;quot;); } } </script> 
  </div>
 </div><h4 id="BookInOnePage-WritetosubdirectoryusingExchange.FILE_NAME">Write to subdirectory using <code>Exchange.FILE_NAME</code></h4><p>Using a single route, it is possible to write a file to any number of subdirectories. If you have a route setup as such:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;bean:myBean&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;file:/rootDirectory&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>You can have <strong><code>myBean</code></strong> set the header <strong><code>Exchange.FILE_NAME</code></strong> to values such as:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Exchange.FILE_NAME = hello.txt =&amp;gt; /rootDirectory/hello.txt Exchange.FILE_NAME = foo/bye.txt =&amp;gt; /rootDirectory/foo/bye.txt </script> 
 </div>
</div><p>This allows you to have a single route to write files to multiple destinations.</p><h4 id="BookInOnePage-Writingfilethroughthetemporarydirectoryrelativetothefinaldestination">Writing file through the temporary directory relative to the final destination</h4><p>Sometime you need to temporarily write the files to some directory relative to the destination directory. Such situation usually happens when some external process with limited filtering capabilities is reading from the directory you are writing to. In the example below files will be written to the&#160; <strong><code>/var/myapp/filesInProgress</code></strong> directory and after data transfer is done, they will be atomically moved to the<code> <strong>/var/myapp/finalDirectory </strong></code>directory.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;file:///var/myapp/finalDirectory?tempPrefix=/../filesInProgress/&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-UsingExpressionsforFilenames">Using Expressions for Filenames</h4><p>In this sample we want to move consumed files to a backup folder using today's date as a sub-folder name:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://inbox?move=backup/${date:now:yyyyMMdd}/${file:name}&amp;quot;) .to(&amp;quot;...&amp;quot;); </script> 
 </div>
</div><p>See <a shape="rect" href="file-language.html">File Language</a> for more samples.</p><h3 id="BookInOnePage-Avoidingreadingthesamefilemorethanonce(idempotentconsumer)">Avoiding reading the same file more than once (idempotent consumer)</h3><p>Camel supports <a shape="rect" href="idempotent-consumer.html">Idempotent Consumer</a> directly within the component so it will skip already processed files. This feature can be enabled by setting the <strong><code>idempotent=true</code></strong> option.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://inbox?idempotent=true&amp;quot;) .to(&amp;quot;...&amp;quot;); </script> 
 </div>
</div><p>Camel uses the absolute file name as the idempotent key, to detect duplicate files. From <strong>Camel 2.11</strong> onward you can customize this key by using an expression in the&#160;<strong><code>idempotentKey</code></strong> option. For example to use both the name and the file size as the key</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;file://inbox?idempotent=true&amp;amp;amp;idempotentKey=${file:name}-${file:size}&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:processInbox&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>By default Camel uses a in memory based store for keeping track of consumed files, it uses a least recently used cache holding up to 1000 entries. You can plugin your own implementation of this store by using the <strong><code>idempotentRepository</code></strong> option using the <code>#</code> sign in the value to indicate it's a referring to a bean in the <a shape="rect" href="registry.html">Registry</a> with the specified <strong><code>id</code>.</strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- define our store as a plain spring bean --&amp;gt; &amp;lt;bean id=&amp;quot;myStore&amp;quot; class=&amp;quot;com.mycompany.MyIdempotentStore&amp;quot;/&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;file://inbox?idempotent=true&amp;amp;amp;idempotentRepository=#myStore&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:processInbox&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>Camel will log at <strong><code>DEBUG</code></strong> level if it skips a file because it has been consumed before:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">DEBUG FileConsumer is idempotent and the file has been consumed before. Will skip this file: target\idempotent\report.txt </script> 
 </div>
</div><h4 id="BookInOnePage-Usingafilebasedidempotentrepository">Using a file based idempotent repository</h4><p>In this section we will use the file based idempotent repository <strong><code>org.apache.camel.processor.idempotent.FileIdempotentRepository</code></strong> instead of the in-memory based that is used as default.<br clear="none"> This repository uses a 1st level cache to avoid reading the file repository. It will only use the file repository to store the content of the 1st level cache. Thereby the repository can survive server restarts. It will load the content of the file into the 1st level cache upon startup. The file structure is very simple as it stores the key in separate lines in the file. By default, the file store has a size limit of 1mb. When the file grows larger Camel will truncate the file store, rebuilding the content by flushing the 1st level cache into a fresh empty file.</p><p>We configure our repository using Spring XML creating our file idempotent repository and define our file consumer to use our repository with the <strong><code>idempotentRepository</code></strong> using <code>#</code> sign to indicate <a shape="rect" href="registry.html">Registry</a> lookup:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- this is our file based idempotent store configured to use the .filestore.dat as file --&amp;gt; &amp;lt;bean id=&amp;quot;fileStore&amp;quot; class=&amp;quot;org.apache.camel.processor.idempotent.FileIdempotentRepository&amp;quot;&amp;gt; &amp;lt;!-- the filename for the store --&amp;gt; &amp;lt;property name=&amp;quot;fileStore&amp;quot; value=&amp;quot;target/fileidempotent/.filestore.dat&amp;quot;/&amp;gt; &amp;lt;!-- the max filesize in bytes for the file. Camel will trunk and flush the cache if the file gets bigger --&amp;gt; &amp;lt;property name=&amp;quot;maxFileStoreSize&amp;quot; value=&amp;quot;512000&amp;quot;/&amp;gt; &amp;lt;!-- the number of elements in our store --&amp;gt; &amp;lt;property name=&amp;quot;cacheSize&amp;quot; value=&amp;quot;250&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;file://target/fileidempotent/?idempotent=true&amp;amp;amp;idempotentRepository=#fileStore&amp;amp;amp;move=done/${file:name}&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
  </div>
 </div><h4 id="BookInOnePage-UsingaJPAbasedidempotentrepository">Using a JPA based idempotent repository</h4><p>In this section we will use the JPA based idempotent repository instead of the in-memory based that is used as default.</p><p>First we need a persistence-unit in <strong><code>META-INF/persistence.xml</code> where we need to use the class <code>org.apache.camel.processor.idempotent.jpa.MessageProcessed</code></strong> as model.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;persistence-unit name=&amp;quot;idempotentDb&amp;quot; transaction-type=&amp;quot;RESOURCE_LOCAL&amp;quot;&amp;gt; &amp;lt;class&amp;gt;org.apache.camel.processor.idempotent.jpa.MessageProcessed&amp;lt;/class&amp;gt; &amp;lt;properties&amp;gt; &amp;lt;property name=&amp;quot;openjpa.ConnectionURL&amp;quot; value=&amp;quot;jdbc:derby:target/idempotentTest;create=true&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;openjpa.ConnectionDriverName&amp;quot; value=&amp;quot;org.apache.derby.jdbc.EmbeddedDriver&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;openjpa.jdbc.SynchronizeMappings&amp;quot; value=&amp;quot;buildSchema&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;openjpa.Log&amp;quot; value=&amp;quot;DefaultLevel=WARN, Tool=INFO&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;openjpa.Multithreaded&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;/properties&amp;gt; &amp;lt;/persistence-unit&amp;gt; </script> 
  </div>
 </div>Next, we can create our JPA idempotent repository in the spring XML file as well:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- we define our jpa based idempotent repository we want to use in the file consumer --&amp;gt; &amp;lt;bean id=&amp;quot;jpaStore&amp;quot; class=&amp;quot;org.apache.camel.processor.idempotent.jpa.JpaMessageIdRepository&amp;quot;&amp;gt; &amp;lt;!-- Here we refer to the entityManagerFactory --&amp;gt; &amp;lt;constructor-arg index=&amp;quot;0&amp;quot; ref=&amp;quot;entityManagerFactory&amp;quot;/&amp;gt; &amp;lt;!-- This 2nd parameter is the name (= a category name). You can have different repositories with different names --&amp;gt; &amp;lt;constructor-arg index=&amp;quot;1&amp;quot; value=&amp;quot;FileConsumer&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
  </div>
 </div>And yes then we just need to refer to the <strong>jpaStore</strong> bean in the file consumer endpoint using the <strong><code>idempotentRepository</code></strong> using the <code>#</code> syntax option:<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;file://inbox?idempotent=true&amp;amp;amp;idempotentRepository=#jpaStore&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:processInbox&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Filterusingorg.apache.camel.component.file.GenericFileFilter">Filter using&#160;<code>org.apache.camel.component.file.GenericFileFilter</code></h3><p>Camel supports pluggable filtering strategies. You can then configure the endpoint with such a filter to skip certain files being processed.</p><p>In the sample we have built our own filter that skips files starting with <strong><code>skip</code></strong> in the filename:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public class MyFileFilter&amp;lt;T&amp;gt; implements GenericFileFilter&amp;lt;T&amp;gt; { public boolean accept(GenericFile&amp;lt;T&amp;gt; file) { // we want all directories if (file.isDirectory()) { return true; } // we dont accept any files starting with skip in the name return !file.getFileName().startsWith(&amp;quot;skip&amp;quot;); } } </script> 
  </div>
 </div>And then we can configure our route using the <strong>filter</strong> attribute to reference our filter (using <code>#</code> notation) that we have defined in the spring XML file:<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- define our filter as a plain spring bean --&amp;gt; &amp;lt;bean id=&amp;quot;myFilter&amp;quot; class=&amp;quot;com.mycompany.MyFileFilter&amp;quot;/&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;file://inbox?filter=#myFilter&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:processInbox&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-FilteringusingANTpathmatcher">Filtering using ANT path matcher</h4><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">New options from Camel 2.10 onwards</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>There are now <strong><code>antInclude</code></strong> and <strong><code>antExclude</code></strong> options to make it easy to specify ANT style include/exclude without having to define the filter. See the URI options above for more information.</p>
 </div>
</div><p>The ANT path matcher is shipped out-of-the-box in the <strong>camel-spring</strong> jar. So you need to depend on <strong>camel-spring</strong> if you are using Maven.<br clear="none"> The reasons is that we leverage Spring's <a shape="rect" class="external-link" href="http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/util/AntPathMatcher.html" rel="nofollow">AntPathMatcher</a> to do the actual matching.</p><p>The file paths is matched with the following rules:</p><ul class="alternate"><li><p><code>?</code> matches one character</p></li><li><p><code>*</code> matches zero or more characters</p></li><li><p><code>**</code> matches zero or more directories in a path</p></li></ul><p>The sample below demonstrates how to use it:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;template id=&amp;quot;camelTemplate&amp;quot;/&amp;gt; &amp;lt;!-- use myFilter as filter to allow setting ANT paths for which files to scan for --&amp;gt; &amp;lt;endpoint id=&amp;quot;myFileEndpoint&amp;quot; uri=&amp;quot;file://target/antpathmatcher?recursive=true&amp;amp;amp;filter=#myAntFilter&amp;quot;/&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from ref=&amp;quot;myFileEndpoint&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;!-- we use the antpath file filter to use ant paths for includes and exlucde --&amp;gt; &amp;lt;bean id=&amp;quot;myAntFilter&amp;quot; class=&amp;quot;org.apache.camel.component.file.AntPathMatcherGenericFileFilter&amp;quot;&amp;gt; &amp;lt;!-- include and file in the subfolder that has day in the name --&amp;gt; &amp;lt;property name=&amp;quot;includes&amp;quot; value=&amp;quot;**/subfolder/**/*day*&amp;quot;/&amp;gt; &amp;lt;!-- exclude all files with bad in name or .xml files. Use comma to seperate multiple excludes --&amp;gt; &amp;lt;property name=&amp;quot;excludes&amp;quot; value=&amp;quot;**/*bad*,**/*.xml&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
  </div>
 </div><h3 id="BookInOnePage-SortingusingComparator">Sorting using&#160;<code>Comparator</code></h3><p>Camel supports pluggable sorting strategies. This strategy it to use the build in <strong><code>java.util.Comparator</code></strong> in Java. You can then configure the endpoint with such a comparator and have Camel sort the files before being processed.</p><p>In the sample we have built our own comparator that just sorts by file name:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public class MyFileSorter&amp;lt;T&amp;gt; implements Comparator&amp;lt;GenericFile&amp;lt;T&amp;gt;&amp;gt; { public int compare(GenericFile&amp;lt;T&amp;gt; o1, GenericFile&amp;lt;T&amp;gt; o2) { return o1.getFileName().compareToIgnoreCase(o2.getFileName()); } } </script> 
  </div>
 </div>And then we can configure our route using the <strong>sorter</strong> option to reference to our sorter (<code>mySorter</code>) we have defined in the spring XML file:<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- define our sorter as a plain spring bean --&amp;gt; &amp;lt;bean id=&amp;quot;mySorter&amp;quot; class=&amp;quot;com.mycompany.MyFileSorter&amp;quot;/&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;file://inbox?sorter=#mySorter&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:processInbox&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">URI options can reference beans using the # syntax</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>In the Spring DSL route above notice that we can refer to beans in the <a shape="rect" href="registry.html">Registry</a> by prefixing the id with <strong><code>#</code></strong>. So writing <strong><code>sorter=#mySorter</code></strong>, will instruct Camel to go look in the <a shape="rect" href="registry.html">Registry</a> for a bean with the ID, <strong><code>mySorter</code></strong>.</p>
 </div>
</div><h3 id="BookInOnePage-SortingusingsortBy">Sorting using&#160;<code>sortBy</code></h3><p>Camel supports pluggable sorting strategies. This strategy it to use the <a shape="rect" href="file-language.html">File Language</a> to configure the sorting. The <strong><code>sortBy</code></strong> option is configured as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">sortBy=group 1;group 2;group 3;... </script> 
 </div>
</div><p>Where each group is separated with semi colon. In the simple situations you just use one group, so a simple example could be:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">sortBy=file:name </script> 
 </div>
</div><p>This will sort by file name, you can reverse the order by prefixing <strong><code>reverse:</code></strong> to the group, so the sorting is now Z..A:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">sortBy=reverse:file:name </script> 
 </div>
</div><p>As we have the full power of <a shape="rect" href="file-language.html">File Language</a> we can use some of the other parameters, so if we want to sort by file size we do:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">sortBy=file:length </script> 
 </div>
</div><p>You can configure to ignore the case, using <strong><code>ignoreCase:</code></strong> for string comparison, so if you want to use file name sorting but to ignore the case then we do:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">sortBy=ignoreCase:file:name </script> 
 </div>
</div><p>You can combine ignore case and reverse, however reverse must be specified first:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">sortBy=reverse:ignoreCase:file:name </script> 
 </div>
</div><p>In the sample below we want to sort by last modified file, so we do:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">sortBy=file:modified </script> 
 </div>
</div><p>And then we want to group by name as a 2nd option so files with same modifcation is sorted by name:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">sortBy=file:modified;file:name </script> 
 </div>
</div><p>Now there is an issue here, can you spot it? Well the modified timestamp of the file is too fine as it will be in milliseconds, but what if we want to sort by date only and then subgroup by name?<br clear="none"> Well as we have the true power of <a shape="rect" href="file-language.html">File Language</a> we can use&#160;its date command that supports patterns. So this can be solved as:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">sortBy=date:file:yyyyMMdd;file:name </script> 
 </div>
</div><p>Yeah, that is pretty powerful, oh by the way you can also use reverse per group, so we could reverse the file names:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">sortBy=date:file:yyyyMMdd;reverse:file:name </script> 
 </div>
</div><h3 id="BookInOnePage-UsingGenericFileProcessStrategy">Using&#160;<code>GenericFileProcessStrategy</code></h3><p>The option <strong><code>processStrategy</code></strong> can be used to use a custom <strong><code>GenericFileProcessStrategy</code></strong> that allows you to implement your own <em>begin</em>, <em>commit</em> and <em>rollback</em> logic.<br clear="none"> For instance lets assume a system writes a file in a folder you should consume. But you should not start consuming the file before another <em>ready</em> file has been written as well.</p><p>So by implementing our own <strong><code>GenericFileProcessStrategy</code></strong> we can implement this as:</p><ul class="alternate"><li><p>In the <strong><code>begin()</code></strong> method we can test whether the special <em>ready</em> file exists. The begin method returns a <code>boolean</code> to indicate if we can consume the file or not.</p></li><li><p>In the <strong><code>abort()</code></strong> method (<strong>Camel 2.10</strong>) special logic can be executed in case the <strong><code>begin</code></strong> operation returned <strong><code>false</code></strong>, for example to cleanup resources etc.</p></li><li><p>In the <strong><code>commit()</code></strong> method we can move the actual file and also delete the <em>ready</em> file.</p></li></ul><h3 id="BookInOnePage-Usingfilter">Using&#160;<code>filter</code></h3><p>The <strong><code>filter</code></strong> option allows you to implement a custom filter in Java code by implementing the <strong><code>org.apache.camel.component.file.GenericFileFilter</code></strong> interface. This interface has an <strong><code>accept</code></strong> method that returns a boolean. Return <strong><code>true</code></strong> to include the file, and <strong><code>false</code></strong> to skip the file. From Camel 2.10 onward, there is a <strong><code>isDirectory</code></strong> method on <strong><code>GenericFile</code></strong> whether the file is a directory. This allows you to filter unwanted directories, to avoid traversing down unwanted directories.</p><p>For example to skip any directories which starts with <code>"skip"</code> in the name, can be implemented as follows:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public class MyDirectoryFilter&amp;lt;T&amp;gt; implements GenericFileFilter&amp;lt;T&amp;gt; { public boolean accept(GenericFile&amp;lt;T&amp;gt; file) { // remember the name due unit testing (should not be needed in regular use-cases) names.add(file.getFileName()); // we dont accept any files within directory starting with skip in the name if (file.isDirectory() &amp;amp;&amp;amp; file.getFileName().startsWith(&amp;quot;skip&amp;quot;)) { return false; } return true; } } </script> 
  </div>
 </div><h3 id="BookInOnePage-HowtousetheCamelerrorhandlertodealwithexceptionstriggeredoutsidetheroutingengine">How to use the Camel error handler to deal with exceptions triggered outside the routing engine</h3><p>The file and ftp consumers, will by default try to pickup files. Only if that is successful then a Camel <a shape="rect" href="exchange.html">Exchange</a> can be created and passed in the Camel routing engine. When the <a shape="rect" href="exchange.html">Exchange</a> is processed by the routing engine, then the Camel <a shape="rect" href="error-handling-in-camel.html">Error Handling</a> takes over e.g., the&#160;<strong><code>onException</code></strong> /&#160;<strong><code>errorHandler</code></strong> in the routes. However outside the scope of the routing engine, any exceptions handling is component specific. Camel offers a <strong><code>org.apache.camel.spi.ExceptionHandler</code></strong> that allows components to use that as a pluggable hook for end users to use their own implementation. Camel offers a default <strong><code>LoggingExceptionHandler</code></strong> that will log the exception at&#160;<strong><code>ERROR</code>/<code>WARN</code></strong> level.</p><p><br clear="none"> For the file and ftp components this would be the case. However if you want to bridge the <strong><code>ExceptionHandler</code></strong> so it uses the Camel <a shape="rect" href="error-handling-in-camel.html">Error Handling</a>, then you need to implement a custom <strong><code>ExceptionHandler</code></strong> that will handle the exception by creating a Camel <a shape="rect" href="exchange.html">Exchange</a> and send it to the routing engine; then the error handling of the routing engine can get triggered.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Easier with Camel 2.10</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The new option&#160;<strong><code>consumer.bridgeErrorHandler</code></strong> can be set to true, to make this even easier. See further below for more details.</p>
 </div>
</div><p>Here is such an example based upon an unit test.</p><p>First we have a custom <strong><code>ExceptionHandler</code></strong> where you can see we deal with the exception by sending it to a Camel <a shape="rect" href="endpoint.html">Endpoint</a> named <strong><code>direct:file-error</code></strong>:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
   <b>MyExceptionHandler</b>
  </div>
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> /** * Custom {@link ExceptionHandler} to be used on the file consumer, to send * exceptions to a Camel route, to let Camel deal with the error. */ private static class MyExceptionHandler implements ExceptionHandler { private ProducerTemplate template; /** * We use a producer template to send a message to the Camel route */ public void setTemplate(ProducerTemplate template) { this.template = template; } @Override public void handleException(Throwable exception) { handleException(exception.getMessage(), exception); } @Override public void handleException(String message, Throwable exception) { handleException(exception.getMessage(), null, exception); } @Override public void handleException(final String message, final Exchange originalExchange, final Throwable exception) { // send the message to the special direct:file-error endpoint, which will trigger exception handling // template.send(&amp;quot;direct:file-error&amp;quot;, new Processor() { @Override public void process(Exchange exchange) throws Exception { // set an exception on the message from the start so the error handling is triggered exchange.setException(exception); exchange.getIn().setBody(message); } }); } } </script> 
  </div>
 </div>&#160;<p>Then we have a Camel route that uses the Camel routing error handler, which is the <strong><code>onException</code></strong> where we handle any&#160;<strong><code>IOException</code></strong> being thrown. We then send the message to the same&#160;<strong><code>direct:file-error</code></strong> endpoint, where we handle it by transforming it to a message, and then being sent to a <a shape="rect" href="mock.html">Mock</a> endpoint. This is just for testing purpose. You can handle the exception in any custom way you want, such as using a <a shape="rect" href="bean.html">Bean</a> or sending an email, etc.</p><p>Notice how we configure our custom <strong><code>MyExceptionHandler</code></strong> by using the <strong><code>consumer.exceptionHandler</code></strong> option to refer to <strong><code>#myExceptionHandler</code></strong> which is a id of the bean registered in the <a shape="rect" href="registry.html">Registry</a>. If using Spring XML or OSGi Blueprint, then that would be a <strong><code>&lt;bean id="myExceptionHandler" class="com.foo.MyExceptionHandler"/&gt;</code></strong>:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
   <b>Camel route with routing engine error handling</b>
  </div>
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> @Override protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { @Override public void configure() throws Exception { // to handle any IOException being thrown onException(IOException.class) .handled(true) .log(&amp;quot;IOException occurred due: ${exception.message}&amp;quot;) // as we handle the exception we can send it to direct:file-error, // where we could send out alerts or whatever we want .to(&amp;quot;direct:file-error&amp;quot;); // special route that handles file errors from(&amp;quot;direct:file-error&amp;quot;) .log(&amp;quot;File error route triggered to deal with exception ${exception?.class}&amp;quot;) // as this is based on unit test just transform a message and send it to a mock .transform().simple(&amp;quot;Error ${exception.message}&amp;quot;) .to(&amp;quot;mock:error&amp;quot;); // this is the file route that pickup files, notice how we use our custom exception handler on the consumer // the exclusiveReadLockStrategy is only configured because this is from an unit test, so we use that to simulate exceptions from(&amp;quot;file:target/nospace?exclusiveReadLockStrategy=#myReadLockStrategy&amp;amp;consumer.exceptionHandler=#myExceptionHandler&amp;quot;) .convertBodyTo(String.class) .to(&amp;quot;mock:result&amp;quot;); } }; } </script> 
  </div>
 </div>&#160;<p>The source code for this example can be seen <a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/camel/trunk/camel-core/src/test/java/org/apache/camel/component/file/FileConsumerCustomExceptionHandlerTest.java">here</a></p><h4 id="BookInOnePage-Usingconsumer.bridgeErrorHandler">Using&#160;<code>consumer.bridgeErrorHandler</code></h4><p><strong>Available as of Camel 2.10</strong></p><p>If you want to use the Camel <a shape="rect" href="error-handler.html">Error Handler</a> to deal with any exception occurring in the file consumer, then you can enable the <strong><code>consumer.bridgeErrorHandler</code></strong> option as shown below:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
   <b>Using consumer.bridgeErrorHandler</b>
  </div>
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> @Override protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { @Override public void configure() throws Exception { // to handle any IOException being thrown onException(IOException.class) .handled(true) .log(&amp;quot;IOException occurred due: ${exception.message}&amp;quot;) .transform().simple(&amp;quot;Error ${exception.message}&amp;quot;) .to(&amp;quot;mock:error&amp;quot;); // this is the file route that pickup files, notice how we bridge the consumer to use the Camel routing error handler // the exclusiveReadLockStrategy is only configured because this is from an unit test, so we use that to simulate exceptions from(&amp;quot;file:target/nospace?exclusiveReadLockStrategy=#myReadLockStrategy&amp;amp;consumer.bridgeErrorHandler=true&amp;quot;) .convertBodyTo(String.class) .to(&amp;quot;mock:result&amp;quot;); } }; } </script> 
  </div>
 </div>So all you have to do is to enable this option, and the error handler in the route will take it from there.<div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Important when using consumer.bridgeErrorHandler</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>When using <strong><code>consumer.bridgeErrorHandler</code></strong>, then <a shape="rect" href="intercept.html">interceptors</a>, <a shape="rect" href="oncompletion.html">OnCompletion</a>s does <strong>not</strong> apply. The <a shape="rect" href="exchange.html">Exchange</a> is processed directly by the Camel <a shape="rect" href="error-handler.html">Error Handler</a>, and does not allow prior actions such as interceptors,&#160;<strong><code>onCompletion</code></strong> to take action.</p>
 </div>
</div><h3 id="BookInOnePage-Debuglogging">Debug logging</h3><p>This component has log level <strong><code>TRACE</code></strong> that can be helpful if you have problems.</p><p></p><h3 id="BookInOnePage-SeeAlso.36">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="file-language.html">File Language</a></li><li><a shape="rect" href="ftp2.html">FTP</a></li><li><a shape="rect" href="polling-consumer.html">Polling Consumer</a></li></ul><h2 id="BookInOnePage-FlatpackComponent">Flatpack Component</h2><p>The Flatpack component supports fixed width and delimited file parsing via the <a shape="rect" class="external-link" href="http://flatpack.sourceforge.net" rel="nofollow">FlatPack library</a>.<br clear="none"> <strong>Notice:</strong> This component only supports consuming from flatpack files to Object model. You can not (yet) write from Object model to flatpack format.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-flatpack&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.21">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> flatpack:[delim|fixed]:flatPackConfig.pzmap.xml[?options] </script> 
 </div>
</div><p>Or for a delimited file handler with no configuration file just use</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> flatpack:someName[?options] </script> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-URIOptions.2">URI Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default Value </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>delimiter</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>,</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The default character delimiter for delimited files.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>textQualifier</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>"</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The text qualifier for delimited files.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>ignoreFirstRecord</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Whether the first line is ignored for delimited files (for the column headers).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>splitRows</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The component can either process each row one by one or the entire content at once. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>allowShortLines</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.9.7 and 2.10.5 onwards:</strong> Allows for lines to be shorter than expected and ignores the extra characters. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>ignoreExtraColumns</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.9.7 and 2.10.5 onwards:</strong> Allows for lines to be longer than expected and ignores the extra characters. </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Examples.16">Examples</h3><ul><li><code>flatpack:fixed:foo.pzmap.xml</code> creates a fixed-width endpoint using the <code>foo.pzmap.xml</code> file configuration.</li><li><code>flatpack:delim:bar.pzmap.xml</code> creates a delimited endpoint using the <code>bar.pzmap.xml</code> file configuration.</li><li><code>flatpack:foo</code> creates a delimited endpoint called <code>foo</code> with no file configuration.</li></ul><h3 id="BookInOnePage-MessageHeaders.2">Message Headers</h3><p>Camel will store the following headers on the IN message:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Header </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>camelFlatpackCounter</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The current row index. For <code>splitRows=false</code> the counter is the total number of rows. </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-MessageBody">Message Body</h3><p>The component delivers the data in the IN message as a <code>org.apache.camel.component.flatpack.DataSetList</code> object that has converters for <code>java.util.Map</code> or <code>java.util.List</code>.<br clear="none"> Usually you want the <code>Map</code> if you process one row at a time (<code>splitRows=true</code>). Use <code>List</code> for the entire content (<code>splitRows=false</code>), where each element in the list is a <code>Map</code>.<br clear="none"> Each <code>Map</code> contains the key for the column name and its corresponding value.</p><p>For example to get the firstname from the sample below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> Map row = exchange.getIn().getBody(Map.class); String firstName = row.get(&amp;quot;FIRSTNAME&amp;quot;); </script> 
 </div>
</div><p>However, you can also always get it as a <code>List</code> (even for <code>splitRows=true</code>). The same example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> List data = exchange.getIn().getBody(List.class); Map row = (Map)data.get(0); String firstName = row.get(&amp;quot;FIRSTNAME&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-HeaderandTrailerrecords">Header and Trailer records</h3><p>The header and trailer notions in Flatpack are supported. However, you <strong>must</strong> use fixed record IDs:</p><ul><li><code>header</code> for the header record (must be lowercase)</li><li><code>trailer</code> for the trailer record (must be lowercase)</li></ul><p>The example below illustrates this fact that we have a header and a trailer. You can omit one or both of them if not needed. </p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;RECORD id=&amp;quot;header&amp;quot; startPosition=&amp;quot;1&amp;quot; endPosition=&amp;quot;3&amp;quot; indicator=&amp;quot;HBT&amp;quot;&amp;gt; &amp;lt;COLUMN name=&amp;quot;INDICATOR&amp;quot; length=&amp;quot;3&amp;quot;/&amp;gt; &amp;lt;COLUMN name=&amp;quot;DATE&amp;quot; length=&amp;quot;8&amp;quot;/&amp;gt; &amp;lt;/RECORD&amp;gt; &amp;lt;COLUMN name=&amp;quot;FIRSTNAME&amp;quot; length=&amp;quot;35&amp;quot; /&amp;gt; &amp;lt;COLUMN name=&amp;quot;LASTNAME&amp;quot; length=&amp;quot;35&amp;quot; /&amp;gt; &amp;lt;COLUMN name=&amp;quot;ADDRESS&amp;quot; length=&amp;quot;100&amp;quot; /&amp;gt; &amp;lt;COLUMN name=&amp;quot;CITY&amp;quot; length=&amp;quot;100&amp;quot; /&amp;gt; &amp;lt;COLUMN name=&amp;quot;STATE&amp;quot; length=&amp;quot;2&amp;quot; /&amp;gt; &amp;lt;COLUMN name=&amp;quot;ZIP&amp;quot; length=&amp;quot;5&amp;quot; /&amp;gt; &amp;lt;RECORD id=&amp;quot;trailer&amp;quot; startPosition=&amp;quot;1&amp;quot; endPosition=&amp;quot;3&amp;quot; indicator=&amp;quot;FBT&amp;quot;&amp;gt; &amp;lt;COLUMN name=&amp;quot;INDICATOR&amp;quot; length=&amp;quot;3&amp;quot;/&amp;gt; &amp;lt;COLUMN name=&amp;quot;STATUS&amp;quot; length=&amp;quot;7&amp;quot;/&amp;gt; &amp;lt;/RECORD&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Usingtheendpoint">Using the endpoint</h3><p>A common use case is sending a file to this endpoint for further processing in a separate route. For example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://activemq.apache.org/camel/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;file://someDirectory&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;flatpack:foo&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;flatpack:foo&amp;quot;/&amp;gt; ... &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><p>You can also convert the payload of each message created to a <code>Map</code> for easy <a shape="rect" href="bean-integration.html">Bean Integration</a></p><h2 id="BookInOnePage-FlatpackDataFormat.1">Flatpack DataFormat</h2><p>The <a shape="rect" href="flatpack.html">Flatpack</a> component ships with the Flatpack data format that can be used to format between fixed width or delimited text messages to a <code>List</code> of rows as <code>Map</code>. </p><ul class="alternate"><li>marshal = from <code>List&lt;Map&lt;String, Object&gt;&gt;</code> to <code>OutputStream</code> (can be converted to <code>String</code>)</li><li>unmarshal = from <code>java.io.InputStream</code> (such as a <code>File</code> or <code>String</code>) to a <code>java.util.List</code> as an <code>org.apache.camel.component.flatpack.DataSetList</code> instance.<br clear="none"> The result of the operation will contain all the data. If you need to process each row one by one you can split the exchange, using <a shape="rect" href="splitter.html">Splitter</a>.</li></ul><p><strong>Notice:</strong> The Flatpack library does currently not support header and trailers for the marshal operation.</p><h3 id="BookInOnePage-Options.37">Options</h3><p>The data format has the following options:</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Option </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>definition</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>null</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The flatpack pzmap configuration file. Can be omitted in simpler situations, but its preferred to use the pzmap. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>fixed</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Delimited or fixed. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>ignoreFirstRecord</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Whether the first line is ignored for delimited files (for the column headers). </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>textQualifier</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>"</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> If the text is qualified with a char such as <code>"</code>. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>delimiter</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>,</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The delimiter char (could be <code>;</code> <code>,</code> or similar) </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>parserFactory</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>null</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Uses the default Flatpack parser factory. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>allowShortLines</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.9.7 and 2.10.5 onwards</strong>: Allows for lines to be shorter than expected and ignores the extra characters. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>ignoreExtraColumns</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.9.7 and 2.10.5 onwards</strong>: Allows for lines to be longer than expected and ignores the extra characters. </p></td></tr></tbody></table>
</div><h3 id="BookInOnePage-Usage.3">Usage</h3><p>To use the data format, simply instantiate an instance and invoke the marshal or unmarshal operation in the route builder:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> FlatpackDataFormat fp = new FlatpackDataFormat(); fp.setDefinition(new ClassPathResource(&amp;quot;INVENTORY-Delimited.pzmap.xml&amp;quot;)); ... from(&amp;quot;file:order/in&amp;quot;).unmarshal(df).to(&amp;quot;seda:queue:neworder&amp;quot;); </script> 
 </div>
</div><p>The sample above will read files from the <code>order/in</code> folder and unmarshal the input using the Flatpack configuration file <code>INVENTORY-Delimited.pzmap.xml</code> that configures the structure of the files. The result is a <code>DataSetList</code> object we store on the SEDA queue.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> FlatpackDataFormat df = new FlatpackDataFormat(); df.setDefinition(new ClassPathResource(&amp;quot;PEOPLE-FixedLength.pzmap.xml&amp;quot;)); df.setFixed(true); df.setIgnoreFirstRecord(false); from(&amp;quot;seda:people&amp;quot;).marshal(df).convertBodyTo(String.class).to(&amp;quot;jms:queue:people&amp;quot;); </script> 
 </div>
</div><p>In the code above we marshal the data from a Object representation as a <code>List</code> of rows as <code>Maps</code>. The rows as <code>Map</code> contains the column name as the key, and the the corresponding value. This structure can be created in Java code from e.g. a processor. We marshal the data according to the Flatpack format and convert the result as a <code>String</code> object and store it on a JMS queue.</p><h3 id="BookInOnePage-Dependencies.35">Dependencies</h3><p>To use Flatpack in your camel routes you need to add the a dependency on <strong>camel-flatpack</strong> which implements this data format. </p><p>If you use maven you could just add the following to your pom.xml, substituting the version number for the latest &amp; greatest release (see <a shape="rect" href="download.html">the download page for the latest versions</a>).</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-flatpack&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-SeeAlso.37">See Also</h3><ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-FreeMarker">FreeMarker</h2><p>The <strong>freemarker:</strong> component allows for processing a message using a <a shape="rect" class="external-link" href="http://freemarker.org/" rel="nofollow">FreeMarker</a> template. This can be ideal when using <a shape="rect" href="templating.html">Templating</a> to generate responses for requests.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-freemarker&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.22">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">freemarker:templateName[?options] </script> 
 </div>
</div><p>Where <strong>templateName</strong> is the classpath-local URI of the template to invoke; or the complete URL of the remote template (eg: <a shape="rect" class="external-link" href="file://folder/myfile.ftl" rel="nofollow">file://folder/myfile.ftl</a>).</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.38">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Option </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>contentCache</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Cache for the resource content when it's loaded. <br clear="none" class="atl-forced-newline"> Note: as of <strong>Camel 2.9</strong> cached resource content can be cleared via JMX using the endpoint's <code>clearContentCache</code> operation. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>encoding</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>null</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Character encoding of the resource content. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>templateUpdateDelay</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>5</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.9:</strong> Number of seconds the loaded template resource will remain in the cache. </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Headers.2">Headers</h3><p>Headers set during the FreeMarker evaluation are returned to the message and added as headers. This provides a mechanism for the FreeMarker component to return values to the Message.</p><p>An example: Set the header value of <code>fruit</code> in the FreeMarker template:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">${request.setHeader(&amp;#39;fruit&amp;#39;, &amp;#39;Apple&amp;#39;)} </script> 
 </div>
</div><p>The header, <code>fruit</code>, is now accessible from the <code>message.out.headers</code>.</p><h3 id="BookInOnePage-FreeMarkerContext">FreeMarker Context</h3><p>Camel will provide exchange information in the FreeMarker context (just a <code>Map</code>). The <code>Exchange</code> is transferred as:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> key </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> value </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>exchange</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The <code>Exchange</code> itself. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>exchange.properties</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The <code>Exchange</code> properties. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>headers</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The headers of the In message. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>camelContext</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The Camel Context. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>request</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The In message. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>body</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The In message body. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>response</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The Out message (only for InOut message exchange pattern). </p></td></tr></tbody></table> 
 </div>
</div><p>From Camel 2.14, you can setup your custom FreeMarker context in the message header with the key "<strong>CamelFreemarkerDataModel</strong>" just like this</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Map&amp;lt;String, Object&amp;gt; variableMap = new HashMap&amp;lt;String, Object&amp;gt;(); variableMap.put(&amp;quot;headers&amp;quot;, headersMap); variableMap.put(&amp;quot;body&amp;quot;, &amp;quot;Monday&amp;quot;); variableMap.put(&amp;quot;exchange&amp;quot;, exchange); exchange.getIn().setHeader(&amp;quot;CamelFreemarkerDataModel&amp;quot;, variableMap); </script> 
 </div>
</div><h3 id="BookInOnePage-Hotreloading">Hot reloading</h3><p>The FreeMarker template resource is by default <strong>not</strong> hot reloadable for both file and classpath resources (expanded jar). If you set <code>contentCache=false</code>, then Camel will not cache the resource and hot reloading is thus enabled. This scenario can be used in development.</p><h3 id="BookInOnePage-Dynamictemplates">Dynamic templates</h3><p>Camel provides two headers by which you can define a different resource location for a template or the template content itself. If any of these headers is set then Camel uses this over the endpoint configured resource. This allows you to provide a dynamic template at runtime.</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Header </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Type </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Support Version </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> FreemarkerConstants.FREEMARKER_RESOURCE </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> org.springframework.core.io.Resource </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The template resource </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> &lt;= 2.1 </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> FreemarkerConstants.FREEMARKER_RESOURCE_URI </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> String </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> A URI for the template resource to use instead of the endpoint configured. </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> &gt;= 2.1 </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> FreemarkerConstants.FREEMARKER_TEMPLATE </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> String </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The template to use instead of the endpoint configured. </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> &gt;= 2.1 </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Samples.8">Samples</h3><p>For example you could use something like:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:My.Queue&amp;quot;). to(&amp;quot;freemarker:com/acme/MyResponse.ftl&amp;quot;); </script> 
 </div>
</div><p>To use a FreeMarker template to formulate a response for a message for InOut message exchanges (where there is a <code>JMSReplyTo</code> header).</p><p>If you want to use InOnly and consume the message and send it to another destination you could use:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:My.Queue&amp;quot;). to(&amp;quot;freemarker:com/acme/MyResponse.ftl&amp;quot;). to(&amp;quot;activemq:Another.Queue&amp;quot;); </script> 
 </div>
</div><p>And to disable the content cache, e.g. for development usage where the <code>.ftl</code> template should be hot reloaded:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:My.Queue&amp;quot;). to(&amp;quot;freemarker:com/acme/MyResponse.ftl?contentCache=false&amp;quot;). to(&amp;quot;activemq:Another.Queue&amp;quot;); </script> 
 </div>
</div><p>And a file-based resource:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:My.Queue&amp;quot;). to(&amp;quot;freemarker:file://myfolder/MyResponse.ftl?contentCache=false&amp;quot;). to(&amp;quot;activemq:Another.Queue&amp;quot;); </script> 
 </div>
</div><p>In <strong>Camel 2.1</strong> it's possible to specify what template the component should use dynamically via a header, so for example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:in&amp;quot;). setHeader(FreemarkerConstants.FREEMARKER_RESOURCE_URI).constant(&amp;quot;path/to/my/template.ftl&amp;quot;). to(&amp;quot;freemarker:dummy&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-TheEmailSample">The Email Sample</h3><p>In this sample we want to use FreeMarker templating for an order confirmation email. The email template is laid out in FreeMarker as:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Dear ${headers.lastName}, ${headers.firstName} Thanks for the order of ${headers.item}. Regards Camel Riders Bookstore ${body} </script> 
 </div>
</div><p>And the java code:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> private Exchange createLetter() { Exchange exchange = context.getEndpoint(&amp;quot;direct:a&amp;quot;).createExchange(); Message msg = exchange.getIn(); msg.setHeader(&amp;quot;firstName&amp;quot;, &amp;quot;Claus&amp;quot;); msg.setHeader(&amp;quot;lastName&amp;quot;, &amp;quot;Ibsen&amp;quot;); msg.setHeader(&amp;quot;item&amp;quot;, &amp;quot;Camel in Action&amp;quot;); msg.setBody(&amp;quot;PS: Next beer is on me, James&amp;quot;); return exchange; } @Test public void testFreemarkerLetter() throws Exception { MockEndpoint mock = getMockEndpoint(&amp;quot;mock:result&amp;quot;); mock.expectedMessageCount(1); mock.message(0).body().contains(&amp;quot;Dear Ibsen, Claus&amp;quot;); mock.message(0).body().contains(&amp;quot;Thanks for the order of Camel in Action.&amp;quot;); template.send(&amp;quot;direct:a&amp;quot;, createLetter()); mock.assertIsSatisfied(); } protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { public void configure() throws Exception { from(&amp;quot;direct:a&amp;quot;) .to(&amp;quot;freemarker:org/apache/camel/component/freemarker/letter.ftl&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); } }; } </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.38">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-FTP/SFTP/FTPSComponent">FTP/SFTP/FTPS Component</h2><p>This component provides access to remote file systems over the FTP and SFTP protocols.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-ftp&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt;See the documentation of the Apache Commons &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><p>&#160;</p><p>&#160;</p><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">More options</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>See <a shape="rect" href="file2.html">File</a> for more options as all the options from <a shape="rect" href="file2.html">File</a> is inherited.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Absolute paths</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Absolute path is <strong>not</strong> supported.</p>
  <p><strong>Camel 2.16</strong> will translate absolute paths to relative ones by trimming all leading slashes from <code>directoryname</code>. There'll be WARN message printed in the logs.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Consuming from remote FTP server</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Make sure you read the section titled <em>Default when consuming files</em> further below for details related to consuming files.</p>
 </div>
</div><h3 id="BookInOnePage-URIformat.23">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">ftp://[username@]hostname[:port]/directoryname[?options] sftp://[username@]hostname[:port]/directoryname[?options] ftps://[username@]hostname[:port]/directoryname[?options] </script> 
 </div>
</div><p>Where <strong>directoryname</strong> represents the underlying directory. The directory name is a relative path. Absolute paths are&#160;<strong>not</strong> supported. The relative path can contain nested folders, such as /inbox/us.</p><p>For Camel versions before <strong>Camel 2.16</strong>, the directoryName&#160;<strong>must</strong> exist already as this component does not support the&#160;<code>autoCreate</code> option (which the file component does). The reason is that its the FTP administrator (FTP server) task to properly setup user accounts, and home directories with the right file permissions etc.</p><p>For <strong>Camel 2.16</strong>,&#160;<code>autoCreate</code> option is supported. When consumer starts, before polling is scheduled, there's additional FTP operation performed to create the directory configured for endpoint. The default value for <code>autoCreate</code> is&#160;<code>true</code>.</p><p>If no <strong>username</strong> is provided, then <code>anonymous</code> login is attempted using no password.<br clear="none"> If no <strong>port</strong> number is provided, Camel will provide default values according to the protocol (ftp = 21, sftp = 22, ftps = 2222).</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><p>This component uses two different libraries for the actual FTP work. FTP and FTPS uses <a shape="rect" class="external-link" href="http://commons.apache.org/net/">Apache Commons Net</a> while SFTP uses <a shape="rect" class="external-link" href="http://www.jcraft.com/jsch/" rel="nofollow">JCraft JSCH</a>.</p><p>The FTPS component is only available in Camel 2.2 or newer.<br clear="none"> FTPS (also known as FTP Secure) is an extension to FTP that adds support for the Transport Layer Security (TLS) and the Secure Sockets Layer (SSL) cryptographic protocols.</p><h3 id="BookInOnePage-URIOptions.3">URI Options</h3><p>The options below are exclusive for the FTP component.</p><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">More options</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>See <a shape="rect" href="file2.html">File</a> for more options as all the options from <a shape="rect" href="file2.html">File</a> is inherited.</p>
 </div>
</div><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>username</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the username to use to log in to the remote file systen.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>password</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the password to use to log in to the remote file system.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>account</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>null</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.15.2:</strong> Specified the account to use to login to the remote FTP server (only for FTP and FTP Secure)</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>binary</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the file transfer mode, BINARY or ASCII. Default is ASCII (<code>false</code>).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>disconnect</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.2:</strong> Whether or not to disconnect from remote FTP server right after use. Can be used for both consumer and producer. Disconnect will only disconnect the current connection to the FTP server. If you have a consumer which you want to stop, then you need to stop the consumer/route instead.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>localWorkDirectory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>When consuming, a local work directory can be used to store the remote file content directly in local files, to avoid loading the content into memory. This is beneficial, if you consume a very big remote file and thus can conserve memory. See below for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>passiveMode</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FTP and FTPS only</strong>: Specifies whether to use passive mode connections. Default is active mode (<code>false</code>).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>securityProtocol</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>TLS</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FTPS only:</strong> Sets the underlying security protocol. The following values are defined: <br clear="none" class="atl-forced-newline"> <code>TLS</code>: Transport Layer Security <br clear="none" class="atl-forced-newline"> <code>SSL</code>: Secure Sockets Layer</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>disableSecureDataChannelDefaults</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.4: FTPS only</strong>: Whether or not to disable using default values for <code>execPbsz</code> and <code>execProt</code> when using secure data transfer. You can set this option to <code>true</code> if you want to be in full control what the options <code>execPbsz</code> and <code>execProt</code> should be used.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>download</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> Whether the FTP consumer should download the file. If this option is set to <code>false</code>, then the message body will be <code>null</code>, but the consumer will still trigger a Camel <a shape="rect" href="exchange.html">Exchange</a> that has details about the file such as file name, file size, etc. It's just that the file will not be downloaded.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>streamDownload</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>false</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong>&#160;Whether the consumer should download the entire file up front, the default behavior, or if it should pass an InputStream&#160;read from the remote resource rather than an in-memory array as the in body of the&#160;Camel&#160;<a shape="rect" href="exchange.html">Exchange</a>. &#160;This option is ignored if download&#160;is false&#160;or is localWorkDirectory is provided. &#160;This option is useful for working with large remote files.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>execProt</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.4: FTPS only</strong>: Will by default use option <code>P</code> if secure data channel defaults hasn't been disabled. Possible values are: <br clear="none" class="atl-forced-newline"> <code>C</code>: Clear <br clear="none" class="atl-forced-newline"> <code>S</code>: Safe (SSL protocol only) <br clear="none" class="atl-forced-newline"> <code>E</code>: Confidential (SSL protocol only) <br clear="none" class="atl-forced-newline"> <code>P</code>: Private</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>execPbsz</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.4: FTPS only</strong>: This option specifies the buffer size of the secure data channel. If option <code>useSecureDataChannel</code> has been enabled and this option has not been explicit set, then value <code>0</code> is used.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>isImplicit</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FTPS only:</strong> Sets the security mode(implicit/explicit). Default is explicit (<code>false</code>).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>knownHostsFile</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>SFTP only:</strong> Sets the <code>known_hosts</code> file, so that the SFTP endpoint can do host key verification.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>useUserKnownHostsFile</code></td><td colspan="1" rowspan="1" class="confluenceTd"><span style="font-family: monospace;">true</span></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>SFTP onlly: Camel 2.18:</strong> If knownHostFile has not been explicit configured then use the host file from System.getProperty(user.home)/.ssh/known_hosts</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>knownHostsUri</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>SFTP only:</strong> <strong>Camel 2.11.1:</strong> Sets the <code>known_hosts</code> file (loaded from classpath by default), so that the SFTP endpoint can do host key verification.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>keyPair</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>SFTP only:</strong> <strong>Camel 2.12.0:</strong> Sets the Java KeyPair for SSH public key authentication, it supports DSA or RSA keys.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>privateKeyFile</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>SFTP only:</strong> Set the private key file to that the SFTP endpoint can do private key verification.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>privateKeyUri</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>SFTP only:</strong> <strong>Camel 2.11.1:</strong> Set the private key file (loaded from classpath by default) to that the SFTP endpoint can do private key verification.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>privateKey</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>SFTP only:</strong> <strong>Camel 2.11.1:</strong> Set the private key as byte[] to that the SFTP endpoint can do private key verification.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>privateKeyFilePassphrase</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>SFTP only:</strong> <strong>Deprecated:</strong> use <code>privateKeyPassphrase</code> instead. Set the private key file passphrase to that the SFTP endpoint can do private key verification.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>privateKeyPassphrase</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>SFTP only:</strong> <strong>Camel 2.11.1:</strong> Set the private key file passphrase to that the SFTP endpoint can do private key verification.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>preferredAuthentications</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>SFTP only:</strong> <strong>Camel 2.10.7, 2.11.2,2.12.0:</strong> set the preferred authentications which SFTP endpoint will used. Some example include:password,publickey. If not specified the default list from JSCH will be used.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ciphers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8.2, 2.9: SFTP only</strong> Set a comma separated list of ciphers that will be used in order of preference. Possible cipher names are defined by <a shape="rect" class="external-link" href="http://www.jcraft.com/jsch/" rel="nofollow">JCraft JSCH</a>. Some examples include: aes128-ctr,aes128-cbc,3des-ctr,3des-cbc,blowfish-cbc,aes192-cbc,aes256-cbc. If not specified the default list from JSCH will be used.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>fastExistsCheck</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8.2, 2.9:</strong> If set this option to be true, camel-ftp will use the list file directly to check if the file exists. Since some FTP server may not support to list the file directly, if the option is false, camel-ftp will use the old way to list the directory and check if the file exists. Note from <strong>Camel 2.10.1</strong> onwards this option also influences <code>readLock=changed</code> to control whether it performs a fast check to update file information or not. This can be used to speed up the process if the FTP server has a lot of files.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>strictHostKeyChecking</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>no</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>SFTP only:</strong> <strong>Camel 2.2:</strong> Sets whether to use strict host key checking. Possible values are: <code>no</code>, <code>yes</code> and <code>ask</code>. <code>ask</code> does not make sense to use as Camel cannot answer the question for you as its meant for human intervention. <strong>Note:</strong> The default in Camel 2.1 and below was <code>ask</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maximumReconnectAttempts</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>3</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the maximum reconnect attempts Camel performs when it tries to connect to the remote FTP server. Use 0 to disable this behavior.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>reconnectDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Delay in millis Camel will wait before performing a reconnect attempt.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>connectTimeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>10000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.4:</strong> Is the connect timeout in millis. This corresponds to using <code>ftpClient.connectTimeout</code> for the FTP/FTPS. For SFTP this option is also used when attempting to connect.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>soTimeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null / 30000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FTP and FTPS Only:</strong> <strong>Camel 2.4:</strong> Is the <code>SocketOptions.SO_TIMEOUT</code> value in millis. A good idea is to configure this to a value such as 300000 (5 minutes) to not hang a connection. On SFTP this option is set as timeout on the JSCH Session instance.</p><p>Also SFTP from <strong>Camel 2.14.3/2.15.3/2.16</strong> onwards.</p><p>From <strong>Camel 2.16</strong> onwards the default is 30000 (30 sec).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>timeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>30000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FTP and FTPS Only:</strong> <strong>Camel 2.4:</strong> Is the data timeout in millis. This corresponds to using <code>ftpClient.dataTimeout</code> for the FTP/FTPS. For SFTP there is no data timeout.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>throwExceptionOnConnectFailed</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> Whether or not to thrown an exception if a successful connection and login could not be establish. This allows a custom <code>pollStrategy</code> to deal with the exception, for example to stop the consumer or the likes.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>siteCommand</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FTP and FTPS Only:</strong> <strong>Camel 2.5:</strong> To execute site commands after successful login. Multiple site commands can be separated using a new line character (\n). Use <code>help site</code> to see which site commands your FTP server supports.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>stepwise</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.6:</strong> Whether or not stepwise traversing directories should be used or not. Stepwise means that it will CD one directory at a time. See more details below. You can disable this in case you can't use this approach.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>separator</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code><span>UNIX</span></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.6:</strong> Dictates what path separator char to use when uploading files. <code>Auto</code> = Use the path provided without altering it. <code>UNIX</code> = Use unix style path separators. <code>Windows</code> = Use Windows style path separators.</p><p>Since <strong>Camel 2.15.2</strong>: The default value is changed to <span>UNIX</span> style path, before <strong>Camel 2.15.2</strong>: The default value is <code>Auto.</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>chmod</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>SFTP Producer Only:</strong> <strong>Camel 2.9:</strong> Allows you to set chmod on the stored file. For example <code>chmod=640</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>compression</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>0</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>SFTP Only:</strong> <strong>Camel 2.8.3/2.9:</strong> To use compression. Specify a level from 1 to 10. <strong>Important:</strong> You must manually add the needed JSCH zlib JAR to the classpath for compression support.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>receiveBufferSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>32768</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong><span>FTP/FTPS Only: </span>Camel 2.15.1:</strong> The buffer size for downloading files. The default size is 32kb.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ftpClient</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FTP and FTPS Only:</strong> <strong>Camel 2.1:</strong> Allows you to use a custom <code>org.apache.commons.net.ftp.FTPClient</code> instance.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ftpClientConfig</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FTP and FTPS Only:</strong> <strong>Camel 2.1:</strong> Allows you to use a custom <code>org.apache.commons.net.ftp.FTPClientConfig</code> instance.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>ftpClientConfig.XXX</code></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>FTP and FTPS Only:</strong> To configure various options on the FTPClient instance from the uri. For example: <code>ftpClientConfig.receiveDataSocketBufferSize=8192&amp;<span>ftpClientConfig.sendDataSocketBufferSize=8192</span></code></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>serverAliveInterval</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>SFTP Only:</strong> <strong>Camel 2.8</strong> Allows you to set the serverAliveInterval of the sftp session</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>serverAliveCountMax</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>SFTP Only:</strong> <strong>Camel 2.8</strong> Allows you to set the serverAliveCountMax of the sftp session</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ftpClient.trustStore.file</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FTPS Only:</strong> Sets the trust store file, so that the FTPS client can look up for trusted certificates.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ftpClient.trustStore.type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>JKS</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FTPS Only:</strong> Sets the trust store type.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ftpClient.trustStore.algorithm</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>SunX509</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FTPS Only:</strong> Sets the trust store algorithm.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ftpClient.trustStore.password</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FTPS Only:</strong> Sets the trust store password.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ftpClient.keyStore.file</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FTPS Only:</strong> Sets the key store file, so that the FTPS client can look up for the private certificate.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ftpClient.keyStore.type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>JKS</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FTPS Only:</strong> Sets the key store type.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ftpClient.keyStore.algorithm</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>SunX509</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FTPS Only:</strong> Sets the key store algorithm.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ftpClient.keyStore.password</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FTPS Only:</strong> Sets the key store password.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ftpClient.keyStore.keyPassword</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FTPS Only:</strong> Sets the private key password.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sslContextParameters</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FTPS Only:</strong> <strong>Camel 2.9:</strong> Reference to a <code>org.apache.camel.util.jsse.SSLContextParameters</code> in the <a shape="rect" class="external-link" href="http://camel.apache.org/registry.html">Registry</a>.&#160; This reference overrides any configured SSL related options on ftpClient as well as the securityProtocol (SSL, TLS, etc.) set on FtpsConfiguration.&#160; See <a shape="rect" href="camel-configuration-utilities.html">Using the JSSE Configuration Utility</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>proxy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>SFTP Only:</strong> <strong>Camel 2.10.7, 2.11.1:</strong> Reference to a <code>com.jcraft.jsch.Proxy</code> in the <a shape="rect" class="external-link" href="http://camel.apache.org/registry.html">Registry</a>.&#160; This proxy is used to consume/send messages from the target SFTP host.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>useList</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>FTP/FTPS Only:</strong> <strong>Camel 2.12.1:</strong> Whether the consumer should use FTP LIST command to retrieve directory listing to see which files exists. If this option is set to <code>false</code>, then <code>stepwise=false</code> must be configured, and also <code>fileName</code> must be configured to a fixed name, so the consumer knows the name of the file to retrieve. When doing this only that single file can be retrieved. See further below for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ignoreFileNotFoundOrPermissionError</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12.1:</strong> Whether the consumer should ignore when a file was attempted to be retrieved but did not exist (for some reason), or failure due insufficient file permission error. <strong>Camel 2.14.2:</strong> This option now applies to directories as well.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>sendNoop</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>true</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> Producer only. Whether to send a noop command as a pre-write check before uploading files to the FTP server. This is enabled by default as a validation of the connection is still valid, which allows to silently re-connect to be able to upload the file. However if this causes problems, you can turn this option off.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>jschLoggingLevel</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>WARN</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>SFTP Only: Camel 2.15.3/2.16:</strong> The logging level to use for JSCH activity logging. As JSCH is verbose at by default at INFO level the threshold is WARN by default.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>bulkRequest</code></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>SFTP Only: Camel 2.17.1:</strong> Specifies how many requests may be outstanding at any one time. Increasing this value may slightly improve file transfer speed but will increase memory usage.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>disconnectOnBatchComplete</code></td><td colspan="1" rowspan="1" class="confluenceTd">false</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.18:</strong> Whether or not to disconnect from remote FTP server after a Batch is complete. Can be used for both consumer and producer. Disconnect will only disconnect the current connection to the FTP server. If you have a consumer which you want to stop, then you need to stop the consumer/route instead.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>activePortRange</code></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.18:</strong> Set the client side port range in active mode. The syntax is: minPort-maxPort. Both port numbers are inclusive, eg 10000-19999 to include all 1xxxx ports.</td></tr></tbody></table> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">FTPS component default trust store</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>When using the <code>ftpClient.</code> properties related to SSL with the FTPS component, the trust store accepts all certificates. If you only want trust selective certificates, you have to configure the trust store with the <code>ftpClient.trustStore.xxx</code> options or by configuring a custom <code>ftpClient</code>.</p>
  <p>When using <code>sslContextParameters</code>, the trust store is managed by the configuration of the provided SSLContextParameters instance.</p>
 </div>
</div><p>You can configure additional options on the <code>ftpClient</code> and <code>ftpClientConfig</code> from the URI directly by using the <code>ftpClient.</code> or <code>ftpClientConfig.</code> prefix.</p><p>For example to set the <code>setDataTimeout</code> on the <code>FTPClient</code> to 30 seconds you can do:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;ftp://foo@myserver?password=secret&amp;amp;ftpClient.dataTimeout=30000&amp;quot;).to(&amp;quot;bean:foo&amp;quot;); </script> 
 </div>
</div><p>You can mix and match and have use both prefixes, for example to configure date format or timezones.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;ftp://foo@myserver?password=secret&amp;amp;ftpClient.dataTimeout=30000&amp;amp;ftpClientConfig.serverLanguageCode=fr&amp;quot;).to(&amp;quot;bean:foo&amp;quot;); </script> 
 </div>
</div><p>You can have as many of these options as you like.</p><p>See the documentation of the Apache Commons FTP FTPClientConfig for possible options and more details.&#160;And as well for Apache Commons FTP FTPClient.</p><p>If you do not like having many and long configuration in the url you can refer to the <code>ftpClient</code> or <code>ftpClientConfig</code> to use by letting Camel lookup in the <a shape="rect" href="registry.html">Registry</a> for it.</p><p>For example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;myConfig&amp;quot; class=&amp;quot;org.apache.commons.net.ftp.FTPClientConfig&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;lenientFutureDates&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;serverLanguageCode&amp;quot; value=&amp;quot;fr&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>And then let Camel lookup this bean when you use the # notation in the url.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;ftp://foo@myserver?password=secret&amp;amp;ftpClientConfig=#myConfig&amp;quot;).to(&amp;quot;bean:foo&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-MoreURIoptions">More URI options</h3><div class="confluence-information-macro confluence-information-macro-information">
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>See <a shape="rect" href="file2.html">File2</a> as all the options there also applies for this component.</p>
 </div>
</div><h3 id="BookInOnePage-Examples.17">Examples</h3><p><code><a shape="rect" class="external-link" href="ftp://someone@someftpserver.com/public/upload/images/holiday2008?password=secret&amp;binary=true" rel="nofollow">ftp://someone@someftpserver.com/public/upload/images/holiday2008?password=secret&amp;binary=true</a></code><br clear="none"> <code><a shape="rect" class="external-link" href="ftp://someoneelse@someotherftpserver.co.uk:12049/reports/2008/password=secret&amp;binary=false" rel="nofollow">ftp://someoneelse@someotherftpserver.co.uk:12049/reports/2008/password=secret&amp;binary=false</a></code><br clear="none"> <code><a shape="rect" class="external-link" href="ftp://publicftpserver.com/download" rel="nofollow">ftp://publicftpserver.com/download</a></code></p><div class="confluence-information-macro confluence-information-macro-warning">
 <p class="title">FTP Consumer does not support concurrency</p>
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The FTP consumer (with the same endpoint) does not support concurrency (the backing FTP client is not thread safe).<br clear="none"> You can use multiple FTP consumers to poll from different endpoints. It is only a single endpoint that does not support concurrent consumers.</p>
  <p>The FTP producer does <strong>not</strong> have this issue, it supports concurrency.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">More information</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>This component is an extension of the <a shape="rect" href="file2.html">File</a> component. So there are more samples and details on the <a shape="rect" href="file2.html">File</a> component page.</p>
 </div>
</div><h3 id="BookInOnePage-Defaultwhenconsumingfiles">Default when consuming files</h3><p>The <a shape="rect" href="ftp2.html">FTP</a> consumer will by default leave the consumed files untouched on the remote FTP server. You have to configure it explicitly if you want it to delete the files or move them to another location. For example you can use <code>delete=true</code> to delete the files, or use <code>move=.done</code> to move the files into a hidden done sub directory.</p><p>The regular <a shape="rect" href="file2.html">File</a> consumer is different as it will by default move files to a <code>.camel</code> sub directory. The reason Camel does <strong>not</strong> do this by default for the FTP consumer is that it may lack permissions by default to be able to move or delete files.</p><h4 id="BookInOnePage-limitations">limitations</h4><p>The option <strong>readLock</strong> can be used to force Camel <strong>not</strong> to consume files that are currently being written. However, this option is turned off by default, as it requires that the user has write access. See the options table at <a shape="rect" href="file2.html">File2</a> for more details about read locks.<br clear="none"> There are other solutions to avoid consuming files that are currently being written over FTP; for instance, you can write to a temporary destination and move the file after it has been written.</p><p>When moving files using <code>move</code> or <code>preMove</code> option the files are restricted to the FTP_ROOT folder. That prevents you from moving files outside the FTP area. If you want to move files to another area you can use soft links and move files into a soft linked folder.</p><h3 id="BookInOnePage-MessageHeaders.3">Message Headers</h3><p>The following message headers can be used to affect the behavior of the component</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelFileName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the output file name (relative to the endpoint directory) to be used for the output message when sending to the endpoint. If this is not present and no expression either, then a generated message ID is used as the filename instead.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelFileNameProduced</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The actual filepath (path + name) for the output file that was written. This header is set by Camel and its purpose is providing end-users the name of the file that was written.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelBatchIndex</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Current index out of total number of files being consumed in this batch.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelBatchSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Total number of files being consumed in this batch.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelFileHost</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The remote hostname.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelFileLocalWorkPath</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Path to the local work file, if local work directory is used.</p></td></tr></tbody></table> 
 </div>
</div><p>In addition the FTP/FTPS consumer and producer will enrich the Camel <code>Message</code> with the following headers</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelFtpReplyCode</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.1:</strong> The FTP client reply code (the type is a integer)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelFtpReplyString</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.1:</strong> The FTP client reply string</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Abouttimeouts">About timeouts</h3><p>The two set of libraries (see top) have different APIs for setting timeout. You can use the <code>connectTimeout</code> option for both of them to set a timeout in millis to establish a network connection. An individual <code>soTimeout</code> can also be set on the FTP/FTPS, which corresponds to using <code>ftpClient.soTimeout</code>. Notice SFTP will automatically use <code>connectTimeout</code> as its <code>soTimeout</code>. The <code>timeout</code> option only applies for FTP/FTSP as the data timeout, which corresponds to the <code>ftpClient.dataTimeout</code> value. All timeout values are in millis.</p><h3 id="BookInOnePage-UsingLocalWorkDirectory">Using Local Work Directory</h3><p>Camel supports consuming from remote FTP servers and downloading the files directly into a local work directory. This avoids reading the entire remote file content into memory as it is streamed directly into the local file using <code>FileOutputStream</code>.</p><p>Camel will store to a local file with the same name as the remote file, though with <code>.inprogress</code> as extension while the file is being downloaded. Afterwards, the file is renamed to remove the <code>.inprogress</code> suffix. And finally, when the <a shape="rect" href="exchange.html">Exchange</a> is complete the local file is deleted.</p><p>So if you want to download files from a remote FTP server and store it as files then you need to route to a file endpoint such as:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;ftp://someone@someserver.com?password=secret&amp;amp;localWorkDirectory=/tmp&amp;quot;).to(&amp;quot;file://inbox&amp;quot;); </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Optimization by renaming work file</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The route above is ultra efficient as it avoids reading the entire file content into memory. It will download the remote file directly to a local file stream. The <code>java.io.File</code> handle is then used as the <a shape="rect" href="exchange.html">Exchange</a> body. The file producer leverages this fact and can work directly on the work file <code>java.io.File</code> handle and perform a <code>java.io.File.rename</code> to the target filename. As Camel knows it's a local work file, it can optimize and use a rename instead of a file copy, as the work file is meant to be deleted anyway.</p>
 </div>
</div><h3 id="BookInOnePage-Stepwisechangingdirectories">Stepwise changing directories</h3><p>Camel <a shape="rect" href="ftp2.html">FTP</a> can operate in two modes in terms of traversing directories when consuming files (eg downloading) or producing files (eg uploading)</p><ul class="alternate"><li>stepwise</li><li>not stepwise</li></ul><p>You may want to pick either one depending on your situation and security issues. Some Camel end users can only download files if they use stepwise, while others can only download if they do not. At least you have the choice to pick (from Camel 2.6 onwards).</p><p>In Camel 2.0 - 2.5 there is only one mode and it is:</p><ul class="alternate"><li>before 2.5 not stepwise</li><li>2.5 stepwise</li></ul><p>From Camel 2.6 onwards there is now an option <code>stepwise</code> you can use to control the behavior.</p><p>Note that stepwise changing of directory will in most cases only work when the user is confined to it's home directory and when the home directory is reported as <code>"/"</code>.</p><p>The difference between the two of them is best illustrated with an example. Suppose we have the following directory structure on the remote FTP server we need to traverse and download files:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">/ /one /one/two /one/two/sub-a /one/two/sub-b </script> 
 </div>
</div><p>And that we have a file in each of sub-a (a.txt) and sub-b (b.txt) folder.</p><h4 id="BookInOnePage-Usingstepwise=true(defaultmode)">Using stepwise=true (default mode)</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">TYPE A 200 Type set to A PWD 257 &amp;quot;/&amp;quot; is current directory. CWD one 250 CWD successful. &amp;quot;/one&amp;quot; is current directory. CWD two 250 CWD successful. &amp;quot;/one/two&amp;quot; is current directory. SYST 215 UNIX emulated by FileZilla PORT 127,0,0,1,17,94 200 Port command successful LIST 150 Opening data channel for directory list. 226 Transfer OK CWD sub-a 250 CWD successful. &amp;quot;/one/two/sub-a&amp;quot; is current directory. PORT 127,0,0,1,17,95 200 Port command successful LIST 150 Opening data channel for directory list. 226 Transfer OK CDUP 200 CDUP successful. &amp;quot;/one/two&amp;quot; is current directory. CWD sub-b 250 CWD successful. &amp;quot;/one/two/sub-b&amp;quot; is current directory. PORT 127,0,0,1,17,96 200 Port command successful LIST 150 Opening data channel for directory list. 226 Transfer OK CDUP 200 CDUP successful. &amp;quot;/one/two&amp;quot; is current directory. CWD / 250 CWD successful. &amp;quot;/&amp;quot; is current directory. PWD 257 &amp;quot;/&amp;quot; is current directory. CWD one 250 CWD successful. &amp;quot;/one&amp;quot; is current directory. CWD two 250 CWD successful. &amp;quot;/one/two&amp;quot; is current directory. PORT 127,0,0,1,17,97 200 Port command successful RETR foo.txt 150 Opening data channel for file transfer. 226 Transfer OK CWD / 250 CWD successful. &amp;quot;/&amp;quot; is current directory. PWD 257 &amp;quot;/&amp;quot; is current directory. CWD one 250 CWD successful. &amp;quot;/one&amp;quot; is current directory. CWD two 250 CWD successful. &amp;quot;/one/two&amp;quot; is current directory. CWD sub-a 250 CWD successful. &amp;quot;/one/two/sub-a&amp;quot; is current directory. PORT 127,0,0,1,17,98 200 Port command successful RETR a.txt 150 Opening data channel for file transfer. 226 Transfer OK CWD / 250 CWD successful. &amp;quot;/&amp;quot; is current directory. PWD 257 &amp;quot;/&amp;quot; is current directory. CWD one 250 CWD successful. &amp;quot;/one&amp;quot; is current directory. CWD two 250 CWD successful. &amp;quot;/one/two&amp;quot; is current directory. CWD sub-b 250 CWD successful. &amp;quot;/one/two/sub-b&amp;quot; is current directory. PORT 127,0,0,1,17,99 200 Port command successful RETR b.txt 150 Opening data channel for file transfer. 226 Transfer OK CWD / 250 CWD successful. &amp;quot;/&amp;quot; is current directory. QUIT 221 Goodbye disconnected. </script> 
 </div>
</div><p>As you can see when stepwise is enabled, it will traverse the directory structure using CD xxx.</p><h4 id="BookInOnePage-Usingstepwise=false">Using stepwise=false</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">230 Logged on TYPE A 200 Type set to A SYST 215 UNIX emulated by FileZilla PORT 127,0,0,1,4,122 200 Port command successful LIST one/two 150 Opening data channel for directory list 226 Transfer OK PORT 127,0,0,1,4,123 200 Port command successful LIST one/two/sub-a 150 Opening data channel for directory list 226 Transfer OK PORT 127,0,0,1,4,124 200 Port command successful LIST one/two/sub-b 150 Opening data channel for directory list 226 Transfer OK PORT 127,0,0,1,4,125 200 Port command successful RETR one/two/foo.txt 150 Opening data channel for file transfer. 226 Transfer OK PORT 127,0,0,1,4,126 200 Port command successful RETR one/two/sub-a/a.txt 150 Opening data channel for file transfer. 226 Transfer OK PORT 127,0,0,1,4,127 200 Port command successful RETR one/two/sub-b/b.txt 150 Opening data channel for file transfer. 226 Transfer OK QUIT 221 Goodbye disconnected. </script> 
 </div>
</div><p>As you can see when not using stepwise, there are no CD operation invoked at all.</p><h3 id="BookInOnePage-Samples.9">Samples</h3><p>In the sample below we set up Camel to download all the reports from the FTP server once every hour (60 min) as BINARY content and store it as files on the local file system.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { public void configure() throws Exception { // we use a delay of 60 minutes (eg. once pr. hour we poll the FTP server long delay = 3600000; // from the given FTP server we poll (= download) all the files // from the public/reports folder as BINARY types and store this as files // in a local directory. Camel will use the filenames from the FTPServer // notice that the FTPConsumer properties must be prefixed with &amp;quot;consumer.&amp;quot; in the URL // the delay parameter is from the FileConsumer component so we should use consumer.delay as // the URI parameter name. The FTP Component is an extension of the File Component. from(&amp;quot;ftp://tiger:scott@localhost/public/reports?binary=true&amp;amp;consumer.delay=&amp;quot; + delay). to(&amp;quot;file://target/test-reports&amp;quot;); } }; } </script> 
  </div>
 </div>And the route using Spring DSL:<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;ftp://scott@localhost/public/reports?password=tiger&amp;amp;amp;binary=true&amp;amp;amp;delay=60000&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;file://target/test-reports&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-ConsumingaremoteFTPSserver(implicitSSL)andclientauthentication">Consuming a remote FTPS server (implicit SSL) and client authentication</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;ftps://admin@localhost:2222/public/camel?password=admin&amp;amp;securityProtocol=SSL&amp;amp;isImplicit=true &amp;amp;ftpClient.keyStore.file=./src/test/resources/server.jks &amp;amp;ftpClient.keyStore.password=password&amp;amp;ftpClient.keyStore.keyPassword=password&amp;quot;) .to(&amp;quot;bean:foo&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-ConsumingaremoteFTPSserver(explicitTLS)andacustomtruststoreconfiguration">Consuming a remote FTPS server (explicit TLS) and a custom trust store configuration</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;ftps://admin@localhost:2222/public/camel?password=admin&amp;amp;ftpClient.trustStore.file=./src/test/resources/server.jks&amp;amp;ftpClient.trustStore.password=password&amp;quot;) .to(&amp;quot;bean:foo&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-Filterusingorg.apache.camel.component.file.GenericFileFilter.1">Filter using <code>org.apache.camel.component.file.GenericFileFilter</code></h3><p>Camel supports pluggable filtering strategies. This strategy can be provided by implementing&#160;<code>org.apache.camel.component.file.GenericFileFilter</code> in Java. You can then configure the endpoint with such a filter to skip certain filters before being processed.</p><p>In the sample we have built our own filter that only accepts files starting with report in the filename.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public class MyFileFilter&amp;lt;T&amp;gt; implements GenericFileFilter&amp;lt;T&amp;gt; { public boolean accept(GenericFile&amp;lt;T&amp;gt; file) { // we only want report files return file.getFileName().startsWith(&amp;quot;report&amp;quot;); } } </script> 
  </div>
 </div>And then we can configure our route using the <strong>filter</strong> attribute to reference our filter (using <code>#</code> notation) that we have defined in the spring XML file:<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- define our sorter as a plain spring bean --&amp;gt; &amp;lt;bean id=&amp;quot;myFilter&amp;quot; class=&amp;quot;com.mycompany.MyFileFilter&amp;quot;/&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;ftp://someuser@someftpserver.com?password=secret&amp;amp;amp;filter=#myFilter&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:processInbox&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-FilteringusingANTpathmatcher.1">Filtering using ANT path matcher</h3><p>The ANT path matcher is a filter that is shipped out-of-the-box in the <strong>camel-spring</strong> jar. So you need to depend on <strong>camel-spring</strong> if you are using Maven.<br clear="none"> The reason is that we leverage Spring's <a shape="rect" class="external-link" href="http://static.springsource.org/spring/docs/3.0.x/api/org/springframework/util/AntPathMatcher.html" rel="nofollow">AntPathMatcher</a> to do the actual matching.</p><p>The file paths are matched with the following rules:</p><ul class="alternate"><li><code>?</code> matches one character</li><li><code>*</code> matches zero or more characters</li><li><code>**</code> matches zero or more directories in a path</li></ul><p>The sample below demonstrates how to use it:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean class=&amp;quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&amp;quot;/&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;template id=&amp;quot;camelTemplate&amp;quot;/&amp;gt; &amp;lt;!-- use myFilter as filter to allow setting ANT paths for which files to scan for --&amp;gt; &amp;lt;endpoint id=&amp;quot;myFTPEndpoint&amp;quot; uri=&amp;quot;ftp://admin@localhost:${SpringFileAntPathMatcherRemoteFileFilterTest.ftpPort}/antpath?password=admin&amp;amp;amp;recursive=true&amp;amp;amp;delay=10000&amp;amp;amp;initialDelay=2000&amp;amp;amp;filter=#myAntFilter&amp;quot;/&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from ref=&amp;quot;myFTPEndpoint&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;!-- we use the AntPathMatcherRemoteFileFilter to use ant paths for includes and exclude --&amp;gt; &amp;lt;bean id=&amp;quot;myAntFilter&amp;quot; class=&amp;quot;org.apache.camel.component.file.AntPathMatcherGenericFileFilter&amp;quot;&amp;gt; &amp;lt;!-- include any files in the sub folder that has day in the name --&amp;gt; &amp;lt;property name=&amp;quot;includes&amp;quot; value=&amp;quot;**/subfolder/**/*day*&amp;quot;/&amp;gt; &amp;lt;!-- exclude all files with bad in name or .xml files. Use comma to separate multiple excludes --&amp;gt; &amp;lt;property name=&amp;quot;excludes&amp;quot; value=&amp;quot;**/*bad*,**/*.xml&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
  </div>
 </div><h3 id="BookInOnePage-UsingaproxywithSFTP">Using a proxy with SFTP</h3><p>To use an HTTP proxy to connect to your remote host, you can configure your route in the following way:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;!-- define our sorter as a plain spring bean --&amp;gt; &amp;lt;bean id=&amp;quot;proxy&amp;quot; class=&amp;quot;com.jcraft.jsch.ProxyHTTP&amp;quot;&amp;gt; &amp;lt;constructor-arg value=&amp;quot;localhost&amp;quot;/&amp;gt; &amp;lt;constructor-arg value=&amp;quot;7777&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;sftp://localhost:9999/root?username=admin&amp;amp;password=admin&amp;amp;proxy=#proxy&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:processFile&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>You can also assign a user name and password to the proxy, if necessary. Please consult the documentation for <code>com.jcraft.jsch.Proxy</code> to discover all options.</p><h3 id="BookInOnePage-SettingpreferredSFTPauthenticationmethod">Setting preferred SFTP authentication method</h3><p>If you want to explicitly specify the list of authentication methods that should be used by <code>sftp</code> component, use <code>preferredAuthentications</code> option. If for example you would like Camel to attempt to authenticate with private/public SSH key and fallback to user/password authentication in the case when no public key is available, use the following route configuration:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;sftp://localhost:9999/root?username=admin&amp;amp;password=admin&amp;amp;preferredAuthentications=publickey,password&amp;quot;). to(&amp;quot;bean:processFile&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-Consumingasinglefileusingafixedname">Consuming a single file using a fixed name</h3><p>When you want to download a single file and know the file name, you can use <code>fileName=myFileName.txt</code> to tell Camel the name of the file to download. By default the consumer will still do a FTP LIST command to do a directory listing and then filter these files based on the <code>fileName</code> option. Though in this use-case it may be desirable to turn off the directory listing by setting <code>useList=false</code>. For example the user account used to login to the FTP server may not have permission to do a FTP LIST command. So you can turn off this with <code>useList=false</code>, and then provide the fixed name of the file to download with <code>fileName=myFileName.txt</code>, then the FTP consumer can still download the file. If the file for some reason does not exist, then Camel will by default throw an exception, you can turn this off and ignore this by setting <code>ignoreFileNotFoundOrPermissionError=true</code>.</p><p>For example to have a Camel route that picks up a single file, and deletes it after use you can write</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;ftp://admin@localhost:21/nolist/?password=admin&amp;amp;stepwise=false&amp;amp;useList=false&amp;amp;ignoreFileNotFoundOrPermissionError=true&amp;amp;fileName=report.txt&amp;amp;delete=true&amp;quot;) .to(&amp;quot;activemq:queue:report&amp;quot;); </script> 
 </div>
</div><p>Notice that we have used all the options we talked above.</p><p>You can also use this with <code>ConsumerTemplate</code>. For example to download a single file (if it exists) and grab the file content as a String type:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">String data = template.retrieveBodyNoWait(&amp;quot;ftp://admin@localhost:21/nolist/?password=admin&amp;amp;stepwise=false&amp;amp;useList=false&amp;amp;ignoreFileNotFoundOrPermissionError=true&amp;amp;fileName=report.txt&amp;amp;delete=true&amp;quot;, String.class); </script> 
 </div>
</div><h3 id="BookInOnePage-Debuglogging.1">Debug logging</h3><p>This component has log level <strong>TRACE</strong> that can be helpful if you have problems.</p><p></p><h3 id="BookInOnePage-SeeAlso.39">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="file2.html">File2</a></li></ul><h2 id="BookInOnePage-CamelComponentsforGoogleAppEngine">Camel Components for Google App Engine</h2><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>This component is deprecated and will be removed form Camel 2.18 onwards.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Tutorials</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <ul><li>A good starting point for using Camel on GAE is the <a shape="rect" href="tutorial-for-camel-on-google-app-engine.html">Tutorial for Camel on Google App Engine</a></li><li>The <a shape="rect" href="tutorial-oauth.html">OAuth tutorial</a> demonstrates how to implement <a shape="rect" class="external-link" href="http://oauth.net/" rel="nofollow">OAuth</a> in web applications.</li></ul>
 </div>
</div><p>The Camel components for <a shape="rect" class="external-link" href="http://code.google.com/appengine/" rel="nofollow">Google App Engine</a> (GAE) are part of the <code>camel-gae</code> project and provide connectivity to GAE's <a shape="rect" class="external-link" href="http://code.google.com/appengine/docs/java/apis.html" rel="nofollow">cloud computing services</a>. They make the GAE cloud computing environment accessible to applications via Camel interfaces. Following this pattern for other cloud computing environments could make it easier to port Camel applications from one cloud computing provider to another. The following table lists the cloud computing services provided by Google and the supporting Camel components. The documentation of each component can be found by following the link in the <em>Camel Component</em> column.</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>GAE service</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Camel component</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Component description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://code.google.com/appengine/docs/java/urlfetch/" rel="nofollow">URL fetch service</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="ghttp.html">ghttp</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Provides connectivity to the GAE URL fetch service but can also be used to receive messages from servlets.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://code.google.com/appengine/docs/java/taskqueue/" rel="nofollow">Task queueing service</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="gtask.html">gtask</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Supports asynchronous message processing on GAE by using the task queueing service as message queue.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://code.google.com/appengine/docs/java/mail/" rel="nofollow">Mail service</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="gmail.html">gmail</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Supports sending of emails via the GAE mail service. Receiving mails is not supported yet but will be added later.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://code.google.com/appengine/docs/java/memcache/" rel="nofollow">Memcache service</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Not supported yet.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://code.google.com/appengine/docs/java/xmpp/" rel="nofollow">XMPP service</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Not supported yet.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://code.google.com/appengine/docs/java/images/" rel="nofollow">Images service</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Not supported yet.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://code.google.com/appengine/docs/java/datastore/" rel="nofollow">Datastore service</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Not supported yet.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://code.google.com/apis/accounts/" rel="nofollow">Accounts service</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" href="gauth.html">gauth</a> <br clear="none" class="atl-forced-newline"> <a shape="rect" href="glogin.html">glogin</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>These components interact with the Google Accounts API for authentication and authorization. Google Accounts is not specific to Google App Engine but is often used by GAE applications for implementing security. The <a shape="rect" href="gauth.html">gauth</a> component is used by web applications to implement a <a shape="rect" class="external-link" href="http://code.google.com/apis/accounts/docs/OAuth.html" rel="nofollow">Google-specific OAuth</a> consumer. This component can also be used to OAuth-enable non-GAE web applications. The <a shape="rect" href="glogin.html">glogin</a> component is used by Java clients (outside GAE) for programmatic login to GAE applications. For instructions how to protect GAE applications against unauthorized access refer to the <a shape="rect" href="gsec.html">Security for Camel GAE applications</a> page.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Camelcontext">Camel context</h3><p>Setting up a <code>SpringCamelContext</code> on Google App Engine differs between Camel 2.1 and higher versions. The problem is that usage of the Camel-specific Spring configuration XML schema from the <code><a shape="rect" class="external-link" href="http://camel.apache.org/schema/spring">http://camel.apache.org/schema/spring</a></code> namespace requires JAXB and Camel 2.1 depends on a Google App Engine SDK version that doesn't support JAXB yet. This limitation has been removed since Camel 2.2.</p><p>JMX must be disabled in any case because the <code>javax.management</code> package isn't on the App Engine JRE whitelist.</p><h4 id="BookInOnePage-Camel2.1">Camel 2.1</h4><p><code>camel-gae</code> 2.1 comes with the following <code>CamelContext</code> implementations.</p><ul><li><code>org.apache.camel.component.gae.context.GaeDefaultCamelContext</code> (extends <code>org.apache.camel.impl.DefaultCamelContext</code>)</li><li><code>org.apache.camel.component.gae.context.GaeSpringCamelContext</code> (extends <code>org.apache.camel.spring.SpringCamelContext</code>)</li></ul><p>Both disable JMX before startup. The <code>GaeSpringCamelContext</code> additionally provides setter methods adding route builders as shown in the next example.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>appctx.xml</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;beans xmlns=&amp;quot;http://www.springframework.org/schema/beans&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xsi:schemaLocation=&amp;quot; http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd&amp;quot;&amp;gt; &amp;lt;bean id=&amp;quot;camelContext&amp;quot; class=&amp;quot;org.apache.camel.component.gae.context.GaeSpringCamelContext&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;routeBuilder&amp;quot; ref=&amp;quot;myRouteBuilder&amp;quot; /&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;myRouteBuilder&amp;quot; class=&amp;quot;org.example.MyRouteBuilder&amp;quot;&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;/beans&amp;gt; </script> 
 </div>
</div><p>Alternatively, use the <code>routeBuilders</code> property of the <code>GaeSpringCamelContext</code> for setting a list of route builders. Using this approach, a <code>SpringCamelContext</code> can be configured on GAE without the need for JAXB.</p><h4 id="BookInOnePage-Camel2.2orhigher">Camel 2.2 or higher</h4><p>With Camel 2.2 or higher, applications can use the <code><a shape="rect" class="external-link" href="http://camel.apache.org/schema/spring">http://camel.apache.org/schema/spring</a></code> namespace for configuring a <code>SpringCamelContext</code> but still need to disable JMX. Here's an example.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>appctx.xml</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;beans xmlns=&amp;quot;http://www.springframework.org/schema/beans&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:camel=&amp;quot;http://camel.apache.org/schema/spring&amp;quot; xsi:schemaLocation=&amp;quot; http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd&amp;quot;&amp;gt; &amp;lt;camel:camelContext id=&amp;quot;camelContext&amp;quot;&amp;gt; &amp;lt;camel:jmxAgent id=&amp;quot;agent&amp;quot; disabled=&amp;quot;true&amp;quot; /&amp;gt; &amp;lt;camel:routeBuilder ref=&amp;quot;myRouteBuilder&amp;quot;/&amp;gt; &amp;lt;/camel:camelContext&amp;gt; &amp;lt;bean id=&amp;quot;myRouteBuilder&amp;quot; class=&amp;quot;org.example.MyRouteBuilder&amp;quot;&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;/beans&amp;gt; </script> 
 </div>
</div><p><span class="confluence-anchor-link" id="BookInOnePage-web-xml"></span></p><h3 id="BookInOnePage-Theweb.xml">The web.xml</h3><p>Running Camel on GAE requires usage of the <code>CamelHttpTransportServlet</code> from <code>camel-servlet</code>. The following example shows how to configure this servlet together with a Spring application context XML file.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>web.xml</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;web-app xmlns=&amp;quot;http://java.sun.com/xml/ns/javaee&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:web=&amp;quot;http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&amp;quot; xsi:schemaLocation=&amp;quot; http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&amp;quot; version=&amp;quot;2.5&amp;quot;&amp;gt; &amp;lt;servlet&amp;gt; &amp;lt;servlet-name&amp;gt;CamelServlet&amp;lt;/servlet-name&amp;gt; &amp;lt;servlet-class&amp;gt;org.apache.camel.component.servlet.CamelHttpTransportServlet&amp;lt;/servlet-class&amp;gt; &amp;lt;init-param&amp;gt; &amp;lt;param-name&amp;gt;contextConfigLocation&amp;lt;/param-name&amp;gt; &amp;lt;param-value&amp;gt;appctx.xml&amp;lt;/param-value&amp;gt; &amp;lt;/init-param&amp;gt; &amp;lt;/servlet&amp;gt; &amp;lt;!-- Mapping used for external requests --&amp;gt; &amp;lt;servlet-mapping&amp;gt; &amp;lt;servlet-name&amp;gt;CamelServlet&amp;lt;/servlet-name&amp;gt; &amp;lt;url-pattern&amp;gt;/camel/*&amp;lt;/url-pattern&amp;gt; &amp;lt;/servlet-mapping&amp;gt; &amp;lt;!-- Mapping used for web hooks accessed by task queueing service. --&amp;gt; &amp;lt;servlet-mapping&amp;gt; &amp;lt;servlet-name&amp;gt;CamelServlet&amp;lt;/servlet-name&amp;gt; &amp;lt;url-pattern&amp;gt;/worker/*&amp;lt;/url-pattern&amp;gt; &amp;lt;/servlet-mapping&amp;gt; &amp;lt;/web-app&amp;gt; </script> 
 </div>
</div><p>The location of the Spring application context XML file is given by the <code>contextConfigLocation</code> init parameter. The <code>appctx.xml</code> file must be on the classpath. The servlet mapping makes the Camel application accessible under <code>http://&lt;appname&gt;.appspot.com/camel/...</code> when deployed to Google App Engine where <code>&lt;appname&gt;</code> must be replaced by a real GAE application name. The second servlet mapping is used internally by the task queueing service for background processing via <a shape="rect" class="external-link" href="http://www.webhooks.org/" rel="nofollow">web hooks</a>. This mapping is relevant for the <a shape="rect" href="gtask.html">gtask</a> component and is explained there in more detail.</p><h2 id="BookInOnePage-HazelcastComponent">Hazelcast Component</h2><p><strong>Available as of Camel 2.7</strong></p><p>The <strong>hazelcast:</strong> component allows you to work with the <a shape="rect" class="external-link" href="http://www.hazelcast.com" rel="nofollow">Hazelcast</a> distributed data grid / cache. Hazelcast is a in memory data grid, entirely written in Java (single jar). It offers a great palette of different data stores like map, multi map (same key, n values), queue, list and atomic number. The main reason to use Hazelcast is its simple cluster support. If you have enabled multicast on your network you can run a cluster with hundred nodes with no extra configuration. Hazelcast can simply configured to add additional features like n copies between nodes (default is 1), cache persistence, network configuration (if needed), near cache, enviction and so on. For more information consult the Hazelcast documentation on <a shape="rect" class="external-link" href="http://www.hazelcast.com/docs.jsp" rel="nofollow">http://www.hazelcast.com/docs.jsp</a>.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-hazelcast&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.24">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">hazelcast:[ map | multimap | queue | topic | seda | set | atomicvalue | instance | list | ringbuffer]:cachename[?options] </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-information">
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Topic support is available as of Camel 2.15.&#160;</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-information">
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>RingBuffer support is available as of Camel 2.16.&#160;</p>
 </div>
</div><h3 id="BookInOnePage-Options.39">Options</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh">Name</th><th colspan="1" rowspan="1" class="confluenceTh">Required</th><th colspan="1" rowspan="1" class="confluenceTh">Description</th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">hazelcastInstance</td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.14:</strong><span> The hazelcast instance <strong>reference</strong> which can be used for hazelcast endpoint. If you don't specify the instance reference, camel use the default hazelcast instance from the camel-hazelcast instance.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">hazelcastInstanceName</td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong><span> The hazelcast instance <strong>reference name</strong> which can be used for hazelcast endpoint. If you don't specify the instance reference, camel use the default hazelcast instance from the camel-hazelcast instance.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">operation</td><td colspan="1" rowspan="1" class="confluenceTd">-1</td><td colspan="1" rowspan="1" class="confluenceTd"><span>To specify a default operation to use, if no operation header has been provided. </span><strong>deprecated</strong><span> use defaultOperation instead.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><span>defaultOperation</span></td><td colspan="1" rowspan="1" class="confluenceTd">-1</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.15:</strong><span> To specify a default operation to use, if no operation header has been provided.</span></td></tr></tbody></table>
</div><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>You have to use the second prefix to define which type of data store you want to use.</p>
 </div>
</div><h3 id="BookInOnePage-Sections">Sections</h3><ol><li>Usage of <a shape="rect" href="#BookInOnePage-map">#map</a></li><li>Usage of <a shape="rect" href="#BookInOnePage-multimap">#multimap</a></li><li>Usage of <a shape="rect" href="#BookInOnePage-queue">#queue</a></li><li>Usage of <a shape="rect" href="#BookInOnePage-topic">#topic</a></li><li>Usage of <a shape="rect" href="#BookInOnePage-list">#list</a></li><li>Usage of <a shape="rect" href="#BookInOnePage-seda">#seda</a></li><li>Usage of <a shape="rect" href="#BookInOnePage-atomicnumber">atomic number</a></li><li>Usage of <a shape="rect" href="#BookInOnePage-cluster">#cluster</a> support (instance)</li><li>Usage of <a shape="rect" href="#BookInOnePage-replicatedmap">#replicatedmap</a>&#160;</li><li>Usage of&#160;<a shape="rect" href="#BookInOnePage-ringbuffer">#ringbuffer</a>&#160;</li></ol><p><span class="confluence-anchor-link" id="BookInOnePage-map"></span></p><h3 id="BookInOnePage-UsageofMap">Usage of Map</h3><h4 id="BookInOnePage-mapcacheproducer-to(&quot;hazelcast:map:foo&quot;)">map cache producer - to("hazelcast:map:foo")</h4><p>If you want to store a value in a map you can use the map cache producer. The map cache producer provides 5 operations (put, get, update, delete, query). For the first 4 you have to provide the operation inside the "hazelcast.operation.type" header variable. In Java DSL you can use the constants from <code>org.apache.camel.component.hazelcast.HazelcastConstants</code>.</p><p>Header Variables for the request message:</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.operation.type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>valid values are: put, delete, get, update, query</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.objectId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the object id to store / find your object inside the cache (not needed for the query operation)</p></td></tr></tbody></table>
</div><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Header variables have changed in Camel 2.8</p>
 </div>
</div><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastOperationType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>valid values are: put, delete, get, update, query <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p><p><strong><strong>From Camel 2.16:</strong></strong> getAll, putIfAbsent, clear.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastObjectId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the object id to store / find your object inside the cache (not needed for the query operation) <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr></tbody></table>
</div><p>You can call the samples with:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">template.sendBodyAndHeader(&amp;quot;direct:[put|get|update|delete|query]&amp;quot;, &amp;quot;my-foo&amp;quot;, HazelcastConstants.OBJECT_ID, &amp;quot;4711&amp;quot;); </script> 
 </div>
</div><h5 id="BookInOnePage-Sampleforput:">Sample for <strong>put</strong>:</h5><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:put&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.PUT_OPERATION)) .toF(&amp;quot;hazelcast:%sfoo&amp;quot;, HazelcastConstants.MAP_PREFIX); </script> 
 </div>
</div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:put&amp;quot; /&amp;gt; &amp;lt;!-- If using version 2.8 and above set headerName to &amp;quot;CamelHazelcastOperationType&amp;quot; --&amp;gt; &amp;lt;setHeader headerName=&amp;quot;hazelcast.operation.type&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;put&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:map:foo&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h5 id="BookInOnePage-Sampleforget:">Sample for <strong>get</strong>:</h5><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:get&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.GET_OPERATION)) .toF(&amp;quot;hazelcast:%sfoo&amp;quot;, HazelcastConstants.MAP_PREFIX) .to(&amp;quot;seda:out&amp;quot;); </script> 
 </div>
</div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:get&amp;quot; /&amp;gt; &amp;lt;!-- If using version 2.8 and above set headerName to &amp;quot;CamelHazelcastOperationType&amp;quot; --&amp;gt; &amp;lt;setHeader headerName=&amp;quot;hazelcast.operation.type&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;get&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:map:foo&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;seda:out&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h5 id="BookInOnePage-Sampleforupdate:">Sample for <strong>update</strong>:</h5><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:update&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.UPDATE_OPERATION)) .toF(&amp;quot;hazelcast:%sfoo&amp;quot;, HazelcastConstants.MAP_PREFIX); </script> 
 </div>
</div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:update&amp;quot; /&amp;gt; &amp;lt;!-- If using version 2.8 and above set headerName to &amp;quot;CamelHazelcastOperationType&amp;quot; --&amp;gt; &amp;lt;setHeader headerName=&amp;quot;hazelcast.operation.type&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;update&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:map:foo&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h5 id="BookInOnePage-Samplefordelete:">Sample for <strong>delete</strong>:</h5><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:delete&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.DELETE_OPERATION)) .toF(&amp;quot;hazelcast:%sfoo&amp;quot;, HazelcastConstants.MAP_PREFIX); </script> 
 </div>
</div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:delete&amp;quot; /&amp;gt; &amp;lt;!-- If using version 2.8 and above set headerName to &amp;quot;CamelHazelcastOperationType&amp;quot; --&amp;gt; &amp;lt;setHeader headerName=&amp;quot;hazelcast.operation.type&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;delete&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:map:foo&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h5 id="BookInOnePage-Sampleforquery">Sample for <strong>query</strong></h5><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:query&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.QUERY_OPERATION)) .toF(&amp;quot;hazelcast:%sfoo&amp;quot;, HazelcastConstants.MAP_PREFIX) .to(&amp;quot;seda:out&amp;quot;); </script> 
 </div>
</div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:query&amp;quot; /&amp;gt; &amp;lt;!-- If using version 2.8 and above set headerName to &amp;quot;CamelHazelcastOperationType&amp;quot; --&amp;gt; &amp;lt;setHeader headerName=&amp;quot;hazelcast.operation.type&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;query&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:map:foo&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;seda:out&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>For the query operation Hazelcast offers a SQL like syntax to query your distributed map.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">String q1 = &amp;quot;bar &amp;gt; 1000&amp;quot;; template.sendBodyAndHeader(&amp;quot;direct:query&amp;quot;, null, HazelcastConstants.QUERY, q1); </script> 
 </div>
</div><h3 id="BookInOnePage-mapcacheconsumer-from(&quot;hazelcast:map:foo&quot;)">map cache consumer - from("hazelcast:map:foo")</h3><p>Hazelcast provides event listeners on their data grid. If you want to be notified if a cache will be manipulated, you can use the map consumer. There're 4 events: <strong>put</strong>, <strong>update</strong>, <strong>delete</strong> and <strong>envict</strong>. The event type will be stored in the "<strong>hazelcast.listener.action</strong>" header variable. The map consumer provides some additional information inside these variables:</p><p>Header Variables inside the response message:</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.listener.time</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Long</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>time of the event in millis</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.listener.type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the map consumer sets here "cachelistener"</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.listener.action</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>type of event - here <strong>added</strong>, <strong>updated</strong>, <strong>envicted</strong> and <strong>removed</strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.objectId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the oid of the object</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.cache.name</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the name of the cache - e.g. "foo"</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.cache.type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the type of the cache - here map</p></td></tr></tbody></table>
</div><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Header variables have changed in Camel 2.8</p>
 </div>
</div><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastListenerTime</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Long</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>time of the event in millis <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastListenerType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the map consumer sets here "cachelistener" <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastListenerAction</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>type of event - here <strong>added</strong>, <strong>updated</strong>, <strong>envicted</strong> and <strong>removed</strong>. <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastObjectId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the oid of the object <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastCacheName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the name of the cache - e.g. "foo" <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastCacheType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the type of the cache - here map <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr></tbody></table>
</div><p>The object value will be stored within <strong>put</strong> and <strong>update</strong> actions inside the message body.</p><p>Here's a sample:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">fromF(&amp;quot;hazelcast:%sfoo&amp;quot;, HazelcastConstants.MAP_PREFIX) .log(&amp;quot;object...&amp;quot;) .choice() .when(header(HazelcastConstants.LISTENER_ACTION).isEqualTo(HazelcastConstants.ADDED)) .log(&amp;quot;...added&amp;quot;) .to(&amp;quot;mock:added&amp;quot;) .when(header(HazelcastConstants.LISTENER_ACTION).isEqualTo(HazelcastConstants.ENVICTED)) .log(&amp;quot;...envicted&amp;quot;) .to(&amp;quot;mock:envicted&amp;quot;) .when(header(HazelcastConstants.LISTENER_ACTION).isEqualTo(HazelcastConstants.UPDATED)) .log(&amp;quot;...updated&amp;quot;) .to(&amp;quot;mock:updated&amp;quot;) .when(header(HazelcastConstants.LISTENER_ACTION).isEqualTo(HazelcastConstants.REMOVED)) .log(&amp;quot;...removed&amp;quot;) .to(&amp;quot;mock:removed&amp;quot;) .otherwise() .log(&amp;quot;fail!&amp;quot;); </script> 
 </div>
</div><p><span class="confluence-anchor-link" id="BookInOnePage-multimap"></span></p><h3 id="BookInOnePage-UsageofMultiMap">Usage of Multi Map</h3><h4 id="BookInOnePage-multimapcacheproducer-to(&quot;hazelcast:multimap:foo&quot;)">multimap cache producer - to("hazelcast:multimap:foo")</h4><p>A multimap is a cache where you can store n values to one key. The multimap producer provides 4 operations (put, get, removevalue, delete).</p><p>Header Variables for the request message:</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.operation.type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>valid values are: put, get, removevalue, delete</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.objectId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the object id to store / find your object inside the cache</p></td></tr></tbody></table>
</div><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Header variables have changed in Camel 2.8</p>
 </div>
</div><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastOperationType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>valid values are: put, get, removevalue, delete <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p><p><strong><strong><strong>From Camel 2.16:</strong></strong></strong> clear.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastObjectId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the object id to store / find your object inside the cache <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr></tbody></table>
</div><h5 id="BookInOnePage-Sampleforput:.1">Sample for <strong>put</strong>:</h5><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:put&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.PUT_OPERATION)) .to(String.format(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.MULTIMAP_PREFIX)); </script> 
 </div>
</div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:put&amp;quot; /&amp;gt; &amp;lt;log message=&amp;quot;put..&amp;quot;/&amp;gt; &amp;lt;!-- If using version 2.8 and above set headerName to &amp;quot;CamelHazelcastOperationType&amp;quot; --&amp;gt; &amp;lt;setHeader headerName=&amp;quot;hazelcast.operation.type&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;put&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:multimap:foo&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h5 id="BookInOnePage-Sampleforremovevalue:">Sample for <strong>removevalue</strong>:</h5><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:removevalue&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.REMOVEVALUE_OPERATION)) .toF(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.MULTIMAP_PREFIX); </script> 
 </div>
</div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:removevalue&amp;quot; /&amp;gt; &amp;lt;log message=&amp;quot;removevalue...&amp;quot;/&amp;gt; &amp;lt;!-- If using version 2.8 and above set headerName to &amp;quot;CamelHazelcastOperationType&amp;quot; --&amp;gt; &amp;lt;setHeader headerName=&amp;quot;hazelcast.operation.type&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;removevalue&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:multimap:foo&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>To remove a value you have to provide the value you want to remove inside the message body. If you have a multimap object {<code>key: "4711" values: { "my-foo", "my-bar"</code>}} you have to put "my-foo" inside the message body to remove the "my-foo" value.</p><h5 id="BookInOnePage-Sampleforget:.1">Sample for <strong>get</strong>:</h5><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:get&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.GET_OPERATION)) .toF(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.MULTIMAP_PREFIX) .to(&amp;quot;seda:out&amp;quot;); </script> 
 </div>
</div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:get&amp;quot; /&amp;gt; &amp;lt;log message=&amp;quot;get..&amp;quot;/&amp;gt; &amp;lt;!-- If using version 2.8 and above set headerName to &amp;quot;CamelHazelcastOperationType&amp;quot; --&amp;gt; &amp;lt;setHeader headerName=&amp;quot;hazelcast.operation.type&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;get&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:multimap:foo&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;seda:out&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h5 id="BookInOnePage-Samplefordelete:.1">Sample for <strong>delete</strong>:</h5><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:delete&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.DELETE_OPERATION)) .toF(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.MULTIMAP_PREFIX); </script> 
 </div>
</div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:delete&amp;quot; /&amp;gt; &amp;lt;log message=&amp;quot;delete..&amp;quot;/&amp;gt; &amp;lt;!-- If using version 2.8 and above set headerName to &amp;quot;CamelHazelcastOperationType&amp;quot; --&amp;gt; &amp;lt;setHeader headerName=&amp;quot;hazelcast.operation.type&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;delete&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:multimap:foo&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>you can call them in your test class with:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">template.sendBodyAndHeader(&amp;quot;direct:[put|get|removevalue|delete]&amp;quot;, &amp;quot;my-foo&amp;quot;, HazelcastConstants.OBJECT_ID, &amp;quot;4711&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-multimapcacheconsumer-from(&quot;hazelcast:multimap:foo&quot;)">multimap cache consumer - from("hazelcast:multimap:foo")</h4><p>For the multimap cache this component provides the same listeners / variables as for the map cache consumer (except the update and enviction listener). The only difference is the <strong>multimap</strong> prefix inside the URI. Here is a sample:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">fromF(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.MULTIMAP_PREFIX) .log(&amp;quot;object...&amp;quot;) .choice() .when(header(HazelcastConstants.LISTENER_ACTION).isEqualTo(HazelcastConstants.ADDED)) .log(&amp;quot;...added&amp;quot;) .to(&amp;quot;mock:added&amp;quot;) //.when(header(HazelcastConstants.LISTENER_ACTION).isEqualTo(HazelcastConstants.ENVICTED)) // .log(&amp;quot;...envicted&amp;quot;) // .to(&amp;quot;mock:envicted&amp;quot;) .when(header(HazelcastConstants.LISTENER_ACTION).isEqualTo(HazelcastConstants.REMOVED)) .log(&amp;quot;...removed&amp;quot;) .to(&amp;quot;mock:removed&amp;quot;) .otherwise() .log(&amp;quot;fail!&amp;quot;); </script> 
 </div>
</div><p>Header Variables inside the response message:</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.listener.time</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Long</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>time of the event in millis</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.listener.type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the map consumer sets here "cachelistener"</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.listener.action</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>type of event - here <strong>added</strong> and <strong>removed</strong> (and soon <strong>envicted</strong>)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.objectId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the oid of the object</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.cache.name</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the name of the cache - e.g. "foo"</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.cache.type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the type of the cache - here multimap</p></td></tr></tbody></table>
</div><p>Eviction will be added as feature, soon (this is a Hazelcast issue).</p><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Header variables have changed in Camel 2.8</p>
 </div>
</div><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastListenerTime</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Long</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>time of the event in millis <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastListenerType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the map consumer sets here "cachelistener" <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastListenerAction</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>type of event - here <strong>added</strong> and <strong>removed</strong> (and soon <strong>envicted</strong>) <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastObjectId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the oid of the object <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastCacheName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the name of the cache - e.g. "foo" <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastCacheType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the type of the cache - here multimap <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr></tbody></table>
</div><p><span class="confluence-anchor-link" id="BookInOnePage-queue"></span></p><h3 id="BookInOnePage-UsageofQueue">Usage of Queue</h3><h4 id="BookInOnePage-Queueproducer&#8211;to(&#8220;hazelcast:queue:foo&#8221;)">Queue producer &#8211; to(&#8220;hazelcast:queue:foo&#8221;)</h4><p>The queue producer provides 6 operations (add, put, poll, peek, offer, removevalue).</p><h5 id="BookInOnePage-Sampleforadd:">Sample for <strong>add</strong>:</h5><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:add&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.ADD_OPERATION)) .toF(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.QUEUE_PREFIX); </script> 
 </div>
</div><h5 id="BookInOnePage-Sampleforput:.2">Sample for <strong>put</strong>:</h5><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:put&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.PUT_OPERATION)) .toF(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.QUEUE_PREFIX); </script> 
 </div>
</div><h5 id="BookInOnePage-Sampleforpoll:">Sample for <strong>poll</strong>:</h5><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:poll&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.POLL_OPERATION)) .toF(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.QUEUE_PREFIX); </script> 
 </div>
</div><h5 id="BookInOnePage-Sampleforpeek:">Sample for <strong>peek</strong>:</h5><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:peek&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.PEEK_OPERATION)) .toF(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.QUEUE_PREFIX); </script> 
 </div>
</div><h5 id="BookInOnePage-Sampleforoffer:">Sample for <strong>offer</strong>:</h5><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:offer&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.OFFER_OPERATION)) .toF(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.QUEUE_PREFIX); </script> 
 </div>
</div><h5 id="BookInOnePage-Sampleforremovevalue:.1">Sample for <strong>removevalue</strong>:</h5><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:removevalue&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.REMOVEVALUE_OPERATION)) .toF(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.QUEUE_PREFIX); </script> 
 </div>
</div><h4 id="BookInOnePage-Queueconsumer&#8211;from(&#8220;hazelcast:queue:foo&#8221;)">Queue consumer &#8211; from(&#8220;hazelcast:queue:foo&#8221;)</h4><p>The queue consumer provides 2 operations (add, remove).</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">fromF(&amp;quot;hazelcast:%smm&amp;quot;, HazelcastConstants.QUEUE_PREFIX) .log(&amp;quot;object...&amp;quot;) .choice() .when(header(HazelcastConstants.LISTENER_ACTION).isEqualTo(HazelcastConstants.ADDED)) .log(&amp;quot;...added&amp;quot;) .to(&amp;quot;mock:added&amp;quot;) .when(header(HazelcastConstants.LISTENER_ACTION).isEqualTo(HazelcastConstants.REMOVED)) .log(&amp;quot;...removed&amp;quot;) .to(&amp;quot;mock:removed&amp;quot;) .otherwise() .log(&amp;quot;fail!&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-topic"><span class="confluence-anchor-link" id="BookInOnePage-topic"></span></h3><h3 id="BookInOnePage-UsageofTopic">Usage of Topic</h3><h4 id="BookInOnePage-Topicproducer&#8211;to(&#8220;hazelcast:topic:foo&#8221;)">Topic producer &#8211; to(&#8220;hazelcast:topic:foo&#8221;)</h4><p>The topic producer provides only one operation (publish).</p><h5 id="BookInOnePage-Sampleforpublish:">Sample for&#160;<strong>publish</strong>:</h5><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:add&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.PUBLISH_OPERATION)) .toF(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.PUBLISH_OPERATION); </script> 
 </div>
</div><h4 id="BookInOnePage-Topicconsumer&#8211;from(&#8220;hazelcast:topic:foo&#8221;)">Topic consumer &#8211; from(&#8220;hazelcast:topic:foo&#8221;)</h4><p>The topic consumer provides only one operation (received). This component is supposed to support multiple consumption as it's expected when it comes to topics so you are free to have as much consumers as you need on the same hazelcast topic.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">fromF(&amp;quot;hazelcast:%sfoo&amp;quot;, HazelcastConstants.TOPIC_PREFIX) .choice() .when(header(HazelcastConstants.LISTENER_ACTION).isEqualTo(HazelcastConstants.RECEIVED)) .log(&amp;quot;...message received&amp;quot;) .otherwise() .log(&amp;quot;...this should never have happened&amp;quot;)</script> 
 </div>
</div><p>&#160;</p><p><span class="confluence-anchor-link" id="BookInOnePage-list"></span></p><h3 id="BookInOnePage-UsageofList">Usage of List</h3><h4 id="BookInOnePage-Listproducer&#8211;to(&#8220;hazelcast:list:foo&#8221;)">List producer &#8211; to(&#8220;hazelcast:list:foo&#8221;)</h4><p>The list producer provides 4 operations (add, addAll, set, get, removevalue, removeAll, clear).</p><h5 id="BookInOnePage-Sampleforadd:.1">Sample for <strong>add</strong>:</h5><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:add&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.ADD_OPERATION)) .toF(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.LIST_PREFIX); </script> 
 </div>
</div><h5 id="BookInOnePage-Sampleforget:.2">Sample for <strong>get</strong>:</h5><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:get&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.GET_OPERATION)) .toF(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.LIST_PREFIX) .to(&amp;quot;seda:out&amp;quot;); </script> 
 </div>
</div><h5 id="BookInOnePage-Sampleforsetvalue:">Sample for <strong>setvalue</strong>:</h5><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:set&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.SETVALUE_OPERATION)) .toF(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.LIST_PREFIX); </script> 
 </div>
</div><h5 id="BookInOnePage-Sampleforremovevalue:.2">Sample for <strong>removevalue</strong>:</h5><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:removevalue&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.REMOVEVALUE_OPERATION)) .toF(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.LIST_PREFIX); </script> 
 </div>
</div><p>Note that&#160;<strong>CamelHazelcastObjectIndex</strong> header is used for indexing purpose.</p><h4 id="BookInOnePage-Thelistconsumerprovides2operations(add,remove).Listconsumer&#8211;from(&#8220;hazelcast:list:foo&#8221;)"><span style="line-height: 1.4285715;">The list consumer provides 2 operations (add, remove).</span>List consumer &#8211; from(&#8220;hazelcast:list:foo&#8221;)</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">fromF(&amp;quot;hazelcast:%smm&amp;quot;, HazelcastConstants.LIST_PREFIX) .log(&amp;quot;object...&amp;quot;) .choice() .when(header(HazelcastConstants.LISTENER_ACTION).isEqualTo(HazelcastConstants.ADDED)) .log(&amp;quot;...added&amp;quot;) .to(&amp;quot;mock:added&amp;quot;) .when(header(HazelcastConstants.LISTENER_ACTION).isEqualTo(HazelcastConstants.REMOVED)) .log(&amp;quot;...removed&amp;quot;) .to(&amp;quot;mock:removed&amp;quot;) .otherwise() .log(&amp;quot;fail!&amp;quot;); </script> 
 </div>
</div><p><span class="confluence-anchor-link" id="BookInOnePage-seda"></span></p><h3 id="BookInOnePage-UsageofSEDA">Usage of SEDA</h3><p>SEDA component differs from the rest components provided. It implements a work-queue in order to support asynchronous SEDA architectures, similar to the core "SEDA" component.</p><h4 id="BookInOnePage-SEDAproducer&#8211;to(&#8220;hazelcast:seda:foo&#8221;)">SEDA producer &#8211; to(&#8220;hazelcast:seda:foo&#8221;)</h4><p>The SEDA producer provides no operations. You only send data to the specified queue.</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>default value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transferExchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8.0:</strong> if set to true the whole Exchange will be transfered. If header or body contains not serializable objects, they will be skipped.</p></td></tr></tbody></table>
</div><p>Java DSL :</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:foo&amp;quot;) .to(&amp;quot;hazelcast:seda:foo&amp;quot;); </script> 
 </div>
</div><p>Spring DSL :</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:seda:foo&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-SEDAconsumer&#8211;from(&#8220;hazelcast:seda:foo&#8221;)">SEDA consumer &#8211; from(&#8220;hazelcast:seda:foo&#8221;)</h4><p>The SEDA consumer provides no operations. You only retrieve data from the specified queue.</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>default value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>pollInterval</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>The timeout used when consuming from the SEDA queue. </span><span style="color: rgb(0,0,0);">When a timeout occurs, the consumer can check whether it is allowed to continue running. Setting a lower value allows the consumer to react more quickly upon shutdown. (<strong>deprecated</strong> from Camel 2.15 onwards, use pollTimeout instead).</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>pollTimeout</code></td><td colspan="1" rowspan="1" class="confluenceTd">1000</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.15:</strong> The timeout used when consuming from the SEDA queue. <span style="color: rgb(0,0,0);">When a timeout occurs, the consumer can check whether it is allowed to continue running. Setting a lower value allows the consumer to react more quickly upon shutdown.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>concurrentConsumers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To use concurrent consumers polling from the SEDA queue.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transferExchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8.0:</strong> if set to true the whole Exchange will be transfered. If header or body contains not serializable objects, they will be skipped.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transacted</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.4:</strong> if set to true then the consumer runs in transaction mode, where the messages in the seda queue will only be removed if the transaction commits, which happens when the processing is complete.</p></td></tr></tbody></table>
</div><p>Java DSL :</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;hazelcast:seda:foo&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;hazelcast:seda:foo&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p><span class="confluence-anchor-link" id="BookInOnePage-atomicnumber"></span></p><h3 id="BookInOnePage-UsageofAtomicNumber">Usage of Atomic Number</h3><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>There is no consumer for this endpoint!</p>
 </div>
</div><h4 id="BookInOnePage-atomicnumberproducer-to(&quot;hazelcast:atomicnumber:foo&quot;)">atomic number producer - to("hazelcast:atomicnumber:foo")</h4><p>An atomic number is an object that simply provides a grid wide number (long). The operations for this producer are setvalue (set the number with a given value), get, increase (+1), decrease (-1) and destroy.</p><p>Header Variables for the request message:</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.operation.type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>valid values are: setvalue, get, increase, decrease, destroy</p></td></tr></tbody></table>
</div><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Header variables have changed in Camel 2.8</p>
 </div>
</div><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastOperationType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>valid values are: setvalue, get, increase, decrease, destroy <strong>Available as of Camel version 2.8</strong></p></td></tr></tbody></table>
</div><h5 id="BookInOnePage-Sampleforset:">Sample for <strong>set</strong>:</h5><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:set&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.SETVALUE_OPERATION)) .toF(&amp;quot;hazelcast:%sfoo&amp;quot;, HazelcastConstants.ATOMICNUMBER_PREFIX); </script> 
 </div>
</div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:set&amp;quot; /&amp;gt; &amp;lt;!-- If using version 2.8 and above set headerName to &amp;quot;CamelHazelcastOperationType&amp;quot; --&amp;gt; &amp;lt;setHeader headerName=&amp;quot;hazelcast.operation.type&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;setvalue&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:atomicvalue:foo&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>Provide the value to set inside the message body (here the value is 10): <code>template.sendBody("direct:set", 10);</code></p><h5 id="BookInOnePage-Sampleforget:.3">Sample for <strong>get</strong>:</h5><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:get&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.GET_OPERATION)) .toF(&amp;quot;hazelcast:%sfoo&amp;quot;, HazelcastConstants.ATOMICNUMBER_PREFIX); </script> 
 </div>
</div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:get&amp;quot; /&amp;gt; &amp;lt;!-- If using version 2.8 and above set headerName to &amp;quot;CamelHazelcastOperationType&amp;quot; --&amp;gt; &amp;lt;setHeader headerName=&amp;quot;hazelcast.operation.type&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;get&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:atomicvalue:foo&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>You can get the number with <code>long body = template.requestBody("direct:get", null, Long.class);</code>.</p><h5 id="BookInOnePage-Sampleforincrement:">Sample for <strong>increment</strong>:</h5><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:increment&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.INCREMENT_OPERATION)) .toF(&amp;quot;hazelcast:%sfoo&amp;quot;, HazelcastConstants.ATOMICNUMBER_PREFIX); </script> 
 </div>
</div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:increment&amp;quot; /&amp;gt; &amp;lt;!-- If using version 2.8 and above set headerName to &amp;quot;CamelHazelcastOperationType&amp;quot; --&amp;gt; &amp;lt;setHeader headerName=&amp;quot;hazelcast.operation.type&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;increment&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:atomicvalue:foo&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>The actual value (after increment) will be provided inside the message body.</p><h5 id="BookInOnePage-Samplefordecrement:">Sample for <strong>decrement</strong>:</h5><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:decrement&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.DECREMENT_OPERATION)) .toF(&amp;quot;hazelcast:%sfoo&amp;quot;, HazelcastConstants.ATOMICNUMBER_PREFIX); </script> 
 </div>
</div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:decrement&amp;quot; /&amp;gt; &amp;lt;!-- If using version 2.8 and above set headerName to &amp;quot;CamelHazelcastOperationType&amp;quot; --&amp;gt; &amp;lt;setHeader headerName=&amp;quot;hazelcast.operation.type&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;decrement&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:atomicvalue:foo&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>The actual value (after decrement) will be provided inside the message body.</p><h5 id="BookInOnePage-Samplefordestroy">Sample for <strong>destroy</strong></h5><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>There's a bug inside Hazelcast. So this feature may not work properly. Will be fixed in 1.9.3.</p>
 </div>
</div><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:destroy&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.DESTROY_OPERATION)) .toF(&amp;quot;hazelcast:%sfoo&amp;quot;, HazelcastConstants.ATOMICNUMBER_PREFIX); </script> 
 </div>
</div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:destroy&amp;quot; /&amp;gt; &amp;lt;!-- If using version 2.8 and above set headerName to &amp;quot;CamelHazelcastOperationType&amp;quot; --&amp;gt; &amp;lt;setHeader headerName=&amp;quot;hazelcast.operation.type&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;destroy&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:atomicvalue:foo&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p><span class="confluence-anchor-link" id="BookInOnePage-cluster"></span></p><h3 id="BookInOnePage-clustersupport">cluster support</h3><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>This endpoint provides no producer!</p>
 </div>
</div><h3 id="BookInOnePage-instanceconsumer-from(&quot;hazelcast:instance:foo&quot;)">instance consumer - from("hazelcast:instance:foo")</h3><p>Hazelcast makes sense in one single "server node", but it's extremly powerful in a clustered environment. The instance consumer fires if a new cache instance will join or leave the cluster.</p><p>Here's a sample:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">fromF(&amp;quot;hazelcast:%sfoo&amp;quot;, HazelcastConstants.INSTANCE_PREFIX) .log(&amp;quot;instance...&amp;quot;) .choice() .when(header(HazelcastConstants.LISTENER_ACTION).isEqualTo(HazelcastConstants.ADDED)) .log(&amp;quot;...added&amp;quot;) .to(&amp;quot;mock:added&amp;quot;) .otherwise() .log(&amp;quot;...removed&amp;quot;) .to(&amp;quot;mock:removed&amp;quot;); </script> 
 </div>
</div><p>Each event provides the following information inside the message header:</p><p>Header Variables inside the response message:</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.listener.time</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Long</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>time of the event in millis</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.listener.type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the map consumer sets here "instancelistener"</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.listener.action</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>type of event - here <strong>added</strong> or <strong>removed</strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.instance.host</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>host name of the instance</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.instance.port</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Integer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>port number of the instance</p></td></tr></tbody></table>
</div><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Header variables have changed in Camel 2.8</p>
 </div>
</div><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastListenerTime</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Long</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>time of the event in millis <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastListenerType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the map consumer sets here "instancelistener" <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastListenerActionn</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>type of event - here <strong>added</strong> or <strong>removed</strong>. <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastInstanceHost</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>host name of the instance <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastInstancePort</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Integer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>port number of the instance <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr></tbody></table>
</div><h3 id="BookInOnePage-Usinghazelcastreference"><span style="line-height: 1.5625;">Using hazelcast reference</span></h3><h4 id="BookInOnePage-Byitsname">By its name</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;hazelcastLifecycle&amp;quot; class=&amp;quot;com.hazelcast.core.LifecycleService&amp;quot; factory-bean=&amp;quot;hazelcastInstance&amp;quot; factory-method=&amp;quot;getLifecycleService&amp;quot; destroy-method=&amp;quot;shutdown&amp;quot; /&amp;gt; &amp;lt;bean id=&amp;quot;config&amp;quot; class=&amp;quot;com.hazelcast.config.Config&amp;quot;&amp;gt; &amp;lt;constructor-arg type=&amp;quot;java.lang.String&amp;quot; value=&amp;quot;HZ.INSTANCE&amp;quot; /&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;hazelcastInstance&amp;quot; class=&amp;quot;com.hazelcast.core.Hazelcast&amp;quot; factory-method=&amp;quot;newHazelcastInstance&amp;quot;&amp;gt; &amp;lt;constructor-arg type=&amp;quot;com.hazelcast.config.Config&amp;quot; ref=&amp;quot;config&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route id=&amp;quot;testHazelcastInstanceBeanRefPut&amp;quot;&amp;gt; &amp;lt;from uri=&amp;quot;direct:testHazelcastInstanceBeanRefPut&amp;quot;/&amp;gt; &amp;lt;setHeader headerName=&amp;quot;CamelHazelcastOperationType&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;put&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:map:testmap?hazelcastInstanceName=HZ.INSTANCE&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route id=&amp;quot;testHazelcastInstanceBeanRefGet&amp;quot;&amp;gt; &amp;lt;from uri=&amp;quot;direct:testHazelcastInstanceBeanRefGet&amp;quot; /&amp;gt; &amp;lt;setHeader headerName=&amp;quot;CamelHazelcastOperationType&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;get&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:map:testmap?hazelcastInstanceName=HZ.INSTANCE&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;seda:out&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt;</script> 
 </div>
</div><h4 id="BookInOnePage-Byinstance">By instance</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;hazelcastInstance&amp;quot; class=&amp;quot;com.hazelcast.core.Hazelcast&amp;quot; factory-method=&amp;quot;newHazelcastInstance&amp;quot; /&amp;gt; &amp;lt;bean id=&amp;quot;hazelcastLifecycle&amp;quot; class=&amp;quot;com.hazelcast.core.LifecycleService&amp;quot; factory-bean=&amp;quot;hazelcastInstance&amp;quot; factory-method=&amp;quot;getLifecycleService&amp;quot; destroy-method=&amp;quot;shutdown&amp;quot; /&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route id=&amp;quot;testHazelcastInstanceBeanRefPut&amp;quot;&amp;gt; &amp;lt;from uri=&amp;quot;direct:testHazelcastInstanceBeanRefPut&amp;quot;/&amp;gt; &amp;lt;setHeader headerName=&amp;quot;CamelHazelcastOperationType&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;put&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:map:testmap?hazelcastInstance=#hazelcastInstance&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route id=&amp;quot;testHazelcastInstanceBeanRefGet&amp;quot;&amp;gt; &amp;lt;from uri=&amp;quot;direct:testHazelcastInstanceBeanRefGet&amp;quot; /&amp;gt; &amp;lt;setHeader headerName=&amp;quot;CamelHazelcastOperationType&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;get&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:map:testmap?hazelcastInstance=#hazelcastInstance&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;seda:out&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt;</script> 
 </div>
</div><h3 id="BookInOnePage-PublishinghazelcastinstanceasanOSGIservice">Publishing hazelcast instance as an OSGI service</h3><p>If operating in an OSGI container and you would want to use one instance of hazelcast across all bundles in the same container. You can publish the instance as an OSGI service and bundles using the cache al need is to reference the service in the hazelcast endpoint.</p><h4 id="BookInOnePage-BundleAcreateaninstanceandpublishesitasanOSGIservice">Bundle A create an instance and publishes it as an OSGI service</h4><p>&#160;</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;config&amp;quot; class=&amp;quot;com.hazelcast.config.FileSystemXmlConfig&amp;quot;&amp;gt; &amp;lt;argument type=&amp;quot;java.lang.String&amp;quot; value=&amp;quot;${hazelcast.config}&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;hazelcastInstance&amp;quot; class=&amp;quot;com.hazelcast.core.Hazelcast&amp;quot; factory-method=&amp;quot;newHazelcastInstance&amp;quot;&amp;gt; &amp;lt;argument type=&amp;quot;com.hazelcast.config.Config&amp;quot; ref=&amp;quot;config&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;!-- publishing the hazelcastInstance as a service --&amp;gt; &amp;lt;service ref=&amp;quot;hazelcastInstance&amp;quot; interface=&amp;quot;com.hazelcast.core.HazelcastInstance&amp;quot; /&amp;gt;</script> 
 </div>
</div><h4 id="BookInOnePage-BundleBusestheinstance">Bundle B uses the instance</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;!-- referencing the hazelcastInstance as a service --&amp;gt; &amp;lt;reference ref=&amp;quot;hazelcastInstance&amp;quot; interface=&amp;quot;com.hazelcast.core.HazelcastInstance&amp;quot; /&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/blueprint&amp;quot;&amp;gt; &amp;lt;route id=&amp;quot;testHazelcastInstanceBeanRefPut&amp;quot;&amp;gt; &amp;lt;from uri=&amp;quot;direct:testHazelcastInstanceBeanRefPut&amp;quot;/&amp;gt; &amp;lt;setHeader headerName=&amp;quot;CamelHazelcastOperationType&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;put&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:map:testmap?hazelcastInstance=#hazelcastInstance&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route id=&amp;quot;testHazelcastInstanceBeanRefGet&amp;quot;&amp;gt; &amp;lt;from uri=&amp;quot;direct:testHazelcastInstanceBeanRefGet&amp;quot; /&amp;gt; &amp;lt;setHeader headerName=&amp;quot;CamelHazelcastOperationType&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;get&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:map:testmap?hazelcastInstance=#hazelcastInstance&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;seda:out&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt;</script> 
 </div>
</div><p><span class="confluence-anchor-link" id="BookInOnePage-replicatedmap"></span></p><h3 id="BookInOnePage-UsageofReplicatedmap">Usage of Replicated map</h3><p><strong>Avalaible from Camel 2.16</strong></p><h4 id="BookInOnePage-replicatedmapcacheproducer-to(&quot;hazelcast:replicatedmap:foo&quot;)">replicatedmap cache producer - to("<a shape="rect" class="external-link" href="http://hazelcastreplicatedmapfoo" rel="nofollow">hazelcast:replicatedmap:foo</a>")</h4><p><span style="color: rgb(68,68,68);">A replicated map is a weakly consistent, distributed key-value data structure with no data partition</span>. The replicatedmap producer provides 4 operations (put, get, delete, clear).</p><p>Header Variables for the request message:</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.operation.type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>valid values are: put, get, delete, clear</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.objectId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the object id to store / find your object inside the cache</p></td></tr></tbody></table>
</div><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Header variables have changed in Camel 2.8</p>
 </div>
</div><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastOperationType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>valid values are: put, get, removevalue, delete <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastObjectId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the object id to store / find your object inside the cache <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr></tbody></table>
</div><h5 id="BookInOnePage-Sampleforput:.3">Sample for&#160;<strong>put</strong>:</h5><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:put&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.PUT_OPERATION)) .to(String.format(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.REPLICATEDMAP_PREFIX)); </script> 
 </div>
</div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:put&amp;quot; /&amp;gt; &amp;lt;log message=&amp;quot;put..&amp;quot;/&amp;gt; &amp;lt;!-- If using version 2.8 and above set headerName to &amp;quot;CamelHazelcastOperationType&amp;quot; --&amp;gt; &amp;lt;setHeader headerName=&amp;quot;hazelcast.operation.type&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;put&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:replicatedmap:foo&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt;</script> 
 </div>
</div><h5 id="BookInOnePage-Sampleforget:.4">Sample for&#160;<strong>get</strong>:</h5><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:get&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.GET_OPERATION)) .toF(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.REPLICATEDMAP_PREFIX) .to(&amp;quot;seda:out&amp;quot;); </script> 
 </div>
</div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:get&amp;quot; /&amp;gt; &amp;lt;log message=&amp;quot;get..&amp;quot;/&amp;gt; &amp;lt;!-- If using version 2.8 and above set headerName to &amp;quot;CamelHazelcastOperationType&amp;quot; --&amp;gt; &amp;lt;setHeader headerName=&amp;quot;hazelcast.operation.type&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;get&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:replicatedmap:foo&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;seda:out&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h5 id="BookInOnePage-Samplefordelete:.2">Sample for&#160;<strong>delete</strong>:</h5><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:delete&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.DELETE_OPERATION)) .toF(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.REPLICATEDMAP_PREFIX); </script> 
 </div>
</div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:delete&amp;quot; /&amp;gt; &amp;lt;log message=&amp;quot;delete..&amp;quot;/&amp;gt; &amp;lt;!-- If using version 2.8 and above set headerName to &amp;quot;CamelHazelcastOperationType&amp;quot; --&amp;gt; &amp;lt;setHeader headerName=&amp;quot;hazelcast.operation.type&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;delete&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:replicatedmap:foo&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>you can call them in your test class with:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">template.sendBodyAndHeader(&amp;quot;direct:[put|get|delete|clear]&amp;quot;, &amp;quot;my-foo&amp;quot;, HazelcastConstants.OBJECT_ID, &amp;quot;4711&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-replicatedmapcacheconsumer-from(&quot;hazelcast:replicatedmap:foo&quot;)">replicatedmap cache consumer - from("<a shape="rect" class="external-link" href="http://hazelcastreplicatedmapfoo" rel="nofollow">hazelcast:replicatedmap:foo</a>")</h4><p>For the multimap cache this component provides the same listeners / variables as for the map cache consumer (except the update and enviction listener). The only difference is the&#160;<strong>multimap</strong>&#160;prefix inside the URI. Here is a sample:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">fromF(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.MULTIMAP_PREFIX) .log(&amp;quot;object...&amp;quot;) .choice() .when(header(HazelcastConstants.LISTENER_ACTION).isEqualTo(HazelcastConstants.ADDED)) .log(&amp;quot;...added&amp;quot;) .to(&amp;quot;mock:added&amp;quot;) //.when(header(HazelcastConstants.LISTENER_ACTION).isEqualTo(HazelcastConstants.ENVICTED)) // .log(&amp;quot;...envicted&amp;quot;) // .to(&amp;quot;mock:envicted&amp;quot;) .when(header(HazelcastConstants.LISTENER_ACTION).isEqualTo(HazelcastConstants.REMOVED)) .log(&amp;quot;...removed&amp;quot;) .to(&amp;quot;mock:removed&amp;quot;) .otherwise() .log(&amp;quot;fail!&amp;quot;); </script> 
 </div>
</div><p>Header Variables inside the response message:</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.listener.time</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Long</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>time of the event in millis</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.listener.type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the map consumer sets here "cachelistener"</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.listener.action</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>type of event - here <strong>added</strong> and <strong>removed</strong> (and soon <strong>envicted</strong>)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.objectId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the oid of the object</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.cache.name</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the name of the cache - e.g. "foo"</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.cache.type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the type of the cache - here replicatedmap</p></td></tr></tbody></table>
</div><p>Eviction will be added as feature, soon (this is a Hazelcast issue).</p><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Header variables have changed in Camel 2.8</p>
 </div>
</div><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastListenerTime</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Long</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>time of the event in millis <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastListenerType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the map consumer sets here "cachelistener" <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastListenerAction</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>type of event - here <strong>added</strong> and <strong>removed</strong> (and soon <strong>envicted</strong>) <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastObjectId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the oid of the object <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastCacheName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the name of the cache - e.g. "foo" <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastCacheType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the type of the cache - here replicatedmap <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr></tbody></table>
</div><p><span class="confluence-anchor-link" id="BookInOnePage-ringbuffer"></span></p><h3 id="BookInOnePage-UsageofRingbuffer">Usage of Ringbuffer</h3><p><strong>Avalaible from Camel 2.16</strong></p><h4 id="BookInOnePage-ringbuffercacheproducer-to(&quot;hazelcast:ringbuffer:foo&quot;)">ringbuffer cache producer - to("<a shape="rect" class="external-link" href="http://hazelcastreplicatedmapfoo/" rel="nofollow">hazelcast:ringbuffer:foo</a>")</h4><p><span style="color: rgb(68,68,68);">Ringbuffer is a distributed data structure where the data is stored in a ring-like structure. You can think of it as a circular array with a certain capacity.</span>&#160;The ringbuffer producer provides 5 operations (add, readonceHead, readonceTail, remainingCapacity, capacity).</p><p>Header Variables for the request message:</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>hazelcast.operation.type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>valid values are: add,&#160;readonceHead, readonceTail,&#160;remainingCapacity, capacity</p></td></tr></tbody></table>
</div><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Header variables have changed in Camel 2.8</p>
 </div>
</div><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastOperationType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>valid values are: put, get, removevalue, delete <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHazelcastObjectId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the object id to store / find your object inside the cache <strong><a shape="rect" class="unresolved" href="#">Version 2.8</a></strong></p></td></tr></tbody></table>
</div><h5 id="BookInOnePage-Sampleforput:.4">Sample for&#160;<strong>put</strong>:</h5><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:put&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.ADD_OPERATION)) .to(String.format(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.RINGBUFFER_PREFIX)); </script> 
 </div>
</div><p>Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:put&amp;quot; /&amp;gt; &amp;lt;log message=&amp;quot;put..&amp;quot;/&amp;gt; &amp;lt;!-- If using version 2.8 and above set headerName to &amp;quot;CamelHazelcastOperationType&amp;quot; --&amp;gt; &amp;lt;setHeader headerName=&amp;quot;hazelcast.operation.type&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;add&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;hazelcast:ringbuffer:foo&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt;</script> 
 </div>
</div><h5 id="BookInOnePage-Sampleforreadoncefromhead:">Sample for&#160;<strong>readonce from head</strong>:</h5><p>Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:get&amp;quot;) .setHeader(HazelcastConstants.OPERATION, constant(HazelcastConstants.READ_ONCE_HEAD_OPERATION)) .toF(&amp;quot;hazelcast:%sbar&amp;quot;, HazelcastConstants.RINGBUFFER_PREFIX) .to(&amp;quot;seda:out&amp;quot;);</script> 
 </div>
</div><h2 id="BookInOnePage-HDFSComponent">HDFS Component</h2><p><strong>Available as of Camel 2.8</strong></p><p>The <strong>hdfs</strong> component enables you to read and write messages from/to an HDFS file system. HDFS is the distributed file system at the heart of <a shape="rect" class="external-link" href="http://hadoop.apache.org">Hadoop</a>.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-hdfs&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.25">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">hdfs://hostname[:port][/path][?options] </script> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code><br clear="none"> The path is treated in the following way:</p><ol><li>as a consumer, if it's a file, it just reads the file, otherwise if it represents a directory it scans all the file under the path satisfying the configured pattern. All the files under that directory must be of the same type.</li><li>as a producer, if at least one split strategy is defined, the path is considered a directory and under that directory the producer creates a different file per split named using the configured <a shape="rect" href="uuidgenerator.html">UuidGenerator</a>.</li></ol><div class="confluence-information-macro confluence-information-macro-note">
 <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p><span>When consuming from hdfs then in normal mode, a file is split into chunks, producing a message per chunk. You can configure the size of the chunk using the chunkSize option. If you want to read from hdfs and write to a regular file using the file component, then you can use the fileMode=Append to append each of the chunks together.</span></p>
 </div>
</div><p>&#160;</p><h3 id="BookInOnePage-Options.40">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>overwrite</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The file can be overwritten</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>append</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Append to existing file. Notice that not all HDFS file systems support the append option.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bufferSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>4096</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The buffer size used by HDFS</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>replication</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>3</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The HDFS replication factor</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>blockSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>67108864</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The size of the HDFS blocks</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>fileType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>NORMAL_FILE</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>It can be SEQUENCE_FILE, MAP_FILE, ARRAY_FILE, or BLOOMMAP_FILE, see Hadoop</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>fileSystemType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>HDFS</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>It can be LOCAL for local filesystem</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>keyType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>NULL</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The type for the key in case of sequence or map files. See below.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>valueType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>TEXT</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The type for the key in case of sequence or map files. See below.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>splitStrategy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A string describing the strategy on how to split the file based on different criteria. See below.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>openedSuffix</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>opened</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>When a file is opened for reading/writing the file is renamed with this suffix to avoid to read it during the writing phase.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>readSuffix</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>read</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Once the file has been read is renamed with this suffix to avoid to read it again.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>initialDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>For the consumer, how much to wait (milliseconds) before to start scanning the directory.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>delay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The interval (milliseconds) between the directory scans.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>pattern</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>*</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The pattern used for scanning the directory</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>chunkSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>4096</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>When reading a normal file, this is split into chunks producing a message per chunk.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>connectOnStartup</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.3/2.10.1:</strong> Whether to connect to the HDFS file system on starting the producer/consumer. If <code>false</code> then the connection is created on-demand. Notice that HDFS may take up till 15 minutes to establish a connection, as it has hardcoded 45 x 20 sec redelivery. By setting this option to <code>false</code> allows your application to startup, and not block for up till 15 minutes.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>owner</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.13/2.12.4:</strong> The file owner must match this owner for the consumer to pickup the file. Otherwise the file is skipped.</p></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-KeyTypeandValueType">KeyType and ValueType</h4><ul><li>NULL it means that the key or the value is absent</li><li>BYTE for writing a byte, the java Byte class is mapped into a BYTE</li><li>BYTES for writing a sequence of bytes. It maps the java ByteBuffer class</li><li>INT for writing java integer</li><li>FLOAT for writing java float</li><li>LONG for writing java long</li><li>DOUBLE for writing java double</li><li>TEXT for writing java strings</li></ul><p>BYTES is also used with everything else, for example, in Camel a file is sent around as an InputStream, int this case is written in a sequence file or a map file as a sequence of bytes.</p><h3 id="BookInOnePage-SplittingStrategy">Splitting Strategy</h3><p>In the current version of Hadoop opening a file in append mode is disabled since it's not very reliable. So, for the moment, it's only possible to create new files. The Camel HDFS endpoint tries to solve this problem in this way:</p><ul><li>If the split strategy option has been defined, the hdfs path will be used as a directory and files will be created using the configured <a shape="rect" href="uuidgenerator.html">UuidGenerator</a></li><li>Every time a splitting condition is met, a new file is created.<br clear="none"> The splitStrategy option is defined as a string with the following syntax:<br clear="none"> splitStrategy=&lt;ST&gt;:&lt;value&gt;,&lt;ST&gt;:&lt;value&gt;,*</li></ul><p>where &lt;ST&gt; can be:</p><ul><li>BYTES a new file is created, and the old is closed when the number of written bytes is more than &lt;value&gt;</li><li>MESSAGES a new file is created, and the old is closed when the number of written messages is more than &lt;value&gt;</li><li>IDLE a new file is created, and the old is closed when no writing happened in the last &lt;value&gt; milliseconds</li></ul><div class="confluence-information-macro confluence-information-macro-note">
 <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>note that this strategy currently requires either setting an IDLE value or setting the HdfsConstants.HDFS_CLOSE header to false to use the BYTES/MESSAGES configuration...otherwise, the file will be closed with each message</p>
 </div>
</div><p>for example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">hdfs://localhost/tmp/simple-file?splitStrategy=IDLE:1000,BYTES:5 </script> 
 </div>
</div><p>it means: a new file is created either when it has been idle for more than 1 second or if more than 5 bytes have been written. So, running <code>hadoop fs -ls /tmp/simple-file</code> you'll see that multiple files have been created.</p><h3 id="BookInOnePage-MessageHeaders.4">Message Headers</h3><p>The following headers are supported by this component:</p><h4 id="BookInOnePage-Produceronly">Producer only</h4><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelFileName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.13:</strong> Specifies the name of the file to write (relative to the endpoint path). The name can be a <code>String</code> or an <a shape="rect" href="expression.html">Expression</a> object. Only relevant when not using a split strategy.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Controllingtoclosefilestream">Controlling to close file stream</h3><p><strong>Available as of Camel 2.10.4</strong></p><p>When using the <a shape="rect" href="hdfs.html">HDFS</a> producer <strong>without</strong> a split strategy, then the file output stream is by default closed after the write. However you may want to keep the stream open, and only explicitly close the stream later. For that you can use the header <code>HdfsConstants.HDFS_CLOSE</code> (value = <code>"CamelHdfsClose"</code>) to control this. Setting this value to a boolean allows you to explicit control whether the stream should be closed or not.</p><p>Notice this does not apply if you use a split strategy, as there are various strategies that can control when the stream is closed.</p><h3 id="BookInOnePage-UsingthiscomponentinOSGi">Using this component in OSGi</h3><p>This component is fully functional in an OSGi environment, however, it requires some actions from the user. Hadoop uses the thread context class loader in order to load resources. Usually, the thread context classloader will be the bundle class loader of the bundle that contains the routes. So, the default configuration files need to be visible from the bundle class loader. A typical way to deal with it is to keep a copy of core-default.xml in your bundle root. That file can be found in the hadoop-common.jar.</p><h2 id="BookInOnePage-HibernateComponent">Hibernate Component</h2><p>The <strong>hibernate:</strong> component allows you to work with databases using Hibernate as the object relational mapping technology to map POJOs to database tables. The <strong>camel-hibernate</strong> library is provided by the <a shape="rect" class="external-link" href="http://code.google.com/p/camel-extra/" rel="nofollow">Camel Extra</a> project which hosts all *GPL related components for Camel.</p><div class="confluence-information-macro confluence-information-macro-information">
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Note that Camel also ships with a <a shape="rect" href="jpa.html">JPA</a> component. The <a shape="rect" href="jpa.html">JPA</a> component abstracts from the underlying persistence provider and allows you to work with Hibernate, OpenJPA or EclipseLink.</p>
 </div>
</div><h3 id="BookInOnePage-Sendingtotheendpoint.1">Sending to the endpoint</h3><p>Sending POJOs to the hibernate endpoint inserts entities into the database. The body of the message is assumed to be an entity bean that you have mapped to a relational table using the hibernate <code>.hbm.xml</code> files.</p><p>If the body does not contain an entity bean, use a <a shape="rect" href="message-translator.html">Message Translator</a> in front of the endpoint to perform the necessary conversion first.</p><h3 id="BookInOnePage-Consumingfromtheendpoint.1">Consuming from the endpoint</h3><p>Consuming messages removes (or updates) entities in the database. This allows you to use a database table as a logical queue; consumers take messages from the queue and then delete/update them to logically remove them from the queue.</p><p>If you do not wish to delete the entity when it has been processed, you can specify <code>consumeDelete=false</code> on the URI. This will result in the entity being processed each poll.</p><p>If you would rather perform some update on the entity to mark it as processed (such as to exclude it from a future query) then you can annotate a method with <a shape="rect" class="external-link" href="http://activemq.apache.org/camel/maven/camel-hibernate/apidocs/org/apache/camel/component/hibernate/Consumed.html">@Consumed</a> which will be invoked on your entity bean when the entity bean is consumed.</p><h3 id="BookInOnePage-URIformat.26">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> hibernate:[entityClassName][?options] </script> 
 </div>
</div><p>For sending to the endpoint, the <strong>entityClassName</strong> is optional. If specified it is used to help use the type conversion to ensure the body is of the correct type.</p><p>For consuming the <strong>entityClassName</strong> is mandatory.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.41">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default Value </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>entityType</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <em>entityClassName</em> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Is the provided <em>entityClassName</em> from the URI. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>consumeDelete</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Option for HibernateConsumer only. Specifies whether or not the entity is deleted after it is consumed. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>consumeLockEntity</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Option for HibernateConsumer only. Specifies whether or not to use exclusive locking of each entity while processing the results from the pooling. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>flushOnSend</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Option for HibernateProducer only. Flushes the <a shape="rect" class="external-link" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/EntityManager.html" rel="nofollow">EntityManager</a> after the entity bean has been persisted. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>maximumResults</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>-1</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Option for HibernateConsumer only. Set the maximum number of results to retrieve on the <a shape="rect" class="external-link" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/Query.html" rel="nofollow">Query</a>. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>consumer.delay</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>500</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Option for HibernateConsumer only. Delay in millis between each poll. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>consumer.initialDelay</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>1000</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Option for HibernateConsumer only. Millis before polling starts. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>consumer.userFixedDelay</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Option for HibernateConsumer only. Set to <code>true</code> to use fixed delay between polls, otherwise fixed rate is used. See <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ScheduledExecutorService.html" rel="nofollow">ScheduledExecutorService</a> in JDK for details. </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-SeeAlso.40">See Also</h3><ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="hibernate-example.html">Hibernate Example</a></li></ul><h2 id="BookInOnePage-HipchatComponent">Hipchat Component</h2><p><strong>Available as of Camel 2.15.0</strong></p><p>The Hipchat component supports producing and consuming messages from/to <a shape="rect" class="external-link" href="https://www.hipchat.com" rel="nofollow">Hipchat</a>&#160;service.</p><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Prerequisites</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>You must have a valid Hipchat user account and get a <a shape="rect" class="external-link" href="https://www.hipchat.com/account/api" rel="nofollow">personal access token</a> that you can use to produce/consume messages.</p>
 </div>
</div><h3 id="BookInOnePage-URIFormat.1">URI Format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">hipchat://[host][:port]?options </script> 
 </div>
</div><p>You can append query options to the URI in the following format, ?options=value&amp;option2=value&amp;...</p><h3 id="BookInOnePage-URIOptions.4">URI Options</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p><strong>Name</strong></p></th><th colspan="1" rowspan="1" class="confluenceTh"><p><strong>Default Value</strong></p></th><th colspan="1" rowspan="1" class="confluenceTh"><p><strong>Context</strong></p></th><th colspan="1" rowspan="1" class="confluenceTh"><strong>Required</strong></th><th colspan="1" rowspan="1" class="confluenceTh"><strong>Producer/Consumer</strong></th><th colspan="1" rowspan="1" class="confluenceTh"><p><strong>Description</strong></p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span>protocol</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Shared</p></td><td colspan="1" rowspan="1" class="confluenceTd">Yes</td><td colspan="1" rowspan="1" class="confluenceTd">Both</td><td colspan="1" rowspan="1" class="confluenceTd"><p>Default protocol to connect to the Hipchat server such as http or https</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">host</td><td colspan="1" rowspan="1" class="confluenceTd">null</td><td colspan="1" rowspan="1" class="confluenceTd">Shared</td><td colspan="1" rowspan="1" class="confluenceTd">Yes</td><td colspan="1" rowspan="1" class="confluenceTd">Both</td><td colspan="1" rowspan="1" class="confluenceTd">The API host of the Hipchat to connect to, such as api.hipchat.com</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">port</td><td colspan="1" rowspan="1" class="confluenceTd">80</td><td colspan="1" rowspan="1" class="confluenceTd">Shared</td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd">Both</td><td colspan="1" rowspan="1" class="confluenceTd">The port to connect to on the Hipchat host</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span>authToken</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Shared</p></td><td colspan="1" rowspan="1" class="confluenceTd">Yes</td><td colspan="1" rowspan="1" class="confluenceTd">Both</td><td colspan="1" rowspan="1" class="confluenceTd">Authorization token(personal access token) obtained from <a shape="rect" class="external-link" href="https://www.hipchat.com/account/api" rel="nofollow">Hipchat</a><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">delay</td><td colspan="1" rowspan="1" class="confluenceTd">5000</td><td colspan="1" rowspan="1" class="confluenceTd">Shared</td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd">Consumer</td><td colspan="1" rowspan="1" class="confluenceTd">The poll interval in millisec for consuming messages from consumeUsers provided. Please read about <a shape="rect" class="external-link" href="https://www.hipchat.com/docs/apiv2/rate_limiting" rel="nofollow">rate limits</a> before decreasing this.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>consumeUsers</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Shared</p></td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd">Consumer</td><td colspan="1" rowspan="1" class="confluenceTd"><p>Comma separated list of user @Mentions or emails whose messages to the owner of authToken must be consumed</p></td></tr></tbody></table>
</div><h3 id="BookInOnePage-ScheduledPollConsumer">Scheduled Poll Consumer</h3><p>This component implements the <a shape="rect" href="polling-consumer.html">ScheduledPollConsumer</a>. Only the last message from the provided 'consumeUsers' are retrieved and sent as Exchange body. If you do not want the same message to be retrieved again when there are no new messages on next poll then you can add the <a shape="rect" href="idempotent-consumer.html">idempotent consumer</a> as shown below. All the options on the&#160;<a shape="rect" href="polling-consumer.html">ScheduledPollConsumer</a>&#160;can also be used for more control on the consumer.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">@Override public void configure() throws Exception { String hipchatEndpointUri = &amp;quot;hipchat://?authToken=XXXX&amp;amp;consumeUsers=@Joe,@John&amp;quot;; from(hipchatEndpointUri) .idempotentConsumer( simple(&amp;quot;${in.header.HipchatMessageDate} ${in.header.HipchatFromUser}&amp;quot;), MemoryIdempotentRepository.memoryIdempotentRepository(200) ) .to(&amp;quot;mock:result&amp;quot;); }</script> 
 </div>
</div><h4 id="BookInOnePage-MessageheaderssetbytheHipchatconsumer">Message headers set by the Hipchat consumer</h4><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p><strong>Header</strong></p></th><th colspan="1" rowspan="1" class="confluenceTh"><p><strong>Constant</strong></p></th><th colspan="1" rowspan="1" class="confluenceTh"><strong>Type</strong></th><th colspan="1" rowspan="1" class="confluenceTh"><p><strong>Description</strong></p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><span>HipchatFromUser</span></td><td colspan="1" rowspan="1" class="confluenceTd"><span>HipchatConstants.FROM_USER</span></td><td colspan="1" rowspan="1" class="confluenceTd"><em>String</em></td><td colspan="1" rowspan="1" class="confluenceTd"><span>The body has the message that was sent from this user to the owner of authToken</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">HipchatMessageDate</td><td colspan="1" rowspan="1" class="confluenceTd"><span>HipchatConstants.</span>MESSAGE_DATE</td><td colspan="1" rowspan="1" class="confluenceTd"><em>String</em></td><td colspan="1" rowspan="1" class="confluenceTd">The date message was sent. The format is ISO-8601 as present in the Hipchat <a shape="rect" class="external-link" href="https://www.hipchat.com/docs/apiv2/method/view_recent_privatechat_history" rel="nofollow">response</a>.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">HipchatFromUserResponseStatus</td><td colspan="1" rowspan="1" class="confluenceTd">HipchatConstants.FROM_USER_RESPONSE_STATUS&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><em><a shape="rect" class="external-link" href="http://hc.apache.org/httpcomponents-core-4.2.x/httpcore/apidocs/org/apache/http/StatusLine.html">StatusLine</a></em></td><td colspan="1" rowspan="1" class="confluenceTd">The status of the API response received.</td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-HipchatProducer">Hipchat Producer</h3><p>Producer can send messages to both Room's and User's simultaneously. The body of the exchange is sent as message. Sample usage is shown below. Appropriate headers needs to be set.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">@Override public void configure() throws Exception { String hipchatEndpointUri = &amp;quot;hipchat://?authToken=XXXX&amp;quot;; from(&amp;quot;direct:start&amp;quot;) .to(hipchatEndpointUri) .to(&amp;quot;mock:result&amp;quot;); }</script> 
 </div>
</div><h4 id="BookInOnePage-MessageheadersevaluatedbytheHipchatproducer">Message headers evaluated by the Hipchat producer</h4><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p><strong>Header</strong></p></th><th colspan="1" rowspan="1" class="confluenceTh"><strong>Constant</strong></th><th colspan="1" rowspan="1" class="confluenceTh"><p><strong>Type</strong></p></th><th colspan="1" rowspan="1" class="confluenceTh"><p><strong>Description</strong></p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">HipchatToUser</td><td colspan="1" rowspan="1" class="confluenceTd"><span>HipchatConstants.TO_USER</span></td><td colspan="1" rowspan="1" class="confluenceTd"><em>String</em></td><td colspan="1" rowspan="1" class="confluenceTd">The Hipchat user to which the message needs to be sent.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">HipchatToRoom</td><td colspan="1" rowspan="1" class="confluenceTd"><span>HipchatConstants.TO_ROOM</span></td><td colspan="1" rowspan="1" class="confluenceTd"><em>String</em></td><td colspan="1" rowspan="1" class="confluenceTd">The Hipchat room to which the message needs to be sent.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">HipchatMessageFormat</td><td colspan="1" rowspan="1" class="confluenceTd">HipchatConstants.MESSAGE_FORMAT</td><td colspan="1" rowspan="1" class="confluenceTd">String</td><td colspan="1" rowspan="1" class="confluenceTd">Valid formats are 'text' or 'html'. <strong>Default: 'text'</strong></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">HipchatMessageBackgroundColor</td><td colspan="1" rowspan="1" class="confluenceTd">HipchatConstants.MESSAGE_BACKGROUND_COLOR</td><td colspan="1" rowspan="1" class="confluenceTd"><em>String</em></td><td colspan="1" rowspan="1" class="confluenceTd">Valid color values are 'yellow', 'green', 'red', 'purple', 'gray', 'random'. <strong>Default: 'yellow' (Room Only)</strong>&#160;</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">HipchatTriggerNotification</td><td colspan="1" rowspan="1" class="confluenceTd">HipchatConstants.TRIGGER_NOTIFY</td><td colspan="1" rowspan="1" class="confluenceTd"><em>String</em></td><td colspan="1" rowspan="1" class="confluenceTd">Valid values are 'true' or 'false'. Whether this message should trigger a user notification (change the tab color, play a sound, notify mobile phones, etc). <strong>Default: 'false' (Room Only) </strong></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-MessageheaderssetbytheHipchatproducer">Message headers set by the Hipchat producer</h4><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p><strong>Header</strong></p></th><th colspan="1" rowspan="1" class="confluenceTh"><p><strong>Constant</strong></p></th><th colspan="1" rowspan="1" class="confluenceTh"><strong>Type</strong></th><th colspan="1" rowspan="1" class="confluenceTh"><p><strong>Description</strong></p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">HipchatToUserResponseStatus</td><td colspan="1" rowspan="1" class="confluenceTd">HipchatConstants.TO_USER_RESPONSE_STATUS</td><td colspan="1" rowspan="1" class="confluenceTd"><em><a shape="rect" class="external-link" href="http://hc.apache.org/httpcomponents-core-4.2.x/httpcore/apidocs/org/apache/http/StatusLine.html">StatusLine</a></em></td><td colspan="1" rowspan="1" class="confluenceTd"><span>The status of the API response received when message sent to the user.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">HipchatFromUserResponseStatus</td><td colspan="1" rowspan="1" class="confluenceTd">HipchatConstants.TO_ROOM_RESPONSE_STATUS</td><td colspan="1" rowspan="1" class="confluenceTd"><em><a shape="rect" class="external-link" href="http://hc.apache.org/httpcomponents-core-4.2.x/httpcore/apidocs/org/apache/http/StatusLine.html">StatusLine</a></em></td><td colspan="1" rowspan="1" class="confluenceTd"><span>The status of the API response received when message sent to the room.</span></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-Dependencies.36"><span style="font-size: 16.0px;line-height: 1.5625;">Dependencies</span></h4><p>Maven users will need to add the following dependency to their pom.xml.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>pom.xml</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-hipchat&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;${camel-version}&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><p>where&#160;<code>${camel-version</code>} must be replaced by the actual version of Camel (2.15.0 or higher)</p><h2 id="BookInOnePage-HL7Component">HL7 Component</h2><p>The <strong>HL7</strong> component is used for working with the HL7 MLLP protocol and <a shape="rect" class="external-link" href="http://www.hl7.org/implement/standards/product_brief.cfm?product_id=185" rel="nofollow">HL7 v2 messages</a> using the <a shape="rect" class="external-link" href="http://hl7api.sourceforge.net" rel="nofollow">HAPI library</a>.</p><p>This component supports the following:</p><ul class="alternate"><li>HL7 MLLP codec for <a shape="rect" href="mina2.html">Mina</a></li><li>HL7 MLLP codec for&#160;<a shape="rect" href="netty4.html">Netty4</a> from&#160;<strong>Camel 2.15</strong> onwards</li><li><a shape="rect" href="type-converter.html">Type Converter</a> from/to HAPI and String</li><li>HL7 DataFormat using the HAPI library</li><li class="confluence-link">Even more ease-of-use as it's integrated well with the <a shape="rect" href="mina2.html">camel-mina2</a> component.</li></ul><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-hl7&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-HL7MLLPprotocol">HL7 MLLP protocol</h3><p>HL7 is often used with the HL7 MLLP protocol, which is a text based TCP socket based protocol. This component ships with a Mina and Netty4 Codec that conforms to the MLLP protocol so you can easily expose an HL7 listener accepting HL7 requests over the TCP transport layer. To expose a HL7 listener service, the <a shape="rect" href="mina2.html">camel-mina2</a>&#160;or <a shape="rect" href="netty4.html">camel-netty4</a> component is used with the <code>HL7MLLPCodec</code>&#160;(mina2) or <code>HL7MLLPNettyDecoder/HL7MLLPNettyEncoder</code> (Netty4).</p><p>HL7 MLLP codec can be configured as follows:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>startByte</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0x0b</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The start byte spanning the HL7 payload.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>endByte1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0x1c</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The first end byte spanning the HL7 payload.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>endByte2</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0x0d</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The 2nd end byte spanning the HL7 payload.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>charset</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>JVM Default</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The encoding (a <a shape="rect" class="external-link" href="http://docs.oracle.com/javase/6/docs/api/java/nio/charset/Charset.html" rel="nofollow">charset name</a>) to use for the codec. If not provided, Camel will use the <a shape="rect" class="external-link" href="http://docs.oracle.com/javase/6/docs/api/java/nio/charset/Charset.html#defaultCharset()" rel="nofollow">JVM default Charset</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>produceString</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>true</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>(as of Camel 2.14.1)</strong> If true, the codec creates a string using the defined charset. If false, the codec sends a plain byte array into the route, so that the HL7 Data Format can determine the actual charset from the HL7 message content.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>convertLFtoCR</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd">Will convert <code>\n</code> to <code>\r</code> (<code>0x0d</code>, 13 decimal) as HL7 stipulates <code>\r</code> as segment terminators. The HAPI library requires the use of <code>\r</code>.</td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-ExposinganHL7listenerusingMina">Exposing an HL7 listener using Mina</h4><p>In the Spring XML file, we configure a mina2 endpoint to listen for HL7 requests using TCP on port <code>8888</code>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;endpoint id=&amp;quot;hl7MinaListener&amp;quot; uri=&amp;quot;mina2:tcp://localhost:8888?sync=true&amp;amp;amp;codec=#hl7codec&amp;quot;/&amp;gt; </script> 
 </div>
</div><p><strong>sync=true</strong> indicates that this listener is synchronous and therefore will return a HL7 response to the caller. The HL7 codec is setup with <strong>codec=#hl7codec</strong>. Note that <code>hl7codec</code> is just a Spring bean ID, so it could be named <code>mygreatcodecforhl7</code> or whatever. The codec is also set up in the Spring XML file:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;hl7codec&amp;quot; class=&amp;quot;org.apache.camel.component.hl7.HL7MLLPCodec&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;charset&amp;quot; value=&amp;quot;iso-8859-1&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>The endpoint <strong>hl7MinaLlistener</strong> can then be used in a route as a consumer, as this Java DSL example illustrates:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;hl7MinaListener&amp;quot;).beanRef(&amp;quot;patientLookupService&amp;quot;); </script> 
 </div>
</div><p>This is a very simple route that will listen for HL7 and route it to a service named <strong>patientLookupService</strong>. This is also Spring bean ID, configured in the Spring XML as:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;patientLookupService&amp;quot; class=&amp;quot;com.mycompany.healthcare.service.PatientLookupService&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>The business logic can be implemented in POJO classes that do not depend on Camel, as shown here:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">import ca.uhn.hl7v2.HL7Exception; import ca.uhn.hl7v2.model.Message; import ca.uhn.hl7v2.model.v24.segment.QRD; public class PatientLookupService { public Message lookupPatient(Message input) throws HL7Exception { QRD qrd = (QRD)input.get(&amp;quot;QRD&amp;quot;); String patientId = qrd.getWhoSubjectFilter(0).getIDNumber().getValue(); // find patient data based on the patient id and create a HL7 model object with the response Message response = ... create and set response data return response } </script> 
 </div>
</div><h4 id="BookInOnePage-ExposinganHL7listenerusingNetty(availablefromCamel2.15onwards)">Exposing an HL7 listener using Netty (available from Camel 2.15 onwards)</h4><p>In the Spring XML file, we configure a netty4 endpoint to listen for HL7 requests using TCP on port <code>8888</code>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;endpoint id=&amp;quot;hl7NettyListener&amp;quot; uri=&amp;quot;netty4:tcp://localhost:8888?sync=true&amp;amp;amp;encoder=#hl7encoder&amp;amp;amp;decoder=#hl7decoder&amp;quot;/&amp;gt; </script> 
 </div>
</div><p><strong>sync=true</strong> indicates that this listener is synchronous and therefore will return a HL7 response to the caller. The HL7 codec is setup with <strong>encoder=#hl7encoder </strong>and<strong> decoder=#hl7decoder</strong>. Note that <code>hl7encoder</code> and <code>hl7decoder</code> are just bean IDs, so they could be named differently. The beans can be set in the Spring XML file:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;hl7decoder&amp;quot; class=&amp;quot;org.apache.camel.component.hl7.HL7MLLPNettyDecoderFactory&amp;quot;/&amp;gt; &nbsp; &amp;lt;bean id=&amp;quot;hl7encoder&amp;quot; class=&amp;quot;org.apache.camel.component.hl7.HL7MLLPNettyEncoderFactory&amp;quot;/&amp;gt;</script> 
 </div>
</div><p>The endpoint <strong>hl7NettyListener</strong> can then be used in a route as a consumer, as this Java DSL example illustrates:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;hl7NettyListener&amp;quot;).beanRef(&amp;quot;patientLookupService&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-HL7Modelusingjava.lang.Stringorbyte[]">HL7 Model using java.lang.String or byte[]</h3><p>The HL7 MLLP codec uses plain String as its data format. Camel uses its <a shape="rect" href="type-converter.html">Type Converter</a> to convert to/from strings to the HAPI HL7 model objects, but you can use the plain String objects if you prefer, for instance if you wish to parse the data yourself.</p><p>As of Camel 2.14.1 you can also let both the Mina and Netty codecs use a plain&#160;<code>byte[]</code> as its data format by setting the <code>produceString</code> property to false. The Type Converter is also capable of converting the&#160;<code>byte[]</code> to/from HAPI HL7 model objects.</p><h3 id="BookInOnePage-HL7v2ModelusingHAPI">HL7v2 Model using HAPI</h3><p>The HL7v2 model uses Java objects from the HAPI library. Using this library, you can encode and decode from the EDI format (ER7) that is mostly used with HL7v2.</p><p>The sample below is a request to lookup a patient with the patient ID <code>0101701234</code>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">MSH|^~\\&amp;amp;|MYSENDER|MYRECEIVER|MYAPPLICATION||200612211200||QRY^A19|1234|P|2.4 QRD|200612211200|R|I|GetPatient|||1^RD|0101701234|DEM|| </script> 
 </div>
</div><p>Using the HL7 model you can work with a <code>ca.uhn.hl7v2.model.Message</code> object, e.g. to retrieve a patient ID:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Message msg = exchange.getIn().getBody(Message.class); QRD qrd = (QRD)msg.get(&amp;quot;QRD&amp;quot;); String patientId = qrd.getWhoSubjectFilter(0).getIDNumber().getValue(); // 0101701234 </script> 
 </div>
</div><p>This is powerful when combined with the HL7 listener, because you don't have to work with <code>byte[]</code>, <code>String</code> or any other simple object formats. You can just use the HAPI HL7v2 model objects. If you know the message type in advance, you can be more type-safe:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">QRY_A19 msg = exchange.getIn().getBody(QRY_A19.class); String patientId = msg.getQRD().getWhoSubjectFilter(0).getIDNumber().getValue(); </script> 
 </div>
</div><p>&#160;</p><p>&#160;</p><p></p><h3 id="BookInOnePage-HL7DataFormat.1">HL7 DataFormat</h3><p>The <a shape="rect" href="hl7.html">HL7</a> component ships with a HL7 data format that can be used to marshal or unmarshal HL7 model objects.</p>
 <ul class="alternate"><li><code>marshal</code> = from Message to byte stream (can be used when responding using the HL7 MLLP codec)</li><li><code>unmarshal</code> = from byte stream to Message (can be used when receiving streamed data from the HL7 MLLP</li></ul><p>To use the data format, simply instantiate an instance and invoke the marshal or unmarshal operation in the route builder:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> DataFormat hl7 = new HL7DataFormat(); ... from(&amp;quot;direct:hl7in&amp;quot;).marshal(hl7).to(&amp;quot;jms:queue:hl7out&amp;quot;); </script> 
  </div>
 </div><p>In the sample above, the HL7 is marshalled from a HAPI Message object to a byte stream and put on a JMS queue.<br clear="none"> The next example is the opposite:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> DataFormat hl7 = new HL7DataFormat(); ... from(&amp;quot;jms:queue:hl7out&amp;quot;).unmarshal(hl7).to(&amp;quot;patientLookupService&amp;quot;); </script> 
  </div>
 </div><p>Here we unmarshal the byte stream into a HAPI Message object that is passed to our patient lookup service.</p>
 <div class="confluence-information-macro confluence-information-macro-tip">
  <p class="title">Serializable messages</p>
  <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
  <div class="confluence-information-macro-body">
   <p>As of HAPI 2.0 (used by <strong>Camel 2.11</strong>), the HL7v2 model classes are fully serializable. So you can put HL7v2 messages directly into a JMS queue (i.e. without calling <code>marshal()</code> and read them again directly from the queue (i.e. without calling <code>unmarshal()</code>.</p>
  </div>
 </div>
 <div class="confluence-information-macro confluence-information-macro-note">
  <p class="title">Segment separators</p>
  <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
  <div class="confluence-information-macro-body">
   <p>As of <strong>Camel 2.11</strong>, <code>unmarshal</code> does not automatically fix segment separators anymore by converting <code>\n</code> to <code>\r</code>. If you <br clear="none"> need this conversion, <code>org.apache.camel.component.hl7.HL7#convertLFToCR</code> provides a handy <code>Expression</code> for this purpose.</p>
  </div>
 </div>
 <div class="confluence-information-macro confluence-information-macro-note">
  <p class="title">Charset</p>
  <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
  <div class="confluence-information-macro-body">
   <p>As of <strong>Camel 2.14.1</strong>, both <code>marshal and unmarshal</code> evaluate the charset provided in the field&#160;<code>MSH-18</code>. If this field is empty, by default the charset contained in the corresponding Camel charset property/header is assumed. You can even change this default behavior by overriding the <code>guessCharsetName</code> method when inheriting from the <code>HL7DataFormat</code> class.</p>
  </div>
 </div><p>&#160;</p><p>There is a shorthand syntax in Camel for well-known data formats that are commonly used.<br clear="none"> Then you don't need to create an instance of the <code>HL7DataFormat</code> object:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:hl7in&amp;quot;).marshal().hl7().to(&amp;quot;jms:queue:hl7out&amp;quot;); from(&amp;quot;jms:queue:hl7out&amp;quot;).unmarshal().hl7().to(&amp;quot;patientLookupService&amp;quot;); </script> 
  </div>
 </div><p>&#160;</p><p>&#160;</p><h3 id="BookInOnePage-MessageHeaders.5">Message Headers</h3><p>The unmarshal operation adds these fields from the MSH segment as headers on the Camel message:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Key</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>MSH field</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Example</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHL7SendingApplication</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>MSH-3</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>MYSERVER</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHL7SendingFacility</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>MSH-4</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>MYSERVERAPP</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHL7ReceivingApplication</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>MSH-5</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>MYCLIENT</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHL7ReceivingFacility</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>MSH-6</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>MYCLIENTAPP</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHL7Timestamp</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>MSH-7</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>20071231235900</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHL7Security</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>MSH-8</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHL7MessageType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>MSH-9-1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ADT</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHL7TriggerEvent</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>MSH-9-2</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>A01</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHL7MessageControl</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>MSH-10</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1234</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHL7ProcessingId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>MSH-11</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>P</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHL7VersionId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>MSH-12</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>2.4</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>CamelHL7Context </code><code><br clear="none"></code></td><td colspan="1" rowspan="1" class="confluenceTd">-</td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>(Camel 2.14)</strong> contains the <a shape="rect" class="external-link" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/HapiContext.html" rel="nofollow">HapiContext</a> that<br clear="none">was used to parse the message</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>CamelHL7Charset</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>MSH-18</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>(Camel 2.14.1)</strong> <code><br clear="none">UNICODE UTF-8</code></td></tr></tbody></table> 
 </div>
</div><p>All headers except&#160;<code>CamelHL7Context </code>are <code>String</code> types. If a header value is missing, its value is <code>null</code>.</p><h3 id="BookInOnePage-Options.42">Options</h3><p>The HL7 Data Format supports the following options:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>validate</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>true</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether the HAPI Parser should validate the message using the default validation rules. It is recommended to use the <code>parser</code> or <code>hapiContext</code> option and initialize it with the desired HAPI <a shape="rect" class="external-link" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/validation/ValidationContext.html" rel="nofollow"><code>ValidationContext</code></a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>parser</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ca.uhn.hl7v2.parser.GenericParser</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Custom parser to be used. Must be of type <a shape="rect" class="external-link" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/parser/Parser.html" rel="nofollow"><code>ca.uhn.hl7v2.parser.Parser</code></a>. Note that <a shape="rect" class="external-link" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/parser/GenericParser.html" rel="nofollow"><code>GenericParser</code></a> also allows to parse XML-encoded HL7v2 messages</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>hapiContext</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>ca.uhn.hl7v2.DefaultHapiContext</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.14:</strong> Custom HAPI context that can define a custom parser, custom ValidationContext etc. This gives you full control over the HL7 parsing and rendering process.</td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Dependencies.37">Dependencies</h3><p>To use HL7 in your Camel routes you'll need to add a dependency on <strong>camel-hl7</strong> listed above, which implements this data format.</p><p>The HAPI library is split into a <a shape="rect" class="external-link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-base" rel="nofollow">base library</a> and several structure libraries, one for each HL7v2 message version:</p><ul><li><a shape="rect" class="external-link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-structures-v21" rel="nofollow">v2.1 structures library</a></li><li><a shape="rect" class="external-link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-structures-v22" rel="nofollow">v2.2 structures library</a></li><li><a shape="rect" class="external-link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-structures-v23" rel="nofollow">v2.3 structures library</a></li><li><a shape="rect" class="external-link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-structures-v231" rel="nofollow">v2.3.1 structures library</a></li><li><a shape="rect" class="external-link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-structures-v24" rel="nofollow">v2.4 structures library</a></li><li><a shape="rect" class="external-link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-structures-v25" rel="nofollow">v2.5 structures library</a></li><li><a shape="rect" class="external-link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-structures-v251" rel="nofollow">v2.5.1 structures library</a></li><li><a shape="rect" class="external-link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-structures-v26" rel="nofollow">v2.6 structures library</a></li></ul><p>By default <code>camel-hl7</code> only references the HAPI <a shape="rect" class="external-link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-base" rel="nofollow">base library</a>. Applications are responsible for including structure libraries themselves. For example, if an application works with HL7v2 message versions 2.4 and 2.5 then the following dependencies must be added:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;ca.uhn.hapi&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;hapi-structures-v24&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;2.2&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your hapi-base version --&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;ca.uhn.hapi&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;hapi-structures-v25&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;2.2&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your hapi-base version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><p>Alternatively, an OSGi bundle containing the base library, all structures libraries and required dependencies (on the bundle classpath) can be downloaded from the <a shape="rect" class="external-link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-osgi-base" rel="nofollow">central Maven repository</a>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;ca.uhn.hapi&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;hapi-osgi-base&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;2.2&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Terserlanguage">Terser language</h3><p><a shape="rect" class="external-link" href="http://hl7api.sourceforge.net" rel="nofollow">HAPI</a> provides a <a shape="rect" class="external-link" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/util/Terser.html" rel="nofollow">Terser</a> class that provides access to fields using a commonly used terse location specification syntax. The Terser language allows to use this syntax to extract values from messages and to use them as expressions and predicates for filtering, content-based routing etc.</p><p>Sample:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">import static org.apache.camel.component.hl7.HL7.terser; ... // extract patient ID from field QRD-8 in the QRY_A19 message above and put into message header from(&amp;quot;direct:test1&amp;quot;) .setHeader(&amp;quot;PATIENT_ID&amp;quot;,terser(&amp;quot;QRD-8(0)-1&amp;quot;)) .to(&amp;quot;mock:test1&amp;quot;); &nbsp;// continue processing if extracted field equals a message header from(&amp;quot;direct:test2&amp;quot;) .filter(terser(&amp;quot;QRD-8(0)-1&amp;quot;).isEqualTo(header(&amp;quot;PATIENT_ID&amp;quot;)) .to(&amp;quot;mock:test2&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-HL7Validationpredicate">HL7 Validation predicate</h3><p>Often it is preferable to first parse a HL7v2 message and in a separate step validate it against a HAPI <a shape="rect" class="external-link" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/validation/ValidationContext.html" rel="nofollow">ValidationContext</a>.</p><p>Sample:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">import static org.apache.camel.component.hl7.HL7.messageConformsTo; import ca.uhn.hl7v2.validation.impl.DefaultValidation; ... // Use standard or define your own validation rules ValidationContext defaultContext = new DefaultValidation(); // Throws PredicateValidationException if message does not validate from(&amp;quot;direct:test1&amp;quot;) .validate(messageConformsTo(defaultContext)) .to(&amp;quot;mock:test1&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-HL7ValidationpredicateusingtheHapiContext(Camel2.14)">HL7 Validation predicate using the HapiContext (Camel 2.14)</h3><p>The HAPI Context is always configured with a <a shape="rect" class="external-link" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/validation/ValidationContext.html" rel="nofollow">ValidationContext</a> (or a <a shape="rect" class="external-link" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/validation/builder/ValidationRuleBuilder.html" rel="nofollow">ValidationRuleBuilder</a>), so you can access the validation rules indirectly. Furthermore, when unmarshalling the HL7DataFormat forwards the configured HAPI context in the <code>CamelHL7Context</code> header, and the validation rules of this context can be easily reused:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">import static org.apache.camel.component.hl7.HL7.messageConformsTo; import static org.apache.camel.component.hl7.HL7.messageConforms ... HapiContext hapiContext = new DefaultHapiContext(); hapiContext.getParserConfiguration().setValidating(false); // don&amp;#39;t validate during parsing // customize HapiContext some more ... e.g. enforce that PID-8 in ADT_A01 messages of version 2.4 is not empty ValidationRuleBuilder builder = new ValidationRuleBuilder() { @Override protected void configure() { forVersion(Version.V24) .message(&amp;quot;ADT&amp;quot;, &amp;quot;A01&amp;quot;) .terser(&amp;quot;PID-8&amp;quot;, not(empty())); } }; hapiContext.setValidationRuleBuilder(builder); HL7DataFormat hl7 = new HL7DataFormat(); hl7.setHapiContext(hapiContext); from(&amp;quot;direct:test1&amp;quot;) .unmarshal(hl7) // uses the GenericParser returned from the HapiContext .validate(messageConforms()) // uses the validation rules returned from the HapiContext // equivalent with .validate(messageConformsTo(hapiContext)) // route continues from here</script> 
 </div>
</div><p>&#160;</p><h3 id="BookInOnePage-HL7Acknowledgementexpression">HL7 Acknowledgement expression</h3><p>A common task in HL7v2 processing is to generate an acknowledgement message as response to an incoming HL7v2 message, e.g. based on a validation result. The <code>ack</code> expression lets us accomplish this very elegantly:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">import static org.apache.camel.component.hl7.HL7.messageConformsTo; import static org.apache.camel.component.hl7.HL7.ack; import ca.uhn.hl7v2.validation.impl.DefaultValidation; ... // Use standard or define your own validation rules ValidationContext defaultContext = new DefaultValidation(); from(&amp;quot;direct:test1&amp;quot;) .onException(Exception.class) .handled(true) .transform(ack()) // auto-generates negative ack because of exception in Exchange .end() .validate(messageConformsTo(defaultContext)) // do something meaningful here ... // acknowledgement .transform(ack()) </script> 
 </div>
</div><h3 id="BookInOnePage-MoreSamples">More Samples</h3><p>In the following example, a plain <code>String</code> HL7 request is sent to an HL7 listener that sends back a response:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> String line1 = &amp;quot;MSH|^~\\&amp;amp;|MYSENDER|MYRECEIVER|MYAPPLICATION||200612211200||QRY^A19|1234|P|2.4&amp;quot;; String line2 = &amp;quot;QRD|200612211200|R|I|GetPatient|||1^RD|0101701234|DEM||&amp;quot;; StringBuilder in = new StringBuilder(); in.append(line1); in.append(&amp;quot;\n&amp;quot;); in.append(line2); String out = template.requestBody(&amp;quot;mina2:tcp://127.0.0.1:&amp;quot; + getPort() + &amp;quot;?sync=true&amp;amp;codec=#hl7codec&amp;quot;, in.toString(), String.class); </script> 
 </div>
</div><p>In the next sample, HL7 requests from the HL7 listener are routed to the business logic, which is implemented as plain POJO registered in the registry as <code>hl7service</code>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public class MyHL7BusinessLogic { // This is a plain POJO that has NO imports whatsoever on Apache Camel. // its a plain POJO only importing the HAPI library so we can much easier work with the HL7 format. public Message handleA19(Message msg) throws Exception { // here you can have your business logic for A19 messages assertTrue(msg instanceof QRY_A19); // just return the same dummy response return createADR19Message(); } public Message handleA01(Message msg) throws Exception { // here you can have your business logic for A01 messages assertTrue(msg instanceof ADT_A01); // just return the same dummy response return createADT01Message(((ADT_A01)msg).getMSH().getMessageControlID().getValue()); } } </script> 
 </div>
</div><p>Then the Camel routes using the <code>RouteBuilder</code> may look as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> DataFormat hl7 = new HL7DataFormat(); // we setup or HL7 listener on port 8888 (using the hl7codec) and in sync mode so we can return a response from(&amp;quot;mina2:tcp://127.0.0.1:&amp;quot; + getPort() + &amp;quot;?sync=true&amp;amp;codec=#hl7codec&amp;quot;) // we use the HL7 data format to unmarshal from HL7 stream to the HAPI Message model // this ensures that the camel message has been enriched with hl7 specific headers to // make the routing much easier (see below) .unmarshal(hl7) // using choice as the content base router .choice() // where we choose that A19 queries invoke the handleA19 method on our hl7service bean .when(header(&amp;quot;CamelHL7TriggerEvent&amp;quot;).isEqualTo(&amp;quot;A19&amp;quot;)) .bean(&amp;quot;hl7service&amp;quot;, &amp;quot;handleA19&amp;quot;) .to(&amp;quot;mock:a19&amp;quot;) // and A01 should invoke the handleA01 method on our hl7service bean .when(header(&amp;quot;CamelHL7TriggerEvent&amp;quot;).isEqualTo(&amp;quot;A01&amp;quot;)).to(&amp;quot;mock:a01&amp;quot;) .bean(&amp;quot;hl7service&amp;quot;, &amp;quot;handleA01&amp;quot;) .to(&amp;quot;mock:a19&amp;quot;) // other types should go to mock:unknown .otherwise() .to(&amp;quot;mock:unknown&amp;quot;) // end choice block .end() // marshal response back .marshal(hl7); </script> 
 </div>
</div><p>Note that by using the HL7 DataFormat the Camel message headers are populated with the fields from the MSH segment. The headers are particularly useful for filtering or content-based routing as shown in the example above.</p><p>&#160;</p><p></p><h3 id="BookInOnePage-SeeAlso.41">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-HTTPComponent">HTTP Component</h2><p>The <strong>http:</strong> component provides HTTP based <a shape="rect" href="endpoint.html">endpoints</a> for consuming external HTTP resources (as a client to call external servers using HTTP).</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-http&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.27">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">http:hostname[:port][/resourceUri][?param1=value1][&amp;amp;param2=value2] </script> 
 </div>
</div><p>Will by default use port 80 for HTTP and 443 for HTTPS.</p><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">camel-http vs camel-jetty</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>You can only produce to endpoints generated by the HTTP component. Therefore it should never be used as input into your camel Routes. To bind/expose an HTTP endpoint via a HTTP server as input to a camel route, you can use the <a shape="rect" href="jetty.html">Jetty Component</a> or the <a shape="rect" href="servlet.html">Servlet Component</a></p>
 </div>
</div><h3 id="BookInOnePage-Examples.18">Examples</h3><p>Call the url with the body using POST and return response as out message. If body is null call URL using GET and return response as out message</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Java DSL</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Spring DSL</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;http://myhost/mypath&amp;quot;);</script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd">
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;http://oldhost&amp;quot;/&amp;gt;</script> 
      </div>
     </div></td></tr></tbody></table>
</div><p>You can override the HTTP endpoint URI by adding a header. Camel will call the <a shape="rect" class="external-link" href="http://newhost" rel="nofollow">http://newhost</a>. This is very handy for e.g. REST urls.</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Java DSL</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .setHeader(Exchange.HTTP_URI, simple(&amp;quot;http://myserver/orders/${header.orderId}&amp;quot;)) .to(&amp;quot;http://dummyhost&amp;quot;);</script> 
      </div>
     </div></td></tr></tbody></table>
</div><p>URI parameters can either be set directly on the endpoint URI or as a header</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Java DSL</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;http://oldhost?order=123&amp;amp;detail=short&amp;quot;); from(&amp;quot;direct:start&amp;quot;) .setHeader(Exchange.HTTP_QUERY, constant(&amp;quot;order=123&amp;amp;detail=short&amp;quot;)) .to(&amp;quot;http://oldhost&amp;quot;); </script> 
      </div>
     </div></td></tr></tbody></table>
</div><p>Set the HTTP request method to POST</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Java DSL</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Spring DSL</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .setHeader(Exchange.HTTP_METHOD, constant(&amp;quot;POST&amp;quot;)) .to(&amp;quot;http://www.google.com&amp;quot;); </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd">
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;setHeader headerName=&amp;quot;CamelHttpMethod&amp;quot;&amp;gt; &amp;lt;constant&amp;gt;POST&amp;lt;/constant&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;http://www.google.com&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:results&amp;quot;/&amp;gt; </script> 
      </div>
     </div></td></tr></tbody></table>
</div><h3 id="BookInOnePage-HttpEndpointOptions">HttpEndpoint Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>throwExceptionOnFailure</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Option to disable throwing the <code>HttpOperationFailedException</code> in case of failed responses from the remote server. This allows you to get all responses regardless of the HTTP status code.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bridgeEndpoint</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If the option is true , HttpProducer will ignore the Exchange.HTTP_URI header, and use the endpoint's URI for request. You may also set the * throwExceptionOnFailure* to be false to let the HttpProducer send all the fault response back. <br clear="none" class="atl-forced-newline"> <strong>Camel 2.3:</strong> If the option is true, HttpProducer and CamelServlet will skip the gzip processing if the content-encoding is "gzip".</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>disableStreamCache</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>DefaultHttpBinding will copy the request input stream into a stream cache and put it into message body if this option is false to support read it twice, otherwise DefaultHttpBinding will set the request input stream direct into the message body. <strong>Camel 2.17:</strong> this options is now also support by the producer to allow using the response stream directly instead of stream caching as by default.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><s><code>httpBindingRef</code></s></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><s><code>null</code></s></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><s><strong>Deprecated and removed in Camel 2.17:</strong> Reference to a <code>org.apache.camel.component.http.HttpBinding</code> in the <a shape="rect" href="registry.html">Registry</a>. Use the <code>httpBinding</code> option instead.</s></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpBinding</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> Reference to a <code>org.apache.camel.component.http.HttpBinding</code> in the <a shape="rect" href="registry.html">Registry</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><s><code>httpClientConfigurerRef</code></s></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><s><code>null</code></s></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><s><strong>Deprecated and removed in Camel 2.17:</strong> Reference to a <code>org.apache.camel.component.http.HttpClientConfigurer</code> in the <a shape="rect" href="registry.html">Registry</a>. Use the <code>httpClientConfigurer</code> option instead.</s></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpClientConfigurer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> Reference to a <code>org.apache.camel.component.http.HttpClientConfigurer</code> in the <a shape="rect" href="registry.html">Registry</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpClient.XXX</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Setting options on the <a shape="rect" class="external-link" href="http://hc.apache.org/httpclient-3.x/apidocs/org/apache/commons/httpclient/params/HttpClientParams.html">HttpClientParams</a>. For instance <code>httpClient.soTimeout=5000</code> will set the <code>SO_TIMEOUT</code> to 5 seconds.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>clientConnectionManager</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To use a custom <code>org.apache.http.conn.ClientConnectionManager</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transferException</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.6:</strong> If enabled and an <a shape="rect" href="exchange.html">Exchange</a> failed processing on the consumer side, and if the caused <code>Exception</code> was send back serialized in the response as a <code>application/x-java-serialized-object</code> content type (for example using <a shape="rect" href="jetty.html">Jetty</a> or <a shape="rect" href="servlet.html">SERVLET</a> Camel components). On the producer side the exception will be deserialized and thrown as is, instead of the <code>HttpOperationFailedException</code>. The caused exception is required to be serialized.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>headerFilterStrategy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> Reference to a instance of <code>org.apache.camel.spi.HeaderFilterStrategy</code> in the <a shape="rect" href="registry.html">Registry</a>. It will be used to apply the custom headerFilterStrategy on the new create HttpEndpoint.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>urlRewrite</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>Producer only</strong> Refers to a custom <code>org.apache.camel.component.http.UrlRewrite</code> which allows you to rewrite urls when you bridge/proxy endpoints. See more details at <a shape="rect" href="urlrewrite.html">UrlRewrite</a> and <a shape="rect" href="how-to-use-camel-as-a-http-proxy-between-a-client-and-server.html">How to use Camel as a HTTP proxy between a client and server</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>eagerCheckContentAvailable</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.15.3/2.16:</strong> <strong>Consumer only</strong> &#160;Whether to eager check whether the HTTP requests has content if the content-length header is 0 or not present. &#160;This can be turned on in case HTTP clients do not send streamed data.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>copyHeaders</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>true</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> &#160;If this option is true then IN exchange headers will be copied to OUT exchange headers according to copy strategy. Setting this to false, allows to only include the headers from the HTTP response (not propagating IN headers).</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>okStatusCodeRange</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>200-299</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> The status codes which is considered a success response. The values are inclusive. The range must be defined as from-to with the dash included.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>ignoreResponseBody</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> If this option is true, The http producer won't read response body and cache the input stream.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>cookieHandler</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>null</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel: 2.19:</strong> Configure a cookie handler to maintain a HTTP session</td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-AuthenticationandProxy">Authentication and Proxy</h3><p>The following authentication options can also be set on the HttpEndpoint:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>authMethod</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Authentication method, either as <code>Basic</code>, <code>Digest</code> or <code>NTLM</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>authMethodPriority</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Priority of authentication methods. Is a list separated with comma. For example: <code>Basic,Digest</code> to exclude <code>NTLM</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>authUsername</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Username for authentication</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>authPassword</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Password for authentication</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>authDomain</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Domain for NTML authentication</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>authHost</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Optional host for NTML authentication</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>proxyHost</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The proxy host name</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>proxyPort</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The proxy port number</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>proxyAuthMethod</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Authentication method for proxy, either as <code>Basic</code>, <code>Digest</code> or <code>NTLM</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>proxyAuthUsername</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Username for proxy authentication</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>proxyAuthPassword</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Password for proxy authentication</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>proxyAuthDomain</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Domain for proxy NTML authentication</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>proxyAuthHost</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Optional host for proxy NTML authentication</p></td></tr></tbody></table> 
 </div>
</div><p>When using authentication you <strong>must</strong> provide the choice of method for the <code>authMethod</code> or <code>authProxyMethod</code> options.<br clear="none"> You can configure the proxy and authentication details on either the <code>HttpComponent</code> or the <code>HttpEndoint</code>. Values provided on the <code>HttpEndpoint</code> will take precedence over <code>HttpComponent</code>. Its most likely best to configure this on the <code>HttpComponent</code> which allows you to do this once.</p><p>The <a shape="rect" href="http.html">HTTP</a> component uses convention over configuration which means that if you have not explicit set a <code>authMethodPriority</code> then it will fallback and use the select(ed) <code>authMethod</code> as priority as well. So if you use <code>authMethod.Basic</code> then the <code>auhtMethodPriority</code> will be <code>Basic</code> only.</p><p>Note: camel-http is based on HttpClient v3.x and as such has only <a shape="rect" class="external-link" href="http://hc.apache.org/httpclient-3.x/authentication.html#NTLM">limited support</a> for what is known as NTLMv1, the early version of the NTLM protocol. It does not support NTLMv2 at all. Camel-http4 has support for NTLMv2.</p><h3 id="BookInOnePage-HttpComponentOptions">HttpComponent Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpBinding</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To use a custom <code>org.apache.camel.component.http.HttpBinding</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpClientConfigurer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To use a custom <code>org.apache.camel.component.http.HttpClientConfigurer</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpConnectionManager</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To use a custom <code>org.apache.commons.httpclient.HttpConnectionManager</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpConfiguration</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To use a custom <code>org.apache.camel.component.http.HttpConfiguration</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>allowJavaSerializedObject</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16.1/2.15.5:</strong>&#160;Whether to allow java serialization when a request uses context-type=application/x-java-serialized-object. This is by default turned off. If you enable this then be aware that Java will deserialize the incoming data from the request to Java and that can be a potential security risk.</td></tr></tbody></table> 
 </div>
</div><p><code>HttpConfiguration</code> contains all the options listed in the table above under the section <em>HttpConfiguration - Setting Authentication and Proxy</em>.</p><h3 id="BookInOnePage-MessageHeaders.6">Message Headers</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Exchange.HTTP_URI</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>URI to call. Will override existing URI set directly on the endpoint. <span>This uri is the uri of the http server to call. Its not the same as the Camel endpoint uri, where you can configure endpoint options such as security etc. This header does not support that, its only the uri of the http server.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Exchange.HTTP_METHOD</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>HTTP Method / Verb to use (GET/POST/PUT/DELETE/HEAD/OPTIONS/TRACE)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Exchange.HTTP_PATH</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Request URI's path, the header will be used to build the request URI with the HTTP_URI. <strong>Camel 2.3.0:</strong> If the path is start with "/", http producer will try to find the relative path based on the Exchange.HTTP_BASE_URI header or the exchange.getFromEndpoint().getEndpointUri();</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Exchange.HTTP_QUERY</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>URI parameters. Will override existing URI parameters set directly on the endpoint.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Exchange.HTTP_RESPONSE_CODE</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>int</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The HTTP response code from the external server. Is 200 for OK.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Exchange.HTTP_CHARACTER_ENCODING</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Character encoding.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Exchange.CONTENT_TYPE</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The HTTP content type. Is set on both the IN and OUT message to provide a content type, such as <code>text/html</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Exchange.CONTENT_ENCODING</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The HTTP content encoding. Is set on both the IN and OUT message to provide a content encoding, such as <code>gzip</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Exchange.HTTP_SERVLET_REQUEST</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>HttpServletRequest</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The <code>HttpServletRequest</code> object.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Exchange.HTTP_SERVLET_RESPONSE</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>HttpServletResponse</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The <code>HttpServletResponse</code> object.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Exchange.HTTP_PROTOCOL_VERSION</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> You can set the http protocol version with this header, eg. "HTTP/1.0". If you didn't specify the header, HttpProducer will use the default value "HTTP/1.1"</p></td></tr></tbody></table> 
 </div>
</div><p>The header name above are constants. For the spring DSL you have to use the value of the constant instead of the name.</p><h3 id="BookInOnePage-MessageBody.1">Message Body</h3><p>Camel will store the HTTP response from the external server on the OUT body. All headers from the IN message will be copied to the OUT message, so headers are preserved during routing. Additionally Camel will add the HTTP response headers as well to the OUT message headers.</p><h3 id="BookInOnePage-Responsecode">Response code</h3><p>Camel will handle according to the HTTP response code:</p><ul class="alternate"><li>Response code is in the range 100..299, Camel regards it as a success response.</li><li>Response code is in the range 300..399, Camel regards it as a redirection response and will throw a <code>HttpOperationFailedException</code> with the information.</li><li><p>Response code is 400+, Camel regards it as an external server failure and will throw a <code>HttpOperationFailedException</code> with the information.</p>
  <div class="confluence-information-macro confluence-information-macro-tip">
   <p class="title">throwExceptionOnFailure</p>
   <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
   <div class="confluence-information-macro-body">
    <p>The option, <code>throwExceptionOnFailure</code>, can be set to <code>false</code> to prevent the <code>HttpOperationFailedException</code> from being thrown for failed response codes. This allows you to get any response from the remote server.<br clear="none"> There is a sample below demonstrating this.</p>
   </div>
  </div></li></ul><h3 id="BookInOnePage-HttpOperationFailedException">HttpOperationFailedException</h3><p>This exception contains the following information:</p><ul class="alternate"><li>The HTTP status code</li><li>The HTTP status line (text of the status code)</li><li>Redirect location, if server returned a redirect</li><li>Response body as a <code>java.lang.String</code>, if server provided a body as response</li></ul><h3 id="BookInOnePage-CallingusingGETorPOST">Calling using GET or POST</h3><p>The following algorithm is used to determine if either <code>GET</code> or <code>POST</code> HTTP method should be used:<br clear="none"> 1. Use method provided in header.<br clear="none"> 2. <code>GET</code> if query string is provided in header.<br clear="none"> 3. <code>GET</code> if endpoint is configured with a query string.<br clear="none"> 4. <code>POST</code> if there is data to send (body is not null).<br clear="none"> 5. <code>GET</code> otherwise.</p><h3 id="BookInOnePage-HowtogetaccesstoHttpServletRequestandHttpServletResponse">How to get access to HttpServletRequest and HttpServletResponse</h3><p>You can get access to these two using the Camel type converter system using</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">HttpServletRequest request = exchange.getIn().getBody(HttpServletRequest.class); HttpServletRequest response = exchange.getIn().getBody(HttpServletResponse.class); </script> 
 </div>
</div><h3 id="BookInOnePage-Usingclienttimeout-SO_TIMEOUT">Using client timeout - SO_TIMEOUT</h3><p>See the unit test in <a shape="rect" class="external-link" href="http://svn.apache.org/viewvc?view=rev&amp;revision=781775">this link</a></p><h2 id="BookInOnePage-MoreExamples">More Examples</h2><h3 id="BookInOnePage-ConfiguringaProxy">Configuring a Proxy</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Java DSL</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;http://oldhost?proxyHost=www.myproxy.com&amp;amp;proxyPort=80&amp;quot;); </script> 
      </div>
     </div></td></tr></tbody></table>
</div><p>There is also support for proxy authentication via the <code>proxyUsername</code> and <code>proxyPassword</code> options.</p><h4 id="BookInOnePage-UsingproxysettingsoutsideofURI">Using proxy settings outside of URI</h4><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Java DSL</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Spring DSL</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> context.getProperties().put(&amp;quot;http.proxyHost&amp;quot;, &amp;quot;172.168.18.9&amp;quot;); context.getProperties().put(&amp;quot;http.proxyPort&amp;quot; &amp;quot;8080&amp;quot;); </script> 
      </div>
     </div></td><td colspan="1" rowspan="1" class="confluenceTd">
     <div class="code panel pdl" style="border-width: 1px;">
      <div class="codeContent panelContent pdl"> 
       <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext&amp;gt; &amp;lt;properties&amp;gt; &amp;lt;property key=&amp;quot;http.proxyHost&amp;quot; value=&amp;quot;172.168.18.9&amp;quot;/&amp;gt; &amp;lt;property key=&amp;quot;http.proxyPort&amp;quot; value=&amp;quot;8080&amp;quot;/&amp;gt; &amp;lt;/properties&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
      </div>
     </div></td></tr></tbody></table>
</div><p>Options on Endpoint will override options on the context.</p><h3 id="BookInOnePage-Configuringcharset">Configuring charset</h3><p>If you are using <code>POST</code> to send data you can configure the <code>charset</code></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">setProperty(Exchange.CHARSET_NAME, &amp;quot;iso-8859-1&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-Samplewithscheduledpoll">Sample with scheduled poll</h3><p>The sample polls the Google homepage every 10 seconds and write the page to the file <code>message.html</code>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;timer://foo?fixedRate=true&amp;amp;delay=0&amp;amp;period=10000&amp;quot;) .to(&amp;quot;http://www.google.com&amp;quot;) .setHeader(FileComponent.HEADER_FILE_NAME, &amp;quot;message.html&amp;quot;).to(&amp;quot;file:target/google&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-GettingtheResponseCode">Getting the Response Code</h3><p>You can get the HTTP response code from the HTTP component by getting the value from the Out message header with <code>Exchange.HTTP_RESPONSE_CODE</code>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> Exchange exchange = template.send(&amp;quot;http://www.google.com/search&amp;quot;, new Processor() { public void process(Exchange exchange) throws Exception { exchange.getIn().setHeader(Exchange.HTTP_QUERY, constant(&amp;quot;hl=en&amp;amp;q=activemq&amp;quot;)); } }); Message out = exchange.getOut(); int responseCode = out.getHeader(Exchange.HTTP_RESPONSE_CODE, Integer.class); </script> 
 </div>
</div><h3 id="BookInOnePage-UsingthrowExceptionOnFailure=falsetogetanyresponseback">Using <code>throwExceptionOnFailure=false</code> to get any response back</h3><p>In the route below we want to route a message that we <a shape="rect" href="content-enricher.html">enrich</a> with data returned from a remote HTTP call. As we want any response from the remote server, we set the <code>throwExceptionOnFailure</code> option to <code>false</code> so we get any response in the <code>AggregationStrategy</code>. As the code is based on a unit test that simulates a HTTP status code 404, there is some assertion code etc.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // We set throwExceptionOnFailure to false to let Camel return any response from the remove HTTP server without thrown // HttpOperationFailedException in case of failures. // This allows us to handle all responses in the aggregation strategy where we can check the HTTP response code // and decide what to do. As this is based on an unit test we assert the code is 404 from(&amp;quot;direct:start&amp;quot;).enrich(&amp;quot;http://localhost:8222/myserver?throwExceptionOnFailure=false&amp;amp;user=Camel&amp;quot;, new AggregationStrategy() { public Exchange aggregate(Exchange original, Exchange resource) { // get the response code Integer code = resource.getIn().getHeader(Exchange.HTTP_RESPONSE_CODE, Integer.class); assertEquals(404, code.intValue()); return resource; } }).to(&amp;quot;mock:result&amp;quot;); // this is our jetty server where we simulate the 404 from(&amp;quot;jetty://http://localhost:8222/myserver&amp;quot;) .process(new Processor() { public void process(Exchange exchange) throws Exception { exchange.getOut().setBody(&amp;quot;Page not found&amp;quot;); exchange.getOut().setHeader(Exchange.HTTP_RESPONSE_CODE, 404); } }); </script> 
  </div>
 </div><h3 id="BookInOnePage-DisablingCookies">Disabling Cookies</h3><p>To disable cookies you can set the HTTP Client to ignore cookies by adding this URI option:<br clear="none"> <code>httpClient.cookiePolicy=ignoreCookies</code></p><h3 id="BookInOnePage-AdvancedUsage">Advanced Usage</h3><p>If you need more control over the HTTP producer you should use the <code>HttpComponent</code> where you can set various classes to give you custom behavior.</p><h4 id="BookInOnePage-SettingMaxConnectionsPerHost">Setting MaxConnectionsPerHost</h4><p>The <a shape="rect" href="http.html">HTTP</a> Component has a <code>org.apache.commons.httpclient.HttpConnectionManager</code> where you can configure various global configuration for the given component.<br clear="none"> By global, we mean that any endpoint the component creates has the same shared <code>HttpConnectionManager</code>. So, if we want to set a different value for the max connection per host, we need to define it on the HTTP component and <strong>not</strong> on the endpoint URI that we usually use. So here comes:</p><p>First, we define the <code>http</code> component in Spring XML. Yes, we use the same scheme name, <code>http</code>, because otherwise Camel will auto-discover and create the component with default settings. What we need is to overrule this so we can set our options. In the sample below we set the max connection to 5 instead of the default of 2.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;http&amp;quot; class=&amp;quot;org.apache.camel.component.http.HttpComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;camelContext&amp;quot; ref=&amp;quot;camel&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;httpConnectionManager&amp;quot; ref=&amp;quot;myHttpConnectionManager&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;myHttpConnectionManager&amp;quot; class=&amp;quot;org.apache.commons.httpclient.MultiThreadedHttpConnectionManager&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;params&amp;quot; ref=&amp;quot;myHttpConnectionManagerParams&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;myHttpConnectionManagerParams&amp;quot; class=&amp;quot;org.apache.commons.httpclient.params.HttpConnectionManagerParams&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;defaultMaxConnectionsPerHost&amp;quot; value=&amp;quot;5&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
  </div>
 </div>And then we can just use it as we normally do in our routes:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext id=&amp;quot;camel&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot; trace=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;http://www.google.com&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
  </div>
 </div><h4 id="BookInOnePage-Usingpreemptiveauthentication">Using preemptive authentication</h4><p>An end user reported that he had problem with authenticating with HTTPS. The problem was eventually resolved when he discovered the HTTPS server did not return a HTTP code 401 Authorization Required. The solution was to set the following URI option: <code>httpClient.authenticationPreemptive=true</code></p><h4 id="BookInOnePage-Acceptingselfsignedcertificatesfromremoteserver">Accepting self signed certificates from remote server</h4><p>See this <a shape="rect" class="external-link" href="http://www.nabble.com/Using-HTTPS-in-camel-http-when-remote-side-has-self-signed-cert-td25916878.html" rel="nofollow">link</a> from a mailing list discussion with some code to outline how to do this with the Apache Commons HTTP API.</p><h4 id="BookInOnePage-SettingupSSLforHTTPClient">Setting up SSL for HTTP Client</h4><h5 id="BookInOnePage-UsingtheJSSEConfigurationUtility.1">Using the JSSE Configuration Utility</h5><p>As of Camel 2.8, the HTTP4 component supports SSL/TLS configuration through the <a shape="rect" href="camel-configuration-utilities.html">Camel JSSE Configuration Utility</a>.&#160; This utility greatly decreases the amount of component specific code you need to write and is configurable at the endpoint and component levels.&#160; The following examples demonstrate how to use the utility with the HTTP4 component.</p><p>The version of the Apache HTTP client used in this component resolves SSL/TLS information from a global "protocol" registry.&#160; This component provides an implementation, <code>org.apache.camel.component.http.SSLContextParametersSecureProtocolSocketFactory</code>, of the HTTP client's protocol socket factory in order to support the use of the Camel JSSE Configuration utility.&#160; The following example demonstrates how to configure the protocol registry and use the registered protocol information in a route.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">KeyStoreParameters ksp = new KeyStoreParameters(); ksp.setResource(&amp;quot;/users/home/server/keystore.jks&amp;quot;); ksp.setPassword(&amp;quot;keystorePassword&amp;quot;); KeyManagersParameters kmp = new KeyManagersParameters(); kmp.setKeyStore(ksp); kmp.setKeyPassword(&amp;quot;keyPassword&amp;quot;); SSLContextParameters scp = new SSLContextParameters(); scp.setKeyManagers(kmp); ProtocolSocketFactory factory = new SSLContextParametersSecureProtocolSocketFactory(scp); Protocol.registerProtocol(&amp;quot;https&amp;quot;, new Protocol( &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;quot;https&amp;quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; factory, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 443)); from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;https://mail.google.com/mail/&amp;quot;).to(&amp;quot;mock:results&amp;quot;); </script> 
 </div>
</div><h5 id="BookInOnePage-ConfiguringApacheHTTPClientDirectly">Configuring Apache HTTP Client Directly</h5><p>Basically camel-http component is built on the top of Apache HTTP client, and you can implement a custom <code>org.apache.camel.component.http.HttpClientConfigurer</code> to do some configuration on the http client if you need full control of it.</p><p>However if you <em>just</em> want to specify the keystore and truststore you can do this with Apache HTTP <code>HttpClientConfigurer</code>, for example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Protocol authhttps = new Protocol(&amp;quot;https&amp;quot;, new AuthSSLProtocolSocketFactory( new URL(&amp;quot;file:my.keystore&amp;quot;), &amp;quot;mypassword&amp;quot;, new URL(&amp;quot;file:my.truststore&amp;quot;), &amp;quot;mypassword&amp;quot;), 443); Protocol.registerProtocol(&amp;quot;https&amp;quot;, authhttps); </script> 
 </div>
</div><p>And then you need to create a class that implements <code>HttpClientConfigurer</code>, and registers https protocol providing a keystore or truststore per example above. Then, from your camel route builder class you can hook it up like so:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">HttpComponent httpComponent = getContext().getComponent(&amp;quot;http&amp;quot;, HttpComponent.class); httpComponent.setHttpClientConfigurer(new MyHttpClientConfigurer()); </script> 
 </div>
</div><p>If you are doing this using the Spring DSL, you can specify your <code>HttpClientConfigurer</code> using the URI. For example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;myHttpClientConfigurer&amp;quot; class=&amp;quot;my.https.HttpClientConfigurer&amp;quot;&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;to uri=&amp;quot;https://myhostname.com:443/myURL?httpClientConfigurerRef=myHttpClientConfigurer&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>As long as you implement the HttpClientConfigurer and configure your keystore and truststore as described above, it will work fine.</p><p></p><h3 id="BookInOnePage-SeeAlso.42">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="jetty.html">Jetty</a></li></ul><h2 id="BookInOnePage-iBATIS">iBATIS</h2><p>The <strong>ibatis:</strong> component allows you to query, poll, insert, update and delete data in a relational database using <a shape="rect" class="external-link" href="http://ibatis.apache.org/">Apache iBATIS</a>.</p><div class="confluence-information-macro confluence-information-macro-warning">
 <p class="title">Prefer MyBatis</p>
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The Apache iBatis project is no longer active. The project is moved outside Apache and is now know as the MyBatis project.<br clear="none">Therefore we encourage users to use <a shape="rect" href="mybatis.html">MyBatis</a> instead. This camel-ibatis component will be removed in Camel 3.0.</p>
  <p>iBatis do not support Spring 4.x. So you can only use Spring 3.x or older with iBatis.</p>
 </div>
</div><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-ibatis&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.28">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">ibatis:statementName[?options] </script> 
 </div>
</div><p>Where <strong>statementName</strong> is the name in the iBATIS XML configuration file which maps to the query, insert, update or delete operation you wish to evaluate.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><p>This component will by default load the iBatis SqlMapConfig file from the root of the classpath and expected named as <code>SqlMapConfig.xml</code>.<br clear="none"> It uses Spring resource loading so you can define it using <code>classpath</code>, <code>file</code> or <code>http</code> as prefix to load resources with those schemes.<br clear="none"> In Camel 2.2 you can configure this on the iBatisComponent with the <code>setSqlMapConfig(String)</code> method.</p><h3 id="BookInOnePage-Options.43">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.onConsume</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Statements to run after consuming. Can be used, for example, to update rows after they have been consumed and processed in Camel. See sample later. Multiple statements can be separated with comma.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.useIterator</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If <code>true</code> each row returned when polling will be processed individually. If <code>false</code> the entire <code>List</code> of data is set as the IN body.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.routeEmptyResultSet</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sets whether empty result set should be routed or not. By default, empty result sets are not routed.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>statementType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>StatementType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Mandatory to specify for IbatisProducer to control which iBatis <code>SqlMapClient</code> method to invoke. The enum values are: <code>QueryForObject</code>, <code>QueryForList</code>, <code>Insert</code>, <code>Update</code>, <code>Delete</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxMessagesPerPoll</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>int</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>An integer to define a maximum messages to gather per poll. By default, no maximum is set. Can be used to set a limit of e.g. 1000 to avoid when starting up the server that there are thousands of files. Set a value of 0 or negative to disabled it.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>isolation</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>TRANSACTION_REPEATABLE_READ</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> A String the defines the transaction isolation level of the will be used. Allowed values are TRANSACTION_NONE, TRANSACTION_READ_UNCOMMITTED, TRANSACTION_READ_COMMITTED, TRANSACTION_REPEATABLE_READ, TRANSACTION_SERIALIZABLE</p></td></tr></tbody></table> 
 </div>
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>isolation</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>TRANSACTION_REPEATABLE_READ</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> A String the defines the transaction isolation level of the will be used. Allowed values are TRANSACTION_NONE, TRANSACTION_READ_UNCOMMITTED, TRANSACTION_READ_COMMITTED, TRANSACTION_REPEATABLE_READ, TRANSACTION_SERIALIZABLE</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-MessageHeaders.7">Message Headers</h3><p>Camel will populate the result message, either IN or OUT with a header with the operationName used:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelIBatisStatementName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The <strong>statementName</strong> used (for example: insertAccount).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelIBatisResult</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The <strong>response</strong> returned from iBatis in any of the operations. For instance an <code>INSERT</code> could return the auto-generated key, or number of rows etc.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-MessageBody.2">Message Body</h3><p>The response from iBatis will only be set as body if it's a <code>SELECT</code> statement. That means, for example, for <code>INSERT</code> statements Camel will not replace the body. This allows you to continue routing and keep the original body. The response from iBatis is always stored in the header with the key <code>CamelIBatisResult</code>.</p><h3 id="BookInOnePage-Samples.10">Samples</h3><p>For example if you wish to consume beans from a JMS queue and insert them into a database you could do the following:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:queue:newAccount&amp;quot;). to(&amp;quot;ibatis:insertAccount?statementType=Insert&amp;quot;); </script> 
 </div>
</div><p>Notice we have to specify the <code>statementType</code>, as we need to instruct Camel which <code>SqlMapClient</code> operation to invoke.</p><p>Where <strong>insertAccount</strong> is the iBatis ID in the SQL map file:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- Insert example, using the Account parameter class --&amp;gt; &amp;lt;insert id=&amp;quot;insertAccount&amp;quot; parameterClass=&amp;quot;Account&amp;quot;&amp;gt; insert into ACCOUNT ( ACC_ID, ACC_FIRST_NAME, ACC_LAST_NAME, ACC_EMAIL ) values ( #id#, #firstName#, #lastName#, #emailAddress# ) &amp;lt;/insert&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-UsingStatementTypeforbettercontrolofIBatis">Using StatementType for better control of IBatis</h3><p>When routing to an iBatis endpoint you want more fine grained control so you can control whether the SQL statement to be executed is a <code>SELEECT</code>, <code>UPDATE</code>, <code>DELETE</code> or <code>INSERT</code> etc. So for instance if we want to route to an iBatis endpoint in which the IN body contains parameters to a <code>SELECT</code> statement we can do:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;ibatis:selectAccountById?statementType=QueryForObject&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>In the code above we can invoke the iBatis statement <code>selectAccountById</code> and the IN body should contain the account id we want to retrieve, such as an <code>Integer</code> type.</p><p>We can do the same for some of the other operations, such as <code>QueryForList</code>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;ibatis:selectAllAccounts?statementType=QueryForList&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>And the same for <code>UPDATE</code>, where we can send an <code>Account</code> object as IN body to iBatis:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;ibatis:updateAccount?statementType=Update&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-Scheduledpollingexample">Scheduled polling example</h4><p>Since this component does not support scheduled polling, you need to use another mechanism for triggering the scheduled polls, such as the <a shape="rect" href="timer.html">Timer</a> or <a shape="rect" href="quartz.html">Quartz</a> components.</p><p>In the sample below we poll the database, every 30 seconds using the <a shape="rect" href="timer.html">Timer</a> component and send the data to the JMS queue:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;timer://pollTheDatabase?delay=30000&amp;quot;).to(&amp;quot;ibatis:selectAllAccounts?statementType=QueryForList&amp;quot;).to(&amp;quot;activemq:queue:allAccounts&amp;quot;); </script> 
 </div>
</div><p>And the iBatis SQL map file used:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- Select with no parameters using the result map for Account class. --&amp;gt; &amp;lt;select id=&amp;quot;selectAllAccounts&amp;quot; resultMap=&amp;quot;AccountResult&amp;quot;&amp;gt; select * from ACCOUNT &amp;lt;/select&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-UsingonConsume">Using onConsume</h4><p>This component supports executing statements <strong>after</strong> data have been consumed and processed by Camel. This allows you to do post updates in the database. Notice all statements must be <code>UPDATE</code> statements. Camel supports executing multiple statements whose name should be separated by comma.</p><p>The route below illustrates we execute the <strong>consumeAccount</strong> statement data is processed. This allows us to change the status of the row in the database to processed, so we avoid consuming it twice or more.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;ibatis:selectUnprocessedAccounts?consumer.onConsume=consumeAccount&amp;quot;).to(&amp;quot;mock:results&amp;quot;); </script> 
 </div>
</div><p>And the statements in the sqlmap file:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;select id=&amp;quot;selectUnprocessedAccounts&amp;quot; resultMap=&amp;quot;AccountResult&amp;quot;&amp;gt; select * from ACCOUNT where PROCESSED = false &amp;lt;/select&amp;gt; </script> 
 </div>
</div><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;update id=&amp;quot;consumeAccount&amp;quot; parameterClass=&amp;quot;Account&amp;quot;&amp;gt; update ACCOUNT set PROCESSED = true where ACC_ID = #id# &amp;lt;/update&amp;gt; </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.43">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="mybatis.html">MyBatis</a></li></ul><h2 id="BookInOnePage-IRCComponent">IRC Component</h2><p>The <strong>irc</strong> component implements an <a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/Internet_Relay_Chat" rel="nofollow">IRC</a> (Internet Relay Chat) transport.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-irc&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.29">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">irc:nick@host[:port]/#room[?options] irc:nick@host[:port]?channels=#channel1,#channel2,#channel3[?options] </script> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.44">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Example</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>channels</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Comma separated list of IRC channels to join.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>channels=#channel1,#channel2</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>nickname</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The nickname used in chat.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>irc:MyNick@irc.server.org#channel</code> or <code>irc:irc.server.org#channel?nickname=MyUser</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>username</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The IRC server user name.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>irc:MyUser@irc.server.org#channel</code> or <code>irc:irc.server.org#channel?username=MyUser</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Same as nickname.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>password</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The IRC server password.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>password=somepass</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em>None</em></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>realname</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The IRC user's actual name.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>realname=MyName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em>None</em></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>nickPassword</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.18:</strong> Your IRC server nickname password.</td><td colspan="1" rowspan="1" class="confluenceTd">nickPassword=mysecret</td><td colspan="1" rowspan="1" class="confluenceTd"><em>None</em></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>colors</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether or not the server supports color codes.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true, false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>onReply</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether or not to handle general responses to commands or informational messages.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true, false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>onNick</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Handle nickname change events.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true, false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>onQuit</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Handle user quit events.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true, false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>onJoin</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Handle user join events.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true, false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>onKick</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Handle kick events.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true, false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>onMode</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Handle mode change events.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true, false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>onPart</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Handle user part events.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true, false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>onTopic</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Handle topic change events.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true, false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>onPrivmsg</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Handle message events.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true, false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>trustManager</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The trust manager used to verify the SSL server's certificate.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>trustManager=#referenceToTrustManagerBean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The default trust manager, which accepts <em>all</em> certificates, will be used.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>keys</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.2:</strong> Comma separated list of IRC channel keys. Important to be listed in same order as channels. When joining multiple channels with only some needing keys just insert an empty value for that channel.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>irc:MyNick@irc.server.org/#channel?keys=chankey</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>sslContextParameters</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> Reference to a <code>org.apache.camel.util.jsse.SSLContextParameters</code> in the <a shape="rect" class="external-link" href="http://camel.apache.org/registry.html">Registry</a>.&#160; This reference overrides any configured SSLContextParameters at the component level.&#160; See <a shape="rect" class="external-link" href="http://camel.apache.org/http4.html#HTTP4-UsingtheJSSEConfigurationUtility">Using the JSSE Configuration Utility</a>.&#160; Note that this setting overrides the trustManager option.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>#mySslContextParameters</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-SSLSupport">SSL Support</h3><h4 id="BookInOnePage-UsingtheJSSEConfigurationUtility.2">Using the JSSE Configuration Utility</h4><p>As of Camel 2.9, the IRC component supports SSL/TLS configuration through the <a shape="rect" href="camel-configuration-utilities.html">Camel JSSE Configuration Utility</a>.&#160; This utility greatly decreases the amount of component specific code you need to write and is configurable at the endpoint and component levels.&#160; The following examples demonstrate how to use the utility with the IRC component.</p><h5 id="BookInOnePage-Programmaticconfigurationoftheendpoint">Programmatic configuration of the endpoint</h5><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">KeyStoreParameters ksp = new KeyStoreParameters(); ksp.setResource(&amp;quot;/users/home/server/truststore.jks&amp;quot;); ksp.setPassword(&amp;quot;keystorePassword&amp;quot;); TrustManagersParameters tmp = new TrustManagersParameters(); tmp.setKeyStore(ksp); SSLContextParameters scp = new SSLContextParameters(); scp.setTrustManagers(tmp); Registry registry = ... registry.bind(&amp;quot;sslContextParameters&amp;quot;, scp); ... from(...) .to(&amp;quot;ircs://camel-prd-user@server:6669/#camel-test?nickname=camel-prd&amp;amp;password=password&amp;amp;sslContextParameters=#sslContextParameters&amp;quot;); </script> 
 </div>
</div><h5 id="BookInOnePage-SpringDSLbasedconfigurationofendpoint.1">Spring DSL based configuration of endpoint</h5><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">... &amp;lt;camel:sslContextParameters id=&amp;quot;sslContextParameters&amp;quot;&amp;gt; &amp;lt;camel:trustManagers&amp;gt; &amp;lt;camel:keyStore resource=&amp;quot;/users/home/server/truststore.jks&amp;quot; password=&amp;quot;keystorePassword&amp;quot;/&amp;gt; &amp;lt;/camel:keyManagers&amp;gt; &amp;lt;/camel:sslContextParameters&amp;gt;... ... &amp;lt;to uri=&amp;quot;ircs://camel-prd-user@server:6669/#camel-test?nickname=camel-prd&amp;amp;password=password&amp;amp;sslContextParameters=#sslContextParameters&amp;quot;/&amp;gt;... </script> 
 </div>
</div><h4 id="BookInOnePage-Usingthelegacybasicconfigurationoptions">Using the legacy basic configuration options</h4><p>You can also connect to an SSL enabled IRC server, as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">ircs:host[:port]/#room?username=user&amp;amp;password=pass </script> 
 </div>
</div><p>By default, the IRC transport uses <a shape="rect" class="external-link" href="http://moepii.sourceforge.net/irclib/javadoc/org/schwering/irc/lib/ssl/SSLDefaultTrustManager.html" rel="nofollow">SSLDefaultTrustManager</a>. If you need to provide your own custom trust manager, use the <code>trustManager</code> parameter as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">ircs:host[:port]/#room?username=user&amp;amp;password=pass&amp;amp;trustManager=#referenceToMyTrustManagerBean </script> 
 </div>
</div><h3 id="BookInOnePage-Usingkeys">Using keys</h3><p><strong>Available as of Camel 2.2</strong></p><p>Some irc rooms requires you to provide a key to be able to join that channel. The key is just a secret word.</p><p>For example we join 3 channels where as only channel 1 and 3 uses a key.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">irc:nick@irc.server.org?channels=#chan1,#chan2,#chan3&amp;amp;keys=chan1Key,,chan3key </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.44">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-Jasyptcomponent">Jasypt component</h2><p><strong>Available as of Camel 2.5</strong></p><p><a shape="rect" class="external-link" href="http://www.jasypt.org/" rel="nofollow">Jasypt</a> is a simplified encryption library which makes encryption and decryption easy. Camel integrates with Jasypt to allow sensitive information in <a shape="rect" href="properties.html">Properties</a> files to be encrypted. By dropping <strong><code>camel-jasypt</code></strong> on the classpath those encrypted values will automatically be decrypted on-the-fly by Camel. This ensures that human eyes can't easily spot sensitive information such as usernames and passwords.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-jasypt&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Tooling">Tooling</h3><p>The <a shape="rect" href="jasypt.html">Jasypt</a> component provides a little command line tooling to encrypt or decrypt values.</p><p>The console output the syntax and which options it provides:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Apache Camel Jasypt takes the following options -h or -help = Displays the help screen -c or -command &amp;lt;command&amp;gt; = Command either encrypt or decrypt -p or -password &amp;lt;password&amp;gt; = Password to use -i or -input &amp;lt;input&amp;gt; = Text to encrypt or decrypt -a or -algorithm &amp;lt;algorithm&amp;gt; = Optional algorithm to use </script> 
 </div>
</div><p>For example to encrypt the value <code>tiger</code> you run with the following parameters. In the apache camel kit, you cd into the lib folder and run the following java cmd, where <em>&lt;CAMEL_HOME&gt;</em> is where you have downloaded and extract the Camel distribution.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">$ cd &amp;lt;CAMEL_HOME&amp;gt;/lib $ java -jar camel-jasypt-2.5.0.jar -c encrypt -p secret -i tiger </script> 
 </div>
</div><p>Which outputs the following result</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Encrypted text: qaEEacuW7BUti8LcMgyjKw== </script> 
 </div>
</div><p>This means the encrypted representation <code>qaEEacuW7BUti8LcMgyjKw==</code> can be decrypted back to <code>tiger</code> if you know the master password which was <code>secret</code>.<br clear="none"> If you run the tool again then the encrypted value will return a different result. But decrypting the value will always return the correct original value.</p><p>So you can test it by running the tooling using the following parameters:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">$ cd &amp;lt;CAMEL_HOME&amp;gt;/lib $ java -jar camel-jasypt-2.5.0.jar -c decrypt -p secret -i qaEEacuW7BUti8LcMgyjKw== </script> 
 </div>
</div><p>Which outputs the following result:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Decrypted text: tiger </script> 
 </div>
</div><p>The idea is then to use those encrypted values in your <a shape="rect" href="properties.html">Properties</a> files. Notice how the password value is encrypted and the value has the tokens surrounding <code>ENC(value here)</code></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> # refer to a mock endpoint name by that encrypted password cool.result=mock:{{cool.password}} # here is a password which is encrypted cool.password=ENC(bsW9uV37gQ0QHFu7KO03Ww==) </script> 
 </div>
</div><h4 id="BookInOnePage-ToolingdependenciesforCamel2.5and2.6">Tooling dependencies for Camel 2.5 and 2.6</h4><p>The tooling requires the following JARs in the classpath, which has been enlisted in the <code>MANIFEST.MF</code> file of <code>camel-jasypt</code> with <code>optional/</code> as prefix. Hence why the java cmd above can pickup the needed JARs from the Apache Distribution in the <code>optional</code> directory.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">jasypt-1.6.jar commons-lang-2.4.jar commons-codec-1.4.jar icu4j-4.0.1.jar </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Java 1.5 users</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The <code>icu4j-4.0.1.jar</code> is only needed when running on JDK 1.5.</p>
  <p>This JAR is not distributed by Apache Camel and you have to download it manually and copy it to the <code>lib/optional</code> directory of the Camel distribution.<br clear="none"> You can download it from <a shape="rect" class="external-link" href="http://repo2.maven.org/maven2/com/ibm/icu/icu4j/4.0.1/" rel="nofollow">Apache Central Maven repo</a>.</p>
 </div>
</div><h4 id="BookInOnePage-ToolingdependenciesforCamel2.7orbetter">Tooling dependencies for Camel 2.7 or better</h4><p>Jasypt 1.7 onwards is now fully standalone so no additional JARs is needed.</p><h3 id="BookInOnePage-URIOptions.5">URI Options</h3><p>The options below are exclusive for the <a shape="rect" href="jasypt.html">Jasypt</a> component.</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default Value </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Type </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>password</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>null</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>String</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Specifies the master password to use for decrypting. This option is mandatory. See below for more details. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>algorithm</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>null</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>String</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Name of an optional algorithm to use. </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Protectingthemasterpassword">Protecting the master password</h3><p>The master password used by <a shape="rect" href="jasypt.html">Jasypt</a> must be provided, so that it's capable of decrypting the values. However having this master password out in the open may not be an ideal solution. Therefore you could for example provide it as a JVM system property or as a OS environment setting. If you decide to do so then the <code>password</code> option supports prefixes which dictates this. <code>sysenv:</code> means to lookup the OS system environment with the given key. <code>sys:</code> means to lookup a JVM system property.</p><p>For example you could provided the password before you start the application</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">$ export CAMEL_ENCRYPTION_PASSWORD=secret </script> 
 </div>
</div><p>Then start the application, such as running the start script.</p><p>When the application is up and running you can unset the environment</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">$ unset CAMEL_ENCRYPTION_PASSWORD </script> 
 </div>
</div><p>The <code>password</code> option is then a matter of defining as follows: <code>password=sysenv:CAMEL_ENCRYPTION_PASSWORD</code>.</p><h3 id="BookInOnePage-ExamplewithJavaDSL">Example with Java DSL</h3><p>In Java DSL you need to configure <a shape="rect" href="jasypt.html">Jasypt</a> as a <code>JasyptPropertiesParser</code> instance and set it on the <a shape="rect" href="properties.html">Properties</a> component as show below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // create the jasypt properties parser JasyptPropertiesParser jasypt = new JasyptPropertiesParser(); // and set the master password jasypt.setPassword(&amp;quot;secret&amp;quot;); // create the properties component PropertiesComponent pc = new PropertiesComponent(); pc.setLocation(&amp;quot;classpath:org/apache/camel/component/jasypt/myproperties.properties&amp;quot;); // and use the jasypt properties parser so we can decrypt values pc.setPropertiesParser(jasypt); // add properties component to camel context context.addComponent(&amp;quot;properties&amp;quot;, pc); </script> 
 </div>
</div><p>The properties file <code>myproperties.properties</code> then contain the encrypted value, such as shown below. Notice how the password value is encrypted and the value has the tokens surrounding <code>ENC(value here)</code></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> # refer to a mock endpoint name by that encrypted password cool.result=mock:{{cool.password}} # here is a password which is encrypted cool.password=ENC(bsW9uV37gQ0QHFu7KO03Ww==) </script> 
 </div>
</div><h3 id="BookInOnePage-ExamplewithSpringXML">Example with Spring XML</h3><p>In Spring XML you need to configure the <code>JasyptPropertiesParser</code> which is shown below. Then the Camel <a shape="rect" href="properties.html">Properties</a> component is told to use <code>jasypt</code> as the properties parser, which means <a shape="rect" href="jasypt.html">Jasypt</a> has its chance to decrypt values looked up in the properties.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;!-- define the jasypt properties parser with the given password to be used --&amp;gt; &amp;lt;bean id=&amp;quot;jasypt&amp;quot; class=&amp;quot;org.apache.camel.component.jasypt.JasyptPropertiesParser&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;password&amp;quot; value=&amp;quot;secret&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;!-- define the camel properties component --&amp;gt; &amp;lt;bean id=&amp;quot;properties&amp;quot; class=&amp;quot;org.apache.camel.component.properties.PropertiesComponent&amp;quot;&amp;gt; &amp;lt;!-- the properties file is in the classpath --&amp;gt; &amp;lt;property name=&amp;quot;location&amp;quot; value=&amp;quot;classpath:org/apache/camel/component/jasypt/myproperties.properties&amp;quot;/&amp;gt; &amp;lt;!-- and let it leverage the jasypt parser --&amp;gt; &amp;lt;property name=&amp;quot;propertiesParser&amp;quot; ref=&amp;quot;jasypt&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>The <a shape="rect" href="properties.html">Properties</a> component can also be inlined inside the <code>&lt;camelContext&gt;</code> tag which is shown below. Notice how we use the <code>propertiesParserRef</code> attribute to refer to <a shape="rect" href="jasypt.html">Jasypt</a>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;!-- define the jasypt properties parser with the given password to be used --&amp;gt; &amp;lt;bean id=&amp;quot;jasypt&amp;quot; class=&amp;quot;org.apache.camel.component.jasypt.JasyptPropertiesParser&amp;quot;&amp;gt; &amp;lt;!-- password is mandatory, you can prefix it with sysenv: or sys: to indicate it should use an OS environment or JVM system property value, so you dont have the master password defined here --&amp;gt; &amp;lt;property name=&amp;quot;password&amp;quot; value=&amp;quot;secret&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;!-- define the camel properties placeholder, and let it leverage jasypt --&amp;gt; &amp;lt;propertyPlaceholder id=&amp;quot;properties&amp;quot; location=&amp;quot;classpath:org/apache/camel/component/jasypt/myproperties.properties&amp;quot; propertiesParserRef=&amp;quot;jasypt&amp;quot;/&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;{{cool.result}}&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-ExamplewithBlueprintXML">Example with Blueprint XML</h3><p>In Blueprint XML you need to configure the&#160;<code>JasyptPropertiesParser</code>&#160;which is shown below. Then the Camel&#160;<a shape="rect" href="properties.html">Properties</a>&#160;component is told to use&#160;<code>jasypt</code>&#160;as the properties parser, which means&#160;<a shape="rect" href="jasypt.html">Jasypt</a>&#160;has its chance to decrypt values looked up in the properties.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;blueprint xmlns=&amp;quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:cm=&amp;quot;http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.0.0&amp;quot; xsi:schemaLocation=&amp;quot; http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd&amp;quot;&amp;gt; &amp;lt;cm:property-placeholder id=&amp;quot;myblue&amp;quot; persistent-id=&amp;quot;mypersistent&amp;quot;&amp;gt; &amp;lt;!-- list some properties for this test --&amp;gt; &amp;lt;cm:default-properties&amp;gt; &amp;lt;cm:property name=&amp;quot;cool.result&amp;quot; value=&amp;quot;mock:{{cool.password}}&amp;quot;/&amp;gt; &amp;lt;cm:property name=&amp;quot;cool.password&amp;quot; value=&amp;quot;ENC(bsW9uV37gQ0QHFu7KO03Ww==)&amp;quot;/&amp;gt; &amp;lt;/cm:default-properties&amp;gt; &amp;lt;/cm:property-placeholder&amp;gt; &amp;lt;!-- define the jasypt properties parser with the given password to be used --&amp;gt; &amp;lt;bean id=&amp;quot;jasypt&amp;quot; class=&amp;quot;org.apache.camel.component.jasypt.JasyptPropertiesParser&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;password&amp;quot; value=&amp;quot;secret&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/blueprint&amp;quot;&amp;gt; &amp;lt;!-- define the camel properties placeholder, and let it leverage jasypt --&amp;gt; &amp;lt;propertyPlaceholder id=&amp;quot;properties&amp;quot; location=&amp;quot;blueprint:myblue&amp;quot; propertiesParserRef=&amp;quot;jasypt&amp;quot;/&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;{{cool.result}}&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;/blueprint&amp;gt; </script> 
 </div>
</div><p>The&#160;<a shape="rect" href="properties.html">Properties</a>&#160;component can also be inlined inside the&#160;<code>&lt;camelContext&gt;</code>&#160;tag which is shown below. Notice how we use the&#160;<code>propertiesParserRef</code>&#160;attribute to refer to&#160;<a shape="rect" href="jasypt.html">Jasypt</a>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;blueprint xmlns=&amp;quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:cm=&amp;quot;http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.0.0&amp;quot; xsi:schemaLocation=&amp;quot; http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd&amp;quot;&amp;gt; &amp;lt;!-- define the jasypt properties parser with the given password to be used --&amp;gt; &amp;lt;bean id=&amp;quot;jasypt&amp;quot; class=&amp;quot;org.apache.camel.component.jasypt.JasyptPropertiesParser&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;password&amp;quot; value=&amp;quot;secret&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/blueprint&amp;quot;&amp;gt; &amp;lt;!-- define the camel properties placeholder, and let it leverage jasypt --&amp;gt; &amp;lt;propertyPlaceholder id=&amp;quot;properties&amp;quot; location=&amp;quot;classpath:org/apache/camel/component/jasypt/myproperties.properties&amp;quot; propertiesParserRef=&amp;quot;jasypt&amp;quot;/&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;{{cool.result}}&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;/blueprint&amp;gt; </script> 
 </div>
</div><p>&#160;</p><h3 id="BookInOnePage-SeeAlso.45">See Also</h3><ul class="alternate"><li><a shape="rect" href="security.html">Security</a></li><li><a shape="rect" href="properties.html">Properties</a></li><li><a shape="rect" class="external-link" href="http://activemq.apache.org/encrypted-passwords.html">Encrypted passwords in ActiveMQ</a> - ActiveMQ has a similar feature as this <code>camel-jasypt</code> component</li></ul><h2 id="BookInOnePage-JavaSpaceComponent">JavaSpace Component</h2><p><strong>Available as of Camel 2.1</strong></p><p>The <strong>javaspace</strong> component is a transport for working with any JavaSpace compliant implementation and this component has been tested with both the <a shape="rect" class="external-link" href="http://www.dancres.org/blitz/" rel="nofollow">Blitz implementation </a> and the <a shape="rect" class="external-link" href="http://www.gigaspaces.com/" rel="nofollow">GigaSpace implementation </a>.<br clear="none"> This component can be used for sending and receiving any object inheriting from the Jini <code>net.jini.core.entry.Entry</code> class. It is also possible to pass the bean ID of a template that can be used for reading/taking the entries from the space.<br clear="none"> This component can be used for sending/receiving any serializable object acting as a sort of generic transport. The JavaSpace component contains a special optimization for dealing with the <code>BeanExchange</code>. It can be used to invoke a POJO remotely, using a JavaSpace as a transport.<br clear="none"> This latter feature can provide a simple implementation of the master/worker pattern, where a POJO provides the business logic for the worker.<br clear="none"> Look at the test cases for examples of various use cases for this component.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-javaspace&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.30">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> javaspace:jini://host[?options] </script> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.45">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default Value </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>spaceName</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>null</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Specifies the JavaSpace name. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>verb</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>take</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Specifies the verb for getting JavaSpace entries. The values can be: <code>take</code> or <code>read</code>. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>transactional</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> If <code>true</code>, sending and receiving entries is performed within a transaction. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>transactionalTimeout</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>Long.MAX_VALUE</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Specifies the transaction timeout. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>concurrentConsumers</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>1</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Specifies the number of concurrent consumers getting entries from the JavaSpace. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>templateId</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>null</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> If present, this option specifies the Spring bean ID of the template to use for reading/taking entries. </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Examples.19">Examples</h3><h4 id="BookInOnePage-SendingandReceivingEntries">Sending and Receiving Entries</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // sending route from(&amp;quot;direct:input&amp;quot;) .to(&amp;quot;javaspace:jini://localhost?spaceName=mySpace&amp;quot;); // receiving Route from(&amp;quot;javaspace:jini://localhost?spaceName=mySpace&amp;amp;templateId=template&amp;amp;verb=take&amp;amp;concurrentConsumers=1&amp;quot;) .to(&amp;quot;mock:foo&amp;quot;); </script> 
 </div>
</div><p>In this case the payload can be any object that inherits from the Jini <code>Entry</code> type.</p><h4 id="BookInOnePage-Sendingandreceivingserializableobjects">Sending and receiving serializable objects</h4><p>Using the preceding routes, it is also possible to send and receive any serializable object. The JavaSpace component detects that the payload is not a Jini <code>Entry</code> and then it automatically wraps the payload with a Camel Jini <code>Entry</code>. In this way, a JavaSpace can be used as a generic transport mechanism.</p><h4 id="BookInOnePage-UsingJavaSpaceasaremoteinvocationtransport">Using JavaSpace as a remote invocation transport</h4><p>The JavaSpace component has been tailored to work in combination with the Camel bean component. It is therefore possible to call a remote POJO using JavaSpace as the transport:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // client side from(&amp;quot;direct:input&amp;quot;) .to(&amp;quot;javaspace:jini://localhost?spaceName=mySpace&amp;quot;); // server side from(&amp;quot;javaspace:jini://localhost?concurrentConsumers=10&amp;amp;spaceName=mySpace&amp;quot;) .to(&amp;quot;mock:foo&amp;quot;); </script> 
 </div>
</div><p>In the code there are two test cases showing how to use a POJO to realize the master/worker pattern. The idea is to use the POJO to provide the business logic and rely on Camel for sending/receiving requests/replies with the proper correlation. </p><h3 id="BookInOnePage-SeeAlso.46">See Also</h3><ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-JBIComponent">JBI Component</h2><p>The <strong>jbi</strong> component is implemented by the <a shape="rect" class="external-link" href="http://servicemix.apache.org/servicemix-camel.html">ServiceMix Camel module</a> and provides integration with a JBI Normalized Message Router, such as the one provided by <a shape="rect" class="external-link" href="http://servicemix.apache.org/">Apache ServiceMix</a>.</p><div class="confluence-information-macro confluence-information-macro-information">
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body"> 
  <p>See below for information about how to use <code>StreamSource</code> types from <a shape="rect" class="external-link" href="http://servicemix.apache.org/">ServiceMix</a> in Camel.</p>
 </div>
</div><p>The following code:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;jbi:endpoint:http://foo.bar.org/MyService/MyEndpoint&amp;quot;) </script> 
 </div>
</div><p>Automatically exposes a new endpoint to the bus, where the service QName is {<code><a shape="rect" class="external-link" href="http://foo.bar.org" rel="nofollow">http://foo.bar.org</a>}MyService</code> and the endpoint name is <code>MyEndpoint</code> (see <a shape="rect" href="#BookInOnePage-URI-format">#URI-format</a>).</p><p>When a JBI endpoint appears at the end of a route, for example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> to(&amp;quot;jbi:endpoint:http://foo.bar.org/MyService/MyEndpoint&amp;quot;) </script> 
 </div>
</div><p>The messages sent by this producer endpoint are sent to the already deployed JBI endpoint.</p><p><span class="confluence-anchor-link" id="BookInOnePage-URI-format"></span></p><h3 id="BookInOnePage-URIformat.31">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> jbi:service:serviceNamespace[sep]serviceName[?options] jbi:endpoint:serviceNamespace[sep]serviceName[sep]endpointName[?options] jbi:name:endpointName[?options] </script> 
 </div>
</div><p>The separator that should be used in the endpoint URL is:</p><ul><li><code>/</code> (forward slash), if <code>serviceNamespace</code> starts with <code>http://</code>, or</li><li><code>:</code> (colon), if <code>serviceNamespace</code> starts with <code>urn:foo:bar</code>.</li></ul><p>For more details of valid JBI URIs see the <a shape="rect" class="external-link" href="http://servicemix.apache.org/uris.html">ServiceMix URI Guide</a>. </p><p>Using the <code>jbi:service:</code> or <code>jbi:endpoint:</code> URI formats sets the service QName on the JBI endpoint to the one specified. Otherwise, the default Camel JBI Service QName is used, which is:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> {http://activemq.apache.org/camel/schema/jbi}endpoint </script> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h4 id="BookInOnePage-Examples.20">Examples</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> jbi:service:http://foo.bar.org/MyService jbi:endpoint:urn:foo:bar:MyService:MyEndpoint jbi:endpoint:http://foo.bar.org/MyService/MyEndpoint jbi:name:cheese </script> 
 </div>
</div><h3 id="BookInOnePage-URIoptions">URI options</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default value </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>mep</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> MEP of the Camel Exchange </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Allows users to override the MEP set on the Exchange object. Valid values for this option are <code>in-only</code>, <code>in-out</code>, <code>robust-in-out</code> and <code>in-optional-out</code>. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>operation</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Value of the <code>jbi.operation</code> header property </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Specifies the JBI operation for the <code>MessageExchange</code>. If no value is supplied, the JBI binding will use the value of the <code>jbi.operation</code> header property. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>serialization</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>basic</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Default value (<code>basic</code>) will check if headers are serializable by looking at the type, setting this option to <code>strict</code> will detect objects that can not be serialized although they implement the <code>Serializable</code> interface. Set to <code>nocheck</code> to disable this check altogether, note that this should only be used for in-memory transports like SEDAFlow, otherwise you can expect to get <code>NotSerializableException</code> thrown at runtime. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>convertException</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code>: send any exceptions thrown from the Camel route back unmodified <br clear="none" class="atl-forced-newline"> <code>true</code>: convert all exceptions to a JBI FaultException (can be used to avoid non-serializable exceptions or to implement generic error handling </p></td></tr></tbody></table>
</div><h4 id="BookInOnePage-Examples.21">Examples</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> jbi:service:http://foo.bar.org/MyService?mep=in-out (override the MEP, use InOut JBI MessageExchanges) jbi:endpoint:urn:foo:bar:MyService:MyEndpoint?mep=in (override the MEP, use InOnly JBI MessageExchanges) jbi:endpoint:urn:foo:bar:MyService:MyEndpoint?operation={http://www.mycompany.org}AddNumbers (overide the operation for the JBI Exchange to {http://www.mycompany.org}AddNumbers) </script> 
 </div>
</div><h3 id="BookInOnePage-UsingStreambodies">Using Stream bodies</h3><p>If you are using a stream type as the message body, you should be aware that a stream is only capable of being read once. So if you enable <code>DEBUG</code> logging, the body is usually logged and thus read. To deal with this, Camel has a <code>streamCaching</code> option that can cache the stream, enabling you to read it multiple times.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;jbi:endpoint:http://foo.bar.org/MyService/MyEndpoint&amp;quot;).streamCaching().to(&amp;quot;xslt:transform.xsl&amp;quot;, &amp;quot;bean:doSomething&amp;quot;); </script> 
 </div>
</div><p>The stream caching is default enabled, so it is not necessary to set the <code>streamCaching()</code> option.<br clear="none"> We store big input streams (by default, over 64K) in a <code>temp</code> file using <code>CachedOutputStream</code>. When you close the input stream, the temp file will be deleted.</p><h3 id="BookInOnePage-CreatingaJBIServiceUnit">Creating a JBI Service Unit</h3><p>If you have some Camel routes that you want to deploy inside JBI as a Service Unit, you can use the <a shape="rect" href="jbi-service-unit-archetype.html">JBI Service Unit Archetype</a> to create a new Maven project for the Service Unit.</p><p>If you have an existing Maven project that you need to convert into a JBI Service Unit, you may want to consult <a shape="rect" class="external-link" href="http://servicemix.apache.org/maven-jbi-plugin.html">ServiceMix Maven JBI Plugins</a> for further help. The key steps are as follows:</p><ul><li>Create a Spring XML file at <code>src/main/resources/camel-context.xml</code> to bootstrap your routes inside the JBI Service Unit.</li><li>Change the POM file's packaging to <code>jbi-service-unit</code>.</li></ul><p>Your <code>pom.xml</code> should look something like this to enable the <code>jbi-service-unit</code> packaging: </p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;project xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&amp;quot;&amp;gt; &amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt; &amp;lt;groupId&amp;gt;myGroupId&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;myArtifactId&amp;lt;/artifactId&amp;gt; &amp;lt;packaging&amp;gt;jbi-service-unit&amp;lt;/packaging&amp;gt; &amp;lt;version&amp;gt;1.0-SNAPSHOT&amp;lt;/version&amp;gt; &amp;lt;name&amp;gt;A Camel based JBI Service Unit&amp;lt;/name&amp;gt; &amp;lt;url&amp;gt;http://www.myorganization.org&amp;lt;/url&amp;gt; &amp;lt;properties&amp;gt; &amp;lt;camel-version&amp;gt;x.x.x&amp;lt;/camel-version&amp;gt; &amp;lt;servicemix-version&amp;gt;3.3&amp;lt;/servicemix-version&amp;gt; &amp;lt;/properties&amp;gt; &amp;lt;dependencies&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.servicemix&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;servicemix-camel&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;${servicemix-version}&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.servicemix&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;servicemix-core&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;${servicemix-version}&amp;lt;/version&amp;gt; &amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;/dependencies&amp;gt; &amp;lt;build&amp;gt; &amp;lt;defaultGoal&amp;gt;install&amp;lt;/defaultGoal&amp;gt; &amp;lt;plugins&amp;gt; &amp;lt;plugin&amp;gt; &amp;lt;groupId&amp;gt;org.apache.maven.plugins&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;maven-compiler-plugin&amp;lt;/artifactId&amp;gt; &amp;lt;configuration&amp;gt; &amp;lt;source&amp;gt;1.5&amp;lt;/source&amp;gt; &amp;lt;target&amp;gt;1.5&amp;lt;/target&amp;gt; &amp;lt;/configuration&amp;gt; &amp;lt;/plugin&amp;gt; &amp;lt;!-- creates the JBI deployment unit --&amp;gt; &amp;lt;plugin&amp;gt; &amp;lt;groupId&amp;gt;org.apache.servicemix.tooling&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;jbi-maven-plugin&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;${servicemix-version}&amp;lt;/version&amp;gt; &amp;lt;extensions&amp;gt;true&amp;lt;/extensions&amp;gt; &amp;lt;/plugin&amp;gt; &amp;lt;/plugins&amp;gt; &amp;lt;/build&amp;gt; &amp;lt;/project&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-SeeAlso.47">See Also</h3><ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul><li><a shape="rect" class="external-link" href="http://servicemix.apache.org/servicemix-camel.html">ServiceMix Camel module</a></li><li><a shape="rect" class="external-link" href="http://servicemix.apache.org/3-beginner-using-apache-camel-inside-servicemix.html">Using Camel with ServiceMix</a></li><li><a shape="rect" class="external-link" href="http://servicemix.apache.org/order-file-processing.html">Cookbook on using Camel with ServiceMix</a></li></ul><h2 id="BookInOnePage-JCRComponent">JCR Component</h2><p>The <strong><code>jcr</code></strong> component allows you to add/read nodes to/from a JCR compliant content repository (for example, <a shape="rect" class="external-link" href="http://jackrabbit.apache.org/">Apache Jackrabbit</a>) with its producer, or register an EventListener with the consumer.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-jcr&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.32">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">jcr://user:password@repository/path/to/node </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Consumer added</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>From <strong>Camel 2.10</strong> onwards you can use consumer as an EventListener in JCR or a producer to read a node by identifier.</p>
 </div>
</div><h3 id="BookInOnePage-Usage.4">Usage</h3><p>The <code>repository</code> element of the URI is used to look up the JCR <code>Repository</code> object in the Camel context registry.</p><h4 id="BookInOnePage-Producer.1">Producer</h4><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelJcrOperation</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelJcrInsert</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>CamelJcrInsert or CamelJcrGetById operation to use</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelJcrNodeName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Used to determine the node name to use.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>CamelJcrNodeType</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>null</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> To use a specify primary node type when creating adding a new node.</td></tr></tbody></table> 
 </div>
</div><p>When a message is sent to a JCR producer endpoint:</p><ul><li>If the operation is CamelJcrInsert: A new node is created in the content repository, all the message headers of the IN message are transformed to <code><a shape="rect" class="external-link" href="http://www.day.com/specs/javax.jcr/javadocs/jcr-2.0/javax/jcr/Value.html" rel="nofollow">javax.jcr.Value</a></code> instances and added to the new node and the node's UUID is returned in the OUT message.</li><li>If the operation is CamelJcrGetById: A new node is retrieved from the repository using the message body as node identifier.</li></ul><div class="confluence-information-macro confluence-information-macro-note">
 <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Please note that the JCR Producer used message properties instead of message headers in Camel versions earlier than 2.12.3. See <a shape="rect" class="external-link" href="https://issues.apache.org/jira/browse/CAMEL-7067">https://issues.apache.org/jira/browse/CAMEL-7067</a> for more details.</p>
 </div>
</div><p>&#160;</p><h4 id="BookInOnePage-Consumer.1">Consumer</h4><p>The consumer will connect to JCR periodically and return a List&lt;<a shape="rect" class="external-link" href="http://www.day.com/specs/javax.jcr/javadocs/jcr-2.0/javax/jcr/observation/Event.html" rel="nofollow">javax.jcr.observation.Event</a>&gt; in the message body.</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>eventTypes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A combination of one or more event types encoded as a bit mask value such as javax.jcr.observation.Event.NODE_ADDED, javax.jcr.observation.Event.NODE_REMOVED, etc.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>deep</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>When it is true, events whose associated parent node is at current path or within its subgraph are received.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>uuids</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Only events whose associated parent node has one of the identifiers in the comma separated uuid list will be received.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>nodeTypeNames</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Only events whose associated parent node has one of the node types (or a subtype of one of the node types) in this list will be received.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>noLocal</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If <code>noLocal</code> is <code>true</code>, then events generated by the session through which the listener was registered are ignored. Otherwise, they are not ignored.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sessionLiveCheckInterval</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>60000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Interval in milliseconds to wait before each session live checking.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sessionLiveCheckIntervalOnStart</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>3000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Interval in milliseconds to wait before the first session live checking.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="font-family: monospace;">username</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.15:</strong> Allows to specify the username as a uri parameter instead of in the authority section of the uri</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="font-family: monospace;">password</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.15:</strong> Allows to specify the password as a uri parameter instead of in the authority section of the uri</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="font-family: monospace;">workspaceName</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16:</strong><span> Allows to specify a workspace different from default</span></p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Example.21">Example</h3><p>The snippet below creates a node named <code>node</code> under the <code>/home/test</code> node in the content repository. One additional property is added to the node as well: <code>my.contents.property</code> which will contain the body of the message being sent.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:a&amp;quot;).setHeader(JcrConstants.JCR_NODE_NAME, constant(&amp;quot;node&amp;quot;)) .setHeader(&amp;quot;my.contents.property&amp;quot;, body()) .to(&amp;quot;jcr://user:pass@repository/home/test&amp;quot;);</script> 
 </div>
</div><p>&#160;</p><p>The following code will register an EventListener under the path import-application/inbox for Event.NODE_ADDED and Event.NODE_REMOVED events (event types 1 and 2, both masked as 3) and listening deep for all the children.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;jcr://user:pass@repository/import-application/inbox?eventTypes=3&amp;amp;deep=true&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;direct:execute-import-application&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.48">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-JDBCComponent">JDBC Component</h2><p>The <strong>jdbc</strong> component enables you to access databases through JDBC, where SQL queries (SELECT) and operations (INSERT, UPDATE, etc) are sent in the message body. This component uses the standard JDBC API, unlike the <a shape="rect" href="sql-component.html">SQL Component</a> component, which uses spring-jdbc.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-jdbc&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>This component can only be used to define producer endpoints, which means that you cannot use the JDBC component in a <code>from()</code> statement.</p>
 </div>
</div><h3 id="BookInOnePage-URIformat.33">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">jdbc:dataSourceName[?options] </script> 
 </div>
</div><p>This component only supports producer endpoints.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.46">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>readSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The default maximum number of rows that can be read by a polling query. The default value is 0.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>statement.&lt;xxx&gt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.1:</strong> Sets additional options on the <code>java.sql.Statement</code> that is used behind the scenes to execute the queries. For instance, <code>statement.maxRows=10</code>. For detailed documentation, see the <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/sql/Statement.html" rel="nofollow"><code>java.sql.Statement</code> javadoc</a> documentation.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>useJDBC4ColumnNameAndLabelSemantics</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.2:</strong> Sets whether to use JDBC 4/3 column label/name semantics. You can use this option to turn it <code>false</code> in case you have issues with your JDBC driver to select data. This only applies when using <code>SQL SELECT</code> using aliases (e.g. <code>SQL SELECT id as identifier, name as given_name from persons</code>).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>resetAutoCommit</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> If true, Camel will set the autoCommit on the JDBC connection to be false, commit the change after executing the statement and reset the autoCommit flag of the connection at the end. If the JDBC connection does not support resetting the autoCommit flag, set this to false. <br clear="none">When used with XA transactions you most likely need to set it to false so that the transaction manager is in charge of committing this tx.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>allowNamedParameters</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> Whether to allow using named parameters in the queries.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>prepareStatementStrategy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> Allows to plugin to use a custom <code>org.apache.camel.component.jdbc.JdbcPrepareStatementStrategy</code> to control preparation of the query and prepared statement.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>useHeadersAsParameters</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> Set this option to <code>true</code> to use the <code>prepareStatementStrategy</code> with named parameters. This allows to define queries with named placeholders, and use headers with the dynamic values for the query placeholders.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>outputType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>SelectList</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12.1:</strong> <span>outputType='SelectList', for consumer or producer, w</span><span>ill output a List of Map. </span><code>SelectOne</code><span> will output single Java object in the following way</span>:<br clear="none"> a) If the query has only single column, then that JDBC Column object is returned. (such as SELECT COUNT( * ) FROM PROJECT will return a Long object.<br clear="none"> b) If the query has more than one column, then it will return a Map of that result.<br clear="none"> c) If the outputClass is set, then it will convert the query result into an Java bean object by calling all the setters that match the column names. It will assume your class has a default constructor to create instance with. From <strong>Camel 2.14</strong> onwards then SelectList is also supported. <br clear="none"> d) If the query resulted in more than one rows, it throws an non-unique result exception.<br clear="none"> <strong>Camel 2.14.0:</strong> New <code>StreamList</code> output type value that streams the result of the query using an <code>Iterator&lt;Map&lt;String, Object&gt;&gt;</code>, it can be used along with the <a shape="rect" href="splitter.html">Splitter</a> EIP.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>outputClass</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12.1:</strong> Specify the full package and class name to use as conversion when outputType=SelectOne. From <strong>Camel 2.14</strong> onwards then SelectList is also supported.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>beanRowMapper</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12.1:</strong> To use a custom <code>org.apache.camel.component.jdbc.BeanRowMapper</code> when using <code>outputClass</code>. The default implementation will lower case the row names and skip underscores, and dashes. For example <code>"CUST_ID"</code> is mapped as <code>"custId"</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>useGetBytesForBlob</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> To read BLOB columns as bytes instead of string data. This may be needed for certain databases such as Oracle where you must read BLOB columns as bytes.</td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Result">Result</h3><p>By default the result is returned in the OUT body as an <code>ArrayList&lt;HashMap&lt;String, Object&gt;&gt;</code>. The <code>List</code> object contains the list of rows and the <code>Map</code> objects contain each row with the <code>String</code> key as the column name. You can use the option <code>outputType</code> to control the result.</p><p><strong>Note:</strong> This component fetches <code>ResultSetMetaData</code> to be able to return the column name as the key in the <code>Map</code>.</p><h4 id="BookInOnePage-MessageHeaders.8">Message Headers</h4><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelJdbcRowCount</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If the query is a <code>SELECT</code>, query the row count is returned in this OUT header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelJdbcUpdateCount</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If the query is an <code>UPDATE</code>, query the update count is returned in this OUT header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelGeneratedKeysRows</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Rows that contains the generated keys.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelGeneratedKeysRowCount</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> The number of rows in the header that contains generated keys.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelJdbcColumnNames</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.1:</strong> The column names from the ResultSet as a <code>java.util.Set</code> type.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelJdbcParameters</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> A <code>java.util.Map</code> which has the headers to be used if <code>useHeadersAsParameters</code> has been enabled.</p></td></tr></tbody></table>
</div><h3 id="BookInOnePage-Generatedkeys">Generated keys</h3><p><strong>Available as of Camel 2.10</strong></p><p>If you insert data using SQL INSERT, then the RDBMS may support auto generated keys. You can instruct the <a shape="rect" href="jdbc.html">JDBC</a> producer to return the generated keys in headers.<br clear="none"> To do that set the header <code>CamelRetrieveGeneratedKeys=true</code>. Then the generated keys will be provided as headers with the keys listed in the table above.</p><p>You can see more details in this <a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/camel/trunk/components/camel-jdbc/src/test/java/org/apache/camel/component/jdbc/JdbcGeneratedKeysTest.java">unit test</a>.</p><div class="confluence-information-macro confluence-information-macro-information">
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Using generated keys does not work with together with named parameters.</p>
 </div>
</div><h3 id="BookInOnePage-Usingnamedparameters">Using named parameters</h3><p><strong>Available as of Camel 2.12</strong></p><p>In the given route below, we want to get all the projects from the projects table. Notice the SQL query has 2 named parameters, :?lic and :?min.<br clear="none"> Camel will then lookup these parameters from the message headers. Notice in the example above we set two headers with constant value<br clear="none"> for the named parameters:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:projects&amp;quot;) .setHeader(&amp;quot;lic&amp;quot;, constant(&amp;quot;ASF&amp;quot;)) .setHeader(&amp;quot;min&amp;quot;, constant(123)) .setBody(&amp;quot;select * from projects where license = :?lic and id &amp;gt; :?min order by id&amp;quot;) .to(&amp;quot;jdbc:myDataSource?useHeadersAsParameters=true&amp;quot;) </script> 
 </div>
</div><p>You can also store the header values in a <code>java.util.Map</code> and store the map on the headers with the key <code>CamelJdbcParameters</code>.</p><h3 id="BookInOnePage-Samples.11">Samples</h3><p>In the following example, we fetch the rows from the customer table.</p><p>First we register our datasource in the Camel registry as <code>testdb</code>:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> JndiRegistry reg = super.createRegistry(); reg.bind(&amp;quot;testdb&amp;quot;, db); return reg; </script> 
  </div>
 </div>Then we configure a route that routes to the JDBC component, so the SQL will be executed. Note how we refer to the <code>testdb</code> datasource that was bound in the previous step:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // lets add simple route public void configure() throws Exception { from(&amp;quot;direct:hello&amp;quot;).to(&amp;quot;jdbc:testdb?readSize=100&amp;quot;); } </script> 
  </div>
 </div>Or you can create a <code>DataSource</code> in Spring like this:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext id=&amp;quot;camel&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;!-- trigger every second --&amp;gt; &amp;lt;from uri=&amp;quot;timer://kickoff?period=1s&amp;quot;/&amp;gt; &amp;lt;setBody&amp;gt; &amp;lt;constant&amp;gt;select * from customer&amp;lt;/constant&amp;gt; &amp;lt;/setBody&amp;gt; &amp;lt;to uri=&amp;quot;jdbc:testdb&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;!-- Just add a demo to show how to bind a data source for camel in Spring--&amp;gt; &amp;lt;jdbc:embedded-database id=&amp;quot;testdb&amp;quot; type=&amp;quot;DERBY&amp;quot;&amp;gt; &amp;lt;jdbc:script location=&amp;quot;classpath:sql/init.sql&amp;quot;/&amp;gt; &amp;lt;/jdbc:embedded-database&amp;gt; </script> 
  </div>
 </div>We create an endpoint, add the SQL query to the body of the IN message, and then send the exchange. The result of the query is returned in the OUT body:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // first we create our exchange using the endpoint Endpoint endpoint = context.getEndpoint(&amp;quot;direct:hello&amp;quot;); Exchange exchange = endpoint.createExchange(); // then we set the SQL on the in body exchange.getIn().setBody(&amp;quot;select * from customer order by ID&amp;quot;); // now we send the exchange to the endpoint, and receives the response from Camel Exchange out = template.send(endpoint, exchange); // assertions of the response assertNotNull(out); assertNotNull(out.getOut()); List&amp;lt;Map&amp;lt;String, Object&amp;gt;&amp;gt; data = out.getOut().getBody(List.class); assertNotNull(data); assertEquals(3, data.size()); Map&amp;lt;String, Object&amp;gt; row = data.get(0); assertEquals(&amp;quot;cust1&amp;quot;, row.get(&amp;quot;ID&amp;quot;)); assertEquals(&amp;quot;jstrachan&amp;quot;, row.get(&amp;quot;NAME&amp;quot;)); row = data.get(1); assertEquals(&amp;quot;cust2&amp;quot;, row.get(&amp;quot;ID&amp;quot;)); assertEquals(&amp;quot;nsandhu&amp;quot;, row.get(&amp;quot;NAME&amp;quot;)); </script> 
  </div>
 </div>If you want to work on the rows one by one instead of the entire ResultSet at once you need to use the <a shape="rect" href="splitter.html">Splitter</a> EIP such as:<p>In Camel 2.13.x or older
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:hello&amp;quot;) // here we split the data from the testdb into new messages one by one // so the mock endpoint will receive a message per row in the table .to(&amp;quot;jdbc:testdb&amp;quot;).split(body()).to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>In Camel 2.14.x or newer<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:hello&amp;quot;) // here we split the data from the testdb into new messages one by one // so the mock endpoint will receive a message per row in the table // the StreamList option allows to stream the result of the query without creating a List of rows // and notice we also enable streaming mode on the splitter .to(&amp;quot;jdbc:testdb?outputType=StreamList&amp;quot;) .split(body()).streaming() .to(&amp;quot;mock:result&amp;quot;);</script> 
 </div>
</div><h3 id="BookInOnePage-Sample-Pollingthedatabaseeveryminute"><br clear="none"><span style="font-size: 16.0px;line-height: 1.5625;">Sample - Polling the database every minute</span></h3><p>If we want to poll a database using the JDBC component, we need to combine it with a polling scheduler such as the <a shape="rect" href="timer.html">Timer</a> or <a shape="rect" href="quartz.html">Quartz</a> etc. In the following example, we retrieve data from the database every 60 seconds:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;timer://foo?period=60000&amp;quot;).setBody(constant(&amp;quot;select * from customer&amp;quot;)).to(&amp;quot;jdbc:testdb&amp;quot;).to(&amp;quot;activemq:queue:customers&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-Sample-MoveDataBetweenDataSources"><span>Sample - Move Data Between Data Sources<br clear="none"></span></h3><p>A common use case is to query for data, process it and move it to another data source (ETL operations). In the following example, we retrieve new customer records from the source table every hour, filter/transform them and move them to a destination table:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;timer://MoveNewCustomersEveryHour?period=3600000&amp;quot;) .setBody(constant(&amp;quot;select * from customer where create_time &amp;gt; (sysdate-1/24)&amp;quot;)) .to(&amp;quot;jdbc:testdb&amp;quot;) .split(body()) .process(new MyCustomerProcessor()) //filter/transform results as needed .setBody(simple(&amp;quot;insert into processed_customer values(&amp;#39;${body[ID]}&amp;#39;,&amp;#39;${body[NAME]}&amp;#39;)&amp;quot;)) .to(&amp;quot;jdbc:testdb&amp;quot;); </script> 
 </div>
</div><p>&#160;</p><p></p><h3 id="BookInOnePage-SeeAlso.49">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="sql.html">SQL</a></li></ul><h2 id="BookInOnePage-JettyComponent">Jetty Component</h2><p>The <strong><code>jetty</code></strong> component provides HTTP-based <a shape="rect" href="endpoint.html">endpoints</a> for consuming and producing HTTP requests. That is, the Jetty component behaves as a simple Web server. Jetty can also be used as an HTTP client which mean you can also use it with Camel as a producer.</p><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Stream</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p><span style="color: rgb(0,0,0);">The&#160;</span><strong><code>assert</code></strong><span style="color: rgb(0,0,0);">&#160;call appears in this example, because the code is part of an unit test.</span> Jetty is stream based, which means the input it receives is submitted to Camel as a stream. That means you will only be able to read the content of the stream <strong>once</strong>.</p>
  <p>If you find a situation where the message body appears to be empty or you need to access the&#160;<strong><code>Exchange.HTTP_RESPONSE_CODE</code></strong> data multiple times, e.g., doing multi-casting, or re-delivery error handling, you should use <a shape="rect" href="stream-caching.html">Stream caching</a> or convert the message body to a <strong><code>String</code></strong> which is safe to be re-read multiple times.</p>
 </div>
</div><p>Maven users should add the following dependency to their <strong><code>pom.xml</code></strong> to use this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-jetty&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIFormat.2">URI Format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">jetty:http://hostname[:port][/resourceUri][?options] </script> 
 </div>
</div><p>Query options should be appended to the URI using the following format: <strong><code>?option=value&amp;option=value&amp;...</code></strong></p><h3 id="BookInOnePage-Options.47">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bridgeEndpoint</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.1:</strong> If the option is <strong><code>true</code></strong>,&#160;<strong><code>HttpProducer</code></strong> will ignore the&#160;<strong><code>Exchange.HTTP_URI</code></strong> header, and use the endpoint's URI for request. You may also set the&#160;<strong><code>throwExceptionOnFailure</code></strong> to be false to let the&#160;<strong><code>HttpProducer</code></strong> send all the fault response back.</p><p><strong>Camel 2.3:</strong> If the option is true,&#160;<strong><code>HttpProducer</code></strong> and&#160;<strong><code>CamelServlet</code></strong> will skip the gzip processing if the&#160;<strong><code>Content-Encoding</code></strong> is <strong><code>gzip</code></strong>.</p><p>Consider setting&#160;<strong><code>disableStreamCache=true</code></strong> to optimize when bridging.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>chunked</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.2:</strong> If this option is&#160;<strong><code>false</code></strong> Jetty Servlet will disable the HTTP streaming and set the&#160;<strong><code>Content-Length</code></strong> header on the response</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>continuationTimeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.6:</strong> Allows to set a timeout in milliseconds when using <a shape="rect" href="jetty.html">Jetty</a> as consumer (server). By default Jetty uses <strong><code>30000</code></strong>. You can use a value of <strong><code>&lt;= 0</code></strong> to never expire. If a timeout occurs then the request will be expired and Jetty will return back an HTTP error&#160;<strong><code>503</code></strong> to the client.</p><p>This option is only in use when using <a shape="rect" href="jetty.html">Jetty</a> with the <a shape="rect" href="asynchronous-routing-engine.html">Asynchronous Routing Engine</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cookieHandler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.19: Producer only</strong> Configure a cookie handler to maintain a HTTP session.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>disableStreamCache</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> Determines whether or not the raw input stream from Jetty is cached or not (Camel will read the stream into a in memory/overflow to file, <a shape="rect" href="stream-caching.html">Stream caching</a>) cache. By default Camel will cache the Jetty input stream to support reading it multiple times to ensure it Camel can retrieve all data from the stream. However, you can set this option to <strong><code>true</code></strong> when you for example need to access the raw stream, such as streaming it directly to a file or other persistent store.&#160;</p><p><strong><code>DefaultHttpBinding</code></strong> will copy the request input stream into a stream cache and put it into message body if this option is <strong><code>false</code></strong> to support reading the stream multiple times. If you use <a shape="rect" href="jetty.html">Jetty</a> to bridge/proxy an endpoint then consider enabling this option to improve performance, in case you do not need to read the message payload multiple times.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code><span>enableCORS</span></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.15:</strong> if the option is <strong><code>true</code></strong>, Jetty server will setup the <span style="line-height: 1.4285715;"><strong><code>CrossOriginFilter</code></strong> which supports the <span><a shape="rect" class="external-link" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS" rel="nofollow">CORS</a> out of box.</span></span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>enableJmx</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> If this option is <strong><code>true</code></strong>, Jetty JMX support will be enabled for this endpoint. See <a shape="rect" href="#BookInOnePage-JettyJMXsupport">Jetty JMX support</a> for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>enablemulti-partFilter</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> Whether Jetty <strong><code>org.eclipse.jetty.servlets.multi-partFilter</code></strong> is enabled or not.</p><p>Set this option to <strong><code>false</code></strong> when bridging endpoints, to ensure multi-part requests is proxied/bridged as well.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>filterInit.<em>xxx</em></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17</strong>: Configuration for the&#160;<strong><code>InitParameters</code></strong> of filter.</p><p>For example, setting&#160;<strong><code>filterInit.parameter=value</code></strong> <span>the parameter could be used when calling the filter&#160;<strong><code>init()</code></strong> method.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>filtersRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> Allows using a custom filters which is putted into a list and can be find in the <a shape="rect" href="registry.html">Registry</a></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>handlers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies a comma-delimited set of <strong><code>org.mortbay.jetty.Handler</code></strong> instances in your <a shape="rect" href="registry.html">Registry</a> (such as your Spring <strong><code>ApplicationContext</code></strong>). These handlers are added to the Jetty Servlet context (for example, to add security).</p><p><strong>Note</strong>: you can not use different handlers with different Jetty endpoints using the same port number. The handlers is associated to the port number. If you need different handlers, then use different port numbers.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>headerFilterStrategy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> Reference to a instance of <strong><code>org.apache.camel.spi.HeaderFilterStrategy</code></strong> in the <a shape="rect" href="registry.html">Registry</a>. It will be used to apply the custom&#160;<strong><code>headerFilterStrategy</code></strong> on the new create <strong><code>HttpJettyEndpoint</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpBindingRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Reference to an <strong><code>org.apache.camel.component.http.HttpBinding</code></strong> in the <a shape="rect" href="registry.html">Registry</a>. <strong><code>HttpBinding</code></strong> can be used to customize how a response should be written for the consumer.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpClient.<em>xxx</em></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Configuration of Jetty's <a shape="rect" class="external-link" href="http://www.eclipse.org/jetty/documentation/current/http-client-api.html" rel="nofollow">HttpClient</a>. For example, setting <strong><code>httpClient.idleTimeout=30000</code></strong> sets the idle timeout to&#160;<strong><code>30</code></strong> seconds. And <strong><code>httpClient.timeout=30000</code></strong> sets the request timeout to&#160;<strong><code>30</code></strong> seconds, in case you want to timeout sooner if you have long running request/response calls.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpClient</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To use a shared <strong><code>org.eclipse.jetty.client.HttpClient</code></strong> for all producers created by this endpoint. This option should only be used in special circumstances.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpClientMinThreads</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>Producer only</strong>: To set a value for minimum number of threads in <strong><code>HttpClient</code></strong> thread pool. This setting override any setting configured on component level. Notice that both a min and max size must be configured. If not set it default to min 8 threads used in Jetty's thread pool.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpClientMaxThreads</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>Producer only</strong>: To set a value for maximum number of threads in <strong><code>HttpClient</code></strong> thread pool. This setting override any setting configured on component level. Notice that both a min and max size must be configured. If not set it default to max&#160;<strong><code>16</code></strong> threads used in Jetty's thread pool.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpMethodRestrict</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>Consumer only</strong>: Used to only allow consuming if the&#160;<strong><code>HttpMethod</code></strong> matches, such as&#160;<strong><code>GET/POST/PUT</code></strong> etc. <span>From </span><strong>Camel 2.15</strong><span>: multiple methods can be specified separated by comma.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>jettyHttpBindingRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.6.0+:</strong> Reference to an <strong><code>org.apache.camel.component.jetty.JettyHttpBinding</code></strong> in the <a shape="rect" href="registry.html">Registry</a>. <strong><code>JettyHttpBinding</code></strong> can be used to customize how a response should be written for the producer.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>matchOnUriPrefix</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether or not the <strong><code>CamelServlet</code></strong> should try to find a target consumer by matching the URI prefix if no exact match is found.</p><p>See here <a shape="rect" href="how-do-i-let-jetty-match-wildcards.html">How do I let Jetty match wildcards</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>multi-partFilterRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.6:</strong> Allows using a custom multi-part filter.</p><p><strong>Note</strong>: setting <strong><code>multi-partFilterRef</code></strong> forces the value of <strong><code>enablemulti-partFilter</code></strong> to <strong><code>true</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>okStatusCodeRange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>200-299</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16:</strong><span> <strong>Producer only</strong> The status codes which is considered a success response. The values are inclusive. The range must be defined as from-to with the dash included.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>optionsEnabled</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17:</strong> Specifies whether to enable&#160;<strong><code>HTTP OPTIONS</code></strong> for this Jetty consumer. By default&#160;<strong><code>OPTIONS</code></strong> is turned off.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>proxyHost</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>Producer only</strong> The HTTP proxy Host URL which will be used by Jetty client.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>proxyPort</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>Producer only</strong> The HTTP proxy port which will be used by Jetty client.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>responseBufferSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> To use a custom buffer size on the <strong><code>javax.servlet.ServletResponse</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sendDateHeader</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.14:</strong> if the option is true, jetty server will send the date header to the client which sends the request.</p><p><strong>Note</strong>: ensure that there are no any other&#160;<strong><code>camel-jetty</code></strong> endpoints that share the same port, otherwise this option may not work as expected.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sendServerVersion</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.13:</strong> if the option is true, jetty will send the server header with the jetty version information to the client which sends the request.</p><p><strong>Note</strong>: ensure that there are no any other&#160;<strong><code>camel-jetty</code></strong> endpoints that share the same port, otherwise this option may not work as expected.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sessionSupport</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies whether to enable the session manager on the server side of Jetty.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sslContextParameters</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17:</strong> <span> Reference to a </span><strong><code>org.apache.camel.util.jsse.SSLContextParameters</code></strong><span> in the </span><a shape="rect" href="registry.html">Registry</a><span>.&#160; This reference overrides any configured&#160;<strong><code>SSLContextParameters</code></strong> at the component level.&#160; </span><span>&#160;</span></p><p><span>See </span><a shape="rect" href="camel-configuration-utilities.html">Using the JSSE Configuration Utility</a><span>.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sslContextParametersRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> <strong>Deprecated</strong> Reference to a <strong><code>org.apache.camel.util.jsse.SSLContextParameters</code></strong> in the <a shape="rect" href="registry.html">Registry</a>.&#160; This reference overrides any configured&#160;<strong><code>SSLContextParameters</code></strong> at the component level.&#160;</p><p>See <a shape="rect" href="camel-configuration-utilities.html">Using the JSSE Configuration Utility</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>throwExceptionOnFailure</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Option to disable throwing the <strong><code>HttpOperationFailedException</code></strong> in case of failed responses from the remote server. This allows you to get all responses regardless of the HTTP status code.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>traceEnabled</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies whether to enable&#160;<strong><code>HTTP TRACE</code></strong> for this Jetty consumer. By default&#160;<strong><code>TRACE</code></strong> is turned off.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transferException</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.6:</strong> If enabled and an <a shape="rect" href="exchange.html">Exchange</a> failed processing on the consumer side, and if the caused Exception was send back serialized in the response as a <strong><code>application/x-java-serialized-object</code></strong> content type.</p><p>On the producer side the exception will be deserialized and thrown as is, instead of the <strong><code>HttpOperationFailedException</code></strong>. The caused exception is required to be serialized.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>urlRewrite</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>Producer only</strong> Refers to a custom <strong><code>org.apache.camel.component.http.UrlRewrite</code></strong> which allows you to rewrite URLs when you bridge/proxy endpoints.</p><p>See more details at <a shape="rect" href="urlrewrite.html">UrlRewrite</a> and <a shape="rect" href="how-to-use-camel-as-a-http-proxy-between-a-client-and-server.html">How to use Camel as a HTTP proxy between a client and server</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>useContinuation</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.6:</strong> Whether or not to use <a shape="rect" class="external-link" href="http://wiki.eclipse.org/Jetty/Feature/Continuations" rel="nofollow">Jetty continuations</a> for the Jetty Server.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-MessageHeaders.9">Message Headers</h3><p>Camel uses the same message headers as the <a shape="rect" href="http.html">HTTP</a> component. From <strong>Camel 2.2</strong>, it also uses (<strong><code>Exchange.HTTP_CHUNKED</code></strong>,&#160;<strong><code>CamelHttpChunked</code></strong>) header to toggle chunked encoding on the&#160;<strong><code>camel-jetty</code></strong> consumer. Camel also populates <em>all</em>&#160;<strong><code>request.parameter</code></strong> and <strong><code>request.headers</code></strong>. For example, given a client request with the URL, <code><a shape="rect" class="external-link" href="http://myserver/myserver?orderid=123" rel="nofollow">http://myserver/myserver?orderid=123</a></code>, the exchange will contain a header named <strong><code>orderid</code></strong> with the value <strong><code>123</code></strong>.</p><p>From <strong>Camel 2.2.0</strong>: you can get the request.parameter from the message header not only from&#160;<strong><code>GET</code></strong> HTTP Method, but also other HTTP method.</p><h3 id="BookInOnePage-Usage.5">Usage</h3><p>The Jetty component supports both consumer and producer endpoints. Another option for producing to other HTTP endpoints, is to use the <a shape="rect" href="http.html">HTTP Component</a></p><h3 id="BookInOnePage-ComponentOptions">Component Options</h3><p>The <strong><code>JettyHttpComponent</code></strong> provides the following options:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>allowJavaSerializedObject</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16.1/2.15.5:</strong> Whether to allow java serialization when a request uses <strong><code>context-type=application/x-java-serialized-object</code></strong>.</p><p>When <strong><code>true</code></strong>, be aware that Java will deserialize the incoming data from the request to Java and that can be a potential security risk.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>enableJmx</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> If this option is true, Jetty JMX support will be enabled for this endpoint. See <a shape="rect" href="#BookInOnePage-JettyJMXsupport">Jetty JMX support</a> for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>errorHandler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.15</strong>: This option is used to set the&#160;<strong><code>ErrorHandler</code></strong> that Jetty server uses.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpClient</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Deprecated:</strong> <strong>Producer only</strong>: To use a custom <strong><code>HttpClient</code></strong> with the jetty producer.</p><p><strong>Note</strong>: from <strong>Camel 2.11</strong> this option has been removed. Set the option on the endpoint instead.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpClientMaxThreads</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Producer only</strong>: To set a value for maximum number of threads in <strong><code>HttpClient</code></strong> thread pool. Notice that both a min and max size must be configured.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpClientMinThreads</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Producer only</strong>: To set a value for minimum number of threads in <strong><code>HttpClient</code></strong> thread pool. Notice that both a min and max size must be configured.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpClientThreadPool</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Deprecated:</strong> <strong>Producer only</strong>: To use a custom thread pool for the client.</p><p><strong>Note</strong>: this option has been removed from <strong>Camel 2.11</strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxThreads</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5</strong> <strong>Consumer only</strong>: To set a value for maximum number of threads in server thread pool. Notice that both a min and max size must be configured.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>minThreads</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5</strong> <strong>Consumer only</strong>: To set a value for minimum number of threads in server thread pool. Notice that both a min and max size must be configured.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>proxyHost</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12.2/2.11.3</strong> To use an HTTP proxy.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>proxyPort</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12.2/2.11.3:</strong> To use an HTTP proxy.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>socketConnectors</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5</strong> <strong>Consumer only:</strong> A map which contains per port number specific HTTP connectors. Uses the same principle as <strong><code>sslSocketConnectors</code></strong> and therefore see section <em>SSL support</em> for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>socketConnectorProperties</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5</strong> <strong>Consumer only</strong>. A map which contains general HTTP connector properties. Uses the same principle as <strong><code>sslSocketConnectorProperties</code></strong> and therefore see section <em>SSL support</em> for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sslContextParameters</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> To configure a custom SSL/TLS configuration options at the component level.&#160;</p><p>See&#160; <a shape="rect" class="external-link" href="http://camel.apache.org/camel-configuration-utilities.html">Using the JSSE Configuration Utility</a> for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sslKeyPassword</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Consumer only</strong>: The password for the keystore when using SSL.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sslKeystore</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Consumer only</strong>: The path to the keystore.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sslPassword</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Consumer only</strong>: The password when using SSL.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sslSocketConnectors</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3</strong> <strong>Consumer only:</strong> A map which contains per port number specific SSL connectors. See section <em>SSL support</em> for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sslSocketConnectorProperties</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5</strong> <strong>Consumer only</strong>. A map which contains general SSL connector properties. See section <em>SSL support</em> for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>requestBufferSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.2:</strong> Allows to configure a custom value of the request buffer size on the Jetty connectors.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>requestHeaderSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.2:</strong> Allows to configure a custom value of the request header size on the Jetty connectors.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>responseBufferSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.2:</strong> Allows to configure a custom value of the response buffer size on the Jetty connectors.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>responseHeaderSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.2:</strong> Allows to configure a custom value of the response header size on the Jetty connectors.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>threadPool</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5</strong> <strong>Consumer only</strong>: To use a custom thread pool for the server. This option should only be used in special circumstances.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-ProducerExample">Producer Example</h3><p>The following is a basic example of how to send an HTTP request to an existing HTTP endpoint.</p><p><strong>Java DSL</strong>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;jetty://http://www.google.com&amp;quot;); </script> 
 </div>
</div><p><strong>XML DSL</strong>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;jetty://http://www.google.com&amp;quot;/&amp;gt; &amp;lt;route&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-ConsumerExample">Consumer Example</h3><p>In this sample we define a route that exposes a HTTP service at <code><a shape="rect" class="external-link" href="http://localhost:8080/myapp/myservice" rel="nofollow">http://localhost:8080/myapp/myservice</a></code>:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;jetty:http://localhost:{{port}}/myapp/myservice&amp;quot;).process(new MyBookService()); </script> 
  </div>
 </div><div class="confluence-information-macro confluence-information-macro-note">
 <p class="title">Usage of localhost</p>
 <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>When you specify <strong><code>localhost</code></strong> in a URL, Camel exposes the endpoint only on the local TCP/IP network interface, so it cannot be accessed from outside the machine it operates on.</p>
  <p>If you need to expose a Jetty endpoint on a specific network interface, the numerical IP address of this interface should be used as the host. If you need to expose a Jetty endpoint on all network interfaces, the <strong><code>0.0.0.0</code></strong> address should be used.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>To listen across an entire URI prefix, see <a shape="rect" href="how-do-i-let-jetty-match-wildcards.html">How do I let Jetty match wildcards</a>.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>If you actually want to expose routes by HTTP and already have a Servlet, you should instead refer to the <a shape="rect" href="https://cwiki.apache.org/confluence/display/CXF20DOC/Servlet+Transport">Servlet Transport</a>.</p>
 </div>
</div><p>&#160;</p><p>Our business logic is implemented in the <strong><code>MyBookService</code></strong> class, which accesses the HTTP request contents and then returns a response.<br clear="none"> <strong>Note:</strong> The <strong><code>assert</code></strong> call appears in this example, because the code is part of an unit test.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public class MyBookService implements Processor { public void process(Exchange exchange) throws Exception { // just get the body as a string String body = exchange.getIn().getBody(String.class); // we have access to the HttpServletRequest here and we can grab it if we need it HttpServletRequest req = exchange.getIn().getBody(HttpServletRequest.class); assertNotNull(req); // for unit testing assertEquals(&amp;quot;bookid=123&amp;quot;, body); // send a html response exchange.getOut().setBody(&amp;quot;&amp;lt;html&amp;gt;&amp;lt;body&amp;gt;Book 123 is Camel in Action&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&amp;quot;); } } </script> 
  </div>
 </div>The following sample shows a content-based route that routes all requests containing the URI parameter, <strong><code>one</code></strong>, to the endpoint, <strong><code>mock:one</code></strong>, and all others to <strong><code>mock:other</code></strong>.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;jetty:&amp;quot; + serverUri) .choice() .when().simple(&amp;quot;${header.one}&amp;quot;).to(&amp;quot;mock:one&amp;quot;) .otherwise() .to(&amp;quot;mock:other&amp;quot;); </script> 
  </div>
 </div>If a client sends an HTTP request, <code><a shape="rect" class="external-link" href="http://serverUri?one=hello" rel="nofollow">http://serverUri?one=hello</a></code>, the Jetty component will copy the HTTP request parameter, <strong><code>one</code></strong> to the exchange's <strong><code>in.header</code></strong>. We can then use the <strong><code>simple</code></strong> language to route exchanges that contain this header to a specific endpoint and all others to another. If we used a language more powerful than <a shape="rect" href="simple.html">Simple,</a> e.g., <a shape="rect" href="el.html">EL</a> or <a shape="rect" href="ognl.html">OGNL</a>, then we can also test for the parameter value and route based on the header value as well.<h3 id="BookInOnePage-SessionSupport">Session Support</h3><p>The session support option, <strong><code>sessionSupport</code></strong>, can be used to enable a <strong><code>HttpSession</code></strong> object and access the session object while processing the exchange.</p><p>For example, the following route enables sessions:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;jetty:http://0.0.0.0/myapp/myservice/?sessionSupport=true&amp;quot;/&amp;gt; &amp;lt;processRef ref=&amp;quot;myCode&amp;quot;/&amp;gt; &amp;lt;route&amp;gt; </script> 
 </div>
</div><p>The <strong><code>myCode</code></strong> <a shape="rect" href="processor.html">Processor</a> can be instantiated by a Spring <strong><code>bean</code></strong> element:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;myCode&amp;quot;class=&amp;quot;com.mycompany.MyCodeProcessor&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>Where the processor implementation can access the <strong><code>HttpSession</code></strong> as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public void process(Exchange exchange) throws Exception { HttpSession session = exchange.getIn(HttpMessage.class).getRequest().getSession(); ... } </script> 
 </div>
</div><h3 id="BookInOnePage-SSLSupport(HTTPS)">SSL Support (HTTPS)</h3><h5 id="BookInOnePage-UsingtheJSSEConfigurationUtility.3">Using the JSSE Configuration Utility</h5><p>From <strong>Camel 2.8</strong>: the&#160;<strong><code>camel-jetty</code></strong> component supports SSL/TLS configuration through the <a shape="rect" href="camel-configuration-utilities.html">Camel JSSE Configuration Utility</a>.&#160; This utility greatly decreases the amount of component specific code you need to write and is configurable at the endpoint and component levels.&#160; The following examples demonstrate how to use the utility with the Jetty component.</p><h6 id="BookInOnePage-Programmaticconfigurationofthecomponent.1">Programmatic configuration of the component</h6><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">KeyStoreParameters ksp = new KeyStoreParameters(); ksp.setResource(&amp;quot;/users/home/server/keystore.jks&amp;quot;); ksp.setPassword(&amp;quot;keystorePassword&amp;quot;); KeyManagersParameters kmp = new KeyManagersParameters(); kmp.setKeyStore(ksp); kmp.setKeyPassword(&amp;quot;keyPassword&amp;quot;); SSLContextParameters scp = new SSLContextParameters(); scp.setKeyManagers(kmp); JettyComponent jettyComponent = getContext().getComponent(&amp;quot;jetty&amp;quot;, JettyComponent.class); jettyComponent.setSslContextParameters(scp); </script> 
 </div>
</div><h6 id="BookInOnePage-SpringDSLbasedconfigurationofendpoint.2">Spring DSL based configuration of endpoint</h6><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">... &amp;lt;camel:sslContextParameters id=&amp;quot;sslContextParameters&amp;quot;&amp;gt; &amp;lt;camel:keyManagers keyPassword=&amp;quot;keyPassword&amp;quot;&amp;gt; &amp;lt;camel:keyStore resource=&amp;quot;/users/home/server/keystore.jks&amp;quot; password=&amp;quot;keystorePassword&amp;quot;/&amp;gt; &amp;lt;/camel:keyManagers&amp;gt; &amp;lt;/camel:sslContextParameters&amp;gt;... ... &amp;lt;to uri=&amp;quot;jetty:https://127.0.0.1/mail/?sslContextParametersRef=sslContextParameters&amp;quot;/&amp;gt; ... </script> 
 </div>
</div><h5 id="BookInOnePage-ConfiguringJettyDirectly">Configuring Jetty Directly</h5><p>Jetty provides SSL support out of the box. To enable Jetty to run in SSL mode, simply format the URI using the <strong><code>https://</code></strong> prefix.</p><p><strong>Example</strong>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;from uri=&amp;quot;jetty:https://0.0.0.0/myapp/myservice/&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>Jetty also needs to know where to load your keystore from and what passwords to use in order to load the correct SSL certificate. Set the following JVM System Properties:</p><p><strong>Before Camel 2.3</strong>:</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh">Property</th><th colspan="1" rowspan="1" class="confluenceTh">Description</th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>jetty.ssl.keystore</code></td><td colspan="1" rowspan="1" class="confluenceTd">Specifies the location of the Java&#160;<strong><code>keystore</code></strong> file, which contains the Jetty server's own&#160;<strong><code>X.509</code></strong> certificate in a <em>key entry</em>. A key entry stores the&#160;<strong><code>X.509</code></strong> certificate (effectively, the <em>public key</em>) and also its associated private key.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>jetty.ssl.password</code></td><td colspan="1" rowspan="1" class="confluenceTd">The store password, which is required to access the&#160;<strong><code>keystore</code></strong> file (this is the same password that is supplied to the <strong><code>keystore</code></strong> command's <strong><code>-storepass</code></strong> option).</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>jetty.ssl.keypassword</code></td><td colspan="1" rowspan="1" class="confluenceTd">The key password, which is used to access the certificate's key entry in the&#160;<strong><code>keystore</code></strong> (this is the same password that is supplied to the <strong><code>keystore</code></strong> command's <strong><code>-keypass</code></strong> option).</td></tr></tbody></table>
</div><p>&#160;</p><p><strong>From Camel 2.3</strong>:</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh">Property</th><th colspan="1" rowspan="1" class="confluenceTh">Description</th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>org.eclipse.jetty.ssl.keystore</code></td><td colspan="1" rowspan="1" class="confluenceTd">Specifies the location of the Java&#160;<strong><code>keystore</code></strong> file, which contains the Jetty server's own&#160;<strong><code>X.509</code></strong> certificate in a <em>key entry</em>. A key entry stores the&#160;<strong><code>X.509</code></strong> certificate (effectively, the <em>public key</em>) and also its associated private key.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>org.eclipse.jetty.ssl.password</code></td><td colspan="1" rowspan="1" class="confluenceTd">The store password, which is required to access the&#160;<strong><code>keystore</code></strong> file (this is the same password that is supplied to the&#160;<strong><code>keystore</code></strong> command's&#160;<strong><code>keystore</code></strong> option).</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>org.eclipse.jetty.ssl.keypassword</code></td><td colspan="1" rowspan="1" class="confluenceTd">The key password, which is used to access the certificate's key entry in the&#160;<strong><code>keystore</code></strong> (this is the same password that is supplied to the&#160;<strong><code>keystore</code></strong> command's&#160;<strong><code>keystore</code></strong> option).</td></tr></tbody></table>
</div><p>For details of how to configure SSL on a Jetty endpoint, read the following <a shape="rect" class="external-link" href="http://www.eclipse.org/jetty/documentation/current/configuring-ssl.html" rel="nofollow">Jetty documentation</a>.</p><p>Some SSL properties aren't exposed directly by Camel. However, Camel does expose the underlying <strong><code>SslSocketConnector</code></strong>, which will allow you to set properties like&#160;<strong><code>needClientAuth</code></strong> for mutual authentication requiring a client certificate or&#160;<strong><code>wantClientAuth</code></strong> for mutual authentication where a client doesn't need a certificate but can have one.</p><p>There's a slight difference between the various Camel versions:</p><p><strong>Up to Camel 2.2</strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;jetty&amp;quot; class=&amp;quot;org.apache.camel.component.jetty.JettyHttpComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;sslSocketConnectors&amp;quot;&amp;gt; &amp;lt;map&amp;gt; &amp;lt;entry key=&amp;quot;8043&amp;quot;&amp;gt; &amp;lt;bean class=&amp;quot;org.mortbay.jetty.security.SslSocketConnector&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;password&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;keyPassword&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;keystore&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;needClientAuth&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;truststore&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;/entry&amp;gt; &amp;lt;/map&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p><strong>Camel 2.3, 2.4</strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;jetty&amp;quot; class=&amp;quot;org.apache.camel.component.jetty.JettyHttpComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;sslSocketConnectors&amp;quot;&amp;gt; &amp;lt;map&amp;gt; &amp;lt;entry key=&amp;quot;8043&amp;quot;&amp;gt; &amp;lt;bean class=&amp;quot;org.eclipse.jetty.server.ssl.SslSocketConnector&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;password&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;keyPassword&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;keystore&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;needClientAuth&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;truststore&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;/entry&amp;gt; &amp;lt;/map&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>From <strong>Camel 2.5</strong>: we switch to use&#160;<strong><code>SslSelectChannelConnector *</code></strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;jetty&amp;quot; class=&amp;quot;org.apache.camel.component.jetty.JettyHttpComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;sslSocketConnectors&amp;quot;&amp;gt; &amp;lt;map&amp;gt; &amp;lt;entry key=&amp;quot;8043&amp;quot;&amp;gt; &amp;lt;bean class=&amp;quot;org.eclipse.jetty.server.ssl.SslSelectChannelConnector&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;password&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;keyPassword&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;keystore&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;needClientAuth&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;truststore&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;/entry&amp;gt; &amp;lt;/map&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>The value you use as keys in the above map is the port you configure Jetty to listen on.</p><h4 id="BookInOnePage-ConfiguringGeneralSSLProperties">Configuring General SSL Properties</h4><p>From<strong> Camel 2.5</strong>: instead of a per port number specific SSL socket connector (as shown above) you can now configure general properties which applies for all SSL socket connectors (which is not explicit configured as above with the port number as entry).</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;jetty&amp;quot; class=&amp;quot;org.apache.camel.component.jetty.JettyHttpComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;sslSocketConnectorProperties&amp;quot;&amp;gt; &amp;lt;map&amp;gt; &amp;lt;entry key=&amp;quot;password&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;entry key=&amp;quot;keyPassword&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;entry key=&amp;quot;keystore&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;entry key=&amp;quot;needClientAuth&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;entry key=&amp;quot;truststore&amp;quot;value=&amp;quot;...&amp;quot;/&amp;gt; &amp;lt;/map&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-HowtoObtainAReferencetotheX509Certificate">How to Obtain A Reference to the&#160;<code>X509Certificate</code></h4><p>Jetty stores a reference to the certificate in the&#160;<strong><code>HttpServletRequest</code></strong> which you can access from code as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">HttpServletRequest req = exchange.getIn().getBody(HttpServletRequest.class); X509Certificate cert = (X509Certificate) req.getAttribute(&amp;quot;javax.servlet.request.X509Certificate&amp;quot;) </script> 
 </div>
</div><h4 id="BookInOnePage-ConfiguringGeneralHTTPProperties">Configuring General HTTP Properties</h4><p>From<strong> Camel 2.5</strong>: instead of a per port number specific HTTP socket connector (as shown above) you can now configure general properties which applies for all HTTP socket connectors (which is not explicit configured as above with the port number as entry).</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;jetty&amp;quot; class=&amp;quot;org.apache.camel.component.jetty.JettyHttpComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;socketConnectorProperties&amp;quot;&amp;gt; &amp;lt;map&amp;gt; &amp;lt;entry key=&amp;quot;acceptors&amp;quot; value=&amp;quot;4&amp;quot;/&amp;gt; &amp;lt;entry key=&amp;quot;maxIdleTime&amp;quot; value=&amp;quot;300000&amp;quot;/&amp;gt; &amp;lt;/map&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-HowtoGettheValueofTheX-Forwarded-ForHTTPHeaderUsingHttpServletRequest.getRemoteAddr()">How to Get the Value of The <code>X-Forwarded-For</code> HTTP Header Using <code>HttpServletRequest.getRemoteAddr()</code></h4><p>If the HTTP requests are handled by an Apache server and forwarded to Jetty with <strong><code>mod_proxy</code></strong>, the original client IP address is in the&#160;<strong><code>X-Forwarded-For</code></strong> header and the&#160;<strong><code>HttpServletRequest.getRemoteAddr()</code></strong> will return the address of the Apache proxy.</p><p>Jetty has a forwarded property which takes the value from&#160;<strong><code>X-Forwarded-For</code></strong> and places it in the&#160;<strong><code>HttpServletRequest remoteAddr</code></strong> property.&#160; This property is not available directly through the endpoint configuration but it can be easily added using the&#160;<strong><code>socketConnectors</code></strong> property:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;jetty&amp;quot; class=&amp;quot;org.apache.camel.component.jetty.JettyHttpComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;socketConnectors&amp;quot;&amp;gt; &amp;lt;map&amp;gt; &amp;lt;entry key=&amp;quot;8080&amp;quot;&amp;gt; &amp;lt;bean class=&amp;quot;org.eclipse.jetty.server.nio.SelectChannelConnector&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;forwarded&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;/entry&amp;gt; &amp;lt;/map&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;/bean&amp;gt;</script> 
 </div>
</div><p>This is particularly useful when an existing Apache server handles TLS connections for a domain and proxies them to application servers internally.</p><h3 id="BookInOnePage-DefaultBehaviorforReturningHTTPStatusCodes">Default Behavior for Returning HTTP Status Codes</h3><p>The default behavior of HTTP status codes is defined by the <strong><code>org.apache.camel.component.http.DefaultHttpBinding</code></strong> class, which handles how a response is written and also sets the HTTP status code. If the exchange was processed successfully, the&#160;<strong><code>200</code></strong> HTTP status code is returned. If the exchange failed with an exception, the&#160;<strong><code>500</code></strong> HTTP status code is returned, and the stacktrace is returned in the body. If you want to specify which HTTP status code to return, set the code in the <strong><code>Exchange.HTTP_RESPONSE_CODE</code></strong> header of the&#160;<strong><code>OUT</code></strong> message.</p><h3 id="BookInOnePage-CustomizingHttpBinding">Customizing&#160;<code>HttpBinding</code></h3><p>By default, Camel uses the <strong><code>org.apache.camel.component.http.DefaultHttpBinding</code></strong> to handle how a response is written. If you like, you can customize this behavior either by implementing your own <strong><code>HttpBinding</code></strong> class or by extending <strong><code>DefaultHttpBinding</code></strong> and overriding the appropriate methods.</p><p>The following example shows how to customize the <strong><code>DefaultHttpBinding</code></strong> in order to change how exceptions are returned:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public class MyHttpBinding extends DefaultHttpBinding { @Override public void doWriteExceptionResponse(Throwable exception, HttpServletResponse response) throws IOException { // we override the doWriteExceptionResponse as we only want to alter the binding how exceptions is // written back to the client. // we just return HTTP 200 so the client thinks its okay response.setStatus(200); // and we return this fixed text response.getWriter().write(&amp;quot;Something went wrong but we dont care&amp;quot;); } } </script> 
  </div>
 </div>We can then create an instance of our binding and register it in the Spring registry as follows:<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;mybinding&amp;quot;class=&amp;quot;com.mycompany.MyHttpBinding&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>And then we can reference this binding when we define the route:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt;&amp;lt;from uri=&amp;quot;jetty:http://0.0.0.0:8080/myapp/myservice?httpBindingRef=mybinding&amp;quot;/&amp;gt;&amp;lt;to uri=&amp;quot;bean:doSomething&amp;quot;/&amp;gt;&amp;lt;/route&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-JettyHandlersandSecurityConfiguration">Jetty Handlers and Security Configuration</h3><p>You can configure a list of Jetty handlers on the endpoint, which can be useful for enabling advanced Jetty security features. These handlers are configured in Spring XML as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;-- Jetty Security handling --&amp;gt; &amp;lt;bean id=&amp;quot;userRealm&amp;quot; class=&amp;quot;org.mortbay.jetty.plus.jaas.JAASUserRealm&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;name&amp;quot; value=&amp;quot;tracker-users&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;loginModuleName&amp;quot; value=&amp;quot;ldaploginmodule&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;constraint&amp;quot; class=&amp;quot;org.mortbay.jetty.security.Constraint&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;name&amp;quot; value=&amp;quot;BASIC&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;roles&amp;quot; value=&amp;quot;tracker-users&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;authenticate&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;constraintMapping&amp;quot; class=&amp;quot;org.mortbay.jetty.security.ConstraintMapping&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;constraint&amp;quot; ref=&amp;quot;constraint&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;pathSpec&amp;quot; value=&amp;quot;/*&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;securityHandler&amp;quot; class=&amp;quot;org.mortbay.jetty.security.SecurityHandler&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;userRealm&amp;quot; ref=&amp;quot;userRealm&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;constraintMappings&amp;quot; ref=&amp;quot;constraintMapping&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>From<strong> Camel 2.3</strong>: you can configure a list of Jetty handlers as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;-- Jetty Security handling --&amp;gt; &amp;lt;bean id=&amp;quot;constraint&amp;quot; class=&amp;quot;org.eclipse.jetty.http.security.Constraint&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;name&amp;quot; value=&amp;quot;BASIC&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;roles&amp;quot; value=&amp;quot;tracker-users&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;authenticate&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;constraintMapping&amp;quot; class=&amp;quot;org.eclipse.jetty.security.ConstraintMapping&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;constraint&amp;quot; ref=&amp;quot;constraint&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;pathSpec&amp;quot; value=&amp;quot;/*&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;securityHandler&amp;quot; class=&amp;quot;org.eclipse.jetty.security.ConstraintSecurityHandler&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;authenticator&amp;quot;&amp;gt; &amp;lt;bean class=&amp;quot;org.eclipse.jetty.security.authentication.BasicAuthenticator&amp;quot;/&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;property name=&amp;quot;constraintMappings&amp;quot;&amp;gt; &amp;lt;list&amp;gt; &amp;lt;ref bean=&amp;quot;constraintMapping&amp;quot;/&amp;gt; &amp;lt;/list&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>You can then define the endpoint as:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;jetty:http://0.0.0.0:9080/myservice?handlers=securityHandler&amp;quot;) </script> 
 </div>
</div><p>If you need more handlers, set the <strong><code>handlers</code></strong> option equal to a comma-separated list of bean IDs.</p><h3 id="BookInOnePage-HowtoReturnaCustomHTTP500ReplyMessage">How to Return a Custom HTTP 500 Reply Message</h3><p>You may want to return a custom reply message when something goes wrong, instead of the default reply message Camel <a shape="rect" href="jetty.html">Jetty</a> replies with. You could use a custom <strong><code>HttpBinding</code></strong> to be in control of the message mapping, but often it may be easier to use Camel's <a shape="rect" href="exception-clause.html">Exception Clause</a> to construct the custom reply message.</p><p>Example: return the message: <strong><code>Dude something went wrong</code></strong> for the HTTP error code <strong><code>500</code></strong>:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;jetty://http://localhost:{{port}}/myserver&amp;quot;) // use onException to catch all exceptions and return a custom reply message .onException(Exception.class) .handled(true) // create a custom failure response .transform(constant(&amp;quot;Dude something went wrong&amp;quot;)) // we must remember to set error code 500 as handled(true) // otherwise would let Camel thing its a OK response (200) .setHeader(Exchange.HTTP_RESPONSE_CODE, constant(500)) .end() // now just force an exception immediately .throwException(new IllegalArgumentException(&amp;quot;I cannot do this&amp;quot;)); </script> 
  </div>
 </div><h3 id="BookInOnePage-Multi-PartFormsupport">Multi-Part Form support</h3><p>From <strong>Camel 2.3.0</strong>: <strong><code>camel-jetty</code></strong> support to multi-part form post out of box. The submitted form-data are mapped into the message header.&#160;<strong><code>camel-jetty</code></strong> creates an attachment for each uploaded file. The file name is mapped to the name of the attachment. The content type is set as the content type of the attachment file name. You can find the example here.
 </p><div class="error">
  <span class="error">Error formatting macro: snippet: java.lang.IndexOutOfBoundsException: Index: 20, Size: 20</span> 
 </div><h3 id="BookInOnePage-JettyJMXSupport">Jetty JMX Support</h3><p>From <strong>Camel 2.3.0</strong>:&#160;<strong><code>camel-jetty</code></strong> supports the enabling of Jetty's JMX capabilities at the component and endpoint level with the endpoint configuration taking priority.</p><p><strong>Note</strong>: JMX must be enabled within the Camel context in order to enable JMX support in this component as the component provides Jetty with a reference to the&#160;<strong><code>MBeanServer</code></strong> registered with the Camel context.</p><p>As the&#160;<strong><code>camel-jetty</code></strong> component caches and reuses Jetty resources for a given protocol/host/port pairing, this configuration option will only be evaluated during the creation of the first endpoint to use a protocol/host/port pairing.</p><p><strong>Example</strong>: given two routes created from the following XML fragments, JMX support would remain enabled for all endpoints listening on: <strong><code>https://0.0.0.0</code></strong>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;from uri=&amp;quot;jetty:https://0.0.0.0/myapp/myservice1/?enableJmx=true&amp;quot;/&amp;gt; </script> 
 </div>
</div><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;from uri=&amp;quot;jetty:https://0.0.0.0/myapp/myservice2/?enableJmx=false&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>The&#160;<strong><code>camel-jetty</code></strong> component also provides for direct configuration of the Jetty <strong><code>MBeanContainer</code></strong>. Jetty creates MBean names dynamically. If you are running another instance of Jetty outside of the Camel context and sharing the same&#160;<strong><code>MBeanContainer</code></strong> between the instances, you can provide both instances with a reference to the same&#160;<strong><code>MBeanContainer</code></strong> in order to avoid name collisions when registering Jetty MBeans.</p><p></p><h3 id="BookInOnePage-SeeAlso.50">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="http.html">HTTP</a></li></ul><h2 id="BookInOnePage-JingComponent">Jing Component</h2><p>The Jing component uses the <a shape="rect" class="external-link" href="http://www.thaiopensource.com/relaxng/jing.html" rel="nofollow">Jing Library</a> to perform XML validation of the message body using either</p><ul><li><a shape="rect" class="external-link" href="http://relaxng.org/" rel="nofollow">RelaxNG XML Syntax</a></li><li><a shape="rect" class="external-link" href="http://relaxng.org/compact-tutorial-20030326.html" rel="nofollow">RelaxNG Compact Syntax</a></li></ul><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-jing&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><p>Note that the <a shape="rect" href="msv.html">MSV</a> component can also support RelaxNG XML syntax.</p><h3 id="BookInOnePage-URIformatCamel2.15orolder">URI format Camel 2.15 or older</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">rng:someLocalOrRemoteResource rnc:someLocalOrRemoteResource</script> 
 </div>
</div><p>Where <strong>rng</strong> means use the <a shape="rect" class="external-link" href="http://relaxng.org/" rel="nofollow">RelaxNG XML Syntax</a> whereas <strong>rnc</strong> means use <a shape="rect" class="external-link" href="http://relaxng.org/compact-tutorial-20030326.html" rel="nofollow">RelaxNG Compact Syntax</a>. The following examples show possible URI values</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Example</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>rng:foo/bar.rng</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>References the XML file <strong>foo/bar.rng</strong> on the classpath</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>rnc:</p><a shape="rect" class="external-link" href="http://foo.com/bar.rnc" rel="nofollow">http://foo.com/bar.rnc</a></td><td colspan="1" rowspan="1" class="confluenceTd"><p>References the RelaxNG Compact Syntax file from the URL,</p><a shape="rect" class="external-link" href="http://foo.com/bar.rnc" rel="nofollow">http://foo.com/bar.rnc</a></td></tr></tbody></table>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-URIformatCamel2.16">URI format Camel 2.16</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">jing:someLocalOrRemoteResource</script> 
 </div>
</div><p>From Camel 2.16 the component use jing as name, and you can use the option compactSyntax to turn on either RNG or RNC mode.</p><h3 id="BookInOnePage-Options.48">Options</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>compactSyntax</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether to validate using RelaxNG compact syntax or not.</p></td></tr></tbody></table>
</div><h3 id="BookInOnePage-Example.22">Example</h3><p>The following <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-jing/src/test/resources/org/apache/camel/component/validator/jing/rnc-context.xml">example</a> shows how to configure a route from the endpoint <strong>direct:start</strong> which then goes to one of two endpoints, either <strong>mock:valid</strong> or <strong>mock:invalid</strong> based on whether or not the XML matches the given <a shape="rect" class="external-link" href="http://relaxng.org/compact-tutorial-20030326.html" rel="nofollow">RelaxNG Compact Syntax</a> schema (which is supplied on the classpath).</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;doTry&amp;gt; &amp;lt;to uri=&amp;quot;jing:org/apache/camel/component/validator/jing/schema.rnc?compactSyntax=true&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:valid&amp;quot;/&amp;gt; &amp;lt;doCatch&amp;gt; &amp;lt;exception&amp;gt;org.apache.camel.ValidationException&amp;lt;/exception&amp;gt; &amp;lt;to uri=&amp;quot;mock:invalid&amp;quot;/&amp;gt; &amp;lt;/doCatch&amp;gt; &amp;lt;doFinally&amp;gt; &amp;lt;to uri=&amp;quot;mock:finally&amp;quot;/&amp;gt; &amp;lt;/doFinally&amp;gt; &amp;lt;/doTry&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.51">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-JMSComponent">JMS Component</h2><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Using ActiveMQ</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>If you are using <a shape="rect" class="external-link" href="http://activemq.apache.org/">Apache ActiveMQ</a>, you should prefer the <a shape="rect" href="activemq.html">ActiveMQ</a> component as it has been optimized for <a shape="rect" href="activemq.html">ActiveMQ</a>. All of the options and samples on this page are also valid for the <a shape="rect" href="activemq.html">ActiveMQ</a> component.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Transacted and caching</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>See section <em>Transactions and Cache Levels</em> below if you are using transactions with <a shape="rect" href="jms.html">JMS</a> as it can impact performance.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Request/Reply over JMS</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Make sure to read the section <em>Request-reply over JMS</em> further below on this page for important notes about request/reply, as Camel offers a number of options to configure for performance, and clustered environments.</p>
 </div>
</div><p>This&#160;component allows messages to be sent to (or consumed from) a <a shape="rect" class="external-link" href="http://java.sun.com/products/jms/" rel="nofollow">JMS</a> Queue or Topic. It uses Spring's JMS support for declarative transactions, including Spring's <strong><code>JmsTemplate</code></strong> for sending and a <strong><code>MessageListenerContainer</code></strong> for consuming.</p><p>Maven users will need to add the following dependency to their <strong><code>pom.xml</code></strong> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-jms&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIFormat.3">URI Format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">jms:[queue:|topic:]destinationName[?options] </script> 
 </div>
</div><p>Where <strong><code>destinationName</code></strong> is a JMS queue or topic name. By default, the <strong><code>destinationName</code></strong> is interpreted as a queue name. For example, to connect to the queue, <strong><code>FOO.BAR</code></strong> use:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">jms:FOO.BAR </script> 
 </div>
</div><p>You can include the optional <strong><code>queue:</code></strong> prefix, if you prefer:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">jms:queue:FOO.BAR </script> 
 </div>
</div><p>To connect to a topic, you <em>must</em> include the <strong><code>topic:</code></strong> prefix. For example, to connect to the topic, <strong><code>Stocks.Prices</code></strong>, use:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">jms:topic:Stocks.Prices </script> 
 </div>
</div><p>You append query options to the URI using the following format: <strong><code>?option=value&amp;option=value&amp;...</code></strong></p><h3 id="BookInOnePage-Notes">Notes</h3><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Using ActiveMQ</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The JMS component reuses Spring 2's <strong><code>JmsTemplate</code></strong> for sending messages. This is not ideal for use in a non-J2EE container and typically requires some caching in the JMS provider to avoid <a shape="rect" class="external-link" href="http://activemq.apache.org/jmstemplate-gotchas.html">poor performance</a>.</p>
  <p>If you intend to use <a shape="rect" class="external-link" href="http://activemq.apache.org/">Apache ActiveMQ</a> as your Message Broker - which is a good choice as ActiveMQ rocks <img class="emoticon emoticon-smile" src="https://cwiki.apache.org/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/icons/emoticons/smile.png" data-emoticon-name="smile" alt="(smile)"> , then we recommend that you either:</p>
  <ul><li><p>Use the <a shape="rect" href="activemq.html">ActiveMQ</a> component, which is already optimized to use ActiveMQ efficiently</p></li><li><p>Use the <strong><code>PoolingConnectionFactory</code></strong> in ActiveMQ</p></li></ul>
 </div>
</div><h4 id="BookInOnePage-TransactionsandCacheLevels">Transactions and Cache Levels</h4><p><span class="confluence-anchor-link" id="BookInOnePage-transactionCacheLevels"></span><br clear="none"> If you are consuming messages and using transactions (<strong><code>transacted=true</code></strong>) then the default cache level can negatively impact performance. If you are using XA transactions then you cannot cache as it can cause the XA transaction to not work properly.</p><p>If you are <em>not</em> using XA, then you should consider caching as it speeds up performance, such as setting <strong><code>cacheLevelName=CACHE_CONSUMER</code></strong>. Through Camel 2.7.x, the default setting for <strong><code>cacheLevelName</code></strong> is <strong><code>CACHE_CONSUMER</code></strong>. You will need to explicitly set <strong><code>cacheLevelName=CACHE_NONE</code></strong>. In Camel 2.8 onward, the default setting for <strong><code>cacheLevelName</code></strong> is <strong><code>CACHE_AUTO</code></strong>. This default auto detects the mode and sets the cache level accordingly to:</p><ul class="alternate"><li><p><strong><code>CACHE_CONSUMER</code></strong> when&#160;<strong><code>transacted=false</code></strong></p></li><li><p><strong><code>CACHE_NONE</code></strong> when&#160;<strong><code>transacted=true</code></strong></p></li></ul><p>So you can say the default setting is conservative. Consider using <strong><code>cacheLevelName=CACHE_CONSUMER</code></strong> if you are using non-XA transactions.</p><h4 id="BookInOnePage-DurableSubscriptions">Durable Subscriptions</h4><p>If you wish to use durable topic subscriptions, you need to specify both&#160;<strong><code>clientId</code></strong>&#160; and <strong><code>durableSubscriptionName</code>. </strong>The value of the<strong> <code>clientId</code></strong> must be unique and can only be used by a single JMS connection instance in your entire network. You may prefer to use <a shape="rect" class="external-link" href="http://activemq.apache.org/virtual-destinations.html">Virtual Topics</a> instead to avoid this limitation. More background on durable messaging <a shape="rect" class="external-link" href="http://activemq.apache.org/how-do-durable-queues-and-topics-work.html">here</a>.</p><h4 id="BookInOnePage-MessageHeaderMapping">Message Header Mapping</h4><p>When using message headers, the JMS specification states that header names must be valid Java identifiers. So try to name your headers to be valid Java identifiers. One benefit of doing this is that you can then use your headers inside a JMS Selector (whose SQL92 syntax mandates Java identifier syntax for headers).</p><p>A simple strategy for mapping header names is used by default. The strategy is to replace any dots and hyphens in the header name as shown below and to reverse the replacement when the header name is restored from a JMS message sent over the wire. What does this mean? No more losing method names to invoke on a bean component, no more losing the filename header for the File Component, and so on.</p><p>The current header name strategy for accepting header names in Camel is:</p><ul class="alternate"><li><p>Dots are replaced by <strong><code>_DOT_</code></strong> and the replacement is reversed when Camel consume the message</p></li><li><p>Hyphen is replaced by <strong><code>_HYPHEN_</code></strong> and the replacement is reversed when Camel consumes the message</p></li></ul><h3 id="BookInOnePage-ConfigurationOptions">Configuration Options</h3><p>You can configure many different properties on the JMS endpoint which map to properties on the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-jms/apidocs/org/apache/camel/component/jms/JmsConfiguration.html">JMSConfiguration POJO</a>.</p><div class="confluence-information-macro confluence-information-macro-note">
 <p class="title">Mapping to Spring JMS</p>
 <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Many of these properties map to properties on Spring JMS, which Camel uses for sending and receiving messages. Therefore for more information about these properties consult the Spring documentation.</p>
 </div>
</div><p>The options are divided into two tables, the first one contains the most common options. The second table contains the less common and more advanced options.</p><h4 id="BookInOnePage-CommonOptions">Common Options</h4><p>&#160;</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>clientId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sets the JMS client ID to use. Note that this value, if specified, must be unique and can only be used by a single JMS connection instance. It is typically only required for durable topic subscriptions. You may prefer to use <a shape="rect" class="external-link" href="http://activemq.apache.org/virtual-destinations.html">Virtual Topics</a> instead.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>concurrentConsumers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the default number of concurrent consumers.</p><p>From <strong>Camel 2.10.3</strong>: this option can also be used when doing request/reply over JMS.</p><p>From <strong>Camel 2.16</strong>: there is a new <strong><code>replyToConcurrentConsumers</code></strong>.</p><p>See the <strong><code>maxMessagesPerTask</code></strong> option to control dynamic scaling up/down of threads.</p><p>When using ActiveMQ beware that the default prefetch policy loads 1000 messages per consumer. See <a shape="rect" class="external-link" href="http://activemq.apache.org/what-is-the-prefetch-limit-for.html">What is the prefetch limit</a> on how to change this.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>disableReplyTo</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>When <strong><code>true</code></strong>, a producer will behave like a&#160;<strong><code>InOnly</code></strong> exchange with the exception that <strong><code>JMSReplyTo</code></strong> header is sent out and not be suppressed like in the case of <strong><code>InOnly</code></strong>. Like <strong><code>InOnly</code></strong> the producer will not wait for a reply. A consumer with this flag will behave like <strong><code>InOnly</code></strong>. This feature can be used to bridge <strong><code>InOut</code></strong> requests to another queue so that a route on the other queue will send it&#180;s response directly back to the original <strong><code>JMSReplyTo</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>durableSubscriptionName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The durable subscriber name for specifying durable topic subscriptions. The <strong><code>clientId</code></strong> option <strong>must</strong> be configured as well.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxConcurrentConsumers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the maximum number of concurrent consumers.</p><p>From <strong>Camel 2.10.3</strong>: this option can also be used when doing request/reply over JMS. <span>&#160;</span></p><p><span>From </span><strong>Camel 2.16</strong><span>: there is a new <strong><code>replyToMaxConcurrentConsumers</code></strong>. </span></p><p>See also the <strong><code>maxMessagesPerTask</code></strong> option to control dynamic scaling up/down of threads.</p><p>The <strong><code>maxMessagesPerTask</code></strong><span> option <em>must</em> be set to an integer greater than&#160;<strong><code>0</code></strong> for threads to scale down. Otherwise, the number of threads will remain at <span><strong><code>maxConcurrentConsumers</code></strong> until shutdown.</span></span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxMessagesPerTask</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>-1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The number of messages a task can receive after which it's terminated. The default, <strong><code>-1</code></strong>, is unlimited.</p><p>If you use a range for concurrent consumers e.g.,&#160;<strong><code>concurrentConsumers</code></strong>&#160;<code>&lt;</code> <strong><code>maxConcurrentConsumers</code></strong> then this option can be used to set a value to e.g., <strong><code>100</code></strong> to control how fast the consumers will shrink when less work is required.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>preserveMessageQos</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Set to <strong><code>true</code></strong>, if you want to send message using the QoS settings specified on the message, instead of the QoS settings on the JMS endpoint. The following headers are considered:</p> 
      <ul><li><strong><code>JMSPriority</code></strong></li><li><strong><code>JMSDeliveryMode</code></strong></li><li><strong><code>JMSExpiration</code></strong>.</li></ul><p>You can provide some or all of them.</p><p>If not provided, Camel will fall back to use the values from the endpoint instead. So, when using this option, the headers override the values from the endpoint.</p><p>The <strong><code>explicitQosEnabled</code></strong> option, by contrast, will only use options set on the endpoint, and not values from the message header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>replyTo</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Provides an explicit&#160;<strong><code>ReplyTo</code></strong> destination, which overrides any incoming value of <strong><code>Message.getJMSReplyTo()</code></strong>.</p><p>If you do <a shape="rect" href="request-reply.html">Request Reply</a> over JMS then <strong>make sure</strong> to read the section <em>Request-reply over JMS</em> further below for more details, and the <strong><code>replyToType</code></strong> option as well.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>replyToConcurrentConsumers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16</strong>: Specifies the default number of concurrent consumers when doing request/reply over JMS.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>replyToMaxConcurrentConsumers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16</strong>: Specifies the maximum number of concurrent consumers when doing request/reply over JMS.</p><p>See the&#160;<strong><code>maxMessagesPerTask</code></strong> option to control dynamic scaling up/down of threads.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>replyToOnTimeoutMaxConcurrentConsumers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17.2</strong>: Specifies the maximum number of concurrent consumers for continue routing when timeout occurred when using request/reply over JMS.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>replyToOverride</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.15:</strong> Provides an explicit&#160;<strong><code>ReplyTo</code></strong> destination in the JMS message, which overrides the setting of <strong><code>ReplyTo</code></strong>. It is useful if you want to forward the message to a remote Queue and receive the reply message from the&#160;<strong><code>ReplyTo</code></strong> destination.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>replyToType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> Allows for explicitly specifying which kind of strategy to use for&#160;<strong><code>replyTo</code></strong> queues when doing request/reply over JMS. Possible values are:</p> 
      <ul><li><strong><code>Temporary</code></strong></li><li><strong><code>Shared</code></strong></li><li><strong><code>Exclusive</code></strong></li></ul><p>By default Camel will use&#160;<strong><code>Temporary</code></strong> queues.</p><p>However if <strong><code>replyTo</code></strong> has been configured, then <strong><code>Shared</code></strong> is used by default. This option allows you to use exclusive queues instead of shared queues.</p><p>For more details see below, and especially the notes about the implications if running in a clustered environment, and the fact that <strong><code>Shared</code></strong> reply queues has lower performance than its alternatives <strong><code>Temporary</code></strong> and <strong><code>Exclusive</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>requestTimeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>20000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Producer only:</strong> The timeout for waiting for a reply when using the&#160;<strong><code>InOut</code></strong> <a shape="rect" href="exchange-pattern.html">Exchange Pattern</a> (in milliseconds).</p><p>From <strong>Camel 2.13/2.12.3</strong>: you can include the header <strong><code>CamelJmsRequestTimeout</code></strong> to override this endpoint configured timeout value, and thus have per message individual timeout values.</p><p>See below in section <em>About time to live</em> for more details. See also the&#160;<strong><code>requestTimeoutCheckerInterval</code></strong> option.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>selector</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sets the JMS Selector, which is an SQL 92 predicate that is used to filter messages within the broker. You may have to encode special characters like '<strong><code>='</code></strong> as&#160;<strong><code>%3D</code></strong>.</p><p>Before<strong> Camel 2.3.0</strong>: this option was not supported in&#160;<strong><code>CamelConsumerTemplate</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>timeToLive</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>When sending messages, specifies the time-to-live of the message (in milliseconds).</p><p>See below in section <em>About time to live</em> for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transacted</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies whether to use transacted mode for sending/receiving messages using the&#160;<strong><code>InOnly</code></strong> <a shape="rect" href="exchange-pattern.html">Exchange Pattern</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>testConnectionOnStartup</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.1:</strong> Specifies whether to test the connection on startup. This ensures that when Camel starts that all the JMS consumers have a valid connection to the JMS broker. If a connection cannot be granted then Camel throws an exception on startup. This ensures that Camel is not started with failed connections.</p><p>From <strong>Camel 2.8</strong>: also the JMS producers is tested as well.</p></td></tr></tbody></table> 
 </div>
 <h4 id="BookInOnePage-AdvancedOptions">Advanced Options</h4>
 <div class="confluenceTableSmall">
   &#160; 
 </div>
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>acceptMessagesWhileStopping</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies whether the consumer accept messages while it is stopping.</p><p>You may consider enabling this option, if you start and stop <a shape="rect" href="jms.html">JMS</a> routes at run-time, while there are still messages enqueued on the queue. If this option is <strong><code>false</code></strong>, and you stop the <a shape="rect" href="jms.html">JMS</a> route, then messages may be rejected, and the JMS broker would have to attempt re-deliveries, which yet again may be rejected, and eventually the message may be moved at a dead letter queue on the JMS broker. To avoid this scenario it's recommended this option be set to <strong><code>true</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>acknowledgementModeName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>AUTO_ACKNOWLEDGE</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The JMS acknowledgement name, which is one of:</p> 
      <ul><li><strong><code>SESSION_TRANSACTED</code></strong></li><li><strong><code>CLIENT_ACKNOWLEDGE</code></strong></li><li><strong><code>AUTO_ACKNOWLEDGE</code></strong></li><li><strong><code>DUPS_OK_ACKNOWLEDGE</code></strong>.</li></ul></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>acknowledgementMode</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>-1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The JMS acknowledgement mode defined as an Integer. Allows you to set vendor-specific extensions to the acknowledgment mode. For the regular modes, it is preferable to use the <strong><code>acknowledgementModeName</code></strong> instead.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>allowNullBody</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.3/2.10.1:</strong> Whether to allow sending messages with no body. If this option is <code>false</code> and the message body is null, then an <strong><code>JMSException</code></strong> is thrown.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>allowReplyManagerQuickStop</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether the&#160;<strong><code>DefaultMessageListenerContainer</code></strong> used in the reply managers for request-reply messaging allow the&#160;<strong><code>DefaultMessageListenerContainer.runningAllowed</code></strong> flag to quick stop in case link&#160;<strong><code>JmsConfigurationisAcceptMessagesWhileStopping()</code></strong> is enabled and CamelContext is currently being stopped. This quick stop ability is enabled by default in the regular JMS consumers but to enable for reply managers you must enable this flag.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>alwaysCopyMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If <strong><code>true</code></strong>, Camel will always make a JMS message copy of the message when it is passed to the producer for sending. Copying the message is needed in some situations, such as when a <strong><code>replyToDestinationSelectorName</code></strong> is set.</p><p>Camel will set the <strong><code>alwaysCopyMessage=true</code></strong>, if a <strong><code>replyToDestinationSelectorName</code></strong> is set.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>asyncConsumer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> Whether the <strong><code>JmsConsumer</code></strong> processes the <a shape="rect" href="exchange.html">Exchange</a> <a shape="rect" href="asynchronous-routing-engine.html">asynchronously</a>. If enabled then the <strong><code>JmsConsumer</code></strong> may pickup the next message from the JMS queue, while the previous message is being processed asynchronously (by the <a shape="rect" href="asynchronous-routing-engine.html">Asynchronous Routing Engine</a>). This means that messages may be processed not 100% strictly in order. If disabled (as default) then the <a shape="rect" href="exchange.html">Exchange</a> is fully processed before the <strong><code>JmsConsumer</code></strong> will pickup the next message from the JMS queue.</p><p><strong>Note</strong>: if <strong><code>transacted</code></strong> has been enabled, then <strong><code>asyncConsumer=true</code></strong> does not run asynchronously, as transactions must be executed synchronously (Camel 3.0 may support asynchronous transactions).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>asyncStartListener</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Whether to startup the <strong><code>JmsConsumer</code></strong> message listener asynchronously, when starting a route. For example if a <strong><code>JmsConsumer</code></strong> cannot get a connection to a remote JMS broker, then it may block while retrying and/or failover. This will cause Camel to block while starting routes. By setting this option to <code>true</code>, you will let routes startup, while the <strong><code>JmsConsumer</code></strong> connects to the JMS broker using a dedicated thread in asynchronous mode. If this option is used, then beware that if the connection could not be established, then an exception is logged at <code>WARN</code> level, and the consumer will not be able to receive messages. You can then restart the route to retry.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>asyncStopListener</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Whether to stop the <strong><code>JmsConsumer</code></strong> message listener asynchronously, when stopping a route.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>autoStartup</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies whether the consumer container should auto-startup.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cacheLevel</code></p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sets the cache level by ID for the underlying JMS resources. See&#160;<strong><code>cacheLevelName</code></strong> option for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cacheLevelName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"> 
      <ul><li><p><code>CACHE_AUTO</code>&#160;(Camel &gt;= 2.8.0)<code> <br clear="none"></code></p></li><li><p><code>CACHE_CONSUMER </code>(Camel &lt;= 2.7.1)</p></li></ul></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sets the cache level by name for the underlying JMS resources. Valid values are:</p> 
      <ul><li><strong><code><strong><code>CACHE_NONE</code></strong></code></strong></li><li><strong><code>CACHE_CONNECTION</code></strong></li><li><strong><code>CACHE_SESSION</code></strong></li><li><strong><code>CACHE_CONSUMER</code></strong></li><li><strong><code>CACHE_AUTO</code></strong></li></ul><p>From <strong>Camel 2.8</strong>: the default is <strong><code>CACHE_AUTO</code></strong>.</p><p>For <strong>Camel 2.7.1</strong> and older the default is <strong><code>CACHE_CONSUMER</code></strong>.</p><p>See the <a shape="rect" class="external-link" href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/jms/listener/DefaultMessageListenerContainer.html" rel="nofollow">Spring documentation</a> and <a shape="rect" href="#BookInOnePage-transactionCacheLevels">Transactions Cache Levels</a> for more information.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>connectionFactory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The default JMS connection factory to use for the&#160;<strong><code>listenerConnectionFactory</code></strong> and <strong><code>templateConnectionFactory</code></strong>, if neither is specified.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumerType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Default</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Spring JMS listener type to use. A valid value is one of: <strong><code>Simple</code>, <code>Default</code></strong> or <strong><code>Custom</code></strong>.</p> 
      <div class="table-wrap"> 
       <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p><code>consumerType</code></p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Spring JMS Listener Type</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Default</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong><code>org.springframework.jms.listener.DefaultMessageListenerContainer</code></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Simple</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong><code>org.springframework.jms.listener.SimpleMessageListenerContainer</code></strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Custom</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>From <strong>Camel 2.10.2</strong>: The <strong><code>MessageListenerContainerFactory</code></strong> defined by the <strong><code>messageListenerContainerFactoryRef</code></strong> option which will determine what <strong><code>org.springframework.jms.listener.AbstractMessageListenerContainer </code></strong>to use.</p></td></tr></tbody></table> 
      </div><p>This option was temporarily removed in Camel 2.7 and 2.8 but was re-added in Camel 2.9.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>defaultTaskExecutorType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>SimpleAsync</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.4:</strong> Specifies what default&#160;<strong><code>TaskExecutor</code></strong> type to use in the <strong><code>DefaultMessageListenerContainer</code></strong>, for both consumer endpoints and the&#160;<strong><code>ReplyTo</code></strong> consumer of producer endpoints. Possible values: <strong><code>SimpleAsync</code></strong> (uses Spring's <a shape="rect" class="external-link" href="http://static.springsource.org/spring/docs/current/javadoc-api/org/springframework/core/task/SimpleAsyncTaskExecutor.html" rel="nofollow">SimpleAsyncTaskExecutor</a>) or <strong><code>ThreadPool</code></strong> (uses Spring's <a shape="rect" class="external-link" href="http://static.springsource.org/spring/docs/current/javadoc-api/org/springframework/scheduling/concurrent/ThreadPoolTaskExecutor.html" rel="nofollow">ThreadPoolTaskExecutor</a> with optimal values - cached threadpool-like).</p><p>If not set, it defaults to the previous behavior, which uses a cached thread pool for consumer endpoints and&#160;<strong><code>SimpleAsync</code></strong> for reply consumers.</p><p>The use of <strong><code>ThreadPool</code></strong> is recommended to reduce "thread trash" in elastic configurations with dynamically increasing and decreasing concurrent consumers.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>deliveryMode</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12.2/2.13:</strong> Specifies the delivery mode to be used. Possibles values are those defined by <strong><code>javax.jms.DeliveryMode</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>deliveryPersistent</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies whether persistent delivery is used by default.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>destination</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the JMS Destination object to use on this endpoint.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>destinationName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the JMS destination name to use on this endpoint.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>destinationResolver</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A pluggable <strong><code>org.springframework.jms.support.destination.DestinationResolver</code></strong> that allows you to use your own resolver (for example, to lookup the real destination in a JNDI registry).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>disableTimeToLive</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> Use this option to force disabling time to live. For example when you do request/reply over JMS, then Camel will by default use the <strong><code>requestTimeout</code></strong> value as time to live on the message being sent. The problem is that the sender and receiver systems have to have their clocks synchronized, so they are in sync. This is not always so easy to archive. So you can use <strong><code>disableTimeToLive=true</code></strong> to <strong>not</strong> set a time to live value on the sent message. Then the message will not expire on the receiver system.</p><p>See below in section <em>About time to live</em> for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>eagerLoadingOfProperties</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Enables eager loading of JMS properties as soon as a message is received, which is generally inefficient, because the JMS properties might not be required. But this feature can sometimes catch early any issues with the underlying JMS provider and the use of JMS properties. This feature can also be used for testing purposes, to ensure JMS properties can be understood and handled correctly.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>errorHandler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8.2, 2.9:</strong> Specifies a <strong><code>org.springframework.util.ErrorHandler</code></strong> to be invoked in case of any uncaught exceptions thrown while processing a <strong><code>Message</code></strong>.</p><p>By default these exceptions will be logged at the&#160;<strong><code>WARN</code></strong> level, if no <strong><code>errorHandler</code></strong> has been configured.</p><p>From <strong>Camel 2.9.1</strong>: you can configure logging level and whether stack traces should be logged using the below two options. This makes it much easier to configure, than having to code a custom <strong><code>errorHandler</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>errorHandlerLoggingLevel</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>WARN</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.1:</strong> Configures the logging level at which the <strong><code>errorHandler</code></strong> will log uncaught exceptions.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>errorHandlerLogStackTrace</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.1:</strong> Controls whether a stacktrace should be logged by the default <strong><code>errorHandler</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exceptionListener</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the JMS Exception Listener that is to be notified of any underlying JMS exceptions.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>explicitQosEnabled</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Set if the <strong><code>deliveryMode</code>, <code>priority</code></strong> or <strong><code>timeToLive</code></strong> qualities of service should be used when sending messages. This option is based on Spring's <strong><code>JmsTemplate</code></strong>. The <strong><code>deliveryMode</code>, <code>priority</code></strong> and <strong><code>timeToLive</code></strong> options are applied to the current endpoint. This contrasts with the <strong><code>preserveMessageQos</code></strong> option, which operates at message granularity, reading QoS properties exclusively from the Camel In message headers.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exposeListenerSession</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies whether the listener session should be exposed when consuming messages.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>forceSendOriginalMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.7:</strong> When using <strong><code>mapJmsMessage=false</code></strong> Camel will create a new JMS message to send to a new JMS destination if you touch the headers (get or set) during the route. Set this option to <strong><code>true</code></strong> to force Camel to send the original JMS message that was received.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>idleConsumerLimit</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8.2</strong>, <strong>2.9</strong>: Specify the limit for the number of consumers that are allowed to be idle at any given time.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>idleTaskExecutionLimit</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the limit for idle executions of a receive task, not having received any message within its execution. If this limit is reached, the task will shut down and leave receiving to other executing tasks (in the case of dynamic scheduling; see the <strong><code>maxConcurrentConsumers</code></strong> setting). There is additional doc available from <a shape="rect" class="external-link" href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/jms/listener/DefaultMessageListenerContainer.html#setIdleTaskExecutionLimit-int-" rel="nofollow">Spring</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>includeSentJMSMessageID</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.3:</strong> Only applicable when sending to JMS destination using&#160;<strong><code>InOnly</code></strong>, e.g., fire and forget. Enabling this option will enrich the Camel <a shape="rect" href="exchange.html">Exchange</a> with the actual&#160;<strong><code>JMSMessageID</code></strong> that was used by the JMS client when the message was sent to the JMS destination.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>includeAllJMSXProperties</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.2/2.12:</strong> Whether to include all&#160;<strong><code>JMSXxxx</code></strong> properties when mapping from JMS to Camel Message. When set to <code>true</code> properties such as <strong><code>JMSXAppID</code></strong>, and <strong><code>JMSXUserID</code></strong> etc will be included.</p><p><strong>Note:</strong> If you are using a custom <strong><code>headerFilterStrategy</code></strong> then this option does not apply.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>jmsKeyFormatStrategy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>default</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Pluggable strategy for encoding and decoding JMS keys so they can be compliant with the JMS specification.</p> 
      <div class="table-wrap"> 
       <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Strategy</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>default</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Safely marshals dots and hyphens, <code>'<strong>.</strong>'</code> and&#160;<code>'<strong>-</strong>'</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>passthrough</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Leaves the key as is. Appropriate for use with any JMS broker that tolerates JMS header keys containing illegal characters.</p></td></tr></tbody></table> 
      </div><p><strong>Note</strong>: optionally, a custom implementation can be provided of a <strong><code>org.apache.camel.component.jms.JmsKeyFormatStrategy</code></strong> and referred to using the <strong><code>#</code></strong> notation.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>jmsMessageType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Allows you to force the use of a specific&#160;<strong><code>javax.jms.Message</code></strong> implementation for sending JMS messages. Possible values are:</p> 
      <ul><li><strong><code>Bytes</code></strong></li><li><strong><code>Map</code></strong></li><li><strong><code>Object</code></strong></li><li><strong><code>Stream</code></strong></li><li><strong><code>Text</code></strong></li></ul><p>By default Camel determines which JMS message type to use for the&#160;<strong><code>In</code></strong> body type. This option will override the default behavior.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>jmsOperations</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Allows you to use your own implementation of the <strong><code>org.springframework.jms.core.JmsOperations</code></strong> interface. Camel uses <strong><code>JmsTemplate</code></strong> by default. Can be used for testing purpose, but not used much as stated in the spring API docs.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>lazyCreateTransactionManager</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If <strong><code>true</code></strong>, Camel will create a <strong><code>JmsTransactionManager</code></strong>, if there is no <strong><code>transactionManager</code></strong> injected when option <strong><code>transacted=true</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>listenerConnectionFactory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The JMS connection factory used for consuming messages.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>mapJmsMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies whether Camel should auto map the received JMS message to an appropriate payload type, such as <strong><code>javax.jms.TextMessage</code></strong> to a&#160;<strong><code>java.lang.</code><code>String</code></strong> etc. See below for more details on how message type mapping works.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maximumBrowseSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>-1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Limits the number of messages fetched at most, when browsing endpoints using <a shape="rect" href="browse.html">Browse</a> or JMX API.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>messageConverter</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To use a custom Spring <strong><code>org.springframework.jms.support.converter.MessageConverter</code></strong> so you can be 100% in control how to map to/from a <strong><code>javax.jms.Message</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>messageIdEnabled</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>When sending, specifies whether message IDs should be added.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>messageListenerContainerFactoryRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.2:</strong> Registry ID of the <strong><code>MessageListenerContainerFactory</code></strong> used to determine what <strong><code>org.springframework.jms.listener.AbstractMessageListenerContainer</code></strong> to use to consume messages.</p><p>Setting this will automatically set <strong><code>consumerType</code></strong> to <strong><code>Custom</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>messageTimestampEnabled</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies whether time-stamps should be enabled by default on sending messages.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>password</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The password for the connector factory.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>priority</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>4</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Values greater than&#160;<strong><code>1</code></strong> specify the message priority when sending (where&#160;<strong><code>0</code></strong> is the lowest priority and&#160;<strong><code>9</code></strong> is the highest). The <strong><code>explicitQosEnabled</code></strong> option <em>must</em> also be enabled in order for this option to have any effect.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>pubSubNoLocal</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies whether to inhibit the delivery of messages published by its own connection.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>receiveTimeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The timeout for receiving messages (in milliseconds).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>recoveryInterval</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>5000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the interval between recovery attempts, e.g., when a connection is being refreshed, in milliseconds. The default is <code><strong>5000</strong> ms</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>replyToSameDestinationAllowed</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16:</strong> <strong>Consumer only:</strong> Whether a JMS consumer is allowed to send a reply message to the same destination that the consumer is using to consume from. This prevents an endless loop by consuming and sending back the same message to itself.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>replyToCacheLevelName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CACHE_CONSUMER</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.1:</strong> Sets the cache level by name for the reply consumer when doing request/reply over JMS. This option only applies when using fixed reply queues (not temporary). Camel will by default use: <strong><code>CACHE_CONSUMER</code></strong> for exclusive or shared w/<strong><code>replyToSelectorName</code></strong> and <strong><code>CACHE_SESSION</code></strong> for shared without <strong><code>replyToSelectorName</code></strong>. Some JMS brokers such as IBM WebSphere may require this parameter to be set to <strong><code>CACHE_NONE</code></strong> in order to work.</p><p><strong>Note:</strong> The value <strong><code>CACHE_NONE</code></strong> cannot be used with temporary queues. A higher value, such as <strong><code>CACHE_CONSUMER</code></strong> or <strong><code>CACHE_SESSION</code></strong>, must be used.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>replyToDestinationSelectorName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sets the JMS Selector using the fixed name to be used so you can filter out your own replies from the others when using a shared queue (that is, if you are not using a temporary reply queue).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>replyToDeliveryPersistent</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies whether to use persistent delivery by default for replies.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>requestTimeoutCheckerInterval</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.2:</strong> Configures how often Camel should check for timed out <a shape="rect" href="exchange.html">Exchange</a>s when doing request/reply over JMS. By default Camel checks once per second. But if you must react faster when a timeout occurs, then you can lower this interval, to check more frequently. The timeout is determined by the option <strong><code>requestTimeout</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>subscriptionDurable</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>@deprecated:</strong> Enabled by default, if you specify a <strong><code>durableSubscriptionName</code></strong> and a <strong><code>clientId</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>taskExecutor</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Allows you to specify a custom task executor for consuming messages.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>taskExecutorSpring2</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.6:</strong> To use when using Spring 2.x with Camel. Allows you to specify a custom task executor for consuming messages.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>templateConnectionFactory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The JMS connection factory used for sending messages.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transactedInOut</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>@deprecated:</strong> Specifies whether to use transacted mode for sending messages using the&#160;<strong><code>InOut</code></strong> <a shape="rect" href="exchange-pattern.html">Exchange Pattern</a>. Applies only to producer endpoints. See section <a shape="rect" href="#BookInOnePage-transactedConsumption">Enabling Transacted Consumption</a> for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transactionManager</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Spring transaction manager to use.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transactionName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>"JmsConsumer[destinationName]"</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The name of the transaction to use.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transactionTimeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The timeout value of the transaction (in seconds), if using transacted mode.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transferException</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If enabled and you are using <a shape="rect" href="request-reply.html">Request Reply</a> messaging (<strong><code>InOut</code></strong>) and an <a shape="rect" href="exchange.html">Exchange</a> failed on the consumer side, then the caused <strong><code>Exception</code></strong> will be send back in response as a <strong><code>javax.jms.ObjectMessage</code></strong>. If the client is Camel, the returned <strong><code>Exception</code></strong> is re-thrown. This allows you to use Camel <a shape="rect" href="jms.html">JMS</a> as a bridge in your routing - for example, using persistent queues to enable robust routing. Notice that if you also have <strong><code>transferExchange</code></strong> enabled, this option takes precedence. The caught exception is required to be serializable. The original <strong><code>Exception</code></strong> on the consumer side can be wrapped in an outer exception such as <strong><code>org.apache.camel.RuntimeCamelException</code></strong> when returned to the producer.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transferExchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>You can transfer the exchange over the wire instead of just the body and headers. The following fields are transferred: In body, Out body, Fault body, In headers, Out headers, Fault headers, exchange properties, exchange exception. This requires that the objects are serializable. Camel will exclude any non-serializable objects and log it at&#160;<strong><code>WARN</code></strong> level.</p><p>You <em>must</em> enable this option on <em>both</em> the producer <em>and</em> the consumer side, so Camel will know that the payload is an Exchange and not a regular payload.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transferFault</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17:</strong> If enabled and you are using Request Reply messaging (<strong><code>InOut</code></strong>) and an Exchange failed with a SOAP fault (not exception) on the consumer side, then the fault flag on&#160;<strong><code>org.apache.camel.Message.isFault()</code></strong> will be send back in the response as a JMS header with the key <strong><code>JmsConstants.JMS_TRANSFER_FAULT</code></strong>. If the client is Camel, the returned fault flag will be set on the <strong><code>org.apache.camel.Message.setFault(boolean)</code></strong>.</p><p>You may want to enable this when using Camel components that support faults such as SOAP based such as CXF or spring-ws.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>username</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The username for the connector factory.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>useMessageIDAsCorrelationID</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies whether <strong><code>JMSMessageID</code></strong> should always be used as <strong><code>JMSCorrelationID</code></strong> for&#160;<strong><code>InOut</code></strong> messages.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>useVersion102</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>@deprecated (removed from Camel 2.5 onward)</strong> Specifies whether the old JMS API should be used.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-MessageMappingBetweenJMSandCamel">Message Mapping Between JMS and Camel</h3><p>Camel automatically maps messages between <strong><code>javax.jms.Message</code></strong> and <strong><code>org.apache.camel.Message</code></strong>. When sending a JMS message, Camel converts the message body to the following JMS message types:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Body Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>JMS Message</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Comment</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>byte[]</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>javax.jms.BytesMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>java.io.File</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>javax.jms.BytesMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>java.io.InputStream</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>javax.jms.BytesMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>java.io.Reader</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>javax.jms.BytesMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>java.io.Serializable</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>javax.jms.ObjectMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>java.nio.ByteBuffer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>javax.jms.BytesMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Map</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>javax.jms.MapMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.w3c.dom.Node</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>javax.jms.TextMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The DOM will be converted to <strong><code>String</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>javax.jms.TextMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td></tr></tbody></table> 
 </div>
</div><p>When receiving a JMS message, Camel converts the JMS message to the following body type:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>JMS Message</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Body Type</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>javax.jms.BytesMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>byte[]</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>javax.jms.MapMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Map&lt;String, Object&gt;</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>javax.jms.ObjectMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>javax.jms.TextMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-DisablingAuto-MappingofJMSMessages">Disabling Auto-Mapping of JMS Messages</h4><p>You can use the <strong><code>mapJmsMessage</code></strong> option to disable the auto-mapping above. If disabled, Camel will not try to map the received JMS message, but instead uses it directly as the payload. This allows you to avoid the overhead of mapping and let Camel just pass through the JMS message. For instance, it even allows you to route <strong><code>javax.jms.ObjectMessage</code></strong> JMS messages with classes you do <strong>not</strong> have on the classpath.</p><h4 id="BookInOnePage-UsingacustomMessageConverter">Using a custom MessageConverter</h4><p>You can use the <strong><code>messageConverter</code></strong> option to do the mapping yourself in a Spring <strong><code>org.springframework.jms.support.converter.MessageConverter</code></strong> class.</p><p>For example, in the route below we use a custom message converter when sending a message to the JMS order queue:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://inbox/order&amp;quot;) .to(&amp;quot;jms:queue:order?messageConverter=#myMessageConverter&amp;quot;); </script> 
 </div>
</div><p>You can also use a custom message converter when consuming from a JMS destination.</p><h4 id="BookInOnePage-ControllingtheMappingStrategySelected">Controlling the Mapping Strategy Selected</h4><p>You can use the&#160;<strong><code>jmsMessageType</code></strong> option on the endpoint URL to force a specific message type for all messages. In the route below, we poll files from a folder and send them as <strong><code>javax.jms.TextMessage</code></strong> as we have forced the JMS producer endpoint to use text messages:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://inbox/order&amp;quot;) .to(&amp;quot;jms:queue:order?jmsMessageType=Text&amp;quot;); </script> 
 </div>
</div><p>You can also specify the message type to use for each message by setting the header with the key <strong><code>CamelJmsMessageType</code></strong>. For example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://inbox/order&amp;quot;) .setHeader(&amp;quot;CamelJmsMessageType&amp;quot;, JmsMessageType.Text) .to(&amp;quot;jms:queue:order&amp;quot;); </script> 
 </div>
</div><p>The possible values are defined in the <code>enum</code> class <strong><code>org.apache.camel.jms.JmsMessageType</code></strong>.</p><h3 id="BookInOnePage-MessageFormatWhenSending">Message Format When Sending</h3><p>An exchange sent via JMS must conform to the <a shape="rect" class="external-link" href="http://java.sun.com/j2ee/1.4/docs/api/javax/jms/Message.html" rel="nofollow">JMS Message spec</a>. Camel therefore applies various translation and validation rules to both key names and key values of <strong><code>exchange.in.headers</code></strong>.</p><p>The following rules are applied to the <em>key names</em> of&#160;<strong><code>exchange.in.headers</code></strong>:</p><ul class="alternate"><li><p>Keys starting with <strong><code>JMS</code></strong> or&#160;<strong><code>JMSX</code></strong> are reserved.</p></li><li><p>Key names must be literals or valid Java identifiers.</p></li><li><p>Dot and hyphen characters are replaced (and the reverse when consuming) as follows:</p>
  <ul class="alternate"><li><p>The character <code>'<strong>.</strong>'</code> is replaced with the sequence <strong><code>_DOT_</code></strong>. The reverse replacement is applied when Camel consumes a message.&#160;</p></li><li><p>The character <code>'<strong>-</strong>'</code> is replaced with the sequence <strong><code>_HYPHEN_</code></strong>. The reverse replacement is applied when Camel consumes a message.</p></li></ul></li><li><p>The option <strong><code>jmsKeyFormatStrategy</code></strong> can be used to specify a custom key formatting strategy.</p></li></ul><p>The following rules are applied to the <em>key values</em> of <strong><code>exchange.in.headers</code></strong>:</p><ul class="alternate"><li><p>Values must be either a primitive type or of its corresponding Java object type, e.g., <strong><code>Integer</code></strong>,&#160;<strong><code>Long</code></strong> or <strong><code>Character</code></strong>.</p></li><li><p>The types <strong><code>String</code>, <code>CharSequence</code></strong>, <strong><code>Date</code>,&#160;<code>BigDecimal</code></strong> and&#160;<strong><code>BigInteger</code></strong> are all converted to their string representation.</p></li><li><p>All other types will result in the key value being discarded.</p></li></ul><p>If a header value is discarded Camel will log the incident using logging category <strong><code>org.apache.camel.component.jms.JmsBinding</code></strong> at the&#160;<strong><code>DEBUG</code></strong> logging level. For example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter">2008-07-09 06:43:04,046 [main ] DEBUG JmsBinding - Ignoring non primitive header: order of class: org.apache.camel.component.jms.issues.DummyOrder with value: DummyOrder{orderId=333, itemId=4444, quantity=2} </script> 
 </div>
</div><h3 id="BookInOnePage-MessageFormatWhenReceiving">Message Format When Receiving</h3><p>Camel adds the following properties to the <strong><code>Exchange</code></strong> when it receives a message:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Property</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.apache.camel.jms.replyDestination</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>javax.jms.Destination</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The reply destination.</p></td></tr></tbody></table> 
 </div>
</div><p>Camel adds the following JMS properties to the In message headers when it receives a JMS message:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>JMSCorrelationID</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The JMS correlation ID.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>JMSDeliveryMode</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>int</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The JMS delivery mode.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>JMSDestination</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>javax.jms.Destination</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The JMS destination.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>JMSExpiration</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>long</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The JMS expiration.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>JMSMessageID</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The JMS unique message ID.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>JMSPriority</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>int</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The JMS priority (with 0 as the lowest priority and 9 as the highest).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>JMSRedelivered</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Is the JMS message redelivered.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>JMSReplyTo</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>javax.jms.Destination</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The JMS reply-to destination.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>JMSTimestamp</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>long</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The JMS timestamp.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>JMSType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The JMS type.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>JMSXGroupID</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The JMS group ID.</p></td></tr></tbody></table> 
 </div>
</div><p>As all the above information is standard JMS you can check the <a shape="rect" class="external-link" href="http://java.sun.com/javaee/5/docs/api/javax/jms/Message.html" rel="nofollow">JMS documentation</a> for further details.</p><h3 id="BookInOnePage-UsingCameltoSendandReceiveMessagesUsingJMSReplyTo">Using Camel to Send and Receive Messages Using&#160;<code>JMSReplyTo</code></h3><p>The JMS component is complex and you have to pay close attention to how it works in some cases. So this is a short summary of some of the areas/pitfalls to look for.</p><p>When Camel sends a message using its <strong><code>JMSProducer</code></strong> it checks the following conditions:</p><ul class="alternate"><li><p>The message <a shape="rect" class="external-link" href="http://camel.apache.org/exchange-pattern.html">Exchange Pattern</a> (MEP)</p></li><li><p>Whether a <strong><code>JMSReplyTo</code></strong> was set in the endpoint or in the message headers</p></li><li><p>Whether any of the following options have been set on the JMS endpoint: <strong><code>disableReplyTo</code>,&#160;<code>preserveMessageQos</code></strong> or <strong><code>explicitQosEnabled</code>.</strong></p></li></ul><p>All this can be a tad complex to understand and configure to support your use case.</p><h4 id="BookInOnePage-JmsProducer">JmsProducer</h4><p>The <strong><code>JmsProducer</code></strong> behaves as follows, depending on configuration:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Exchange Pattern</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Other options</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>InOut</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>-</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Camel will expect a reply, set a temporary <strong><code>JMSReplyTo</code></strong>, and after sending the message, it will start to listen for the reply message on the temporary queue.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>InOut</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>JMSReplyTo</code> is set</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Camel will expect a reply and, after sending the message, it will start to listen for the reply message on the specified <strong><code>JMSReplyTo</code></strong> queue.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>InOnly</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>-</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Camel will send the message and <strong>not</strong> expect a reply.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>InOnly</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>JMSReplyTo</code> is set</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>By default, Camel discards the <strong><code>JMSReplyTo</code></strong> destination and clears the <strong><code>JMSReplyTo</code></strong> header before sending the message. Camel then sends the message and does <em>not</em> expect a reply. Camel logs this in the log at <strong><code>WARN</code></strong> level (changed to <strong><code>DEBUG</code></strong> level from <strong>Camel 2.6</strong> on). You can use <strong><code>preserveMessageQuo=true</code></strong> to instruct Camel to keep the <strong><code>JMSReplyTo</code></strong>.</p><p>In all situations the <strong><code>JmsProducer</code></strong> does <strong>not</strong> expect any reply and thus continue after sending the message.</p></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-JmsConsumer">JmsConsumer</h4><p>The <code>JmsConsumer</code> behaves as follows, depending on configuration:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Exchange Pattern</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Other options</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>InOut</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>-</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Camel will send the reply back to the <strong><code>JMSReplyTo</code></strong> queue.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>InOnly</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>-</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Camel will not send a reply back, as the pattern is <strong><code>InOnly</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>-</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>disableReplyTo=true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>This option suppresses replies.</p></td></tr></tbody></table> 
 </div>
</div><p>So pay attention to the message exchange pattern set on your exchanges.</p><p>If you send a message to a JMS destination in the middle of your route you can specify the exchange pattern to use, see more at <a shape="rect" href="request-reply.html">Request Reply</a>. This is useful if you want to send an <strong><code>InOnly</code></strong> message to a JMS topic:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:queue:in&amp;quot;) .to(&amp;quot;bean:validateOrder&amp;quot;) .to(ExchangePattern.InOnly, &amp;quot;activemq:topic:order&amp;quot;) .to(&amp;quot;bean:handleOrder&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-ComputingtheDestinationatRuntime">Computing the Destination at Runtime</h3><p>If you need to send messages to a lot of different JMS destinations, it makes sense to reuse a JMS endpoint and specify the real destination in a message header. This allows Camel to reuse the same endpoint, but send to different destinations. This greatly reduces the number of endpoints created and economizes on memory and thread resources.</p><p>You can specify the destination in the following headers:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelJmsDestination</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>javax.jms.Destination</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A destination object.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelJmsDestinationName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The destination name.</p></td></tr></tbody></table> 
 </div>
</div><p>For example, the following route shows how you can compute a destination at run time and use it to override the destination appearing in the JMS URL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://inbox&amp;quot;) .to(&amp;quot;bean:computeDestination&amp;quot;) .to(&amp;quot;activemq:queue:dummy&amp;quot;); </script> 
 </div>
</div><p>The queue name, <code>dummy</code>, is just a placeholder. It must be provided as part of the JMS endpoint URL, but it will be ignored in this example.</p><p>In the <strong><code>computeDestination</code></strong> bean, specify the real destination by setting the <strong><code>CamelJmsDestinationName</code></strong> header as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public void setJmsHeader(Exchange exchange) { String id = .... exchange.getIn().setHeader(&amp;quot;CamelJmsDestinationName&amp;quot;, &amp;quot;order:&amp;quot; + id&amp;quot;); } </script> 
 </div>
</div><p>Then Camel will read this header and use it as the destination instead of the one configured on the endpoint. So, in this example Camel sends the message to <strong><code>activemq:queue:order:2</code></strong>, assuming the <strong><code>id</code></strong> value was <strong><code>2</code></strong>.</p><p>If both the <code>CamelJmsDestination</code> and the <strong><code>CamelJmsDestinationName</code></strong> headers are set <strong><code>CamelJmsDestination</code></strong> will take priority. Note that the JMS producer removes both <strong><code>CamelJmsDestination</code></strong> and <strong><code>CamelJmsDestinationName</code></strong> headers from the exchange and does not propagate them to the created JMS message. This prevents accidental routing loops in scenarios where a message is forwarded to another JMS endpoint.</p><h3 id="BookInOnePage-ConfiguringDifferentJMSProviders">Configuring Different JMS Providers</h3><p>A JMS provider can be configured in <a shape="rect" href="spring.html">Spring</a> XML as follows:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext id=&amp;quot;camel&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;jmxAgent id=&amp;quot;agent&amp;quot; disabled=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;bean id=&amp;quot;activemq&amp;quot; class=&amp;quot;org.apache.activemq.camel.component.ActiveMQComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;connectionFactory&amp;quot;&amp;gt; &amp;lt;bean class=&amp;quot;org.apache.activemq.ActiveMQConnectionFactory&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;brokerURL&amp;quot; value=&amp;quot;vm://localhost?broker.persistent=false&amp;amp;amp;broker.useJmx=false&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;/bean&amp;gt; </script> 
  </div>
 </div>&#160;<p>An unlimited number of JMS component instance can be created provided each has a <em>unique value for its<strong>&#160;</strong></em><strong><code>id</code></strong> <em>attribute. The preceding example configures an activemq component. You could do the same to configure MQSeries, TibCo, BEA, Sonic etc.</em></p><p>Once named a JMS component can be referenced from an endpoint's URI. For example, given the component name <code>activemq</code> a URI can reference the component using the format <strong><code>activemq:[queue:|topic:]destinationName</code></strong>. The same approach applies to all JMS providers. This is achieved by the&#160;<strong><code>SpringCamelContext</code></strong> lazily fetching components from the spring context for the scheme name referenced in the <a shape="rect" href="endpoint.html">Endpoint</a> <a shape="rect" href="uris.html">URIs</a> then having the <a shape="rect" href="component.html">Component</a> resolve the endpoint URI itself.</p><h4 id="BookInOnePage-UsingJNDItoFindtheConnectionFactory">Using JNDI to Find the Connection Factory</h4><p>If you are using a J2EE container, you might need to look up JNDI to find the JMS <strong><code>connectionFactory</code></strong> rather than use the usual <strong><code>&lt;bean&gt;</code></strong> mechanism in Spring. You can do this using Spring's factory bean or the new Spring XML namespace. For example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;weblogic&amp;quot; class=&amp;quot;org.apache.camel.component.jms.JmsComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;myConnectionFactory&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;jee:jndi-lookup id=&amp;quot;myConnectionFactory&amp;quot; jndi-name=&amp;quot;jms/connectionFactory&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>See <a shape="rect" class="external-link" href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/xsd-config.html#xsd-config-body-schemas-jee" rel="nofollow">The jee schema</a> in the Spring reference documentation for more details about JNDI lookup.</p><h3 id="BookInOnePage-ConcurrentConsuming">Concurrent Consuming</h3><p>A common requirement with JMS is to consume messages concurrently in multiple threads in order to make an application more responsive. You can set the <strong><code>concurrentConsumers</code></strong> option to specify the number of threads servicing the JMS endpoint, as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;jms:SomeQueue?concurrentConsumers=20&amp;quot;) .bean(MyClass.class); </script> 
 </div>
</div><p>You can configure this option in one of the following ways:</p><ul><li><p>On the <strong><code>JmsComponent</code></strong></p></li><li><p>On the endpoint URI</p></li><li><p>By invoking <strong><code>setConcurrentConsumers()</code></strong> directly on the <strong><code>JmsEndpoint</code></strong>.</p></li></ul><h4 id="BookInOnePage-ConcurrentConsumingwithasyncConsumer">Concurrent Consuming with&#160;<code>asyncConsumer</code></h4><p>Notice that each concurrent consumer will only pickup the next available message from the JMS broker, when the current message has been fully processed. You can set the option <strong><code>asyncConsumer=true</code></strong> to let the consumer pickup the next message from the JMS queue, while the previous message is being processed asynchronously (by the <a shape="rect" href="asynchronous-routing-engine.html">Asynchronous Routing Engine</a>). See more details in the table on top of the page about the <strong><code>asyncConsumer</code></strong> option.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;jms:SomeQueue?concurrentConsumers=20&amp;amp;asyncConsumer=true&amp;quot;) .bean(MyClass.class); </script> 
 </div>
</div><h3 id="BookInOnePage-Request-ReplyoverJMS">Request-Reply over JMS</h3><p>Camel supports <a shape="rect" href="request-reply.html">Request Reply</a> over JMS. In essence the MEP of the Exchange should be <strong><code>InOut</code></strong> when you send a message to a JMS queue.</p><p>Camel offers a number of options to configure request/reply over JMS that influence performance and clustered environments. The table below summaries the options.</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Performance</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Cluster</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Temporary</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Fast</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Yes</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A temporary queue is used as reply queue, and automatic created by Camel. To use this do <strong>not</strong> specify a&#160;<strong><code>replyTo</code></strong> queue name. And you can optionally configure <strong><code>replyToType=Temporary</code></strong> to make it stand out that temporary queues are in use.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Shared</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Slow</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Yes</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A shared persistent queue is used as reply queue. The queue must be created beforehand, although some brokers can create them on the fly such as Apache ActiveMQ. To use this you must specify the&#160;<strong><code>replyTo</code></strong> queue name. And you can optionally configure <strong><code>replyToType=Shared</code></strong> to make it stand out that shared queues are in use. A shared queue can be used in a clustered environment with multiple nodes running this Camel application at the same time. All using the same shared reply queue. This is possible because JMS Message selectors are used to correlate expected reply messages; this impacts performance though. JMS Message selectors is slower, and therefore not as fast as <strong><code>Temporary</code></strong> or <strong><code>Exclusive</code></strong> queues. See further below how to tweak this for better performance.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Exclusive</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Fast</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No (*Yes)</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>An exclusive persistent queue is used as reply queue. The queue must be created beforehand, although some brokers can create them on the fly such as Apache ActiveMQ. To use this you must specify the replyTo queue name. And you <strong>must</strong> configure <strong><code>replyToType=Exclusive</code></strong> to instruct Camel to use exclusive queues, as <code>Shared</code> is used by default, if a <strong><code>replyTo</code></strong> queue name was configured. When using exclusive reply queues, then JMS Message selectors are <strong>not</strong> in use, and therefore other applications must not use this queue as well. An exclusive queue <strong>cannot</strong> be used in a clustered environment with multiple nodes running this Camel application at the same time; as we do not have control if the reply queue comes back to the same node that sent the request message; that is why shared queues use JMS Message selectors to make sure of this. <strong>Though</strong> if you configure each Exclusive reply queue with an unique name per node, then you can run this in a clustered environment. As then the reply message will be sent back to that queue for the given node, that awaits the reply message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>concurrentConsumers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Fast</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Yes</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.3:</strong> Allows to process reply messages concurrently using concurrent message listeners in use. You can specify a range using the <strong><code>concurrentConsumers</code></strong> and <strong><code>maxConcurrentConsumers</code></strong> options.</p><p><strong>Note:</strong> That using <code>Shared</code> reply queues may not work as well with concurrent listeners, so use this option with care.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxConcurrentConsumers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Fast</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Yes</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.3:</strong> Allows to process reply messages concurrently using concurrent message listeners in use. You can specify a range using the <strong><code>concurrentConsumers</code></strong> and <strong><code>maxConcurrentConsumers</code></strong> options.</p><p><strong>Note:</strong> That using <code>Shared</code> reply queues may not work as well with concurrent listeners, so use this option with care.</p></td></tr></tbody></table> 
 </div>
</div><p>The <strong><code>JmsProducer</code></strong> detects the <strong><code>InOut</code></strong> and provides a <strong><code>JMSReplyTo</code></strong> header with the reply destination to be used. By default Camel uses a temporary queue, but you can use the <strong><code>replyTo</code></strong> option on the endpoint to specify a fixed reply queue (see more below about fixed reply queue).</p><p>Camel will automatic setup a consumer which listen on the reply queue, so you should <strong>not</strong> do anything. This consumer is a Spring <strong><code>DefaultMessageListenerContainer</code></strong> which listen for replies. However it's fixed to&#160;<strong><code>1</code></strong> concurrent consumer. That means replies will be processed in sequence as there are only 1 thread to process the replies. If you want to process replies faster, then we need to use concurrency. But <strong>not</strong> using the <strong><code>concurrentConsumer</code></strong> option. We should use the <code>threads</code> from the Camel DSL instead, as shown in the route below:</p><div class="confluence-information-macro confluence-information-macro-tip">
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Instead of using threads, then use&#160;<strong><code>concurrentConsumers</code></strong> option if using Camel 2.10.3 or greater. See below for details.</p>
 </div>
</div><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(xxx) .inOut().to(&amp;quot;activemq:queue:foo&amp;quot;) .threads(5) .to(yyy) .to(zzz); </script> 
 </div>
</div><p>In this route we instruct Camel to route replies <a shape="rect" href="async.html">asynchronously</a> using a thread pool with 5 threads.</p><p>From <strong>Camel 2.10.3</strong>: you can now configure the listener to use concurrent threads using the <strong><code>concurrentConsumers</code></strong> and <strong><code>maxConcurrentConsumers</code></strong> options. This allows you to easier configure this in Camel as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(xxx) .inOut().to(&amp;quot;activemq:queue:foo?concurrentConsumers=5&amp;quot;) .to(yyy) .to(zzz); </script> 
 </div>
</div><h4 id="BookInOnePage-Request-ReplyoverJMSUsingaSharedFixedReplyQueue">Request-Reply over JMS Using a Shared Fixed Reply Queue</h4><p>If you use a fixed reply queue when doing <a shape="rect" href="request-reply.html">Request Reply</a> over JMS as shown in the example below, then pay attention.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(xxx) .inOut().to(&amp;quot;activemq:queue:foo?replyTo=bar&amp;quot;) .to(yyy); </script> 
 </div>
</div><p>In this example the fixed reply queue named "bar" is used. By default Camel assumes the queue is shared when using fixed reply queues, and therefore it uses a <strong><code>JMSSelector</code></strong> to only pickup the expected reply messages (eg based on the <strong><code>JMSCorrelationID</code></strong>). See next section for exclusive fixed reply queues. That means its not as fast as temporary queues. You can speedup how often Camel will pull for reply messages using the <strong><code>receiveTimeout</code></strong> option. By default its&#160;<strong><code>1000ms</code></strong>. So to make it faster you can set it to&#160;<strong><code>250ms</code></strong> to pull&#160;<strong><code>4</code></strong> times per second as shown:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(xxx) .inOut().to(&amp;quot;activemq:queue:foo?replyTo=bar&amp;amp;receiveTimeout=250&amp;quot;) .to(yyy); </script> 
 </div>
</div><p>Notice this will cause the Camel to send pull requests to the message broker more frequent, and thus require more network traffic. It's generally recommended that temporary queues be used where possible.</p><h4 id="BookInOnePage-Request-ReplyoverJMSUsinganExclusiveFixedReplyQueue">Request-Reply over JMS Using an Exclusive Fixed Reply Queue</h4><p><strong>Available as of Camel 2.9</strong></p><p>In the previous example, Camel would anticipate the fixed reply queue named&#160;<code>bar</code> was shared, and thus it uses a <strong><code>JMSSelector</code></strong> to only consume reply messages which it expects. However there is a drawback doing this as JMS selectos is slower. Also the consumer on the reply queue is slower to update with new JMS selector ids. In fact it only updates when the <strong><code>receiveTimeout</code></strong> option times out, which by default is&#160;<code>1</code> second. So in theory the reply messages could take up till about&#160;<code>1</code> sec to be detected. On the other hand if the fixed reply queue is exclusive to the Camel reply consumer, then we can avoid using the JMS selectors, and thus be more performant. In fact as fast as using temporary queues. So in <strong>Camel 2.9</strong> onward we introduced the <strong><code>ReplyToType</code></strong> option which you can configure to <strong><code>Exclusive</code></strong> to tell Camel that the reply queue is exclusive as shown in the example below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(xxx) .inOut().to(&amp;quot;activemq:queue:foo?replyTo=bar&amp;amp;replyToType=Exclusive&amp;quot;) .to(yyy); </script> 
 </div>
</div><p>Mind that the queue must be exclusive to each and every endpoint. So if you have two routes, then they each need an unique reply queue as shown in the next example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(xxx) .inOut().to(&amp;quot;activemq:queue:foo?replyTo=bar&amp;amp;replyToType=Exclusive&amp;quot;) .to(yyy); from(aaa) .inOut().to(&amp;quot;activemq:queue:order?replyTo=order.reply&amp;amp;replyToType=Exclusive&amp;quot;) .to(bbb); </script> 
 </div>
</div><p>The same applies if you run in a clustered environment. Then each node in the cluster must use an unique reply queue name. As otherwise each node in the cluster may pickup messages which was intended as a reply on another node. For clustered environments its recommended to use shared reply queues instead.</p><h3 id="BookInOnePage-SynchronizingClocksBetweenSendersandReceivers">Synchronizing Clocks Between Senders and Receivers</h3><p>When doing messaging between systems, its desirable that the systems have synchronized clocks. For example when sending a <a shape="rect" href="jms.html">JMS</a> message, then you can set a time to live value on the message. Then the receiver can inspect this value, and determine if the message is already expired, and thus drop the message instead of consume and process it. However this requires that both sender and receiver have synchronized clocks. If you are using <a shape="rect" class="external-link" href="http://activemq.apache.org/">ActiveMQ</a> then you can use the <a shape="rect" class="external-link" href="http://activemq.apache.org/timestampplugin.html">timestamp plugin</a> to synchronize clocks.</p><h3 id="BookInOnePage-AboutTimeToLive">About Time To Live</h3><p>Read first above about synchronized clocks.</p><p>When you do request/reply,&#160;<strong><code>InOut</code></strong>, over <a shape="rect" href="jms.html">JMS</a> Camel uses a timeout on the sender side, which is default 20 seconds, taken from the <strong><code>requestTimeout</code></strong> option. You can control this by setting a higher/lower value. However, the time to live value is still set on the <a shape="rect" href="jms.html">JMS</a> message being sent. This therefore requires that system clocks be synchronized between the systems. If they are not, then you may want to disable the time to live value being set. This is now possible using the <strong><code>disableTimeToLive</code></strong> option from <strong>Camel 2.8</strong> onward. So if you set this option to <strong><code>disableTimeToLive=true</code></strong>, then Camel does <strong>not</strong> set any time to live value when sending <a shape="rect" href="jms.html">JMS</a> messages. <strong>But</strong> the request timeout is still active. So for example if you do request/reply over <a shape="rect" href="jms.html">JMS</a> and have disabled time to live, then Camel will still use a timeout by 20 seconds (the <strong><code>requestTimeout</code></strong> option). That option can of course also be configured. So the two options <strong><code>requestTimeout</code></strong> and <strong><code>disableTimeToLive</code></strong> gives you fine grained control when doing request/reply.</p><p>From <strong>Camel 2.13/2.12.3</strong>: you can provide a header in the message to override and use as the request timeout value instead of the endpoint configured value. For example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:someWhere&amp;quot;) .to(&amp;quot;jms:queue:foo?replyTo=bar&amp;amp;requestTimeout=30s&amp;quot;) .to(&amp;quot;bean:processReply&amp;quot;);</script> 
 </div>
</div><p>In the route above we have a endpoint configured <strong><code>requestTimeout</code></strong> of 30 seconds. So Camel will wait up till 30 seconds for that reply message to come back on the bar queue. If no reply message is received then a <strong><code>org.apache.camel.ExchangeTimedOutException</code></strong> is set on the <a shape="rect" href="exchange.html">Exchange</a> and Camel continues routing the message, which would then fail due the exception, and Camel's error handler reacts.</p><p>If you want to use a per message timeout value, you can set the header with key <strong><code>org.apache.camel.component.jms.JmsConstants#JMS_REQUEST_TIMEOUT</code></strong> which has constant value <strong><code>CamelJmsRequestTimeout</code></strong> with a timeout value as long type.</p><p>For example we can use a bean to compute the timeout value per individual message, such as calling the <code>"whatIsTheTimeout"</code> method on the service bean as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:someWhere&amp;quot;) .setHeader(&amp;quot;CamelJmsRequestTimeout&amp;quot;, method(ServiceBean.class, &amp;quot;whatIsTheTimeout&amp;quot;)) .to(&amp;quot;jms:queue:foo?replyTo=bar&amp;amp;requestTimeout=30s&amp;quot;) .to(&amp;quot;bean:processReply&amp;quot;);</script> 
 </div>
</div><p>When you do fire and forget (<strong><code>InOut</code></strong>) over <a shape="rect" href="jms.html">JMS</a> Camel will, by default, <strong>not</strong> set a time to live value on the message. The value can be configured using the <strong><code>timeToLive</code></strong> option. For example to indicate a 5 sec., you set <strong><code>timeToLive=5000</code></strong>. The option <strong><code>disableTimeToLive</code></strong> can be used to force disabling the time to live, also for&#160;<strong><code>InOnly</code></strong> messaging. The <strong><code>requestTimeout</code></strong> option is not being used for&#160;<strong><code>InOnly</code></strong> messaging.</p><h3 id="BookInOnePage-EnablingTransactedConsumption">Enabling Transacted Consumption</h3><p><span class="confluence-anchor-link" id="BookInOnePage-transactedConsumption"></span></p><p>A common requirement is to consume from a queue in a transaction and then process the message using the Camel route. To do this, just ensure that you set the following properties on the component/endpoint:</p><ul><li><p><code>transacted = true</code></p></li><li><p><code>transactionManager =</code> <em>&lt;SomeTransactionManager&gt;</em> (typically the JmsTransactionManager)</p></li></ul><p>See the <a shape="rect" href="transactional-client.html">Transactional Client</a> EIP pattern for further details.</p><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Transactions and [Request Reply] over JMS</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>When using <a shape="rect" href="request-reply.html">Request Reply</a> over JMS you cannot use a single transaction; JMS will not send any messages until a commit is performed, so the server side won't receive anything at all until the transaction commits. Therefore to use <a shape="rect" href="request-reply.html">Request Reply</a> you must commit a transaction after sending the request and then use a separate transaction for receiving the response.</p>
  <p>To address this issue the JMS component uses different properties to specify transaction use for oneway messaging and request reply messaging:</p>
  <ul><li><p>The <strong><code>transacted</code></strong> property applies <strong>only</strong> to the&#160;<strong><code>InOnly</code></strong> message <a shape="rect" href="exchange-pattern.html">Exchange Pattern</a> (MEP).</p></li><li><p>The <strong><code>transactedInOut</code></strong> property applies to the&#160;<strong><code>InOut</code></strong> (<a shape="rect" href="request-reply.html">Request Reply</a>) message <a shape="rect" href="exchange-pattern.html">Exchange Pattern</a> (MEP). If you want to use transactions with the&#160;<strong><code>InOut</code></strong> (<a shape="rect" href="request-reply.html">Request Reply</a>) message <a shape="rect" href="exchange-pattern.html">Exchange Pattern</a> (MEP), you <em>must</em> set <strong><code>transactedInOut=true</code></strong>.</p></li></ul>
 </div>
</div><p><strong>Available as of Camel 2.10</strong></p><p>You can leverage the <a shape="rect" class="external-link" href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/jms/listener/AbstractPollingMessageListenerContainer.html#setSessionTransacted(boolean)" rel="nofollow">DMLC transacted session API</a> using the following properties on component/endpoint:</p><ul><li><p><code>transacted = true</code></p></li><li><p><code>lazyCreateTransactionManager = false</code></p></li></ul><p>The benefit of doing so is that the&#160;<code>cacheLevel</code> setting will be honored when using local transactions without a configured TransactionManager. When a TransactionManager is configured, no caching happens at DMLC level and its necessary to rely on a pooled connection factory. For more details about this kind of setup see <a shape="rect" class="external-link" href="http://tmielke.blogspot.com/2012/03/camel-jms-with-transactions-lessons.html" rel="nofollow">here</a> and <a shape="rect" class="external-link" href="http://forum.springsource.org/showthread.php?123631-JMS-DMLC-not-caching connection-when-using-TX-despite-cacheLevel-CACHE_CONSUMER&amp;p=403530&amp;posted=1#post403530" rel="nofollow">here</a>.</p><h3 id="BookInOnePage-UsingJMSReplyToForLateReplies">Using&#160;<code>JMSReplyTo</code> For Late Replies</h3><p>When using Camel as a JMS listener, it sets an Exchange property with the value of the ReplyTo <strong><code>javax.jms.Destination</code></strong> object, having the key <strong><code>ReplyTo</code></strong>. You can obtain this <strong><code>Destination</code></strong> as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Destination replyDestination = exchange.getIn().getHeader(JmsConstants.JMS_REPLY_DESTINATION, Destination.class); </script> 
 </div>
</div><p>And then later use it to send a reply using regular JMS or Camel.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// We need to pass in the JMS component (this example uses ActiveMQ): JmsEndpoint endpoint = JmsEndpoint.newInstance(replyDestination, activeMQComponent); // Now that we have the endpoint we can use regular Camel API to send a message to it template.sendBody(endpoint, &amp;quot;Here is the late reply.&amp;quot;);</script> 
 </div>
</div><p>A different solution to sending a reply is to provide the <strong><code>replyDestination</code></strong> object in the same Exchange property when sending. Camel will then pick up this property and use it for the real destination. The endpoint URI must include a dummy destination, however.</p><p>Example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// we pretend to send it to some non existing dummy queue template.send(&amp;quot;activemq:queue:dummy, new Processor() { public void process(Exchange exchange) throws Exception { // and here we override the destination with the ReplyTo destination object so the message is sent to there instead of dummy exchange.getIn().setHeader(JmsConstants.JMS_DESTINATION, replyDestination); exchange.getIn().setBody(&amp;quot;Here is the late reply.&amp;quot;); } }</script> 
 </div>
</div><h3 id="BookInOnePage-UsingaRequestTimeout">Using a Request Timeout</h3><p>In the sample below we send a <a shape="rect" href="request-reply.html">Request Reply</a> style message <a shape="rect" href="exchange.html">Exchange</a> (we use the <strong><code>requestBody</code></strong> method = <strong><code>InOut</code></strong>) to the slow queue for further processing in Camel and we wait for a return reply:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // send a in-out with a timeout for 5 sec Object out = template.requestBody(&amp;quot;activemq:queue:slow?requestTimeout=5000&amp;quot;, &amp;quot;Hello World&amp;quot;); </script> 
  </div>
 </div><h3 id="BookInOnePage-Examples.22">Examples</h3><p>JMS is used in many examples for other components as well. But we provide a few samples below to get started.</p><h4 id="BookInOnePage-ReceivingfromJMS">Receiving from JMS</h4><p>In the following sample we configure a route that receives JMS messages and routes the message to a POJO:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;jms:queue:foo&amp;quot;) .to(&amp;quot;bean:myBusinessLogic&amp;quot;); </script> 
 </div>
</div><p>You can of course use any of the EIP patterns so the route can be context based. For example, here's how to filter an order topic for the big spenders:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;jms:topic:OrdersTopic&amp;quot;) .filter().method(&amp;quot;myBean&amp;quot;, &amp;quot;isGoldCustomer&amp;quot;) .to(&amp;quot;jms:queue:BigSpendersQueue&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-SendingtoJMS">Sending to JMS</h4><p>In the sample below we poll a file folder and send the file content to a JMS topic. As we want the content of the file as a <strong><code>TextMessage</code></strong> instead of a <strong><code>BytesMessage</code></strong>, we need to convert the body to a <strong><code>String</code></strong>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;file://orders&amp;quot;) .convertBodyTo(String.class) .to(&amp;quot;jms:topic:OrdersTopic&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-UsingAnnotations">Using <a shape="rect" href="bean-integration.html">Annotations</a></h4><p>Camel also has annotations so you can use <a shape="rect" href="pojo-consuming.html">POJO Consuming</a> and <a shape="rect" href="pojo-producing.html">POJO Producing</a>.</p><h4 id="BookInOnePage-SpringDSLExample">Spring DSL Example</h4><p>The preceding examples use the Java DSL. Camel also supports Spring XML DSL. Here is the big spender sample using Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;jms:topic:OrdersTopic&amp;quot;/&amp;gt; &amp;lt;filter&amp;gt; &amp;lt;method bean=&amp;quot;myBean&amp;quot; method=&amp;quot;isGoldCustomer&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;jms:queue:BigSpendersQueue&amp;quot;/&amp;gt; &amp;lt;/filter&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-OtherExamples.1">Other Examples</h4><p>JMS appears in many of the examples for other components and EIP patterns, as well in this Camel documentation. So feel free to browse the documentation. If you have time, check out the this tutorial that uses JMS but focuses on how well Spring Remoting and Camel works together <a shape="rect" href="tutorial-jmsremoting.html">Tutorial-JmsRemoting</a>.</p><h4 id="BookInOnePage-UsingJMSasaDeadLetterQueueStoringExchange">Using JMS as a Dead Letter Queue Storing Exchange</h4><p>Normally, when using <a shape="rect" href="jms.html">JMS</a> as the transport, it only transfers the body and headers as the payload. If you want to use <a shape="rect" href="jms.html">JMS</a> with a <a shape="rect" href="dead-letter-channel.html">Dead Letter Channel</a>, using a JMS queue as the Dead Letter Queue, then normally the caused Exception is not stored in the JMS message. You can, however, use the <strong><code>transferExchange</code></strong> option on the JMS dead letter queue to instruct Camel to store the entire <a shape="rect" href="exchange.html">Exchange</a> in the queue as a <strong><code>javax.jms.ObjectMessage</code></strong> that holds a <strong><code>org.apache.camel.impl.DefaultExchangeHolder</code></strong>. This allows you to consume from the Dead Letter Queue and retrieve the caused exception from the Exchange property with the key <strong><code>Exchange.EXCEPTION_CAUGHT</code></strong>.</p><p>Example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// setup error handler to use JMS as queue and store the entire Exchange errorHandler(deadLetterChannel(&amp;quot;jms:queue:dead?transferExchange=true&amp;quot;)); </script> 
 </div>
</div><p>Then you can consume from the JMS queue and analyze the problem:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;jms:queue:dead&amp;quot;) .to(&amp;quot;bean:myErrorAnalyzer&amp;quot;); // and in our bean String body = exchange.getIn().getBody(); Exception cause = exchange.getProperty(Exchange.EXCEPTION_CAUGHT, Exception.class); // The cause message is String problem = cause.getMessage(); </script> 
 </div>
</div><h4 id="BookInOnePage-UsingJMSasaDeadLetterChannelforStoringErrorOnly">Using JMS as a Dead Letter Channel for Storing Error Only</h4><p>You can use JMS to store the cause error message or to store a custom body, which you can initialize yourself. The following example uses the <a shape="rect" href="message-translator.html">Message Translator</a> EIP to do a transformation on the failed exchange before it is moved to the <a shape="rect" href="jms.html">JMS</a> dead letter queue:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// We sent it to a seda dead queue first errorHandler(deadLetterChannel(&amp;quot;seda:dead&amp;quot;)); // On the seda dead queue we can do the custom transformation before its sent to the JMS queue from(&amp;quot;seda:dead&amp;quot;) .transform(exceptionMessage()) .to(&amp;quot;jms:queue:dead&amp;quot;); </script> 
 </div>
</div><p>Here we only store the original cause error message in the transform. You can, however, use any <a shape="rect" href="expression.html">Expression</a> to send whatever you like. For example, you can invoke a method on a Bean or use a custom processor.</p><h3 id="BookInOnePage-SendinganInOnlyMessageandKeepingtheJMSReplyToHeader">Sending an&#160;<code>InOnly</code> Message and Keeping the&#160;<code>JMSReplyTo</code> Header</h3><p>When sending to a <a shape="rect" href="jms.html">JMS</a> destination using <strong>camel-jms</strong> the producer will use the MEP to detect if it's&#160;<strong><code>InOnly</code></strong> or&#160;<strong><code>InOut</code></strong> messaging. However, there can be times where you want to send an&#160;<strong><code>InOnly</code></strong> message but keeping the&#160;<strong><code>JMSReplyTo</code></strong> header. To do so you have to instruct Camel to keep it, otherwise the&#160;<strong><code>JMSReplyTo</code></strong> header will be dropped.</p><p>For example to send an&#160;<strong><code>InOnly</code></strong> message to the&#160;<strong><code>foo</code></strong> queue, but with a&#160;<strong><code>JMSReplyTo</code></strong> with bar queue you can do as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">template.send(&amp;quot;activemq:queue:foo?preserveMessageQos=true&amp;quot;, new Processor() { public void process(Exchange exchange) throws Exception { exchange.getIn().setBody(&amp;quot;World&amp;quot;); exchange.getIn().setHeader(&amp;quot;JMSReplyTo&amp;quot;, &amp;quot;bar&amp;quot;); } });</script> 
 </div>
</div><p><strong>Note</strong>: we use <strong><code>preserveMessageQos=true</code></strong> to instruct Camel to keep the&#160;<strong><code>JMSReplyTo</code></strong> header.</p><h3 id="BookInOnePage-SettingJMSProviderOptionsontheDestination">Setting JMS Provider Options on the Destination</h3><p>Some JMS providers, like IBM's WebSphere MQ need options to be set on the JMS destination. For example, you may need to specify the&#160;<strong><code>targetClient</code></strong> option. Since targetClient is a WebSphere MQ option and not a Camel URI option, you need to set that on the JMS destination name like so:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">... .setHeader(&amp;quot;CamelJmsDestinationName&amp;quot;, constant(&amp;quot;queue:///MY_QUEUE?targetClient=1&amp;quot;)) .to(&amp;quot;wmq:queue:MY_QUEUE?useMessageIDAsCorrelationID=true&amp;quot;); </script> 
 </div>
</div><p>Some versions of Websphere MQ do not accept this option on the destination name. The following exception is raised when this happens:</p><blockquote>
 <p><strong><code>com.ibm.msg.client.jms.DetailedJMSException: JMSCC0005: The specified value 'MY_QUEUE?targetClient=1' is not allowed for 'XMSC_DESTINATION_NAME'</code></strong></p>
</blockquote><p>A workaround is to use a custom <strong><code>DestinationResolver</code></strong>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">JmsComponent wmq = new JmsComponent(connectionFactory); wmq.setDestinationResolver(new DestinationResolver(){ public Destination resolveDestinationName(Session session, String destinationName, boolean pubSubDomain) throws JMSException { MQQueueSession wmqSession = (MQQueueSession) session; return wmqSession.createQueue(&amp;quot;queue:///&amp;quot; + destinationName + &amp;quot;?targetClient=1&amp;quot;); } }); </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.52">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="transactional-client.html">Transactional Client</a></li><li><a shape="rect" href="bean-integration.html">Bean Integration</a></li><li><a shape="rect" href="tutorial-jmsremoting.html">Tutorial-JmsRemoting</a></li><li><a shape="rect" class="external-link" href="http://activemq.apache.org/jmstemplate-gotchas.html">JMSTemplate gotchas</a></li></ul><h2 id="BookInOnePage-JMXComponent">JMX Component</h2><p><strong>Available as of Camel 2.6</strong></p><h3 id="BookInOnePage-StandardJMXConsumerConfiguration">Standard JMX Consumer Configuration</h3><p>Component allows consumers to subscribe to an mbean's Notifications. The component supports passing the Notification object directly through the Exchange or serializing it to XML according to the schema provided within this project. This is a consumer only component. Exceptions are thrown if you attempt to create a producer for it.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-jmx&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-URIFormat.4">URI Format</h4><p>The component can connect to the local platform mbean server with the following URI:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> jmx://platform?options </script> 
 </div>
</div><p>A remote mbean server url can be provided following the initial JMX scheme like so:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> jmx:service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi?options </script> 
 </div>
</div><p>You can append query options to the URI in the following format, ?options=value&amp;option2=value&amp;...</p><h4 id="BookInOnePage-URIOptions.6">URI Options</h4><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Property </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Required </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> format </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> xml </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Format for the message body. Either "xml" or "raw". If xml, the notification is serialized to xml. If raw, then the raw java object is set as the body.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> user </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Credentials for making a remote connection. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> password </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Credentials for making a remote connection. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> objectDomain </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> yes </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The domain for the mbean you're connecting to. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> objectName </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The name key for the mbean you're connecting to. This value is mutually exclusive with the object properties that get passed. (see below) </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>notificationFilter </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Reference to a bean that implements the <code>NotificationFilter</code>. The #ref syntax should be used to reference the bean via the <a shape="rect" href="registry.html">Registry</a>. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>handback </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Value to handback to the listener when a notification is received. This value will be put in the message header with the key "jmx.handback" </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>testConnectionOnStartup </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> true </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.11</strong> If true, the consumer will throw an exception when unable to establish the JMX connection upon startup. If false, the consumer will attempt to establish the JMX connection every 'x' seconds until the connection is made &#8211; where 'x' is the configured <em>reconnectDelay</em>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>reconnectOnConnectionFailure </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> false </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.11</strong> If true, the consumer will attempt to reconnect to the JMX server when any connection failure occurs. The consumer will attempt to re-establish the JMX connection every 'x' seconds until the connection is made-- where 'x' is the configured <em>reconnectDelay</em>. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>reconnectDelay </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> 10 seconds </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.11</strong> The number of seconds to wait before retrying creation of the initial connection or before reconnecting a lost connection. </p></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-ObjectNameConstruction">ObjectName Construction</h4><p>The URI must always have the objectDomain property. In addition, the URI must contain either objectName or one or more properties that start with "key."</p><h4 id="BookInOnePage-DomainwithNameproperty">Domain with Name property</h4><p>When the objectName property is provided, the following constructor is used to build the ObjectName? for the mbean:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> ObjectName(String domain, String key, String value) </script> 
 </div>
</div><p>The key value in the above will be "name" and the value will be the value of the objectName property.</p><h4 id="BookInOnePage-DomainwithHashtable">Domain with Hashtable</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> ObjectName(String domain, Hashtable&amp;lt;String,String&amp;gt; table) </script> 
 </div>
</div><p>The Hashtable is constructed by extracting properties that start with "key." The properties will have the "key." prefixed stripped prior to building the Hashtable. This allows the URI to contain a variable number of properties to identify the mbean.</p><h4 id="BookInOnePage-Example.23">Example</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;jmx:platform?objectDomain=jmxExample&amp;amp;key.name=simpleBean&amp;quot;). to(&amp;quot;log:jmxEvent&amp;quot;); </script> 
 </div>
</div><p><a shape="rect" class="external-link" href="http://camel.apache.org/jmx-component-example.html">Full example</a></p><h3 id="BookInOnePage-MonitorTypeConsumer">Monitor Type Consumer</h3><p><strong>Available as of Camel 2.8</strong><br clear="none"> One popular use case for JMX is creating a monitor bean to monitor an attribute on a deployed bean. This requires writing a few lines of Java code to create the JMX monitor and deploy it. As shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> CounterMonitor monitor = new CounterMonitor(); monitor.addObservedObject(makeObjectName(&amp;quot;simpleBean&amp;quot;)); monitor.setObservedAttribute(&amp;quot;MonitorNumber&amp;quot;); monitor.setNotify(true); monitor.setInitThreshold(1); monitor.setGranularityPeriod(500); registerBean(monitor, makeObjectName(&amp;quot;counter&amp;quot;)); monitor.start(); </script> 
 </div>
</div><p>The 2.8 version introduces a new type of consumer that automatically creates and registers a monitor bean for the specified objectName and attribute. Additional endpoint attributes allow the user to specify the attribute to monitor, type of monitor to create, and any other required properties. The code snippet above is condensed into a set of endpoint properties. The consumer uses these properties to create the CounterMonitor, register it, and then subscribe to its changes. All of the JMX monitor types are supported.</p><h4 id="BookInOnePage-Example.24">Example</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;jmx:platform?objectDomain=myDomain&amp;amp;objectName=simpleBean&amp;amp;&amp;quot; + &amp;quot;monitorType=counter&amp;amp;observedAttribute=MonitorNumber&amp;amp;initThreshold=1&amp;amp;&amp;quot; + &amp;quot;granularityPeriod=500&amp;quot;).to(&amp;quot;mock:sink&amp;quot;); </script> 
 </div>
</div><p>The example above will cause a new Monitor Bean to be created and depoyed to the local mbean server that monitors the "MonitorNumber" attribute on the "simpleBean." Additional types of monitor beans and options are detailed below. The newly deployed monitor bean is automatically undeployed when the consumer is stopped. </p><h4 id="BookInOnePage-URIOptionsforMonitorType">URI Options for Monitor Type</h4><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>property</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>applies to</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> monitorType </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>enum</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> all </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> one of counter, guage, string </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> observedAttribute </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>string</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> all </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> the attribute being observed </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> granualityPeriod </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>long</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> all </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> granularity period (in millis) for the attribute being observed. As per JMX, default is 10 seconds </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> initThreshold </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>number</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> counter </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> initial threshold value </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> offset </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>number</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> counter </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> offset value </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> modulus </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>number</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> counter </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> modulus value </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> differenceMode </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> boolean </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> counter, gauge </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> true if difference should be reported, false for actual value </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> notifyHigh </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> boolean </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> gauge </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> high notification on/off switch </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> notifyLow </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> boolean </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> gauge </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> low notification on/off switch </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> highThreshold </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> number </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> gauge </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> threshold for reporting high notification </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> lowThreshold </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> number </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> gauge </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> threshold for reporting low notificaton </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> notifyDiffer </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> boolean </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> string </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> true to fire notification when string differs </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> notifyMatch </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> boolean </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> string </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> true to fire notification when string matches </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> stringToCompare </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> string </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> string </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> string to compare against the attribute value </p></td></tr></tbody></table>
</div><p>The monitor style consumer is only supported for the local mbean server. JMX does not currently support remote deployment of mbeans without either having the classes already remotely deployed or an adapter library on both the client and server to facilitate a proxy deployment.</p><h3 id="BookInOnePage-SeeAlso.53">See Also</h3><ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="camel-jmx.html">Camel JMX</a></li></ul><h2 id="BookInOnePage-JPAComponent">JPA Component</h2><p>The <strong>jpa</strong> component enables you to store and retrieve Java objects from persistent storage using EJB 3's Java Persistence Architecture (JPA), which is a standard interface layer that wraps Object/Relational Mapping (ORM) products such as OpenJPA, Hibernate, TopLink, and so on.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-jpa&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Sendingtotheendpoint.2">Sending to the endpoint</h3><p>You can store a Java entity bean in a database by sending it to a JPA producer endpoint. The body of the <em>In</em> message is assumed to be an entity bean (that is, a POJO with an <a shape="rect" class="external-link" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/Entity.html" rel="nofollow">@Entity</a> annotation on it) or a collection or array of entity beans.</p><p>If the body is a List of entities, make sure to use <strong>entityType=java.util.ArrayList</strong> as a configuration passed to the producer endpoint.</p><p>If the body does not contain one of the previous listed types, put a <a shape="rect" href="message-translator.html">Message Translator</a> in front of the endpoint to perform the necessary conversion first.</p><h3 id="BookInOnePage-Consumingfromtheendpoint.2">Consuming from the endpoint</h3><p>Consuming messages from a JPA consumer endpoint removes (or updates) entity beans in the database. This allows you to use a database table as a logical queue: consumers take messages from the queue and then delete/update them to logically remove them from the queue.</p><p>If you do not wish to delete the entity bean when it has been processed (and when routing is done), you can specify <code>consumeDelete=false</code> on the URI. This will result in the entity being processed each poll.</p><p>If you would rather perform some update on the entity to mark it as processed (such as to exclude it from a future query) then you can annotate a method with <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-jpa/apidocs/org/apache/camel/component/jpa/Consumed.html">@Consumed</a> which will be invoked on your entity bean when the entity bean when it has been processed (and when routing is done).</p><p>From <strong>Camel 2.13</strong> onwards you can use <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-jpa/apidocs/org/apache/camel/component/jpa/PreConsumed.html">@PreConsumed</a> which will be invoked on your entity bean before it has been processed (before routing).</p><p>If you are consuming a lot (100K+) of rows and experience OutOfMemory problems you should set the maximumResults to sensible value.</p><h3 id="BookInOnePage-URIformat.34">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">jpa:entityClassName[?options] </script> 
 </div>
</div><p>For sending to the endpoint, the <em>entityClassName</em> is optional. If specified, it helps the <a shape="rect" href="type-converter.html">Type Converter</a> to ensure the body is of the correct type.</p><p>For consuming, the <em>entityClassName</em> is mandatory.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.49">Options</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>entityType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em>entityClassName</em></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Overrides the <em>entityClassName</em> from the URI.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>persistenceUnit</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>camel</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The JPA persistence unit used by default.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumeDelete</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>JPA consumer only:</strong> If <code>true</code>, the entity is deleted after it is consumed; if <code>false</code>, the entity is not deleted.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumeLockEntity</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>JPA consumer only:</strong> Specifies whether or not to set an exclusive lock on each entity bean while processing the results from polling.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>flushOnSend</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>JPA producer only:</strong> Flushes the <a shape="rect" class="external-link" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/EntityManager.html" rel="nofollow">EntityManager</a> after the entity bean has been persisted.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maximumResults</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>-1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>JPA consumer only:</strong> Set the maximum number of results to retrieve on the <a shape="rect" class="external-link" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/Query.html" rel="nofollow">Query</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transactionManager</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>This option is <a shape="rect" href="registry.html">Registry</a> based which requires the <code>#</code> notation so that the given <code>transactionManager</code> being specified can be looked up properly, e.g. <code>transactionManager=#myTransactionManager</code>. It specifies the transaction manager to use. If none provided, Camel will use a <code>JpaTransactionManager</code> by default. Can be used to set a JTA transaction manager (for integration with an EJB container).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.delay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>500</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>JPA consumer only:</strong> Delay in milliseconds between each poll.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.initialDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>JPA consumer only:</strong> Milliseconds before polling starts.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.useFixedDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>JPA consumer only:</strong> Set to <code>true</code> to use fixed delay between polls, otherwise fixed rate is used. See <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ScheduledExecutorService.html" rel="nofollow">ScheduledExecutorService</a> in JDK for details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxMessagesPerPoll</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>JPA consumer only:</strong> An integer value to define the maximum number of messages to gather per poll. By default, no maximum is set. Can be used to avoid polling many thousands of messages when starting up the server. Set a value of 0 or negative to disable.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.query</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>JPA consumer only:</strong> To use a custom query when consuming data.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.namedQuery</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>JPA consumer only:</strong> To use a named query when consuming data.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.nativeQuery</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>JPA consumer only:</strong> To use a custom native query when consuming data. You may want to use the option <code>consumer.resultClass</code> also when using native queries.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.parameters</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12: JPA consumer only:</strong> This option is <a shape="rect" href="registry.html">Registry</a> based which requires the <code>#</code> notation. This key/value mapping is used for building the query parameters. It's is expected to be of the generic type <code>java.util.Map&lt;String, Object&gt;</code> where the keys are the named parameters of a given JPA query and the values are their corresponding effective values you want to select for.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.resultClass</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.7: JPA consumer only:</strong> Defines the type of the returned payload (we will call <code>entityManager.createNativeQuery(nativeQuery, resultClass)</code> instead of <code>entityManager.createNativeQuery(nativeQuery)</code>). Without this option, we will return an object array. Only has an affect when using in conjunction with native query when consuming data.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.transacted</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.7.5/2.8.3/2.9: JPA consumer only:</strong> Whether to run the consumer in transacted mode, by which all messages will either commit or rollback, when the entire batch has been processed. The default behavior (false) is to commit all the previously successfully processed messages, and only rollback the last failed message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.lockModeType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>WRITE</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.2/2.12:</strong> To configure the lock mode on the consumer. The possible values is defined in the enum <code>javax.persistence.LockModeType</code>. The default value is changed to <code>PESSIMISTIC_WRITE</code> since <strong>Camel 2.13</strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.SkipLockedEntity</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.13:</strong> To configure whether to use NOWAIT on lock and silently skip the entity.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>usePersist</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5: JPA producer only:</strong> Indicates to use <code>entityManager.persist(entity)</code> instead of <code>entityManager.merge(entity)</code>. Note: <code>entityManager.persist(entity)</code> doesn't work for detached entities (where the EntityManager has to execute an UPDATE instead of an INSERT query)!</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>joinTransaction</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12.3:</strong> camel-jpa will join transaction by default from Camel 2.12 onwards. You can use this option to turn this off, for example if you use LOCAL_RESOURCE and join transaction doesn't work with your JPA provider. This option can also be set globally on the <code>JpaComponent</code>, instead of having to set it on all endpoints.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="p1">usePassedInEntityManager</p></td><td colspan="1" rowspan="1" class="confluenceTd">false</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.12.4/2.13.1 JPA producer only:</strong> If set to true, then Camel will use the EntityManager from the header<p class="p1">JpaConstants.ENTITYMANAGER instead of the configured entity manager on the component/endpoint. This allows end users to control which entity manager will be in use.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">sharedEntityManager</td><td colspan="1" rowspan="1" class="confluenceTd">false</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong>&#160;whether to use spring's SharedEntityManager for the consumer/producer. A good idea may be to set joinTransaction=false if this option is true, as sharing the entity manager and mixing transactions is not a good idea.</td></tr></tbody></table>
</div><h3 id="BookInOnePage-MessageHeaders.10">Message Headers</h3><p>Camel adds the following message headers to the exchange:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelJpaTemplate</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>JpaTemplate</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Not supported anymore since Camel 2.12:</strong> The <code>JpaTemplate</code> object that is used to access the entity bean. You need this object in some situations, for instance in a type converter or when you are doing some custom processing. See <a shape="rect" class="external-link" href="https://issues.apache.org/jira/browse/CAMEL-5932">CAMEL-5932</a> for the reason why the support for this header has been dropped.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelEntityManager</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>EntityManager</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12: JPA consumer / Camel 2.12.2: JPA producer:</strong> The JPA <code>EntityManager</code> object being used by <code>JpaConsumer</code> or <code>JpaProducer</code>.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-ConfiguringEntityManagerFactory">Configuring EntityManagerFactory</h3><p>Its strongly advised to configure the JPA component to use a specific <code>EntityManagerFactory</code> instance. If failed to do so each <code>JpaEndpoint</code> will auto create their own instance of <code>EntityManagerFactory</code> which most often is not what you want.</p><p>For example, you can instantiate a JPA component that references the <code>myEMFactory</code> entity manager factory, as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;jpa&amp;quot; class=&amp;quot;org.apache.camel.component.jpa.JpaComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;entityManagerFactory&amp;quot; ref=&amp;quot;myEMFactory&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>In <strong>Camel 2.3</strong> the <code>JpaComponent</code> will auto lookup the <code>EntityManagerFactory</code> from the <a shape="rect" href="registry.html">Registry</a> which means you do not need to configure this on the <code>JpaComponent</code> as shown above. You only need to do so if there is ambiguity, in which case Camel will log a WARN.</p><h3 id="BookInOnePage-ConfiguringTransactionManager">Configuring TransactionManager</h3><p>Since <strong>Camel 2.3</strong> the <code>JpaComponent</code> will auto lookup the <code>TransactionManager</code> from the <a shape="rect" href="registry.html">Registry.</a> If Camel won't find any <code>TransactionManager</code> instance registered, it will also look up for the&#160;<code>TransactionTemplate</code> and try to extract&#160;<code>TransactionManager</code> from it.</p><p>If none <code>TransactionTemplate</code> is available in the registry, <code>JpaEndpoint</code> will auto create their own instance of <code>TransactionManager</code> which most often is not what you want.</p><p>If more than single instance of the <code>TransactionManager</code> is found, Camel will log a WARN. In such cases you might want to instantiate and explicitly configure a JPA component that references the <code>myTransactionManager</code> transaction manager, as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;jpa&amp;quot; class=&amp;quot;org.apache.camel.component.jpa.JpaComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;entityManagerFactory&amp;quot; ref=&amp;quot;myEMFactory&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;transactionManager&amp;quot; ref=&amp;quot;myTransactionManager&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Usingaconsumerwithanamedquery">Using a consumer with a named query</h3><p>For consuming only selected entities, you can use the <code>consumer.namedQuery</code> URI query option. First, you have to define the named query in the JPA Entity class:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">@Entity @NamedQuery(name = &amp;quot;step1&amp;quot;, query = &amp;quot;select x from MultiSteps x where x.step = 1&amp;quot;) public class MultiSteps { ... } </script> 
 </div>
</div><p>After that you can define a consumer uri like this one:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;jpa://org.apache.camel.examples.MultiSteps?consumer.namedQuery=step1&amp;quot;) .to(&amp;quot;bean:myBusinessLogic&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-Usingaconsumerwithaquery">Using a consumer with a query</h3><p>For consuming only selected entities, you can use the <code>consumer.query</code> URI query option. You only have to define the query option:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;jpa://org.apache.camel.examples.MultiSteps?consumer.query=select o from org.apache.camel.examples.MultiSteps o where o.step = 1&amp;quot;) .to(&amp;quot;bean:myBusinessLogic&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-Usingaconsumerwithanativequery">Using a consumer with a native query</h3><p>For consuming only selected entities, you can use the <code>consumer.nativeQuery</code> URI query option. You only have to define the native query option:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;jpa://org.apache.camel.examples.MultiSteps?consumer.nativeQuery=select * from MultiSteps where step = 1&amp;quot;) .to(&amp;quot;bean:myBusinessLogic&amp;quot;); </script> 
 </div>
</div><p>If you use the native query option, you will receive an object array in the message body.</p><h3 id="BookInOnePage-Example.25">Example</h3><p>See <a shape="rect" href="tracer-example.html">Tracer Example</a> for an example using <a shape="rect" href="jpa.html">JPA</a> to store traced messages into a database.</p><h3 id="BookInOnePage-UsingtheJPAbasedidempotentrepository">Using the JPA based idempotent repository</h3><p>In this section we will use the JPA based idempotent repository.</p><p>First we need to setup a <code>persistence-unit</code> in the persistence.xml file:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;persistence-unit name=&amp;quot;idempotentDb&amp;quot; transaction-type=&amp;quot;RESOURCE_LOCAL&amp;quot;&amp;gt; &amp;lt;class&amp;gt;org.apache.camel.processor.idempotent.jpa.MessageProcessed&amp;lt;/class&amp;gt; &amp;lt;properties&amp;gt; &amp;lt;property name=&amp;quot;openjpa.ConnectionURL&amp;quot; value=&amp;quot;jdbc:derby:target/idempotentTest;create=true&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;openjpa.ConnectionDriverName&amp;quot; value=&amp;quot;org.apache.derby.jdbc.EmbeddedDriver&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;openjpa.jdbc.SynchronizeMappings&amp;quot; value=&amp;quot;buildSchema&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;openjpa.Log&amp;quot; value=&amp;quot;DefaultLevel=WARN, Tool=INFO&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;openjpa.Multithreaded&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;/properties&amp;gt; &amp;lt;/persistence-unit&amp;gt; </script> 
  </div>
 </div>Second we have to setup a <code>org.springframework.orm.jpa.JpaTemplate</code> which is used by the <code>org.apache.camel.processor.idempotent.jpa.JpaMessageIdRepository</code>:
 <div class="error">
  <span class="error">Error formatting macro: snippet: java.lang.IndexOutOfBoundsException: Index: 20, Size: 20</span> 
 </div>Afterwards we can configure our <code>org.apache.camel.processor.idempotent.jpa.JpaMessageIdRepository</code>:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- we define our jpa based idempotent repository we want to use in the file consumer --&amp;gt; &amp;lt;bean id=&amp;quot;jpaStore&amp;quot; class=&amp;quot;org.apache.camel.processor.idempotent.jpa.JpaMessageIdRepository&amp;quot;&amp;gt; &amp;lt;!-- Here we refer to the entityManagerFactory --&amp;gt; &amp;lt;constructor-arg index=&amp;quot;0&amp;quot; ref=&amp;quot;entityManagerFactory&amp;quot;/&amp;gt; &amp;lt;!-- This 2nd parameter is the name (= a category name). You can have different repositories with different names --&amp;gt; &amp;lt;constructor-arg index=&amp;quot;1&amp;quot; value=&amp;quot;FileConsumer&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
  </div>
 </div>And finally we can create our JPA idempotent repository in the spring XML file as well:<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route id=&amp;quot;JpaMessageIdRepositoryTest&amp;quot;&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot; /&amp;gt; &amp;lt;idempotentConsumer messageIdRepositoryRef=&amp;quot;jpaStore&amp;quot;&amp;gt; &amp;lt;header&amp;gt;messageId&amp;lt;/header&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot; /&amp;gt; &amp;lt;/idempotentConsumer&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">When running this Camel component tests inside your IDE</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>In case you run the <a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/camel/trunk/components/camel-jpa/src/test">tests of this component</a> directly inside your IDE (and not necessarily through Maven itself) then you could spot exceptions like:</p>
  <div class="code panel pdl" style="border-width: 1px;">
   <div class="codeContent panelContent pdl"> 
    <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction; nested exception is &amp;lt;openjpa-2.2.1-r422266:1396819 nonfatal user error&amp;gt; org.apache.openjpa.persistence.ArgumentException: This configuration disallows runtime optimization, but the following listed types were not enhanced at build time or at class load time with a javaagent: &amp;quot;org.apache.camel.examples.SendEmail&amp;quot;. at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:427) at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:371) at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:127) at org.apache.camel.processor.jpa.JpaRouteTest.cleanupRepository(JpaRouteTest.java:96) at org.apache.camel.processor.jpa.JpaRouteTest.createCamelContext(JpaRouteTest.java:67) at org.apache.camel.test.junit4.CamelTestSupport.doSetUp(CamelTestSupport.java:238) at org.apache.camel.test.junit4.CamelTestSupport.setUp(CamelTestSupport.java:208) </script> 
   </div>
  </div>
  <p>The problem here is that the source has been compiled/recompiled through your IDE and not through Maven itself which would <a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/camel/trunk/components/camel-jpa/pom.xml">enhance the byte-code at build time</a>. To overcome this you would need to enable <a shape="rect" class="external-link" href="http://openjpa.apache.org/entity-enhancement.html#dynamic-enhancement">dynamic byte-code enhancement of OpenJPA</a>. As an example assuming the current OpenJPA version being used in Camel itself is 2.2.1, then as running the tests inside your favorite IDE you would need to pass the following argument to the JVM:</p>
  <div class="code panel pdl" style="border-width: 1px;">
   <div class="codeContent panelContent pdl"> 
    <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> -javaagent:&amp;lt;path_to_your_local_m2_cache&amp;gt;/org/apache/openjpa/openjpa/2.2.1/openjpa-2.2.1.jar </script> 
   </div>
  </div>
  <p>Then it will all become green again <img class="emoticon emoticon-smile" src="https://cwiki.apache.org/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/icons/emoticons/smile.png" data-emoticon-name="smile" alt="(smile)"></p>
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.54">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="tracer-example.html">Tracer Example</a></li></ul><h2 id="BookInOnePage-JT/400Component">JT/400 Component</h2><p>The <strong><code>jt400</code></strong> component allows you to exchanges messages with an AS/400 system using data queues.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-jt400&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.35">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">jt400://user:password@system/QSYS.LIB/LIBRARY.LIB/QUEUE.DTAQ[?options] </script> 
 </div>
</div><p>To call remote program (<strong>Camel 2.7</strong>)</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">jt400://user:password@system/QSYS.LIB/LIBRARY.LIB/program.PGM[?options] </script> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-URIoptions.1">URI options</h3><p>For the data queue message exchange:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ccsid</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>default system CCSID</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the CCSID to use for the connection with the AS/400 system.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>format</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>text</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the data format for sending messages <br clear="none" class="atl-forced-newline"> valid options are: <code>text</code> (represented by <code>String</code>) and <code>binary</code> (represented by <code>byte[]</code>)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.delay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>500</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Delay in milliseconds between each poll.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.initialDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Milliseconds before polling starts.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.userFixedDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code> to use fixed delay between polls, otherwise fixed rate is used. See <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ScheduledExecutorService.html" rel="nofollow">ScheduledExecutorService</a> in JDK for details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>guiAvailable</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> Specifies whether AS/400 prompting is enabled in the environment running Camel.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>keyed</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Whether to use keyed or non-keyed data queues.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>searchKey</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Search key for keyed data queues.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>searchType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>EQ</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Search type which can be a value of <code>EQ</code>, <code>NE</code>, <code>LT</code>, <code>LE</code>, <code>GT</code>, or <code>GE</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>connectionPool</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>AS400ConnectionPool</code> instance</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Reference to an com.ibm.as400.access.AS400ConnectionPool instance in the Registry. This is used for obtaining connections to the AS/400 system. The look up notation ('#' character) should be used.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>secured</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> Whether to use SSL connections to the AS/400</td></tr></tbody></table> 
 </div>
</div><p>For the remote program call (<strong>Camel 2.7</strong>)</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>outputFieldsIdx</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies which fields (program parameters) are output parameters.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>fieldsLength</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the fields (program parameters) length as in the AS/400 program definition.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>format</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>text</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Specifies the data format for sending messages <br clear="none" class="atl-forced-newline"> valid options are: <code>text</code> (represented by <code>String</code>) and <code>binary</code> (represented by <code>byte[]</code>)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>guiAvailable</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> Specifies whether AS/400 prompting is enabled in the environment running Camel.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>connectionPool</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>AS400ConnectionPool</code> instance</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Reference to an com.ibm.as400.access.AS400ConnectionPool instance in the Registry. This is used for obtaining connections to the AS/400 system. The look up notation ('#' character) should be used.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Usage.6">Usage</h3><p>When configured as a consumer endpoint, the endpoint will poll a data queue on a remote system. For every entry on the data queue, a new <code>Exchange</code> is sent with the entry's data in the <em>In</em> message's body, formatted either as a <code>String</code> or a <code>byte[]</code>, depending on the format. For a provider endpoint, the <em>In</em> message body contents will be put on the data queue as either raw bytes or text.</p><h3 id="BookInOnePage-Connectionpool">Connection pool</h3><p><strong>Available as of Camel 2.10</strong></p><p>Connection pooling is in use from Camel 2.10 onwards. You can explicit configure a connection pool on the Jt400Component, or as an uri option on the endpoint.</p><h4 id="BookInOnePage-Remoteprogramcall(Camel2.7)">Remote program call (<strong>Camel 2.7</strong>)</h4><p>This endpoint expects the input to be either a String array or byte[] array (depending on format) and handles all the CCSID handling through the native jt400 library mechanisms. A parameter can be <em>omitted</em> by passing null as the value in its position (the remote program has to support it). After the program execution the endpoint returns either a String array or byte[] array with the values as they were returned by the program (the input only parameters will contain the same data as the beginning of the invocation)<br clear="none"> This endpoint does not implement a provider endpoint!</p><h3 id="BookInOnePage-Example.26">Example</h3><p>In the snippet below, the data for an exchange sent to the <code>direct:george</code> endpoint will be put in the data queue <code>PENNYLANE</code> in library <code>BEATLES</code> on a system named <code>LIVERPOOL</code>. <br clear="none" class="atl-forced-newline"> Another user connects to the same data queue to receive the information from the data queue and forward it to the <code>mock:ringo</code> endpoint.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public class Jt400RouteBuilder extends RouteBuilder { @Override public void configure() throws Exception { from(&amp;quot;direct:george&amp;quot;).to(&amp;quot;jt400://GEORGE:EGROEG@LIVERPOOL/QSYS.LIB/BEATLES.LIB/PENNYLANE.DTAQ&amp;quot;); from(&amp;quot;jt400://RINGO:OGNIR@LIVERPOOL/QSYS.LIB/BEATLES.LIB/PENNYLANE.DTAQ&amp;quot;).to(&amp;quot;mock:ringo&amp;quot;); } } </script> 
 </div>
</div><h4 id="BookInOnePage-Remoteprogramcallexample(Camel2.7)">Remote program call example (<strong>Camel 2.7</strong>)</h4><p>In the snippet below, the data Exchange sent to the direct:work endpoint will contain three string that will be used as the arguments for the program &#8220;compute&#8221; in the library &#8220;assets&#8221;. This program will write the output values in the 2nd and 3rd parameters. All the parameters will be sent to the direct:play endpoint.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public class Jt400RouteBuilder extends RouteBuilder { @Override public void configure() throws Exception { from(&amp;quot;direct:work&amp;quot;).to(&amp;quot;jt400://GRUPO:ATWORK@server/QSYS.LIB/assets.LIB/compute.PGM?fieldsLength=10,10,512&amp;amp;ouputFieldsIdx=2,3&amp;quot;).to(direct:play); } } </script> 
 </div>
</div><h4 id="BookInOnePage-Writingtokeyeddataqueues">Writing to keyed data queues</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;jms:queue:input&amp;quot;) .to(&amp;quot;jt400://username:password@system/lib.lib/MSGINDQ.DTAQ?keyed=true&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-Readingfromkeyeddataqueues">Reading from keyed data queues</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;jt400://username:password@system/lib.lib/MSGOUTDQ.DTAQ?keyed=true&amp;amp;searchKey=MYKEY&amp;amp;searchType=GE&amp;quot;) .to(&amp;quot;jms:queue:output&amp;quot;); </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.55">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-Language">Language</h2><p><strong>Available as of Camel 2.5</strong></p><p>The language component allows you to send <a shape="rect" href="exchange.html">Exchange</a> to an endpoint which executes a script by any of the supported <a shape="rect" href="languages.html">Languages</a> in Camel.<br clear="none"> By having a component to execute language scripts, it allows more dynamic routing capabilities. For example by using the <a shape="rect" href="routing-slip.html">Routing Slip</a> or <a shape="rect" href="dynamic-router.html">Dynamic Router</a> EIPs you can send messages to <code>language</code> endpoints where the script is dynamic defined as well.</p><p>This component is provided out of the box in <code>camel-core</code> and hence no additional JARs is needed. You only have to include additional Camel components if the language of choice mandates it, such as using <a shape="rect" href="groovy.html">Groovy</a> or <a shape="rect" href="javascript.html">JavaScript</a> languages.</p><h3 id="BookInOnePage-URIformat.36">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">language://languageName[:script][?options] </script> 
 </div>
</div><p>And from Camel 2.11 onwards you can refer to an external resource for the script using same notation as supported by the other <a shape="rect" href="language.html">Language</a>s in Camel</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">language://languageName:resource:scheme:location][?options] </script> 
 </div>
</div><h3 id="BookInOnePage-URIOptions.7">URI Options</h3><p>The component supports the following options.</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>languageName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The name of the <a shape="rect" href="languages.html">Language</a> to use, such as <code>simple</code>, <code>groovy</code>, <code>javascript</code> etc. This option is mandatory.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>script</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The script to execute.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transform</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether or not the result of the script should be used as the new message body. By setting to <code>false</code> the script is executed but the result of the script is discarded.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>contentCache</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> Whether to cache the script if loaded from a resource.<br clear="none"> Note: from <strong>Camel 2.10.3</strong> a cached script can be forced to reload at runtime via JMX using the clearContentCache operation.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cacheScript</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.13/2.12.2/2.11.3:</strong> Whether to cache the compiled script. Turning this option on can gain performance as the script is only compiled/created once, and reuse when processing Camel messages. But this may cause side-effects with data left from previous evaluation spills into the next, and concurrency issues as well. If the script being evaluated is idempotent then this option can be turned on.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>binary</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.14.1:</strong> Whether the script is binary content. This is intended to be used for loading resources using the Constant language, such as loading binary files.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-MessageHeaders.11">Message Headers</h3><p>The following message headers can be used to affect the behavior of the component</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelLanguageScript</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The script to execute provided in the header. Takes precedence over script configured on the endpoint.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Examples.23">Examples</h3><p>For example you can use the <a shape="rect" href="simple.html">Simple</a> language to <a shape="rect" href="message-translator.html">Message Translator</a> a message:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> String script = URLEncoder.encode(&amp;quot;Hello ${body}&amp;quot;, &amp;quot;UTF-8&amp;quot;); from(&amp;quot;direct:start&amp;quot;).to(&amp;quot;language:simple:&amp;quot; + script).to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>In case you want to convert the message body type you can do this as well:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> String script = URLEncoder.encode(&amp;quot;${mandatoryBodyAs(String)}&amp;quot;, &amp;quot;UTF-8&amp;quot;); from(&amp;quot;direct:start&amp;quot;).to(&amp;quot;language:simple:&amp;quot; + script).to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>You can also use the <a shape="rect" href="groovy.html">Groovy</a> language, such as this example where the input message will by multiplied with 2:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> String script = URLEncoder.encode(&amp;quot;request.body * 2&amp;quot;, &amp;quot;UTF-8&amp;quot;); from(&amp;quot;direct:start&amp;quot;).to(&amp;quot;language:groovy:&amp;quot; + script).to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>You can also provide the script as a header as shown below. Here we use <a shape="rect" href="xpath.html">XPath</a> language to extract the text from the <code>&lt;foo&gt;</code> tag.<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Object out = producer.requestBodyAndHeader(&amp;quot;language:xpath&amp;quot;, &amp;quot;&amp;lt;foo&amp;gt;Hello World&amp;lt;/foo&amp;gt;&amp;quot;, Exchange.LANGUAGE_SCRIPT, &amp;quot;/foo/text()&amp;quot;); assertEquals(&amp;quot;Hello World&amp;quot;, out); </script> 
 </div>
</div><h3 id="BookInOnePage-Loadingscriptsfromresources">Loading scripts from resources</h3><p><strong>Available as of Camel 2.9</strong></p><p>You can specify a resource uri for a script to load in either the endpoint uri, or in the <code>Exchange.LANGUAGE_SCRIPT</code> header.<br clear="none"> The uri must start with one of the following schemes: file:, classpath:, or http:</p><p>For example to load a script from the classpath:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) // load the script from the classpath .to(&amp;quot;language:simple:classpath:org/apache/camel/component/language/mysimplescript.txt&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>By default the script is loaded once and cached. However you can disable the <code>contentCache</code> option and have the script loaded on each evaluation.<br clear="none"> For example if the file myscript.txt is changed on disk, then the updated script is used:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) // the script will be loaded on each message, as we disabled cache .to(&amp;quot;language:simple:file:target/script/myscript.txt?contentCache=false&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>From <strong>Camel 2.11</strong> onwards you can refer to the resource similar to the other <a shape="rect" href="language.html">Language</a>s in Camel by prefixing with <code>"resource:"</code> as shown below:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) // load the script from the classpath .to(&amp;quot;language:simple:resource:classpath:org/apache/camel/component/language/mysimplescript.txt&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div><h3 id="BookInOnePage-SeeAlso.56">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="languages.html">Languages</a></li><li><a shape="rect" href="routing-slip.html">Routing Slip</a></li><li><a shape="rect" href="dynamic-router.html">Dynamic Router</a></li><li><a shape="rect" href="script.html">Script</a></li></ul><h2 id="BookInOnePage-LDAPComponent">LDAP Component</h2><p>The <strong>ldap</strong> component allows you to perform searches in LDAP servers using filters as the message payload.<br clear="none"> This component uses standard JNDI (<code>javax.naming</code> package) to access the server.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-ldap&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.37">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">ldap:ldapServerBean[?options] </script> 
 </div>
</div><p>The <em>ldapServerBean</em> portion of the URI refers to a <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.4.2/docs/api/javax/naming/directory/DirContext.html" rel="nofollow">DirContext</a> bean in the registry. The LDAP component only supports producer endpoints, which means that an <code>ldap</code> URI cannot appear in the <code>from</code> at the start of a route.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.50">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>base</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ou=system</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The base DN for searches.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>scope</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>subtree</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies how deeply to search the tree of entries, starting at the base DN. Value can be <code>object</code>, <code>onelevel</code>, or <code>subtree</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>pageSize</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>no paging used</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.6:</strong> When specified the ldap module uses paging to retrieve all results (most LDAP Servers throw an exception when trying to retrieve more than 1000 entries in one query). To be able to use this a LdapContext (subclass of DirContext) has to be passed in as ldapServerBean (otherwise an exception is thrown)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>returnedAttributes</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>depends on LDAP Server (could be all or none)</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.6:</strong> Comma-separated list of attributes that should be set in each entry of the result</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Result.1">Result</h3><p>The result is returned in the Out body as a <code>ArrayList&lt;javax.naming.directory.SearchResult&gt;</code> object.</p><h3 id="BookInOnePage-DirContext">DirContext</h3><p>The URI, <code>ldap:ldapserver</code>, references a Spring bean with the ID, <code>ldapserver</code>. The <code>ldapserver</code> bean may be defined as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;ldapserver&amp;quot; class=&amp;quot;javax.naming.directory.InitialDirContext&amp;quot; scope=&amp;quot;prototype&amp;quot;&amp;gt; &amp;lt;constructor-arg&amp;gt; &amp;lt;props&amp;gt; &amp;lt;prop key=&amp;quot;java.naming.factory.initial&amp;quot;&amp;gt;com.sun.jndi.ldap.LdapCtxFactory&amp;lt;/prop&amp;gt; &amp;lt;prop key=&amp;quot;java.naming.provider.url&amp;quot;&amp;gt;ldap://localhost:10389&amp;lt;/prop&amp;gt; &amp;lt;prop key=&amp;quot;java.naming.security.authentication&amp;quot;&amp;gt;none&amp;lt;/prop&amp;gt; &amp;lt;/props&amp;gt; &amp;lt;/constructor-arg&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>The preceding example declares a regular Sun based LDAP <code>DirContext</code> that connects anonymously to a locally hosted LDAP server.</p><div class="confluence-information-macro confluence-information-macro-note">
 <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p><code>DirContext</code> objects are <strong>not</strong> required to support concurrency by contract. It is therefore important that the directory context is declared with the setting, <code>scope="prototype"</code>, in the <code>bean</code> definition or that the context supports concurrency. In the Spring framework, <code>prototype</code> scoped objects are instantiated each time they are looked up.</p>
 </div>
</div><h3 id="BookInOnePage-Samples.12">Samples</h3><p>Following on from the Spring configuration above, the code sample below sends an LDAP request to filter search a group for a member. The Common Name is then extracted from the response.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">ProducerTemplate&amp;lt;Exchange&amp;gt; template = exchange .getContext().createProducerTemplate(); Collection&amp;lt;?&amp;gt; results = (Collection&amp;lt;?&amp;gt;) (template .sendBody( &amp;quot;ldap:ldapserver?base=ou=mygroup,ou=groups,ou=system&amp;quot;, &amp;quot;(member=uid=huntc,ou=users,ou=system)&amp;quot;)); if (results.size() &amp;gt; 0) { // Extract what we need from the device&amp;#39;s profile Iterator&amp;lt;?&amp;gt; resultIter = results.iterator(); SearchResult searchResult = (SearchResult) resultIter .next(); Attributes attributes = searchResult .getAttributes(); Attribute deviceCNAttr = attributes.get(&amp;quot;cn&amp;quot;); String deviceCN = (String) deviceCNAttr.get(); ... </script> 
 </div>
</div><p>If no specific filter is required - for example, you just need to look up a single entry - specify a wildcard filter expression. For example, if the LDAP entry has a Common Name, use a filter expression like:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">(cn=*) </script> 
 </div>
</div><h4 id="BookInOnePage-Bindingusingcredentials">Binding using credentials</h4><p>A Camel end user donated this sample code he used to bind to the ldap server using credentials.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Properties props = new Properties(); props.setProperty(Context.INITIAL_CONTEXT_FACTORY, &amp;quot;com.sun.jndi.ldap.LdapCtxFactory&amp;quot;); props.setProperty(Context.PROVIDER_URL, &amp;quot;ldap://localhost:389&amp;quot;); props.setProperty(Context.URL_PKG_PREFIXES, &amp;quot;com.sun.jndi.url&amp;quot;); props.setProperty(Context.REFERRAL, &amp;quot;ignore&amp;quot;); props.setProperty(Context.SECURITY_AUTHENTICATION, &amp;quot;simple&amp;quot;); props.setProperty(Context.SECURITY_PRINCIPAL, &amp;quot;cn=Manager&amp;quot;); props.setProperty(Context.SECURITY_CREDENTIALS, &amp;quot;secret&amp;quot;); SimpleRegistry reg = new SimpleRegistry(); reg.put(&amp;quot;myldap&amp;quot;, new InitialLdapContext(props, null)); CamelContext context = new DefaultCamelContext(reg); context.addRoutes( new RouteBuilder() { public void configure() throws Exception { from(&amp;quot;direct:start&amp;quot;).to(&amp;quot;ldap:myldap?base=ou=test&amp;quot;); } } ); context.start(); ProducerTemplate template = context.createProducerTemplate(); Endpoint endpoint = context.getEndpoint(&amp;quot;direct:start&amp;quot;); Exchange exchange = endpoint.createExchange(); exchange.getIn().setBody(&amp;quot;(uid=test)&amp;quot;); Exchange out = template.send(endpoint, exchange); Collection&amp;lt;SearchResult&amp;gt; data = out.getOut().getBody(Collection.class); assert data != null; assert !data.isEmpty(); System.out.println(out.getOut().getBody()); context.stop(); </script> 
 </div>
</div><h3 id="BookInOnePage-ConfiguringSSL">Configuring SSL</h3><p>All required is to create a custom socket factory and reference it in the InitialDirContext bean - see below sample.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>SSL Configuration</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt; &amp;lt;blueprint xmlns=&amp;quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xsi:schemaLocation=&amp;quot;http://www.osgi.org/xmlns/blueprint/v1.0.0 https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint.xsd&amp;quot;&amp;gt; &amp;lt;sslContextParameters xmlns=&amp;quot;http://camel.apache.org/schema/blueprint&amp;quot; id=&amp;quot;sslContextParameters&amp;quot;&amp;gt; &amp;lt;keyManagers keyPassword=&amp;quot;{{keystore.pwd}}&amp;quot;&amp;gt; &amp;lt;keyStore resource=&amp;quot;{{keystore.url}}&amp;quot; password=&amp;quot;{{keystore.pwd}}&amp;quot;/&amp;gt; &amp;lt;/keyManagers&amp;gt; &amp;lt;/sslContextParameters&amp;gt; &amp;lt;bean id=&amp;quot;customSocketFactory&amp;quot; class=&amp;quot;zotix.co.util.CustomSocketFactory&amp;quot;&amp;gt; &amp;lt;argument ref=&amp;quot;sslContextParameters&amp;quot; /&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;ldapserver&amp;quot; class=&amp;quot;javax.naming.directory.InitialDirContext&amp;quot; scope=&amp;quot;prototype&amp;quot;&amp;gt; &amp;lt;argument&amp;gt; &amp;lt;props&amp;gt; &amp;lt;prop key=&amp;quot;java.naming.factory.initial&amp;quot; value=&amp;quot;com.sun.jndi.ldap.LdapCtxFactory&amp;quot;/&amp;gt; &amp;lt;prop key=&amp;quot;java.naming.provider.url&amp;quot; value=&amp;quot;ldaps://lab.zotix.co:636&amp;quot;/&amp;gt; &amp;lt;prop key=&amp;quot;java.naming.security.protocol&amp;quot; value=&amp;quot;ssl&amp;quot;/&amp;gt; &amp;lt;prop key=&amp;quot;java.naming.security.authentication&amp;quot; value=&amp;quot;simple&amp;quot; /&amp;gt; &amp;lt;prop key=&amp;quot;java.naming.security.principal&amp;quot; value=&amp;quot;cn=Manager,dc=example,dc=com&amp;quot;/&amp;gt; &amp;lt;prop key=&amp;quot;java.naming.security.credentials&amp;quot; value=&amp;quot;passw0rd&amp;quot;/&amp;gt; &amp;lt;prop key=&amp;quot;java.naming.ldap.factory.socket&amp;quot; value=&amp;quot;zotix.co.util.CustomSocketFactory&amp;quot;/&amp;gt; &amp;lt;/props&amp;gt; &amp;lt;/argument&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;/blueprint&amp;gt;</script> 
 </div>
</div><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>Custom Socket Factory</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">import org.apache.camel.util.jsse.SSLContextParameters; import javax.net.SocketFactory; import javax.net.ssl.SSLContext; import javax.net.ssl.SSLSocketFactory; import javax.net.ssl.TrustManagerFactory; import java.io.IOException; import java.net.InetAddress; import java.net.Socket; import java.security.KeyStore; /** * The CustomSocketFactory. Loads the KeyStore and creates an instance of SSLSocketFactory */ public class CustomSocketFactory extends SSLSocketFactory { private static SSLSocketFactory socketFactory; /** * Called by the getDefault() method. */ public CustomSocketFactory() { } /** * Called by Blueprint DI to initialise an instance of SocketFactory * * @param sslContextParameters */ public CustomSocketFactory(SSLContextParameters sslContextParameters) { try { KeyStore keyStore = sslContextParameters.getKeyManagers().getKeyStore().createKeyStore(); TrustManagerFactory tmf = TrustManagerFactory.getInstance(&amp;quot;SunX509&amp;quot;); tmf.init(keyStore); SSLContext ctx = SSLContext.getInstance(&amp;quot;TLS&amp;quot;); ctx.init(null, tmf.getTrustManagers(), null); socketFactory = ctx.getSocketFactory(); } catch (Exception ex) { ex.printStackTrace(System.err); /* handle exception */ } } /** * Getter for the SocketFactory * * @return */ public static SocketFactory getDefault() { return new CustomSocketFactory(); } @Override public String[] getDefaultCipherSuites() { return socketFactory.getDefaultCipherSuites(); } @Override public String[] getSupportedCipherSuites() { return socketFactory.getSupportedCipherSuites(); } @Override public Socket createSocket(Socket socket, String string, int i, boolean bln) throws IOException { return socketFactory.createSocket(socket, string, i, bln); } @Override public Socket createSocket(String string, int i) throws IOException { return socketFactory.createSocket(string, i); } @Override public Socket createSocket(String string, int i, InetAddress ia, int i1) throws IOException { return socketFactory.createSocket(string, i, ia, i1); } @Override public Socket createSocket(InetAddress ia, int i) throws IOException { return socketFactory.createSocket(ia, i); } @Override public Socket createSocket(InetAddress ia, int i, InetAddress ia1, int i1) throws IOException { return socketFactory.createSocket(ia, i, ia1, i1); } }</script> 
 </div>
</div><p>&#160;</p><p></p><h3 id="BookInOnePage-SeeAlso.57">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-LogComponent">Log Component</h2><p>The <strong>log:</strong> component logs message exchanges to the underlying logging mechanism.</p><p>Camel uses <a shape="rect" class="external-link" href="http://www.slf4j.org/" rel="nofollow">sfl4j</a> which allows you to configure logging via, among others: 
 </p><ul><li><a shape="rect" class="external-link" href="http://logging.apache.org/log4j/">Log4j</a></li><li><a shape="rect" class="external-link" href="http://logback.qos.ch/" rel="nofollow">Logback</a></li><li><a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/logging/package-summary.html" rel="nofollow">JDK Util Logging logging</a></li></ul><h3 id="BookInOnePage-URIformat.38">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">log:loggingCategory[?options] </script> 
 </div>
</div><p>Where <strong>loggingCategory</strong> is the name of the logging category to use. You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Using Logger instance from the the Registry</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>As of <strong>Camel 2.12.4/2.13.1</strong>, if there's single instance of&#160;<code>org.slf4j.Logger</code> found in the Registry, the <strong>loggingCategory</strong> is no longer used to create logger instance. The registered instance is used instead. Also it is possible to reference particular&#160;<code>Logger</code> instance using&#160;<code>?logger=#myLogger</code> URI parameter. Eventually, if there's no registered and URI&#160;<code>logger</code> parameter, the logger instance is created using <strong>loggingCategory</strong>.</p>
 </div>
</div><p>For example, a log endpoint typically specifies the logging level using the <code>level</code> option, as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">log:org.apache.camel.example?level=DEBUG </script> 
 </div>
</div><p>The default logger logs every exchange (<em>regular logging</em>). But Camel also ships with the <code>Throughput</code> logger, which is used whenever the <code>groupSize</code> option is specified.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Also a log in the DSL</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>There is also a <code>log</code> directly in the DSL, but it has a different purpose. Its meant for lightweight and human logs. See more details at <a shape="rect" href="logeip.html">LogEIP</a>.</p>
 </div>
</div><h3 id="BookInOnePage-Options.51">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Option </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Type </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>level</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>INFO</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>String</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Logging level to use. Possible values: <code>ERROR</code>, <code>WARN</code>, <code>INFO</code>, <code>DEBUG</code>, <code>TRACE</code>, <code>OFF</code> </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>marker</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>null</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>String</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.9:</strong> An optional <a shape="rect" class="external-link" href="http://www.slf4j.org/api/org/slf4j/Marker.html" rel="nofollow">Marker</a> name to use. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>groupSize</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>null</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>Integer</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> An integer that specifies a group size for throughput logging.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>groupInterval</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>null</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>Integer</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> If specified will group message stats by this time interval (in millis) </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>groupDelay</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>0</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>Integer</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Set the initial delay for stats (in millis) </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>groupActiveOnly</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>boolean</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> If true, will hide stats when no new messages have been received for a time interval, if false, show stats regardless of message traffic </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>logger</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>Logger</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.12.4/2.13.1:</strong> An optional reference to <a shape="rect" class="external-link" href="http://www.slf4j.org/api/org/slf4j/Logger.html" rel="nofollow">org.slf4j.Logger</a> from Registry to use. </p></td></tr></tbody></table> 
 </div>
</div><p><strong>note</strong>: groupDelay and groupActiveOnly are only applicable when using groupInterval</p><h3 id="BookInOnePage-Formatting">Formatting</h3><p>The log formats the execution of exchanges to log lines. <br clear="none"> By default, the log uses <code>LogFormatter</code> to format the log output, where <code>LogFormatter</code> has the following options:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Option </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>showAll</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Quick option for turning all options on. (multiline, maxChars has to be manually set if to be used) </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>showExchangeId</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Show the unique exchange ID. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>showExchangePattern</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Shows the Message Exchange Pattern (or MEP for short). </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>showProperties</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Show the exchange properties. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>showHeaders</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Show the In message headers. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>skipBodyLineSeparator</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.12.2:</strong> Whether to skip line separators when logging the message body. This allows to log the message body in one line, setting this option to <code>false</code> will preserve any line separators from the body, which then will log the body <em>as is</em>. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>showBodyType</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Show the In body Java type. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>showBody</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Show the In body. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>showOut</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> If the exchange has an Out message, show the Out message. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>showException</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> If the exchange has an exception, show the exception message (no stack trace). </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>showCaughtException</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> If the exchange has a caught exception, show the exception message (no stack trace). A caught exception is stored as a property on the exchange (using the key <code>Exchange.EXCEPTION_CAUGHT</code>) and for instance a <code>doCatch</code> can catch exceptions. See <a shape="rect" href="try-catch-finally.html">Try Catch Finally</a>. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>showStackTrace</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Show the stack trace, if an exchange has an exception. Only effective if one of <code>showAll</code>, <code>showException</code> or <code>showCaughtException</code> are enabled. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>showFiles</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.9:</strong> Whether Camel should show file bodies or not (eg such as java.io.File). </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>showFuture</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Whether Camel should show <code>java.util.concurrent.Future</code> bodies or not. If enabled Camel could potentially wait until the <code>Future</code> task is done. Will by default not wait. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>showStreams</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.8:</strong> Whether Camel should show stream bodies or not (eg such as java.io.InputStream). Beware if you enable this option then you may not be able later to access the message body as the stream have already been read by this logger. To remedy this you will have to use <a shape="rect" href="stream-caching.html">Stream Caching</a>. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>multiline</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> If <code>true</code>, each piece of information is logged on a new line. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>maxChars</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Limits the number of characters logged per line. The default value is <code>10000</code> from <strong>Camel 2.9</strong> onwards. </p></td></tr></tbody></table> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Logging stream bodies</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>For older versions of Camel that do not support the showFiles or showStreams properties above, you can set the following property instead on the <a shape="rect" href="camelcontext.html">CamelContext</a> to log both stream and file bodies:</p>
  <div class="code panel pdl" style="border-width: 1px;">
   <div class="codeContent panelContent pdl"> 
    <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">camelContext.getProperties().put(Exchange.LOG_DEBUG_BODY_STREAMS, true); </script> 
   </div>
  </div>
 </div>
</div><h3 id="BookInOnePage-Regularloggersample">Regular logger sample</h3><p>In the route below we log the incoming orders at <code>DEBUG</code> level before the order is processed:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:orders&amp;quot;).to(&amp;quot;log:com.mycompany.order?level=DEBUG&amp;quot;).to(&amp;quot;bean:processOrder&amp;quot;); </script> 
 </div>
</div><p>Or using Spring XML to define the route:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:orders&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;log:com.mycompany.order?level=DEBUG&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:processOrder&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Regularloggerwithformattersample">Regular logger with formatter sample</h3><p>In the route below we log the incoming orders at <code>INFO</code> level before the order is processed.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:orders&amp;quot;). to(&amp;quot;log:com.mycompany.order?showAll=true&amp;amp;multiline=true&amp;quot;).to(&amp;quot;bean:processOrder&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-ThroughputloggerwithgroupSizesample">Throughput logger with groupSize sample</h3><p>In the route below we log the throughput of the incoming orders at <code>DEBUG</code> level grouped by 10 messages.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:orders&amp;quot;). to(&amp;quot;log:com.mycompany.order?level=DEBUG&amp;amp;groupSize=10&amp;quot;).to(&amp;quot;bean:processOrder&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-ThroughputloggerwithgroupIntervalsample">Throughput logger with groupInterval sample</h3><p>This route will result in message stats logged every 10s, with an initial 60s delay and stats should be displayed even if there isn't any message traffic.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:orders&amp;quot;). to(&amp;quot;log:com.mycompany.order?level=DEBUG&amp;amp;groupInterval=10000&amp;amp;groupDelay=60000&amp;amp;groupActiveOnly=false&amp;quot;).to(&amp;quot;bean:processOrder&amp;quot;); </script> 
 </div>
</div><p>The following will be logged:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;quot;Received: 1000 new messages, with total 2000 so far. Last group took: 10000 millis which is: 100 messages per second. average: 100&amp;quot; </script> 
 </div>
</div><h3 id="BookInOnePage-Fullcustomizationoftheloggingoutput">Full customization of the logging output</h3><p><strong>Available as of Camel 2.11</strong></p><p>With the options outlined in the <a shape="rect" href="#BookInOnePage-Formatting">#Formatting</a> section, you can control much of the output of the logger. However, log lines will always follow this structure:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Exchange[Id:ID-machine-local-50656-1234567901234-1-2, ExchangePattern:InOut, Properties:{CamelToEndpoint=log://org.apache.camel.component.log.TEST?showAll=true, CamelCreatedTimestamp=Thu Mar 28 00:00:00 WET 2013}, Headers:{breadcrumbId=ID-machine-local-50656-1234567901234-1-1}, BodyType:String, Body:Hello World, Out: null] </script> 
 </div>
</div><p>This format is unsuitable in some cases, perhaps because you need to...</p><ul><li>... filter the headers and properties that are printed, to strike a balance between insight and verbosity.</li><li>... adjust the log message to whatever you deem most readable.</li><li>... tailor log messages for digestion by log mining systems, e.g. Splunk.</li><li>... print specific body types differently.</li><li>... etc.</li></ul><p>Whenever you require absolute customization, you can create a class that implements the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/spi/ExchangeFormatter.html"><code>ExchangeFormatter</code></a> interface. Within the <code>format(Exchange)</code> method you have access to the full Exchange, so you can select and extract the precise information you need, format it in a custom manner and return it. The return value will become the final log message.</p><p>You can have the Log component pick up your custom <code>ExchangeFormatter</code> in either of two ways:</p><p><strong>Explicitly instantiating the LogComponent in your Registry:</strong></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean name=&amp;quot;log&amp;quot; class=&amp;quot;org.apache.camel.component.log.LogComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;exchangeFormatter&amp;quot; ref=&amp;quot;myCustomFormatter&amp;quot; /&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p><strong>Convention over configuration:</strong></p><p>Simply by registering a bean with the name <code>logFormatter</code>; the Log Component is intelligent enough to pick it up automatically.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean name=&amp;quot;logFormatter&amp;quot; class=&amp;quot;com.xyz.MyCustomExchangeFormatter&amp;quot; /&amp;gt; </script> 
 </div>
</div><p>NOTE: the <code>ExchangeFormatter</code> gets applied to <strong>all Log endpoints within that Camel Context</strong>. If you need different ExchangeFormatters for different endpoints, just instantiate the LogComponent as many times as needed, and use the relevant bean name as the endpoint prefix.</p><p>From <strong>Camel 2.11.2/2.12</strong> onwards when using a custom log formatter, you can specify parameters in the log uri, which gets configured on the custom log formatter. Though when you do that you should define the "logFormatter" as prototype scoped so its not shared if you have different parameters, eg:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean name=&amp;quot;logFormatter&amp;quot; class=&amp;quot;com.xyz.MyCustomExchangeFormatter&amp;quot; scope=&amp;quot;prototype&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>And then we can have Camel routes using the log uri with different options:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;to uri=&amp;quot;log:foo?param1=foo&amp;amp;amp;param2=100&amp;quot;/&amp;gt; ... &amp;lt;to uri=&amp;quot;log:bar?param1=bar&amp;amp;amp;param2=200&amp;quot;/&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-UsingLogcomponentinOSGi">Using Log component in OSGi</h4><p><strong>Improvement as of Camel 2.12.4/2.13.1</strong></p><p>When using&#160;Log component inside OSGi (e.g., in Karaf), the underlying logging mechanisms are provided by PAX logging. It searches for a bundle which invokes&#160;<code>org.slf4j.LoggerFactory.getLogger()</code> method and associates the bundle with the logger instance. Without specifying custom&#160;<code>org.sfl4j.Logger</code> instance, the logger created by Log component is associated with <code>camel-core</code> bundle.</p><p>In some scenarios it is required that the bundle associated with logger should be the bundle which contains route definition. To do this, either register single instance of&#160;<code>org.slf4j.Logger</code> in the Registry or reference it using&#160;<code>logger</code> URI parameter.</p><p></p><h3 id="BookInOnePage-SeeAlso.58">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul><li><a shape="rect" href="tracer.html">Tracer</a></li><li><a shape="rect" href="how-do-i-use-log4j.html">How do I use log4j</a></li><li><a shape="rect" href="how-do-i-use-java-14-logging.html">How do I use Java 1.4 logging</a></li><li><a shape="rect" href="logeip.html">LogEIP</a> for using <code>log</code> directly in the DSL for human logs.</li></ul><h2 id="BookInOnePage-Lucene(IndexerandSearch)Component">Lucene (Indexer and Search) Component</h2><p><strong>Available as of Camel 2.2</strong></p><p>The <strong>lucene</strong> component is based on the Apache Lucene project. Apache Lucene is a powerful high-performance, full-featured text search engine library written entirely in Java. For more details about Lucene, please see the following links</p><ul><li><a shape="rect" class="external-link" href="http://lucene.apache.org/java/docs/">http://lucene.apache.org/java/docs/</a></li><li><a shape="rect" class="external-link" href="http://lucene.apache.org/java/docs/features.html">http://lucene.apache.org/java/docs/features.html</a></li></ul><p>The lucene component in camel facilitates integration and utilization of Lucene endpoints in enterprise integration patterns and scenarios. The lucene component does the following</p><ul><li>builds a searchable index of documents when payloads are sent to the Lucene Endpoint</li><li>facilitates performing of indexed searches in Camel</li></ul><p>This component only supports producer endpoints.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-lucene&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.39">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">lucene:searcherName:insert[?options] lucene:searcherName:query[?options] </script> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-InsertOptions">Insert Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>analyzer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>StandardAnalyzer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>An Analyzer builds TokenStreams, which analyze text. It thus represents a policy for extracting index terms from text. The value for analyzer can be any class that extends the abstract class org.apache.lucene.analysis.Analyzer. Lucene also offers a rich set of analyzers out of the box</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>indexDir</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>./indexDirectory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A file system directory in which index files are created upon analysis of the document by the specified analyzer</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>srcDir</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>An optional directory containing files to be used to be analyzed and added to the index at producer startup.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-QueryOptions">Query Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>analyzer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>StandardAnalyzer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>An Analyzer builds TokenStreams, which analyze text. It thus represents a policy for extracting index terms from text. The value for analyzer can be any class that extends the abstract class org.apache.lucene.analysis.Analyzer. Lucene also offers a rich set of analyzers out of the box</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>indexDir</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>./indexDirectory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A file system directory in which index files are created upon analysis of the document by the specified analyzer</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxHits</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>10</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>An integer value that limits the result set of the search operation</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Sending/ReceivingMessagesto/fromthecache.1">Sending/Receiving Messages to/from the cache</h3><h4 id="BookInOnePage-MessageHeaders.12">Message Headers</h4><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>QUERY</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Lucene Query to performed on the index. The query may include wildcards and phrases</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><span>RETURN_LUCENE_DOCS</span></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.15:</strong> Set this header to true to include the actual Lucene documentation when returning hit information.</td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-LuceneProducers">Lucene Producers</h4><p>This component supports 2 producer endpoints.</p><ul><li><strong>insert</strong> - The insert producer builds a searchable index by analyzing the body in incoming exchanges and associating it with a token ("content").</li><li><strong>query</strong> - The query producer performs searches on a pre-created index. The query uses the searchable index to perform score &amp; relevance based searches. Queries are sent via the incoming exchange contains a header property name called 'QUERY'. The value of the header property 'QUERY' is a Lucene Query. For more details on how to create Lucene Queries check out <a shape="rect" class="external-link" href="http://lucene.apache.org/java/3_0_0/queryparsersyntax.html">http://lucene.apache.org/java/3_0_0/queryparsersyntax.html</a></li></ul><h4 id="BookInOnePage-LuceneProcessor">Lucene Processor</h4><p>There is a processor called LuceneQueryProcessor available to perform queries against lucene without the need to create a producer.</p><h3 id="BookInOnePage-LuceneUsageSamples">Lucene Usage Samples</h3><h4 id="BookInOnePage-Example1:CreatingaLuceneindex">Example 1: Creating a Lucene index</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">RouteBuilder builder = new RouteBuilder() { public void configure() { from(&amp;quot;direct:start&amp;quot;). to(&amp;quot;lucene:whitespaceQuotesIndex:insert? analyzer=#whitespaceAnalyzer&amp;amp;indexDir=#whitespace&amp;amp;srcDir=#load_dir&amp;quot;). to(&amp;quot;mock:result&amp;quot;); } }; </script> 
 </div>
</div><h4 id="BookInOnePage-Example2:LoadingpropertiesintotheJNDIregistryintheCamelContext">Example 2: Loading properties into the JNDI registry in the Camel Context</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">@Override protected JndiRegistry createRegistry() throws Exception { JndiRegistry registry = new JndiRegistry(createJndiContext()); registry.bind(&amp;quot;whitespace&amp;quot;, new File(&amp;quot;./whitespaceIndexDir&amp;quot;)); registry.bind(&amp;quot;load_dir&amp;quot;, new File(&amp;quot;src/test/resources/sources&amp;quot;)); registry.bind(&amp;quot;whitespaceAnalyzer&amp;quot;, new WhitespaceAnalyzer()); return registry; } ... CamelContext context = new DefaultCamelContext(createRegistry()); </script> 
 </div>
</div><h4 id="BookInOnePage-Example2:PerformingsearchesusingaQueryProducer">Example 2: Performing searches using a Query Producer</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">RouteBuilder builder = new RouteBuilder() { public void configure() { from(&amp;quot;direct:start&amp;quot;). setHeader(&amp;quot;QUERY&amp;quot;, constant(&amp;quot;Seinfeld&amp;quot;)). to(&amp;quot;lucene:searchIndex:query? analyzer=#whitespaceAnalyzer&amp;amp;indexDir=#whitespace&amp;amp;maxHits=20&amp;quot;). to(&amp;quot;direct:next&amp;quot;); from(&amp;quot;direct:next&amp;quot;).process(new Processor() { public void process(Exchange exchange) throws Exception { Hits hits = exchange.getIn().getBody(Hits.class); printResults(hits); } private void printResults(Hits hits) { LOG.debug(&amp;quot;Number of hits: &amp;quot; + hits.getNumberOfHits()); for (int i = 0; i &amp;lt; hits.getNumberOfHits(); i++) { LOG.debug(&amp;quot;Hit &amp;quot; + i + &amp;quot; Index Location:&amp;quot; + hits.getHit().get(i).getHitLocation()); LOG.debug(&amp;quot;Hit &amp;quot; + i + &amp;quot; Score:&amp;quot; + hits.getHit().get(i).getScore()); LOG.debug(&amp;quot;Hit &amp;quot; + i + &amp;quot; Data:&amp;quot; + hits.getHit().get(i).getData()); } } }).to(&amp;quot;mock:searchResult&amp;quot;); } }; </script> 
 </div>
</div><h4 id="BookInOnePage-Example3:PerformingsearchesusingaQueryProcessor">Example 3: Performing searches using a Query Processor</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">RouteBuilder builder = new RouteBuilder() { public void configure() { try { from(&amp;quot;direct:start&amp;quot;). setHeader(&amp;quot;QUERY&amp;quot;, constant(&amp;quot;Rodney Dangerfield&amp;quot;)). process(new LuceneQueryProcessor(&amp;quot;target/stdindexDir&amp;quot;, analyzer, null, 20)). to(&amp;quot;direct:next&amp;quot;); } catch (Exception e) { e.printStackTrace(); } from(&amp;quot;direct:next&amp;quot;).process(new Processor() { public void process(Exchange exchange) throws Exception { Hits hits = exchange.getIn().getBody(Hits.class); printResults(hits); } private void printResults(Hits hits) { LOG.debug(&amp;quot;Number of hits: &amp;quot; + hits.getNumberOfHits()); for (int i = 0; i &amp;lt; hits.getNumberOfHits(); i++) { LOG.debug(&amp;quot;Hit &amp;quot; + i + &amp;quot; Index Location:&amp;quot; + hits.getHit().get(i).getHitLocation()); LOG.debug(&amp;quot;Hit &amp;quot; + i + &amp;quot; Score:&amp;quot; + hits.getHit().get(i).getScore()); LOG.debug(&amp;quot;Hit &amp;quot; + i + &amp;quot; Data:&amp;quot; + hits.getHit().get(i).getData()); } } }).to(&amp;quot;mock:searchResult&amp;quot;); } }; </script> 
 </div>
</div><h2 id="BookInOnePage-MailComponent">Mail Component</h2><p>The mail component provides access to Email via Spring's Mail support and the underlying JavaMail system.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-mail&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-warning">
 <p class="title">Geronimo mail .jar</p>
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>We have discovered that the geronimo mail <code>.jar</code> (v1.6) has a bug when polling mails with attachments. It cannot correctly identify the <code>Content-Type</code>. So, if you attach a <code>.jpeg</code> file to a mail and you poll it, the <code>Content-Type</code> is resolved as <code>text/plain</code> and not as <code>image/jpeg</code>. For that reason, we have added an <code>org.apache.camel.component.ContentTypeResolver</code> SPI interface which enables you to provide your own implementation and fix this bug by returning the correct Mime type based on the file name. So if the file name ends with <code>jpeg/jpg</code>, you can return <code>image/jpeg</code>.</p>
  <p>You can set your custom resolver on the <code>MailComponent</code> instance or on the <code>MailEndpoint</code> instance.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">POP3 or IMAP</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>POP3 has some limitations and end users are encouraged to use IMAP if possible.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Using mock-mail for testing</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>You can use a mock framework for unit testing, which allows you to test without the need for a real mail server. However you should remember to not include the mock-mail when you go into production or other environments where you need to send mails to a real mail server. Just the presence of the mock-javamail.jar on the classpath means that it will kick in and avoid sending the mails.</p>
 </div>
</div><h3 id="BookInOnePage-URIformat.40">URI format</h3><p>Mail endpoints can have one of the following URI formats (for the protocols, SMTP, POP3, or IMAP, respectively):</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">smtp://[username@]host[:port][?options] pop3://[username@]host[:port][?options] imap://[username@]host[:port][?options] </script> 
 </div>
</div><p>The mail component also supports secure variants of these protocols (layered over SSL). You can enable the secure protocols by adding <code>s</code> to the scheme:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">smtps://[username@]host[:port][?options] pop3s://[username@]host[:port][?options] imaps://[username@]host[:port][?options] </script> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h4 id="BookInOnePage-Sampleendpoints">Sample endpoints</h4><p>Typically, you specify a URI with login credentials as follows (taking SMTP as an example):</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">smtp://[username@]host[:port][?password=somepwd] </script> 
 </div>
</div><p>Alternatively, it is possible to specify both the user name and the password as query options:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">smtp://host[:port]?password=somepwd&amp;amp;username=someuser </script> 
 </div>
</div><p>For example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">smtp://mycompany.mailserver:30?password=tiger&amp;amp;username=scott </script> 
 </div>
</div><h4 id="BookInOnePage-DefaultPortsDefaultports"><span class="confluence-anchor-link" id="BookInOnePage-DefaultPorts"></span>Default ports</h4><p>Default port numbers are supported. If the port number is omitted, Camel determines the port number to use based on the protocol.</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Protocol</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Port Number</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>SMTP</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>25</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>SMTPS</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>465</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>POP3</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>110</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>POP3S</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>995</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>IMAP</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>143</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>IMAPS</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>993</code></p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Options.52">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Property</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>host</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The host name or IP address to connect to.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>port</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>See <a shape="rect" href="#BookInOnePage-DefaultPorts">#DefaultPorts</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The TCP port number to connect on.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>username</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The user name on the email server.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>password</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The password on the email server.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ignoreUriScheme</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If <code>false</code>, Camel uses the scheme to determine the transport protocol (POP, IMAP, SMTP etc.)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>contentType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>text/plain</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The mail message content type. Use <code>text/html</code> for HTML mails.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>folderName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>INBOX</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The folder to poll.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>destination</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>username@host</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>@deprecated</strong> Use the <code>to</code> option instead. The <code>TO</code> recipients (receivers of the email).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>to</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>username@host</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The TO recipients (the receivers of the mail). Separate multiple email addresses with a comma. Email addresses containing special characters such as "&amp;" will need to be handled differently - see <a shape="rect" href="how-do-i-configure-password-options-on-camel-endpoints-without-the-value-being-encoded.html">How do I configure password options on Camel endpoints without the value being encoded</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>replyTo</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>alias@host</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>As of <strong>Camel 2.8.4, 2.9.1+</strong>, the Reply-To recipients (the receivers of the response mail). Separate multiple email addresses with a comma.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cc</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The CC recipients (the receivers of the mail). Separate multiple email addresses with a comma.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bcc</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The BCC recipients (the receivers of the mail). Separate multiple email addresses with a comma.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>from</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>camel@localhost</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The FROM email address.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>subject</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>As of <strong>Camel 2.3</strong>, the Subject of the message being sent. Note: Setting the subject in the header takes precedence over this option.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>peek</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.3/2.12.2:</strong> Consumer only. Will mark the <code>javax.mail.Message</code> as peeked before processing the mail message. This applies to <code>IMAPMessage</code> messages types only. By using peek the mail will not be eager marked as <code>SEEN</code> on the mail server, which allows us to rollback the mail message if there is an error processing in Camel.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>delete</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Deletes the messages after they have been processed. This is done by setting the <code>DELETED</code> flag on the mail message. If <code>false</code>, the <code>SEEN</code> flag is set instead. As of <strong>Camel 2.10</strong> you can override this configuration option by setting a header with the key <code>delete</code> to determine if the mail should be deleted or not.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>unseen</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>It is possible to configure a consumer endpoint so that it processes only unseen messages (that is, new messages) or all messages. Note that Camel always skips deleted messages. The default option of <code>true</code> will filter to only unseen messages. POP3 does not support the <code>SEEN</code> flag, so this option is not supported in POP3; use IMAP instead. <strong>Important:</strong> This option is <strong>not</strong> in use if you also use <code>searchTerm</code> options. Instead if you want to disable unseen when using <code>searchTerm</code>'s then add <code>searchTerm.unseen=false</code> as a term.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>copyTo</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Consumer only. After processing a mail message, it can be copied to a mail folder with the given name. You can override this configuration value, with a header with the key <code>copyTo</code>, allowing you to copy messages to folder names configured at runtime.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>fetchSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>-1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sets the maximum number of messages to consume during a poll. This can be used to avoid overloading a mail server, if a mailbox folder contains a lot of messages. Default value of <code>-1</code> means no fetch size and all messages will be consumed. Setting the value to 0 is a special corner case, where Camel will not consume any messages at all.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>alternativeBodyHeader</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelMailAlternativeBody</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the key to an IN message header that contains an alternative email body. For example, if you send emails in <code>text/html</code> format and want to provide an alternative mail body for non-HTML email clients, set the alternative mail body with this key as a header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>debugMode</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Enable debug mode on the underlying mail framework. The SUN Mail framework logs the debug messages to <code>System.out</code> by default.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>connectionTimeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>30000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The connection timeout in milliseconds. Default is 30 seconds.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.initialDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Milliseconds before the polling starts.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.delay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>60000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Camel will poll the mailbox only once a minute by default to avoid overloading the mail server.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.useFixedDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Set to <code>true</code> to use a fixed delay between polls, otherwise fixed rate is used. See <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ScheduledExecutorService.html" rel="nofollow">ScheduledExecutorService</a> in JDK for details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>disconnect</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8.3/2.9:</strong> Whether the consumer should disconnect after polling. If enabled this forces Camel to connect on each poll.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>closeFolder</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.4:</strong> Whether the consumer should close the folder after polling. Setting this option to <code>false</code> and having <code>disconnect=false</code> as well, then the consumer keep the folder open between polls.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>mail.XXX</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Set any <a shape="rect" class="external-link" href="http://java.sun.com/products/javamail/javadocs/index.html" rel="nofollow">additional java mail properties</a>. For instance if you want to set a special property when using POP3 you can now provide the option directly in the URI such as: <code>mail.pop3.forgettopheaders=true</code>. You can set multiple such options, for example: <code>mail.pop3.forgettopheaders=true&amp;mail.mime.encodefilename=true</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>mapMailMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> Specifies whether Camel should map the received mail message to Camel body/headers. If set to true, the body of the mail message is mapped to the body of the Camel IN message and the mail headers are mapped to IN headers. If this option is set to false then the IN message contains a raw <code>javax.mail.Message</code>. You can retrieve this raw message by calling <code>exchange.getIn().getBody(javax.mail.Message.class)</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxMessagesPerPoll</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the maximum number of messages to gather per poll. By default, no maximum is set. Can be used to set a limit of e.g. 1000 to avoid downloading thousands of files when the server starts up. Set a value of 0 or negative to disable this option.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>javaMailSender</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies a pluggable <span style="color: rgb(34,34,34);">org.apache.camel.component.</span><span style="color: rgb(34,34,34);">mail.JavaMailSender</span> instance in order to use a custom email implementation.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ignoreUnsupportedCharset</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Option to let Camel ignore unsupported charset in the local JVM when sending mails. If the charset is unsupported then <code>charset=XXX</code> (where <code>XXX</code> represents the unsupported charset) is removed from the <code>content-type</code> and it relies on the platform default instead.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sslContextParameters</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Reference to a <code>org.apache.camel.util.jsse.SSLContextParameters</code> in the <a shape="rect" class="external-link" href="http://camel.apache.org/registry.html">Registry</a>.&#160; This reference overrides any configured SSLContextParameters at the component level.&#160; See <a shape="rect" class="external-link" href="http://camel.apache.org/http4.html#HTTP4-UsingtheJSSEConfigurationUtility">Using the JSSE Configuration Utility</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>searchTerm</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> Refers to a <code>javax.mail.search.SearchTerm</code> which allows to filter mails based on search criteria such as subject, body, from, sent after a certain date etc. See further below for examples.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>searchTerm.xxx</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> To configure search terms directly from the endpoint uri, which supports a limited number of terms defined by the <code>org.apache.camel.component.mail.SimpleSearchTerm</code> class. See further below for examples.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="p1"><code>sortTerm</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>null</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.15: </strong>To configure the sortTerms that <span>IMAP</span> supports to sort the searched mails<strong><strong>. </strong></strong>You may need to define an array of<p class="p1"><code>com.sun.mail.imap.sortTerm</code> i<span>n the registry first and #name to reference it in this URI option.</span></p><p class="p1"><strong>Camel 2.16:</strong> You can also specify a comma separated list of sort terms on the URI that Camel will convert internally. For example, to sort descending by date you would use <code>sortTerm=reverse,date</code>. You can use any of the sort terms defined in <a shape="rect" class="external-link" href="https://javamail.java.net/nonav/docs/api/com/sun/mail/imap/SortTerm.html" rel="nofollow">com.sun.mail.imap.SortTerm</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="p1"><code>postProcessAction</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>null</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.15:</strong> Refers to a<code style="line-height: 1.4285715;">org.apache.camel.component.mail.</code><span style="line-height: 1.4285715;"><code>MailBoxPostProcessAction</code> for doing post processing tasks on the mailbox once the normal processing ended.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>skipFailedMessage</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.15.1:</strong> If the mail consumer cannot retrieve a given mail message, then this option allows to skip the message and move on to retrieve the next mail message. The default behavior would be the consumer throws an exception and no mails from the batch would be able to be routed by Camel.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>handleFailedMessage</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.15.1:</strong> If the mail consumer cannot retrieve a given mail message, then this option allows to handle the caused exception by the consumer's error handler. By enable the bridge error handler on the consumer, then the Camel routing error handler can handle the exception instead. <span>The default behavior would be the consumer throws an exception and no mails from the batch would be able to be routed by Camel.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><pre><span>dummyTrustManager</span></pre></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.17:</strong>To use a dummy security setting for trusting all certificates. Should only be used for development mode, and not production.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>idempotentRepository</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>null</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.17:</strong> A pluggable repository org.apache.camel.spi.IdempotentRepository which allows to cluster consuming from the same mailbox, and let the repository coordinate whether a mail message is valid for the consumer to process.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>idempotentRepositoryRemoveOnCommit</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>true</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.17:</strong> <span style="line-height: 1.42857;">When using idempotent repository, then when the mail message has been successfully processed and is committed, should the message id be removed from the idempotent repository (default) or be kept in the repository. By default its assumed the message id is unique and has no value to be kept in the repository, because the mail message will be marked as seen/moved or deleted to prevent it from being consumed again. And therefore having the message id stored in the idempotent repository has little value. However this option allows to store the message id, for whatever reason you may have.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>mailUidGenerator</code></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.17:</strong> A pluggable MailUidGenerator that allows to use custom logic to generate UUID of the mail message.</td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-SSLsupport">SSL support</h3><p>The underlying mail framework is responsible for providing SSL support. &#160;You may either configure SSL/TLS support by completely specifying the necessary Java Mail API configuration options, or you may provide a configured SSLContextParameters through the component or endpoint configuration.</p><h4 id="BookInOnePage-UsingtheJSSEConfigurationUtility.4">Using the JSSE Configuration Utility</h4><p>As of <strong>Camel 2.10</strong>, the mail component supports SSL/TLS configuration through the <a shape="rect" href="camel-configuration-utilities.html">Camel JSSE Configuration Utility</a>.&#160; This utility greatly decreases the amount of component specific code you need to write and is configurable at the endpoint and component levels.&#160; The following examples demonstrate how to use the utility with the mail component.</p><h5 id="BookInOnePage-Programmaticconfigurationoftheendpoint.1">Programmatic configuration of the endpoint</h5><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">KeyStoreParameters ksp = new KeyStoreParameters(); ksp.setResource(&amp;quot;/users/home/server/truststore.jks&amp;quot;); ksp.setPassword(&amp;quot;keystorePassword&amp;quot;); TrustManagersParameters tmp = new TrustManagersParameters(); tmp.setKeyStore(ksp); SSLContextParameters scp = new SSLContextParameters(); scp.setTrustManagers(tmp); Registry registry = ... registry.bind(&amp;quot;sslContextParameters&amp;quot;, scp); ... from(...) &amp;amp;nbsp; &amp;amp;nbsp; .to(&amp;quot;smtps://smtp.google.com?username=user@gmail.com&amp;amp;password=password&amp;amp;sslContextParameters=#sslContextParameters&amp;quot;); </script> 
 </div>
</div><h5 id="BookInOnePage-SpringDSLbasedconfigurationofendpoint.3">Spring DSL based configuration of endpoint</h5><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">... &amp;lt;camel:sslContextParameters id=&amp;quot;sslContextParameters&amp;quot;&amp;gt; &amp;lt;camel:trustManagers&amp;gt; &amp;lt;camel:keyStore resource=&amp;quot;/users/home/server/truststore.jks&amp;quot; password=&amp;quot;keystorePassword&amp;quot;/&amp;gt; &amp;lt;/camel:trustManagers&amp;gt; &amp;lt;/camel:sslContextParameters&amp;gt;... ... &amp;lt;to uri=&amp;quot;smtps://smtp.google.com?username=user@gmail.com&amp;amp;password=password&amp;amp;sslContextParameters=#sslContextParameters&amp;quot;/&amp;gt;... </script> 
 </div>
</div><h4 id="BookInOnePage-ConfiguringJavaMailDirectly">Configuring JavaMail Directly</h4><p>Camel uses SUN JavaMail, which only trusts certificates issued by well known Certificate Authorities (the default JVM trust configuration). If you issue your own certificates, you have to import the CA certificates into the JVM's Java trust/key store files, override the default JVM trust/key store files (see <code>SSLNOTES.txt</code> in JavaMail for details).</p><h3 id="BookInOnePage-MailMessageContent">Mail Message Content</h3><p>Camel uses the message exchange's IN body as the <a shape="rect" class="external-link" href="http://java.sun.com/javaee/5/docs/api/javax/mail/internet/MimeMessage.html" rel="nofollow">MimeMessage</a> text content. The body is converted to <code>String.class</code>.</p><p>Camel copies all of the exchange's IN headers to the <a shape="rect" class="external-link" href="http://java.sun.com/javaee/5/docs/api/javax/mail/internet/MimeMessage.html" rel="nofollow">MimeMessage</a> headers.&#160;You may wish to read&#160;<a shape="rect" href="how-to-avoid-sending-some-or-all-message-headers.html">How to avoid sending some or all message headers</a> to prevent inadvertent data "leaks" from your application.</p><p>The subject of the <a shape="rect" class="external-link" href="http://java.sun.com/javaee/5/docs/api/javax/mail/internet/MimeMessage.html" rel="nofollow">MimeMessage</a> can be configured using a header property on the IN message. The code below demonstrates this:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:a&amp;quot;).setHeader(&amp;quot;subject&amp;quot;, constant(subject)).to(&amp;quot;smtp://james2@localhost&amp;quot;); </script> 
  </div>
 </div>The same applies for other MimeMessage headers such as recipients, so you can use a header property as <code>To</code>:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> Map&amp;lt;String, Object&amp;gt; map = new HashMap&amp;lt;String, Object&amp;gt;(); map.put(&amp;quot;To&amp;quot;, &amp;quot;davsclaus@apache.org&amp;quot;); map.put(&amp;quot;From&amp;quot;, &amp;quot;jstrachan@apache.org&amp;quot;); map.put(&amp;quot;Subject&amp;quot;, &amp;quot;Camel rocks&amp;quot;); map.put(&amp;quot;CamelFileName&amp;quot;, &amp;quot;fileOne&amp;quot;); map.put(&amp;quot;org.apache.camel.test&amp;quot;, &amp;quot;value&amp;quot;); String body = &amp;quot;Hello Claus.\nYes it does.\n\nRegards James.&amp;quot;; template.sendBodyAndHeaders(&amp;quot;smtp://davsclaus@apache.org&amp;quot;, body, map); </script> 
  </div>
 </div><strong>Since Camel 2.11</strong> When using the MailProducer the send the mail to server, you should be able to get the message id of the <a shape="rect" class="external-link" href="http://java.sun.com/javaee/5/docs/api/javax/mail/internet/MimeMessage.html" rel="nofollow">MimeMessage</a> with the key <code>CamelMailMessageId</code> from the Camel message header.<h3 id="BookInOnePage-Headerstakeprecedenceoverpre-configuredrecipients">Headers take precedence over pre-configured recipients</h3><p>The recipients specified in the message headers always take precedence over recipients pre-configured in the endpoint URI. The idea is that if you provide any recipients in the message headers, that is what you get. The recipients pre-configured in the endpoint URI are treated as a fallback.</p><p>In the sample code below, the email message is sent to <code>davsclaus@apache.org</code>, because it takes precedence over the pre-configured recipient, <code>info@mycompany.com</code>. Any <code>cc</code> and <code>bcc</code> settings in the endpoint URI are also ignored and those recipients will not receive any mail. The choice between headers and pre-configured settings is all or nothing: the mail component <em>either</em> takes the recipients exclusively from the headers or exclusively from the pre-configured settings. It is not possible to mix and match headers and pre-configured settings.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> Map&amp;lt;String, Object&amp;gt; headers = new HashMap&amp;lt;String, Object&amp;gt;(); headers.put(&amp;quot;to&amp;quot;, &amp;quot;davsclaus@apache.org&amp;quot;); template.sendBodyAndHeaders(&amp;quot;smtp://admin@localhost?to=info@mycompany.com&amp;quot;, &amp;quot;Hello World&amp;quot;, headers); </script> 
 </div>
</div><h3 id="BookInOnePage-Multiplerecipientsforeasierconfiguration">Multiple recipients for easier configuration</h3><p>It is possible to set multiple recipients using a comma-separated or a semicolon-separated list. This applies both to header settings and to settings in an endpoint URI. For example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> Map&amp;lt;String, Object&amp;gt; headers = new HashMap&amp;lt;String, Object&amp;gt;(); headers.put(&amp;quot;to&amp;quot;, &amp;quot;davsclaus@apache.org ; jstrachan@apache.org ; ningjiang@apache.org&amp;quot;); </script> 
 </div>
</div><p>The preceding example uses a semicolon, <code>;</code>, as the separator character.</p><h3 id="BookInOnePage-Settingsendernameandemail">Setting sender name and email</h3><p>You can specify recipients in the format, <code>name &lt;email&gt;</code>, to include both the name and the email address of the recipient.</p><p>For example, you define the following headers on the a <a shape="rect" href="message.html">Message</a>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Map headers = new HashMap(); map.put(&amp;quot;To&amp;quot;, &amp;quot;Claus Ibsen &amp;lt;davsclaus@apache.org&amp;gt;&amp;quot;); map.put(&amp;quot;From&amp;quot;, &amp;quot;James Strachan &amp;lt;jstrachan@apache.org&amp;gt;&amp;quot;); map.put(&amp;quot;Subject&amp;quot;, &amp;quot;Camel is cool&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-JavaMailAPI(exSUNJavaMail)">JavaMail API (ex SUN JavaMail)</h3><p><a shape="rect" class="external-link" href="https://java.net/projects/javamail/pages/Home" rel="nofollow">JavaMail API</a> is used under the hood for consuming and producing mails.<br clear="none"> We encourage end-users to consult these references when using either POP3 or IMAP protocol. Note particularly that POP3 has a much more limited set of features than IMAP.</p><ul class="alternate"><li><a shape="rect" class="external-link" href="https://javamail.java.net/nonav/docs/api/com/sun/mail/pop3/package-summary.html" rel="nofollow">JavaMail POP3 API</a></li><li><a shape="rect" class="external-link" href="https://javamail.java.net/nonav/docs/api/com/sun/mail/imap/package-summary.html" rel="nofollow">JavaMail IMAP API</a></li><li>And generally about the <a shape="rect" class="external-link" href="https://javamail.java.net/nonav/docs/api/javax/mail/Flags.html" rel="nofollow">MAIL Flags</a></li></ul><h3 id="BookInOnePage-Samples.13">Samples</h3><p>We start with a simple route that sends the messages received from a JMS queue as emails. The email account is the <code>admin</code> account on <code>mymailserver.com</code>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;jms://queue:subscription&amp;quot;).to(&amp;quot;smtp://admin@mymailserver.com?password=secret&amp;quot;); </script> 
 </div>
</div><p>In the next sample, we poll a mailbox for new emails once every minute. Notice that we use the special <code>consumer</code> option for setting the poll interval, <code>consumer.delay</code>, as 60000 milliseconds = 60 seconds.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;imap://admin@mymailserver.com password=secret&amp;amp;unseen=true&amp;amp;consumer.delay=60000&amp;quot;) .to(&amp;quot;seda://mails&amp;quot;); </script> 
 </div>
</div><p>In this sample we want to send a mail to multiple recipients:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // all the recipients of this mail are: // to: camel@riders.org , easy@riders.org // cc: me@you.org // bcc: someone@somewhere.org String recipients = &amp;quot;&amp;amp;to=camel@riders.org,easy@riders.org&amp;amp;cc=me@you.org&amp;amp;bcc=someone@somewhere.org&amp;quot;; from(&amp;quot;direct:a&amp;quot;).to(&amp;quot;smtp://you@mymailserver.com?password=secret&amp;amp;from=you@apache.org&amp;quot; + recipients); </script> 
  </div>
 </div><h3 id="BookInOnePage-Sendingmailwithattachmentsample">Sending mail with attachment sample</h3><div class="confluence-information-macro confluence-information-macro-warning">
 <p class="title">Attachments are not support by all Camel components</p>
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The <em>Attachments API</em> is based on the Java Activation Framework and is generally only used by the Mail API. Since many of the other Camel components do not support attachments, the attachments could potentially be lost as they propagate along the route. The rule of thumb, therefore, is to add attachments just before sending a message to the mail endpoint.</p>
 </div>
</div><p>The mail component supports attachments. In the sample below, we send a mail message containing a plain text message with a logo file attachment.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // create an exchange with a normal body and attachment to be produced as email Endpoint endpoint = context.getEndpoint(&amp;quot;smtp://james@mymailserver.com?password=secret&amp;quot;); // create the exchange with the mail message that is multipart with a file and a Hello World text/plain message. Exchange exchange = endpoint.createExchange(); Message in = exchange.getIn(); in.setBody(&amp;quot;Hello World&amp;quot;); DefaultAttachment att = new DefaultAttachment(new FileDataSource(&amp;quot;src/test/data/logo.jpeg&amp;quot;)); att.addHeader(&amp;quot;Content-Description&amp;quot;, &amp;quot;some sample content&amp;quot;); in.addAttachmentObject(&amp;quot;logo.jpeg&amp;quot;, att); // create a producer that can produce the exchange (= send the mail) Producer producer = endpoint.createProducer(); // start the producer producer.start(); // and let it go (processes the exchange by sending the email) producer.process(exchange); </script> 
  </div>
 </div><h3 id="BookInOnePage-SSLsample">SSL sample</h3><p>In this sample, we want to poll our Google mail inbox for mails. To download mail onto a local mail client, Google mail requires you to enable and configure SSL. This is done by logging into your Google mail account and changing your settings to allow IMAP access. Google have extensive documentation on how to do this.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;imaps://imap.gmail.com?username=YOUR_USERNAME@gmail.com&amp;amp;password=YOUR_PASSWORD&amp;quot; + &amp;quot;&amp;amp;delete=false&amp;amp;unseen=true&amp;amp;consumer.delay=60000&amp;quot;).to(&amp;quot;log:newmail&amp;quot;); </script> 
 </div>
</div><p>The preceding route polls the Google mail inbox for new mails once every minute and logs the received messages to the <code>newmail</code> logger category.<br clear="none"> Running the sample with <code>DEBUG</code> logging enabled, we can monitor the progress in the logs:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">2008-05-08 06:32:09,640 DEBUG MailConsumer - Connecting to MailStore imaps//imap.gmail.com:993 (SSL enabled), folder=INBOX 2008-05-08 06:32:11,203 DEBUG MailConsumer - Polling mailfolder: imaps//imap.gmail.com:993 (SSL enabled), folder=INBOX 2008-05-08 06:32:11,640 DEBUG MailConsumer - Fetching 1 messages. Total 1 messages. 2008-05-08 06:32:12,171 DEBUG MailConsumer - Processing message: messageNumber=[332], from=[James Bond &amp;lt;007@mi5.co.uk&amp;gt;], to=YOUR_USERNAME@gmail.com], subject=[... 2008-05-08 06:32:12,187 INFO newmail - Exchange[MailMessage: messageNumber=[332], from=[James Bond &amp;lt;007@mi5.co.uk&amp;gt;], to=YOUR_USERNAME@gmail.com], subject=[... </script> 
 </div>
</div><h3 id="BookInOnePage-Consumingmailswithattachmentsample">Consuming mails with attachment sample</h3><p>In this sample we poll a mailbox and store all attachments from the mails as files. First, we define a route to poll the mailbox. As this sample is based on google mail, it uses the same route as shown in the SSL sample:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;imaps://imap.gmail.com?username=YOUR_USERNAME@gmail.com&amp;amp;password=YOUR_PASSWORD&amp;quot; + &amp;quot;&amp;amp;delete=false&amp;amp;unseen=true&amp;amp;consumer.delay=60000&amp;quot;).process(new MyMailProcessor()); </script> 
 </div>
</div><p>Instead of logging the mail we use a processor where we can process the mail from java code:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public void process(Exchange exchange) throws Exception { // the API is a bit clunky so we need to loop Map&amp;lt;String, DataHandler&amp;gt; attachments = exchange.getIn().getAttachments(); if (attachments.size() &amp;gt; 0) { for (String name : attachments.keySet()) { DataHandler dh = attachments.get(name); // get the file name String filename = dh.getName(); // get the content and convert it to byte[] byte[] data = exchange.getContext().getTypeConverter() .convertTo(byte[].class, dh.getInputStream()); // write the data to a file FileOutputStream out = new FileOutputStream(filename); out.write(data); out.flush(); out.close(); } } } </script> 
 </div>
</div><p>As you can see the API to handle attachments is a bit clunky but it's there so you can get the <code>javax.activation.DataHandler</code> so you can handle the attachments using standard API.</p><h3 id="BookInOnePage-Howtosplitamailmessagewithattachments">How to split a mail message with attachments</h3><p>In this example we consume mail messages which may have a number of attachments. What we want to do is to use the <a shape="rect" href="splitter.html">Splitter</a> EIP per individual attachment, to process the attachments separately. For example if the mail message has 5 attachments, we want the <a shape="rect" href="splitter.html">Splitter</a> to process five messages, each having a single attachment. To do this we need to provide a custom <a shape="rect" href="expression.html">Expression</a> to the <a shape="rect" href="splitter.html">Splitter</a> where we provide a List&lt;Message&gt; that contains the five messages with the single attachment.</p><p>The code is provided out of the box in Camel 2.10 onwards in the <code>camel-mail</code> component. The code is in the class: <code>org.apache.camel.component.mail.SplitAttachmentsExpression</code>, which you can find the source code <a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/camel/trunk/components/camel-mail/src/main/java/org/apache/camel/component/mail/SplitAttachmentsExpression.java">here</a></p><p>In the Camel route you then need to use this <a shape="rect" href="expression.html">Expression</a> in the route as shown below:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;pop3://james@mymailserver.com?password=secret&amp;amp;consumer.delay=1000&amp;quot;) .to(&amp;quot;log:email&amp;quot;) // use the SplitAttachmentsExpression which will split the message per attachment .split(splitAttachmentsExpression) // each message going to this mock has a single attachment .to(&amp;quot;mock:split&amp;quot;) .end(); </script> 
  </div>
 </div>If you use XML DSL then you need to declare a method call expression in the <a shape="rect" href="splitter.html">Splitter</a> as shown below<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;split&amp;gt; &amp;lt;method beanType=&amp;quot;org.apache.camel.component.mail.SplitAttachmentsExpression&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:split&amp;quot;/&amp;gt; &amp;lt;/split&amp;gt; </script> 
 </div>
</div><p>&#160;</p><p>From Camel 2.16 onwards you can also split the attachments as byte[] to be stored as the message body. This is done by creating the expression with boolean true</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">SplitAttachmentsExpression split = SplitAttachmentsExpression(true);</script> 
 </div>
</div><p>And then use the expression with the splitter eip.</p><h3 id="BookInOnePage-UsingcustomSearchTerm">Using custom SearchTerm</h3><p><strong>Available as of Camel 2.11</strong></p><p>You can configure a <code>searchTerm</code> on the <code>MailEndpoint</code> which allows you to filter out unwanted mails.</p><p>For example to filter mails to contain Camel in either Subject or Text you can do as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;imaps://mymailseerver?username=foo&amp;amp;password=secret&amp;amp;searchTerm.subjectOrBody=Camel&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:myBean&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>Notice we use the <code>"searchTerm.subjectOrBody"</code> as parameter key to indicate that we want to search on mail subject or body, to contain the word "Camel".<br clear="none"> The class <code>org.apache.camel.component.mail.SimpleSearchTerm</code> has a number of options you can configure:</p><p>Or to get the new unseen emails going 24 hours back in time you can do. Notice the "now-24h" syntax. See the table below for more details.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;imaps://mymailseerver?username=foo&amp;amp;password=secret&amp;amp;searchTerm.fromSentDate=now-24h&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:myBean&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>You can have multiple searchTerm in the endpoint uri configuration. They would then be combined together using AND operator, eg so both conditions must match. For example to get the last unseen emails going back 24 hours which has Camel in the mail subject you can do:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;imaps://mymailseerver?username=foo&amp;amp;password=secret&amp;amp;searchTerm.subject=Camel&amp;amp;searchTerm.fromSentDate=now-24h&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:myBean&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>unseen</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether to limit by unseen mails only.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>subjectOrBody</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To limit by subject or body to contain the word.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>subject</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The subject must contain the word.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>body</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The body must contain the word.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>from</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The mail must be from a given email pattern.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>to</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The mail must be to a given email pattern.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>fromSentDate</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The mail must be sent after or equals (GE) a given date. The date pattern is <code>yyyy-MM-dd HH:mm:SS</code>, eg use <code>"2012-01-01 00:00:00"</code> to be from the year 2012 onwards. You can use <code>"now"</code> for current timestamp. The "now" syntax supports an optional offset, that can be specified as either + or - with a numeric value. For example for last 24 hours, you can use <code>"now - 24h"</code> or without spaces <code>"now-24h"</code>. Notice that Camel supports shorthands for hours, minutes, and seconds.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>toSentDate</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The mail must be sent before or equals (BE) a given date. The date pattern is <code>yyyy-MM-dd HH:mm:SS</code>, eg use <code>"2012-01-01 00:00:00"</code> to be before the year 2012. You can use <code>"now"</code> for current timestamp. The "now" syntax supports an optional offset, that can be specified as either + or - with a numeric value. For example for last 24 hours, you can use <code>"now - 24h"</code> or without spaces <code>"now-24h"</code>. Notice that Camel supports shorthands for hours, minutes, and seconds.</p></td></tr></tbody></table> 
 </div>
</div><p>The <code>SimpleSearchTerm</code> is designed to be easily configurable from a POJO, so you can also configure it using a &lt;bean&gt; style in XML</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;mySearchTerm&amp;quot; class=&amp;quot;org.apache.camel.component.mail.SimpleSearchTerm&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;subject&amp;quot; value=&amp;quot;Order&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;to&amp;quot; value=&amp;quot;acme-order@acme.com&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;fromSentDate&amp;quot; value=&amp;quot;now&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>You can then refer to this bean, using #beanId in your Camel route as shown:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;imaps://mymailseerver?username=foo&amp;amp;password=secret&amp;amp;searchTerm=#mySearchTerm&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:myBean&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>In Java there is a builder class to build compound <code>SearchTerm}}s using the {{org.apache.camel.component.mail.SearchTermBuilder</code> class.<br clear="none"> This allows you to build complex terms such as:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// we just want the unseen mails which is not spam SearchTermBuilder builder = new SearchTermBuilder(); builder.unseen().body(Op.not, &amp;quot;Spam&amp;quot;).subject(Op.not, &amp;quot;Spam&amp;quot;) // which was sent from either foo or bar .from(&amp;quot;foo@somewhere.com&amp;quot;).from(Op.or, &amp;quot;bar@somewhere.com&amp;quot;); // .. and we could continue building the terms SearchTerm term = builder.build(); </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.59">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-MINAComponent">MINA Component</h2><p><strong>Deprecated</strong></p><div class="confluence-information-macro confluence-information-macro-warning">
 <p class="title">Deprecated</p>
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>This component is deprecated as the Apache Mina 1.x project is EOL. Instead use <a shape="rect" href="mina2.html">MINA2</a> or <a shape="rect" href="netty.html">Netty</a> instead.</p>
 </div>
</div><p>The <strong>mina:</strong> component is a transport for working with <a shape="rect" class="external-link" href="http://mina.apache.org/">Apache MINA</a></p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-mina&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.41">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">mina:tcp://hostname[:port][?options] mina:udp://hostname[:port][?options] mina:vm://hostname[:port][?options] </script> 
 </div>
</div><p>You can specify a codec in the <a shape="rect" href="registry.html">Registry</a> using the <strong>codec</strong> option. If you are using TCP and no codec is specified then the <code>textline</code> flag is used to determine if text line based codec or object serialization should be used instead. By default the object serialization is used.</p><p>For UDP if no codec is specified the default uses a basic <code>ByteBuffer</code> based codec.</p><p>The VM protocol is used as a direct forwarding mechanism in the same JVM. See the <a shape="rect" class="external-link" href="http://mina.apache.org/report/1.1/apidocs/org/apache/mina/transport/vmpipe/package-summary.html">MINA VM-Pipe API documentation</a> for details.</p><p>A Mina producer has a default timeout value of 30 seconds, while it waits for a response from the remote server.</p><p>In normal use, <code>camel-mina</code> only supports marshalling the body content&#8212;message headers and exchange properties are not sent.<br clear="none"> However, the option, <strong>transferExchange</strong>, does allow you to transfer the exchange itself over the wire. See options below.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.53">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>codec</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>You can refer to a named <code>ProtocolCodecFactory</code> instance in your <a shape="rect" href="registry.html">Registry</a> such as your Spring <code>ApplicationContext</code>, which is then used for the marshalling.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>codec</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>You must use the <code>#</code> notation to look up your codec in the <a shape="rect" href="registry.html">Registry</a>. For example, use <code>#myCodec</code> to look up a bean with the <code>id</code> value, <code>myCodec</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>disconnect</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> Whether or not to disconnect(close) from Mina session right after use. Can be used for both consumer and producer.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>textline</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Only used for TCP. If no codec is specified, you can use this flag to indicate a text line based codec; if not specified or the value is <code>false</code>, then Object Serialization is assumed over TCP.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>textlineDelimiter</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>DEFAULT</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Only used for TCP and if <strong>textline=true</strong>. Sets the text line delimiter to use. Possible values are: <code>DEFAULT</code>, <code>AUTO</code>, <code>WINDOWS</code>, <code>UNIX</code> or <code>MAC</code>. If none provided, Camel will use <code>DEFAULT</code>. This delimiter is used to mark the end of text.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sync</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Setting to set endpoint as one-way or request-response.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>lazySessionCreation</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sessions can be lazily created to avoid exceptions, if the remote server is not up and running when the Camel producer is started.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>timeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>30000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>You can configure the timeout that specifies how long to wait for a response from a remote server. The timeout unit is in milliseconds, so 60000 is 60 seconds. The timeout is only used for Mina producer.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>encoding</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em>JVM Default</em></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>You can configure the encoding (a <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/nio/charset/Charset.html" rel="nofollow">charset name</a>) to use for the TCP textline codec and the UDP protocol. If not provided, Camel will use the <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/nio/charset/Charset.html#defaultCharset()" rel="nofollow">JVM default Charset</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transferExchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Only used for TCP. You can transfer the exchange over the wire instead of just the body. The following fields are transferred: In body, Out body, fault body, In headers, Out headers, fault headers, exchange properties, exchange exception. This requires that the objects are <em>serializable</em>. Camel will exclude any non-serializable objects and log it at <code>WARN</code> level.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>minaLogger</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>You can enable the Apache MINA logging filter. Apache MINA uses <code>slf4j</code> logging at <code>INFO</code> level to log all input and output.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>filters</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>You can set a list of <a shape="rect" class="external-link" href="http://mina.apache.org/iofilter.html">Mina IoFilters</a> to register. The <code>filters</code> value must be one of the following:</p> 
      <ul><li><strong>Camel 2.2:</strong> comma-separated list of bean references (e.g. <code>#filterBean1,#filterBean2</code>) where each bean must be of type <code>org.apache.mina.common.IoFilter</code>.</li><li><strong>before Camel 2.2:</strong> a reference to a bean of type <code>List&lt;org.apache.mina.common.IoFilter&gt;</code>.</li></ul></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>encoderMaxLineLength</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>-1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>As of 2.1, you can set the textline protocol encoder max line length. By default the default value of Mina itself is used which are <code>Integer.MAX_VALUE</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>decoderMaxLineLength</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>-1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>As of 2.1, you can set the textline protocol decoder max line length. By default the default value of Mina itself is used which are 1024.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>producerPoolSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>16</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The TCP producer is thread safe and supports concurrency much better. This option allows you to configure the number of threads in its thread pool for concurrent producers. <strong>Note:</strong> Camel has a pooled service which ensured it was already thread safe and supported concurrency already.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>allowDefaultCodec</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The mina component installs a default codec if both, <code>codec</code> is <code>null</code> and <code>textline</code> is <code>false</code>. Setting <code>allowDefaultCodec</code> to <code>false</code> prevents the mina component from installing a default codec as the first element in the filter chain. This is useful in scenarios where another filter must be the first in the filter chain, like the SSL filter.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>disconnectOnNoReply</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> If sync is enabled then this option dictates MinaConsumer if it should disconnect where there is no reply to send back.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>noReplyLogLevel</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>WARN</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> If sync is enabled this option dictates MinaConsumer which logging level to use when logging a there is no reply to send back. Values are: <code>FATAL, ERROR, INFO, DEBUG, OFF</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>clientMode</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.15:</strong> Consumer only. If the <code>clientMode</code> is true, mina consumer will connect the address as a TCP client.</td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Usingacustomcodec">Using a custom codec</h3><p>See the <a shape="rect" class="external-link" href="http://mina.apache.org/tutorial-on-protocolcodecfilter.html">Mina documentation</a> how to write your own codec. To use your custom codec with <code>camel-mina</code>, you should register your codec in the <a shape="rect" href="registry.html">Registry</a>; for example, by creating a bean in the Spring XML file. Then use the <code>codec</code> option to specify the bean ID of your codec. See <a shape="rect" href="hl7.html">HL7</a> that has a custom codec.</p><h3 id="BookInOnePage-Samplewithsync=false">Sample with sync=false</h3><p>In this sample, Camel exposes a service that listens for TCP connections on port 6200. We use the <strong>textline</strong> codec. In our route, we create a Mina consumer endpoint that listens on port 6200:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;mina:tcp://localhost:&amp;quot; + port1 + &amp;quot;?textline=true&amp;amp;sync=false&amp;quot;).to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>As the sample is part of a unit test, we test it by sending some data to it on port 6200.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> MockEndpoint mock = getMockEndpoint(&amp;quot;mock:result&amp;quot;); mock.expectedBodiesReceived(&amp;quot;Hello World&amp;quot;); template.sendBody(&amp;quot;mina:tcp://localhost:&amp;quot; + port1 + &amp;quot;?textline=true&amp;amp;sync=false&amp;quot;, &amp;quot;Hello World&amp;quot;); assertMockEndpointsSatisfied(); </script> 
 </div>
</div><h3 id="BookInOnePage-Samplewithsync=true">Sample with sync=true</h3><p>In the next sample, we have a more common use case where we expose a TCP service on port 6201 also use the textline codec. However, this time we want to return a response, so we set the <code>sync</code> option to <code>true</code> on the consumer.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;mina:tcp://localhost:&amp;quot; + port2 + &amp;quot;?textline=true&amp;amp;sync=true&amp;quot;).process(new Processor() { public void process(Exchange exchange) throws Exception { String body = exchange.getIn().getBody(String.class); exchange.getOut().setBody(&amp;quot;Bye &amp;quot; + body); } }); </script> 
 </div>
</div><p>Then we test the sample by sending some data and retrieving the response using the <code>template.requestBody()</code> method. As we know the response is a <code>String</code>, we cast it to <code>String</code> and can assert that the response is, in fact, something we have dynamically set in our processor code logic.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> String response = (String)template.requestBody(&amp;quot;mina:tcp://localhost:&amp;quot; + port2 + &amp;quot;?textline=true&amp;amp;sync=true&amp;quot;, &amp;quot;World&amp;quot;); assertEquals(&amp;quot;Bye World&amp;quot;, response); </script> 
 </div>
</div><h3 id="BookInOnePage-SamplewithSpringDSL">Sample with Spring DSL</h3><p>Spring DSL can, of course, also be used for <a shape="rect" href="mina.html">MINA</a>. In the sample below we expose a TCP server on port 5555:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;mina:tcp://localhost:5555?textline=true&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:myTCPOrderHandler&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>In the route above, we expose a TCP server on port 5555 using the textline codec. We let the Spring bean with ID, <code>myTCPOrderHandler</code>, handle the request and return a reply. For instance, the handler bean could be implemented as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public String handleOrder(String payload) { ... return &amp;quot;Order: OK&amp;quot; } </script> 
 </div>
</div><h3 id="BookInOnePage-ConfiguringMinaendpointsusingSpringbeanstyle">Configuring Mina endpoints using Spring bean style</h3><p>Configuration of Mina endpoints is possible using regular Spring bean style configuration in the Spring DSL.</p><p>However, in the underlying Apache Mina toolkit, it is relatively difficult to set up the acceptor and the connector, because you can <em>not</em> use simple setters. To resolve this difficulty, we leverage the <code>MinaComponent</code> as a Spring factory bean to configure this for us. If you really need to configure this yourself, there are setters on the <code>MinaEndpoint</code> to set these when needed.</p><p>The sample below shows the factory approach:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- Creating mina endpoints is a bit complex so we reuse MinaComponnet as a factory bean to create our endpoint, this is the easiest to do --&amp;gt; &amp;lt;bean id=&amp;quot;myMinaFactory&amp;quot; class=&amp;quot;org.apache.camel.component.mina.MinaComponent&amp;quot;&amp;gt; &amp;lt;!-- we must provide a camel context so we refer to it by its id --&amp;gt; &amp;lt;constructor-arg index=&amp;quot;0&amp;quot; ref=&amp;quot;myCamel&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;!-- This is our mina endpoint configured with spring, we will use the factory above to create it for us. The goal is to invoke the createEndpoint method with the mina configuration parameter we defined using the constructor-arg option --&amp;gt; &amp;lt;bean id=&amp;quot;myMinaEndpoint&amp;quot; factory-bean=&amp;quot;myMinaFactory&amp;quot; factory-method=&amp;quot;createEndpoint&amp;quot;&amp;gt; &amp;lt;!-- and here we can pass it our configuration --&amp;gt; &amp;lt;constructor-arg index=&amp;quot;0&amp;quot; ref=&amp;quot;myMinaConfig&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;!-- this is our mina configuration with plain properties --&amp;gt; &amp;lt;bean id=&amp;quot;myMinaConfig&amp;quot; class=&amp;quot;org.apache.camel.component.mina.MinaConfiguration&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;protocol&amp;quot; value=&amp;quot;tcp&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;host&amp;quot; value=&amp;quot;localhost&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;port&amp;quot; ref=&amp;quot;port&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;sync&amp;quot; value=&amp;quot;false&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>And then we can refer to our endpoint directly in the route, as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;!-- here we route from or mina endpoint we have defined above --&amp;gt; &amp;lt;from ref=&amp;quot;myMinaEndpoint&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-ClosingSessionWhenComplete">Closing Session When Complete</h3><p>When acting as a server you sometimes want to close the session when, for example, a client conversion is finished. To instruct Camel to close the session, you should add a header with the key <code>CamelMinaCloseSessionWhenComplete</code> set to a boolean <code>true</code> value.</p><p>For instance, the example below will close the session after it has written the <code>bye</code> message back to the client:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;mina:tcp://localhost:8080?sync=true&amp;amp;textline=true&amp;quot;).process(new Processor() { public void process(Exchange exchange) throws Exception { String body = exchange.getIn().getBody(String.class); exchange.getOut().setBody(&amp;quot;Bye &amp;quot; + body); exchange.getOut().setHeader(MinaConstants.MINA_CLOSE_SESSION_WHEN_COMPLETE, true); } }); </script> 
 </div>
</div><h3 id="BookInOnePage-GettheIoSessionformessage">Get the IoSession for message</h3><p><strong>Available since Camel 2.1</strong><br clear="none"> You can get the IoSession from the message header with this key MinaEndpoint.HEADER_MINA_IOSESSION, and also get the local host address with the key MinaEndpoint.HEADER_LOCAL_ADDRESS and remote host address with the key MinaEndpoint.HEADER_REMOTE_ADDRESS.</p><h3 id="BookInOnePage-ConfiguringMinafilters">Configuring Mina filters</h3><p>Filters permit you to use some Mina Filters, such as <code>SslFilter</code>. You can also implement some customized filters. Please note that <code>codec</code> and <code>logger</code> are also implemented as Mina filters of type, <code>IoFilter</code>. Any filters you may define are appended to the end of the filter chain; that is, after <code>codec</code> and <code>logger</code>.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>If using the <code>SslFilter</code> you need to add the <code>mina-filter-ssl</code> JAR to the classpath.</p>
 </div>
</div><p>For instance, the example below will send a keep-alive message after 10 seconds of inactivity:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public class KeepAliveFilter extends IoFilterAdapter { @Override public void sessionCreated(NextFilter nextFilter, IoSession session) throws Exception { session.setIdleTime(IdleStatus.BOTH_IDLE, 10); nextFilter.sessionCreated(session); } @Override public void sessionIdle(NextFilter nextFilter, IoSession session, IdleStatus status) throws Exception { session.write(&amp;quot;NOOP&amp;quot;); // NOOP is a FTP command for keep alive nextFilter.sessionIdle(session, status); } } </script> 
 </div>
</div><p>As Camel Mina may use a request-reply scheme, the endpoint as a client would like to drop some message, such as greeting when the connection is established. For example, when you connect to an FTP server, you will get a <code>220</code> message with a greeting (<code>220 Welcome to Pure-FTPd</code>). If you don't drop the message, your request-reply scheme will be broken.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public class DropGreetingFilter extends IoFilterAdapter { @Override public void messageReceived(NextFilter nextFilter, IoSession session, Object message) throws Exception { if (message instanceof String) { String ftpMessage = (String) message; // &amp;quot;220&amp;quot; is given as greeting. &amp;quot;200 Zzz&amp;quot; is given as a response to &amp;quot;NOOP&amp;quot; (keep alive) if (ftpMessage.startsWith(&amp;quot;220&amp;quot;) || or ftpMessage.startsWith(&amp;quot;200 Zzz&amp;quot;)) { // Dropping greeting return; } } nextFilter.messageReceived(session, message); } } </script> 
 </div>
</div><p>Then, you can configure your endpoint using Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;myMinaFactory&amp;quot; class=&amp;quot;org.apache.camel.component.mina.MinaComponent&amp;quot;&amp;gt; &amp;lt;constructor-arg index=&amp;quot;0&amp;quot; ref=&amp;quot;camelContext&amp;quot; /&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;myMinaEndpoint&amp;quot; factory-bean=&amp;quot;myMinaFactory&amp;quot; factory-method=&amp;quot;createEndpoint&amp;quot;&amp;gt; &amp;lt;constructor-arg index=&amp;quot;0&amp;quot; ref=&amp;quot;myMinaConfig&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;myMinaConfig&amp;quot; class=&amp;quot;org.apache.camel.component.mina.MinaConfiguration&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;protocol&amp;quot; value=&amp;quot;tcp&amp;quot; /&amp;gt; &amp;lt;property name=&amp;quot;host&amp;quot; value=&amp;quot;localhost&amp;quot; /&amp;gt; &amp;lt;property name=&amp;quot;port&amp;quot; value=&amp;quot;2121&amp;quot; /&amp;gt; &amp;lt;property name=&amp;quot;sync&amp;quot; value=&amp;quot;true&amp;quot; /&amp;gt; &amp;lt;property name=&amp;quot;minaLogger&amp;quot; value=&amp;quot;true&amp;quot; /&amp;gt; &amp;lt;property name=&amp;quot;filters&amp;quot; ref=&amp;quot;listFilters&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;listFilters&amp;quot; class=&amp;quot;java.util.ArrayList&amp;quot; &amp;gt; &amp;lt;constructor-arg&amp;gt; &amp;lt;list value-type=&amp;quot;org.apache.mina.common.IoFilter&amp;quot;&amp;gt; &amp;lt;bean class=&amp;quot;com.example.KeepAliveFilter&amp;quot;/&amp;gt; &amp;lt;bean class=&amp;quot;com.example.DropGreetingFilter&amp;quot;/&amp;gt; &amp;lt;/list&amp;gt; &amp;lt;/constructor-arg&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.60">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="mina2.html">MINA2</a></li><li><a shape="rect" href="netty.html">Netty</a></li></ul><h2 id="BookInOnePage-MockComponent.1">Mock Component</h2><p><a shape="rect" href="testing.html">Testing</a> of distributed and asynchronous processing is notoriously difficult. The <a shape="rect" href="mock.html">Mock</a>, <a shape="rect" href="test.html">Test</a> and <a shape="rect" href="dataset.html">DataSet</a> endpoints work great with the <a shape="rect" href="testing.html">Camel Testing Framework</a> to simplify your unit and integration testing using <a shape="rect" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a> and Camel's large range of <a shape="rect" href="components.html">Components</a> together with the powerful <a shape="rect" href="bean-integration.html">Bean Integration</a>.</p><p>The Mock component provides a powerful declarative testing mechanism, which is similar to <a shape="rect" class="external-link" href="http://www.jmock.org" rel="nofollow">jMock</a><a shape="rect" class="external-link" href="http://jmock.org" rel="nofollow"></a> in that it allows declarative expectations to be created on any Mock endpoint before a test begins. Then the test is run, which typically fires messages to one or more endpoints, and finally the expectations can be asserted in a test case to ensure the system worked as expected.</p><p>This allows you to test various things like:</p><ul><li>The correct number of messages are received on each endpoint,</li><li>The correct payloads are received, in the right order,</li><li>Messages arrive on an endpoint in order, using some <a shape="rect" href="expression.html">Expression</a> to create an order testing function,</li><li>Messages arrive match some kind of <a shape="rect" href="predicate.html">Predicate</a> such as that specific headers have certain values, or that parts of the messages match some predicate, such as by evaluating an <a shape="rect" href="xpath.html">XPath</a> or <a shape="rect" href="xquery.html">XQuery</a> <a shape="rect" href="expression.html">Expression</a>.</li></ul><p><strong>Note</strong> that there is also the <a shape="rect" href="test.html">Test endpoint</a> which is a Mock endpoint, but which uses a second endpoint to provide the list of expected message bodies and automatically sets up the Mock endpoint assertions. In other words, it's a Mock endpoint that automatically sets up its assertions from some sample messages in a <a shape="rect" href="file2.html">File</a> or <a shape="rect" href="jpa.html">database</a>, for example.</p><div class="confluence-information-macro confluence-information-macro-warning">
 <p class="title">Mock endpoints keep received Exchanges in memory indefinitely</p>
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Remember that Mock is designed for testing. When you add Mock endpoints to a route, each <a shape="rect" href="exchange.html">Exchange</a> sent to the endpoint will be stored (to allow for later validation) in memory until explicitly reset or the JVM is restarted. If you are sending high volume and/or large messages, this may cause excessive memory use. If your goal is to test deployable routes inline, consider using <a shape="rect" href="notifybuilder.html">NotifyBuilder</a> or <a shape="rect" href="advicewith.html">AdviceWith</a> in your tests instead of adding Mock endpoints to routes directly.</p>
  <p>From Camel 2.10 onwards there are two new options <code>retainFirst</code>, and <code>retainLast</code> that can be used to limit the number of messages the Mock endpoints keep in memory.</p>
 </div>
</div><h3 id="BookInOnePage-URIformat.42">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">mock:someName[?options] </script> 
 </div>
</div><p>Where <strong>someName</strong> can be any string that uniquely identifies the endpoint.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.54">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>reportGroup</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A size to use a <a shape="rect" href="log.html">throughput logger</a> for reporting</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>retainFirst</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> To only keep first X number of messages in memory.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>retainLast</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> To only keep last X number of messages in memory.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-SimpleExample.2">Simple Example</h3><p>Here's a simple example of Mock endpoint in use. First, the endpoint is resolved on the context. Then we set an expectation, and then, after the test has run, we assert that our expectations have been met.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">MockEndpoint resultEndpoint = context.resolveEndpoint(&amp;quot;mock:foo&amp;quot;, MockEndpoint.class); resultEndpoint.expectedMessageCount(2); // send some messages ... // now lets assert that the mock:foo endpoint received 2 messages resultEndpoint.assertIsSatisfied(); </script> 
 </div>
</div><p>You typically always call the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#assertIsSatisfied()">assertIsSatisfied() method</a> to test that the expectations were met after running a test.</p><p>Camel will by default wait 10 seconds when the <code>assertIsSatisfied()</code> is invoked. This can be configured by setting the <code>setResultWaitTime(millis)</code> method.</p><h4 id="BookInOnePage-UsingassertPeriod.1">Using assertPeriod</h4><p><strong>Available as of Camel 2.7</strong><br clear="none"> When the assertion is satisfied then Camel will stop waiting and continue from the <code>assertIsSatisfied</code> method. That means if a new message arrives on the mock endpoint, just a bit later, that arrival will not affect the outcome of the assertion. Suppose you do want to test that no new messages arrives after a period thereafter, then you can do that by setting the <code>setAssertPeriod</code> method, for example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">MockEndpoint resultEndpoint = context.resolveEndpoint(&amp;quot;mock:foo&amp;quot;, MockEndpoint.class); resultEndpoint.setAssertPeriod(5000); resultEndpoint.expectedMessageCount(2); // send some messages ... // now lets assert that the mock:foo endpoint received 2 messages resultEndpoint.assertIsSatisfied(); </script> 
 </div>
</div><h3 id="BookInOnePage-Settingexpectations.1">Setting expectations</h3><p>You can see from the javadoc of <a shape="rect" href="httphttp://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html" rel="nofollow">MockEndpoint</a> the various helper methods you can use to set expectations. The main methods are as follows:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Method</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#expectedMessageCount(int)">expectedMessageCount(int)</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To define the expected message count on the endpoint.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#expectedMinimumMessageCount(int)">expectedMinimumMessageCount(int)</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To define the minimum number of expected messages on the endpoint.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#expectedBodiesReceived(java.lang.Object...)">expectedBodiesReceived(...)</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To define the expected bodies that should be received (in order).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#expectedHeaderReceived(java.lang.String,%20java.lang.String)">expectedHeaderReceived(...)</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To define the expected header that should be received</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#expectsAscending(org.apache.camel.Expression)">expectsAscending(Expression)</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To add an expectation that messages are received in order, using the given <a shape="rect" href="expression.html">Expression</a> to compare messages.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#expectsDescending(org.apache.camel.Expression)">expectsDescending(Expression)</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To add an expectation that messages are received in order, using the given <a shape="rect" href="expression.html">Expression</a> to compare messages.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#expectsNoDuplicates(org.apache.camel.Expression)">expectsNoDuplicates(Expression)</a></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To add an expectation that no duplicate messages are received; using an <a shape="rect" href="expression.html">Expression</a> to calculate a unique identifier for each message. This could be something like the <code>JMSMessageID</code> if using JMS, or some unique reference number within the message.</p></td></tr></tbody></table> 
 </div>
</div><p>Here's another example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">resultEndpoint.expectedBodiesReceived(&amp;quot;firstMessageBody&amp;quot;, &amp;quot;secondMessageBody&amp;quot;, &amp;quot;thirdMessageBody&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-Addingexpectationstospecificmessages.1">Adding expectations to specific messages</h4><p>In addition, you can use the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#message(int)">message(int messageIndex)</a> method to add assertions about a specific message that is received.</p><p>For example, to add expectations of the headers or body of the first message (using zero-based indexing like <code>java.util.List</code>), you can use the following code:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">resultEndpoint.message(0).header(&amp;quot;foo&amp;quot;).isEqualTo(&amp;quot;bar&amp;quot;); </script> 
 </div>
</div><p>There are some examples of the Mock endpoint in use in the <a shape="rect" class="external-link" href="http://svn.apache.org/viewvc/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/">camel-core processor tests</a>.</p><h3 id="BookInOnePage-Mockingexistingendpoints.1">Mocking existing endpoints</h3><p><strong>Available as of Camel 2.7</strong></p><p>Camel now allows you to automatically mock existing endpoints in your Camel routes.</p><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">How it works</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p><strong>Important:</strong> The endpoints are still in action. What happens differently is that a <a shape="rect" href="mock.html">Mock</a> endpoint is injected and receives the message first and then delegates the message to the target endpoint. You can view this as a kind of intercept and delegate or endpoint listener.</p>
 </div>
</div><p>Suppose you have the given route below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>Route</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // tag::route[] @Override protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { @Override public void configure() throws Exception { from(&amp;quot;direct:start&amp;quot;).to(&amp;quot;direct:foo&amp;quot;).to(&amp;quot;log:foo&amp;quot;).to(&amp;quot;mock:result&amp;quot;); from(&amp;quot;direct:foo&amp;quot;).transform(constant(&amp;quot;Bye World&amp;quot;)); } }; } // end::route[] </script> 
 </div>
</div><p>You can then use the <code>adviceWith</code> feature in Camel to mock all the endpoints in a given route from your unit test, as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>adviceWith mocking all endpoints</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // tag::e1[] public void testAdvisedMockEndpoints() throws Exception { // advice the first route using the inlined AdviceWith route builder // which has extended capabilities than the regular route builder context.getRouteDefinitions().get(0).adviceWith(context, new AdviceWithRouteBuilder() { @Override public void configure() throws Exception { // mock all endpoints mockEndpoints(); } }); getMockEndpoint(&amp;quot;mock:direct:start&amp;quot;).expectedBodiesReceived(&amp;quot;Hello World&amp;quot;); getMockEndpoint(&amp;quot;mock:direct:foo&amp;quot;).expectedBodiesReceived(&amp;quot;Hello World&amp;quot;); getMockEndpoint(&amp;quot;mock:log:foo&amp;quot;).expectedBodiesReceived(&amp;quot;Bye World&amp;quot;); getMockEndpoint(&amp;quot;mock:result&amp;quot;).expectedBodiesReceived(&amp;quot;Bye World&amp;quot;); template.sendBody(&amp;quot;direct:start&amp;quot;, &amp;quot;Hello World&amp;quot;); assertMockEndpointsSatisfied(); // additional test to ensure correct endpoints in registry assertNotNull(context.hasEndpoint(&amp;quot;direct:start&amp;quot;)); assertNotNull(context.hasEndpoint(&amp;quot;direct:foo&amp;quot;)); assertNotNull(context.hasEndpoint(&amp;quot;log:foo&amp;quot;)); assertNotNull(context.hasEndpoint(&amp;quot;mock:result&amp;quot;)); // all the endpoints was mocked assertNotNull(context.hasEndpoint(&amp;quot;mock:direct:start&amp;quot;)); assertNotNull(context.hasEndpoint(&amp;quot;mock:direct:foo&amp;quot;)); assertNotNull(context.hasEndpoint(&amp;quot;mock:log:foo&amp;quot;)); } // end::e1[] </script> 
 </div>
</div><p>Notice that the mock endpoints is given the uri <code>mock:&lt;endpoint&gt;</code>, for example <code>mock:direct:foo</code>. Camel logs at <code>INFO</code> level the endpoints being mocked:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">INFO Adviced endpoint [direct://foo] with mock endpoint [mock:direct:foo] </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Mocked endpoints are without parameters</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Endpoints which are mocked will have their parameters stripped off. For example the endpoint "log:foo?showAll=true" will be mocked to the following endpoint "mock:log:foo". Notice the parameters have been removed.</p>
 </div>
</div><p>Its also possible to only mock certain endpoints using a pattern. For example to mock all <code>log</code> endpoints you do as shown:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>adviceWith mocking only log endpoints using a pattern</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // tag::e2[] public void testAdvisedMockEndpointsWithPattern() throws Exception { // advice the first route using the inlined AdviceWith route builder // which has extended capabilities than the regular route builder context.getRouteDefinitions().get(0).adviceWith(context, new AdviceWithRouteBuilder() { @Override public void configure() throws Exception { // mock only log endpoints mockEndpoints(&amp;quot;log*&amp;quot;); } }); // now we can refer to log:foo as a mock and set our expectations getMockEndpoint(&amp;quot;mock:log:foo&amp;quot;).expectedBodiesReceived(&amp;quot;Bye World&amp;quot;); getMockEndpoint(&amp;quot;mock:result&amp;quot;).expectedBodiesReceived(&amp;quot;Bye World&amp;quot;); template.sendBody(&amp;quot;direct:start&amp;quot;, &amp;quot;Hello World&amp;quot;); assertMockEndpointsSatisfied(); // additional test to ensure correct endpoints in registry assertNotNull(context.hasEndpoint(&amp;quot;direct:start&amp;quot;)); assertNotNull(context.hasEndpoint(&amp;quot;direct:foo&amp;quot;)); assertNotNull(context.hasEndpoint(&amp;quot;log:foo&amp;quot;)); assertNotNull(context.hasEndpoint(&amp;quot;mock:result&amp;quot;)); // only the log:foo endpoint was mocked assertNotNull(context.hasEndpoint(&amp;quot;mock:log:foo&amp;quot;)); assertNull(context.hasEndpoint(&amp;quot;mock:direct:start&amp;quot;)); assertNull(context.hasEndpoint(&amp;quot;mock:direct:foo&amp;quot;)); } // end::e2[] </script> 
 </div>
</div><p>The pattern supported can be a wildcard or a regular expression. See more details about this at <a shape="rect" href="intercept.html">Intercept</a> as its the same matching function used by Camel.</p><div class="confluence-information-macro confluence-information-macro-information">
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Mind that mocking endpoints causes the messages to be copied when they arrive on the mock.<br clear="none"> That means Camel will use more memory. This may not be suitable when you send in a lot of messages.</p>
 </div>
</div><h4 id="BookInOnePage-Mockingexistingendpointsusingthecamel-testcomponent.1">Mocking existing endpoints using the <code>camel-test</code> component</h4><p>Instead of using the <code>adviceWith</code> to instruct Camel to mock endpoints, you can easily enable this behavior when using the <code>camel-test</code> Test Kit.<br clear="none"> The same route can be tested as follows. Notice that we return <code>"*"</code> from the <code>isMockEndpoints</code> method, which tells Camel to mock all endpoints.<br clear="none"> If you only want to mock all <code>log</code> endpoints you can return <code>"log*"</code> instead.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>isMockEndpoints using camel-test kit</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // tag::e1[] public class IsMockEndpointsJUnit4Test extends CamelTestSupport { @Override public String isMockEndpoints() { // override this method and return the pattern for which endpoints to mock. // use * to indicate all return &amp;quot;*&amp;quot;; } @Test public void testMockAllEndpoints() throws Exception { // notice we have automatic mocked all endpoints and the name of the endpoints is &amp;quot;mock:uri&amp;quot; getMockEndpoint(&amp;quot;mock:direct:start&amp;quot;).expectedBodiesReceived(&amp;quot;Hello World&amp;quot;); getMockEndpoint(&amp;quot;mock:direct:foo&amp;quot;).expectedBodiesReceived(&amp;quot;Hello World&amp;quot;); getMockEndpoint(&amp;quot;mock:log:foo&amp;quot;).expectedBodiesReceived(&amp;quot;Bye World&amp;quot;); getMockEndpoint(&amp;quot;mock:result&amp;quot;).expectedBodiesReceived(&amp;quot;Bye World&amp;quot;); template.sendBody(&amp;quot;direct:start&amp;quot;, &amp;quot;Hello World&amp;quot;); assertMockEndpointsSatisfied(); // additional test to ensure correct endpoints in registry assertNotNull(context.hasEndpoint(&amp;quot;direct:start&amp;quot;)); assertNotNull(context.hasEndpoint(&amp;quot;direct:foo&amp;quot;)); assertNotNull(context.hasEndpoint(&amp;quot;log:foo&amp;quot;)); assertNotNull(context.hasEndpoint(&amp;quot;mock:result&amp;quot;)); // all the endpoints was mocked assertNotNull(context.hasEndpoint(&amp;quot;mock:direct:start&amp;quot;)); assertNotNull(context.hasEndpoint(&amp;quot;mock:direct:foo&amp;quot;)); assertNotNull(context.hasEndpoint(&amp;quot;mock:log:foo&amp;quot;)); } @Override protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { @Override public void configure() throws Exception { from(&amp;quot;direct:start&amp;quot;).to(&amp;quot;direct:foo&amp;quot;).to(&amp;quot;log:foo&amp;quot;).to(&amp;quot;mock:result&amp;quot;); from(&amp;quot;direct:foo&amp;quot;).transform(constant(&amp;quot;Bye World&amp;quot;)); } }; } } // end::e1[] </script> 
 </div>
</div><h4 id="BookInOnePage-MockingexistingendpointswithXMLDSL.1">Mocking existing endpoints with XML DSL</h4><p>If you do not use the <code>camel-test</code> component for unit testing (as shown above) you can use a different approach when using XML files for routes.<br clear="none"> The solution is to create a new XML file used by the unit test and then include the intended XML file which has the route you want to test.</p><p>Suppose we have the route in the <code>camel-route.xml</code> file:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>camel-route.xml</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- tag::e1[] --&amp;gt; &amp;lt;!-- this camel route is in the camel-route.xml file --&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:foo&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;log:foo&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:foo&amp;quot;/&amp;gt; &amp;lt;transform&amp;gt; &amp;lt;constant&amp;gt;Bye World&amp;lt;/constant&amp;gt; &amp;lt;/transform&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;!-- end::e1[] --&amp;gt; </script> 
 </div>
</div><p>Then we create a new XML file as follows, where we include the <code>camel-route.xml</code> file and define a spring bean with the class <code>org.apache.camel.impl.InterceptSendToMockEndpointStrategy</code> which tells Camel to mock all endpoints:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>test-camel-route.xml</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- tag::e1[] --&amp;gt; &amp;lt;!-- the Camel route is defined in another XML file --&amp;gt; &amp;lt;import resource=&amp;quot;camel-route.xml&amp;quot;/&amp;gt; &amp;lt;!-- bean which enables mocking all endpoints --&amp;gt; &amp;lt;bean id=&amp;quot;mockAllEndpoints&amp;quot; class=&amp;quot;org.apache.camel.impl.InterceptSendToMockEndpointStrategy&amp;quot;/&amp;gt; &amp;lt;!-- end::e1[] --&amp;gt; </script> 
 </div>
</div><p>Then in your unit test you load the new XML file (<code>test-camel-route.xml</code>) instead of <code>camel-route.xml</code>.</p><p>To only mock all <a shape="rect" href="log.html">Log</a> endpoints you can define the pattern in the constructor for the bean:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;mockAllEndpoints&amp;quot; class=&amp;quot;org.apache.camel.impl.InterceptSendToMockEndpointStrategy&amp;quot;&amp;gt; &amp;lt;constructor-arg index=&amp;quot;0&amp;quot; value=&amp;quot;log*&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-Mockingendpointsandskipsendingtooriginalendpoint.1">Mocking endpoints and skip sending to original endpoint</h4><p><strong>Available as of Camel 2.10</strong></p><p>Sometimes you want to easily mock and skip sending to a certain endpoints. So the message is detoured and send to the mock endpoint only. From Camel 2.10 onwards you can now use the <code>mockEndpointsAndSkip</code> method using <a shape="rect" href="advicewith.html">AdviceWith</a> or the <a shape="rect" class="unresolved" href="#">Test Kit</a>. The example below will skip sending to the two endpoints <code>"direct:foo"</code>, and <code>"direct:bar"</code>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>adviceWith mock and skip sending to endpoints</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // tag::e1[] public void testAdvisedMockEndpointsWithSkip() throws Exception { // advice the first route using the inlined AdviceWith route builder // which has extended capabilities than the regular route builder context.getRouteDefinitions().get(0).adviceWith(context, new AdviceWithRouteBuilder() { @Override public void configure() throws Exception { // mock sending to direct:foo and direct:bar and skip send to it mockEndpointsAndSkip(&amp;quot;direct:foo&amp;quot;, &amp;quot;direct:bar&amp;quot;); } }); getMockEndpoint(&amp;quot;mock:result&amp;quot;).expectedBodiesReceived(&amp;quot;Hello World&amp;quot;); getMockEndpoint(&amp;quot;mock:direct:foo&amp;quot;).expectedMessageCount(1); getMockEndpoint(&amp;quot;mock:direct:bar&amp;quot;).expectedMessageCount(1); template.sendBody(&amp;quot;direct:start&amp;quot;, &amp;quot;Hello World&amp;quot;); assertMockEndpointsSatisfied(); // the message was not send to the direct:foo route and thus not sent to the seda endpoint SedaEndpoint seda = context.getEndpoint(&amp;quot;seda:foo&amp;quot;, SedaEndpoint.class); assertEquals(0, seda.getCurrentQueueSize()); } // end::e1[] </script> 
 </div>
</div><p>The same example using the <a shape="rect" href="testing.html">Test Kit</a></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>isMockEndpointsAndSkip using camel-test kit</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // tag::e1[] public class IsMockEndpointsAndSkipJUnit4Test extends CamelTestSupport { @Override public String isMockEndpointsAndSkip() { // override this method and return the pattern for which endpoints to mock, // and skip sending to the original endpoint. return &amp;quot;direct:foo&amp;quot;; } @Test public void testMockEndpointAndSkip() throws Exception { // notice we have automatic mocked the direct:foo endpoints and the name of the endpoints is &amp;quot;mock:uri&amp;quot; getMockEndpoint(&amp;quot;mock:result&amp;quot;).expectedBodiesReceived(&amp;quot;Hello World&amp;quot;); getMockEndpoint(&amp;quot;mock:direct:foo&amp;quot;).expectedMessageCount(1); template.sendBody(&amp;quot;direct:start&amp;quot;, &amp;quot;Hello World&amp;quot;); assertMockEndpointsSatisfied(); // the message was not send to the direct:foo route and thus not sent to the seda endpoint SedaEndpoint seda = context.getEndpoint(&amp;quot;seda:foo&amp;quot;, SedaEndpoint.class); assertEquals(0, seda.getCurrentQueueSize()); } @Override protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { @Override public void configure() throws Exception { from(&amp;quot;direct:start&amp;quot;).to(&amp;quot;direct:foo&amp;quot;).to(&amp;quot;mock:result&amp;quot;); from(&amp;quot;direct:foo&amp;quot;).transform(constant(&amp;quot;Bye World&amp;quot;)).to(&amp;quot;seda:foo&amp;quot;); } }; } } // end::e1[] </script> 
 </div>
</div><h3 id="BookInOnePage-Limitingthenumberofmessagestokeep.1">Limiting the number of messages to keep</h3><p><strong>Available as of Camel 2.10</strong></p><p>The <a shape="rect" href="mock.html">Mock</a> endpoints will by default keep a copy of every <a shape="rect" href="exchange.html">Exchange</a> that it received. So if you test with a lot of messages, then it will consume memory.<br clear="none"> From Camel 2.10 onwards we have introduced two options <code>retainFirst</code> and <code>retainLast</code> that can be used to specify to only keep N'th of the first and/or last <a shape="rect" href="exchange.html">Exchange</a>s.</p><p>For example in the code below, we only want to retain a copy of the first 5 and last 5 <a shape="rect" href="exchange.html">Exchange</a>s the mock receives.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> MockEndpoint mock = getMockEndpoint(&amp;quot;mock:data&amp;quot;); mock.setRetainFirst(5); mock.setRetainLast(5); mock.expectedMessageCount(2000); ... mock.assertIsSatisfied(); </script> 
 </div>
</div><p>Using this has some limitations. The <code>getExchanges()</code> and <code>getReceivedExchanges()</code> methods on the <code>MockEndpoint</code> will return only the retained copies of the <a shape="rect" href="exchange.html">Exchange</a>s. So in the example above, the list will contain 10 <a shape="rect" href="exchange.html">Exchange</a>s; the first five, and the last five.<br clear="none"> The <code>retainFirst</code> and <code>retainLast</code> options also have limitations on which expectation methods you can use. For example the expectedXXX methods that work on message bodies, headers, etc. will only operate on the retained messages. In the example above they can test only the expectations on the 10 retained messages.</p><h3 id="BookInOnePage-Testingwitharrivaltimes.1">Testing with arrival times</h3><p><strong>Available as of Camel 2.7</strong></p><p>The <a shape="rect" href="mock.html">Mock</a> endpoint stores the arrival time of the message as a property on the <a shape="rect" href="exchange.html">Exchange</a>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Date time = exchange.getProperty(Exchange.RECEIVED_TIMESTAMP, Date.class); </script> 
 </div>
</div><p>You can use this information to know when the message arrived on the mock. But it also provides foundation to know the time interval between the previous and next message arrived on the mock. You can use this to set expectations using the <code>arrives</code> DSL on the <a shape="rect" href="mock.html">Mock</a> endpoint.</p><p>For example to say that the first message should arrive between 0-2 seconds before the next you can do:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">mock.message(0).arrives().noLaterThan(2).seconds().beforeNext(); </script> 
 </div>
</div><p>You can also define this as that 2nd message (0 index based) should arrive no later than 0-2 seconds after the previous:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">mock.message(1).arrives().noLaterThan(2).seconds().afterPrevious(); </script> 
 </div>
</div><p>You can also use between to set a lower bound. For example suppose that it should be between 1-4 seconds:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">mock.message(1).arrives().between(1, 4).seconds().afterPrevious(); </script> 
 </div>
</div><p>You can also set the expectation on all messages, for example to say that the gap between them should be at most 1 second:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">mock.allMessages().arrives().noLaterThan(1).seconds().beforeNext(); </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">time units</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>In the example above we use <code>seconds</code> as the time unit, but Camel offers <code>milliseconds</code>, and <code>minutes</code> as well.</p>
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.61">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul><li><a shape="rect" href="spring-testing.html">Spring Testing</a></li><li><a shape="rect" href="testing.html">Testing</a></li></ul><h2 id="BookInOnePage-MSVComponent">MSV Component</h2><p>The MSV component performs XML validation of the message body using the <a shape="rect" class="external-link" href="https://msv.dev.java.net/" rel="nofollow">MSV Library</a> and any of the supported XML schema languages, such as <a shape="rect" class="external-link" href="http://www.w3.org/XML/Schema" rel="nofollow">XML Schema</a> or <a shape="rect" class="external-link" href="http://relaxng.org/" rel="nofollow">RelaxNG XML Syntax</a>. </p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-msv&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><p>Note that the <a shape="rect" href="jing.html">Jing</a> component also supports <a shape="rect" class="external-link" href="http://relaxng.org/compact-tutorial-20030326.html" rel="nofollow">RelaxNG Compact Syntax</a></p><h3 id="BookInOnePage-URIformat.43">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> msv:someLocalOrRemoteResource[?options] </script> 
 </div>
</div><p>Where <strong>someLocalOrRemoteResource</strong> is some URL to a local resource on the classpath or a full URL to a remote resource or resource on the file system. For example</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> msv:org/foo/bar.rng msv:file:../foo/bar.rng msv:http://acme.com/cheese.rng </script> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.55">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Option </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>useDom</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Whether DOMSource/DOMResult or SaxSource/SaxResult should be used by the validator. <strong>Note:</strong> DOM must be used by the <a shape="rect" href="msv.html">MSV</a> component. </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Example.27">Example</h3><p>The following <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-msv/src/test/resources/org/apache/camel/component/validator/msv/camelContext.xml">example</a> shows how to configure a route from endpoint <strong>direct:start</strong> which then goes to one of two endpoints, either <strong>mock:valid</strong> or <strong>mock:invalid</strong> based on whether or not the XML matches the given <a shape="rect" class="external-link" href="http://relaxng.org/" rel="nofollow">RelaxNG XML Schema</a> (which is supplied on the classpath).</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;doTry&amp;gt; &amp;lt;to uri=&amp;quot;msv:org/apache/camel/component/validator/msv/schema.rng&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:valid&amp;quot;/&amp;gt; &amp;lt;doCatch&amp;gt; &amp;lt;exception&amp;gt;org.apache.camel.ValidationException&amp;lt;/exception&amp;gt; &amp;lt;to uri=&amp;quot;mock:invalid&amp;quot;/&amp;gt; &amp;lt;/doCatch&amp;gt; &amp;lt;doFinally&amp;gt; &amp;lt;to uri=&amp;quot;mock:finally&amp;quot;/&amp;gt; &amp;lt;/doFinally&amp;gt; &amp;lt;/doTry&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-SeeAlso.62">See Also</h3><ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-MyBatis">MyBatis</h2><p><strong>Available as of Camel 2.7</strong></p><p>The <strong>mybatis:</strong> component allows you to query, poll, insert, update and delete data in a relational database using <a shape="rect" class="external-link" href="http://mybatis.org/" rel="nofollow">MyBatis</a>.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-mybatis&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.44">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">mybatis:statementName[?options] </script> 
 </div>
</div><p>Where <strong>statementName</strong> is the statement name in the MyBatis XML mapping file which maps to the query, insert, update or delete operation you wish to evaluate.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><p>This component will by default load the MyBatis SqlMapConfig file from the root of the classpath with the expected name of <code>SqlMapConfig.xml</code>.<br clear="none"> If the file is located in another location, you will need to configure the <code>configurationUri</code> option on the <code>MyBatisComponent</code> component.</p><h3 id="BookInOnePage-Options.56">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.onConsume</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Statements to run after consuming. Can be used, for example, to update rows after they have been consumed and processed in Camel. See sample later. Multiple statements can be separated with commas.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.useIterator</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If <code>true</code> each row returned when polling will be processed individually. If <code>false</code> the entire <code>List</code> of data is set as the IN body.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.routeEmptyResultSet</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sets whether empty result sets should be routed.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>statementType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>StatementType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Mandatory to specify for the producer to control which kind of operation to invoke. The enum values are: <code>SelectOne</code>, <code>SelectList</code>, <code>Insert</code>, <code>InsertList</code>, <code>Update</code>, <code>UpdateList</code>, <code>Delete</code>, and <code>DeleteList</code>. <strong>Notice:</strong> <code>InsertList</code> is available as of Camel 2.10, and <code>UpdateList</code>, <code>DeleteList</code> is available as of Camel 2.11.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxMessagesPerPoll</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>int</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>This option is intended to split results returned by the database pool into the batches and deliver them in multiple exchanges. This integer defines the maximum messages to deliver in single exchange. By default, no maximum is set. Can be used to set a limit of e.g. 1000 to avoid when starting up the server that there are thousands of files. Set a value of 0 or negative to disable it.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>executorType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> The executor type to be used while executing statements. The supported values are: simple, reuse, batch. By default, the value is not specified and is equal to what MyBatis uses, i.e. <strong>simple</strong>. <br clear="none" class="atl-forced-newline"> <strong>simple</strong> executor does nothing special. <br clear="none" class="atl-forced-newline"> <strong>reuse</strong> executor reuses prepared statements. <br clear="none" class="atl-forced-newline"> <strong>batch</strong> executor reuses statements and batches updates.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>outputHeader</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>String</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>null</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.15:</strong><span style="color: rgb(0,0,0);">&#160;To store the result as a header instead of the message body. This allows to preserve the existing message body as-is.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>inputHeader</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>String</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>null</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.15: &#160;</strong>"inputHeader" parameter to use a header value as input to the component instead of the body.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>transacted</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>boolean</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16.2:</strong><span>&#160;</span><strong>SQL consumer only:</strong><span>Enables or disables transaction. If enabled then if processing an exchange failed then the consumer break out processing any further exchanges to cause a rollback eager</span></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-MessageHeaders.13">Message Headers</h3><p>Camel will populate the result message, either IN or OUT with a header with the statement used:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelMyBatisStatementName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The <strong>statementName</strong> used (for example: insertAccount).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelMyBatisResult</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Object</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The <strong>response</strong> returned from MtBatis in any of the operations. For instance an <code>INSERT</code> could return the auto-generated key, or number of rows etc.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-MessageBody.3">Message Body</h3><p>The response from MyBatis will only be set as the body if it's a <code>SELECT</code> statement. That means, for example, for <code>INSERT</code> statements Camel will not replace the body. This allows you to continue routing and keep the original body. The response from MyBatis is always stored in the header with the key <code>CamelMyBatisResult</code>.</p><h3 id="BookInOnePage-Samples.14">Samples</h3><p>For example if you wish to consume beans from a JMS queue and insert them into a database you could do the following:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:queue:newAccount&amp;quot;). to(&amp;quot;mybatis:insertAccount?statementType=Insert&amp;quot;); </script> 
 </div>
</div><p>Notice we have to specify the <code>statementType</code>, as we need to instruct Camel which kind of operation to invoke.</p><p>Where <strong>insertAccount</strong> is the MyBatis ID in the SQL mapping file:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- Insert example, using the Account parameter class --&amp;gt; &amp;lt;insert id=&amp;quot;insertAccount&amp;quot; parameterType=&amp;quot;Account&amp;quot;&amp;gt; insert into ACCOUNT ( ACC_ID, ACC_FIRST_NAME, ACC_LAST_NAME, ACC_EMAIL ) values ( #{id}, #{firstName}, #{lastName}, #{emailAddress} ) &amp;lt;/insert&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-UsingStatementTypeforbettercontrolofMyBatis">Using StatementType for better control of MyBatis</h3><p>When routing to an MyBatis endpoint you will want more fine grained control so you can control whether the SQL statement to be executed is a <code>SELECT</code>, <code>UPDATE</code>, <code>DELETE</code> or <code>INSERT</code> etc. So for instance if we want to route to an MyBatis endpoint in which the IN body contains parameters to a <code>SELECT</code> statement we can do:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;mybatis:selectAccountById?statementType=SelectOne&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>In the code above we can invoke the MyBatis statement <code>selectAccountById</code> and the IN body should contain the account id we want to retrieve, such as an <code>Integer</code> type.<p>We can do the same for some of the other operations, such as <code>SelectList</code>:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;mybatis:selectAllAccounts?statementType=SelectList&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>And the same for <code>UPDATE</code>, where we can send an <code>Account</code> object as the IN body to MyBatis:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;mybatis:updateAccount?statementType=Update&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div><h4 id="BookInOnePage-UsingInsertListStatementType">Using InsertList StatementType</h4><p><strong>Available as of Camel 2.10</strong></p><p>MyBatis allows you to insert multiple rows using its for-each batch driver. To use this, you need to use the &lt;foreach&gt; in the mapper XML file. For example as shown below:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- Batch Insert example, using the Account parameter class --&amp;gt; &amp;lt;insert id=&amp;quot;batchInsertAccount&amp;quot; parameterType=&amp;quot;java.util.List&amp;quot;&amp;gt; insert into ACCOUNT ( ACC_ID, ACC_FIRST_NAME, ACC_LAST_NAME, ACC_EMAIL ) values ( &amp;lt;foreach item=&amp;quot;Account&amp;quot; collection=&amp;quot;list&amp;quot; open=&amp;quot;&amp;quot; close=&amp;quot;&amp;quot; separator=&amp;quot;),(&amp;quot;&amp;gt; #{Account.id}, #{Account.firstName}, #{Account.lastName}, #{Account.emailAddress} &amp;lt;/foreach&amp;gt; ) &amp;lt;/insert&amp;gt; </script> 
  </div>
 </div>Then you can insert multiple rows, by sending a Camel message to the <code>mybatis</code> endpoint which uses the <code>InsertList</code> statement type, as shown below:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;mybatis:batchInsertAccount?statementType=InsertList&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div><h4 id="BookInOnePage-UsingUpdateListStatementType">Using UpdateList StatementType</h4><p><strong>Available as of Camel 2.11</strong></p><p>MyBatis allows you to update multiple rows using its for-each batch driver. To use this, you need to use the &lt;foreach&gt; in the mapper XML file. For example as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;update id=&amp;quot;batchUpdateAccount&amp;quot; parameterType=&amp;quot;java.util.Map&amp;quot;&amp;gt; update ACCOUNT set ACC_EMAIL = #{emailAddress} where ACC_ID in &amp;lt;foreach item=&amp;quot;Account&amp;quot; collection=&amp;quot;list&amp;quot; open=&amp;quot;(&amp;quot; close=&amp;quot;)&amp;quot; separator=&amp;quot;,&amp;quot;&amp;gt; #{Account.id} &amp;lt;/foreach&amp;gt; &amp;lt;/update&amp;gt; </script> 
 </div>
</div><p>Then you can update multiple rows, by sending a Camel message to the mybatis endpoint which uses the UpdateList statement type, as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;mybatis:batchUpdateAccount?statementType=UpdateList&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-UsingDeleteListStatementType">Using DeleteList StatementType</h4><p><strong>Available as of Camel 2.11</strong></p><p>MyBatis allows you to delete multiple rows using its for-each batch driver. To use this, you need to use the &lt;foreach&gt; in the mapper XML file. For example as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;delete id=&amp;quot;batchDeleteAccountById&amp;quot; parameterType=&amp;quot;java.util.List&amp;quot;&amp;gt; delete from ACCOUNT where ACC_ID in &amp;lt;foreach item=&amp;quot;AccountID&amp;quot; collection=&amp;quot;list&amp;quot; open=&amp;quot;(&amp;quot; close=&amp;quot;)&amp;quot; separator=&amp;quot;,&amp;quot;&amp;gt; #{AccountID} &amp;lt;/foreach&amp;gt; &amp;lt;/delete&amp;gt; </script> 
 </div>
</div><p>Then you can delete multiple rows, by sending a Camel message to the mybatis endpoint which uses the DeleteList statement type, as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;mybatis:batchDeleteAccount?statementType=DeleteList&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><h4 id="BookInOnePage-NoticeonInsertList,UpdateListandDeleteListStatementTypes">Notice on InsertList, UpdateList and DeleteList StatementTypes</h4><p>Parameter of any type (List, Map, etc.) can be passed to mybatis and an end user is responsible for handling it as required<br clear="none"> with the help of <a shape="rect" class="external-link" href="http://www.mybatis.org/core/dynamic-sql.html" rel="nofollow">mybatis dynamic queries</a> capabilities.</p><h4 id="BookInOnePage-Scheduledpollingexample.1">Scheduled polling example</h4><p>This component supports scheduled polling and can therefore be used as a&#160;<a shape="rect" href="polling-consumer.html">Polling Consumer</a>. For example to poll the database every minute:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;mybatis:selectAllAccounts?delay=60000&amp;quot;).to(&amp;quot;activemq:queue:allAccounts&amp;quot;);</script> 
 </div>
</div><p>See "ScheduledPollConsumer Options" on&#160;<a shape="rect" href="polling-consumer.html">Polling Consumer</a> for more options.</p><p>Alternatively you can use another mechanism for triggering the scheduled polls, such as the <a shape="rect" href="timer.html">Timer</a> or <a shape="rect" href="quartz.html">Quartz</a> components.&#160;<span style="line-height: 1.4285715;">In the sample below we poll the database, every 30 seconds using the </span><a shape="rect" href="timer.html">Timer</a><span style="line-height: 1.4285715;"> component and send the data to the JMS queue:</span></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;timer://pollTheDatabase?delay=30000&amp;quot;).to(&amp;quot;mybatis:selectAllAccounts&amp;quot;).to(&amp;quot;activemq:queue:allAccounts&amp;quot;); </script> 
 </div>
</div><p>And the MyBatis SQL mapping file used:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- Select with no parameters using the result map for Account class. --&amp;gt; &amp;lt;select id=&amp;quot;selectAllAccounts&amp;quot; resultMap=&amp;quot;AccountResult&amp;quot;&amp;gt; select * from ACCOUNT &amp;lt;/select&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-UsingonConsume.1">Using onConsume</h4><p>This component supports executing statements <strong>after</strong> data have been consumed and processed by Camel. This allows you to do post updates in the database. Notice all statements must be <code>UPDATE</code> statements. Camel supports executing multiple statements whose names should be separated by commas.</p><p>The route below illustrates we execute the <strong>consumeAccount</strong> statement data is processed. This allows us to change the status of the row in the database to processed, so we avoid consuming it twice or more.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;mybatis:selectUnprocessedAccounts?consumer.onConsume=consumeAccount&amp;quot;).to(&amp;quot;mock:results&amp;quot;); </script> 
  </div>
 </div>And the statements in the sqlmap file:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;select id=&amp;quot;selectUnprocessedAccounts&amp;quot; resultMap=&amp;quot;AccountResult&amp;quot;&amp;gt; select * from ACCOUNT where PROCESSED = false &amp;lt;/select&amp;gt; </script> 
  </div>
 </div>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;update id=&amp;quot;consumeAccount&amp;quot; parameterType=&amp;quot;Account&amp;quot;&amp;gt; update ACCOUNT set PROCESSED = true where ACC_ID = #{id} &amp;lt;/update&amp;gt; </script> 
  </div>
 </div><h4 id="BookInOnePage-Participatingintransactions"><span style="line-height: 1.5;">Participating in transactions</span></h4><p>Setting up a transaction manager under camel-mybatis can be a little bit fiddly, as it involves externalising the database configuration outside the standard MyBatis <code>SqlMapConfig.xml</code> file.</p><p>The first part requires the setup of a <code>DataSource</code>. This is typically a pool (either DBCP, or c3p0), which needs to be wrapped in a Spring proxy. This proxy enables non-Spring use of the <code>DataSource</code> to participate in Spring transactions (the MyBatis <code>SqlSessionFactory</code> does just this).</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;dataSource&amp;quot; class=&amp;quot;org.springframework.jdbc.datasource.TransactionAwareDataSourceProxy&amp;quot;&amp;gt; &amp;lt;constructor-arg&amp;gt; &amp;lt;bean class=&amp;quot;com.mchange.v2.c3p0.ComboPooledDataSource&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;driverClass&amp;quot; value=&amp;quot;org.postgresql.Driver&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;jdbcUrl&amp;quot; value=&amp;quot;jdbc:postgresql://localhost:5432/myDatabase&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;user&amp;quot; value=&amp;quot;myUser&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;password&amp;quot; value=&amp;quot;myPassword&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;/constructor-arg&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>This has the additional benefit of enabling the database configuration to be externalised using property placeholders.</p><p>A transaction manager is then configured to manage the outermost <code>DataSource</code>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;txManager&amp;quot; class=&amp;quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;dataSource&amp;quot; ref=&amp;quot;dataSource&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>A <a shape="rect" class="external-link" href="http://www.mybatis.org/spring/index.html" rel="nofollow">mybatis-spring</a> <a shape="rect" class="external-link" href="http://www.mybatis.org/spring/factorybean.html" rel="nofollow"><code>SqlSessionFactoryBean</code></a> then wraps that same <code>DataSource</code>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;sqlSessionFactory&amp;quot; class=&amp;quot;org.mybatis.spring.SqlSessionFactoryBean&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;dataSource&amp;quot; ref=&amp;quot;dataSource&amp;quot;/&amp;gt; &amp;lt;!-- standard mybatis config file --&amp;gt; &amp;lt;property name=&amp;quot;configLocation&amp;quot; value=&amp;quot;/META-INF/SqlMapConfig.xml&amp;quot;/&amp;gt; &amp;lt;!-- externalised mappers --&amp;gt; &amp;lt;property name=&amp;quot;mapperLocations&amp;quot; value=&amp;quot;classpath*:META-INF/mappers/**/*.xml&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>The camel-mybatis component is then configured with that factory:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;mybatis&amp;quot; class=&amp;quot;org.apache.camel.component.mybatis.MyBatisComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;sqlSessionFactory&amp;quot; ref=&amp;quot;sqlSessionFactory&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>Finally, a <a shape="rect" href="transactional-client.html">transaction policy</a> is defined over the top of the transaction manager, which can then be used as usual:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;PROPAGATION_REQUIRED&amp;quot; class=&amp;quot;org.apache.camel.spring.spi.SpringTransactionPolicy&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;transactionManager&amp;quot; ref=&amp;quot;txManager&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;propagationBehaviorName&amp;quot; value=&amp;quot;PROPAGATION_REQUIRED&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;camelContext id=&amp;quot;my-model-context&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route id=&amp;quot;insertModel&amp;quot;&amp;gt; &amp;lt;from uri=&amp;quot;direct:insert&amp;quot;/&amp;gt; &amp;lt;transacted ref=&amp;quot;PROPAGATION_REQUIRED&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mybatis:myModel.insert?statementType=Insert&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.63">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-Nagios">Nagios</h2><p><strong>Available as of Camel 2.3</strong></p><p>The <a shape="rect" href="nagios.html">Nagios</a> component allows you to send passive checks to <a shape="rect" class="external-link" href="http://nagios.org" rel="nofollow">Nagios</a>.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-nagios&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.45">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> nagios://host[:port][?Options] </script> 
 </div>
</div><p>Camel provides two abilities with the <a shape="rect" href="nagios.html">Nagios</a> component. You can send passive check messages by sending a message to its endpoint.<br clear="none"> Camel also provides a <a shape="rect" href="camel-jmx.html">EventNotifer</a> which allows you to send notifications to Nagios.</p><h3 id="BookInOnePage-Options.57">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default Value </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>host</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> none </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> This is the address of the <a shape="rect" href="nagios.html">Nagios</a> host where checks should be send. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>port</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The port number of the host. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>password</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Password to be authenticated when sending checks to Nagios. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>connectionTimeout</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> 5000 </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Connection timeout in millis. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>timeout</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> 5000 </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Sending timeout in millis. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>nagiosSettings</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> To use an already configured <code>com.googlecode.jsendnsca.core.NagiosSettings</code> object. Then any of the other options are not in use, if using this. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>sendSync</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Whether or not to use synchronous when sending a passive check. Setting it to <code>false</code> will allow Camel to continue routing the message and the passive check message will be send asynchronously. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>encryptionMethod</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>No</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.9:</strong> To specify an encryption method. Possible values: <code>No</code>, <code>Xor</code>, or <code>TripleDes</code>. </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Headers.3">Headers</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>CamelNagiosHostName</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> This is the address of the <a shape="rect" href="nagios.html">Nagios</a> host where checks should be send. This header will override any existing hostname configured on the endpoint. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>CamelNagiosLevel</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> This is the severity level. You can use values <code>CRITICAL, WARNING, OK</code>. Camel will by default use <code>OK</code>. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>CamelNagiosServiceName</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The servie name. Will default use the <a shape="rect" href="camelcontext.html">CamelContext</a> name. </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Sendingmessageexamples">Sending message examples</h3><p>You can send a message to Nagios where the message payload contains the message. By default it will be <code>OK</code> level and use the <a shape="rect" href="camelcontext.html">CamelContext</a> name as the service name. You can overrule these values using headers as shown above.</p><p>For example we send the <code>Hello Nagios</code> message to Nagios as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> template.sendBody(&amp;quot;direct:start&amp;quot;, &amp;quot;Hello Nagios&amp;quot;); from(&amp;quot;direct:start&amp;quot;).to(&amp;quot;nagios:127.0.0.1:5667?password=secret&amp;quot;).to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>To send a <code>CRITICAL</code> message you can send the headers such as:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> Map headers = new HashMap(); headers.put(NagiosConstants.LEVEL, &amp;quot;CRITICAL&amp;quot;); headers.put(NagiosConstants.HOST_NAME, &amp;quot;myHost&amp;quot;); headers.put(NagiosConstants.SERVICE_NAME, &amp;quot;myService&amp;quot;); template.sendBodyAndHeaders(&amp;quot;direct:start&amp;quot;, &amp;quot;Hello Nagios&amp;quot;, headers); </script> 
 </div>
</div><h3 id="BookInOnePage-UsingNagiosEventNotifer">Using <code>NagiosEventNotifer</code></h3><p>The <a shape="rect" href="nagios.html">Nagios</a> component also provides an <a shape="rect" href="camel-jmx.html">EventNotifer</a> which you can use to send events to Nagios. For example we can enable this from Java as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> NagiosEventNotifier notifier = new NagiosEventNotifier(); notifier.getConfiguration().setHost(&amp;quot;localhost&amp;quot;); notifier.getConfiguration().setPort(5667); notifier.getConfiguration().setPassword(&amp;quot;password&amp;quot;); CamelContext context = ... context.getManagementStrategy().addEventNotifier(notifier); return context; </script> 
 </div>
</div><p>In Spring XML its just a matter of defining a Spring bean with the type <code>EventNotifier</code> and Camel will pick it up as documented here: <a shape="rect" href="advanced-configuration-of-camelcontext-using-spring.html">Advanced configuration of CamelContext using Spring</a>.</p><h3 id="BookInOnePage-SeeAlso.64">See Also</h3><ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-NettyComponent">Netty Component</h2><p><strong>Available as of Camel 2.3</strong></p><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>This component is deprecated. You should use <a shape="rect" href="netty4.html">Netty4</a>.</p>
 </div>
</div><p>The <strong style="line-height: 1.42857;">netty</strong> component in Camel is a socket communication component, based on the <a shape="rect" class="external-link" href="http://netty.io/" style="line-height: 1.42857;" rel="nofollow">Netty</a> project.</p><p>Netty is a NIO client server framework which enables quick and easy development of network applications such as protocol servers and clients.<br clear="none"> Netty greatly simplifies and streamlines network programming such as TCP and UDP socket server.</p><p>This camel component supports both producer and consumer endpoints.</p><p>The Netty component has several options and allows fine-grained control of a number of TCP/UDP communication parameters (buffer sizes, keepAlives, tcpNoDelay etc) and facilitates both In-Only and In-Out communication on a Camel route.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-netty&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.46">URI format</h3><p>The URI scheme for a netty component is as follows</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">netty:tcp://localhost:99999[?options] netty:udp://remotehost:99999/[?options] </script> 
 </div>
</div><p>This component supports producer and consumer endpoints for both TCP and UDP.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.58">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>keepAlive</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Setting to ensure socket is not closed due to inactivity</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>tcpNoDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Setting to improve TCP protocol performance</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>backlog</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.6/2.10.4/2.11:</strong> Allows to configure a backlog for netty consumer (server). Note the backlog is just a best effort depending on the OS. Setting this option to a value such as <code>200</code>, <code>500</code> or <code>1000</code>, tells the TCP stack how long the "accept" queue can be. If this option is not configured, then the backlog depends on OS setting.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>broadcast</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Setting to choose Multicast over UDP</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>connectTimeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>10000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Time to wait for a socket connection to be available. Value is in millis.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>reuseAddress</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Setting to facilitate socket multiplexing</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sync</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Setting to set endpoint as one-way or request-response</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>synchronous</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Whether <a shape="rect" href="asynchronous-routing-engine.html">Asynchronous Routing Engine</a> is not in use. <code>false</code> then the <a shape="rect" href="asynchronous-routing-engine.html">Asynchronous Routing Engine</a> is used, <code>true</code> to force processing synchronous.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ssl</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Setting to specify whether SSL encryption is applied to this endpoint</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sslClientCertHeaders</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> When enabled and in SSL mode, then the Netty consumer will enrich the Camel <a shape="rect" href="message.html">Message</a> with headers having information about the client certificate such as subject name, issuer name, serial number, and the valid date range.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sendBufferSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>65536 bytes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The TCP/UDP buffer sizes to be used during outbound communication. Size is bytes.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>receiveBufferSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>65536 bytes</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The TCP/UDP buffer sizes to be used during inbound communication. Size is bytes.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>option.XXX</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11/2.10.4:</strong> Allows to configure additional netty options using "option." as prefix. For example "option.child.keepAlive=false" to set the netty option "child.keepAlive=false". See the Netty documentation for possible options that can be used.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>corePoolSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>10</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The number of allocated threads at component startup. Defaults to 10. <strong>Note:</strong> This option is removed from Camel 2.9.2 onwards. As we rely on Nettys default settings.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxPoolSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>100</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The maximum number of threads that may be allocated to this endpoint. Defaults to 100. <strong>Note:</strong> This option is removed from Camel 2.9.2 onwards. As we rely on Nettys default settings.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>disconnect</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether or not to disconnect(close) from Netty Channel right after use. Can be used for both consumer and producer.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>lazyChannelCreation</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Channels can be lazily created to avoid exceptions, if the remote server is not up and running when the Camel producer is started.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transferExchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Only used for TCP. You can transfer the exchange over the wire instead of just the body. The following fields are transferred: In body, Out body, fault body, In headers, Out headers, fault headers, exchange properties, exchange exception. This requires that the objects are serializable. Camel will exclude any non-serializable objects and log it at WARN level.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>disconnectOnNoReply</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If sync is enabled then this option dictates NettyConsumer if it should disconnect where there is no reply to send back.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>noReplyLogLevel</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>WARN</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If sync is enabled this option dictates NettyConsumer which logging level to use when logging a there is no reply to send back. Values are: <code>FATAL, ERROR, INFO, DEBUG, OFF</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>serverExceptionCaughtLogLevel</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>WARN</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.1:</strong> If the server (NettyConsumer) catches an exception then its logged using this logging level.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>serverClosedChannelExceptionCaughtLogLevel</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>DEBUG</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.1:</strong> If the server (NettyConsumer) catches an <code>java.nio.channels.ClosedChannelException</code> then its logged using this logging level. This is used to avoid logging the closed channel exceptions, as clients can disconnect abruptly and then cause a flod of closed exceptions in the Netty server.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>allowDefaultCodec</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.4:</strong> The netty component installs a default codec if both, encoder/deocder is null and textline is false. Setting allowDefaultCodec to false prevents the netty component from installing a default codec as the first element in the filter chain.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>textline</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.4:</strong> Only used for TCP. If no codec is specified, you can use this flag to indicate a text line based codec; if not specified or the value is false, then Object Serialization is assumed over TCP.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>delimiter</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>LINE</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.4:</strong> The delimiter to use for the textline codec. Possible values are <code>LINE</code> and <code>NULL</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>decoderMaxLineLength</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1024</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.4:</strong> The max line length to use for the textline codec.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>autoAppendDelimiter</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.4:</strong> Whether or not to auto append missing end delimiter when sending using the textline codec.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>encoding</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.4:</strong> The encoding (a charset name) to use for the textline codec. If not provided, Camel will use the JVM default Charset.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>workerCount</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> When netty works on nio mode, it uses default workerCount parameter from Netty, which is cpu_core_threads*2. User can use this operation to override the default workerCount from Netty</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sslContextParameters</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> SSL configuration using an <code>org.apache.camel.util.jsse.SSLContextParameters</code> instance. See <a shape="rect" href="#BookInOnePage-UsingtheJSSEConfigurationUtility">Using the JSSE Configuration Utility</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>receiveBufferSizePredictor</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> Configures the buffer size predictor. See details at Jetty documentation and this <a shape="rect" class="external-link" href="http://lists.jboss.org/pipermail/netty-users/2010-January/001958.html" rel="nofollow">mail thread</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>requestTimeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.1:</strong> Allows to use a timeout for the Netty producer when calling a remote server. By default no timeout is in use. The value is in milli seconds, so eg <code>30000</code> is 30 seconds. The requestTimeout is using Netty's ReadTimeoutHandler to trigger the timeout.<strong> Camel 2.16, 2.15.3</strong> you can also override this setting by setting the CamelNettyRequestTimeout header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>needClientAuth</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> Configures whether the server needs client authentication when using SSL.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>orderedThreadPoolExecutor</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.2:</strong> Whether to use ordered thread pool, to ensure events are processed orderly on the same channel. See details at the netty javadoc of <code>org.jboss.netty.handler.execution.OrderedMemoryAwareThreadPoolExecutor</code> for more details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maximumPoolSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>16</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.2:</strong> The core pool size for the ordered thread pool, if its in use.</p><p><strong>Since Camel 2.14.1</strong>: This option is move the NettyComponent.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>producerPoolEnabled</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.4/Camel 2.11:</strong> Producer only. Whether producer pool is enabled or not. <strong>Important:</strong> Do not turn this off, as the pooling is needed for handling concurrency and reliable request/reply.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>producerPoolMaxActive</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>-1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.3:</strong> Producer only. Sets the cap on the number of objects that can be allocated by the pool (checked out to clients, or idle awaiting checkout) at a given time. Use a negative value for no limit.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>producerPoolMinIdle</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.3:</strong> Producer only. Sets the minimum number of instances allowed in the producer pool before the evictor thread (if active) spawns new objects.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>producerPoolMaxIdle</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>100</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.3:</strong> Producer only. Sets the cap on the number of "idle" instances in the pool.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>producerPoolMinEvictableIdle</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>300000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.3:</strong> Producer only. Sets the minimum amount of time (value in millis) an object may sit idle in the pool before it is eligible for eviction by the idle object evictor.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bootstrapConfiguration</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> Consumer only. Allows to configure the Netty ServerBootstrap options using a <code>org.apache.camel.component.netty.NettyServerBootstrapConfiguration</code> instance. This can be used to reuse the same configuration for multiple consumers, to align their configuration more easily.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>bossPoll</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> To use a explicit <code>org.jboss.netty.channel.socket.nio.BossPool</code> as the boss thread pool. For example to share a thread pool with multiple consumers. By default each consumer has their own boss pool with 1 core thread.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>workerPool</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> To use a explicit <code>org.jboss.netty.channel.socket.nio.WorkerPool</code> as the worker thread pool. For example to share a thread pool with multiple consumers. By default each consumer has their own worker pool with 2 x cpu count core threads.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">channelGroup</td><td colspan="1" rowspan="1" class="confluenceTd"><span>null</span></td><td colspan="1" rowspan="1" class="confluenceTd"><span><strong>Camel 2.17 </strong>To use a explicit </span><code>io.netty.channel.group.ChannelGroup</code><span> for example to broadact a message to multiple channels.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>networkInterface</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> Consumer only. When using UDP then this option can be used to specify a network interface by its name, such as <code>eth0</code> to join a multicast group.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>udpConnectionlessSending</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.15:</strong> Producer only. &#160;This option supports connection less udp sending which is a real fire and forget. A connected udp send receive the PortUnreachableException if no one is listen on the receiving port.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>clientMode</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.15:</strong> Consumer only. If the <code>clientMode</code> is true, netty consumer will connect the address as a TCP client.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>useChannelBuffer</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> Producer only. If the <code><span>useChannelBuffer</span></code> is true, netty producer will turn the message body into channelBuffer before sending it out.</td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-RegistrybasedOptions">Registry based Options</h3><p>Codec Handlers and SSL Keystores can be enlisted in the <a shape="rect" href="registry.html">Registry</a>, such as in the Spring XML file.<br clear="none"> The values that could be passed in, are the following:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>passphrase</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>password setting to use in order to encrypt/decrypt payloads sent using SSH</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>keyStoreFormat</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>keystore format to be used for payload encryption. Defaults to "JKS" if not set</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>securityProvider</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Security provider to be used for payload encryption. Defaults to "SunX509" if not set.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>keyStoreFile</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>deprecated:</strong> Client side certificate keystore to be used for encryption</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>trustStoreFile</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>deprecated:</strong> Server side certificate keystore to be used for encryption</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>keyStoreResource</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.1:</strong> Client side certificate keystore to be used for encryption. Is loaded by default from classpath, but you can prefix with <code>"classpath:"</code>, <code>"file:"</code>, or <code>"http:"</code> to load the resource from different systems.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>trustStoreResource</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.1:</strong> Server side certificate keystore to be used for encryption. Is loaded by default from classpath, but you can prefix with <code>"classpath:"</code>, <code>"file:"</code>, or <code>"http:"</code> to load the resource from different systems.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sslHandler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Reference to a class that could be used to return an SSL Handler</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>encoder</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A custom <code>ChannelHandler</code> class that can be used to perform special marshalling of outbound payloads. Must override <code>org.jboss.netty.channel.ChannelDownStreamHandler</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>encorders</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A list of encoders to be used. You can use a String which have values separated by comma, and have the values be looked up in the <a shape="rect" href="registry.html">Registry</a>. Just remember to prefix the value with # so Camel knows it should lookup.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>decoder</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A custom <code>ChannelHandler</code> class that can be used to perform special marshalling of inbound payloads. Must override <code>org.jboss.netty.channel.ChannelUpStreamHandler</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>decoders</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A list of decoders to be used. You can use a String which have values separated by comma, and have the values be looked up in the <a shape="rect" href="registry.html">Registry</a>. Just remember to prefix the value with # so Camel knows it should lookup.</p></td></tr></tbody></table> 
 </div>
</div><p><strong>Important:</strong> Read below about using non shareable encoders/decoders.</p><h4 id="BookInOnePage-Usingnonshareableencodersordecoders">Using non shareable encoders or decoders</h4><p>If your encoders or decoders is not shareable (eg they have the @Shareable class annotation), then your encoder/decoder must implement the <code>org.apache.camel.component.netty.ChannelHandlerFactory</code> interface, and return a new instance in the <code>newChannelHandler</code> method. This is to ensure the encoder/decoder can safely be used. If this is not the case, then the Netty component will log a WARN when<br clear="none"> an endpoint is created.</p><p>The Netty component offers a <code>org.apache.camel.component.netty.ChannelHandlerFactories</code> factory class, that has a number of commonly used methods.</p><h3 id="BookInOnePage-SendingMessagesto/fromaNettyendpoint">Sending Messages to/from a Netty endpoint</h3><h4 id="BookInOnePage-NettyProducer">Netty Producer</h4><p>In Producer mode, the component provides the ability to send payloads to a socket endpoint<br clear="none"> using either TCP or UDP protocols (with optional SSL support).</p><p>The producer mode supports both one-way and request-response based operations.</p><h4 id="BookInOnePage-NettyConsumer">Netty Consumer</h4><p>In Consumer mode, the component provides the ability to:</p><ul class="alternate"><li>listen on a specified socket using either TCP or UDP protocols (with optional SSL support),</li><li>receive requests on the socket using text/xml, binary and serialized object based payloads and</li><li>send them along on a route as message exchanges.</li></ul><p>The consumer mode supports both one-way and request-response based operations.</p><p>&#160;</p><h3 id="BookInOnePage-Headers.4">Headers</h3><p>The following headers are filled for the exchanges created by the Netty consumer:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header key</p></th><th colspan="1" rowspan="1" class="confluenceTh">Class</th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>NettyConstants.NETTY_CHANNEL_HANDLER_CONTEXT</code> / <code>CamelNettyChannelHandlerContext</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>org.jboss.netty.channel.ChannelHandlerContext</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code><span>ChannelHandlerContext </span></code>instance associated with the connection received by netty.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>NettyConstants.NETTY_MESSAGE_EVENT</code> / <code>CamelNettyMessageEvent</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code><span>org.jboss.netty.channel.</span>MessageEvent</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span><code><span>MessageEvent </span></code>instance associated with the connection received by netty.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>NettyConstants.NETTY_REMOTE_ADDRESS</code> / <code>CamelNettyRemoteAddress</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>java.net.SocketAddress</code></td><td colspan="1" rowspan="1" class="confluenceTd">Remote address of the incoming socket connection.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>NettyConstants.NETTY_LOCAL_ADDRESS</code> / <code>CamelNettyLocalAddress</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code><span>java.net.</span><span>SocketAddress</span></code></td><td colspan="1" rowspan="1" class="confluenceTd"><span>Local address of the incoming socket connection.</span></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-UsageSamples">Usage Samples</h3><h4 id="BookInOnePage-AUDPNettyendpointusingRequest-Replyandserializedobjectpayload">A UDP Netty endpoint using Request-Reply and serialized object payload</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">RouteBuilder builder = new RouteBuilder() { public void configure() { from(&amp;quot;netty:udp://localhost:5155?sync=true&amp;quot;) .process(new Processor() { public void process(Exchange exchange) throws Exception { Poetry poetry = (Poetry) exchange.getIn().getBody(); poetry.setPoet(&amp;quot;Dr. Sarojini Naidu&amp;quot;); exchange.getOut().setBody(poetry); } } } }; </script> 
 </div>
</div><h4 id="BookInOnePage-ATCPbasedNettyconsumerendpointusingOne-waycommunication">A TCP based Netty consumer endpoint using One-way communication</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">RouteBuilder builder = new RouteBuilder() { public void configure() { from(&amp;quot;netty:tcp://localhost:5150&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); } }; </script> 
 </div>
</div><h4 id="BookInOnePage-AnSSL/TCPbasedNettyconsumerendpointusingRequest-Replycommunication">An SSL/TCP based Netty consumer endpoint using Request-Reply communication</h4><h5 id="BookInOnePage-UsingtheJSSEConfigurationUtility.5">Using the JSSE Configuration Utility</h5><p>As of Camel 2.9, the Netty component supports SSL/TLS configuration through the <a shape="rect" href="camel-configuration-utilities.html">Camel JSSE Configuration Utility</a>.&#160; This utility greatly decreases the amount of component specific code you need to write and is configurable at the endpoint and component levels.&#160; The following examples demonstrate how to use the utility with the Netty component.</p><h6 id="BookInOnePage-Programmaticconfigurationofthecomponent.2">Programmatic configuration of the component</h6><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">KeyStoreParameters ksp = new KeyStoreParameters(); ksp.setResource(&amp;quot;/users/home/server/keystore.jks&amp;quot;); ksp.setPassword(&amp;quot;keystorePassword&amp;quot;); KeyManagersParameters kmp = new KeyManagersParameters(); kmp.setKeyStore(ksp); kmp.setKeyPassword(&amp;quot;keyPassword&amp;quot;); SSLContextParameters scp = new SSLContextParameters(); scp.setKeyManagers(kmp); NettyComponent nettyComponent = getContext().getComponent(&amp;quot;netty&amp;quot;, NettyComponent.class); nettyComponent.setSslContextParameters(scp); </script> 
 </div>
</div><h6 id="BookInOnePage-SpringDSLbasedconfigurationofendpoint.4">Spring DSL based configuration of endpoint</h6><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">... &amp;lt;camel:sslContextParameters id=&amp;quot;sslContextParameters&amp;quot;&amp;gt; &amp;lt;camel:keyManagers keyPassword=&amp;quot;keyPassword&amp;quot;&amp;gt; &amp;lt;camel:keyStore resource=&amp;quot;/users/home/server/keystore.jks&amp;quot; password=&amp;quot;keystorePassword&amp;quot;/&amp;gt; &amp;lt;/camel:keyManagers&amp;gt; &amp;lt;/camel:sslContextParameters&amp;gt;... ... &amp;lt;to uri=&amp;quot;netty:tcp://localhost:5150?sync=true&amp;amp;ssl=true&amp;amp;sslContextParameters=#sslContextParameters&amp;quot;/&amp;gt; ... </script> 
 </div>
</div><h5 id="BookInOnePage-UsingBasicSSL/TLSconfigurationontheJettyComponent">Using Basic SSL/TLS configuration on the Jetty Component</h5><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">JndiRegistry registry = new JndiRegistry(createJndiContext()); registry.bind(&amp;quot;password&amp;quot;, &amp;quot;changeit&amp;quot;); registry.bind(&amp;quot;ksf&amp;quot;, new File(&amp;quot;src/test/resources/keystore.jks&amp;quot;)); registry.bind(&amp;quot;tsf&amp;quot;, new File(&amp;quot;src/test/resources/keystore.jks&amp;quot;)); context.createRegistry(registry); context.addRoutes(new RouteBuilder() { public void configure() { String netty_ssl_endpoint = &amp;quot;netty:tcp://localhost:5150?sync=true&amp;amp;ssl=true&amp;amp;passphrase=#password&amp;quot; + &amp;quot;&amp;amp;keyStoreFile=#ksf&amp;amp;trustStoreFile=#tsf&amp;quot;; String return_string = &amp;quot;When You Go Home, Tell Them Of Us And Say,&amp;quot; + &amp;quot;For Your Tomorrow, We Gave Our Today.&amp;quot;; from(netty_ssl_endpoint) .process(new Processor() { public void process(Exchange exchange) throws Exception { exchange.getOut().setBody(return_string); } } } }); </script> 
 </div>
</div><h5 id="BookInOnePage-GettingaccesstoSSLSessionandtheclientcertificate">Getting access to SSLSession and the client certificate</h5><p><strong>Available as of Camel 2.12</strong></p><p>You can get access to the <code>javax.net.ssl.SSLSession</code> if you eg need to get details about the client certificate. When <code>ssl=true</code> then the <a shape="rect" href="netty.html">Netty</a> component will store the <code>SSLSession</code> as a header on the Camel <a shape="rect" href="message.html">Message</a> as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">SSLSession session = exchange.getIn().getHeader(NettyConstants.NETTY_SSL_SESSION, SSLSession.class); // get the first certificate which is client certificate javax.security.cert.X509Certificate cert = session.getPeerCertificateChain()[0]; Principal principal = cert.getSubjectDN(); </script> 
 </div>
</div><p>Remember to set <code>needClientAuth=true</code> to authenticate the client, otherwise <code>SSLSession</code> cannot access information about the client certificate, and you may get an exception <code>javax.net.ssl.SSLPeerUnverifiedException: peer not authenticated</code>. You may also get this exception if the client certificate is expired or not valid etc.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The option <code>sslClientCertHeaders</code> can be set to <code>true</code> which then enriches the Camel <a shape="rect" href="message.html">Message</a> with headers having details about the client certificate. For example the subject name is readily available in the header <code>CamelNettySSLClientCertSubjectName</code>.</p>
 </div>
</div><h4 id="BookInOnePage-UsingMultipleCodecs">Using Multiple Codecs</h4><p>In certain cases it may be necessary to add chains of encoders and decoders to the netty pipeline. To add multpile codecs to a camel netty endpoint the 'encoders' and 'decoders' uri parameters should be used. Like the 'encoder' and 'decoder' parameters they are used to supply references (to lists of ChannelUpstreamHandlers and ChannelDownstreamHandlers) that should be added to the pipeline. Note that if encoders is specified then the encoder param will be ignored, similarly for decoders and the decoder param.</p><div class="confluence-information-macro confluence-information-macro-information">
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Read further above about using non shareable encoders/decoders.</p>
 </div>
</div><p>The lists of codecs need to be added to the Camel's registry so they can be resolved when the endpoint is created.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> ChannelHandlerFactory lengthDecoder = ChannelHandlerFactories.newLengthFieldBasedFrameDecoder(1048576, 0, 4, 0, 4); StringDecoder stringDecoder = new StringDecoder(); registry.bind(&amp;quot;length-decoder&amp;quot;, lengthDecoder); registry.bind(&amp;quot;string-decoder&amp;quot;, stringDecoder); LengthFieldPrepender lengthEncoder = new LengthFieldPrepender(4); StringEncoder stringEncoder = new StringEncoder(); registry.bind(&amp;quot;length-encoder&amp;quot;, lengthEncoder); registry.bind(&amp;quot;string-encoder&amp;quot;, stringEncoder); List&amp;lt;ChannelHandler&amp;gt; decoders = new ArrayList&amp;lt;ChannelHandler&amp;gt;(); decoders.add(lengthDecoder); decoders.add(stringDecoder); List&amp;lt;ChannelHandler&amp;gt; encoders = new ArrayList&amp;lt;ChannelHandler&amp;gt;(); encoders.add(lengthEncoder); encoders.add(stringEncoder); registry.bind(&amp;quot;encoders&amp;quot;, encoders); registry.bind(&amp;quot;decoders&amp;quot;, decoders); </script> 
  </div>
 </div>Spring's native collections support can be used to specify the codec lists in an application context
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;util:list id=&amp;quot;decoders&amp;quot; list-class=&amp;quot;java.util.LinkedList&amp;quot;&amp;gt; &amp;lt;bean class=&amp;quot;org.apache.camel.component.netty.ChannelHandlerFactories&amp;quot; factory-method=&amp;quot;newLengthFieldBasedFrameDecoder&amp;quot;&amp;gt; &amp;lt;constructor-arg value=&amp;quot;1048576&amp;quot;/&amp;gt; &amp;lt;constructor-arg value=&amp;quot;0&amp;quot;/&amp;gt; &amp;lt;constructor-arg value=&amp;quot;4&amp;quot;/&amp;gt; &amp;lt;constructor-arg value=&amp;quot;0&amp;quot;/&amp;gt; &amp;lt;constructor-arg value=&amp;quot;4&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean class=&amp;quot;org.jboss.netty.handler.codec.string.StringDecoder&amp;quot;/&amp;gt; &amp;lt;/util:list&amp;gt; &amp;lt;util:list id=&amp;quot;encoders&amp;quot; list-class=&amp;quot;java.util.LinkedList&amp;quot;&amp;gt; &amp;lt;bean class=&amp;quot;org.jboss.netty.handler.codec.frame.LengthFieldPrepender&amp;quot;&amp;gt; &amp;lt;constructor-arg value=&amp;quot;4&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean class=&amp;quot;org.jboss.netty.handler.codec.string.StringEncoder&amp;quot;/&amp;gt; &amp;lt;/util:list&amp;gt; &amp;lt;bean id=&amp;quot;length-encoder&amp;quot; class=&amp;quot;org.jboss.netty.handler.codec.frame.LengthFieldPrepender&amp;quot;&amp;gt; &amp;lt;constructor-arg value=&amp;quot;4&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;string-encoder&amp;quot; class=&amp;quot;org.jboss.netty.handler.codec.string.StringEncoder&amp;quot;/&amp;gt; &amp;lt;bean id=&amp;quot;length-decoder&amp;quot; class=&amp;quot;org.apache.camel.component.netty.ChannelHandlerFactories&amp;quot; factory-method=&amp;quot;newLengthFieldBasedFrameDecoder&amp;quot;&amp;gt; &amp;lt;constructor-arg value=&amp;quot;1048576&amp;quot;/&amp;gt; &amp;lt;constructor-arg value=&amp;quot;0&amp;quot;/&amp;gt; &amp;lt;constructor-arg value=&amp;quot;4&amp;quot;/&amp;gt; &amp;lt;constructor-arg value=&amp;quot;0&amp;quot;/&amp;gt; &amp;lt;constructor-arg value=&amp;quot;4&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;string-decoder&amp;quot; class=&amp;quot;org.jboss.netty.handler.codec.string.StringDecoder&amp;quot;/&amp;gt; &amp;lt;/beans&amp;gt; </script> 
  </div>
 </div>The bean names can then be used in netty endpoint definitions either as a comma separated list or contained in a List e.g.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:multiple-codec&amp;quot;).to(&amp;quot;netty:tcp://localhost:{{port}}?encoders=#encoders&amp;amp;sync=false&amp;quot;); from(&amp;quot;netty:tcp://localhost:{{port}}?decoders=#length-decoder,#string-decoder&amp;amp;sync=false&amp;quot;).to(&amp;quot;mock:multiple-codec&amp;quot;); } }; } } </script> 
  </div>
 </div>or via spring.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext id=&amp;quot;multiple-netty-codecs-context&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:multiple-codec&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;netty:tcp://localhost:5150?encoders=#encoders&amp;amp;amp;sync=false&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;netty:tcp://localhost:5150?decoders=#length-decoder,#string-decoder&amp;amp;amp;sync=false&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:multiple-codec&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
  </div>
 </div><h3 id="BookInOnePage-ClosingChannelWhenComplete">Closing Channel When Complete</h3><p>When acting as a server you sometimes want to close the channel when, for example, a client conversion is finished.<br clear="none"> You can do this by simply setting the endpoint option <code>disconnect=true</code>.</p><p>However you can also instruct Camel on a per message basis as follows.<br clear="none"> To instruct Camel to close the channel, you should add a header with the key <code>CamelNettyCloseChannelWhenComplete</code> set to a boolean <code>true</code> value.<br clear="none"> For instance, the example below will close the channel after it has written the bye message back to the client:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;netty:tcp://localhost:8080&amp;quot;).process(new Processor() { public void process(Exchange exchange) throws Exception { String body = exchange.getIn().getBody(String.class); exchange.getOut().setBody(&amp;quot;Bye &amp;quot; + body); // some condition which determines if we should close if (close) { exchange.getOut().setHeader(NettyConstants.NETTY_CLOSE_CHANNEL_WHEN_COMPLETE, true); } } }); </script> 
 </div>
</div><h3 id="BookInOnePage-Addingcustomchannelpipelinefactoriestogaincompletecontroloveracreatedpipeline">Adding custom channel pipeline factories to gain complete control over a created pipeline</h3><p><strong>Available as of Camel 2.5</strong></p><p>Custom channel pipelines provide complete control to the user over the handler/interceptor chain by inserting custom handler(s), encoder(s) &amp; decoders without having to specify them in the Netty Endpoint URL in a very simple way.</p><p>In order to add a custom pipeline, a custom channel pipeline factory must be created and registered with the context via the context registry (JNDIRegistry,or the camel-spring ApplicationContextRegistry etc).</p><p>A custom pipeline factory must be constructed as follows</p><ul><li>A Producer linked channel pipeline factory must extend the abstract class <code>ClientPipelineFactory</code>.</li><li>A Consumer linked channel pipeline factory must extend the abstract class <code>ServerPipelineFactory</code>.</li><li>The classes should override the getPipeline() method in order to insert custom handler(s), encoder(s) and decoder(s). Not overriding the getPipeline() method creates a pipeline with no handlers, encoders or decoders wired to the pipeline.</li></ul><p>The example below shows how ServerChannel Pipeline factory may be created</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>Using custom pipeline factory</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public class SampleServerChannelPipelineFactory extends ServerPipelineFactory { private int maxLineSize = 1024; public ChannelPipeline getPipeline() throws Exception { ChannelPipeline channelPipeline = Channels.pipeline(); channelPipeline.addLast(&amp;quot;encoder-SD&amp;quot;, new StringEncoder(CharsetUtil.UTF_8)); channelPipeline.addLast(&amp;quot;decoder-DELIM&amp;quot;, new DelimiterBasedFrameDecoder(maxLineSize, true, Delimiters.lineDelimiter())); channelPipeline.addLast(&amp;quot;decoder-SD&amp;quot;, new StringDecoder(CharsetUtil.UTF_8)); // here we add the default Camel ServerChannelHandler for the consumer, to allow Camel to route the message etc. channelPipeline.addLast(&amp;quot;handler&amp;quot;, new ServerChannelHandler(consumer)); return channelPipeline; } } </script> 
 </div>
</div><p>The custom channel pipeline factory can then be added to the registry and instantiated/utilized on a camel route in the following way</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Registry registry = camelContext.getRegistry(); serverPipelineFactory = new TestServerChannelPipelineFactory(); registry.bind(&amp;quot;spf&amp;quot;, serverPipelineFactory); context.addRoutes(new RouteBuilder() { public void configure() { String netty_ssl_endpoint = &amp;quot;netty:tcp://localhost:5150?serverPipelineFactory=#spf&amp;quot; String return_string = &amp;quot;When You Go Home, Tell Them Of Us And Say,&amp;quot; + &amp;quot;For Your Tomorrow, We Gave Our Today.&amp;quot;; from(netty_ssl_endpoint) .process(new Processor() { public void process(Exchange exchange) throws Exception { exchange.getOut().setBody(return_string); } } } }); </script> 
 </div>
</div><h3 id="BookInOnePage-ReusingNettybossandworkerthreadpools">Reusing Netty boss and worker thread pools</h3><p><strong>Available as of Camel 2.12</strong></p><p>Netty has two kind of thread pools: boss and worker. By default each Netty consumer and producer has their private thread pools. If you want to reuse these thread pools among multiple consumers or producers then the thread pools must be created and enlisted in the <a shape="rect" href="registry.html">Registry</a>.</p><p>For example using Spring XML we can create a shared worker thread pool using the <code>NettyWorkerPoolBuilder</code> with 2 worker threads as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- use the worker pool builder to create to help create the shared thread pool --&amp;gt; &amp;lt;bean id=&amp;quot;poolBuilder&amp;quot; class=&amp;quot;org.apache.camel.component.netty.NettyWorkerPoolBuilder&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;workerCount&amp;quot; value=&amp;quot;2&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;!-- the shared worker thread pool --&amp;gt; &amp;lt;bean id=&amp;quot;sharedPool&amp;quot; class=&amp;quot;org.jboss.netty.channel.socket.nio.WorkerPool&amp;quot; factory-bean=&amp;quot;poolBuilder&amp;quot; factory-method=&amp;quot;build&amp;quot; destroy-method=&amp;quot;shutdown&amp;quot;&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>For boss thread pool there is a <code>org.apache.camel.component.netty.NettyServerBossPoolBuilder</code> builder for Netty consumers, and a <code>org.apache.camel.component.netty.NettyClientBossPoolBuilder</code> for the Netty produces.</p>
 </div>
</div><p>Then in the Camel routes we can refer to this worker pools by configuring the <code>workerPool</code> option in the <a shape="rect" class="unresolved" href="#">URI</a> as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;netty:tcp://localhost:5021?textline=true&amp;amp;amp;sync=true&amp;amp;amp;workerPool=#sharedPool&amp;amp;amp;orderedThreadPoolExecutor=false&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;log:result&amp;quot;/&amp;gt; ... &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>And if we have another route we can refer to the shared worker pool:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;netty:tcp://localhost:5022?textline=true&amp;amp;amp;sync=true&amp;amp;amp;workerPool=#sharedPool&amp;amp;amp;orderedThreadPoolExecutor=false&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;log:result&amp;quot;/&amp;gt; ... &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>... and so forth.</p><p></p><h3 id="BookInOnePage-SeeAlso.65">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="netty-http.html">Netty HTTP</a></li><li><a shape="rect" href="mina.html">MINA</a></li></ul><h2 id="BookInOnePage-NMRComponent">NMR Component</h2><p>The <strong>nmr</strong> component is an adapter to the Normalized Message Router (NMR) in <a shape="rect" class="external-link" href="http://servicemix.apache.org/home.html">ServiceMix</a>, which is intended for use by Camel applications deployed directly into the OSGi container. You can exchange objects with NMR and not only XML like this is the case with the JBI specification. The interest of this component is that you can interconnect camel routes deployed in different OSGI bundles.</p><p>By contrast, the <a shape="rect" href="jbi.html">JBI</a> component is intended for use by Camel applications deployed into the ServiceMix JBI container.</p><h3 id="BookInOnePage-InstallinginApacheServicemix">Installing in Apache Servicemix</h3><p>The NMR component is provided with Apache ServiceMix. It is <strong>not</strong> distributed with Camel. To install the NMR component in ServiceMix, enter the following command in the ServiceMix console window:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> features:install nmr camel-nmr </script> 
 </div>
</div><h3 id="BookInOnePage-InstallinginplainApacheKaraf">Installing in plain Apache Karaf</h3><p>In plain Karaf the nmr component can also be installed using the servicemix artifacts:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> features:chooseurl camel &amp;lt;version&amp;gt; features:addurl mvn:org.apache.servicemix.nmr/apache-servicemix-nmr/1.5.0/xml/features features:install camel-blueprint nmr camel-nmr install -s mvn:org.apache.servicemix.camel/org.apache.servicemix.camel.component/4.4.2 </script> 
 </div>
</div><h3 id="BookInOnePage-Configuration">Configuration</h3><p>You also need to instantiate the NMR component. You can do this by editing your Spring configuration file, <code>META-INF/spring/*.xml</code>, and adding the following <code>bean</code> instance:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;beans xmlns:osgi=&amp;quot;http://www.springframework.org/schema/osgi&amp;quot; ... &amp;gt; ... &amp;lt;bean id=&amp;quot;nmr&amp;quot; class=&amp;quot;org.apache.servicemix.camel.nmr.ServiceMixComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;nmr&amp;quot;&amp;gt; &amp;lt;osgi:reference interface=&amp;quot;org.apache.servicemix.nmr.api.NMR&amp;quot; /&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;/bean&amp;gt; ... &amp;lt;/beans&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-NMRconsumerandproducerendpoints">NMR consumer and producer endpoints</h3><p>The following code:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;nmr:MyServiceEndpoint&amp;quot;) </script> 
 </div>
</div><p>Automatically exposes a new endpoint to the bus with endpoint name <code>MyServiceEndpoint</code> (see <a shape="rect" href="#BookInOnePage-URI-format">URI-format</a>).</p><p>When an NMR endpoint appears at the end of a route, for example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> to(&amp;quot;nmr:MyServiceEndpoint&amp;quot;) </script> 
 </div>
</div><p>The messages sent by this producer endpoint are sent to the already deployed NMR endpoint.</p><p><span class="confluence-anchor-link" id="BookInOnePage-URI-format"></span></p><h3 id="BookInOnePage-URIformat.47">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> nmr:endpointName </script> 
 </div>
</div><h4 id="BookInOnePage-URIOptions.8">URI Options</h4><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Option </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default Value </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>runAsSubject</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Apache ServiceMix 4.4:</strong> When this is set to <code><strong>true</strong></code> on a consumer endpoint, the endpoint will be invoked on behalf of the <code>Subject</code> that is set on the <code>Exchange</code> (i.e. the call to <code>Subject.getSubject(AccessControlContext)</code> will return the <code>Subject</code> instance) </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>synchronous</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> When this is set to <code><strong>true</strong></code> on a consumer endpoint, an incoming, synchronous NMR Exchange will be handled on the sender's thread instead of being handled on a new thread of the NMR endpoint's thread pool </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>timeout</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>0</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Apache ServiceMix 4.4:</strong> When this is set to a value greater than 0, the producer endpoint will timeout if it doesn't receive a response from the NMR within the given timeout period (in milliseconds). Configuring a timeout value will switch to using synchronous interactions with the NMR instead of the usual asynchronous messaging. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>throwExceptionOnFailure</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> true </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Apache ServiceMix 4.5.2:</strong> When this is set to <code><strong>false</strong></code> then NMR's exceptions (like TimeoutException) will be consumed silently. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>interfaceName</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> null </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Apache ServiceMix 4.5.3:</strong> When specify this as a <code><strong>QName</strong></code> then it could be considered when NMR looking for the target NMR endpoint during dispatch</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>serviceName</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> null </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Apache ServiceMix 4.5.3:</strong> When specify this as a <code><strong>QName</strong></code> then it could be considered when NMR looking for the target NMR endpoint during dispatch</p></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-Examples.24">Examples</h4><p>Consumer</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;nmr:MyServiceEndpoint&amp;quot;) // consume nmr exchanges asynchronously from(&amp;quot;nmr:MyServiceEndpoint?synchronous=true&amp;quot;).to() // consume nmr exchanges synchronously and use the same thread as defined by NMR ThreadPool </script> 
 </div>
</div><p>Producer</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from()...to(&amp;quot;nmr:MyServiceEndpoint&amp;quot;) // produce nmr exchanges asynchronously from()...to(&amp;quot;nmr:MyServiceEndpoint?timeout=10000&amp;quot;) // produce nmr exchanges synchronously and wait till 10s to receive response </script> 
 </div>
</div><h3 id="BookInOnePage-UsingStreambodies.1">Using Stream bodies</h3><p>If you are using a stream type as the message body, you should be aware that a stream is only capable of being read once. So if you enable <code>DEBUG</code> logging, the body is usually logged and thus read. To deal with this, Camel has a <code>streamCaching</code> option that can cache the stream, enabling you to read it multiple times.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;nmr:MyEndpoint&amp;quot;).streamCaching().to(&amp;quot;xslt:transform.xsl&amp;quot;, &amp;quot;bean:doSomething&amp;quot;); </script> 
 </div>
</div><p>The stream caching is default enabled, so it is not necessary to set the <code>streamCaching()</code> option.<br clear="none"> We store big input streams (by default, over 64K) in a <code>temp</code> file using <code>CachedOutputStream</code>. When you close the input stream, the temp file will be deleted.</p><h4 id="BookInOnePage-Testing.1">Testing</h4><p>NMR camel routes can be tested using the camel unit test approach even if they will be deployed next in different bundles on an OSGI runtime. With this aim in view, you will extend the ServiceMixNMR Mock class <code>org.apache.servicemix.camel.nmr.AbstractComponentTest</code> which will create a NMR bus, register the Camel NMR Component and the endpoints defined into the Camel routes.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public class ExchangeUsingNMRTest extends AbstractComponentTest { @Test public void testProcessing() throws InterruptedException { MockEndpoint mock = getMockEndpoint(&amp;quot;mock:simple&amp;quot;); mock.expectedBodiesReceived(&amp;quot;Simple message body&amp;quot;); template.sendBody(&amp;quot;direct:simple&amp;quot;, &amp;quot;Simple message body&amp;quot;); assertMockEndpointsSatisfied(); } @Override protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { @Override public void configure() throws Exception { from(&amp;quot;direct:simple&amp;quot;).to(&amp;quot;nmr:simple&amp;quot;); from(&amp;quot;nmr:simple?synchronous=true&amp;quot;).to(&amp;quot;mock:simple&amp;quot;); } }; } } </script> 
 </div>
</div><h3 id="BookInOnePage-SeeAlso.66">See Also</h3><ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-QuartzComponent">Quartz Component</h2><p>The <strong>quartz:</strong> component provides a scheduled delivery of messages using the <a shape="rect" class="external-link" href="http://www.quartz-scheduler.org/" rel="nofollow">Quartz Scheduler 1.x </a>. <br clear="none"> Each endpoint represents a different timer (in Quartz terms, a Trigger and JobDetail).</p><div class="confluence-information-macro confluence-information-macro-tip">
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>If you are using Quartz 2.x then from Camel 2.12 onwards there is a <a shape="rect" href="quartz2.html">Quartz2</a> component you should use</p>
 </div>
</div><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-quartz&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.48">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">quartz://timerName?options quartz://groupName/timerName?options quartz://groupName/timerName?cron=expression quartz://timerName?cron=expression </script> 
 </div>
</div><p>The component uses either a <code>CronTrigger</code> or a <code>SimpleTrigger</code>. If no cron expression is provided, the component uses a simple trigger. If no <code>groupName</code> is provided, the quartz component uses the <code>Camel</code> group name.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.59">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Parameter</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cron</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em>None</em></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies a <code>cron</code> expression (not compatible with the <code>trigger.*</code> or <code>job.*</code> options).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>trigger.repeatCount</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>SimpleTrigger: How many times should the timer repeat?</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>trigger.repeatInterval</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>SimpleTrigger: The amount of time in milliseconds between repeated triggers.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>job.name</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sets the job name.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>job.<em>XXX</em></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sets the job option with the <code><em>XXX</em></code> setter name.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>trigger.<em>XXX</em></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sets the trigger option with the <code><em>XXX</em></code> setter name.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>stateful</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Uses a Quartz <code>StatefulJob</code> instead of the default job.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>fireNow</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>New to Camel 2.2.0, if it is true will fire the trigger when the route is start when using SimpleTrigger.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>deleteJob</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> If set to true, then the trigger automatically delete when route stop. Else if set to false, it will remain in scheduler. When set to false, it will also mean user may reuse pre-configured trigger with camel Uri. Just ensure the names match. Notice you cannot have both deleteJob and pauseJob set to true.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>pauseJob</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> If set to true, then the trigger automatically pauses when route stop. Else if set to false, it will remain in scheduler. When set to false, it will also mean user may reuse pre-configured trigger with camel Uri. Just ensure the names match. Notice you cannot have both deleteJob and pauseJob set to true.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>usingFixedCamelContextName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong><strong>Camel 2.15.0: </strong></strong><span><span>If it is true, <span>JobDataMap </span></span></span><span>uses the CamelContext name directly to reference the camel context, </span><span>if it is false, <span>JobDataMap </span><span>uses </span>use the CamelContext management name which could be changed during the deploy time.</span></td></tr></tbody></table> 
 </div>
</div><p>For example, the following routing rule will fire two timer events to the <code>mock:results</code> endpoint:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;quartz://myGroup/myTimerName?trigger.repeatInterval=2&amp;amp;trigger.repeatCount=1&amp;quot;).routeId(&amp;quot;myRoute&amp;quot;).to(&amp;quot;mock:result&amp;quot;); </script> 
 </div>
</div><p>When using a <a shape="rect" class="external-link" href="http://quartz-scheduler.org/api/2.0.0/org/quartz/StatefulJob.html" rel="nofollow">StatefulJob</a>, the <a shape="rect" class="external-link" href="http://quartz-scheduler.org/api/2.0.0/org/quartz/JobDataMap.html" rel="nofollow">JobDataMap</a> is re-persisted after every execution of the job, thus preserving state for the next execution.</p><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Running in OSGi and having multiple bundles with quartz routes</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>If you run in OSGi such as Apache ServiceMix, or Apache Karaf, and have multiple bundles with Camel routes that start from <a shape="rect" href="quartz.html">Quartz</a> endpoints, then make sure if you assign<br clear="none"> an <code>id</code> to the &lt;camelContext&gt; that this id is unique, as this is required by the <code>QuartzScheduler</code> in the OSGi container. If you do not set any <code>id</code> on &lt;camelContext&gt; then<br clear="none"> a unique id is auto assigned, and there is no problem.</p>
 </div>
</div><h3 id="BookInOnePage-Configuringquartz.propertiesfile">Configuring quartz.properties file</h3><p>By default Quartz will look for a <code>quartz.properties</code> file in the <code>org/quartz</code> directory of the classpath. If you are using WAR deployments this means just drop the quartz.properties in <code>WEB-INF/classes/org/quartz</code>.</p><p>However the Camel <a shape="rect" href="quartz.html">Quartz</a> component also allows you to configure properties:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Parameter</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>properties</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Properties</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.4</strong>: You can configure a <code>java.util.Properties</code> instance.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>propertiesFile</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.4</strong>: File name of the properties to load from the classpath</p></td></tr></tbody></table> 
 </div>
</div><p>To do this you can configure this in Spring XML as follows</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;quartz&amp;quot; class=&amp;quot;org.apache.camel.component.quartz.QuartzComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;propertiesFile&amp;quot; value=&amp;quot;com/mycompany/myquartz.properties&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-EnablingQuartzschedulerinJMX">Enabling Quartz scheduler in JMX</h3><p>You need to configure the quartz scheduler properties to enable JMX.<br clear="none"> That is typically setting the option <code>"org.quartz.scheduler.jmx.export"</code> to a <code>true</code> value in the configuration file.</p><p>From Camel 2.13 onwards Camel will automatic set this option to true, unless explicit disabled.</p><h3 id="BookInOnePage-StartingtheQuartzscheduler">Starting the Quartz scheduler</h3><p><strong>Available as of Camel 2.4</strong></p><p>The <a shape="rect" href="quartz.html">Quartz</a> component offers an option to let the Quartz scheduler be started delayed, or not auto started at all.</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Parameter</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>startDelayedSeconds</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>int</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.4</strong>: Seconds to wait before starting the quartz scheduler.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>autoStartScheduler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.4:</strong> Whether or not the scheduler should be auto started.</p></td></tr></tbody></table> 
 </div>
</div><p>To do this you can configure this in Spring XML as follows</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;quartz&amp;quot; class=&amp;quot;org.apache.camel.component.quartz.QuartzComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;startDelayedSeconds&amp;quot; value=&amp;quot;5&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Clustering">Clustering</h3><p><strong>Available as of Camel 2.4</strong></p><p>If you use Quartz in clustered mode, e.g. the <code>JobStore</code> is clustered. Then from Camel 2.4 onwards the <a shape="rect" href="quartz.html">Quartz</a> component will <strong>not</strong> pause/remove triggers when a node is being stopped/shutdown. This allows the trigger to keep running on the other nodes in the cluster.</p><p><strong>Note</strong>: When running in clustered node no checking is done to ensure unique job name/group for endpoints.</p><h3 id="BookInOnePage-MessageHeaders.14">Message Headers</h3><p>Camel adds the getters from the Quartz Execution Context as header values. The following headers are added:<br clear="none"> <code>calendar</code>, <code>fireTime</code>, <code>jobDetail</code>, <code>jobInstance</code>, <code>jobRuntTime</code>, <code>mergedJobDataMap</code>, <code>nextFireTime</code>, <code>previousFireTime</code>, <code>refireCount</code>, <code>result</code>, <code>scheduledFireTime</code>, <code>scheduler</code>, <code>trigger</code>, <code>triggerName</code>, <code>triggerGroup</code>.</p><p>The <code>fireTime</code> header contains the <code>java.util.Date</code> of when the exchange was fired.</p><h3 id="BookInOnePage-UsingCronTriggers">Using Cron Triggers</h3><p>Quartz supports <a shape="rect" class="external-link" href="http://www.quartz-scheduler.org/documentation/quartz-2.1.x/tutorials/crontrigger" rel="nofollow">Cron-like expressions</a> for specifying timers in a handy format. You can use these expressions in the <code>cron</code> URI parameter; though to preserve valid URI encoding we allow + to be used instead of spaces. Quartz provides a <a shape="rect" class="external-link" href="http://www.quartz-scheduler.org/docs/tutorials/crontrigger.html" rel="nofollow">little tutorial</a> on how to use cron expressions.</p><p>For example, the following will fire a message every five minutes starting at 12pm (noon) to 6pm on weekdays:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;quartz://myGroup/myTimerName?cron=0+0/5+12-18+?+*+MON-FRI&amp;quot;).to(&amp;quot;activemq:Totally.Rocks&amp;quot;); </script> 
 </div>
</div><p>which is equivalent to using the cron expression</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">0 0/5 12-18 ? * MON-FRI </script> 
 </div>
</div><p>The following table shows the URI character encodings we use to preserve valid URI syntax:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>URI Character</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Cron character</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>+</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em>Space</em></p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Specifyingtimezone">Specifying time zone</h3><p><strong>Available as of Camel 2.8.1</strong><br clear="none"> The Quartz Scheduler allows you to configure time zone per trigger. For example to use a timezone of your country, then you can do as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">quartz://groupName/timerName?cron=0+0/5+12-18+?+*+MON-FRI&amp;amp;trigger.timeZone=Europe/Stockholm </script> 
 </div>
</div><p>The timeZone value is the values accepted by <code>java.util.TimeZone</code>.</p><p>In Camel 2.8.0 or older versions you would have to provide your custom <code>String</code> to <code>java.util.TimeZone</code> <a shape="rect" href="type-converter.html">Type Converter</a> to be able configure this from the endpoint uri.<br clear="none"> From Camel 2.8.1 onwards we have included such a <a shape="rect" href="type-converter.html">Type Converter</a> in the camel-core.</p><p></p><h3 id="BookInOnePage-SeeAlso.67">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul><li><a shape="rect" href="quartz2.html">Quartz2</a></li><li><a shape="rect" href="timer.html">Timer</a></li></ul><h2 id="BookInOnePage-QuickFIX/JComponent">QuickFIX/J Component</h2><p>The <strong>quickfix</strong> component adapts the <a shape="rect" class="external-link" href="http://www.quickfixj.org/" rel="nofollow">QuickFIX/J</a> FIX engine for using in Camel . This component uses the standard <a shape="rect" class="external-link" href="http://www.fixprotocol.org/" rel="nofollow">Financial Interchange (FIX) protocol</a> for message transport.</p><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Previous Versions</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The <strong>quickfix</strong> component was rewritten for Camel 2.5. For information about using the <strong>quickfix</strong> component prior to 2.5 see the documentation section below.</p>
 </div>
</div><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-quickfix&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.49">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">quickfix:configFile[?sessionID=sessionID&amp;amp;lazyCreateEngine=true|false] </script> 
 </div>
</div><p>The <strong>configFile</strong> is the name of the QuickFIX/J configuration to use for the FIX engine (located as a resource found in your classpath). The optional <strong>sessionID</strong> identifies a specific FIX session. The format of the sessionID is:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">(BeginString):(SenderCompID)[/(SenderSubID)[/(SenderLocationID)]]-&amp;gt;(TargetCompID)[/(TargetSubID)[/(TargetLocationID)]] </script> 
 </div>
</div><p>The optional <strong>lazyCreateEngine</strong> (Camel 2.12.3+) parameter allows to create QuickFIX/J engine on demand. Value <strong>true</strong> means the engine is started when first message is send or there's consumer configured in route definition. When&#160;<strong>false</strong> value is used, the engine is started at the endpoint creation. When this parameter is missing, the value of component's property <strong>lazyCreateEngines</strong> is being used.</p><p>Example URIs:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">quickfix:config.cfg quickfix:config.cfg?sessionID=FIX.4.2:MyTradingCompany-&amp;gt;SomeExchange quickfix:config.cfg?sessionID=FIX.4.2:MyTradingCompany-&amp;gt;SomeExchange&amp;amp;lazyCreateEngine=true</script> 
 </div>
</div><h2 id="BookInOnePage-Endpoints">Endpoints</h2><p>FIX sessions are endpoints for the <strong>quickfix</strong> component. An endpoint URI may specify a single session or all sessions managed by a specific QuickFIX/J engine. Typical applications will use only one FIX engine but advanced users may create multiple FIX engines by referencing different configuration files in <strong>quickfix</strong> component endpoint URIs.</p><p>When a consumer does not include a session ID in the endpoint URI, it will receive exchanges for all sessions managed by the FIX engine associated with the configuration file specified in the URI. If a producer does not specify a session in the endpoint URI then it must include the session-related fields in the FIX message being sent. If a session is specified in the URI then the component will automatically inject the session-related fields into the FIX message.</p><h3 id="BookInOnePage-ExchangeFormat">Exchange Format</h3><p>The exchange headers include information to help with exchange filtering, routing and other processing. The following headers are available:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Header Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> EventCategory </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> One of <code>AppMessageReceived</code>, <code>AppMessageSent</code>, <code>AdminMessageReceived</code>, <code>AdminMessageSent</code>, <code>SessionCreated</code>, <code>SessionLogon</code>, <code>SessionLogoff</code>. See the <code>QuickfixjEventCategory</code> enum. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> SessionID </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The FIX message SessionID </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> MessageType </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The FIX MsgType tag value </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> DataDictionary </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Specifies a data dictionary to used for parsing an incoming message. Can be an instance of a data dictionary or a resource path for a QuickFIX/J data dictionary file </p></td></tr></tbody></table> 
 </div>
</div><p>The DataDictionary header is useful if string messages are being received and need to be parsed in a route. QuickFIX/J requires a data dictionary to parse certain types of messages (with repeating groups, for example). By injecting a DataDictionary header in the route after receiving a message string, the FIX engine can properly parse the data.</p><h3 id="BookInOnePage-QuickFIX/JConfigurationExtensions">QuickFIX/J Configuration Extensions</h3><p>When using QuickFIX/J directly, one typically writes code to create instances of logging adapters, message stores and communication connectors. The <strong>quickfix</strong> component will automatically create instances of these classes based on information in the configuration file. It also provides defaults for many of the common required settings and adds additional capabilities (like the ability to activate JMX support).</p><p>The following sections describe how the <strong>quickfix</strong> component processes the QuickFIX/J configuration. For comprehensive information about QuickFIX/J configuration, see the <a shape="rect" class="external-link" href="http://www.quickfixj.org/quickfixj/usermanual/usage/configuration.html" rel="nofollow">QFJ user manual</a>.</p><h4 id="BookInOnePage-CommunicationConnectors">Communication Connectors</h4><p>When the component detects an initiator or acceptor session setting in the QuickFIX/J configuration file it will automatically create the corresponding initiator and/or acceptor connector. These settings can be in the default or in a specific session section of the configuration file.</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Session Setting </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Component Action </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>ConnectionType=initiator</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Create an initiator connector </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>ConnectionType=acceptor</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Create an acceptor connector </p></td></tr></tbody></table> 
 </div>
</div><p>The threading model for the QuickFIX/J session connectors can also be specified. These settings affect all sessions in the configuration file and must be placed in the settings default section.</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Default/Global Setting </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Component Action </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>ThreadModel=ThreadPerConnector</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Use <code>SocketInitiator</code> or <code>SocketAcceptor</code> (default) </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>ThreadModel=ThreadPerSession</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Use <code>ThreadedSocketInitiator</code> or <code>ThreadedSocketAcceptor</code> </p></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-Logging">Logging</h4><p>The QuickFIX/J logger implementation can be specified by including the following settings in the default section of the configuration file. The <code>ScreenLog</code> is the default if none of the following settings are present in the configuration. It's an error to include settings that imply more than one log implementation. The log factory implementation can also be set directly on the Quickfix component. This will override any related values in the QuickFIX/J settings file.</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Default/Global Setting </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Component Action </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>ScreenLogShowEvents</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Use a <code>ScreenLog</code> </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>ScreenLogShowIncoming</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Use a <code>ScreenLog</code> </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>ScreenLogShowOutgoing</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Use a <code>ScreenLog</code> </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>SLF4J*</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.6+</strong>. Use a <code>SLF4JLog</code>. Any of the SLF4J settings will cause this log to be used. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>FileLogPath</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Use a <code>FileLog</code> </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>JdbcDriver</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Use a <code>JdbcLog</code> </p></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-MessageStore">Message Store</h4><p>The QuickFIX/J message store implementation can be specified by including the following settings in the default section of the configuration file. The <code>MemoryStore</code> is the default if none of the following settings are present in the configuration. It's an error to include settings that imply more than one message store implementation. The message store factory implementation can also be set directly on the Quickfix component. This will override any related values in the QuickFIX/J settings file.</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Default/Global Setting </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Component Action </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>JdbcDriver</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Use a <code>JdbcStore</code> </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>FileStorePath</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Use a <code>FileStore</code> </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>SleepycatDatabaseDir</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Use a <code>SleepcatStore</code> </p></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-MessageFactory">Message Factory</h4><p>A message factory is used to construct domain objects from raw FIX messages. The default message factory is <code>DefaultMessageFactory</code>. However, advanced applications may require a custom message factory. This can be set on the QuickFIX/J component.</p><h4 id="BookInOnePage-JMX">JMX</h4><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Default/Global Setting </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Component Action </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>UseJmx</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> if <code>Y</code>, then enable QuickFIX/J JMX </p></td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-OtherDefaults">Other Defaults</h4><p>The component provides some default settings for what are normally required settings in QuickFIX/J configuration files. <code>SessionStartTime</code> and <code>SessionEndTime</code> default to "00:00:00", meaning the session will not be automatically started and stopped. The <code>HeartBtInt</code> (heartbeat interval) defaults to 30 seconds.</p><h4 id="BookInOnePage-MinimalInitiatorConfigurationExample">Minimal Initiator Configuration Example</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">[SESSION] ConnectionType=initiator BeginString=FIX.4.4 SenderCompID=YOUR_SENDER TargetCompID=YOUR_TARGET </script> 
 </div>
</div><h3 id="BookInOnePage-UsingtheInOutMessageExchangePattern">Using the InOut Message Exchange Pattern</h3><p><strong>Camel 2.8+</strong></p><p>Although the FIX protocol is event-driven and asynchronous, there are specific pairs of messages<br clear="none"> that represent a request-reply message exchange. To use an InOut exchange pattern, there should<br clear="none"> be a single request message and single reply message to the request. Examples include an <br clear="none"> OrderStatusRequest message and UserRequest.</p><h4 id="BookInOnePage-ImplementingInOutExchangesforConsumers">Implementing InOut Exchanges for Consumers</h4><p>Add "exchangePattern=InOut" to the QuickFIX/J enpoint URI. The <code>MessageOrderStatusService</code> in<br clear="none"> the example below is a bean with a synchronous service method. The method returns the response<br clear="none"> to the request (an ExecutionReport in this case) which is then sent back to the requestor session.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;quickfix:examples/inprocess.cfg?sessionID=FIX.4.2:MARKET-&amp;gt;TRADER&amp;amp;exchangePattern=InOut&amp;quot;) .filter(header(QuickfixjEndpoint.MESSAGE_TYPE_KEY).isEqualTo(MsgType.ORDER_STATUS_REQUEST)) .bean(new MarketOrderStatusService()); </script> 
 </div>
</div><h4 id="BookInOnePage-ImplementingInOutExchangesforProducers">Implementing InOut Exchanges for Producers</h4><p>For producers, sending a message will block until a reply is received or a timeout occurs. There<br clear="none"> is no standard way to correlate reply messages in FIX. Therefore, a correlation criteria must be<br clear="none"> defined for each type of InOut exchange. The correlation criteria and timeout can be specified<br clear="none"> using <code>Exchange</code> properties.</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Key String</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Key Constant</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>Correlation Criteria</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>"CorrelationCriteria"</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>QuickfixjProducer.CORRELATION_CRITERIA_KEY</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>None</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>Correlation Timeout in Milliseconds</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>"CorrelationTimeout"</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>QuickfixjProducer.CORRELATION_TIMEOUT_KEY</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>1000</p></td></tr></tbody></table>
</div><p>The correlation criteria is defined with a <code>MessagePredicate</code> object. The following example will treat<br clear="none"> a FIX ExecutionReport from the specified session where the transaction type is STATUS and the Order ID<br clear="none"> matches our request. The session ID should be for the <em>requestor</em>, the sender and target CompID fields<br clear="none"> will be reversed when looking for the reply.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">exchange.setProperty(QuickfixjProducer.CORRELATION_CRITERIA_KEY, new MessagePredicate(new SessionID(sessionID), MsgType.EXECUTION_REPORT) .withField(ExecTransType.FIELD, Integer.toString(ExecTransType.STATUS)) .withField(OrderID.FIELD, request.getString(OrderID.FIELD))); </script> 
 </div>
</div><h4 id="BookInOnePage-Example.28">Example</h4><p>The source code contains an example called <code>RequestReplyExample</code> that demonstrates the InOut exchanges<br clear="none"> for a consumer and producer. This example creates a simple HTTP server endpoint that accepts order<br clear="none"> status requests. The HTTP request is converted to a FIX OrderStatusRequestMessage, is augmented with a<br clear="none"> correlation criteria, and is then routed to a quickfix endpoint. The response is then converted to a<br clear="none"> JSON-formatted string and sent back to the HTTP server endpoint to be provided as the web response.</p><p>The Spring configuration have changed from Camel 2.9 onwards. See further below for example.</p><h3 id="BookInOnePage-SpringConfiguration">Spring Configuration</h3><p><strong>Camel 2.6 - 2.8.x</strong></p><p>The QuickFIX/J component includes a Spring <code>FactoryBean</code> for configuring the session settings within a Spring context. A type converter for QuickFIX/J session ID strings is also included. The following example shows a simple configuration of an acceptor and initiator session with default settings for both sessions.</p><div class="error">
 <span class="error">Error formatting macro: snippet: java.lang.IndexOutOfBoundsException: Index: 20, Size: 20</span> 
</div><p><strong>Camel 2.9 onwards</strong></p><p>The QuickFIX/J component includes a <code>QuickfixjConfiguration</code> class for configuring the session settings. A type converter for QuickFIX/J session ID strings is also included. The following example shows a simple configuration of an acceptor and initiator session with default settings for both sessions.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- tag::e1[] --&amp;gt; &amp;lt;!-- camel route --&amp;gt; &amp;lt;camelContext id=&amp;quot;quickfixjContext&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;quickfix:example&amp;quot;/&amp;gt; &amp;lt;filter&amp;gt; &amp;lt;simple&amp;gt;${in.header.EventCategory} == &amp;#39;AppMessageReceived&amp;#39;&amp;lt;/simple&amp;gt; &amp;lt;to uri=&amp;quot;log:test&amp;quot;/&amp;gt; &amp;lt;/filter&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;vm:test&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;lazyQuickfix:example&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;!-- quickfix component --&amp;gt; &amp;lt;bean id=&amp;quot;quickfix&amp;quot; class=&amp;quot;org.apache.camel.component.quickfixj.QuickfixjComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;configurations&amp;quot;&amp;gt; &amp;lt;util:map&amp;gt; &amp;lt;entry key=&amp;quot;example&amp;quot; value-ref=&amp;quot;quickfixjConfiguration&amp;quot;/&amp;gt; &amp;lt;/util:map&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;property name=&amp;quot;messageFactory&amp;quot;&amp;gt; &amp;lt;bean class=&amp;quot;org.apache.camel.component.quickfixj.QuickfixjSpringTest.CustomMessageFactory&amp;quot;/&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;!-- lazy quickfix component --&amp;gt; &amp;lt;bean id=&amp;quot;lazyQuickfix&amp;quot; class=&amp;quot;org.apache.camel.component.quickfixj.QuickfixjComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;lazyCreateEngines&amp;quot; value=&amp;quot;true&amp;quot; /&amp;gt; &amp;lt;property name=&amp;quot;configurations&amp;quot;&amp;gt; &amp;lt;util:map&amp;gt; &amp;lt;entry key=&amp;quot;example&amp;quot; value-ref=&amp;quot;lazyQuickfixjConfiguration&amp;quot;/&amp;gt; &amp;lt;/util:map&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;property name=&amp;quot;messageFactory&amp;quot;&amp;gt; &amp;lt;bean class=&amp;quot;org.apache.camel.component.quickfixj.QuickfixjSpringTest.CustomMessageFactory&amp;quot;/&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;!-- quickfix settings --&amp;gt; &amp;lt;bean id=&amp;quot;quickfixjConfiguration&amp;quot; class=&amp;quot;org.apache.camel.component.quickfixj.QuickfixjConfiguration&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;defaultSettings&amp;quot;&amp;gt; &amp;lt;util:map&amp;gt; &amp;lt;entry key=&amp;quot;SocketConnectProtocol&amp;quot; value=&amp;quot;VM_PIPE&amp;quot;/&amp;gt; &amp;lt;entry key=&amp;quot;SocketAcceptProtocol&amp;quot; value=&amp;quot;VM_PIPE&amp;quot;/&amp;gt; &amp;lt;entry key=&amp;quot;UseDataDictionary&amp;quot; value=&amp;quot;N&amp;quot;/&amp;gt; &amp;lt;/util:map&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;property name=&amp;quot;sessionSettings&amp;quot;&amp;gt; &amp;lt;util:map&amp;gt; &amp;lt;entry key=&amp;quot;FIX.4.2:INITIATOR-&amp;gt;ACCEPTOR&amp;quot;&amp;gt; &amp;lt;util:map&amp;gt; &amp;lt;entry key=&amp;quot;ConnectionType&amp;quot; value=&amp;quot;initiator&amp;quot;/&amp;gt; &amp;lt;entry key=&amp;quot;SocketConnectHost&amp;quot; value=&amp;quot;localhost&amp;quot;/&amp;gt; &amp;lt;entry key=&amp;quot;SocketConnectPort&amp;quot; value=&amp;quot;5000&amp;quot;/&amp;gt; &amp;lt;/util:map&amp;gt; &amp;lt;/entry&amp;gt; &amp;lt;entry key=&amp;quot;FIX.4.2:ACCEPTOR-&amp;gt;INITIATOR&amp;quot;&amp;gt; &amp;lt;util:map&amp;gt; &amp;lt;entry key=&amp;quot;ConnectionType&amp;quot; value=&amp;quot;acceptor&amp;quot;/&amp;gt; &amp;lt;entry key=&amp;quot;SocketAcceptPort&amp;quot; value=&amp;quot;5000&amp;quot;/&amp;gt; &amp;lt;/util:map&amp;gt; &amp;lt;/entry&amp;gt; &amp;lt;/util:map&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;!-- end::e1[] --&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Exceptionhandling">Exception handling</h3><p>QuickFIX/J behavior can be modified if certain exceptions are thrown during processing of a message. If a <code>RejectLogon</code> exception is thrown while processing an incoming logon administrative message, then the logon will be rejected.</p><p>Normally, QuickFIX/J handles the logon process automatically. However, sometimes an outgoing logon message must be modified to include credentials required by a FIX counterparty. If the FIX logon message body is modified when sending a logon message (EventCategory=<code>AdminMessageSent</code> the modified message will be sent to the counterparty. It is important that the outgoing logon message is being processed <em>synchronously</em>. If it is processed asynchronously (on another thread), the FIX engine will immediately send the unmodified outgoing message when it's callback method returns.</p><h3 id="BookInOnePage-FIXSequenceNumberManagement">FIX Sequence Number Management</h3><p>If an application exception is thrown during <em>synchronous</em> exchange processing, this will cause QuickFIX/J to not increment incoming FIX message sequence numbers and will cause a resend of the counterparty message. This FIX protocol behavior is primarily intended to handle <em>transport</em> errors rather than application errors. There are risks associated with using this mechanism to handle application errors. The primary risk is that the message will repeatedly cause application errors each time it's re-received. A better solution is to persist the incoming message (database, JMS queue) immediately before processing it. This also allows the application to process messages asynchronously without losing messages when errors occur.</p><p>Although it's possible to send messages to a FIX session before it's logged on (the messages will be sent at logon time), it is usually a better practice to wait until the session is logged on. This eliminates the required sequence number resynchronization steps at logon. Waiting for session logon can be done by setting up a route that processes the <code>SessionLogon</code> event category and signals the application to start sending messages.</p><p>See the FIX protocol specifications and the QuickFIX/J documentation for more details about FIX sequence number management.</p><h3 id="BookInOnePage-RouteExamples">Route Examples</h3><p>Several examples are included in the QuickFIX/J component source code (test subdirectories). One of these examples implements a trival trade excecution simulation. The example defines an application component that uses the URI scheme "trade-executor".</p><p>The following route receives messages for the trade executor session and passes application messages to the trade executor component.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;quickfix:examples/inprocess.cfg?sessionID=FIX.4.2:MARKET-&amp;gt;TRADER&amp;quot;). filter(header(QuickfixjEndpoint.EVENT_CATEGORY_KEY).isEqualTo(QuickfixjEventCategory.AppMessageReceived)). to(&amp;quot;trade-executor:market&amp;quot;); </script> 
 </div>
</div><p>The trade executor component generates messages that are routed back to the trade session. The session ID must be set in the FIX message itself since no session ID is specified in the endpoint URI.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;trade-executor:market&amp;quot;).to(&amp;quot;quickfix:examples/inprocess.cfg&amp;quot;); </script> 
 </div>
</div><p>The trader session consumes execution report messages from the market and processes them.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;quickfix:examples/inprocess.cfg?sessionID=FIX.4.2:TRADER-&amp;gt;MARKET&amp;quot;). filter(header(QuickfixjEndpoint.MESSAGE_TYPE_KEY).isEqualTo(MsgType.EXECUTION_REPORT)). bean(new MyTradeExecutionProcessor()); </script> 
 </div>
</div><h2 id="BookInOnePage-QuickFIX/JComponentPriortoCamel2.5">QuickFIX/J Component Prior to Camel 2.5</h2><p>The <strong>quickfix</strong> component is an implementation of the <a shape="rect" class="external-link" href="http://www.quickfixj.org/" rel="nofollow">QuickFIX/J</a> engine for Java . This engine allows to connect to a FIX server which is used to exchange financial messages according to <a shape="rect" class="external-link" href="http://www.fixprotocol.org/" rel="nofollow">FIX protocol</a> standard.</p><p><strong>Note:</strong> The component can be used to send/receives messages to a FIX server.</p><h3 id="BookInOnePage-URIformat.50">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">quickfix-server:config file quickfix-client:config file </script> 
 </div>
</div><p>Where <strong>config file</strong> is the location (in your classpath) of the quickfix configuration file used to configure the engine at the startup.</p><p><strong>Note:</strong> Information about parameters available for quickfix can be found on <a shape="rect" class="external-link" href="http://www.quickfixj.org/quickfixj/usermanual/usage/configuration.html" rel="nofollow">QuickFIX/J</a> web site.</p><p>The quickfix-server endpoint must be used to receive from FIX server FIX messages and quickfix-client endpoint in the case that you want to send messages to a FIX gateway.</p><h3 id="BookInOnePage-Exchangedataformat.1">Exchange data format</h3><p>The QuickFIX/J engine is like CXF component a messaging bus using MINA as protocol layer to create the socket connection with the FIX engine gateway.</p><p>When QuickFIX/J engine receives a message, then it create a QuickFix.Message instance which is next received by the camel endpoint. This object is a 'mapping object' created from a FIX message formatted initially as a collection of key value pairs data. You can use this object or you can use the method 'toString' to retrieve the original FIX message.</p><p><strong>Note:</strong> Alternatively, you can use <a shape="rect" href="bindy.html">camel bindy dataformat</a> to transform the FIX message into your own java POJO</p><p>When a message must be send to QuickFix, then you must create a QuickFix.Message instance.</p><h3 id="BookInOnePage-Lazycreatingengines">Lazy creating engines</h3><p>From <strong>Camel 2.12.3</strong> onwards, you can configure the QuickFixComponent to lazy create and start the engines, which then only start these on-demand. For example you can use this when you have multiple Camel applications in a cluster with master/slaves. And want the slaves to be standby.</p><h3 id="BookInOnePage-Samples.15">Samples</h3><p>Direction : to FIX gateway</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:queue:fix&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;fixService&amp;quot; method=&amp;quot;createFixMessage&amp;quot;/&amp;gt; // bean method in charge to transform message into a QuickFix.Message &amp;lt;to uri=&amp;quot;quickfix-client:META-INF/quickfix/client.cfg&amp;quot;/&amp;gt; // Quickfix engine who will send the FIX messages to the gateway &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>Direction : from FIX gateway</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;quickfix-server:META-INF/quickfix/server.cfg&amp;quot;/&amp;gt; // QuickFix engine who will receive the message from FIX gateway &amp;lt;bean ref=&amp;quot;fixService&amp;quot; method=&amp;quot;parseFixMessage&amp;quot;/&amp;gt; // bean method parsing the QuickFix.Message &amp;lt;to uri=&amp;quot;uri=&amp;quot;activemq:queue:fix&amp;quot;/&amp;gt;&amp;quot; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.68">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-PrinterComponent">Printer Component</h2><p><strong>Available as of Camel 2.1</strong></p><p>The <strong>printer</strong> component provides a way to direct payloads on a route to a printer. Obviously the payload has to be a formatted piece of payload in order for the component to appropriately print it. The objective is to be able to direct specific payloads as jobs to a line printer in a camel flow.</p><p>This component only supports a camel producer endpoint.</p><p>The functionality allows for the payload to be printed on a default printer, named local, remote or wirelessly linked printer using the javax printing API under the covers.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-printer&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.51">URI format</h3><p>Since the URI scheme for a printer has not been standardized (the nearest thing to a standard being the IETF print standard) and therefore not uniformly applied by vendors, we have chosen <strong>"lpr"</strong> as the scheme.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">lpr://localhost/default[?options] lpr://remotehost:port/path/to/printer[?options] </script> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.60">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default Value </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>mediaSize</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>NA_LETTER</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Sets the stationary as defined by enumeration names in the <a shape="rect" class="external-link" href="http://download.oracle.com/javase/6/docs/api/javax/print/attribute/standard/MediaSizeName.html" rel="nofollow">javax.print.attribute.standard.MediaSizeName API</a>. The default setting is to use North American Letter sized stationary. The value's case is ignored, e.g. values of <code>iso_a4</code> and <code>ISO_A4</code> may be used. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>copies</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>1</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Sets number of copies based on the javax.print.attribute.standard.Copies API </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>sides</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>Sides.ONE_SIDED</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Sets one sided or two sided printing based on the javax.print.attribute.standard.Sides API </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>flavor</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>DocFlavor.BYTE_ARRAY</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Sets DocFlavor based on the javax.print.DocFlavor API </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>mimeType</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>AUTOSENSE</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Sets mimeTypes supported by the javax.print.DocFlavor API </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>mediaTray</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>AUTOSENSE</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Since <strong>Camel 2.11.x</strong> sets MediaTray supported by the javax.print.DocFlavor API </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>printerPrefix</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> null </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Since <strong>Camel 2.11.x</strong> sets the prefix name of the printer, it is useful when the printer name does not start with //hostname/printer</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>sendToPrinter</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> true </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Setting this option to <code>false</code> prevents sending of the <a shape="rect" class="external-link" href="http://docs.oracle.com/javase/6/docs/api/javax/print/Doc.html" rel="nofollow">print data</a> to the printer</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>orientation</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>portrait</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Since <strong>Camel 2.13.x</strong> Sets the page orientation. Possible values: <code>portrait</code>, <code>landscape</code>, <code>reverse-portrait</code> or <code>reverse-landscape</code>, based on <code>javax.print.attribute.standard.OrientationRequested</code> </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-SendingMessagestoaPrinter">Sending Messages to a Printer</h3><h4 id="BookInOnePage-PrinterProducer">Printer Producer</h4><p>Sending data to the printer is very straightforward and involves creating a producer endpoint that can be sent message exchanges on in route.</p><h3 id="BookInOnePage-UsageSamples.1">Usage Samples</h3><h4 id="BookInOnePage-Example1:PrintingtextbasedpayloadsonaDefaultprinterusingletterstationaryandone-sidedmode">Example 1: Printing text based payloads on a Default printer using letter stationary and one-sided mode</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">RouteBuilder builder = new RouteBuilder() { public void configure() { from(file://inputdir/?delete=true) .to(&amp;quot;lpr://localhost/default?copies=2&amp;quot; + &amp;quot;&amp;amp;flavor=DocFlavor.INPUT_STREAM&amp;amp;&amp;quot; + &amp;quot;&amp;amp;mimeType=AUTOSENSE&amp;quot; + &amp;quot;&amp;amp;mediaSize=NA_LETTER&amp;quot; + &amp;quot;&amp;amp;sides=one-sided&amp;quot;) }}; </script> 
 </div>
</div><h4 id="BookInOnePage-Example2:PrintingGIFbasedpayloadsonaRemoteprinterusingA4stationaryandone-sidedmode">Example 2: Printing GIF based payloads on a Remote printer using A4 stationary and one-sided mode</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">RouteBuilder builder = new RouteBuilder() { public void configure() { from(file://inputdir/?delete=true) .to(&amp;quot;lpr://remotehost/sales/salesprinter&amp;quot; + &amp;quot;?copies=2&amp;amp;sides=one-sided&amp;quot; + &amp;quot;&amp;amp;mimeType=GIF&amp;amp;mediaSize=ISO_A4&amp;quot; + &amp;quot;&amp;amp;flavor=DocFlavor.INPUT_STREAM&amp;quot;) }}; </script> 
 </div>
</div><h4 id="BookInOnePage-Example3:PrintingJPEGbasedpayloadsonaRemoteprinterusingJapanesePostcardstationaryandone-sidedmode">Example 3: Printing JPEG based payloads on a Remote printer using Japanese Postcard stationary and one-sided mode</h4><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">RouteBuilder builder = new RouteBuilder() { public void configure() { from(file://inputdir/?delete=true) .to(&amp;quot;lpr://remotehost/sales/salesprinter&amp;quot; + &amp;quot;?copies=2&amp;amp;sides=one-sided&amp;quot; + &amp;quot;&amp;amp;mimeType=JPEG&amp;quot; + &amp;quot;&amp;amp;mediaSize=JAPANESE_POSTCARD&amp;quot; + &amp;quot;&amp;amp;flavor=DocFlavor.INPUT_STREAM&amp;quot;) }}; </script> 
 </div>
</div><h2 id="BookInOnePage-PropertiesComponent">Properties Component</h2><p><strong>Available as of Camel 2.3</strong></p><h3 id="BookInOnePage-URIformat.52">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">properties:key[?options] </script> 
 </div>
</div><p>Where <strong><code>key</code></strong> is the key for the property to be looked up.</p><h3 id="BookInOnePage-Options.61">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cache</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether or not to cache loaded properties.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>encoding</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.14.3/2.15.1:</strong> To use a specific charset to load the properties, such as UTF-8. By default&#160;<code>ISO-8859-1</code> (<code>latin1</code>) is used.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>fallbackToUnaugmentedProperty</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9</strong> If <strong><code>true</code></strong>, first attempt resolution of property name augmented with <strong><code>propertyPrefix</code></strong> and <strong><code>propertySuffix</code></strong> before falling back the plain property name specified.</p><p>If <strong><code>false</code></strong>, only the augmented property name is searched.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">defaultFallbackEnabled</td><td colspan="1" rowspan="1" class="confluenceTd">boolean</td><td colspan="1" rowspan="1" class="confluenceTd">true</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.19</strong> If false the component does not attempt to find a default for the key by looking after the colon separator.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ignoreMissingLocation</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Whether to silently ignore if a location cannot be located, such as a properties file not found.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>locations</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A list of locations to load properties. You can use comma to separate multiple locations. This option will override any default locations and <strong>only</strong> use the locations from this option.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>prefixToken</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>{{</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9</strong> The token to indicate the beginning of a property token.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>propertyPrefix</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9</strong> Optional prefix prepended to property names before resolution.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>propertySuffix</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9</strong> Optional suffix appended to property names before resolution.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>suffixToken</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>}}<br clear="none"></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9</strong> The token to indicate the end of a property token.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>systemPropertiesMode</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>int</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>2</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16</strong> The mode to use for whether to resolve and use system properties:</p><p><strong><code>0</code></strong>&#160;= never - JVM system properties are never used.<br clear="none"><strong><code>1</code></strong>&#160;= fallback - JVM system properties are only used as fallback if no regular property with the key exists.<br clear="none"><strong><code>2</code></strong>&#160;= override - JVM system properties are used if exists, otherwise the regular property will be used.</p><p><strong>Note</strong>: when bridging to Spring's property placeholder using <strong><code>org.apache.camel.spring.spi.BridgePropertyPlaceholderConfigurer</code></strong> the configuration on <strong><code>BridgePropertyPlaceholderConfigurer</code></strong> will take precedence over the configuration on the <strong><code>PropertiesComponent</code></strong>.&#160;</p></td></tr></tbody></table> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Resolving property from Java code</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>You can use the method <strong><code>resolvePropertyPlaceholders</code></strong> on the <strong><code>CamelContext</code></strong> to resolve a property from any Java code.</p>
 </div>
</div><p></p><h2 id="BookInOnePage-UsingPropertyPlaceholder">Using&#160;<code>PropertyPlaceholder</code></h2><p><strong>Available as of Camel 2.3</strong></p><p>Camel now provides a new <strong><code>PropertiesComponent</code></strong> in <strong>camel-core</strong> which allows you to use property placeholders when defining Camel <a shape="rect" href="endpoint.html">Endpoint</a> URIs. This works much like you would do if using Spring's <strong><code>&lt;property-placeholder&gt;</code></strong> tag. However Spring has a limitation that prevents 3rd party frameworks from fully leveraging Spring property placeholders.</p><p>For more details see: <a shape="rect" href="how-do-i-use-spring-property-placeholder-with-camel-xml.html">How do I use Spring Property Placeholder with Camel XML</a>.</p>
 <div class="confluence-information-macro confluence-information-macro-tip">
  <p class="title">Bridging Spring and Camel property placeholders</p>
  <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
  <div class="confluence-information-macro-body">
   <p>From <strong>Camel 2.10</strong>: Spring's property placeholder can be bridged with Camel's. See below for more details.</p>
  </div>
 </div><p>The property placeholder is generally in use when doing any of the following:</p>
 <ul class="alternate"><li>lookup or creating endpoints.</li><li>lookup of beans in the <a shape="rect" href="registry.html">Registry.</a></li><li>additional supported in Spring XML (see below in examples).</li><li>using Blueprint&#160;<strong><code>PropertyPlaceholder</code></strong> with Camel <a shape="rect" href="properties.html">Properties</a> component.</li><li>using <strong><code>@PropertyInject</code></strong> to inject a property in a POJO.</li><li><strong>Camel 2.14.1</strong> Using default value if a property does not exists.</li><li><strong>Camel 2.14.1</strong> Include out of the box functions, to lookup property values from OS environment variables, JVM system properties, or the service idiom.</li><li><strong>Camel 2.14.1</strong> Using custom functions, which can be plugged into the property component.</li></ul><h3 id="BookInOnePage-Syntax.1">Syntax</h3><p>The syntax to use Camel's property placeholder is to use <strong>{{<code>key</code>}}</strong> for example <strong>{{<code>file.uri</code>}}</strong> where <strong><code>file.uri</code></strong> is the property key. You can use property placeholders in parts of the endpoint URI's which for example you can use placeholders for parameters in the URIs.</p><p>From&#160;<strong>Camel 2.14.1</strong>: you can specify a default value to use if a property with the key does not exists, e.g., <strong><code>file.url:/some/path</code></strong> where the default value is the text after the colon, e.g., <strong><code>/some/path</code></strong>.</p>
 <div class="confluence-information-macro confluence-information-macro-information">
  <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
  <div class="confluence-information-macro-body">
   <p>From <strong>Camel 2.14.1</strong>: do <em>not</em> use a colon in the property key. The colon character is used as a token separator when providing a default value.</p>
  </div>
 </div><h3 id="BookInOnePage-UsingPropertyResolver">Using&#160;<code>PropertyResolver</code></h3><p>Camel provides a pluggable mechanism which allows 3rd part to provide their own resolver to lookup properties. Camel provides a default implementation <strong><code>org.apache.camel.component.properties.DefaultPropertiesResolver</code></strong> which is capable of loading properties from the file system, classpath or <a shape="rect" href="registry.html">Registry</a>. You can prefix the locations with either:</p>
 <ul class="alternate"><li><strong><code>ref:</code> Camel 2.4:</strong> to lookup in the <a shape="rect" href="registry.html">Registry.</a></li><li><strong><code>file:</code></strong> to load the from file system.</li><li><strong><code>classpath:</code></strong> to load from classpath (this is also the default if no prefix is provided).</li><li><strong><code>blueprint:</code> Camel 2.7:</strong> to use a specific OSGi blueprint placeholder service.</li></ul><h3 id="BookInOnePage-DefiningLocation">Defining Location</h3><p>The <strong><code>PropertiesResolver</code></strong> need to know a location(s) where to resolve the properties. You can define 1 to many locations. If you define the location in a single String property you can separate multiple locations with comma such as:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">pc.setLocation(&amp;quot;com/mycompany/myprop.properties,com/mycompany/other.properties&amp;quot;); </script> 
  </div>
 </div>
 <div>
  <p><span><br clear="none"></span></p>
  <p><strong>Available as of Camel 2.19.0</strong></p>
  <p>You can set which location can be discarded if missing by by setting the&#160;<code>optional</code>&#160;attribute, which is false by default, i.e:</p>
 </div>
 <div>
  <h4 id="BookInOnePage-ConfiguringinSpringXML">Configuring in Spring XML</h4>
  <p>&#160;</p>
  <div class="code panel pdl" style="border-width: 1px;">
   <div class="codeContent panelContent pdl"> 
    <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">pc.setLocations( &amp;quot;com/mycompany/override.properties;optional=true&amp;quot; &amp;quot;com/mycompany/defaults.properties&amp;quot;);</script> 
   </div>
  </div>
  <p>&#160;</p>
 </div><h4 id="BookInOnePage-UsingSystemandEnvironmentVariablesinLocations">Using System and Environment Variables in Locations</h4><p><strong>Available as of Camel 2.7</strong></p><p>The location now supports using placeholders for JVM system properties and OS environments variables.</p><p>Example:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">location=file:${karaf.home}/etc/foo.properties </script> 
  </div>
 </div><p>In the location above we defined a location using the file scheme using the JVM system property with key <strong><code>karaf.home</code></strong>.</p><p>To use an OS environment variable instead you would have to prefix with <strong><code>env</code></strong>:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">location=file:${env:APP_HOME}/etc/foo.properties </script> 
  </div>
 </div><p>Where <strong><code>APP_HOME</code></strong> is an OS environment.</p><p>You can have multiple placeholders in the same location, such as:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">location=file:${env:APP_HOME}/etc/${prop.name}.properties </script> 
  </div>
 </div><h4 id="BookInOnePage-UsingSystemandEnvironmentVariablestoConfigurePropertyPrefixesandSuffixes">Using System and Environment Variables to Configure Property Prefixes and Suffixes</h4><p><strong>Available as of Camel 2.12.5, 2.13.3, 2.14.0</strong></p><p><strong><code>propertyPrefix</code></strong>, <strong><code>propertySuffix</code></strong> configuration properties support using placeholders for JVM system properties and OS environments variables.</p><p>For example, if&#160;<strong><code>PropertiesComponent</code></strong> is configured with the following properties file:</p>
 <div class="preformatted panel" style="border-width: 1px;">
  <div class="preformattedContent panelContent"> 
   <pre>dev.endpoint = result1
test.endpoint = result2</pre> 
  </div>
 </div><p>Then with the following route definition:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">PropertiesComponent pc = context.getComponent(&amp;quot;properties&amp;quot;, PropertiesComponent.class); pc.setPropertyPrefix(&amp;quot;${stage}.&amp;quot;); // ... context.addRoutes(new RouteBuilder() { @Override public void configure() throws Exception { from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;properties:mock:{{endpoint}}&amp;quot;); } });</script> 
  </div>
 </div><p>it is possible to change the target endpoint by changing system property&#160;<strong><code>stage</code></strong> either to&#160;<strong><code>dev</code></strong> (the message will be routed to&#160;<strong><code>mock:result1</code></strong>) or&#160;<strong><code>test</code></strong> (the message will be routed to&#160;<strong><code>mock:result2</code></strong>).</p><h3 id="BookInOnePage-ConfiguringinJavaDSL">Configuring in Java DSL</h3><p>You have to create and register the <strong><code>PropertiesComponent</code></strong> under the name <strong><code>properties</code></strong> such as:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">PropertiesComponent pc = new PropertiesComponent(); pc.setLocation(&amp;quot;classpath:com/mycompany/myprop.properties&amp;quot;); context.addComponent(&amp;quot;properties&amp;quot;, pc); </script> 
  </div>
 </div><h3 id="BookInOnePage-ConfiguringinSpringXML.1">Configuring in Spring XML</h3><p>Spring XML offers two variations to configure. You can define a spring bean as a <strong><code>PropertiesComponent</code></strong> which resembles the way done in Java DSL. Or you can use the <strong><code>&lt;propertyPlaceholder&gt;</code></strong> tag.</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;properties&amp;quot; class=&amp;quot;org.apache.camel.component.properties.PropertiesComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;location&amp;quot; value=&amp;quot;classpath:com/mycompany/myprop.properties&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
  </div>
 </div><p>Using the <strong><code>&lt;propertyPlaceholder&gt;</code></strong> tag makes the configuration a bit more fresh such as:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext ...&amp;gt; &amp;lt;propertyPlaceholder id=&amp;quot;properties&amp;quot; location=&amp;quot;com/mycompany/myprop.properties&amp;quot;/&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
  </div>
 </div><p><span>Setting the properties location through the location tag works just fine but sometime you have a number of resources to take into account and starting from&#160;</span><strong>Camel 2.19.0</strong><span>&#160;you can set the properties location with a dedicated propertiesLocation:</span></p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext ...&amp;gt; &amp;lt;propertyPlaceholder id=&amp;quot;myPropertyPlaceholder&amp;quot;&amp;gt; &amp;lt;propertiesLocation resolver = &amp;quot;classpath&amp;quot; path = &amp;quot;com/my/company/something/my-properties-1.properties&amp;quot; optional = &amp;quot;false&amp;quot;/&amp;gt; &amp;lt;propertiesLocation resolver = &amp;quot;classpath&amp;quot; path = &amp;quot;com/my/company/something/my-properties-2.properties&amp;quot; optional = &amp;quot;false&amp;quot;/&amp;gt; &amp;lt;propertiesLocation resolver = &amp;quot;file&amp;quot; path = &amp;quot;${karaf.home}/etc/my-override.properties&amp;quot; optional = &amp;quot;true&amp;quot;/&amp;gt; &amp;lt;/propertyPlaceholder&amp;gt; &amp;lt;/camelContext&amp;gt;</script> 
  </div>
 </div>
 <div class="confluence-information-macro confluence-information-macro-tip">
  <p class="title">Specifying the cache option in XML</p>
  <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
  <div class="confluence-information-macro-body">
   <p>From <strong>Camel 2.10</strong>: Camel supports specifying a value for the&#160;<strong><code>cache</code></strong> option both inside the Spring as well as the Blueprint XML.</p>
  </div>
 </div><h3 id="BookInOnePage-UsingaPropertiesfromthe">Using a Properties from the <a shape="rect" href="registry.html">Registry</a></h3><p><strong>Available as of Camel 2.4</strong><br clear="none"> For example in OSGi you may want to expose a service which returns the properties as a <strong><code>java.util.Properties</code></strong> object.</p><p>Then you could setup the <a shape="rect" href="properties.html">Properties</a> component as follows:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;propertyPlaceholder id=&amp;quot;properties&amp;quot; location=&amp;quot;ref:myProperties&amp;quot;/&amp;gt; </script> 
  </div>
 </div><p>Where <strong><code>myProperties</code></strong> is the id to use for lookup in the OSGi registry. Notice we use the <strong><code>ref:</code></strong> prefix to tell Camel that it should lookup the properties for the <a shape="rect" href="registry.html">Registry</a>.</p><h3 id="BookInOnePage-ExamplesUsingPropertiesComponent">Examples Using Properties Component</h3><p>When using property placeholders in the endpoint URIs you can either use the <strong><code>properties:</code></strong> component or define the placeholders directly in the URI. We will show example of both cases, starting with the former.</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// properties cool.end=mock:result // route from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;properties:{{cool.end}}&amp;quot;); </script> 
  </div>
 </div><p>You can also use placeholders as a part of the endpoint URI:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// properties cool.foo=result // route from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;properties:mock:{{cool.foo}}&amp;quot;); </script> 
  </div>
 </div><p>In the example above the to endpoint will be resolved to <code>mock:result</code>.</p><p>You can also have properties with refer to each other such as:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// properties cool.foo=result cool.concat=mock:{{cool.foo}} // route from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;properties:mock:{{cool.concat}}&amp;quot;); </script> 
  </div>
 </div><p>Notice how <strong><code>cool.concat</code></strong> refer to another property.</p><p>The <strong><code>properties:</code></strong> component also offers you to override and provide a location in the given URI using the <strong><code>locations</code></strong> option:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;properties:bar.end?locations=com/mycompany/bar.properties&amp;quot;); </script> 
  </div>
 </div><h3 id="BookInOnePage-Examples.25">Examples</h3><p>You can also use property placeholders directly in the endpoint URIs without having to use <strong><code>properties:</code></strong>.</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// properties cool.foo=result // route from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;mock:{{cool.foo}}&amp;quot;); </script> 
  </div>
 </div><p>And you can use them in multiple wherever you want them:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// properties cool.start=direct:start cool.showid=true cool.result=result // route from(&amp;quot;{{cool.start}}&amp;quot;) .to(&amp;quot;log:{{cool.start}}?showBodyType=false&amp;amp;showExchangeId={{cool.showid}}&amp;quot;) .to(&amp;quot;mock:{{cool.result}}&amp;quot;); </script> 
  </div>
 </div><p>You can also your property placeholders when using <a shape="rect" href="producertemplate.html">ProducerTemplate</a> for example:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">template.sendBody(&amp;quot;{{cool.start}}&amp;quot;, &amp;quot;Hello World&amp;quot;); </script> 
  </div>
 </div><h3 id="BookInOnePage-Examplewithlanguage">Example with <a shape="rect" href="simple.html">Simple</a> language</h3><p>The <a shape="rect" href="simple.html">Simple</a> language now also support using property placeholders, for example in the route below:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// properties cheese.quote=Camel rocks // route from(&amp;quot;direct:start&amp;quot;) .transform().simple(&amp;quot;Hi ${body} do you think ${properties:cheese.quote}?&amp;quot;); </script> 
  </div>
 </div><p>You can also specify the location in the <a shape="rect" href="simple.html">Simple</a> language for example:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// bar.properties bar.quote=Beer tastes good // route from(&amp;quot;direct:start&amp;quot;) .transform().simple(&amp;quot;Hi ${body}. ${properties:com/mycompany/bar.properties:bar.quote}.&amp;quot;); </script> 
  </div>
 </div><h3 id="BookInOnePage-AdditionalPropertyPlaceholderSupportinSpringXML">Additional Property Placeholder Support in Spring XML</h3><p>The property placeholders is also supported in many of the Camel Spring XML tags such as <code><strong>&lt;package&gt;</strong>, <strong>&lt;packageScan&gt;</strong>, <strong>&lt;contextScan&gt;</strong>, <strong>&lt;jmxAgent&gt;</strong>, <strong>&lt;endpoint&gt;</strong>, <strong>&lt;routeBuilder&gt;</strong>, <strong>&lt;proxy&gt;</strong></code> and the others.</p><p>Example:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
   <b>Using property placeholders in the &lt;jmxAgent&gt; tag</b>
  </div>
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;propertyPlaceholder id=&amp;quot;properties&amp;quot; location=&amp;quot;org/apache/camel/spring/jmx.properties&amp;quot;/&amp;gt; &amp;lt;!-- we can use propery placeholders when we define the JMX agent --&amp;gt; &amp;lt;jmxAgent id=&amp;quot;agent&amp;quot; registryPort=&amp;quot;{{myjmx.port}}&amp;quot; disabled=&amp;quot;{{myjmx.disabled}}&amp;quot; usePlatformMBeanServer=&amp;quot;{{myjmx.usePlatform}}&amp;quot; createConnector=&amp;quot;true&amp;quot; statisticsLevel=&amp;quot;RoutesOnly&amp;quot; useHostIPAddress=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;route id=&amp;quot;foo&amp;quot; autoStartup=&amp;quot;false&amp;quot;&amp;gt; &amp;lt;from uri=&amp;quot;seda:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt;</script> 
  </div>
 </div><p>Example:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
   <b>Using property placeholders in the attributes of &lt;camelContext&gt;</b>
  </div>
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext trace=&amp;quot;{{foo.trace}}&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;propertyPlaceholder id=&amp;quot;properties&amp;quot; location=&amp;quot;org/apache/camel/spring/processor/myprop.properties&amp;quot;/&amp;gt; &amp;lt;template id=&amp;quot;camelTemplate&amp;quot; defaultEndpoint=&amp;quot;{{foo.cool}}&amp;quot;/&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;setHeader headerName=&amp;quot;{{foo.header}}&amp;quot;&amp;gt; &amp;lt;simple&amp;gt;${in.body} World!&amp;lt;/simple&amp;gt; &amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt;</script> 
  </div>
 </div><h3 id="BookInOnePage-OverridingaPropertySettingUsingaJVMSystemProperty">Overriding a Property Setting Using a JVM System Property</h3><p><strong>Available as of Camel 2.5</strong><br clear="none"> It is possible to override a property value at runtime using a JVM System property without the need to restart the application to pick up the change. This may also be accomplished from the command line by creating a JVM System property of the same name as the property it replaces with a new value.</p><p>Example:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">PropertiesComponent pc = context.getComponent(&amp;quot;properties&amp;quot;, PropertiesComponent.class); pc.setCache(false); System.setProperty(&amp;quot;cool.end&amp;quot;, &amp;quot;mock:override&amp;quot;); System.setProperty(&amp;quot;cool.result&amp;quot;, &amp;quot;override&amp;quot;); context.addRoutes(new RouteBuilder() { @Override public void configure() throws Exception { from(&amp;quot;direct:start&amp;quot;).to(&amp;quot;properties:cool.end&amp;quot;); from(&amp;quot;direct:foo&amp;quot;).to(&amp;quot;properties:mock:{{cool.result}}&amp;quot;); } }); context.start(); getMockEndpoint(&amp;quot;mock:override&amp;quot;).expectedMessageCount(2); template.sendBody(&amp;quot;direct:start&amp;quot;, &amp;quot;Hello World&amp;quot;); template.sendBody(&amp;quot;direct:foo&amp;quot;, &amp;quot;Hello Foo&amp;quot;); System.clearProperty(&amp;quot;cool.end&amp;quot;); System.clearProperty(&amp;quot;cool.result&amp;quot;); assertMockEndpointsSatisfied(); </script> 
  </div>
 </div><h3 id="BookInOnePage-UsingPropertyPlaceholdersforAnyKindofAttributeintheXMLDSL">Using Property Placeholders for Any Kind of Attribute in the XML DSL</h3><p><strong>Available as of Camel 2.7</strong></p>
 <div class="confluence-information-macro confluence-information-macro-information">
  <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
  <div class="confluence-information-macro-body">
   <p>If you use OSGi Blueprint then this only works from <strong>2.11.1</strong> or <strong>2.10.5</strong> on.</p>
  </div>
 </div><p>Previously it was only the <strong><code>xs:string</code></strong> type attributes in the XML DSL that support placeholders. For example often a timeout attribute would be a <strong><code>xs:int</code></strong> type and thus you cannot set a string value as the placeholder key. This is now possible from Camel 2.7 on using a special placeholder namespace.</p><p>In the example below we use the <strong><code>prop</code></strong> prefix for the namespace <code><a shape="rect" class="external-link" href="http://camel.apache.org/schema/placeholder">http://camel.apache.org/schema/placeholder</a></code> by which we can use the <strong><code>prop</code></strong> prefix in the attributes in the XML DSLs. Notice how we use that in the <a shape="rect" href="multicast.html">Multicast</a> to indicate that the option <strong><code>stopOnException</code></strong> should be the value of the placeholder with the key <strong><code>stop</code></strong>.</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;beans xmlns=&amp;quot;http://www.springframework.org/schema/beans&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:prop=&amp;quot;http://camel.apache.org/schema/placeholder&amp;quot; xsi:schemaLocation=&amp;quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd&amp;quot;&amp;gt; &amp;lt;!-- Notice in the declaration above, we have defined the prop prefix as the Camel placeholder namespace --&amp;gt; &amp;lt;bean id=&amp;quot;damn&amp;quot; class=&amp;quot;java.lang.IllegalArgumentException&amp;quot;&amp;gt; &amp;lt;constructor-arg index=&amp;quot;0&amp;quot; value=&amp;quot;Damn&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;propertyPlaceholder id=&amp;quot;properties&amp;quot; location=&amp;quot;classpath:org/apache/camel/component/properties/myprop.properties&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;/&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;!-- use prop namespace, to define a property placeholder, which maps to option stopOnException={{stop}} --&amp;gt; &amp;lt;multicast prop:stopOnException=&amp;quot;stop&amp;quot;&amp;gt; &amp;lt;to uri=&amp;quot;mock:a&amp;quot;/&amp;gt; &amp;lt;throwException ref=&amp;quot;damn&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:b&amp;quot;/&amp;gt; &amp;lt;/multicast&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;/beans&amp;gt;</script> 
  </div>
 </div><p>In our properties file we have the value defined as</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">stop=true </script> 
  </div>
 </div><h3 id="BookInOnePage-UsingPropertyPlaceholderintheJavaDSL">Using Property Placeholder in the Java DSL</h3><p><strong>Available as of Camel 2.7</strong></p><p>Likewise we have added support for defining placeholders in the Java DSL using the new <strong><code>placeholder</code></strong> DSL as shown in the following equivalent example:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) // use a property placeholder for the option stopOnException on the Multicast EIP // which should have the value of {{stop}} key being looked up in the properties file .multicast() .placeholder(&amp;quot;stopOnException&amp;quot;, &amp;quot;stop&amp;quot;) .to(&amp;quot;mock:a&amp;quot;) .throwException(new IllegalAccessException(&amp;quot;Damn&amp;quot;)) .to(&amp;quot;mock:b&amp;quot;);</script> 
  </div>
 </div><h3 id="BookInOnePage-UsingBlueprintPropertyPlaceholderwithCamelRoutes">Using Blueprint Property Placeholder with Camel Routes</h3><p><strong>Available as of Camel 2.7</strong></p><p>Camel supports <a shape="rect" href="using-osgi-blueprint-with-camel.html">Blueprint</a> which also offers a property placeholder service. Camel supports convention over configuration, so all you have to do is to define the OSGi Blueprint property placeholder in the XML file as shown below:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;blueprint xmlns=&amp;quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:cm=&amp;quot;http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.0.0&amp;quot; xsi:schemaLocation=&amp;quot;http://www.osgi.org/xmlns/blueprint/v1.0.0 https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd&amp;quot;&amp;gt; &amp;lt;!-- OSGI blueprint property placeholder --&amp;gt; &amp;lt;cm:property-placeholder id=&amp;quot;myblueprint.placeholder&amp;quot; persistent-id=&amp;quot;camel.blueprint&amp;quot;&amp;gt; &amp;lt;!-- list some properties as needed --&amp;gt; &amp;lt;cm:default-properties&amp;gt; &amp;lt;cm:property name=&amp;quot;result&amp;quot; value=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/cm:default-properties&amp;gt; &amp;lt;/cm:property-placeholder&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/blueprint&amp;quot;&amp;gt; &amp;lt;!-- in the route we can use {{ }} placeholders which will lookup in blueprint as Camel will auto detect the OSGi blueprint property placeholder and use it --&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:foo&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;{{result}}&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;/blueprint&amp;gt;</script> 
  </div>
 </div><p><span style="line-height: 1.42857;"><br clear="none"></span></p><p><span style="line-height: 1.42857;">By default Camel detects and uses OSGi blueprint property placeholder service. You can disable this by setting the attribute </span><strong><code style="line-height: 1.42857;">useBlueprintPropertyResolver</code></strong><span style="line-height: 1.42857;"> to false on the </span><strong><code style="line-height: 1.42857;">&lt;camelContext&gt;</code></strong><span style="line-height: 1.42857;"> definition.</span></p>
 <div class="confluence-information-macro confluence-information-macro-information">
  <p class="title">About placeholder syntaxes</p>
  <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
  <div class="confluence-information-macro-body">
   <p>Notice how we can use the Camel syntax for placeholders&#160;<code><strong>{{</strong> <strong>}}</strong></code> in the Camel route, which will lookup the value from OSGi blueprint.<br clear="none"> The blueprint syntax for placeholders is <strong><code>${}</code></strong>. So outside the&#160;<strong><code>&lt;camelContext&gt;</code></strong> you must use the&#160;<strong><code>${}</code></strong> syntax. Where as inside&#160;<strong><code>&lt;camelContext&gt;</code></strong> you must use&#160;<code><strong>{{</strong> <strong>}}</strong></code> syntax. OSGi blueprint allows you to configure the syntax, so you can actually align those if you want.</p>
  </div>
 </div><p>You can also explicit refer to a specific OSGi blueprint property placeholder by its id. For that you need to use the Camel's&#160;<strong><code>&lt;propertyPlaceholder&gt;</code></strong> as shown in the example below:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;blueprint xmlns=&amp;quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:cm=&amp;quot;http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.0.0&amp;quot; xsi:schemaLocation=&amp;quot;http://www.osgi.org/xmlns/blueprint/v1.0.0 https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd&amp;quot;&amp;gt; &amp;lt;!-- OSGI blueprint property placeholder --&amp;gt; &amp;lt;cm:property-placeholder id=&amp;quot;myblueprint.placeholder&amp;quot; persistent-id=&amp;quot;camel.blueprint&amp;quot;&amp;gt; &amp;lt;!-- list some properties as needed --&amp;gt; &amp;lt;cm:default-properties&amp;gt; &amp;lt;cm:property name=&amp;quot;prefix.result&amp;quot; value=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/cm:default-properties&amp;gt; &amp;lt;/cm:property-placeholder&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/blueprint&amp;quot;&amp;gt; &amp;lt;!-- using Camel properties component and refer to the blueprint property placeholder by its id --&amp;gt; &amp;lt;propertyPlaceholder id=&amp;quot;properties&amp;quot; location=&amp;quot;blueprint:myblueprint.placeholder&amp;quot; prefixToken=&amp;quot;[[&amp;quot; suffixToken=&amp;quot;]]&amp;quot; propertyPrefix=&amp;quot;prefix.&amp;quot;/&amp;gt; &amp;lt;!-- in the route we can use {{ }} placeholders which will lookup in blueprint --&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:foo&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;[[result]]&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;/blueprint&amp;gt;</script> 
  </div>
 </div><p>&#160;</p><p>Notice how we use the <strong><code>blueprint</code></strong> scheme to refer to the OSGi blueprint placeholder by its id. This allows you to mix and match, for example you can also have additional schemes in the location. For example to load a file from the classpath you can do:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">location=&amp;quot;blueprint:myblueprint.placeholder,classpath:myproperties.properties&amp;quot; </script> 
  </div>
 </div><p>Each location is separated by comma.</p><h4 id="BookInOnePage-OverridingBlueprintPropertyPlaceholdersOutsideCamelContext">Overriding Blueprint Property Placeholders Outside CamelContext</h4><p><strong>Available as of Camel 2.10.4</strong></p><p>When using Blueprint property placeholder in the Blueprint XML file, you can declare the properties directly in the XML file as shown below:
  </p><div class="code panel pdl" style="border-width: 1px;">
   <div class="codeContent panelContent pdl"> 
    <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- blueprint property placeholders --&amp;gt; &amp;lt;cm:property-placeholder persistent-id=&amp;quot;my-placeholders&amp;quot; update-strategy=&amp;quot;reload&amp;quot;&amp;gt; &amp;lt;cm:default-properties&amp;gt; &amp;lt;cm:property name=&amp;quot;greeting&amp;quot; value=&amp;quot;Hello&amp;quot;/&amp;gt; &amp;lt;cm:property name=&amp;quot;destination&amp;quot; value=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/cm:default-properties&amp;gt; &amp;lt;/cm:property-placeholder&amp;gt; &amp;lt;!-- a bean that uses a blueprint property placeholder --&amp;gt; &amp;lt;bean id=&amp;quot;myCoolBean&amp;quot; class=&amp;quot;org.apache.camel.test.blueprint.MyCoolBean&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;say&amp;quot; value=&amp;quot;${greeting}&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/blueprint&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;myCoolBean&amp;quot; method=&amp;quot;saySomething&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;{{destination}}&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
   </div>
  </div>&#160;<p>Notice that we have a&#160;<strong><code>&lt;bean&gt;</code></strong> which refers to one of the properties. And in the Camel route we refer to the other using the&#160;<strong><code>{{ }}</code></strong> notation.</p><p>Now if you want to override these Blueprint properties from an unit test, you can do this as shown below:
  </p><div class="code panel pdl" style="border-width: 1px;">
   <div class="codeContent panelContent pdl"> 
    <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> @Override protected String useOverridePropertiesWithConfigAdmin(Dictionary props) { // add the properties we want to override props.put(&amp;quot;greeting&amp;quot;, &amp;quot;Bye&amp;quot;); // return the PID of the config-admin we are using in the blueprint xml file return &amp;quot;my-placeholders&amp;quot;; } </script> 
   </div>
  </div>&#160;<p>To do this we override and implement the <strong><code>useOverridePropertiesWithConfigAdmin</code></strong> method. We can then put the properties we want to override on the given props parameter. And the return value <em>must</em> be the persistence-id of the&#160;<strong><code>&lt;cm:property-placeholder&gt;</code></strong> tag, which you define in the blueprint XML file.</p><h4 id="BookInOnePage-Usinga.cfgor.propertiesFileforBlueprintPropertyPlaceholders">Using a <code>.cfg</code> or&#160;<code>.properties</code> File for Blueprint Property Placeholders</h4><p><strong>Available as of Camel 2.10.4</strong></p><p>When using Blueprint property placeholder in the Blueprint XML file, you can declare the properties in a .properties or&#160;<strong><code>.cfg</code></strong> file. If you use Apache ServieMix/Karaf then this container has a convention that it loads the properties from a file in the etc directory with the naming <strong><code>etc/pid.cfg</code></strong>, where&#160;<strong><code>pid</code></strong> is the persistence-id.</p><p>For example in the blueprint XML file we have the <strong><code>persistence-id="stuff"</code></strong>, which mean it will load the configuration file as <strong><code>etc/stuff.cfg</code></strong>.
  </p><div class="code panel pdl" style="border-width: 1px;">
   <div class="codeContent panelContent pdl"> 
    <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- blueprint property placeholders, that will use etc/stuff.cfg as the properties file --&amp;gt; &amp;lt;cm:property-placeholder persistent-id=&amp;quot;stuff&amp;quot; update-strategy=&amp;quot;reload&amp;quot;/&amp;gt; &amp;lt;!-- a bean that uses a blueprint property placeholder --&amp;gt; &amp;lt;bean id=&amp;quot;myCoolBean&amp;quot; class=&amp;quot;org.apache.camel.test.blueprint.MyCoolBean&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;say&amp;quot; value=&amp;quot;${greeting}&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/blueprint&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;myCoolBean&amp;quot; method=&amp;quot;saySomething&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
   </div>
  </div>&#160;<p>Now if you want to unit test this blueprint XML file, then you can override the <strong><code>loadConfigAdminConfigurationFile</code></strong> and tell Camel which file to load as shown below:
  </p><div class="code panel pdl" style="border-width: 1px;">
   <div class="codeContent panelContent pdl"> 
    <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> @Override protected String[] loadConfigAdminConfigurationFile() { // String[0] = tell Camel the path of the .cfg file to use for OSGi ConfigAdmin in the blueprint XML file // String[1] = tell Camel the persistence-id of the cm:property-placeholder in the blueprint XML file return new String[]{&amp;quot;src/test/resources/etc/stuff.cfg&amp;quot;, &amp;quot;stuff&amp;quot;}; } </script> 
   </div>
  </div>&#160;<p>Notice that this method requires to return a&#160;<strong><code>String[]</code></strong> with 2 values. The 1st value is the path for the configuration file to load. The 2nd value is the persistence-id of the&#160;<strong><code>&lt;cm:property-placeholder&gt;</code></strong> tag.</p><p>The&#160;<strong><code>stuff.cfg</code></strong> file is just a plain properties file with the property placeholders such as:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">## this is a comment greeting=Bye </script> 
  </div>
 </div><h4 id="BookInOnePage-Usinga.cfgfileandOverridingPropertiesforBlueprintPropertyPlaceholders">Using a <code>.cfg</code> file and Overriding Properties for Blueprint Property Placeholders</h4><p>You can do both as well. Here is a complete example. First we have the Blueprint XML file:
  </p><div class="code panel pdl" style="border-width: 1px;">
   <div class="codeContent panelContent pdl"> 
    <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;blueprint xmlns=&amp;quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:cm=&amp;quot;http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0&amp;quot; xsi:schemaLocation=&amp;quot; http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0 http://aries.apache.org/schemas/blueprint-cm/blueprint-cm-1.1.0.xsd http://www.osgi.org/xmlns/blueprint/v1.0.0 https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd&amp;quot;&amp;gt; &amp;lt;!-- blueprint property placeholders, that will use etc/stuff.cfg as the properties file --&amp;gt; &amp;lt;cm:property-placeholder persistent-id=&amp;quot;stuff&amp;quot; update-strategy=&amp;quot;reload&amp;quot;&amp;gt; &amp;lt;cm:default-properties&amp;gt; &amp;lt;cm:property name=&amp;quot;greeting&amp;quot; value=&amp;quot;Hello&amp;quot; /&amp;gt; &amp;lt;cm:property name=&amp;quot;echo&amp;quot; value=&amp;quot;Hey&amp;quot; /&amp;gt; &amp;lt;cm:property name=&amp;quot;destination&amp;quot; value=&amp;quot;mock:original&amp;quot; /&amp;gt; &amp;lt;/cm:default-properties&amp;gt; &amp;lt;/cm:property-placeholder&amp;gt; &amp;lt;!-- a bean that uses a blueprint property placeholder --&amp;gt; &amp;lt;bean id=&amp;quot;myCoolBean&amp;quot; class=&amp;quot;org.apache.camel.test.blueprint.MyCoolBean&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;say&amp;quot; value=&amp;quot;${greeting}&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;echo&amp;quot; value=&amp;quot;${echo}&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/blueprint&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;myCoolBean&amp;quot; method=&amp;quot;saySomething&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;{{destination}}&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;myCoolBean&amp;quot; method=&amp;quot;echoSomething&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;{{destination}}&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;/blueprint&amp;gt; </script> 
   </div>
  </div>&#160;<p>And in the unit test class we do as follows:
  </p><div class="code panel pdl" style="border-width: 1px;">
   <div class="codeContent panelContent pdl"> 
    <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> /** * This example will load a Blueprint .cfg file (which will initialize configadmin), and also override its property * placeholders from this unit test source code directly (the change will reload blueprint container). */ public class ConfigAdminLoadConfigurationFileAndOverrideTest extends CamelBlueprintTestSupport { @Override protected String getBlueprintDescriptor() { // which blueprint XML file to use for this test return &amp;quot;org/apache/camel/test/blueprint/configadmin-loadfileoverride.xml&amp;quot;; } @Override protected String[] loadConfigAdminConfigurationFile() { // which .cfg file to use, and the name of the persistence-id return new String[]{&amp;quot;src/test/resources/etc/stuff.cfg&amp;quot;, &amp;quot;stuff&amp;quot;}; } @Override protected String useOverridePropertiesWithConfigAdmin(Dictionary props) throws Exception { // override / add extra properties props.put(&amp;quot;destination&amp;quot;, &amp;quot;mock:extra&amp;quot;); // return the persistence-id to use return &amp;quot;stuff&amp;quot;; } @Test public void testConfigAdmin() throws Exception { // mock:original comes from &amp;lt;cm:default-properties&amp;gt;/&amp;lt;cm:property name=&amp;quot;destination&amp;quot; value=&amp;quot;mock:original&amp;quot; /&amp;gt; getMockEndpoint(&amp;quot;mock:original&amp;quot;).setExpectedMessageCount(0); // mock:result comes from loadConfigAdminConfigurationFile() getMockEndpoint(&amp;quot;mock:result&amp;quot;).setExpectedMessageCount(0); // mock:extra comes from useOverridePropertiesWithConfigAdmin() getMockEndpoint(&amp;quot;mock:extra&amp;quot;).expectedBodiesReceived(&amp;quot;Bye World&amp;quot;, &amp;quot;Yay Bye WorldYay Bye World&amp;quot;); template.sendBody(&amp;quot;direct:start&amp;quot;, &amp;quot;World&amp;quot;); assertMockEndpointsSatisfied(); } } </script> 
   </div>
  </div>&#160;<p>And the <strong><code>etc/stuff.cfg</code></strong> configuration file contains:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">greeting=Bye echo=Yay destination=mock:result </script> 
  </div>
 </div><h3 id="BookInOnePage-BridgingSpringandCamelPropertyPlaceholders">Bridging Spring and Camel Property Placeholders</h3><p><strong>Available as of Camel 2.10</strong></p><p>The Spring Framework does not allow 3rd party frameworks such as Apache Camel to seamless hook into the Spring property placeholder mechanism. However you can easily bridge Spring and Camel by declaring a Spring bean with the type <strong><code>org.apache.camel.spring.spi.BridgePropertyPlaceholderConfigurer</code></strong>, which is a Spring <strong><code>org.springframework.beans.factory.config.PropertyPlaceholderConfigurer</code></strong> type.</p><p>To bridge Spring and Camel you must define a single bean as shown below:
  </p><div class="code panel pdl" style="border-width: 1px;">
   <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
    <b>Bridging Spring and Camel property placeholders</b>
   </div>
   <div class="codeContent panelContent pdl"> 
    <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- bridge spring property placeholder with Camel --&amp;gt; &amp;lt;!-- you must NOT use the &amp;lt;context:property-placeholder at the same time, only this bridge bean --&amp;gt; &amp;lt;bean id=&amp;quot;bridgePropertyPlaceholder&amp;quot; class=&amp;quot;org.apache.camel.spring.spi.BridgePropertyPlaceholderConfigurer&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;location&amp;quot; value=&amp;quot;classpath:org/apache/camel/component/properties/cheese.properties&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
   </div>
  </div>&#160;<p>You <strong>must not</strong> use the spring&#160;<strong><code>&lt;context:property-placeholder&gt;</code></strong> namespace at the same time; this is not possible.</p><p>After declaring this bean, you can define property placeholders using both the Spring style, and the Camel style within the&#160;<strong><code>&lt;camelContext&gt;</code></strong> tag as shown below:
  </p><div class="code panel pdl" style="border-width: 1px;">
   <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
    <b>Using bridge property placeholders</b>
   </div>
   <div class="codeContent panelContent pdl"> 
    <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- a bean that uses Spring property placeholder --&amp;gt; &amp;lt;!-- the ${hi} is a spring property placeholder --&amp;gt; &amp;lt;bean id=&amp;quot;hello&amp;quot; class=&amp;quot;org.apache.camel.component.properties.HelloBean&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;greeting&amp;quot; value=&amp;quot;${hi}&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;!-- in this route we use Camels property placeholder {{ }} style --&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:{{cool.bar}}&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;hello&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;{{cool.end}}&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
   </div>
  </div>&#160;<p>Notice how the hello bean is using pure Spring property placeholders using the&#160;<strong><code>${}</code></strong> notation. And in the Camel routes we use the Camel placeholder notation with <strong><code>{{ }}</code></strong>.</p><h4 id="BookInOnePage-ClashingSpringPropertyPlaceholderswithCamelsLanguage">Clashing Spring Property Placeholders with Camels <a shape="rect" href="simple.html">Simple</a> Language</h4><p>Take notice when using Spring bridging placeholder then the spring&#160;<strong><code>${}</code></strong> syntax clashes with the <a shape="rect" href="simple.html">Simple</a> in Camel, and therefore take care.</p><p>Example:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;setHeader headerName=&amp;quot;Exchange.FILE_NAME&amp;quot;&amp;gt; &amp;lt;simple&amp;gt;{{file.rootdir}}/${in.header.CamelFileName}&amp;lt;/simple&amp;gt; &amp;lt;/setHeader&amp;gt; </script> 
  </div>
 </div><p>clashes with Spring property placeholders, and you should use&#160;<strong><code>$simple{}</code></strong> to indicate using the <a shape="rect" href="simple.html">Simple</a> language in Camel.</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;setHeader headerName=&amp;quot;Exchange.FILE_NAME&amp;quot;&amp;gt; &amp;lt;simple&amp;gt;{{file.rootdir}}/$simple{in.header.CamelFileName}&amp;lt;/simple&amp;gt; &amp;lt;/setHeader&amp;gt; </script> 
  </div>
 </div><p>An alternative is to configure the <strong><code>PropertyPlaceholderConfigurer</code></strong> with <strong><code>ignoreUnresolvablePlaceholders</code></strong> option to <strong><code>true</code></strong>.</p><h3 id="BookInOnePage-OverridingPropertiesfromCamelTestKit">Overriding Properties from Camel Test Kit</h3><p><strong>Available as of Camel 2.10</strong></p><p>When <a shape="rect" href="testing.html">Testing</a> with Camel and using the <a shape="rect" href="properties.html">Properties</a> component, you may want to be able to provide the properties to be used from directly within the unit test source code. This is now possible from Camel 2.10, as the Camel test kits, e.g., <strong><code>CamelTestSupport</code></strong> class offers the following methods</p>
 <ul class="alternate"><li><strong><code>useOverridePropertiesWithPropertiesComponent</code></strong></li><li><strong><code>ignoreMissingLocationWithPropertiesComponent</code></strong></li></ul><p>So for example in your unit test classes, you can override the <strong><code>useOverridePropertiesWithPropertiesComponent</code></strong> method and return a <strong><code>java.util.Properties</code></strong> that contains the properties which should be preferred to be used.
  </p><div class="code panel pdl" style="border-width: 1px;">
   <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
    <b>Providing properties from within unit test source</b>
   </div>
   <div class="codeContent panelContent pdl"> 
    <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // override this method to provide our custom properties we use in this unit test @Override protected Properties useOverridePropertiesWithPropertiesComponent() { Properties extra = new Properties(); extra.put(&amp;quot;destination&amp;quot;, &amp;quot;mock:extra&amp;quot;); extra.put(&amp;quot;greeting&amp;quot;, &amp;quot;Bye&amp;quot;); return extra; } </script> 
   </div>
  </div>&#160;<p>This can be done from any of the Camel Test kits, such as <code>camel-test</code>, <code>camel-test-spring</code> and <code>camel-test-blueprint</code>.</p><p>The <strong><code>ignoreMissingLocationWithPropertiesComponent</code></strong> can be used to instruct Camel to ignore any locations which was not discoverable. For example if you run the unit test, in an environment that does not have access to the location of the properties.</p><h3 id="BookInOnePage-Using@PropertyInject">Using&#160;<code>@PropertyInject</code></h3><p><strong>Available as of Camel 2.12</strong></p><p>Camel allows to inject property placeholders in POJOs using the&#160;<strong><code>@PropertyInject</code></strong> annotation which can be set on fields and setter methods. For example you can use that with <strong><code>RouteBuilder</code></strong> classes, such as shown below:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public class MyRouteBuilder extends RouteBuilder { @PropertyInject(&amp;quot;hello&amp;quot;) private String greeting; @Override public void configure() throws Exception { from(&amp;quot;direct:start&amp;quot;) .transform().constant(greeting) .to(&amp;quot;{{result}}&amp;quot;); } } </script> 
  </div>
 </div><p>Notice we have annotated the greeting field with&#160;<strong><code>@PropertyInject</code></strong> and define it to use the key <strong><code>hello</code></strong>. Camel will then lookup the property with this key and inject its value, converted to a String type.</p><p>You can also use multiple placeholders and text in the key, for example we can do:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">@PropertyInject(&amp;quot;Hello {{name}} how are you?&amp;quot;) private String greeting; </script> 
  </div>
 </div><p>This will lookup the placeholder with they key <strong><code>name</code></strong>.</p><p>You can also add a default value if the key does not exists, such as:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">@PropertyInject(value = &amp;quot;myTimeout&amp;quot;, defaultValue = &amp;quot;5000&amp;quot;) private int timeout; </script> 
  </div>
 </div><h3 id="BookInOnePage-UsingOutoftheBoxFunctions">Using Out of the Box Functions</h3><p><strong>Available as of Camel 2.14.1</strong></p><p>The&#160;<a shape="rect" href="properties.html">Properties</a>&#160;component includes the following functions out of the box</p>
 <ul><li><code>env</code> - A function to lookup the property from OS environment variables.</li><li><code>sys</code> - A function to lookup the property from Java JVM system properties.</li><li><code>service</code> - A function to lookup the property from OS environment variables using the service naming idiom.</li><li><code>service.host</code> - <strong>Camel 2.16.1:&#160;</strong>A function to lookup the property&#160;from OS environment variables using the service naming idiom returning the hostname part only.</li><li><code>service.port</code> - <strong>Camel 2.16.1:&#160;</strong>A function to lookup the property&#160;from OS environment variables using the service naming idiom returning the port part only.</li></ul><p>As you can see these functions is intended to make it easy to lookup values from the environment. As they are provided out of the box, they can easily be used as shown below:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/blueprint&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;{{env:SOMENAME}}&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;{{sys:MyJvmPropertyName}}&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt;</script> 
  </div>
 </div><p>You can use default values as well, so if the property does not exists, you can define a default value as shown below, where the default value is a&#160;<strong><code>log:foo</code></strong> and&#160;<strong><code>log:bar</code></strong> value.</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/blueprint&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;{{env:SOMENAME:log:foo}}&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;{{sys:MyJvmPropertyName:log:bar}}&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt;</script> 
  </div>
 </div><p>&#160;</p><p>The service function is for looking up a service which is defined using OS environment variables using the service naming idiom, to refer to a service location using&#160;<strong><code>hostname : port</code></strong></p>
 <ul><li><em><code>NAME</code></em><strong><code>_SERVICE_HOST</code></strong></li><li><em><code>NAME</code></em><strong><code>_SERVICE_PORT</code></strong></li></ul><p>in other words the service uses&#160;<strong><code>_SERVICE_HOST</code></strong> and&#160;<strong><code>_SERVICE_PORT</code></strong> as prefix. So if the service is named <strong><code>FOO</code></strong>, then the OS environment variables should be set as</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">export $FOO_SERVICE_HOST=myserver export $FOO_SERVICE_PORT=8888</script> 
  </div>
 </div><p>&#160;</p><p>For example if the&#160;<strong><code>FOO</code></strong> service a remote HTTP service, then we can refer to the service in the Camel endpoint URI, and use the&#160;<a shape="rect" href="http.html">HTTP</a>&#160;component to make the HTTP call:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/blueprint&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;http://{{service:FOO}}/myapp&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt;</script> 
  </div>
 </div><p>&#160;</p><p>And we can use default values if the service has not been defined, for example to call a service on localhost, maybe for unit testing etc:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/blueprint&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;http://{{service:FOO:localhost:8080}}/myapp&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt;</script> 
  </div>
 </div><h3 id="BookInOnePage-UsingCustomFunctions">Using Custom Functions</h3><p><strong>Available as of Camel 2.14.1</strong></p><p>The <a shape="rect" href="properties.html">Properties</a> component allow to plugin 3rd party functions which can be used during&#160;parsing of the property placeholders. These functions are then able to do custom logic to resolve the placeholders, such as looking up in databases, do custom computations, or whatnot. The name of the function becomes the prefix used in the placeholder. This is best illustrated in the example code below</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;beerFunction&amp;quot; class=&amp;quot;MyBeerFunction&amp;quot;/&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/blueprint&amp;quot;&amp;gt; &amp;lt;propertyPlaceholder id=&amp;quot;properties&amp;quot; location=&amp;quot;none&amp;quot; ignoreMissingLocation=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;propertiesFunction ref=&amp;quot;beerFunction&amp;quot;/&amp;gt; &amp;lt;/propertyPlaceholder&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;{{beer:FOO}}&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;{{beer:BAR}}&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt;</script> 
  </div>
 </div><p>Here we have a Camel XML route where we have defined the&#160;<strong><code>&lt;propertyPlaceholder&gt;</code></strong> to use a custom function, which we refer to be the bean id - e.g., the <strong><code>beerFunction</code></strong>. As the beer function uses&#160;<strong><code>beer</code></strong> as its name, then the placeholder syntax can trigger the beer function by starting with <strong><code>beer:value</code></strong>.</p><p>The implementation of the function is only two methods as shown below:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public static final class MyBeerFunction implements PropertiesFunction { @Override public String getName() { return &amp;quot;beer&amp;quot;; } &nbsp;@Override public String apply(String remainder) { return &amp;quot;mock:&amp;quot; + remainder.toLowerCase(); } }</script> 
  </div>
 </div><p>The function must implement the&#160;<strong><code>org.apache.camel.component.properties.PropertiesFunction</code></strong> interface. The method&#160;<strong><code>getName</code></strong> is &#160;the name of the function, e.g., <strong><code>beer</code></strong>. And the&#160;<strong><code>apply</code></strong> method is where we implement the custom logic to do. As the sample code is from an unit test, it just returns a value to refer to a mock endpoint.</p><p>To register a custom function from Java code is as shown below:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">PropertiesComponent pc = context.getComponent(&amp;quot;properties&amp;quot;, PropertiesComponent.class); pc.addFunction(new MyBeerFunction()); </script> 
  </div>
 </div><h2 id="BookInOnePage-SeeAlso.69">See Also</h2>
 <ul class="alternate"><li><a shape="rect" href="properties.html">Properties</a> component</li></ul> <h3 id="BookInOnePage-SeeAlso.70">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="jasypt.html">Jasypt</a> for using encrypted values e.g., passwords, in properties.</li></ul><h2 id="BookInOnePage-RefComponent">Ref Component</h2><p>The <strong>ref:</strong> component is used for lookup of existing endpoints bound in the <a shape="rect" href="registry.html">Registry</a>.</p><h3 id="BookInOnePage-URIformat.53">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> ref:someName[?options] </script> 
 </div>
</div><p>Where <strong>someName</strong> is the name of an endpoint in the <a shape="rect" href="registry.html">Registry</a> (usually, but not always, the Spring registry). If you are using the Spring registry, <code>someName</code> would be the bean ID of an endpoint in the Spring registry.</p><h3 id="BookInOnePage-Runtimelookup">Runtime lookup</h3><p>This component can be used when you need dynamic discovery of endpoints in the <a shape="rect" href="registry.html">Registry</a> where you can compute the URI at runtime. Then you can look up the endpoint using the following code:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // lookup the endpoint String myEndpointRef = &amp;quot;bigspenderOrder&amp;quot;; Endpoint endpoint = context.getEndpoint(&amp;quot;ref:&amp;quot; + myEndpointRef); Producer producer = endpoint.createProducer(); Exchange exchange = producer.createExchange(); exchange.getIn().setBody(payloadToSend); // send the exchange producer.process(exchange); ... </script> 
 </div>
</div><p>And you could have a list of endpoints defined in the <a shape="rect" href="registry.html">Registry</a> such as:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext id=&amp;quot;camel&amp;quot; xmlns=&amp;quot;http://activemq.apache.org/camel/schema/spring&amp;quot;&amp;gt; &amp;lt;endpoint id=&amp;quot;normalOrder&amp;quot; uri=&amp;quot;activemq:order.slow&amp;quot;/&amp;gt; &amp;lt;endpoint id=&amp;quot;bigspenderOrder&amp;quot; uri=&amp;quot;activemq:order.high&amp;quot;/&amp;gt; ... &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-Sample.1">Sample</h3><p>In the sample below we use the <code>ref:</code> in the URI to reference the endpoint with the spring ID, <code>endpoint2</code>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;mybean&amp;quot; class=&amp;quot;org.apache.camel.spring.example.DummyBean&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;endpoint&amp;quot; ref=&amp;quot;endpoint1&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;camelContext id=&amp;quot;camel&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;jmxAgent id=&amp;quot;agent&amp;quot; disabled=&amp;quot;true&amp;quot;/&amp;gt; &amp;lt;endpoint id=&amp;quot;endpoint1&amp;quot; uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;endpoint id=&amp;quot;endpoint2&amp;quot; uri=&amp;quot;mock:end&amp;quot;/&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from ref=&amp;quot;endpoint1&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;ref:endpoint2&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><p>You could, of course, have used the <code>ref</code> attribute instead:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;to ref=&amp;quot;endpoint2&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>Which is the more common way to write it. </p><h3 id="BookInOnePage-SeeAlso.71">See Also</h3><ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-RestletComponent">Restlet Component</h2><p>The <strong>Restlet</strong> component provides <a shape="rect" class="external-link" href="http://www.restlet.org" rel="nofollow">Restlet</a> based <a shape="rect" href="endpoint.html">endpoints</a> for consuming and producing RESTful resources.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-restlet&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.54">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">restlet:restletUrl[?options] </script> 
 </div>
</div><p>Format of restletUrl:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">protocol://hostname[:port][/resourcePattern] </script> 
 </div>
</div><p>Restlet promotes decoupling of protocol and application concerns. The reference implementation of <a shape="rect" class="external-link" href="http://www.noelios.com/products/restlet-engine" rel="nofollow">Restlet Engine</a> supports a number of protocols. However, we have tested the HTTP protocol only. The default port is port 80. We do not automatically switch default port based on the protocol yet.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><p>&#160;</p><div class="confluence-information-macro confluence-information-macro-information">
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>It seems Restlet is case sensitive in understanding headers. For example to use content-type, use Content-Type, and for location use Location and so on.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>We have received a report about drop in performance in camel-restlet in Camel 2.14.0 and 2.14.1. We have reported this to the Restlet team in <a shape="rect" class="external-link" href="https://github.com/restlet/restlet-framework-java/issues/996" rel="nofollow">issue 996</a>. To remedy the issue then from Camel 2.14.2 onwards you can set synchronous=true as option on the endpoint uris, Or set it on the RestletComponent as a global option so all endpoints inherit this option.</p>
 </div>
</div><p>&#160;</p><h3 id="BookInOnePage-Options.62">Options</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>headerFilterStrategy=#</code><em>refName</em></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>An instance of <code>RestletHeaderFilterStrategy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Use the <code>#</code> notation (<code>headerFilterStrategy=#</code><em>refName</em>) to reference a header filter strategy in the Camel Registry. The strategy will be plugged into the restlet binding if it is <code>HeaderFilterStrategyAware</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>restletBinding=#</code><em>refName</em></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>An instance of <code>DefaultRestletBinding</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The bean ID of a <code>RestletBinding</code> object in the Camel Registry.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>restletMethod</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>GET</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>On a producer endpoint, specifies the request method to use. On a consumer endpoint, specifies that the endpoint consumes only <code>restletMethod</code> requests. The string value is converted to <a shape="rect" class="external-link" href="http://www.restlet.org/documentation/1.1/api/org/restlet/data/Method.html" rel="nofollow">org.restlet.data.Method</a> by the <code>Method.valueOf(String)</code> method.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>restletMethods</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em>None</em></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Consumer only</strong> Specify one or more methods separated by commas (e.g. <code>restletMethods=post,put</code>) to be serviced by a restlet consumer endpoint. If both <code>restletMethod</code> and <code>restletMethods</code> options are specified, the <code>restletMethod</code> setting is ignored.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>restletRealm=#</code><em>refName</em></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The bean ID of the Realm Map in the Camel Registry.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>restletUriPatterns=#</code><em>refName</em></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em>None</em></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Consumer only</strong> Specify one ore more URI templates to be serviced by a restlet consumer endpoint, using the <code>#</code> notation to reference a <code>List&lt;String&gt;</code> in the Camel Registry. If a URI pattern has been defined in the endpoint URI, both the URI pattern defined in the endpoint and the <code>restletUriPatterns</code> option will be honored.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>throwExceptionOnFailure</code> (<strong>2.6 or later</strong>)</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>*Producer only * Throws exception on a producer failure.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>connectionTimeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>300000</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.12.3</strong> <strong>Producer only</strong> The Client will give up connection if the connection is timeout, 0 for unlimited wait.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>socketTimeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>300000</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.12.3</strong> <strong>Producer only</strong> The Client socket receive timeout, 0 for unlimited wait.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>disableStreamCache</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.14:</strong><span style="color: rgb(0,0,0);">&#160;Determines whether or not the raw input stream from Jetty is cached or not (Camel will read the stream into a in memory/overflow to file,&#160;</span><a shape="rect" class="external-link" href="http://camel.apache.org/stream-caching.html" title="Stream caching">Stream caching</a><span style="color: rgb(0,0,0);">) cache. By default Camel will cache the Jetty input stream to support reading it multiple times to ensure it Camel can retrieve all data from the stream. However you can set this option to&#160;</span><code>true</code><span style="color: rgb(0,0,0);">&#160;when you for example need to access the raw stream, such as streaming it directly to a file or other persistent store. DefaultRestletBinding will copy the request input stream into a stream cache and put it into message body if this option is&#160;</span><code>false</code><span style="color: rgb(0,0,0);">&#160;to support reading the stream multiple times.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>streamRepresentation</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16.4/2.17.2:</strong> <strong>Producer only</strong> <span style="line-height: 1.42857;">Whether to support stream representation as response from calling a REST service using the restlet producer. If the response is streaming then this option can be enabled to use an </span><a shape="rect" class="external-link" href="http://java.io" style="line-height: 1.42857;" rel="nofollow">java.io</a><span style="line-height: 1.42857;">.InputStream as the message body on the Camel Message body. If using this option you may want to enable the autoCloseStream option as well to ensure the input stream is closed when the Camel Exchange is done being routed. However if you need to read the stream outside a Camel route, you may need </span><span style="line-height: 1.42857;">to not auto close the stream.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>autoCloseStream</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16.4/2.17.2:</strong><span>&#160;</span><strong>Producer only </strong><span style="line-height: 1.42857;">Whether to auto close the stream representation as response from calling a REST service using the restlet producer. If the response is streaming and the option streamRepresentation is enabled then you may want to auto close the InputStream from the streaming response to ensure the input stream is closed when the Camel Exchange is done being routed. However if you need to read the stream outside a Camel route, you may need to not auto close the stream.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>cookieHandler</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>null</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.19: Producer only:</strong> Configure a cookie handler to maintain a HTTP session</td></tr></tbody></table>
</div><h3 id="BookInOnePage-ComponentOptions.1">Component Options</h3><p>The Restlet component can be configured with the following options. Notice these are <strong>component</strong> options and cannot be configured on the endpoint, see further below for an example.</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>controllerDaemon</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Indicates if the controller thread should be a daemon (not blocking JVM exit).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>controllerSleepTimeMs</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>100</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Time for the controller thread to sleep between each control.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>inboundBufferSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>8192</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> The size of the buffer when reading messages.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>minThreads</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Minimum threads waiting to service requests.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxThreads</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>10</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Maximum threads that will service requests.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code><span>lowThreads</span></code></td><td colspan="1" rowspan="1" class="confluenceTd">8</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.13: </strong>Number of worker threads determining when the connector is considered overloaded.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>maxQueued</code></td><td colspan="1" rowspan="1" class="confluenceTd">0</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.13: </strong>Maximum number of calls that can be queued if there aren't any worker thread available to service them. If the value is '0', then no queue is used and calls are rejected if no worker thread is immediately available. If the value is '-1', then an unbounded queue is used and calls are never rejected.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxConnectionsPerHost</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>-1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Maximum number of concurrent connections per host (IP address).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxTotalConnections</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>-1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Maximum number of concurrent connections in total.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>outboundBufferSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>8192</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> The size of the buffer when writing messages.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>persistingConnections</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Indicates if connections should be kept alive after a call.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>pipeliningConnections</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Indicates if pipelining connections are supported.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>threadMaxIdleTimeMs</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>60000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Time for an idle thread to wait for an operation before being collected.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>useForwardedForHeader</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Lookup the "X-Forwarded-For" header supported by popular proxies and caches and uses it to populate the Request.getClientAddresses() method result. This information is only safe for intermediary components within your local network. Other addresses could easily be changed by setting a fake header and should not be trusted for serious security checks.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>reuseAddress</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.5/2.11.1:</strong> Enable/disable the SO_REUSEADDR socket option. See java.io.ServerSocket#reuseAddress property for additional details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>disableStreamCache</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.14:</strong><span style="color: rgb(0,0,0);">&#160;Determines whether or not the raw input stream from Jetty is cached or not (Camel will read the stream into a in memory/overflow to file,&#160;</span><a shape="rect" class="external-link" href="http://camel.apache.org/stream-caching.html" title="Stream caching">Stream caching</a><span style="color: rgb(0,0,0);">) cache. By default Camel will cache the Jetty input stream to support reading it multiple times to ensure it Camel can retrieve all data from the stream. However you can set this option to&#160;</span><code>true</code><span style="color: rgb(0,0,0);">&#160;when you for example need to access the raw stream, such as streaming it directly to a file or other persistent store. DefaultRestletBinding will copy the request input stream into a stream cache and put it into message body if this option is&#160;</span><code>false</code><span style="color: rgb(0,0,0);">&#160;to support reading the stream multiple times.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">enabledConverters</td><td colspan="1" rowspan="1" class="confluenceTd">null</td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.18:</strong><span> By default, Restlet engine loads all the extension it finds at run-time and this option filter out all the converters except those explicit listed using full qualified class name or simple class name. </span>i.e. by setting <span style="line-height: 1.42857;">enabledConverters=JacksonConverter, GsonConverter the RestletComponent will remove all the converters loaded by the <span>Restlet engine except Jackson and Gson. Note that you still need to add the extensions as dependency.</span></span></p></td></tr></tbody></table>
</div><h3 id="BookInOnePage-MessageHeaders.15">Message Headers</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Content-Type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the content type, which can be set on the OUT message by the application/processor. The value is the <code>content-type</code> of the response message. If this header is not set, the content type is based on the object type of the OUT message body. In Camel 2.3 onward, if the Content-Type header is specified in the Camel IN message, the value of the header determine the content type for the Restlet request message.&#160;&#160; Otherwise, it is defaulted to "application/x-www-form-urlencoded'. Prior to release 2.3, it is not possible to change the request content type default.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelAcceptContentType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Since Camel 2.9.3, 2.10.0:</strong> The HTTP Accept request header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHttpMethod</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The HTTP request method. This is set in the IN message header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHttpQuery</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The query string of the request URI. It is set on the IN message by <code>DefaultRestletBinding</code> when the restlet component receives a request.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHttpResponseCode</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code> or <code>Integer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The response code can be set on the OUT message by the application/processor. The value is the response code of the response message. If this header is not set, the response code is set by the restlet runtime engine.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelHttpUri</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The HTTP request URI. This is set in the IN message header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelRestletLogin</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Login name for basic authentication. It is set on the IN message by the application and gets filtered before the restlet request header by Camel.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelRestletPassword</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Password name for basic authentication. It is set on the IN message by the application and gets filtered before the restlet request header by Camel.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelRestletRequest</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Request</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> The <code>org.restlet.Request</code> object which holds all request details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelRestletResponse</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Response</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> The <code>org.restlet.Response</code> object. You can use this to create responses using the API from Restlet. See examples below.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>org.restlet.*</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Attributes of a Restlet message that get propagated to Camel IN headers.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cache-control</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code> or <code>List&lt;CacheDirective&gt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> User can set the cache-control with the String value or the List of CacheDirective of Restlet from the camel message header.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-MessageBody.4">Message Body</h3><p>Camel will store the restlet response from the external server on the OUT body. All headers from the IN message will be copied to the OUT message, so that headers are preserved during routing.</p><h3 id="BookInOnePage-Samples.16">Samples</h3><h4 id="BookInOnePage-RestletEndpointwithAuthentication">Restlet Endpoint with Authentication</h4><p>The following route starts a <code>restlet</code> consumer endpoint that listens for <code>POST</code> requests on <a shape="rect" class="external-link" href="http://localhost:8080" rel="nofollow">http://localhost:8080</a>. The processor creates a response that echoes the request body and the value of the <code>id</code> header.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;restlet:http://localhost:&amp;quot; + port + &amp;quot;/securedOrders?restletMethod=post&amp;amp;restletRealm=#realm&amp;quot;).process(new Processor() { public void process(Exchange exchange) throws Exception { exchange.getOut().setBody( &amp;quot;received [&amp;quot; + exchange.getIn().getBody(String.class) + &amp;quot;] as an order id = &amp;quot; + exchange.getIn().getHeader(&amp;quot;id&amp;quot;)); } }); </script> 
  </div>
 </div>The <code>restletRealm</code> setting in the URI query is used to look up a Realm Map in the registry. If this option is specified, the restlet consumer uses the information to authenticate user logins. Only <em>authenticated</em> requests can access the resources. In this sample, we create a Spring application context that serves as a registry. The bean ID of the Realm Map should match the <em>restletRealmRef</em>.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;util:map id=&amp;quot;realm&amp;quot;&amp;gt; &amp;lt;entry key=&amp;quot;admin&amp;quot; value=&amp;quot;foo&amp;quot; /&amp;gt; &amp;lt;entry key=&amp;quot;bar&amp;quot; value=&amp;quot;foo&amp;quot; /&amp;gt; &amp;lt;/util:map&amp;gt; </script> 
  </div>
 </div>The following sample starts a <code>direct</code> endpoint that sends requests to the server on <a shape="rect" class="external-link" href="http://localhost:8080" rel="nofollow">http://localhost:8080</a> (that is, our restlet consumer endpoint).
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // Note: restletMethod and restletRealmRef are stripped // from the query before a request is sent as they are // only processed by Camel. from(&amp;quot;direct:start-auth&amp;quot;).to(&amp;quot;restlet:http://localhost:&amp;quot; + port + &amp;quot;/securedOrders?restletMethod=post&amp;quot;); </script> 
  </div>
 </div>That is all we need. We are ready to send a request and try out the restlet component:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> final String id = &amp;quot;89531&amp;quot;; Map&amp;lt;String, Object&amp;gt; headers = new HashMap&amp;lt;String, Object&amp;gt;(); headers.put(RestletConstants.RESTLET_LOGIN, &amp;quot;admin&amp;quot;); headers.put(RestletConstants.RESTLET_PASSWORD, &amp;quot;foo&amp;quot;); headers.put(Exchange.CONTENT_TYPE, MediaType.APPLICATION_XML); headers.put(&amp;quot;id&amp;quot;, id); String response = template.requestBodyAndHeaders( &amp;quot;direct:start-auth&amp;quot;, &amp;quot;&amp;lt;order foo=&amp;#39;1&amp;#39;/&amp;gt;&amp;quot;, headers, String.class); </script> 
  </div>
 </div>The sample client sends a request to the <code>direct:start-auth</code> endpoint with the following headers:<ul><li><code>CamelRestletLogin</code> (used internally by Camel)</li><li><code>CamelRestletPassword</code> (used internally by Camel)</li><li><code>id</code> (application header)</li></ul><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Note</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p><code>org.apache.camel.restlet.auth.login</code> and <code>org.apache.camel.restlet.auth.password</code> will not be propagated as Restlet header.</p>
 </div>
</div><p>The sample client gets a response like the following:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter">received [&amp;lt;order foo=&amp;#39;1&amp;#39;/&amp;gt;] as an order id = 89531 </script> 
 </div>
</div><h4 id="BookInOnePage-SinglerestletendpointtoservicemultiplemethodsandURItemplates">Single restlet endpoint to service multiple methods and URI templates</h4><p>It is possible to create a single route to service multiple HTTP methods using the <code>restletMethods</code> option. This snippet also shows how to retrieve the request method from the header:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;restlet:http://localhost:&amp;quot; + portNum + &amp;quot;/users/{username}?restletMethods=post,get,put&amp;quot;) .process(new Processor() { public void process(Exchange exchange) throws Exception { // echo the method exchange.getOut().setBody(exchange.getIn().getHeader(Exchange.HTTP_METHOD, String.class)); } }); </script> 
  </div>
 </div>In addition to servicing multiple methods, the next snippet shows how to create an endpoint that supports multiple URI templates using the <code>restletUriPatterns</code> option. The request URI is available in the header of the IN message as well. If a URI pattern has been defined in the endpoint URI (which is not the case in this sample), both the URI pattern defined in the endpoint and the <code>restletUriPatterns</code> option will be honored.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;restlet:http://localhost:&amp;quot; + portNum + &amp;quot;?restletMethods=post,get&amp;amp;restletUriPatterns=#uriTemplates&amp;quot;) .process(new Processor() { public void process(Exchange exchange) throws Exception { // echo the method String uri = exchange.getIn().getHeader(Exchange.HTTP_URI, String.class); String out = exchange.getIn().getHeader(Exchange.HTTP_METHOD, String.class); if ((&amp;quot;http://localhost:&amp;quot; + portNum + &amp;quot;/users/homer&amp;quot;).equals(uri)) { exchange.getOut().setBody(out + &amp;quot; &amp;quot; + exchange.getIn().getHeader(&amp;quot;username&amp;quot;, String.class)); } else if ((&amp;quot;http://localhost:&amp;quot; + portNum + &amp;quot;/atom/collection/foo/component/bar&amp;quot;).equals(uri)) { exchange.getOut().setBody(out + &amp;quot; &amp;quot; + exchange.getIn().getHeader(&amp;quot;id&amp;quot;, String.class) + &amp;quot; &amp;quot; + exchange.getIn().getHeader(&amp;quot;cid&amp;quot;, String.class)); } } }); </script> 
  </div>
 </div>The <code>restletUriPatterns=#uriTemplates</code> option references the <code>List&lt;String&gt;</code> bean defined in the Spring XML configuration.<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;util:list id=&amp;quot;uriTemplates&amp;quot;&amp;gt; &amp;lt;value&amp;gt;/users/{username}&amp;lt;/value&amp;gt; &amp;lt;value&amp;gt;/atom/collection/{id}/component/{cid}&amp;lt;/value&amp;gt; &amp;lt;/util:list&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-UsingRestletAPItopopulateresponse">Using Restlet API to populate response</h4><p><strong>Available as of Camel 2.8</strong></p><p>You may want to use the <code>org.restlet.Response</code> API to populate the response. This gives you full access to the Restlet API and fine grained control of the response. See the route snippet below where we generate the response from an inlined Camel <a shape="rect" href="processor.html">Processor</a>:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
   <b>Generating response using Restlet Response API</b>
  </div>
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;restlet:http://localhost:&amp;quot; + portNum + &amp;quot;/users/{id}/like/{beer}&amp;quot;) .process(new Processor() { public void process(Exchange exchange) throws Exception { // the Restlet request should be available if needed Request request = exchange.getIn().getHeader(RestletConstants.RESTLET_REQUEST, Request.class); assertNotNull(&amp;quot;Restlet Request&amp;quot;, request); // use Restlet API to create the response Response response = exchange.getIn().getHeader(RestletConstants.RESTLET_RESPONSE, Response.class); assertNotNull(&amp;quot;Restlet Response&amp;quot;, response); response.setStatus(Status.SUCCESS_OK); response.setEntity(&amp;quot;&amp;lt;response&amp;gt;Beer is Good&amp;lt;/response&amp;gt;&amp;quot;, MediaType.TEXT_XML); exchange.getOut().setBody(response); } }); </script> 
  </div>
 </div><h4 id="BookInOnePage-Configuringmaxthreadsoncomponent">Configuring max threads on component</h4><p>To configure the max threads options you must do this on the component, such as:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;restlet&amp;quot; class=&amp;quot;org.apache.camel.component.restlet.RestletComponent&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;maxThreads&amp;quot; value=&amp;quot;100&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-UsingtheRestletservletwithinawebapp">Using the Restlet servlet within a webapp</h4><p><strong>Available as of Camel 2.8</strong><br clear="none"> There are <a shape="rect" class="external-link" href="http://www.restlet.org/documentation/2.0/jee/ext/org/restlet/ext/servlet/ServerServlet.html" rel="nofollow">three possible ways</a> to configure a Restlet application within a servlet container and using the subclassed SpringServerServlet enables configuration within Camel by injecting the Restlet Component.</p><p>Use of the Restlet servlet within a servlet container enables routes to be configured with relative paths in URIs (removing the restrictions of hard-coded absolute URIs) and for the hosting servlet container to handle incoming requests (rather than have to spawn a separate server process on a new port).</p><p>To configure, add the following to your camel-context.xml;</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext&amp;gt; &amp;lt;route id=&amp;quot;RS_RestletDemo&amp;quot;&amp;gt; &amp;lt;from uri=&amp;quot;restlet:/demo/{id}&amp;quot; /&amp;gt; &amp;lt;transform&amp;gt; &amp;lt;simple&amp;gt;Request type : ${header.CamelHttpMethod} and ID : ${header.id}&amp;lt;/simple&amp;gt; &amp;lt;/transform&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;bean id=&amp;quot;RestletComponent&amp;quot; class=&amp;quot;org.restlet.Component&amp;quot; /&amp;gt; &amp;lt;bean id=&amp;quot;RestletComponentService&amp;quot; class=&amp;quot;org.apache.camel.component.restlet.RestletComponent&amp;quot;&amp;gt; &amp;lt;constructor-arg index=&amp;quot;0&amp;quot;&amp;gt; &amp;lt;ref bean=&amp;quot;RestletComponent&amp;quot; /&amp;gt; &amp;lt;/constructor-arg&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>And add this to your web.xml;</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;!-- Restlet Servlet --&amp;gt; &amp;lt;servlet&amp;gt; &amp;lt;servlet-name&amp;gt;RestletServlet&amp;lt;/servlet-name&amp;gt; &amp;lt;servlet-class&amp;gt;org.restlet.ext.spring.SpringServerServlet&amp;lt;/servlet-class&amp;gt; &amp;lt;init-param&amp;gt; &amp;lt;param-name&amp;gt;org.restlet.component&amp;lt;/param-name&amp;gt; &amp;lt;param-value&amp;gt;RestletComponent&amp;lt;/param-value&amp;gt; &amp;lt;/init-param&amp;gt; &amp;lt;/servlet&amp;gt; &amp;lt;servlet-mapping&amp;gt; &amp;lt;servlet-name&amp;gt;RestletServlet&amp;lt;/servlet-name&amp;gt; &amp;lt;url-pattern&amp;gt;/rs/*&amp;lt;/url-pattern&amp;gt; &amp;lt;/servlet-mapping&amp;gt; </script> 
 </div>
</div><p>You will then be able to access the deployed route at <a shape="rect" class="external-link" href="http://localhost:8080/mywebapp/rs/demo/1234" rel="nofollow">http://localhost:8080/mywebapp/rs/demo/1234</a> where;</p><p>localhost:8080 is the server and port of your servlet container<br clear="none"> mywebapp is the name of your deployed webapp<br clear="none"> Your browser will then show the following content;</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;quot;Request type : GET and ID : 1234&amp;quot; </script> 
 </div>
</div><p>You will need to add dependency on the Spring extension to restlet which you can do in your Maven pom.xml file:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.restlet.jee&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;org.restlet.ext.spring&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;${restlet-version}&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><p>And you would need to add dependency on the restlet maven repository as well:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;repository&amp;gt; &amp;lt;id&amp;gt;maven-restlet&amp;lt;/id&amp;gt; &amp;lt;name&amp;gt;Public online Restlet repository&amp;lt;/name&amp;gt; &amp;lt;url&amp;gt;http://maven.restlet.org&amp;lt;/url&amp;gt; &amp;lt;/repository&amp;gt; </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.72">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-RMIComponent">RMI Component</h2><p>The <strong>rmi:</strong> component binds <a shape="rect" href="exchange.html">Exchange</a>s to the RMI protocol (JRMP).</p><p>Since this binding is just using RMI, normal RMI rules still apply regarding what methods can be invoked. This component supports only Exchanges that carry a method invocation from an interface that extends the <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.3/docs/api/java/rmi/Remote.html" rel="nofollow">Remote</a> interface. All parameters in the method should be either <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/io/Serializable.html" rel="nofollow">Serializable</a> or <code>Remote</code> objects.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-rmi&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.55">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> rmi://rmi-regisitry-host:rmi-registry-port/registry-path[?options] </script> 
 </div>
</div><p>For example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> rmi://localhost:1099/path/to/service </script> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.63">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default Value </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>method</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>null</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> You can set the name of the method to invoke. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>remoteInterfaces</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>null</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Its now possible to use this option from <strong>Camel 2.7:</strong> in the XML DSL. It can be a list of interface names separated by comma. </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Using.3">Using</h3><p>To call out to an existing RMI service registered in an RMI registry, create a route similar to the following:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;pojo:foo&amp;quot;).to(&amp;quot;rmi://localhost:1099/foo&amp;quot;); </script> 
 </div>
</div><p>To bind an existing camel processor or service in an RMI registry, define an RMI endpoint as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> RmiEndpoint endpoint= (RmiEndpoint) endpoint(&amp;quot;rmi://localhost:1099/bar&amp;quot;); endpoint.setRemoteInterfaces(ISay.class); from(endpoint).to(&amp;quot;pojo:bar&amp;quot;); </script> 
 </div>
</div><p>Note that when binding an RMI consumer endpoint, you must specify the <code>Remote</code> interfaces exposed.</p><p>In XML DSL you can do as follows from <strong>Camel 2.7</strong> onwards:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camel:route&amp;gt; &amp;lt;from uri=&amp;quot;rmi://localhost:37541/helloServiceBean?remoteInterfaces=org.apache.camel.example.osgi.HelloService&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:helloServiceBean&amp;quot;/&amp;gt; &amp;lt;/camel:route&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-SeeAlso.73">See Also</h3><ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-RSSComponent">RSS Component</h2><p>The <strong>rss:</strong> component is used for polling RSS feeds. Camel will default poll the feed every 60th seconds.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-rss&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><p><strong>Note:</strong> The component currently only supports polling (consuming) feeds.</p><div class="confluence-information-macro confluence-information-macro-note">
 <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Camel-rss internally uses a <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/servicemix/smx4/bundles/trunk/rome-1.0/">patched version</a> of <a shape="rect" class="external-link" href="http://rometools.github.io/rome/" rel="nofollow">ROME</a> hosted on ServiceMix to solve some OSGi <a shape="rect" class="external-link" href="https://issues.apache.org/jira/browse/SMX4-510">class loading issues</a>.</p>
 </div>
</div><h3 id="BookInOnePage-URIformat.56">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">rss:rssUri </script> 
 </div>
</div><p>Where <code>rssUri</code> is the URI to the RSS feed to poll.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.64">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Property</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>splitEntries</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If <code>true</code>, Camel splits a feed into its individual entries and returns each entry, poll by poll. For example, if a feed contains seven entries, Camel returns the first entry on the first poll, the second entry on the second poll, and so on. When no more entries are left in the feed, Camel contacts the remote RSS URI to obtain a new feed. If <code>false</code>, Camel obtains a fresh feed on every poll and returns all of the feed's entries.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>filter</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Use in combination with the <code>splitEntries</code> option in order to filter returned entries. By default, Camel applies the <code>UpdateDateFilter</code> filter, which returns only new entries from the feed, ensuring that the consumer endpoint never receives an entry more than once. The filter orders the entries chronologically, with the newest returned last.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>throttleEntries</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> Sets whether all entries identified in a single feed poll should be delivered immediately. If true, only one entry is processed per consumer.delay. Only applicable when splitEntries is set to true.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>lastUpdate</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Use in combination with the <code>filter</code> option to block entries earlier than a specific date/time (uses the <code>entry.updated</code> timestamp). The format is: <code>yyyy-MM-ddTHH:MM:ss</code>. Example: <code>2007-12-24T17:45:59</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>feedHeader</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies whether to add the ROME <code>SyndFeed</code> object as a header.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sortEntries</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If <code>splitEntries</code> is <code>true</code>, this specifies whether to sort the entries by updated date.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.delay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>60000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Delay in milliseconds between each poll.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.initialDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Milliseconds before polling starts.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.userFixedDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Set to <code>true</code> to use fixed delay between pools, otherwise fixed rate is used. See <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ScheduledExecutorService.html" rel="nofollow">ScheduledExecutorService</a> in JDK for details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>username</code></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong><span> For basic authentication when polling from a HTTP feed</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>password</code></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong><span> For basic authentication when polling from a HTTP feed</span></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Exchangedatatypes">Exchange data types</h3><p>Camel initializes the In body on the Exchange with a ROME <code>SyndFeed</code>. Depending on the value of the <code>splitEntries</code> flag, Camel returns either a <code>SyndFeed</code> with one <code>SyndEntry</code> or a <code>java.util.List</code> of <code>SyndEntrys</code>.</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Behavior</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>splitEntries</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A single entry from the current feed is set in the exchange.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>splitEntries</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The entire list of entries from the current feed is set in the exchange.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-MessageHeaders.16">Message Headers</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelRssFeed</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The entire <code>SyncFeed</code> object.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-RSSDataformat">RSS Dataformat</h3><p>The RSS component ships with an RSS dataformat that can be used to convert between String (as XML) and ROME RSS model objects.</p><ul><li>marshal = from ROME <code>SyndFeed</code> to XML <code>String</code></li><li>unmarshal = from XML <code>String</code> to ROME <code>SyndFeed</code></li></ul><p>A route using this would look something like this:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;rss:file:src/test/data/rss20.xml?splitEntries=false&amp;amp;consumer.delay=1000&amp;quot;).marshal().rss().to(&amp;quot;mock:marshal&amp;quot;); </script> 
  </div>
 </div>The purpose of this feature is to make it possible to use Camel's lovely built-in expressions for manipulating RSS messages. As shown below, an XPath expression can be used to filter the RSS message:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // only entries with Camel in the title will get through the filter from(&amp;quot;rss:file:src/test/data/rss20.xml?splitEntries=true&amp;amp;consumer.delay=100&amp;quot;) .marshal().rss().filter().xpath(&amp;quot;//item/title[contains(.,&amp;#39;Camel&amp;#39;)]&amp;quot;).to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Query parameters</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>If the URL for the RSS feed uses query parameters, this component will understand them as well, for example if the feed uses <code>alt=rss</code>, then you can for example do<br clear="none"> <code>from("rss:<a shape="rect" class="external-link" href="http://someserver.com/feeds/posts/default?alt=rss&amp;splitEntries=false&amp;consumer.delay=1000" rel="nofollow">http://someserver.com/feeds/posts/default?alt=rss&amp;splitEntries=false&amp;consumer.delay=1000</a>").to("bean:rss");</code></p>
 </div>
</div><h3 id="BookInOnePage-Filteringentries">Filtering entries</h3><p>You can filter out entries quite easily using XPath, as shown in the data format section above. You can also exploit Camel's <a shape="rect" href="bean-integration.html">Bean Integration</a> to implement your own conditions. For instance, a filter equivalent to the XPath example above would be:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // only entries with Camel in the title will get through the filter from(&amp;quot;rss:file:src/test/data/rss20.xml?splitEntries=true&amp;amp;consumer.delay=100&amp;quot;). filter().method(&amp;quot;myFilterBean&amp;quot;, &amp;quot;titleContainsCamel&amp;quot;).to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>The custom bean for this would be:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public static class FilterBean { public boolean titleContainsCamel(@Body SyndFeed feed) { SyndEntry firstEntry = (SyndEntry) feed.getEntries().get(0); return firstEntry.getTitle().contains(&amp;quot;Camel&amp;quot;); } } </script> 
  </div>
 </div><h3 id="BookInOnePage-SeeAlso.74">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="atom.html">Atom</a></li></ul><div class="error">
 <span class="error">Unable to render {include}</span> The included page could not be found.
</div><h2 id="BookInOnePage-SEDAComponent">SEDA Component</h2><p>The <strong>seda:</strong> component provides asynchronous <a shape="rect" class="external-link" href="http://www.eecs.harvard.edu/~mdw/proj/seda/" rel="nofollow">SEDA</a> behavior, so that messages are exchanged on a <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/BlockingQueue.html" rel="nofollow">BlockingQueue</a> and consumers are invoked in a separate thread from the producer.</p><p>Note that queues are only visible within a <em>single</em> <a shape="rect" href="camelcontext.html">CamelContext</a>. If you want to communicate across <code>CamelContext</code> instances (for example, communicating between Web applications), see the <a shape="rect" href="vm.html">VM</a> component.</p><p>This component does not implement any kind of persistence or recovery, if the VM terminates while messages are yet to be processed. If you need persistence, reliability or distributed SEDA, try using either <a shape="rect" href="jms.html">JMS</a> or <a shape="rect" href="activemq.html">ActiveMQ</a>.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Synchronous</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The <a shape="rect" href="direct.html">Direct</a> component provides synchronous invocation of any consumers when a producer sends a message exchange.</p>
 </div>
</div><h3 id="BookInOnePage-URIformat.57">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">seda:someName[?options] </script> 
 </div>
</div><p>Where <strong>someName</strong> can be any string that uniquely identifies the endpoint within the current <a shape="rect" href="camelcontext.html">CamelContext</a>.</p><p>You can append query options to the URI in the following format: <code>?option=value&amp;option=value&amp;&#8230;</code></p><h3 id="BookInOnePage-Options.65">Options</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Since</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>size</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The maximum capacity of the SEDA queue (i.e., the number of messages it can hold). The default value in Camel 2.2 or older is <code>1000</code>. From Camel 2.3 onwards, the size is unbounded by default. <strong>Notice:</strong> Mind if you use this option, then its the first endpoint being created with the queue name, that determines the size. To make sure all endpoints use same size, then configure the size option on all of them, or the first endpoint being created. From <strong>Camel 2.11</strong> onwards, a validation is taken place to ensure if using mixed queue sizes for the same queue name, Camel would detect this and fail creating the endpoint.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>concurrentConsumers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Number of concurrent threads processing exchanges.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>waitForTaskToComplete</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>IfReplyExpected</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Option to specify whether the caller should wait for the async task to complete or not before continuing. The following three options are supported: <code>Always</code>, <code>Never</code> or <code>IfReplyExpected</code>. The first two values are self-explanatory. The last value, <code>IfReplyExpected</code>, will only wait if the message is <a shape="rect" href="request-reply.html">Request Reply</a> based. The default option is <code>IfReplyExpected</code>. See more information about <a shape="rect" href="async.html">Async</a> messaging.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>timeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>30000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Timeout (in milliseconds) before a SEDA producer will stop waiting for an asynchronous task to complete. See <code>waitForTaskToComplete</code> and <a shape="rect" href="async.html">Async</a> for more details. In <strong>Camel 2.2</strong> you can now disable timeout by using 0 or a negative value.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>multipleConsumers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>2.2</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies whether multiple consumers are allowed. If enabled, you can use <a shape="rect" href="seda.html">SEDA</a> for <a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern" rel="nofollow">Publish-Subscribe</a> messaging. That is, you can send a message to the SEDA queue and have each consumer receive a copy of the message. When enabled, this option should be specified on every consumer endpoint.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>limitConcurrentConsumers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>2.3</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether to limit the number of <code>concurrentConsumers</code> to the maximum of <code>500</code>. By default, an exception will be thrown if a SEDA endpoint is configured with a greater number. You can disable that check by turning this option off.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>blockWhenFull</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>2.9</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether a thread that sends messages to a full SEDA queue will block until the queue's capacity is no longer exhausted. By default, an exception will be thrown stating that the queue is full. By enabling this option, the calling thread will instead block and wait until the message can be accepted.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>queueSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>2.9</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Component only:</strong> The maximum default size (capacity of the number of messages it can hold) of the SEDA queue. This option is used if <code>size</code> is not in use.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>pollTimeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>2.9.3</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em>Consumer only</em> &#8211; The timeout used when polling. When a timeout occurs, the consumer can check whether it is allowed to continue running. Setting a lower value allows the consumer to react more quickly upon shutdown.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>purgeWhenStopping</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>2.11.1</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether to purge the task queue when stopping the consumer/route. This allows to stop faster, as any pending messages on the queue is discarded.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>queue</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>2.12.0</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>null</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Define the queue instance which will be used by seda endpoint</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>queueFactory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>2.12.0</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>null</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Define the QueueFactory which could create the queue for the seda endpoint</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>failIfNoConsumers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>2.12.0</strong></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>false</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether the producer should fail by throwing an exception, when sending to a SEDA queue with no active consumers.</p><p>Only one of the options discardIfNoConsumers and failIfNoConsumers can be enabled at the same time.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>discardIfNoConsumers</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>2.16</strong></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether the producer should discard the message (do not add the message to the queue), when sending to a SEDA queue with no active consumers.</p><p><span>Only one of the options discardIfNoConsumers and failIfNoConsumers can be enabled at the same time.</span></p></td></tr></tbody></table>
</div><h3 id="BookInOnePage-ChoosingBlockingQueueimplementation">Choosing BlockingQueue implementation</h3><p><strong>Available as of Camel 2.12</strong></p><p>By default, the SEDA component always intantiates LinkedBlockingQueue, but you can use different implementation, you can reference your own BlockingQueue implementation, in this case the size option is not used</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;arrayQueue&amp;quot; class=&amp;quot;java.util.ArrayBlockingQueue&amp;quot;&amp;gt; &amp;lt;constructor-arg index=&amp;quot;0&amp;quot; value=&amp;quot;10&amp;quot; &amp;gt;&amp;lt;!-- size --&amp;gt; &amp;lt;constructor-arg index=&amp;quot;1&amp;quot; value=&amp;quot;true&amp;quot; &amp;gt;&amp;lt;!-- fairness --&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;!-- ... and later --&amp;gt; &amp;lt;from&amp;gt;seda:array?queue=#arrayQueue&amp;lt;/from&amp;gt; </script> 
 </div>
</div><p>Or you can reference a BlockingQueueFactory implementation, 3 implementations are provided LinkedBlockingQueueFactory, ArrayBlockingQueueFactory and PriorityBlockingQueueFactory:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;priorityQueueFactory&amp;quot; class=&amp;quot;org.apache.camel.component.seda.PriorityBlockingQueueFactory&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;comparator&amp;quot;&amp;gt; &amp;lt;bean class=&amp;quot;org.apache.camel.demo.MyExchangeComparator&amp;quot; /&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;!-- ... and later --&amp;gt; &amp;lt;from&amp;gt;seda:priority?queueFactory=#priorityQueueFactory&amp;amp;size=100&amp;lt;/from&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-UseofRequestReply">Use of Request Reply</h3><p>The <a shape="rect" href="seda.html">SEDA</a> component supports using <a shape="rect" href="request-reply.html">Request Reply</a>, where the caller will wait for the <a shape="rect" href="async.html">Async</a> route to complete. For instance:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;mina:tcp://0.0.0.0:9876?textline=true&amp;amp;sync=true&amp;quot;).to(&amp;quot;seda:input&amp;quot;); from(&amp;quot;seda:input&amp;quot;).to(&amp;quot;bean:processInput&amp;quot;).to(&amp;quot;bean:createResponse&amp;quot;); </script> 
 </div>
</div><p>In the route above, we have a TCP listener on port 9876 that accepts incoming requests. The request is routed to the <code>seda:input</code> queue. As it is a <a shape="rect" href="request-reply.html">Request Reply</a> message, we wait for the response. When the consumer on the <code>seda:input</code> queue is complete, it copies the response to the original message response.</p><div class="confluence-information-macro confluence-information-macro-note">
 <p class="title">until 2.2: Works only with 2 endpoints</p>
 <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Using <a shape="rect" href="request-reply.html">Request Reply</a> over <a shape="rect" href="seda.html">SEDA</a> or <a shape="rect" href="vm.html">VM</a> only works with 2 endpoints. You <strong>cannot</strong> chain endpoints by sending to A -&gt; B -&gt; C etc. Only between A -&gt; B. The reason is the implementation logic is fairly simple. To support 3+ endpoints makes the logic much more complex to handle ordering and notification between the waiting threads properly.</p>
  <p>This has been improved in <strong>Camel 2.3</strong> onwards, which allows you to chain as many endpoints as you like.</p>
 </div>
</div><h3 id="BookInOnePage-Concurrentconsumers">Concurrent consumers</h3><p>By default, the SEDA endpoint uses a single consumer thread, but you can configure it to use concurrent consumer threads. So instead of thread pools you can use:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;seda:stageName?concurrentConsumers=5&amp;quot;).process(...) </script> 
 </div>
</div><p>As for the difference between the two, note a <em>thread pool</em> can increase/shrink dynamically at runtime depending on load, whereas the number of concurrent consumers is always fixed.</p><h3 id="BookInOnePage-Threadpools">Thread pools</h3><p>Be aware that adding a thread pool to a SEDA endpoint by doing something like:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;seda:stageName&amp;quot;).thread(5).process(...) </script> 
 </div>
</div><p>Can wind up with two <code>BlockQueues</code>: one from the SEDA endpoint, and one from the workqueue of the thread pool, which may not be what you want. Instead, you might wish to configure a <a shape="rect" href="direct.html">Direct</a> endpoint with a thread pool, which can process messages both synchronously and asynchronously. For example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:stageName&amp;quot;).thread(5).process(...) </script> 
 </div>
</div><p>You can also directly configure number of threads that process messages on a SEDA endpoint using the <code>concurrentConsumers</code> option.</p><h3 id="BookInOnePage-Sample.2">Sample</h3><p>In the route below we use the SEDA queue to send the request to this async queue to be able to send a fire-and-forget message for further processing in another thread, and return a constant reply in this thread to the original caller.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public void configure() throws Exception { from(&amp;quot;direct:start&amp;quot;) // send it to the seda queue that is async .to(&amp;quot;seda:next&amp;quot;) // return a constant response .transform(constant(&amp;quot;OK&amp;quot;)); from(&amp;quot;seda:next&amp;quot;).to(&amp;quot;mock:result&amp;quot;); } </script> 
  </div>
 </div>Here we send a Hello World message and expects the reply to be OK.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> Object out = template.requestBody(&amp;quot;direct:start&amp;quot;, &amp;quot;Hello World&amp;quot;); assertEquals(&amp;quot;OK&amp;quot;, out); </script> 
  </div>
 </div>The "Hello World" message will be consumed from the SEDA queue from another thread for further processing. Since this is from a unit test, it will be sent to a <code>mock</code> endpoint where we can do assertions in the unit test.<h3 id="BookInOnePage-UsingmultipleConsumers">Using multipleConsumers</h3><p><strong>Available as of Camel 2.2</strong></p><p>In this example we have defined two consumers and registered them as spring beans.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- define the consumers as spring beans --&amp;gt; &amp;lt;bean id=&amp;quot;consumer1&amp;quot; class=&amp;quot;org.apache.camel.spring.example.FooEventConsumer&amp;quot;/&amp;gt; &amp;lt;bean id=&amp;quot;consumer2&amp;quot; class=&amp;quot;org.apache.camel.spring.example.AnotherFooEventConsumer&amp;quot;/&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;!-- define a shared endpoint which the consumers can refer to instead of using url --&amp;gt; &amp;lt;endpoint id=&amp;quot;foo&amp;quot; uri=&amp;quot;seda:foo?multipleConsumers=true&amp;quot;/&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
  </div>
 </div>Since we have specified <strong>multipleConsumers=true</strong> on the seda foo endpoint we can have those two consumers receive their own copy of the message as a kind of pub-sub style messaging.<p>As the beans are part of an unit test they simply send the message to a mock endpoint, but notice how we can use @Consume to consume from the seda queue.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> public class FooEventConsumer { @EndpointInject(uri = &amp;quot;mock:result&amp;quot;) private ProducerTemplate destination; @Consume(ref = &amp;quot;foo&amp;quot;) public void doSomething(String body) { destination.sendBody(&amp;quot;foo&amp;quot; + body); } } </script> 
  </div>
 </div><h3 id="BookInOnePage-Extractingqueueinformation.">Extracting queue information.</h3><p>If needed, information such as queue size, etc. can be obtained without using JMX in this fashion:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">SedaEndpoint seda = context.getEndpoint(&amp;quot;seda:xxxx&amp;quot;); int size = seda.getExchanges().size(); </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.75">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="vm.html">VM</a></li><li><a shape="rect" href="disruptor.html">Disruptor</a></li><li><a shape="rect" href="direct.html">Direct</a></li><li><a shape="rect" href="async.html">Async</a></li></ul><h2 id="BookInOnePage-ServletComponent">Servlet Component</h2><p>The <strong>servlet:</strong> component provides HTTP based <a shape="rect" href="endpoint.html">endpoints</a> for consuming HTTP requests that arrive at a HTTP endpoint that is bound to a published Servlet.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-servlet&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;\!-\- use the same version as your Camel core version \--&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Stream</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Servlet is stream based, which means the input it receives is submitted to Camel as a stream. That means you will only be able to read the content of the stream <strong>once</strong>. If you find a situation where the message body appears to be empty or you need to access the data multiple times (eg: doing multicasting, or redelivery error handling) you should use <a shape="rect" href="stream-caching.html">Stream caching</a> or convert the message body to a <code>String</code> which is safe to be read multiple times.</p>
 </div>
</div><h3 id="BookInOnePage-URIformat.58">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">servlet://relative_path[?options] </script> 
 </div>
</div><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.66">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpBindingRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Reference to an <code>org.apache.camel.component.http.HttpBinding</code> in the <a shape="rect" href="registry.html">Registry</a>. A <code>HttpBinding</code> implementation can be used to customize how to write a response.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code><span>httpBinding</span></code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>null</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> <span>Reference to an </span><code>org.apache.camel.component.http.HttpBinding</code><span> in the </span><a shape="rect" href="registry.html">Registry</a><span>. A </span><code>HttpBinding</code><span> implementation can be used to customize how to write a response.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>matchOnUriPrefix</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether or not the <code>CamelServlet</code> should try to find a target consumer by matching the URI prefix, if no exact match is found.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>servletName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelServlet</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the servlet name that the servlet endpoint will bind to. This name should match the name you define in <code>web.xml</code> file.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code><span style="color: rgb(0,0,0);">httpMethodRestrict</span></code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>null</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.11:</strong><span style="color: rgb(0,0,0);">&#160;</span><strong>Consumer only</strong><span style="color: rgb(0,0,0);">: Used to only allow consuming if the HttpMethod matches, such as GET/POST/PUT etc.&#160;</span><span style="color: rgb(0,0,0);">From&#160;</span><strong>Camel 2.15 </strong><span style="color: rgb(0,0,0);">onwards multiple methods can be specified separated by comma.</span></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-MessageHeaders.17">Message Headers</h3><p>Camel will apply the same Message Headers as the <a shape="rect" href="http.html">HTTP</a> component.</p><p>Camel will also populate <strong>all</strong> <code>request.parameter</code> and <code>request.headers</code>. For example, if a client request has the URL, <code><a shape="rect" class="external-link" href="http://myserver/myserver?orderid=123" rel="nofollow">http://myserver/myserver?orderid=123</a></code>, the exchange will contain a header named <code>orderid</code> with the value 123.</p><h3 id="BookInOnePage-Usage.7">Usage</h3><p>You can consume only from endpoints generated by the Servlet component. Therefore, it should be used only as input into your Camel routes. To issue HTTP requests against other HTTP endpoints, use the <a shape="rect" href="http.html">HTTP Component</a></p><h3 id="BookInOnePage-UsingServlet3.0AsyncMode">Using Servlet 3.0 Async Mode</h3><p><strong>Available as of Camel 2.18</strong></p><p>You can configure the servlet with an init-param to turn on async mode when using a Servlet 3.x container. There is a sample XML configuration below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;servlet&amp;gt; &amp;lt;servlet-name&amp;gt;CamelServlet&amp;lt;/servlet-name&amp;gt; &amp;lt;display-name&amp;gt;Camel Http Transport Servlet&amp;lt;/display-name&amp;gt; &amp;lt;servlet-class&amp;gt;org.apache.camel.component.servlet.CamelHttpTransportServlet&amp;lt;/servlet-class&amp;gt; &amp;lt;init-param&amp;gt; &amp;lt;param-name&amp;gt;async&amp;lt;/param-name&amp;gt; &amp;lt;param-value&amp;gt;true&amp;lt;/param-value&amp;gt; &amp;lt;/init-param&amp;gt; &amp;lt;load-on-startup&amp;gt;1&amp;lt;/load-on-startup&amp;gt; &amp;lt;async-supported&amp;gt;true&amp;lt;/async-supported&amp;gt; &amp;lt;/servlet&amp;gt;</script> 
 </div>
</div><p>&#160;</p><h3 id="BookInOnePage-PuttingCamelJARsintheappserverbootclasspath">Putting Camel JARs in the app server boot classpath</h3><p>If you put the Camel JARs such as <code>camel-core</code>, <code>camel-servlet</code>, etc. in the boot classpath of your application server (eg usually in its lib directory), then mind that the servlet mapping list is now shared between multiple deployed Camel application in the app server.</p><p>Mind that putting Camel JARs in the boot classpath of the application server is generally not best practice!</p><p>So in those situations you <strong>must</strong> define a custom and unique servlet name in each of your Camel application, eg in the <code>web.xml</code> define:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;servlet&amp;gt; &amp;lt;servlet-name&amp;gt;MyServlet&amp;lt;/servlet-name&amp;gt; &amp;lt;servlet-class&amp;gt;org.apache.camel.component.servlet.CamelHttpTransportServlet&amp;lt;/servlet-class&amp;gt; &amp;lt;load-on-startup&amp;gt;1&amp;lt;/load-on-startup&amp;gt; &amp;lt;/servlet&amp;gt; &amp;lt;servlet-mapping&amp;gt; &amp;lt;servlet-name&amp;gt;MyServlet&amp;lt;/servlet-name&amp;gt; &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt; &amp;lt;/servlet-mapping&amp;gt; </script> 
 </div>
</div><p>And in your Camel endpoints then include the servlet name as well</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;servlet://foo?servletName=MyServlet&amp;quot;/&amp;gt; ... &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>From <strong>Camel 2.11</strong> onwards Camel will detect this duplicate and fail to start the application. You can control to ignore this duplicate by setting the servlet init-parameter ignoreDuplicateServletName to true as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;servlet&amp;gt; &amp;lt;servlet-name&amp;gt;CamelServlet&amp;lt;/servlet-name&amp;gt; &amp;lt;display-name&amp;gt;Camel Http Transport Servlet&amp;lt;/display-name&amp;gt; &amp;lt;servlet-class&amp;gt;org.apache.camel.component.servlet.CamelHttpTransportServlet&amp;lt;/servlet-class&amp;gt; &amp;lt;init-param&amp;gt; &amp;lt;param-name&amp;gt;ignoreDuplicateServletName&amp;lt;/param-name&amp;gt; &amp;lt;param-value&amp;gt;true&amp;lt;/param-value&amp;gt; &amp;lt;/init-param&amp;gt; &amp;lt;/servlet&amp;gt; </script> 
 </div>
</div><p>But its <strong>strongly advised</strong> to use unique servlet-name for each Camel application to avoid this duplication clash, as well any unforeseen side-effects.</p><h3 id="BookInOnePage-Sample.3">Sample</h3><div class="confluence-information-macro confluence-information-macro-information">
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>From Camel 2.7 onwards it's easier to use <a shape="rect" href="servlet.html">Servlet</a> in Spring web applications. See <a shape="rect" href="servlet-tomcat-example.html">Servlet Tomcat Example</a> for details.</p>
 </div>
</div><p>In this sample, we define a route that exposes a HTTP service at <code><a shape="rect" class="external-link" href="http://localhost:8080/camel/services/hello" rel="nofollow">http://localhost:8080/camel/services/hello</a></code>.<br clear="none"> First, you need to publish the <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-servlet/src/main/java/org/apache/camel/component/servlet/CamelHttpTransportServlet.java">CamelHttpTransportServlet</a> through the normal Web Container, or OSGi Service.<br clear="none"> Use the <code>Web.xml</code> file to publish the <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-servlet/src/main/java/org/apache/camel/component/servlet/CamelHttpTransportServlet.java">CamelHttpTransportServlet</a> as follows:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;web-app&amp;gt; &amp;lt;servlet&amp;gt; &amp;lt;servlet-name&amp;gt;CamelServlet&amp;lt;/servlet-name&amp;gt; &amp;lt;display-name&amp;gt;Camel Http Transport Servlet&amp;lt;/display-name&amp;gt; &amp;lt;servlet-class&amp;gt;org.apache.camel.component.servlet.CamelHttpTransportServlet&amp;lt;/servlet-class&amp;gt; &amp;lt;/servlet&amp;gt; &amp;lt;servlet-mapping&amp;gt; &amp;lt;servlet-name&amp;gt;CamelServlet&amp;lt;/servlet-name&amp;gt; &amp;lt;url-pattern&amp;gt;/services/*&amp;lt;/url-pattern&amp;gt; &amp;lt;/servlet-mapping&amp;gt; &amp;lt;/web-app&amp;gt; </script> 
  </div>
 </div>Then you can define your route as follows:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;servlet:hello?matchOnUriPrefix=true&amp;quot;).process(new Processor() { public void process(Exchange exchange) throws Exception { String contentType = exchange.getIn().getHeader(Exchange.CONTENT_TYPE, String.class); String path = exchange.getIn().getHeader(Exchange.HTTP_URI, String.class); path = path.substring(path.lastIndexOf(&amp;quot;/&amp;quot;)); assertEquals(&amp;quot;Get a wrong content type&amp;quot;, CONTENT_TYPE, contentType); // assert camel http header String charsetEncoding = exchange.getIn().getHeader(Exchange.HTTP_CHARACTER_ENCODING, String.class); assertEquals(&amp;quot;Get a wrong charset name from the message heaer&amp;quot;, &amp;quot;UTF-8&amp;quot;, charsetEncoding); // assert exchange charset assertEquals(&amp;quot;Get a wrong charset naem from the exchange property&amp;quot;, &amp;quot;UTF-8&amp;quot;, exchange.getProperty(Exchange.CHARSET_NAME)); exchange.getOut().setHeader(Exchange.CONTENT_TYPE, contentType + &amp;quot;; charset=UTF-8&amp;quot;); exchange.getOut().setHeader(&amp;quot;PATH&amp;quot;, path); exchange.getOut().setBody(&amp;quot;&amp;lt;b&amp;gt;Hello World&amp;lt;/b&amp;gt;&amp;quot;); } }); </script> 
  </div>
 </div><div class="confluence-information-macro confluence-information-macro-note">
 <p class="title">Specify the relative path for camel-servlet endpoint</p>
 <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Since we are binding the Http transport with a published servlet, and we don't know the servlet's application context path, the <code>camel-servlet</code> endpoint uses the relative path to specify the endpoint's URL. A client can access the <code>camel-servlet</code> endpoint through the servlet publish address: <code>("http://localhost:8080/camel/services") + RELATIVE_PATH("/hello")</code>.</p>
 </div>
</div><h4 id="BookInOnePage-SamplewhenusingSpring3.x">Sample when using Spring 3.x</h4><p>See <a shape="rect" href="servlet-tomcat-example.html">Servlet Tomcat Example</a></p><h4 id="BookInOnePage-SamplewhenusingSpring2.x">Sample when using Spring 2.x</h4><p>When using the Servlet component in a Camel/Spring application it's often required to load the Spring ApplicationContext <em>after</em> the Servlet component has started. This can be accomplished by using Spring's <code>ContextLoaderServlet</code> instead of <code>ContextLoaderListener</code>. In that case you'll need to start <code>ContextLoaderServlet</code> after <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-servlet/src/main/java/org/apache/camel/component/servlet/CamelHttpTransportServlet.java">CamelHttpTransportServlet</a> like this:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;web-app&amp;gt; &amp;lt;servlet&amp;gt; &amp;lt;servlet-name&amp;gt;CamelServlet&amp;lt;/servlet-name&amp;gt; &amp;lt;servlet-class&amp;gt; org.apache.camel.component.servlet.CamelHttpTransportServlet &amp;lt;/servlet-class&amp;gt; &amp;lt;load-on-startup&amp;gt;1&amp;lt;/load-on-startup&amp;gt; &amp;lt;/servlet&amp;gt; &amp;lt;servlet&amp;gt; &amp;lt;servlet-name&amp;gt;SpringApplicationContext&amp;lt;/servlet-name&amp;gt; &amp;lt;servlet-class&amp;gt; org.springframework.web.context.ContextLoaderServlet &amp;lt;/servlet-class&amp;gt; &amp;lt;load-on-startup&amp;gt;2&amp;lt;/load-on-startup&amp;gt; &amp;lt;/servlet&amp;gt; &amp;lt;web-app&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-SamplewhenusingOSGi">Sample when using OSGi</h4><p>From <strong>Camel 2.6.0</strong>, you can publish the <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-servlet/src/main/java/org/apache/camel/component/servlet/CamelHttpTransportServlet.java">CamelHttpTransportServlet</a> as an OSGi service with help of SpringDM like this.
 </p><div class="error">
  <span class="error">Error formatting macro: snippet: java.lang.IndexOutOfBoundsException: Index: 20, Size: 20</span> 
 </div>Then use this service in your camel route like this:
 <div class="error">
  <span class="error">Error formatting macro: snippet: java.lang.IndexOutOfBoundsException: Index: 20, Size: 20</span> 
 </div>For versions prior to Camel 2.6 you can use an <code>Activator</code> to publish the <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-servlet/src/main/java/org/apache/camel/component/servlet/CamelHttpTransportServlet.java">CamelHttpTransportServlet</a> on the OSGi platform
 <div class="error">
  <span class="error">Error formatting macro: snippet: java.lang.IndexOutOfBoundsException: Index: 20, Size: 20</span> 
 </div><h3 id="BookInOnePage-SeeAlso.76">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="servlet-tomcat-example.html">Servlet Tomcat Example</a></li><li><a shape="rect" href="servlet-tomcat-no-spring-example.html">Servlet Tomcat No Spring Example</a></li><li><a shape="rect" href="http.html">HTTP</a></li><li><a shape="rect" href="jetty.html">Jetty</a></li></ul><h2 id="BookInOnePage-ShiroSecurityComponent">Shiro Security Component</h2><p><strong>Available as of Camel 2.5</strong></p><p>The <strong>shiro-security</strong> component in Camel is a security focused component, based on the Apache Shiro security project.</p><p>Apache Shiro is a powerful and flexible open-source security framework that cleanly handles authentication, authorization, enterprise session management and cryptography. The objective of the Apache Shiro project is to provide the most robust and comprehensive application security framework available while also being very easy to understand and extremely simple to use.</p><p>This camel shiro-security component allows authentication and authorization support to be applied to different segments of a camel route.</p><p>Shiro security is applied on a route using a Camel Policy. A Policy in Camel utilizes a strategy pattern for applying interceptors on Camel Processors. It offering the ability to apply cross-cutting concerns (for example. security, transactions etc) on sections/segments of a camel route.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-shiro&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-ShiroSecurityBasics">Shiro Security Basics</h3><p>To employ Shiro security on a camel route, a ShiroSecurityPolicy object must be instantiated with security configuration details (including users, passwords, roles etc). This object must then be applied to a camel route. This ShiroSecurityPolicy Object may also be registered in the Camel registry (JNDI or ApplicationContextRegistry) and then utilized on other routes in the Camel Context.</p><p>Configuration details are provided to the ShiroSecurityPolicy using an Ini file (properties file) or an Ini object. The Ini file is a standard Shiro configuration file containing user/role details as shown below</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">[users] # user &amp;#39;ringo&amp;#39; with password &amp;#39;starr&amp;#39; and the &amp;#39;sec-level1&amp;#39; role ringo = starr, sec-level1 george = harrison, sec-level2 john = lennon, sec-level3 paul = mccartney, sec-level3 [roles] # &amp;#39;sec-level3&amp;#39; role has all permissions, indicated by the # wildcard &amp;#39;*&amp;#39; sec-level3 = * # The &amp;#39;sec-level2&amp;#39; role can do anything with access of permission # readonly (*) to help sec-level2 = zone1:* # The &amp;#39;sec-level1&amp;#39; role can do anything with access of permission # readonly sec-level1 = zone1:readonly:* </script> 
 </div>
</div><h3 id="BookInOnePage-InstantiatingaShiroSecurityPolicyObject">Instantiating a ShiroSecurityPolicy Object</h3><p>A ShiroSecurityPolicy object is instantiated as follows</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> private final String iniResourcePath = &amp;quot;classpath:shiro.ini&amp;quot;; private final byte[] passPhrase = { (byte) 0x08, (byte) 0x09, (byte) 0x0A, (byte) 0x0B, (byte) 0x0C, (byte) 0x0D, (byte) 0x0E, (byte) 0x0F, (byte) 0x10, (byte) 0x11, (byte) 0x12, (byte) 0x13, (byte) 0x14, (byte) 0x15, (byte) 0x16, (byte) 0x17}; List&amp;lt;permission&amp;gt; permissionsList = new ArrayList&amp;lt;permission&amp;gt;(); Permission permission = new WildcardPermission(&amp;quot;zone1:readwrite:*&amp;quot;); permissionsList.add(permission); final ShiroSecurityPolicy securityPolicy = new ShiroSecurityPolicy(iniResourcePath, passPhrase, true, permissionsList); </script> 
 </div>
</div><h3 id="BookInOnePage-ShiroSecurityPolicyOptions">ShiroSecurityPolicy Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default Value </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Type </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>iniResourcePath or ini</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>none</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Resource String or Ini Object </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> A mandatory Resource String for the iniResourcePath or an instance of an Ini object must be passed to the security policy. Resources can be acquired from the file system, classpath, or URLs when prefixed with "file:, classpath:, or url:" respectively. For e.g "classpath:shiro.ini" </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>passPhrase</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>An AES 128 based key</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> byte[] </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> A passPhrase to decrypt ShiroSecurityToken(s) sent along with Message Exchanges </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>alwaysReauthenticate</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>true</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> boolean </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Setting to ensure re-authentication on every individual request. If set to false, the user is authenticated and locked such than only requests from the same user going forward are authenticated. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>permissionsList</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>none</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> List&lt;Permission&gt; </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> A List of permissions required in order for an authenticated user to be authorized to perform further action i.e continue further on the route. If no Permissions list or Roles List (see below) is provided to the ShiroSecurityPolicy object, then authorization is deemed as not required. Note that the default is that authorization is granted if any of the Permission Objects in the list are applicable. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>rolesList</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>none</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> List&lt;String&gt; </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.13:</strong> A List of roles required in order for an authenticated user to be authorized to perform further action i.e continue further on the route. If no roles list or permissions list (see above) is provided to the ShiroSecurityPolicy object, then authorization is deemed as not required. Note that the default is that authorization is granted if any of the roles in the list are applicable. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>cipherService</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>AES</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> org.apache.shiro.crypto.CipherService </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Shiro ships with AES &amp; Blowfish based CipherServices. You may use one these or pass in your own Cipher implementation </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>base64</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>boolean</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.12:</strong> To use base64 encoding for the security token header, which allows transferring the header over <a shape="rect" href="jms.html">JMS</a> etc. This option must also be set on <code>ShiroSecurityTokenInjector</code> as well. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>allPermissionsRequired</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>boolean</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.13:</strong> The default is that authorization is granted if any of the Permission Objects in the permissionsList parameter are applicable. Set this to true to require all of the Permissions to be met. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>allRolesRequired</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>boolean</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Camel 2.13:</strong> The default is that authorization is granted if any of the roles in the rolesList parameter are applicable. Set this to true to require all of the roles to be met. </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-ApplyingShiroAuthenticationonaCamelRoute">Applying Shiro Authentication on a Camel Route</h3><p>The ShiroSecurityPolicy, tests and permits incoming message exchanges containing a encrypted SecurityToken in the Message Header to proceed further following proper authentication. The SecurityToken object contains a Username/Password details that are used to determine where the user is a valid user.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> protected RouteBuilder createRouteBuilder() throws Exception { final ShiroSecurityPolicy securityPolicy = new ShiroSecurityPolicy(&amp;quot;classpath:shiro.ini&amp;quot;, passPhrase); return new RouteBuilder() { public void configure() { onException(UnknownAccountException.class). to(&amp;quot;mock:authenticationException&amp;quot;); onException(IncorrectCredentialsException.class). to(&amp;quot;mock:authenticationException&amp;quot;); onException(LockedAccountException.class). to(&amp;quot;mock:authenticationException&amp;quot;); onException(AuthenticationException.class). to(&amp;quot;mock:authenticationException&amp;quot;); from(&amp;quot;direct:secureEndpoint&amp;quot;). to(&amp;quot;log:incoming payload&amp;quot;). policy(securityPolicy). to(&amp;quot;mock:success&amp;quot;); } }; } </script> 
 </div>
</div><h3 id="BookInOnePage-ApplyingShiroAuthorizationonaCamelRoute">Applying Shiro Authorization on a Camel Route</h3><p>Authorization can be applied on a camel route by associating a Permissions List with the ShiroSecurityPolicy. The Permissions List specifies the permissions necessary for the user to proceed with the execution of the route segment. If the user does not have the proper permission set, the request is not authorized to continue any further.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> protected RouteBuilder createRouteBuilder() throws Exception { final ShiroSecurityPolicy securityPolicy = new ShiroSecurityPolicy(&amp;quot;./src/test/resources/securityconfig.ini&amp;quot;, passPhrase); return new RouteBuilder() { public void configure() { onException(UnknownAccountException.class). to(&amp;quot;mock:authenticationException&amp;quot;); onException(IncorrectCredentialsException.class). to(&amp;quot;mock:authenticationException&amp;quot;); onException(LockedAccountException.class). to(&amp;quot;mock:authenticationException&amp;quot;); onException(AuthenticationException.class). to(&amp;quot;mock:authenticationException&amp;quot;); from(&amp;quot;direct:secureEndpoint&amp;quot;). to(&amp;quot;log:incoming payload&amp;quot;). policy(securityPolicy). to(&amp;quot;mock:success&amp;quot;); } }; } </script> 
 </div>
</div><h3 id="BookInOnePage-CreatingaShiroSecurityTokenandinjectingitintoaMessageExchange">Creating a ShiroSecurityToken and injecting it into a Message Exchange</h3><p>A ShiroSecurityToken object may be created and injected into a Message Exchange using a Shiro Processor called ShiroSecurityTokenInjector. An example of injecting a ShiroSecurityToken using a ShiroSecurityTokenInjector in the client is shown below</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> ShiroSecurityToken shiroSecurityToken = new ShiroSecurityToken(&amp;quot;ringo&amp;quot;, &amp;quot;starr&amp;quot;); ShiroSecurityTokenInjector shiroSecurityTokenInjector = new ShiroSecurityTokenInjector(shiroSecurityToken, passPhrase); from(&amp;quot;direct:client&amp;quot;). process(shiroSecurityTokenInjector). to(&amp;quot;direct:secureEndpoint&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-SendingMessagestoroutessecuredbyaShiroSecurityPolicy">Sending Messages to routes secured by a ShiroSecurityPolicy</h3><p>Messages and Message Exchanges sent along the camel route where the security policy is applied need to be accompanied by a SecurityToken in the Exchange Header. The SecurityToken is an encrypted object that holds a Username and Password. The SecurityToken is encrypted using AES 128 bit security by default and can be changed to any cipher of your choice.</p><p>Given below is an example of how a request may be sent using a ProducerTemplate in Camel along with a SecurityToken</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> @Test public void testSuccessfulShiroAuthenticationWithNoAuthorization() throws Exception { //Incorrect password ShiroSecurityToken shiroSecurityToken = new ShiroSecurityToken(&amp;quot;ringo&amp;quot;, &amp;quot;stirr&amp;quot;); // TestShiroSecurityTokenInjector extends ShiroSecurityTokenInjector TestShiroSecurityTokenInjector shiroSecurityTokenInjector = new TestShiroSecurityTokenInjector(shiroSecurityToken, passPhrase); successEndpoint.expectedMessageCount(1); failureEndpoint.expectedMessageCount(0); template.send(&amp;quot;direct:secureEndpoint&amp;quot;, shiroSecurityTokenInjector); successEndpoint.assertIsSatisfied(); failureEndpoint.assertIsSatisfied(); } </script> 
 </div>
</div><h3 id="BookInOnePage-SendingMessagestoroutessecuredbyaShiroSecurityPolicy(mucheasierfromCamel2.12onwards)">Sending Messages to routes secured by a ShiroSecurityPolicy (much easier from Camel 2.12 onwards)</h3><p>From <strong>Camel 2.12</strong> onwards its even easier as you can provide the subject in two different ways.</p><h4 id="BookInOnePage-UsingShiroSecurityToken">Using ShiroSecurityToken</h4><p>You can send a message to a Camel route with a header of key <code>ShiroSecurityConstants.SHIRO_SECURITY_TOKEN</code> of the type <code>org.apache.camel.component.shiro.security.ShiroSecurityToken</code> that contains the username and password. For example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> ShiroSecurityToken shiroSecurityToken = new ShiroSecurityToken(&amp;quot;ringo&amp;quot;, &amp;quot;starr&amp;quot;); template.sendBodyAndHeader(&amp;quot;direct:secureEndpoint&amp;quot;, &amp;quot;Beatle Mania&amp;quot;, ShiroSecurityConstants.SHIRO_SECURITY_TOKEN, shiroSecurityToken); </script> 
 </div>
</div><p>You can also provide the username and password in two different headers as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> Map&amp;lt;String, Object&amp;gt; headers = new HashMap&amp;lt;String, Object&amp;gt;(); headers.put(ShiroSecurityConstants.SHIRO_SECURITY_USERNAME, &amp;quot;ringo&amp;quot;); headers.put(ShiroSecurityConstants.SHIRO_SECURITY_PASSWORD, &amp;quot;starr&amp;quot;); template.sendBodyAndHeaders(&amp;quot;direct:secureEndpoint&amp;quot;, &amp;quot;Beatle Mania&amp;quot;, headers); </script> 
 </div>
</div><p>When you use the username and password headers, then the ShiroSecurityPolicy in the Camel route will automatic transform those into a single header with key ShiroSecurityConstants.SHIRO_SECURITY_TOKEN with the token. Then token is either a <code>ShiroSecurityToken</code> instance, or a base64 representation as a String (the latter is when you have set base64=true).</p><h2 id="BookInOnePage-SIPComponent">SIP Component</h2><p><strong>Available as of Camel 2.5</strong></p><p>The <strong>sip</strong> component in Camel is a communication component, based on the Jain SIP implementation (available under the JCP license).</p><p>Session Initiation Protocol (SIP) is an IETF-defined signaling protocol, widely used for controlling multimedia communication sessions such as voice and video calls over Internet Protocol (IP).The SIP protocol is an Application Layer protocol designed to be independent of the underlying transport layer; it can run on Transmission Control Protocol (TCP), User Datagram Protocol (UDP) or Stream Control Transmission Protocol (SCTP).</p><p>The Jain SIP implementation supports TCP and UDP only.</p><p>The Camel SIP component <strong>only</strong> supports the SIP Publish and Subscribe capability as described in the <a shape="rect" class="external-link" href="http://www.ietf.org/rfc/rfc3903.txt" rel="nofollow">RFC3903 - Session Initiation Protocol (SIP) Extension for Event</a></p><p>This camel component supports both producer and consumer endpoints.</p><p>Camel SIP Producers (Event Publishers) and SIP Consumers (Event Subscribers) communicate event &amp; state information to each other using an intermediary entity called a SIP Presence Agent (a stateful brokering entity).</p><p>For SIP based communication, a SIP Stack with a listener <strong>must</strong> be instantiated on both the SIP Producer and Consumer (using separate ports if using localhost). This is necessary in order to support the handshakes &amp; acknowledgements exchanged between the SIP Stacks during communication.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-sip&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.59">URI format</h3><p>The URI scheme for a sip endpoint is as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">sip://johndoe@localhost:99999[?options] sips://johndoe@localhost:99999/[?options] </script> 
 </div>
</div><p>This component supports producer and consumer endpoints for both TCP and UDP.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.67">Options</h3><p>The SIP Component offers an extensive set of configuration options &amp; capability to create custom stateful headers needed to propagate state via the SIP protocol.</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>stackName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>NAME_NOT_SET</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Name of the SIP Stack instance associated with an SIP Endpoint.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transport</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>tcp</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Setting for choice of transport potocol. Valid choices are "tcp" or "udp".</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>fromUser</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Username of the message originator. <strong>Mandatory setting unless a registry based custom FromHeader is specified.</strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>fromHost</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Hostname of the message originator. <strong>Mandatory setting unless a registry based FromHeader is specified</strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>fromPort</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Port of the message originator. <strong>Mandatory setting unless a registry based FromHeader is specified</strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>toUser</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Username of the message receiver. <strong>Mandatory setting unless a registry based custom ToHeader is specified.</strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>toHost</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Hostname of the message receiver. <strong>Mandatory setting unless a registry based ToHeader is specified</strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>toPort</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Portname of the message receiver. <strong>Mandatory setting unless a registry based ToHeader is specified</strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxforwards</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>0</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>the number of intermediaries that may forward the message to the message receiver. <strong>Optional setting. May alternatively be set using as registry based MaxForwardsHeader</strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>eventId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Setting for a String based event Id. <strong>Mandatory setting unless a registry based FromHeader is specified</strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>eventHeaderName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Setting for a String based event Id. <strong>Mandatory setting unless a registry based FromHeader is specified</strong></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxMessageSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1048576</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Setting for maximum allowed Message size in bytes.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cacheConnections</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Should connections be cached by the SipStack to reduce cost of connection creation. This is useful if the connection is used for long running conversations.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>This setting is used to determine whether the kind of header (FromHeader,ToHeader etc) that needs to be created for this endpoint</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>contentType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>text</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Setting for contentType can be set to any valid MimeType.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>contentSubType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>xml</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Setting for contentSubType can be set to any valid MimeSubType.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>receiveTimeoutMillis</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>10000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Setting for specifying amount of time to wait for a Response and/or Acknowledgement can be received from another SIP stack</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>useRouterForAllUris</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>This setting is used when requests are sent to the Presence Agent via a proxy.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>msgExpiration</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>3600</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The amount of time a message received at an endpoint is considered valid</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>presenceAgent</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>This setting is used to distingish between a Presence Agent &amp; a consumer. This is due to the fact that the SIP Camel component ships with a basic Presence Agent (for testing purposes only). Consumers have to set this flag to true.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-RegistrybasedOptions.1">Registry based Options</h3><p>SIP requires a number of headers to be sent/received as part of a request. These SIP header can be enlisted in the <a shape="rect" href="registry.html">Registry</a>, such as in the Spring XML file.</p><p>The values that could be passed in, are the following:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>fromHeader</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>a custom Header object containing message originator settings. Must implement the type javax.sip.header.FromHeader</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>toHeader</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>a custom Header object containing message receiver settings. Must implement the type javax.sip.header.ToHeader</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>viaHeaders</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>List of custom Header objects of the type javax.sip.header.ViaHeader. Each ViaHeader containing a proxy address for request forwarding. (Note this header is automatically updated by each proxy when the request arrives at its listener)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>contentTypeHeader</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>a custom Header object containing message content details. Must implement the type javax.sip.header.ContentTypeHeader</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>callIdHeader</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>a custom Header object containing call details. Must implement the type javax.sip.header.CallIdHeader</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxForwardsHeader</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>a custom Header object containing details on maximum proxy forwards. This header places a limit on the viaHeaders possible. Must implement the type javax.sip.header.MaxForwardsHeader</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>eventHeader</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>a custom Header object containing event details. Must implement the type javax.sip.header.EventHeader</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>contactHeader</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>an optional custom Header object containing verbose contact details (email, phone number etc). Must implement the type javax.sip.header.ContactHeader</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>expiresHeader</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>a custom Header object containing message expiration details. Must implement the type javax.sip.header.ExpiresHeader</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>extensionHeader</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>a custom Header object containing user/application specific details. Must implement the type javax.sip.header.ExtensionHeader</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-SendingMessagesto/fromaSIPendpoint">Sending Messages to/from a SIP endpoint</h3><h4 id="BookInOnePage-CreatingaCamelSIPPublisher">Creating a Camel SIP Publisher</h4><p>In the example below, a SIP Publisher is created to send SIP Event publications to <br clear="none"> a user "agent@localhost:5152". This is the address of the SIP Presence Agent which acts as a broker between the SIP Publisher and Subscriber</p><ul><li>using a SIP Stack named client</li><li>using a registry based eventHeader called evtHdrName</li><li>using a registry based eventId called evtId</li><li>from a SIP Stack with Listener set up as user2@localhost:3534</li><li>The Event being published is EVENT_A</li><li>A Mandatory Header called REQUEST_METHOD is set to Request.Publish thereby setting up the endpoint as a Event publisher"</li></ul><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">producerTemplate.sendBodyAndHeader( &amp;quot;sip://agent@localhost:5152?stackName=client&amp;amp;eventHeaderName=evtHdrName&amp;amp;eventId=evtid&amp;amp;fromUser=user2&amp;amp;fromHost=localhost&amp;amp;fromPort=3534&amp;quot;, &amp;quot;EVENT_A&amp;quot;, &amp;quot;REQUEST_METHOD&amp;quot;, Request.PUBLISH); </script> 
 </div>
</div><h4 id="BookInOnePage-CreatingaCamelSIPSubscriber">Creating a Camel SIP Subscriber</h4><p>In the example below, a SIP Subscriber is created to receive SIP Event publications sent to <br clear="none"> a user "johndoe@localhost:5154"</p><ul><li>using a SIP Stack named Subscriber</li><li>registering with a Presence Agent user called agent@localhost:5152</li><li>using a registry based eventHeader called evtHdrName. The evtHdrName contains the Event which is se to "Event_A"</li><li>using a registry based eventId called evtId</li></ul><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">@Override protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { @Override public void configure() throws Exception { // Create PresenceAgent from(&amp;quot;sip://agent@localhost:5152?stackName=PresenceAgent&amp;amp;presenceAgent=true&amp;amp;eventHeaderName=evtHdrName&amp;amp;eventId=evtid&amp;quot;) .to(&amp;quot;mock:neverland&amp;quot;); // Create Sip Consumer(Event Subscriber) from(&amp;quot;sip://johndoe@localhost:5154?stackName=Subscriber&amp;amp;toUser=agent&amp;amp;toHost=localhost&amp;amp;toPort=5152&amp;amp;eventHeaderName=evtHdrName&amp;amp;eventId=evtid&amp;quot;) .to(&amp;quot;log:ReceivedEvent?level=DEBUG&amp;quot;) .to(&amp;quot;mock:notification&amp;quot;); } }; } </script> 
 </div>
</div><p><strong>The Camel SIP component also ships with a Presence Agent that is meant to be used for Testing and Demo purposes only.</strong> An example of instantiating a Presence Agent is given above.</p><p>Note that the Presence Agent is set up as a user agent@localhost:5152 and is capable of communicating with both Publisher as well as Subscriber. It has a separate SIP stackName distinct from Publisher as well as Subscriber. While it is set up as a Camel Consumer, it does not actually send any messages along the route to the endpoint "mock:neverland".</p><h2 id="BookInOnePage-SMPPComponent">SMPP Component</h2><p><strong>CamelSmppFinalStatusAvailable as of Camel 2.2</strong></p><p>This component provides access to an SMSC (Short Message Service Center) over the <a shape="rect" class="external-link" href="http://smsforum.net/SMPP_v3_4_Issue1_2.zip" rel="nofollow">SMPP</a> protocol to send and receive SMS. The <a shape="rect" class="external-link" href="http://jsmpp.org" rel="nofollow">JSMPP</a> library is used for the protocol implementation.</p><p>The Camel component currently operates as an <a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/ESME" rel="nofollow">ESME</a> (External Short Messaging Entity) and not as an SMSC itself.</p><p>The <a shape="rect" class="external-link" href="http://smsrouter.org" rel="nofollow">SMS Router</a> project provides an excellent example of an SMS Router daemon based on the Camel framework, routing messages between JMS queues (ActiveMQ) and the SMPP network. &#160;Run multiple instances in parallel for high-availability.</p><p>Starting with<strong> Camel 2.9</strong>&#160;you are also able to execute ReplaceSm, QuerySm, SubmitMulti, CancelSm and DataSm.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-smpp&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-SMSlimitations">SMS limitations</h3><p>SMS is neither reliable or secure.&#160; Users who require reliable and secure delivery may want to consider using the XMPP or SIP components instead, combined with a smartphone app supporting the chosen protocol.</p><ul><li>Reliability: although the SMPP standard offers a range of feedback mechanisms to indicate errors, non-delivery and confirmation of delivery it is not uncommon for mobile networks to hide or simulate these responses.&#160; For example, some networks automatically send a delivery confirmation for every message even if the destination number is invalid or not switched on.&#160; Some networks silently drop messages if they think they are spam.&#160; Spam detection rules in the network may be very crude, sometimes more than 100 messages per day from a single sender may be considered spam.</li><li>Security: there is basic encryption for the last hop from the radio tower down to the recipient handset.&#160; SMS messages are not encrypted or authenticated in any other part of the network.&#160; Some operators allow staff in retail outlets or call centres to browse through the SMS message histories of their customers.&#160; Message sender identity can be easily forged.&#160; Regulators and even the mobile telephone industry itself has cautioned against the use of SMS in two-factor authentication schemes and other purposes where security is important.</li></ul><p>While the Camel component makes it as easy as possible to send messages to the SMS network, it can not offer an easy solution to these problems.</p><h2 id="BookInOnePage-Datacoding,alphabetandinternationalcharactersets">Data coding, alphabet and international character sets</h2><p>Data coding and alphabet can be specified on a per-message basis.&#160; Default values can be specified for the endpoint.&#160; It is important to understand the relationship between these options and the way the component acts when more than one value is set.</p><p>Data coding is an 8 bit field in the SMPP wire format.</p><p>Alphabet corresponds to bits 0-3 of the data coding field.&#160; For some types of message, where a message class is used (by setting bit 5 of the data coding field), the lower two bits of the data coding field are not interpreted as alphabet and only bits 2 and 3 impact the alphabet.</p><p>Furthermore, current version of the JSMPP library only seems to support bits 2 and 3, assuming that bits 0 and 1 are used for message class.&#160; This is why the Alphabet class in JSMPP doesn't support the value 3 (binary 0011) which indicates ISO-8859-1.</p><p>Although JSMPP provides a representation of the message class parameter, the Camel component doesn't currently provide a way to set it other than manually setting the corresponding bits in the data coding field.</p><p>When setting the data coding field in the outgoing message, the Camel component considers the following values and uses the first one it can find:</p><ul><li>the data coding specified in a header</li><li>the alphabet specified in a header</li><li>the data coding specified in the endpoint configuration (URI parameter)</li></ul><p>Older versions of Camel had bugs in support for international character sets.&#160; This feature only worked when a single encoding was used for all messages and was troublesome when users wanted to change it on a per-message basis.&#160; Users who require this to work should ensure their version of Camel includes the fix for&#160;
 </p><div class="aui-message warning jim-inline-block"> 
  <span class="aui-icon icon-warning"></span>JIRA Issues Macro: com.atlassian.sal.api.net.ResponseStatusException: Unexpected response received. Status code: 404 
 </div> .<p>In addition to trying to send the data coding value to the SMSC, the Camel component also tries to analyze the message body, convert it to a Java String (Unicode) and convert that to a byte array in the corresponding alphabet&#160; When deciding which alphabet to use in the byte array, the Camel SMPP component does not consider the data coding value (header or configuration), it only considers the specified alphabet (from either the header or endpoint parameter).</p><p>If some characters in the String can't be represented in the chosen alphabet, they may be replaced by the question mark ( ? ) symbol.&#160; Users of the API may want to consider checking if their message body can be converted to ISO-8859-1 before passing it to the component and if not, setting the alphabet header to request UCS-2 encoding.&#160; If the alphabet and data coding options are not specified at all then the component may try to detect the required encoding and set the data coding for you.</p><p>The list of alphabet codes are specified in the SMPP specification v3.4, section 5.2.19.&#160; One notable limitation of the SMPP specification is that there is no alphabet code for explicitly requesting use of the GSM 3.38 (7 bit) character set.&#160; Choosing the value 0 for the alphabet selects the SMSC <em>default</em> alphabet, this usually means GSM 3.38 but it is not guaranteed.&#160; The SMPP gateway Nexmo <a shape="rect" class="external-link" href="https://help.nexmo.com/hc/en-us/articles/204015813-How-to-change-the-character-encoding-in-SMPP-" rel="nofollow">actually allows the default to be mapped to any other character set with a control panel option</a>. It is suggested that users check with their SMSC operator to confirm exactly which character set is being used as the default.</p><h3 id="BookInOnePage-Messagesplittingandthrottling">Message splitting and throttling</h3><p>After transforming a message body from a String to a byte array, the Camel component is also responsible for splitting the message into parts (within the 140 byte SMS size limit) before passing it to JSMPP.&#160; This is completed automatically.</p><p>If the GSM 3.38 alphabet is used, the component will pack up to 160 characters into the 140 byte message body.&#160; If an 8 bit character set is used (e.g. ISO-8859-1 for western Europe) then 140 characters will be allowed within the 140 byte message body.&#160; If 16 bit UCS-2 encoding is used then just 70 characters fit into each 140 byte message.</p><p>Some SMSC providers implement throttling rules.&#160; Each part of a message that has been split may be counted separately by the provider's throttling mechanism.&#160; The Camel Throttler component can be useful for throttling messages in the SMPP route before handing them to the SMSC.</p><h3 id="BookInOnePage-URIformat.60">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">smpp://[username@]hostname[:port][?options] smpps://[username@]hostname[:port][?options] </script> 
 </div>
</div><p>If no <strong>username</strong> is provided, then Camel will provide the default value <code>smppclient</code>.<br clear="none"> If no <strong>port</strong> number is provided, then Camel will provide the default value <code>2775</code>.<br clear="none"> <strong>Camel 2.3:</strong> If the protocol name is "smpps", camel-smpp with try to use SSLSocket to init a connection to the server.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-URIOptions.9">URI Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>password</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>password</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies the password to use to log in to the SMSC.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>systemType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>cp</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>This parameter is used to categorize the type of ESME (External Short Message Entity) that is binding to the SMSC (max. 13 characters).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>dataCoding</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11</strong> Defines the data coding according the SMPP 3.4 specification, section 5.2.19. (Prior to <strong>Camel 2.9</strong>, this option is also supported.) Example data encodings are:<br clear="none" class="atl-forced-newline"> <code>0</code>: SMSC Default Alphabet<br clear="none" class="atl-forced-newline"> <code>3</code>: Latin 1 (ISO-8859-1)<br clear="none" class="atl-forced-newline"> <code>4</code>: Octet unspecified (8-bit binary)<br clear="none" class="atl-forced-newline"> <code>8</code>: UCS2 (ISO/IEC-10646)<br clear="none" class="atl-forced-newline"> <code>13</code>: Extended Kanji JIS(X 0212-1990)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>alphabet</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5</strong> Defines encoding of data according the SMPP 3.4 specification, section 5.2.19. This option is mapped to <a shape="rect" class="external-link" href="http://code.google.com/p/jsmpp/source/browse/tags/2.1.0/src/java/main/org/jsmpp/bean/Alphabet.java" rel="nofollow"><code>Alphabet.java</code></a> and used to create the <code>byte[]</code> which is send to the SMSC. Example alphabets are:<br clear="none" class="atl-forced-newline"> <code>0</code>: SMSC Default Alphabet<br clear="none" class="atl-forced-newline"> <code>4</code>: 8 bit Alphabet<br clear="none" class="atl-forced-newline"> <code>8</code>: UCS2 Alphabet</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>encoding</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>ISO-8859-1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for SubmitSm, ReplaceSm and SubmitMulti</strong> Defines the encoding scheme of the short message user data.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>enquireLinkTimer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>5000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Defines the interval in milliseconds between the confidence checks. The confidence check is used to test the communication path between an ESME and an SMSC.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transactionTimer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>10000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Defines the maximum period of inactivity allowed after a transaction, after which an SMPP entity may assume that the session is no longer active. This timer may be active on either communicating SMPP entity (i.e. SMSC or ESME).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>initialReconnectDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>5000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Defines the initial delay in milliseconds after the consumer/producer tries to reconnect to the SMSC, after the connection was lost.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>reconnectDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>5000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Defines the interval in milliseconds between the reconnect attempts, if the connection to the SMSC was lost and the previous was not succeed.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>registeredDelivery</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for SubmitSm, ReplaceSm, SubmitMulti and DataSm</strong> Is used to request an SMSC delivery receipt and/or SME originated acknowledgements. The following values are defined:<br clear="none" class="atl-forced-newline"> <code>0</code>: No SMSC delivery receipt requested.<br clear="none" class="atl-forced-newline"> <code>1</code>: SMSC delivery receipt requested where final delivery outcome is success or failure.<br clear="none" class="atl-forced-newline"> <code>2</code>: SMSC delivery receipt requested where the final delivery outcome is delivery failure.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>serviceType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CMT</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The service type parameter can be used to indicate the SMS Application service associated with the message. The following generic service_types are defined:<br clear="none" class="atl-forced-newline"> <code>CMT</code>: Cellular Messaging<br clear="none" class="atl-forced-newline"> <code>CPT</code>: Cellular Paging<br clear="none" class="atl-forced-newline"> <code>VMN</code>: Voice Mail Notification<br clear="none" class="atl-forced-newline"> <code>VMA</code>: Voice Mail Alerting<br clear="none" class="atl-forced-newline"> <code>WAP</code>: Wireless Application Protocol<br clear="none" class="atl-forced-newline"> <code>USSD</code>: Unstructured Supplementary Services Data</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sourceAddr</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1616</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Defines the address of SME (Short Message Entity) which originated this message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>destAddr</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1717</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for SubmitSm, SubmitMulti, CancelSm and DataSm</strong> Defines the destination SME address. For mobile terminated messages, this is the directory number of the recipient MS.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sourceAddrTon</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Defines the type of number (TON) to be used in the SME originator address parameters. The following TON values are defined:<br clear="none" class="atl-forced-newline"> <code>0</code>: Unknown<br clear="none" class="atl-forced-newline"> <code>1</code>: International<br clear="none" class="atl-forced-newline"> <code>2</code>: National<br clear="none" class="atl-forced-newline"> <code>3</code>: Network Specific<br clear="none" class="atl-forced-newline"> <code>4</code>: Subscriber Number<br clear="none" class="atl-forced-newline"> <code>5</code>: Alphanumeric<br clear="none" class="atl-forced-newline"> <code>6</code>: Abbreviated</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>destAddrTon</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for SubmitSm, SubmitMulti, CancelSm and DataSm</strong> Defines the type of number (TON) to be used in the SME destination address parameters. Same as the <code>sourceAddrTon</code> values defined above.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sourceAddrNpi</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Defines the numeric plan indicator (NPI) to be used in the SME originator address parameters. The following NPI values are defined: <br clear="none" class="atl-forced-newline"> <code>0</code>: Unknown<br clear="none" class="atl-forced-newline"> <code>1</code>: ISDN (E163/E164)<br clear="none" class="atl-forced-newline"> <code>2</code>: Data (X.121)<br clear="none" class="atl-forced-newline"> <code>3</code>: Telex (F.69)<br clear="none" class="atl-forced-newline"> <code>6</code>: Land Mobile (E.212)<br clear="none" class="atl-forced-newline"> <code>8</code>: National<br clear="none" class="atl-forced-newline"> <code>9</code>: Private<br clear="none" class="atl-forced-newline"> <code>10</code>: ERMES<br clear="none" class="atl-forced-newline"> <code>13</code>: Internet (IP)<br clear="none" class="atl-forced-newline"> <code>18</code>: WAP Client Id (to be defined by WAP Forum)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>destAddrNpi</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for SubmitSm, SubmitMulti, CancelSm and DataSm</strong> Defines the numeric plan indicator (NPI) to be used in the SME destination address parameters. Same as the <code>sourceAddrNpi</code> values defined above.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>priorityFlag</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for SubmitSm and SubmitMulti</strong> Allows the originating SME to assign a priority level to the short message. Four Priority Levels are supported:<br clear="none" class="atl-forced-newline"> <code>0</code>: Level 0 (lowest) priority<br clear="none" class="atl-forced-newline"> <code>1</code>: Level 1 priority<br clear="none" class="atl-forced-newline"> <code>2</code>: Level 2 priority<br clear="none" class="atl-forced-newline"> <code>3</code>: Level 3 (highest) priority</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>replaceIfPresentFlag</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for SubmitSm and SubmitMulti</strong> Used to request the SMSC to replace a previously submitted message, that is still pending delivery. The SMSC will replace an existing message provided that the source address, destination address and service type match the same fields in the new message. The following replace if present flag values are defined: <br clear="none" class="atl-forced-newline"> <code>0</code>: Don't replace<br clear="none" class="atl-forced-newline"> <code>1</code>: Replace</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>typeOfNumber</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Defines the type of number (TON) to be used in the SME. Use the <code>sourceAddrTon</code> values defined above.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>numberingPlanIndicator</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Defines the numeric plan indicator (NPI) to be used in the SME. Use the <code>sourceAddrNpi</code> values defined above.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>lazySessionCreation</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8 onwards</strong> Sessions can be lazily created to avoid exceptions, if the SMSC is not available when the Camel producer is started.<br clear="none" class="atl-forced-newline"> <strong>Camel 2.11 onwards</strong> Camel will check the in message headers 'CamelSmppSystemId' and 'CamelSmppPassword' of the first exchange. If they are present, Camel will use these data to connect to the SMSC.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpProxyHost</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.1:</strong> If you need to tunnel SMPP through a HTTP proxy, set this attribute to the hostname or ip address of your HTTP proxy.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpProxyPort</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>3128</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.1:</strong> If you need to tunnel SMPP through a HTTP proxy, set this attribute to the port of your HTTP proxy.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpProxyUsername</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.1:</strong> If your HTTP proxy requires basic authentication, set this attribute to the username required for your HTTP proxy.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>httpProxyPassword</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.1:</strong> If your HTTP proxy requires basic authentication, set this attribute to the password required for your HTTP proxy.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sessionStateListener</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.3:</strong> You can refer to a <code>org.jsmpp.session.SessionStateListener</code> in the <code>Registry</code> to receive callbacks when the session state changed.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>addressRange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>""</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> You can specify the address range for the <code>SmppConsumer</code> as defined in section 5.2.7 of the SMPP 3.4 specification. The <code>SmppConsumer</code> will receive messages only from SMSC's which target an address (MSISDN or IP address) within this range.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">splittingPolicy</td><td colspan="1" rowspan="1" class="confluenceTd">ALLOW</td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.14.1 and 2.15.0:</strong> You can specify a policy for handling long messages:</p> 
      <ul><li>ALLOW - the default, long messages are split to 140 bytes per message</li><li>TRUNCATE - long messages are split and only the first fragment will be sent to the SMSC.&#160; Some carriers drop subsequent fragments so this reduces load on the SMPP connection sending parts of a message that will never be delivered.</li><li>REJECT - if a message would need to be split, it is rejected with an SMPP NegativeResponseException and the reason code signifying the message is too long.</li></ul></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">proxyHeaders</td><td colspan="1" rowspan="1" class="confluenceTd">null</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.17:</strong> These headers will be passed to the proxy server while establishing the connection.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">maxReconnect</td><td colspan="1" rowspan="1" class="confluenceTd">2147483647</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.18:</strong> Defines the maximum number of attempts to reconnect to the SMSC, if SMSC returns a negative bind response</td></tr></tbody></table> 
 </div>
</div><p>You can have as many of these options as you like.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">smpp://smppclient@localhost:2775?password=password&amp;amp;enquireLinkTimer=3000&amp;amp;transactionTimer=5000&amp;amp;systemType=consumer </script> 
 </div>
</div><h3 id="BookInOnePage-ProducerMessageHeaders">Producer Message Headers</h3><p>The following message headers can be used to affect the behavior of the SMPP producer</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppDestAddr</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>List</code>/<code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for SubmitSm, SubmitMulti, CancelSm and DataSm</strong> Defines the destination SME address(es). For mobile terminated messages, this is the directory number of the recipient MS. Is must be a <code>List&lt;String&gt;</code> for SubmitMulti and a <code>String</code> otherwise.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppDestAddrTon</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Byte</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for SubmitSm, SubmitMulti, CancelSm and DataSm</strong> Defines the type of number (TON) to be used in the SME destination address parameters. Use the <code>sourceAddrTon</code> URI option values defined above.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppDestAddrNpi</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Byte</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for SubmitSm, SubmitMulti, CancelSm and DataSm</strong> Defines the numeric plan indicator (NPI) to be used in the SME destination address parameters. Use the URI option <code>sourceAddrNpi</code> values defined above.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppSourceAddr</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Defines the address of SME (Short Message Entity) which originated this message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppSourceAddrTon</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Byte</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Defines the type of number (TON) to be used in the SME originator address parameters. Use the <code>sourceAddrTon</code> URI option values defined above.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppSourceAddrNpi</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Byte</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Defines the numeric plan indicator (NPI) to be used in the SME originator address parameters. Use the URI option <code>sourceAddrNpi</code> values defined above.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppServiceType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The service type parameter can be used to indicate the SMS Application service associated with the message. Use the URI option <code>serviceType</code> settings above.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppRegisteredDelivery</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Byte</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for SubmitSm, ReplaceSm, SubmitMulti and DataSm</strong> Is used to request an SMSC delivery receipt and/or SME originated acknowledgements. Use the URI option <code>registeredDelivery</code> settings above.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppPriorityFlag</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Byte</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for SubmitSm and SubmitMulti</strong> Allows the originating SME to assign a priority level to the short message. Use the URI option <code>priorityFlag</code> settings above.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppScheduleDeliveryTime</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Date</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for SubmitSm, SubmitMulti and ReplaceSm</strong> This parameter specifies the scheduled time at which the message delivery should be first attempted. It defines either the absolute date and time or relative time from the current SMSC time at which delivery of this message will be attempted by the SMSC. It can be specified in either absolute time format or relative time format. The encoding of a time format is specified in chapter 7.1.1. in the smpp specification v3.4.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppValidityPeriod</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code>/<code>Date</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for SubmitSm, SubmitMulti and ReplaceSm</strong> The validity period parameter indicates the SMSC expiration time, after which the message should be discarded if not delivered to the destination. If it's provided as <code>Date</code>, it's interpreted as absolute time. <strong>Camel 2.9.1 onwards:</strong> It can be defined in absolute time format or relative time format if you provide it as <code>String</code> as specified in chapter 7.1.1 in the smpp specification v3.4.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppReplaceIfPresentFlag</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Byte</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for SubmitSm and SubmitMulti</strong> The replace if present flag parameter is used to request the SMSC to replace a previously submitted message, that is still pending delivery. The SMSC will replace an existing message provided that the source address, destination address and service type match the same fields in the new message. The following values are defined: <br clear="none" class="atl-forced-newline"> <code>0</code>: Don't replace<br clear="none" class="atl-forced-newline"> <code>1</code>: Replace</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppAlphabet</code> / <code>CamelSmppDataCoding</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Byte</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5</strong> <strong>For SubmitSm, SubmitMulti and ReplaceSm</strong> (Prior to <strong>Camel 2.9</strong> use <code>CamelSmppDataCoding</code> instead of <code>CamelSmppAlphabet</code>.) The data coding according to the SMPP 3.4 specification, section 5.2.19. Use the URI option <code>alphabet</code> settings above.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppOptionalParameters</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Map&lt;String, String&gt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Deprecated and will be removed in Camel 2.13.0/3.0.0</strong><br clear="none" class="atl-forced-newline"> <strong>Camel 2.10.5 and 2.11.1 onwards and only for SubmitSm, SubmitMulti and DataSm</strong> The optional parameters send back by the SMSC.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppOptionalParameter</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Map&lt;Short, Object&gt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.7 and 2.11.2 onwards and only for SubmitSm, SubmitMulti and DataSm</strong> The optional parameter which are send to the SMSC. The value is converted in the following way:<br clear="none" class="atl-forced-newline"> <code>String</code> -&gt; <code>org.jsmpp.bean.OptionalParameter.COctetString</code><br clear="none" class="atl-forced-newline"> <code>byte[]</code> -&gt; <code>org.jsmpp.bean.OptionalParameter.OctetString</code><br clear="none" class="atl-forced-newline"> <code>Byte</code> -&gt; <code>org.jsmpp.bean.OptionalParameter.Byte</code><br clear="none" class="atl-forced-newline"> <code>Integer</code> -&gt; <code>org.jsmpp.bean.OptionalParameter.Int</code><br clear="none" class="atl-forced-newline"> <code>Short</code> -&gt; <code>org.jsmpp.bean.OptionalParameter.Short</code><br clear="none" class="atl-forced-newline"> <code>null</code> -&gt; <code>org.jsmpp.bean.OptionalParameter.Null</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">CamelSmppEncoding</td><td colspan="1" rowspan="1" class="confluenceTd">String</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.14.1 and Camel 2.15.0 onwards and </strong><strong>only for SubmitSm, SubmitMulti and DataSm</strong>.&#160; Specifies the encoding (character set name) of the bytes in the message body.&#160; If the message body is a string then this is not relevant because Java Strings are always Unicode.&#160; If the body is a byte array then this header can be used to indicate that it is ISO-8859-1 or some other value.&#160; Default value is specified by the endpoint configuration parameter <em>encoding</em></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">CamelSmppSplittingPolicy</td><td colspan="1" rowspan="1" class="confluenceTd">String</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.14.1 and Camel 2.15.0 onwards and </strong><strong>only for SubmitSm, SubmitMulti and DataSm</strong>.&#160; Specifies the policy for message splitting for this exchange.&#160; Possible values are described in the endpoint configuration parameter <em>splittingPolicy</em></td></tr></tbody></table> 
 </div>
</div><p>The following message headers are used by the SMPP producer to set the response from the SMSC in the message header</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>List&lt;String&gt;</code>/<code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The id to identify the submitted short message(s) for later use. <strong>From Camel 2.9.0</strong>: In case of a ReplaceSm, QuerySm, CancelSm and DataSm this header vaule is a <code>String</code>. In case of a SubmitSm or SubmitMultiSm this header vaule is a <code>List&lt;String&gt;</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppSentMessageCount</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Integer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>From Camel 2.9 onwards only for SubmitSm and SubmitMultiSm</strong> The total number of messages which has been sent.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppError</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>From Camel 2.9 onwards only for SubmitMultiSm</strong> The errors which occurred by sending the short message(s) the form <code>Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt;</code> (messageID : (destAddr : address, error : errorCode)).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppOptionalParameters</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Map&lt;String, String&gt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Deprecated and will be removed in Camel 2.13.0/3.0.0</strong><br clear="none" class="atl-forced-newline"> <strong>From Camel 2.11.1 onwards only for DataSm</strong> The optional parameters which are returned from the SMSC by sending the message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppOptionalParameter</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Map&lt;Short, Object&gt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>From Camel 2.10.7, 2.11.2 onwards only for DataSm</strong> The optional parameter which are returned from the SMSC by sending the message. The key is the <code>Short</code> code for the optional parameter. The value is converted in the following way:<br clear="none" class="atl-forced-newline"> <code>org.jsmpp.bean.OptionalParameter.COctetString</code> -&gt; <code>String</code><br clear="none" class="atl-forced-newline"> <code>org.jsmpp.bean.OptionalParameter.OctetString</code> -&gt; <code>byte[]</code><br clear="none" class="atl-forced-newline"> <code>org.jsmpp.bean.OptionalParameter.Byte</code> -&gt; <code>Byte</code><br clear="none" class="atl-forced-newline"> <code>org.jsmpp.bean.OptionalParameter.Int</code> -&gt; <code>Integer</code><br clear="none" class="atl-forced-newline"> <code>org.jsmpp.bean.OptionalParameter.Short</code> -&gt; <code>Short</code><br clear="none" class="atl-forced-newline"> <code>org.jsmpp.bean.OptionalParameter.Null</code> -&gt; <code>null</code></p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-ConsumerMessageHeaders">Consumer Message Headers</h3><p>The following message headers are used by the SMPP consumer to set the request data from the SMSC in the message header</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppSequenceNumber</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Integer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for AlertNotification, DeliverSm and DataSm</strong> A sequence number allows a response PDU to be correlated with a request PDU. The associated SMPP response PDU must preserve this field.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppCommandId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Integer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for AlertNotification, DeliverSm and DataSm</strong> The command id field identifies the particular SMPP PDU. For the complete list of defined values see chapter 5.1.2.1 in the smpp specification v3.4.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppSourceAddr</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for AlertNotification, DeliverSm and DataSm</strong> Defines the address of SME (Short Message Entity) which originated this message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppSourceAddrNpi</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Byte</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for AlertNotification and DataSm</strong> Defines the numeric plan indicator (NPI) to be used in the SME originator address parameters. Use the URI option <code>sourceAddrNpi</code> values defined above.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppSourceAddrTon</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Byte</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for AlertNotification and DataSm</strong> Defines the type of number (TON) to be used in the SME originator address parameters. Use the <code>sourceAddrTon</code> URI option values defined above.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppEsmeAddr</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for AlertNotification</strong> Defines the destination ESME address. For mobile terminated messages, this is the directory number of the recipient MS.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppEsmeAddrNpi</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Byte</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for AlertNotification</strong> Defines the numeric plan indicator (NPI) to be used in the ESME originator address parameters. Use the URI option <code>sourceAddrNpi</code> values defined above.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppEsmeAddrTon</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Byte</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for AlertNotification</strong> Defines the type of number (TON) to be used in the ESME originator address parameters. Use the <code>sourceAddrTon</code> URI option values defined above.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for smsc DeliveryReceipt and DataSm</strong> The message ID allocated to the message by the SMSC when originally submitted.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppDelivered</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Integer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for smsc DeliveryReceipt</strong> Number of short messages delivered. This is only relevant where the original message was submitted to a distribution list.The value is padded with leading zeros if necessary.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppDoneDate</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Date</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for smsc DeliveryReceipt</strong> The time and date at which the short message reached it's final state. The format is as follows: YYMMDDhhmm.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppStatus</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>DeliveryReceiptState</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for smsc DeliveryReceipt:</strong> The final status of the message. The following values are defined:<br clear="none" class="atl-forced-newline"> <code>DELIVRD</code>: Message is delivered to destination<br clear="none" class="atl-forced-newline"> <code>EXPIRED</code>: Message validity period has expired.<br clear="none" class="atl-forced-newline"> <code>DELETED</code>: Message has been deleted.<br clear="none" class="atl-forced-newline"> <code>UNDELIV</code>: Message is undeliverable<br clear="none" class="atl-forced-newline"> <code>ACCEPTD</code>: Message is in accepted state (i.e. has been manually read on behalf of the subscriber by customer service)<br clear="none" class="atl-forced-newline"> <code>UNKNOWN</code>: Message is in invalid state<br clear="none" class="atl-forced-newline"> <code>REJECTD</code>: Message is in a rejected state</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppCommandStatus</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Integer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for DataSm</strong> The Command status of the message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppError</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for smsc DeliveryReceipt</strong> Where appropriate this may hold a Network specific error code or an SMSC error code for the attempted delivery of the message. These errors are Network or SMSC specific and are not included here.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppSubmitDate</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Date</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for smsc DeliveryReceipt</strong> The time and date at which the short message was submitted. In the case of a message which has been replaced, this is the date that the original message was replaced. The format is as follows: YYMMDDhhmm.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppSubmitted</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Integer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for smsc DeliveryReceipt</strong> Number of short messages originally submitted. This is only relevant when the original message was submitted to a distribution list.The value is padded with leading zeros if necessary.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppDestAddr</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for DeliverSm and DataSm:</strong> Defines the destination SME address. For mobile terminated messages, this is the directory number of the recipient MS.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppScheduleDeliveryTime</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for DeliverSm:</strong> This parameter specifies the scheduled time at which the message delivery should be first attempted. It defines either the absolute date and time or relative time from the current SMSC time at which delivery of this message will be attempted by the SMSC. It can be specified in either absolute time format or relative time format. The encoding of a time format is specified in Section 7.1.1. in the smpp specification v3.4.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppValidityPeriod</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for DeliverSm</strong> The validity period parameter indicates the SMSC expiration time, after which the message should be discarded if not delivered to the destination. It can be defined in absolute time format or relative time format. The encoding of absolute and relative time format is specified in Section 7.1.1 in the smpp specification v3.4.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppServiceType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for DeliverSm and DataSm</strong> The service type parameter indicates the SMS Application service associated with the message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppRegisteredDelivery</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Byte</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for DataSm</strong> Is used to request an delivery receipt and/or SME originated acknowledgements. Same values as in Producer header list above.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppDestAddrNpi</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Byte</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for DataSm</strong> Defines the numeric plan indicator (NPI) in the destination address parameters. Use the URI option <code>sourceAddrNpi</code> values defined above.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppDestAddrTon</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Byte</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>only for DataSm</strong> Defines the type of number (TON) in the destination address parameters. Use the <code>sourceAddrTon</code> URI option values defined above.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppMessageType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.6 onwards</strong>: Identifies the type of an incoming message:<br clear="none" class="atl-forced-newline"> <code>AlertNotification</code>: an SMSC alert notification<br clear="none" class="atl-forced-newline"> <code>DataSm</code>: an SMSC data short message<br clear="none" class="atl-forced-newline"> <code>DeliveryReceipt</code>: an SMSC delivery receipt<br clear="none" class="atl-forced-newline"> <code>DeliverSm</code>: an SMSC deliver short message</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppOptionalParameters</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Map&lt;String, Object&gt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Deprecated and will be removed in Camel 2.13.0/3.0.0</strong><br clear="none" class="atl-forced-newline"> <strong>Camel 2.10.5 onwards and only for DeliverSm</strong> The optional parameters send back by the SMSC.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSmppOptionalParameter</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Map&lt;Short, Object&gt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.7, 2.11.2 onwards and only for DeliverSm</strong> The optional parameters send back by the SMSC. The key is the <code>Short</code> code for the optional parameter. The value is converted in the following way:<br clear="none" class="atl-forced-newline"> <code>org.jsmpp.bean.OptionalParameter.COctetString</code> -&gt; <code>String</code><br clear="none" class="atl-forced-newline"> <code>org.jsmpp.bean.OptionalParameter.OctetString</code> -&gt; <code>byte[]</code><br clear="none" class="atl-forced-newline"> <code>org.jsmpp.bean.OptionalParameter.Byte</code> -&gt; <code>Byte</code><br clear="none" class="atl-forced-newline"> <code>org.jsmpp.bean.OptionalParameter.Int</code> -&gt; <code>Integer</code><br clear="none" class="atl-forced-newline"> <code>org.jsmpp.bean.OptionalParameter.Short</code> -&gt; <code>Short</code><br clear="none" class="atl-forced-newline"> <code>org.jsmpp.bean.OptionalParameter.Null</code> -&gt; <code>null</code></p></td></tr></tbody></table> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">JSMPP library</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>See the documentation of the <a shape="rect" class="external-link" href="http://jsmpp.org" rel="nofollow">JSMPP Library</a> for more details about the underlying library.</p>
 </div>
</div><h3 id="BookInOnePage-Exceptionhandling.1">Exception handling</h3><p>This component supports the general Camel exception handling capabilities</p><p>When an error occurs sending a message with SubmitSm (the default action), the org.apache.camel.component.smpp.SmppException is thrown with a nested exception, org.jsmpp.extra.NegativeResponseException.&#160; Call NegativeResponseException.getCommandStatus() to obtain the exact SMPP negative response code, the values are explained in the SMPP specification 3.4, section 5.1.3.<br clear="none"> <strong>Camel 2.8 onwards</strong>: When the SMPP consumer receives a <code>DeliverSm</code> or <code>DataSm</code> short message and the processing of these messages fails, you can also throw a <code>ProcessRequestException</code> instead of handle the failure. In this case, this exception is forwarded to the underlying <a shape="rect" class="external-link" href="http://jsmpp.org" rel="nofollow">JSMPP library</a> which will return the included error code to the SMSC. This feature is useful to e.g. instruct the SMSC to resend the short message at a later time. This could be done with the following lines of code:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;smpp://smppclient@localhost:2775?password=password&amp;amp;enquireLinkTimer=3000&amp;amp;transactionTimer=5000&amp;amp;systemType=consumer&amp;quot;) .doTry() .to(&amp;quot;bean:dao?method=updateSmsState&amp;quot;) .doCatch(Exception.class) .throwException(new ProcessRequestException(&amp;quot;update of sms state failed&amp;quot;, 100)) .end(); </script> 
 </div>
</div><p>Please refer to the <a shape="rect" class="external-link" href="http://smsforum.net/SMPP_v3_4_Issue1_2.zip" rel="nofollow">SMPP specification</a> for the complete list of error codes and their meanings.</p><h3 id="BookInOnePage-Samples.17">Samples</h3><p>See the <a shape="rect" class="external-link" href="http://smsrouter.org" rel="nofollow">SMS Router</a> source code for a full sample application. &#160;Consider integrating your application with SMS Router through queues rather than adding the SMPP code directly to your routes, building a more loosely-coupled architecture.</p><p>A route which sends an SMS using the Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;smpp://smppclient@localhost:2775? password=password&amp;amp;enquireLinkTimer=3000&amp;amp;transactionTimer=5000&amp;amp;systemType=producer&amp;quot;); </script> 
 </div>
</div><p>A route which sends an SMS using the Spring XML DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;smpp://smppclient@localhost:2775? password=password&amp;amp;amp;enquireLinkTimer=3000&amp;amp;amp;transactionTimer=5000&amp;amp;amp;systemType=producer&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p>A route which receives an SMS using the Java DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;smpp://smppclient@localhost:2775?password=password&amp;amp;enquireLinkTimer=3000&amp;amp;transactionTimer=5000&amp;amp;systemType=consumer&amp;quot;) .to(&amp;quot;bean:foo&amp;quot;); </script> 
 </div>
</div><p>A route which receives an SMS using the Spring XML DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;smpp://smppclient@localhost:2775? password=password&amp;amp;amp;enquireLinkTimer=3000&amp;amp;amp;transactionTimer=5000&amp;amp;amp;systemType=consumer&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:foo&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">SMSC simulator</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>If you need an SMSC simulator for your test, you can use the simulator provided by <a shape="rect" class="external-link" href="http://opensmpp.logica.com/CommonPart/Download/download2.html#simulator" rel="nofollow">Logica</a>.</p>
 </div>
</div><h3 id="BookInOnePage-Debuglogging.2">Debug logging</h3><p>This component has log level <strong>DEBUG</strong>, which can be helpful in debugging problems. If you use log4j, you can add the following line to your configuration:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">log4j.logger.org.apache.camel.component.smpp=DEBUG </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.77">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-SNMPComponent">SNMP Component</h2><p><strong>Available as of Camel 2.1</strong></p><p>The <strong>snmp:</strong> component gives you the ability to poll SNMP capable devices or receiving traps.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-snmp&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.61">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">snmp://hostname[:port][?Options] </script> 
 </div>
</div><p>The component supports polling OID values from an SNMP enabled device and receiving traps.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.68">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>none</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The type of action you want to perform. Actually you can enter here <code>POLL</code> or <code>TRAP</code>. The value <code>POLL</code> will instruct the endpoint to poll a given host for the supplied OID keys. If you put in <code>TRAP</code> you will setup a listener for SNMP Trap Events.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>protocol</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>udp</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Here you can select which protocol to use. You can use either <code>udp</code> or <code>tcp</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>retries</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>2</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Defines how often a retry is made before canceling the request.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>timeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1500</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sets the timeout value for the request in millis.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>snmpVersion</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code> (which means SNMPv1)</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sets the snmp version for the request.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>snmpCommunity</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>public</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sets the community octet string for the snmp request.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>delay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>60</code> seconds</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Defines the delay in seconds between to poll cycles. From <strong>Camel 2.15</strong> onwards the delay is using millis as its timeunit, so configure 30000 for 30 seconds. Older releases uses the value in seconds.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>oids</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>none</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Defines which values you are interested in. Please have a look at the <a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/Object_identifier" rel="nofollow">Wikipedia </a> to get a better understanding. You may provide a single OID or a coma separated list of OIDs. Example: oids="1.3.6.1.2.1.1.3.0,1.3.6.1.2.1.25.3.2.1.5.1,1.3.6.1.2.1.25.3.5.1.1.1,1.3.6.1.2.1.43.5.1.1.11.1"</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Theresultofapoll">The result of a poll</h3><p>Given the situation, that I poll for the following OIDs:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>OIDs</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">1.3.6.1.2.1.1.3.0 1.3.6.1.2.1.25.3.2.1.5.1 1.3.6.1.2.1.25.3.5.1.1.1 1.3.6.1.2.1.43.5.1.1.11.1 </script> 
 </div>
</div><p>The result will be the following:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
  <b>Result of toString conversion</b>
 </div>
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt; &amp;lt;snmp&amp;gt; &amp;lt;entry&amp;gt; &amp;lt;oid&amp;gt;1.3.6.1.2.1.1.3.0&amp;lt;/oid&amp;gt; &amp;lt;value&amp;gt;6 days, 21:14:28.00&amp;lt;/value&amp;gt; &amp;lt;/entry&amp;gt; &amp;lt;entry&amp;gt; &amp;lt;oid&amp;gt;1.3.6.1.2.1.25.3.2.1.5.1&amp;lt;/oid&amp;gt; &amp;lt;value&amp;gt;2&amp;lt;/value&amp;gt; &amp;lt;/entry&amp;gt; &amp;lt;entry&amp;gt; &amp;lt;oid&amp;gt;1.3.6.1.2.1.25.3.5.1.1.1&amp;lt;/oid&amp;gt; &amp;lt;value&amp;gt;3&amp;lt;/value&amp;gt; &amp;lt;/entry&amp;gt; &amp;lt;entry&amp;gt; &amp;lt;oid&amp;gt;1.3.6.1.2.1.43.5.1.1.11.1&amp;lt;/oid&amp;gt; &amp;lt;value&amp;gt;6&amp;lt;/value&amp;gt; &amp;lt;/entry&amp;gt; &amp;lt;entry&amp;gt; &amp;lt;oid&amp;gt;1.3.6.1.2.1.1.1.0&amp;lt;/oid&amp;gt; &amp;lt;value&amp;gt;My Very Special Printer Of Brand Unknown&amp;lt;/value&amp;gt; &amp;lt;/entry&amp;gt; &amp;lt;/snmp&amp;gt; </script> 
 </div>
</div><p>As you maybe recognized there is one more result than requested....1.3.6.1.2.1.1.1.0.<br clear="none"> This one is filled in by the device automatically in this special case. So it may absolutely happen, that you receive more than you requested...be prepared.</p><h3 id="BookInOnePage-Examples.26">Examples</h3><p>Polling a remote device:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">snmp:192.168.178.23:161?protocol=udp&amp;amp;type=POLL&amp;amp;oids=1.3.6.1.2.1.1.5.0 </script> 
 </div>
</div><p>Setting up a trap receiver (<strong>Note that no OID info is needed here!</strong>):</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">snmp:127.0.0.1:162?protocol=udp&amp;amp;type=TRAP </script> 
 </div>
</div><p><strong>From Camel 2.10.0</strong>, you can get the community of SNMP TRAP with message header 'securityName',<br clear="none"> peer address of the SNMP TRAP with message header 'peerAddress'.</p><p>Routing example in Java: (converts the SNMP PDU to XML String)</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;snmp:192.168.178.23:161?protocol=udp&amp;amp;type=POLL&amp;amp;oids=1.3.6.1.2.1.1.5.0&amp;quot;). convertBodyTo(String.class). to(&amp;quot;activemq:snmp.states&amp;quot;); </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.78">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-SpringIntegrationComponent">Spring Integration Component</h2><p>The <strong>spring-integration:</strong> component provides a bridge for Camel components to talk to <a shape="rect" class="external-link" href="http://www.springsource.org/spring-integration" rel="nofollow">spring integration endpoints</a>.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-spring-integration&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.62">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> spring-integration:defaultChannelName[?options] </script> 
 </div>
</div><p>Where <strong>defaultChannelName</strong> represents the default channel name which is used by the Spring Integration Spring context. It will equal to the <code>inputChannel</code> name for the Spring Integration consumer and the <code>outputChannel</code> name for the Spring Integration provider.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.69">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Type </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>inputChannel</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> String </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The Spring integration input channel name that this endpoint wants to consume from, where the specified channel name is defined in the Spring context. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>outputChannel</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> String </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The Spring integration output channel name that is used to send messages to the Spring integration context. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>inOut</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> String </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The exchange pattern that the Spring integration endpoint should use. If <code>inOut=true</code> then a reply channel is expected, either from the Spring Integration Message header or configured on the endpoint. </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Usage.8">Usage</h3><p>The Spring integration component is a bridge that connects Camel endpoints with Spring integration endpoints through the Spring integration's input channels and output channels. Using this component, we can send Camel messages to Spring Integration endpoints or receive messages from Spring integration endpoints in a Camel routing context.</p><h3 id="BookInOnePage-Examples.27">Examples</h3><h4 id="BookInOnePage-UsingtheSpringintegrationendpoint">Using the Spring integration endpoint</h4><p>You can set up a Spring integration endpoint using a URI, as follows: </p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;beans:beans xmlns=&amp;quot;http://www.springframework.org/schema/integration&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:beans=&amp;quot;http://www.springframework.org/schema/beans&amp;quot; xsi:schemaLocation=&amp;quot; http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration.xsd http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd&amp;quot;&amp;gt; &amp;lt;!-- spring integration channels --&amp;gt; &amp;lt;channel id=&amp;quot;inputChannel&amp;quot;/&amp;gt; &amp;lt;channel id=&amp;quot;outputChannel&amp;quot;/&amp;gt; &amp;lt;channel id=&amp;quot;onewayChannel&amp;quot;/&amp;gt; &amp;lt;!-- spring integration service activators --&amp;gt; &amp;lt;service-activator input-channel=&amp;quot;inputChannel&amp;quot; ref=&amp;quot;helloService&amp;quot; method=&amp;quot;sayHello&amp;quot;/&amp;gt; &amp;lt;service-activator input-channel=&amp;quot;onewayChannel&amp;quot; ref=&amp;quot;helloService&amp;quot; method=&amp;quot;greet&amp;quot;/&amp;gt; &amp;lt;!-- custom bean --&amp;gt; &amp;lt;beans:bean id=&amp;quot;helloService&amp;quot; class=&amp;quot;org.apache.camel.component.spring.integration.HelloWorldService&amp;quot;/&amp;gt; &amp;lt;camelContext id=&amp;quot;camel&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:twowayMessage&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;spring-integration:inputChannel?inOut=true&amp;amp;amp;inputChannel=outputChannel&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:onewayMessage&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;spring-integration:onewayChannel?inOut=false&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- spring integration channels --&amp;gt; &amp;lt;channel id=&amp;quot;requestChannel&amp;quot;/&amp;gt; &amp;lt;channel id=&amp;quot;responseChannel&amp;quot;/&amp;gt; &amp;lt;!-- cusom Camel processor --&amp;gt; &amp;lt;beans:bean id=&amp;quot;myProcessor&amp;quot; class=&amp;quot;org.apache.camel.component.spring.integration.MyProcessor&amp;quot;/&amp;gt; &amp;lt;!-- Camel route --&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;spring-integration://requestChannel?outputChannel=responseChannel&amp;amp;amp;inOut=true&amp;quot;/&amp;gt; &amp;lt;process ref=&amp;quot;myProcessor&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><p>Or directly using a Spring integration channel name:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;beans:beans xmlns=&amp;quot;http://www.springframework.org/schema/integration&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:beans=&amp;quot;http://www.springframework.org/schema/beans&amp;quot; xsi:schemaLocation=&amp;quot; http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration.xsd http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd&amp;quot;&amp;gt; &amp;lt;!-- spring integration channel --&amp;gt; &amp;lt;channel id=&amp;quot;outputChannel&amp;quot;/&amp;gt; &amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;outputChannel&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-TheSourceandTargetadapter">The Source and Target adapter</h4><p>Spring integration also provides the Spring integration's source and target adapters, which can route messages from a Spring integration channel to a Camel endpoint or from a Camel endpoint to a Spring integration channel.</p><p>This example uses the following namespaces:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;beans:beans xmlns=&amp;quot;http://www.springframework.org/schema/integration&amp;quot; xmlns:beans=&amp;quot;http://www.springframework.org/schema/beans&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:camel-si=&amp;quot;http://camel.apache.org/schema/spring/integration&amp;quot; xsi:schemaLocation=&amp;quot; http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration.xsd http://camel.apache.org/schema/spring/integration http://camel.apache.org/schema/spring/integration/camel-spring-integration.xsd http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd &amp;quot;&amp;gt; </script> 
 </div>
</div><p>You can bind your source or target to a Camel endpoint as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- Create the camel context here --&amp;gt; &amp;lt;camelContext id=&amp;quot;camelTargetContext&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:EndpointA&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;mock:result&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:EndpointC&amp;quot;/&amp;gt; &amp;lt;process ref=&amp;quot;myProcessor&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;!-- We can bind the camelTarget to the camel context&amp;#39;s endpoint by specifying the camelEndpointUri attribute --&amp;gt; &amp;lt;camel-si:camelTarget id=&amp;quot;camelTargetA&amp;quot; camelEndpointUri=&amp;quot;direct:EndpointA&amp;quot; expectReply=&amp;quot;false&amp;quot;&amp;gt; &amp;lt;camel-si:camelContextRef&amp;gt;camelTargetContext&amp;lt;/camel-si:camelContextRef&amp;gt; &amp;lt;/camel-si:camelTarget&amp;gt; &amp;lt;camel-si:camelTarget id=&amp;quot;camelTargetB&amp;quot; camelEndpointUri=&amp;quot;direct:EndpointC&amp;quot; replyChannel=&amp;quot;channelC&amp;quot; expectReply=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;camel-si:camelContextRef&amp;gt;camelTargetContext&amp;lt;/camel-si:camelContextRef&amp;gt; &amp;lt;/camel-si:camelTarget&amp;gt; &amp;lt;camel-si:camelTarget id=&amp;quot;camelTargetD&amp;quot; camelEndpointUri=&amp;quot;direct:EndpointC&amp;quot; expectReply=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;camel-si:camelContextRef&amp;gt;camelTargetContext&amp;lt;/camel-si:camelContextRef&amp;gt; &amp;lt;/camel-si:camelTarget&amp;gt; &amp;lt;beans:bean id=&amp;quot;myProcessor&amp;quot; class=&amp;quot;org.apache.camel.component.spring.integration.MyProcessor&amp;quot;/&amp;gt; </script> 
 </div>
</div><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;!-- spring integration channels --&amp;gt; &amp;lt;channel id=&amp;quot;channelA&amp;quot;/&amp;gt; &amp;lt;channel id=&amp;quot;channelB&amp;quot;/&amp;gt; &amp;lt;channel id=&amp;quot;channelC&amp;quot;/&amp;gt; &amp;lt;!-- spring integration service activator --&amp;gt; &amp;lt;service-activator input-channel=&amp;quot;channelB&amp;quot; output-channel=&amp;quot;channelC&amp;quot; ref=&amp;quot;helloService&amp;quot; method=&amp;quot;sayHello&amp;quot;/&amp;gt; &amp;lt;!-- custom bean --&amp;gt; &amp;lt;beans:bean id=&amp;quot;helloService&amp;quot; class=&amp;quot;org.apache.camel.component.spring.integration.HelloWorldService&amp;quot;/&amp;gt; &amp;lt;camelContext id=&amp;quot;camelSourceContext&amp;quot; xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:OneWay&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:EndpointB&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:TwoWay&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;direct:EndpointC&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;!-- camelSource will redirect the message coming for direct:EndpointB to the spring requestChannel channelA --&amp;gt; &amp;lt;camel-si:camelSource id=&amp;quot;camelSourceA&amp;quot; camelEndpointUri=&amp;quot;direct:EndpointB&amp;quot; requestChannel=&amp;quot;channelA&amp;quot; expectReply=&amp;quot;false&amp;quot;&amp;gt; &amp;lt;camel-si:camelContextRef&amp;gt;camelSourceContext&amp;lt;/camel-si:camelContextRef&amp;gt; &amp;lt;/camel-si:camelSource&amp;gt; &amp;lt;!-- camelSource will redirect the message coming for direct:EndpointC to the spring requestChannel channelB then it will pull the response from channelC and put the response message back to direct:EndpointC --&amp;gt; &amp;lt;camel-si:camelSource id=&amp;quot;camelSourceB&amp;quot; camelEndpointUri=&amp;quot;direct:EndpointC&amp;quot; requestChannel=&amp;quot;channelB&amp;quot; replyChannel=&amp;quot;channelC&amp;quot; expectReply=&amp;quot;true&amp;quot;&amp;gt; &amp;lt;camel-si:camelContextRef&amp;gt;camelSourceContext&amp;lt;/camel-si:camelContextRef&amp;gt; &amp;lt;/camel-si:camelSource&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-SeeAlso.79">See Also</h3><ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-SpringLDAPComponent">Spring LDAP Component</h2><p><strong>Available since Camel 2.11</strong></p><p>The <strong>spring-ldap:</strong> component provides a Camel wrapper for <a shape="rect" class="external-link" href="http://www.springsource.org/ldap" rel="nofollow">Spring LDAP</a>.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-spring-ldap&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.63">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> spring-ldap:springLdapTemplate[?options] </script> 
 </div>
</div><p>Where <strong>springLdapTemplate</strong> is the name of the <a shape="rect" class="external-link" href="http://static.springsource.org/spring-ldap/site/apidocs/org/springframework/ldap/core/LdapTemplate.html" rel="nofollow">Spring LDAP Template bean</a>. In this bean, you configure the URL and the credentials for your LDAP access.</p><h3 id="BookInOnePage-Options.70">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Name </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Type </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>operation</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> String </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The LDAP operation to be performed. Must be one of <code>search</code>, <code>bind</code>, or <code>unbind</code>. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>scope</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> String </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The scope of the search operation. Must be one of <code>object</code>, <code>onelevel</code>, or <code>subtree</code>, see also <a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol#Search_and_Compare" rel="nofollow">http://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol#Search_and_Compare</a> </p></td></tr></tbody></table> 
 </div>
</div><p>If an unsupported value is specified for some option, the component throws an <code>UnsupportedOperationException</code>.</p><h3 id="BookInOnePage-Usage.9">Usage</h3><p>The component supports producer endpoint only. An attempt to create a consumer endpoint will result in an <code>UnsupportedOperationException</code>.<br clear="none"> The body of the message must be a map (an instance of <code>java.util.Map</code>). This map must contain at least an entry with the key <strong><code>dn</code></strong> that specifies the root node for the LDAP operation to be performed. Other entries of the map are operation-specific (see below).</p><p>The body of the message remains unchanged for the <code>bind</code> and <code>unbind</code> operations. For the <code>search</code> operation, the body is set to the result of the search, see <a shape="rect" class="external-link" href="http://static.springsource.org/spring-ldap/site/apidocs/org/springframework/ldap/core/LdapTemplate.html#search%28java.lang.String,%20java.lang.String,%20int,%20org.springframework.ldap.core.AttributesMapper%29" rel="nofollow">http://static.springsource.org/spring-ldap/site/apidocs/org/springframework/ldap/core/LdapTemplate.html#search%28java.lang.String,%20java.lang.String,%20int,%20org.springframework.ldap.core.AttributesMapper%29</a>.</p><h4 id="BookInOnePage-Search">Search</h4><p>The message body must have an entry with the key <strong><code>filter</code></strong>. The value must be a String representing a valid LDAP filter, see <a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol#Search_and_Compare" rel="nofollow">http://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol#Search_and_Compare</a>.</p><h4 id="BookInOnePage-Bind">Bind</h4><p>The message body must have an entry with the key <strong><code>attributes</code></strong>. The value must be an instance of <a shape="rect" class="external-link" href="http://docs.oracle.com/javase/6/docs/api/javax/naming/directory/Attributes.html" rel="nofollow">javax.naming.directory.Attributes</a> This entry specifies the LDAP node to be created.</p><h4 id="BookInOnePage-Unbind">Unbind</h4><p>No further entries necessary, the node with the specified <strong><code>dn</code></strong> is deleted.</p><p><strong>Key definitions</strong></p><p>In order to avoid spelling errors, the following constants are defined in <code>org.apache.camel.springldap.SpringLdapProducer</code>:</p><ul><li>public static final String DN = "dn"</li><li>public static final String FILTER = "filter"</li><li>public static final String ATTRIBUTES = "attributes"</li></ul><h2 id="BookInOnePage-SpringWebServicesComponent">Spring Web Services Component</h2><p><strong>Available as of Camel 2.6</strong></p><p>The <strong>spring-ws:</strong> component allows you to integrate with <a shape="rect" class="external-link" href="http://static.springsource.org/spring-ws/sites/1.5/" rel="nofollow">Spring Web Services</a>. It offers both <em>client</em>-side support, for accessing web services, and <em>server</em>-side support for creating your own contract-first web services.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-spring-ws&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Dependencies</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>As of Camel 2.8 this component ships with Spring-WS 2.0.x which (like the rest of Camel) requires Spring 3.0.x.</p>
  <p>Earlier Camel versions shipped Spring-WS 1.5.9 which is compatible with Spring 2.5.x and 3.0.x. In order to run earlier versions of <code>camel-spring-ws</code> on Spring 2.5.x you need to add the <code>spring-webmvc</code> module from Spring 2.5.x. In order to run Spring-WS 1.5.9 on Spring 3.0.x you need to exclude the OXM module from Spring 3.0.x as this module is also included in Spring-WS 1.5.9 (see <a shape="rect" class="external-link" href="http://stackoverflow.com/questions/3313314/can-spring-ws-1-5-be-used-with-spring-3" rel="nofollow">this post</a>)</p>
 </div>
</div><h3 id="BookInOnePage-URIformat.64">URI format</h3><p>The URI scheme for this component is as follows</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">spring-ws:[mapping-type:]address[?options] </script> 
 </div>
</div><p>To expose a web service <strong>mapping-type</strong> needs to be set to any of the following:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Mapping type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>rootqname</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Offers the option to map web service requests based on the qualified name of the root element contained in the message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>soapaction</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Used to map web service requests based on the SOAP action specified in the header of the message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>uri</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>In order to map web service requests that target a specific URI.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>xpathresult</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Used to map web service requests based on the evaluation of an XPath <code>expression</code> against the incoming message. The result of the evaluation should match the XPath result specified in the endpoint URI.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>beanname</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Allows you to reference an <code>org.apache.camel.component.spring.ws.bean.CamelEndpointDispatcher</code> object in order to integrate with existing (legacy) <a shape="rect" class="external-link" href="http://static.springsource.org/spring-ws/sites/1.5/reference/html/server.html#server-endpoint-mapping" rel="nofollow">endpoint mappings</a> like <code>PayloadRootQNameEndpointMapping</code>, <code>SoapActionEndpointMapping</code>, etc</p></td></tr></tbody></table> 
 </div>
</div><p>As a consumer the <strong>address</strong> should contain a value relevant to the specified mapping-type (e.g. a SOAP action, XPath expression). As a producer the address should be set to the URI of the web service your calling upon.</p><p>You can append query <strong>options</strong> to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.71">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Required?</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>soapAction</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>SOAP action to include inside a SOAP request when accessing remote web services</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>wsAddressingAction</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>WS-Addressing 1.0 action header to include when accessing web services. The <code>To</code> header is set to the <em>address</em> of the web service as specified in the endpoint URI (default Spring-WS behavior).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">outputAction</td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="color: rgb(0,0,0);">Signifies the value for the response WS-Addressing Action<span style="color: rgb(119,183,103);">&#160;</span>header that is provided by the method.</span>&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">faultAction</td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="color: rgb(0,0,0);"><span style="line-height: 1.42857;">Signifies the value for the faultAction response WS-Addressing</span><span style="line-height: 1.42857;"><span style="color: rgb(119,183,103);">&#160;</span></span><span style="line-height: 1.42857;">Fault Action</span><span style="line-height: 1.42857;">&#160;</span><span style="line-height: 1.42857;">header that is provided by the method.</span></span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">faultTo</td><td colspan="1" rowspan="1" class="confluenceTd"><span>No</span></td><td colspan="1" rowspan="1" class="confluenceTd"><span style="color: rgb(0,0,0);">Signifies the value for the faultAction response WS-Addressing FaultTo header that is provided by the method.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">replyTo</td><td colspan="1" rowspan="1" class="confluenceTd"><span>No</span></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="color: rgb(0,0,0);">Signifies the value for the replyTo response WS-Addressing<span style="color: rgb(119,183,103);">&#160;</span>ReplyTo header that is provided by the method.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>expression</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Only when <em>mapping-type</em> is <code>xpathresult</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>XPath expression to use in the process of mapping web service requests, should match the result specified by <code>xpathresult</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>timeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong> Sets the socket read timeout (in milliseconds) while invoking a webservice using the producer, see <a shape="rect" class="external-link" href="http://docs.oracle.com/javase/6/docs/api/java/net/URLConnection.html#setReadTimeout(int)" rel="nofollow">URLConnection.setReadTimeout()</a> and <a shape="rect" class="external-link" href="http://static.springsource.org/spring-ws/site/apidocs/org/springframework/ws/transport/http/CommonsHttpMessageSender.html#setReadTimeout(int)" rel="nofollow">CommonsHttpMessageSender.setReadTimeout()</a>. &#160;This option works when using the built-in message sender implementations:&#160;<em>CommonsHttpMessageSender</em>&#160;and&#160;<em>HttpUrlConnectionMessageSender</em>. &#160;One of these implementations will be used by default for HTTP based services unless you customize the Spring WS configuration options supplied to the component. &#160;If you are using a non-standard sender, it is assumed that you will handle your own timeout configuration.<br clear="none" class="atl-forced-newline"> <strong>Camel 2.12:</strong>&#160;The built-in message sender&#160;<em>HttpComponentsMessageSender</em>&#160;is considered <strong>instead of</strong>&#160;<em>CommonsHttpMessageSender</em>&#160;which has been deprecated, see <a shape="rect" class="external-link" href="http://static.springsource.org/spring-ws/site/apidocs/org/springframework/ws/transport/http/HttpComponentsMessageSender.html#setReadTimeout(int)" rel="nofollow">HttpComponentsMessageSender.setReadTimeout()</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>sslContextParameters</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10:</strong>&#160;Reference to an&#160;<code>org.apache.camel.util.jsse.SSLContextParameters</code> in&#160;the&#160;<a shape="rect" class="external-link" href="http://camel.apache.org/registry.html">Registry</a>. &#160;See&#160;<a shape="rect" class="external-link" href="http://camel.apache.org/http4.html#HTTP4-UsingtheJSSEConfigurationUtility">Using the JSSE Configuration Utility</a>. &#160;This option works when using the built-in message sender implementations:&#160;<em>CommonsHttpMessageSender</em>&#160;and&#160;<em>HttpUrlConnectionMessageSender</em>. &#160;One of these implementations will be used by default for HTTP based services unless you customize the Spring WS configuration options supplied to the component. &#160;If you are using a non-standard sender, it is assumed that you will handle your own TLS configuration.<br clear="none" class="atl-forced-newline"> <strong>Camel 2.12:</strong>&#160;The built-in message sender&#160;<em>HttpComponentsMessageSender</em>&#160;is considered <strong>instead of</strong>&#160;<em>CommonsHttpMessageSender</em>&#160;which has been deprecated.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>webServiceTemplate</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Option to provide a custom <a shape="rect" class="external-link" href="http://static.springsource.org/spring-ws/sites/1.5/apidocs/org/springframework/ws/client/core/WebServiceTemplate.html" rel="nofollow">WebServiceTemplate</a>. This allows for full control over client-side web services handling; like adding a custom interceptor or specifying a fault resolver, message sender or message factory.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>messageSender</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Option to provide a custom <a shape="rect" class="external-link" href="http://static.springsource.org/spring-ws/sites/1.5/apidocs/org/springframework/ws/transport/WebServiceMessageSender.html" rel="nofollow">WebServiceMessageSender</a>. For example to perform authentication or use alternative transports</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>messageFactory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Option to provide a custom <a shape="rect" class="external-link" href="http://static.springsource.org/spring-ws/sites/1.5/apidocs/org/springframework/ws/WebServiceMessageFactory.html" rel="nofollow">WebServiceMessageFactory</a>. For example when you want Apache Axiom to handle web service messages instead of SAAJ</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><span>endpointMappingKey</span></td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd"><span><span>Reference to an instance of </span></span>org.apache.camel.component.spring.ws.type.EndpointMappingKey</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>endpointMapping</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Only when <em>mapping-type</em> is <code>rootqname</code>, <code>soapaction</code>, <code>uri</code> or <code>xpathresult</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Reference to an instance of <code><a shape="rect" class="external-link" href="http://org.apache.camel.component.spring.ws" rel="nofollow">org.apache.camel.component.spring.ws</a>.bean.CamelEndpointMapping</code> in the Registry/ApplicationContext. Only one bean is required in the registry to serve all Camel/Spring-WS endpoints. This bean is auto-discovered by the <a shape="rect" class="external-link" href="http://static.springsource.org/spring-ws/sites/1.5/apidocs/org/springframework/ws/server/MessageDispatcher.html" rel="nofollow">MessageDispatcher</a> and used to map requests to Camel endpoints based on characteristics specified on the endpoint (like root QName, SOAP action, etc)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">endpointDispatcher</td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd">&#160;Spring {@link <a shape="rect" class="external-link" href="http://org.springframework.ws" rel="nofollow">org.springframework.ws</a>.server.endpoint.MessageEndpoint} for dispatching messages received by Spring-WS to a Camel endpoint, to integrate with existing (legacy) endpoint mappings like PayloadRootQNameEndpointMapping, SoapActionEndpointMapping, etc.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>messageFilter</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>No</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.3</strong> Option to provide a custom MessageFilter. For example when you want to process your headers or attachments by your own.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">messageIdStrategy</td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd">A custom MessageIdStrategy to control generation of unique message ids</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><span>webServiceEndpointUri</span></td><td colspan="1" rowspan="1" class="confluenceTd">No</td><td colspan="1" rowspan="1" class="confluenceTd">The default Web Service endpoint uri to use for the producer</td></tr></tbody></table> 
 </div>
</div><h4 id="BookInOnePage-Messageheaders">Message headers</h4><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSpringWebserviceEndpointUri</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>String</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>URI of the web service your accessing as a client, overrides <em>address</em> part of the endpoint URI</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSpringWebserviceSoapAction</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>String</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Header to specify the SOAP action of the message, overrides <code>soapAction</code> option if present</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="color: rgb(0,0,0);">CamelSpringWebserviceSoapHeader</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><span>Source</span></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.11.1:</strong><span> Use this header to specify/access the SOAP headers of the message.</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSpringWebserviceAddressingAction</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>URI</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Use this header to specify the WS-Addressing action of the message, overrides <code>wsAddressingAction</code> option if present</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="color: rgb(0,0,0);">CamelSpringWebserviceAddressingFaultTo</span></p></td><td colspan="1" rowspan="1" class="confluenceTd">URI</td><td colspan="1" rowspan="1" class="confluenceTd"><span>Use this header to specify the </span>&#160;<span style="color: rgb(0,0,0);">WS-Addressing FaultTo <span>, overrides faultTo option if present</span></span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="color: rgb(0,0,0);">CamelSpringWebserviceAddressingReplyTo</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><span>URI</span></td><td colspan="1" rowspan="1" class="confluenceTd"><span>Use this header to specify the </span><span>&#160;</span><span style="color: rgb(0,0,0);">WS-Addressing ReplyTo , overrides replyTo option if present</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="color: rgb(0,0,0);">CamelSpringWebserviceAddressingOutputAction</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><span>URI</span></td><td colspan="1" rowspan="1" class="confluenceTd"><span style="color: rgb(0,0,0);"><span>Use this header to specify the</span> WS-Addressing Action<span style="color: rgb(0,0,0);"> , overrides outputAction option if present</span></span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="color: rgb(0,0,0);">CamelSpringWebserviceAddressingFaultAction</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>URI</span></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="color: rgb(0,0,0);">Use this header to specify the</span><span style="color: rgb(0,0,0);"> WS-Addressing <span style="color: rgb(0,0,0);">Fault Action</span></span><span style="color: rgb(0,0,0);"> , overrides faultAction option if present</span></p></td></tr></tbody></table> 
 </div>
</div><h2 id="BookInOnePage-Accessingwebservices">Accessing web services</h2><p>To call a web service at <code><a shape="rect" class="external-link" href="http://foo.com/bar" rel="nofollow">http://foo.com/bar</a></code> simply define a route:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:example&amp;quot;).to(&amp;quot;spring-ws:http://foo.com/bar&amp;quot;) </script> 
 </div>
</div><p>And sent a message:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">template.requestBody(&amp;quot;direct:example&amp;quot;, &amp;quot;&amp;lt;foobar xmlns=\&amp;quot;http://foo.com\&amp;quot;&amp;gt;&amp;lt;msg&amp;gt;test message&amp;lt;/msg&amp;gt;&amp;lt;/foobar&amp;gt;&amp;quot;); </script> 
 </div>
</div><p>Remember if it's a SOAP service you're calling you don't have to include SOAP tags. Spring-WS will perform the XML-to-SOAP marshaling.</p><h3 id="BookInOnePage-SendingSOAPandWS-Addressingactionheaders">Sending SOAP and WS-Addressing action headers</h3><p>When a remote web service requires a SOAP action or use of the WS-Addressing standard you define your route as:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:example&amp;quot;) .to(&amp;quot;spring-ws:http://foo.com/bar?soapAction=http://foo.com&amp;amp;wsAddressingAction=http://bar.com&amp;quot;) </script> 
 </div>
</div><p>Optionally you can override the endpoint options with header values:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">template.requestBodyAndHeader(&amp;quot;direct:example&amp;quot;, &amp;quot;&amp;lt;foobar xmlns=\&amp;quot;http://foo.com\&amp;quot;&amp;gt;&amp;lt;msg&amp;gt;test message&amp;lt;/msg&amp;gt;&amp;lt;/foobar&amp;gt;&amp;quot;, SpringWebserviceConstants.SPRING_WS_SOAP_ACTION, &amp;quot;http://baz.com&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-UsingSOAPheaders">Using SOAP headers</h3><p><strong>Available as of Camel 2.11.1</strong></p><p>You can provide the SOAP header(s) as a Camel Message header when sending a message to a spring-ws endpoint, for example given the following SOAP header in a String</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">String body = ... String soapHeader = &amp;quot;&amp;lt;h:Header xmlns:h=\&amp;quot;http://www.webserviceX.NET/\&amp;quot;&amp;gt;&amp;lt;h:MessageID&amp;gt;1234567890&amp;lt;/h:MessageID&amp;gt;&amp;lt;h:Nested&amp;gt;&amp;lt;h:NestedID&amp;gt;1111&amp;lt;/h:NestedID&amp;gt;&amp;lt;/h:Nested&amp;gt;&amp;lt;/h:Header&amp;gt;&amp;quot;; </script> 
 </div>
</div><p>We can set the body and header on the Camel Message as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">exchange.getIn().setBody(body); exchange.getIn().setHeader(SpringWebserviceConstants.SPRING_WS_SOAP_HEADER, soapHeader); </script> 
 </div>
</div><p>And then send the Exchange to a <code>spring-ws</code> endpoint to call the Web Service.</p><p>Likewise the spring-ws consumer will also enrich the Camel Message with the SOAP header.</p><p>For an example see this <a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/camel/trunk/components/camel-spring-ws/src/test/java/org/apache/camel/component/spring/ws/SoapHeaderTest.java">unit test</a>.</p><h3 id="BookInOnePage-Theheaderandattachmentpropagation">The header and attachment propagation</h3><p>Spring WS Camel supports propagation of the headers and attachments into Spring-WS WebServiceMessage response since version <strong>2.10.3</strong>.&#160;The endpoint will use so called "hook" the MessageFilter (default implementation is provided by BasicMessageFilter) to propagate the exchange headers and attachments into WebServiceMessage response.&#160;Now you can use</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">exchange.getOut().getHeaders().put(&amp;quot;myCustom&amp;quot;,&amp;quot;myHeaderValue&amp;quot;) exchange.getIn().addAttachment(&amp;quot;myAttachment&amp;quot;, new DataHandler(...)) </script> 
 </div>
</div><p>Note: If the exchange header in the pipeline contains text, it generates Qname(key)=value attribute in the soap header. Recommended is to create a QName class directly and put into any key into header.</p><h3 id="BookInOnePage-HowtouseMTOMattachments">How to use MTOM attachments</h3><p>The BasicMessageFilter provides all required information for Apache Axiom in order to produce MTOM message. If you want to use Apache Camel Spring WS within Apache Axiom, here is an example:<br clear="none"> 1. Simply define the messageFactory as is bellow and Spring-WS will use MTOM strategy to populate your SOAP message with optimized attachments.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;axiomMessageFactory&amp;quot; class=&amp;quot;org.springframework.ws.soap.axiom.AxiomSoapMessageFactory&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;payloadCaching&amp;quot; value=&amp;quot;false&amp;quot; /&amp;gt; &amp;lt;property name=&amp;quot;attachmentCaching&amp;quot; value=&amp;quot;true&amp;quot; /&amp;gt; &amp;lt;property name=&amp;quot;attachmentCacheThreshold&amp;quot; value=&amp;quot;1024&amp;quot; /&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>2. Add into your pom.xml the following dependencies</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.ws.commons.axiom&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;axiom-api&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;1.2.13&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.ws.commons.axiom&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;axiom-impl&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;1.2.13&amp;lt;/version&amp;gt; &amp;lt;scope&amp;gt;runtime&amp;lt;/scope&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><p>3. Add your attachment into the pipeline, for example using a Processor implementation.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">private class Attachement implements Processor { public void process(Exchange exchange) throws Exception { exchange.getOut().copyFrom(exchange.getIn()); File file = new File(&amp;quot;testAttachment.txt&amp;quot;); exchange.getOut().addAttachment(&amp;quot;test&amp;quot;, new DataHandler(new FileDataSource(file))); } } </script> 
 </div>
</div><p>4. Define endpoint (producer) as ussual, for example like this:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:send&amp;quot;) .process(new Attachement()) .to(&amp;quot;spring-ws:http://localhost:8089/mySoapService?soapAction=mySoap&amp;amp;messageFactory=axiomMessageFactory&amp;quot;); </script> 
 </div>
</div><p>5. Now, your producer will generate MTOM message with otpmized attachments.</p><h3 id="BookInOnePage-Thecustomheaderandattachmentfiltering">The custom header and attachment filtering</h3><p>If you need to provide your custom processing of either headers or attachments, extend existing BasicMessageFilter and override the appropriate methods or write a brand new implementation of the MessageFilter interface.<br clear="none"> To use your custom filter, add this into your spring context:</p><p>You can specify either a global a or a local message filter as follows:<br clear="none"> a) the global custom filter that provides the global configuration for all Spring-WS endpoints</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;bean id=&amp;quot;messageFilter&amp;quot; class=&amp;quot;your.domain.myMessageFiler&amp;quot; scope=&amp;quot;singleton&amp;quot; /&amp;gt; </script> 
 </div>
</div><p>or<br clear="none"> b) the local messageFilter directly on the endpoint as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">to(&amp;quot;spring-ws:http://yourdomain.com?messageFilter=#myEndpointSpecificMessageFilter&amp;quot;); </script> 
 </div>
</div><p>For more information see <a shape="rect" class="external-link" href="https://issues.apache.org/jira/browse/CAMEL-5724">CAMEL-5724</a></p><p>If you want to create your own MessageFilter, consider overriding the following methods in the default implementation of MessageFilter in class BasicMessageFilter:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">protected void doProcessSoapHeader(Message inOrOut, SoapMessage soapMessage) {your code /*no need to call super*/ } protected void doProcessSoapAttachements(Message inOrOut, SoapMessage response) { your code /*no need to call super*/ } </script> 
 </div>
</div><h3 id="BookInOnePage-UsingacustomMessageSenderandMessageFactory">Using a custom MessageSender and MessageFactory</h3><p>A custom message sender or factory in the registry can be referenced like this:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:example&amp;quot;) .to(&amp;quot;spring-ws:http://foo.com/bar?messageFactory=#messageFactory&amp;amp;messageSender=#messageSender&amp;quot;) </script> 
 </div>
</div><p>Spring configuration:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;!-- authenticate using HTTP Basic Authentication --&amp;gt; &amp;lt;bean id=&amp;quot;messageSender&amp;quot; class=&amp;quot;org.springframework.ws.transport.http.HttpComponentsMessageSender&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;credentials&amp;quot;&amp;gt; &amp;lt;bean class=&amp;quot;org.apache.commons.httpclient.UsernamePasswordCredentials&amp;quot;&amp;gt; &amp;lt;constructor-arg index=&amp;quot;0&amp;quot; value=&amp;quot;admin&amp;quot;/&amp;gt; &amp;lt;constructor-arg index=&amp;quot;1&amp;quot; value=&amp;quot;secret&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;!-- force use of Sun SAAJ implementation, http://static.springsource.org/spring-ws/sites/1.5/faq.html#saaj-jboss --&amp;gt; &amp;lt;bean id=&amp;quot;messageFactory&amp;quot; class=&amp;quot;org.springframework.ws.soap.saaj.SaajSoapMessageFactory&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;messageFactory&amp;quot;&amp;gt; &amp;lt;bean class=&amp;quot;com.sun.xml.messaging.saaj.soap.ver1_1.SOAPMessageFactory1_1Impl&amp;quot;&amp;gt;&amp;lt;/bean&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><h2 id="BookInOnePage-Exposingwebservices">Exposing web services</h2><p>In order to expose a web service using this component you first need to set-up a <a shape="rect" class="external-link" href="http://static.springsource.org/spring-ws/sites/1.5/reference/html/server.html" rel="nofollow">MessageDispatcher</a> to look for endpoint mappings in a Spring XML file. If you plan on running inside a servlet container you probably want to use a <code>MessageDispatcherServlet</code> configured in <code>web.xml</code>.</p><p>By default the <code>MessageDispatcherServlet</code> will look for a Spring XML named <code>/WEB-INF/spring-ws-servlet.xml</code>. To use Camel with Spring-WS the only mandatory bean in that XML file is <code>CamelEndpointMapping</code>. This bean allows the <code>MessageDispatcher</code> to dispatch web service requests to your routes.</p><p><em>web.xml</em></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;web-app&amp;gt; &amp;lt;servlet&amp;gt; &amp;lt;servlet-name&amp;gt;spring-ws&amp;lt;/servlet-name&amp;gt; &amp;lt;servlet-class&amp;gt;org.springframework.ws.transport.http.MessageDispatcherServlet&amp;lt;/servlet-class&amp;gt; &amp;lt;load-on-startup&amp;gt;1&amp;lt;/load-on-startup&amp;gt; &amp;lt;/servlet&amp;gt; &amp;lt;servlet-mapping&amp;gt; &amp;lt;servlet-name&amp;gt;spring-ws&amp;lt;/servlet-name&amp;gt; &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt; &amp;lt;/servlet-mapping&amp;gt; &amp;lt;/web-app&amp;gt; </script> 
 </div>
</div><p><em>spring-ws-servlet.xml</em></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;bean id=&amp;quot;endpointMapping&amp;quot; class=&amp;quot;org.apache.camel.component.spring.ws.bean.CamelEndpointMapping&amp;quot; /&amp;gt; &amp;lt;bean id=&amp;quot;wsdl&amp;quot; class=&amp;quot;org.springframework.ws.wsdl.wsdl11.DefaultWsdl11Definition&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;schema&amp;quot;&amp;gt; &amp;lt;bean class=&amp;quot;org.springframework.xml.xsd.SimpleXsdSchema&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;xsd&amp;quot; value=&amp;quot;/WEB-INF/foobar.xsd&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;property name=&amp;quot;portTypeName&amp;quot; value=&amp;quot;FooBar&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;locationUri&amp;quot; value=&amp;quot;/&amp;quot;/&amp;gt; &amp;lt;property name=&amp;quot;targetNamespace&amp;quot; value=&amp;quot;http://example.com/&amp;quot;/&amp;gt; &amp;lt;/bean&amp;gt; </script> 
 </div>
</div><p>More information on setting up Spring-WS can be found in <a shape="rect" class="external-link" href="http://static.springsource.org/spring-ws/sites/1.5/reference/html/tutorial.html" rel="nofollow">Writing Contract-First Web Services</a>. Basically paragraph 3.6 "Implementing the Endpoint" is handled by this component (specifically paragraph 3.6.2 "Routing the Message to the Endpoint" is where <code>CamelEndpointMapping</code> comes in). Also don't forget to check out the <a shape="rect" href="spring-ws-example.html">Spring Web Services Example</a> included in the Camel distribution.</p><h3 id="BookInOnePage-Endpointmappinginroutes">Endpoint mapping in routes</h3><p>With the XML configuration in-place you can now use Camel's DSL to define what web service requests are handled by your endpoint:</p><p>The following route will receive all web service requests that have a root element named "GetFoo" within the <code><a shape="rect" class="external-link" href="http://example.com/" rel="nofollow">http://example.com/</a></code> namespace.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;spring-ws:rootqname:{http://example.com/}GetFoo?endpointMapping=#endpointMapping&amp;quot;) .convertBodyTo(String.class).to(mock:example) </script> 
 </div>
</div><p>The following route will receive web service requests containing the <code><a shape="rect" class="external-link" href="http://example.com/GetFoo" rel="nofollow">http://example.com/GetFoo</a></code> SOAP action.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;spring-ws:soapaction:http://example.com/GetFoo?endpointMapping=#endpointMapping&amp;quot;) .convertBodyTo(String.class).to(mock:example) </script> 
 </div>
</div><p>The following route will receive all requests sent to <code><a shape="rect" class="external-link" href="http://example.com/foobar" rel="nofollow">http://example.com/foobar</a></code>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;spring-ws:uri:http://example.com/foobar?endpointMapping=#endpointMapping&amp;quot;) .convertBodyTo(String.class).to(mock:example) </script> 
 </div>
</div><p>The route below will receive requests that contain the element <code>&lt;foobar&gt;abc&lt;/foobar&gt;</code> anywhere inside the message (and the default namespace).</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;spring-ws:xpathresult:abc?expression=//foobar&amp;amp;endpointMapping=#endpointMapping&amp;quot;) .convertBodyTo(String.class).to(mock:example) </script> 
 </div>
</div><h3 id="BookInOnePage-Alternativeconfiguration,usingexistingendpointmappings">Alternative configuration, using existing endpoint mappings</h3><p>For every endpoint with mapping-type <code>beanname</code> one bean of type <code>CamelEndpointDispatcher</code> with a corresponding name is required in the Registry/ApplicationContext. This bean acts as a bridge between the Camel endpoint and an existing <a shape="rect" class="external-link" href="http://static.springsource.org/spring-ws/sites/1.5/reference/html/server.html#server-endpoint-mapping" rel="nofollow">endpoint mapping</a> like <code>PayloadRootQNameEndpointMapping</code>.</p><div class="confluence-information-macro confluence-information-macro-note">
 <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>The use of the <code>beanname</code> mapping-type is primarily meant for (legacy) situations where you're already using Spring-WS and have endpoint mappings defined in a Spring XML file. The <code>beanname</code> mapping-type allows you to wire your Camel route into an existing endpoint mapping. When you're starting from scratch it's recommended to define your endpoint mappings as Camel URI's (as illustrated above with <code>endpointMapping</code>) since it requires less configuration and is more expressive. Alternatively you could use vanilla Spring-WS with the help of annotations.</p>
 </div>
</div><p>An example of a route using <code>beanname</code>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;spring-ws:beanname:QuoteEndpointDispatcher&amp;quot; /&amp;gt; &amp;lt;to uri=&amp;quot;mock:example&amp;quot; /&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;bean id=&amp;quot;legacyEndpointMapping&amp;quot; class=&amp;quot;org.springframework.ws.server.endpoint.mapping.PayloadRootQNameEndpointMapping&amp;quot;&amp;gt; &amp;lt;property name=&amp;quot;mappings&amp;quot;&amp;gt; &amp;lt;props&amp;gt; &amp;lt;prop key=&amp;quot;{http://example.com/}GetFuture&amp;quot;&amp;gt;FutureEndpointDispatcher&amp;lt;/prop&amp;gt; &amp;lt;prop key=&amp;quot;{http://example.com/}GetQuote&amp;quot;&amp;gt;QuoteEndpointDispatcher&amp;lt;/prop&amp;gt; &amp;lt;/props&amp;gt; &amp;lt;/property&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;bean id=&amp;quot;QuoteEndpointDispatcher&amp;quot; class=&amp;quot;org.apache.camel.component.spring.ws.bean.CamelEndpointDispatcher&amp;quot; /&amp;gt; &amp;lt;bean id=&amp;quot;FutureEndpointDispatcher&amp;quot; class=&amp;quot;org.apache.camel.component.spring.ws.bean.CamelEndpointDispatcher&amp;quot; /&amp;gt; </script> 
 </div>
</div><h2 id="BookInOnePage-POJO(un)marshalling">POJO (un)marshalling</h2><p>Camel's <a shape="rect" href="data-format.html">pluggable data formats</a> offer support for pojo/xml marshalling using libraries such as JAXB, XStream, JibX, Castor and XMLBeans. You can use these data formats in your route to sent and receive pojo's, to and from web services.</p><p>When <em>accessing</em> web services you can marshal the request and unmarshal the response message:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">JaxbDataFormat jaxb = new JaxbDataFormat(false); jaxb.setContextPath(&amp;quot;com.example.model&amp;quot;); from(&amp;quot;direct:example&amp;quot;).marshal(jaxb).to(&amp;quot;spring-ws:http://foo.com/bar&amp;quot;).unmarshal(jaxb); </script> 
 </div>
</div><p>Similarly when <em>providing</em> web services, you can unmarshal XML requests to POJO's and marshal the response message back to XML:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;spring-ws:rootqname:{http://example.com/}GetFoo?endpointMapping=#endpointMapping&amp;quot;).unmarshal(jaxb) .to(&amp;quot;mock:example&amp;quot;).marshal(jaxb); </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.80">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-StreamComponent">Stream Component</h2><p>The <strong>stream:</strong> component provides access to the <code>System.in</code>, <code>System.out</code> and <code>System.err</code> streams as well as allowing streaming of file and URL.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-stream&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.65">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">stream:in[?options] stream:out[?options] stream:err[?options] stream:header[?options] </script> 
 </div>
</div><p>In addition, the <code>file</code> and <code>url</code> endpoint URIs are supported:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">stream:file?fileName=/foo/bar.txt stream:url[?options] </script> 
 </div>
</div><p>If the <code>stream:header</code> URI is specified, the <code>stream</code> header is used to find the stream to write to. This option is available only for stream producers (that is, it cannot appear in <code>from()</code>).</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.72">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>delay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Initial delay in milliseconds before consuming or producing the stream.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>encoding</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><em>JVM Default</em></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>You can configure the encoding (is a <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/nio/charset/Charset.html" rel="nofollow">charset name</a>) to use text-based streams (for example, message body is a <code>String</code> object). If not provided, Camel uses the <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/nio/charset/Charset.html#defaultCharset()" rel="nofollow">JVM default Charset</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>promptMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Message prompt to use when reading from <code>stream:in</code>; for example, you could set this to <code>Enter a command:</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>promptDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Optional delay in milliseconds before showing the message prompt.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>initialPromptDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>2000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Initial delay in milliseconds before showing the message prompt. This delay occurs only once. Can be used during system startup to avoid message prompts being written while other logging is done to the system out.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>fileName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>When using the <code>stream:file</code> URI format, this option specifies the filename to stream to/from.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>url</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>When using the <code>stream:url</code> URI format, this option specifies the URL to stream to/from. The input/output stream will be opened using the <a shape="rect" class="external-link" href="http://docs.oracle.com/javase/6/docs/api/java/net/URLConnection.html" rel="nofollow">JDK URLConnection</a> facility.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>scanStream</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>To be used for continuously reading a stream such as the unix <code>tail</code> command. <br clear="none"> <strong>Camel 2.4 to Camel 2.6:</strong> will retry opening the file if it is overwritten, somewhat like <code>tail --retry</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>retry</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.7:</strong> will retry opening the file if it's overwritten, somewhat like <code>tail --retry</code></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>scanStreamDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Delay in milliseconds between read attempts when using <code>scanStream</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>groupLines</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.5:</strong> To group X number of lines in the consumer. For example to group 10 lines and therefore only spit out an <a shape="rect" href="exchange.html">Exchange</a> with 10 lines, instead of 1 <a shape="rect" href="exchange.html">Exchange</a> per line.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>autoCloseCount</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.10.0:</strong> (2.9.3 and 2.8.6) Number of messages to process before closing stream on Producer side. Never close stream by default (only when Producer is stopped). If more messages are sent, the stream is reopened for another <code>autoCloseCount</code> batch.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>closeOnDone</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.0:</strong> This option is used in combination with <a shape="rect" href="splitter.html">Splitter</a> and streaming to the same file. The idea is to keep the stream open and only close when the <a shape="rect" href="splitter.html">Splitter</a> is done, to improve performance. Mind this requires that you only stream to the same file, and not 2 or more files, and that the last split message that carries the information that its the last, is routed to the stream endpoint so it gets the signal to close.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Messagecontent">Message content</h3><p>The <strong>stream:</strong> component supports either <code>String</code> or <code>byte[]</code> for writing to streams. Just add either <code>String</code> or <code>byte[]</code> content to the <code>message.in.body</code>. Messages sent to the <strong>stream:</strong> producer in binary mode are not followed by the newline character (as opposed to the <code>String</code> messages). Message with <code>null</code> body will not be appended to the output stream.<br clear="none"> The special <code>stream:header</code> URI is used for custom output streams. Just add a <code>java.io.OutputStream</code> object to <code>message.in.header</code> in the key <code>header</code>.<br clear="none"> See samples for an example.</p><h3 id="BookInOnePage-Samples.18">Samples</h3><p>In the following sample we route messages from the <code>direct:in</code> endpoint to the <code>System.out</code> stream:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// Route messages to the standard output. from(&amp;quot;direct:in&amp;quot;).to(&amp;quot;stream:out&amp;quot;); // Send String payload to the standard output. // Message will be followed by the newline. template.sendBody(&amp;quot;direct:in&amp;quot;, &amp;quot;Hello Text World&amp;quot;); // Send byte[] payload to the standard output. // No newline will be added after the message. template.sendBody(&amp;quot;direct:in&amp;quot;, &amp;quot;Hello Bytes World&amp;quot;.getBytes()); </script> 
 </div>
</div><p>The following sample demonstrates how the header type can be used to determine which stream to use. In the sample we use our own output stream, <code>MyOutputStream</code>.
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> private OutputStream mystream = new MyOutputStream(); private StringBuilder sb = new StringBuilder(); @Test public void testStringContent() { template.sendBody(&amp;quot;direct:in&amp;quot;, &amp;quot;Hello&amp;quot;); // StreamProducer appends \n in text mode assertEquals(&amp;quot;Hello\n&amp;quot;, sb.toString()); } @Test public void testBinaryContent() { template.sendBody(&amp;quot;direct:in&amp;quot;, &amp;quot;Hello&amp;quot;.getBytes()); // StreamProducer is in binary mode so no \n is appended assertEquals(&amp;quot;Hello&amp;quot;, sb.toString()); } protected RouteBuilder createRouteBuilder() { return new RouteBuilder() { public void configure() { from(&amp;quot;direct:in&amp;quot;).setHeader(&amp;quot;stream&amp;quot;, constant(mystream)). to(&amp;quot;stream:header&amp;quot;); } }; } private class MyOutputStream extends OutputStream { public void write(int b) throws IOException { sb.append((char)b); } } </script> 
  </div>
 </div>The following sample demonstrates how to continuously read a file stream (analogous to the UNIX <code>tail</code> command):<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;stream:file?fileName=/server/logs/server.log&amp;amp;scanStream=true&amp;amp;scanStreamDelay=1000&amp;quot;).to(&amp;quot;bean:logService?method=parseLogLine&amp;quot;); </script> 
 </div>
</div><p>One gotcha with scanStream (pre Camel 2.7) or scanStream + retry is the file will be re-opened and scanned with each iteration of scanStreamDelay. Until NIO2 is available we cannot reliably detect when a file is deleted/recreated.</p><p></p><h3 id="BookInOnePage-SeeAlso.81">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-StringTemplate">String Template</h2><p>The <strong>string-template:</strong> component allows you to process a message using a <a shape="rect" class="external-link" href="http://www.stringtemplate.org/" rel="nofollow">String Template</a>. This can be ideal when using <a shape="rect" href="templating.html">Templating</a> to generate responses for requests.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-stringtemplate&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.66">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">string-template:templateName[?options] </script> 
 </div>
</div><p>Where <strong>templateName</strong> is the classpath-local URI of the template to invoke; or the complete URL of the remote template.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.73">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> Option </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Default </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> Description </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>contentCache</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>false</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Cache for the resource content when its loaded. <br clear="none" class="atl-forced-newline"> Note : as of <strong>Camel 2.9</strong> cached resource content can be cleared via JMX using the endpoint's <code>clearContentCache</code> operation. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>delimiterStart</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>null</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Since Camel 2.11.1</strong>, configuring the variable start delimiter </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>delimiterStop</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>null</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>Since Camel 2.11.1</strong>, configuring the variable end delimiter </p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Headers.5">Headers</h3><p>Camel will store a reference to the resource in the message header with key, <code>org.apache.camel.stringtemplate.resource</code>. The Resource is an <code>org.springframework.core.io.Resource</code> object.</p><h3 id="BookInOnePage-Hotreloading.1">Hot reloading</h3><p>The string template resource is by default hot-reloadable for both file and classpath resources (expanded jar). If you set <code>contentCache=true</code>, Camel loads the resource only once and hot-reloading is not possible. This scenario can be used in production when the resource never changes.</p><h3 id="BookInOnePage-StringTemplateAttributes">StringTemplate Attributes</h3><p>Camel will provide exchange information as attributes (just a <code>java.util.Map</code>) to the string template. The Exchange is transfered as:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> key </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> value </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>exchange</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The Exchange itself. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>headers</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The headers of the In message. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>camelContext</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The Camel Context. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>request</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The In message. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>in</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The In message. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>body</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The In message body. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>out</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The Out message (only for InOut message exchange pattern). </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <code>response</code> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> The Out message (only for InOut message exchange pattern). </p></td></tr></tbody></table> 
 </div>
</div><p>Since Camel 2.14, you can define the custom context map by setting the message header "<strong><span style="line-height: 1.4285715;">CamelStringTemplateVariableMap</span></strong><span style="line-height: 1.4285715;">" just like the below code.</span></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Map&amp;lt;String, Object&amp;gt; variableMap = new HashMap&amp;lt;String, Object&amp;gt;(); Map&amp;lt;String, Object&amp;gt; headersMap = new HashMap&amp;lt;String, Object&amp;gt;(); headersMap.put(&amp;quot;name&amp;quot;, &amp;quot;Willem&amp;quot;); variableMap.put(&amp;quot;headers&amp;quot;, headersMap); variableMap.put(&amp;quot;body&amp;quot;, &amp;quot;Monday&amp;quot;); variableMap.put(&amp;quot;exchange&amp;quot;, exchange); exchange.getIn().setHeader(&amp;quot;CamelStringTemplateVariableMap&amp;quot;, variableMap); </script> 
 </div>
</div><h3 id="BookInOnePage-Samples.19">Samples</h3><p>For example you could use a string template as follows in order to formulate a response to a message:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:My.Queue&amp;quot;). to(&amp;quot;string-template:com/acme/MyResponse.tm&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-TheEmailSample.1">The Email Sample</h3><p>In this sample we want to use a string template to send an order confirmation email. The email template is laid out in <code>StringTemplate</code> as:<br clear="none"> This example works for <strong>camel 2.11.0</strong>. If your camel version is less than 2.11.0, the variables should be started and ended with $.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Dear &amp;lt;headers.lastName&amp;gt;, &amp;lt;headers.firstName&amp;gt; Thanks for the order of &amp;lt;headers.item&amp;gt;. Regards Camel Riders Bookstore &amp;lt;body&amp;gt; </script> 
 </div>
</div><p>And the java code is as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> private Exchange createLetter() { Exchange exchange = context.getEndpoint(&amp;quot;direct:a&amp;quot;).createExchange(); Message msg = exchange.getIn(); msg.setHeader(&amp;quot;firstName&amp;quot;, &amp;quot;Claus&amp;quot;); msg.setHeader(&amp;quot;lastName&amp;quot;, &amp;quot;Ibsen&amp;quot;); msg.setHeader(&amp;quot;item&amp;quot;, &amp;quot;Camel in Action&amp;quot;); msg.setBody(&amp;quot;PS: Next beer is on me, James&amp;quot;); return exchange; } @Test public void testVelocityLetter() throws Exception { MockEndpoint mock = getMockEndpoint(&amp;quot;mock:result&amp;quot;); mock.expectedMessageCount(1); mock.expectedBodiesReceived(&amp;quot;Dear Ibsen, Claus! Thanks for the order of Camel in Action. Regards Camel Riders Bookstore PS: Next beer is on me, James&amp;quot;); template.send(&amp;quot;direct:a&amp;quot;, createLetter()); mock.assertIsSatisfied(); } protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { public void configure() throws Exception { from(&amp;quot;direct:a&amp;quot;).to(&amp;quot;string-template:org/apache/camel/component/stringtemplate/letter.tm&amp;quot;).to(&amp;quot;mock:result&amp;quot;); } }; } </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.82">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-SQLComponent">SQL Component</h2><p>The <strong>sql:</strong> component allows you to work with databases using JDBC queries. The difference between this component and <a shape="rect" href="jdbc.html">JDBC</a> component is that in case of SQL the query is a property of the endpoint and it uses message payload as parameters passed to the query.</p><p>This component uses <code><strong>spring-jdbc</strong></code> behind the scenes for the actual SQL handling.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-sql&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><p>The SQL component also supports:</p><ul class="alternate"><li>a JDBC based repository for the <a shape="rect" href="idempotent-consumer.html">Idempotent Consumer</a> EIP pattern. See further below.</li><li>a JDBC based repository for the <a shape="rect" href="aggregator2.html">Aggregator</a> EIP pattern. See further below.</li></ul><h3 id="BookInOnePage-URIformat.67">URI format</h3><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>From Camel 2.11 onwards this component can create both consumer (e.g. <code>from()</code>) and producer endpoints (e.g. <code>to()</code>).</p>
  <p>In previous versions, it could only act as a producer.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-information">
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>This component can be used as a <a shape="rect" class="external-link" href="http://camel.apache.org/transactional-client.html">Transactional Client</a>.</p>
 </div>
</div><p>The SQL component uses the following endpoint URI notation:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">sql:select * from table where id=# order by name[?options] </script> 
 </div>
</div><p>From Camel 2.11 onwards you can use named parameters by using :<code>#name_of_the_parameter</code> style as shown:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">sql:select * from table where id=:#myId order by name[?options] </script> 
 </div>
</div><p>When using named parameters, Camel will lookup the names from, in the given precedence:<br clear="none"> 1. from message body if its a <code>java.util.Map</code><br clear="none"> 2. from message headers</p><p>If a named parameter cannot be resolved, then an exception is thrown.</p><p>From <strong>Camel 2.14</strong> onward you can use Simple expressions as parameters as shown:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">sql:select * from table where id=:#${property.myId} order by name[?options]</script> 
 </div>
</div><p>Notice that the standard <code>?</code> symbol that denotes the parameters to an SQL query is substituted with the <code>#</code> symbol, because the <code>?</code> symbol is used to specify options for the endpoint. The <code>?</code> symbol replacement can be configured on endpoint basis.</p><p>From <strong>Camel 2.17</strong> onwards you can externalize your SQL queries to files in the classpath or file system as shown:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">sql:classpath:sql/myquery.sql[?options]</script> 
 </div>
</div><p>And the myquery.sql file is in the classpath and is just a plain text</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">-- this is a comment select * from table where id = :#${property.myId} order by name</script> 
 </div>
</div><p>In the file you can use multilines and format the SQL as you wish. And also use comments such as the&#160;&#8211; dash line.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.74">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>batch</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.7.5, 2.8.4 and 2.9:</strong> Execute SQL batch update statements. See notes below on how the treatment of the inbound message body changes if this is set to <code>true</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>dataSourceRef</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Deprecated and will be removed in Camel 3.0:</strong> Reference to a <code>DataSource</code> to look up in the registry. Use <code>dataSource=#theName</code> instead.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>dataSource</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> Reference to a <code>DataSource</code> to look up in the registry.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>placeholder</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>#</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.4:</strong> Specifies a character that will be replaced to <code>?</code> in SQL query. Notice, that it is simple <code>String.replaceAll()</code> operation and no SQL parsing is involved (quoted strings will also change). This replacement is <strong>only</strong> happening if the endpoint is created using the <code>SqlComponent</code>. If you manually create the endpoint, then use the expected <code>?</code> sign instead.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>usePlaceholder</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>boolean</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>true</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.17:</strong> Sets whether to use placeholder and replace all placeholder characters with ? sign in the SQL queries.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>template.&lt;xxx&gt;</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Sets additional options on the Spring <code>JdbcTemplate</code> that is used behind the scenes to execute the queries. For instance, <code>template.maxRows=10</code>. For detailed documentation, see the <a shape="rect" class="external-link" href="http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/jdbc/core/JdbcTemplate.html" rel="nofollow">JdbcTemplate javadoc</a> documentation.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>allowNamedParameters</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> Whether to allow using named parameters in the queries.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>processingStrategy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>SQL consumer only:</strong> Allows to plugin to use a custom <code>org.apache.camel.component.sql.SqlProcessingStrategy</code> to execute queries when the consumer has processed the rows/batch.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>prepareStatementStrategy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> Allows to plugin to use a custom <code>org.apache.camel.component.sql.SqlPrepareStatementStrategy</code> to control preparation of the query and prepared statement.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.delay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>long</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>500</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>SQL consumer only:</strong> Delay in milliseconds between each poll.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.initialDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>long</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>SQL consumer only:</strong> Milliseconds before polling starts.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>consumer.useFixedDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>SQL consumer only:</strong> Set to <code>true</code> to use fixed delay between polls, otherwise fixed rate is used. See <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ScheduledExecutorService.html" rel="nofollow">ScheduledExecutorService</a> in JDK for details.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>maxMessagesPerPoll</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>int</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>SQL consumer only:</strong> An integer value to define the maximum number of messages to gather per poll. By default, no maximum is set.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>useIterator</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>SQL consumer only:</strong> If <code>true</code> each row returned when polling will be processed individually. If <code>false</code> the entire <code>java.util.List</code> of data is set as the IN body.<span> Notice in Camel 2.15.x or older you need to prefix this option with consumer., eg consumer.useIterator=true.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>routeEmptyResultSet</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>SQL consumer only:</strong> Whether to route a single empty <a shape="rect" href="exchange.html">Exchange</a> if there was no data to poll.<span> Notice in Camel 2.15.x or older you need to prefix this option with consumer., eg consumer.useIterator=true.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>onConsume</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>SQL consumer only:</strong> After processing each row then this query can be executed, if the <a shape="rect" href="exchange.html">Exchange</a> was processed successfully, for example to mark the row as processed. The query can have parameter.<span> Notice in Camel 2.15.x or older you need to prefix this option with consumer., eg consumer.useIterator=true.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>onConsumeFailed</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>SQL consumer only:</strong> After processing each row then this query can be executed, if the <a shape="rect" href="exchange.html">Exchange</a> failed, for example to mark the row as failed. The query can have parameter.<span> Notice in Camel 2.15.x or older you need to prefix this option with consumer., eg consumer.useIterator=true.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>onConsumeBatchComplete</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>SQL consumer only:</strong> After processing the entire batch, this query can be executed to bulk update rows etc. The query cannot have parameters.<span> Notice in Camel 2.15.x or older you need to prefix this option with consumer., eg consumer.useIterator=true.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>expectedUpdateCount</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>int</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>-1</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>SQL consumer only:</strong> If using <code>consumer.onConsume</code> then this option can be used to set an expected number of rows being updated. Typically you may set this to <code>1</code> to expect one row to be updated.<span> Notice in Camel 2.15.x or older you need to prefix this option with consumer., eg consumer.useIterator=true.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>breakBatchOnConsumeFail</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>SQL consumer only:</strong> If using <code>consumer.onConsume</code> and it fails, then this option controls whether to break out of the batch or continue processing the next row from the batch. Notice in Camel 2.15.x or older you need to prefix this option with consumer., eg consumer.useIterator=true.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>alwaysPopulateStatement</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> <strong>SQL producer only:</strong> If enabled then the <code>populateStatement</code> method from <code>org.apache.camel.component.sql.SqlPrepareStatementStrategy</code> is always invoked, also if there is no expected parameters to be prepared. When this is <code>false</code> then the <code>populateStatement</code> is only invoked if there is 1 or more expected parameters to be set; for example this avoids reading the message body/headers for SQL queries with no parameters.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>separator</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>char</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>,</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.1:</strong> The separator to use when parameter values is taken from message body (if the body is a String type), to be inserted at # placeholders. Notice if you use named parameters, then a <code>Map</code> type is used instead.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>outputType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>SelectList</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12.0:</strong> <span>outputType='SelectList', for consumer or producer, w</span><span>ill output a List of Map</span>. <code>SelectOne</code> will output single Java object in the following way:<br clear="none"> a) If the query has only single column, then that JDBC Column object is returned. (such as <code>SELECT COUNT( * ) FROM PROJECT</code> will return a Long object.<br clear="none"> b) If the query has more than one column, then it will return a Map of that result.<br clear="none"> c) If the <code>outputClass</code> is set, then it will convert the query result into an Java bean object by calling all the setters that match the column names. It will assume your class has a default constructor to create instance with.<br clear="none"> d) If the query resulted in more than one rows, it throws an non-unique result exception.</p><p>From <strong>Camel 2.14.1</strong> onwards the SelectList also supports mapping each row to a Java object as the SelectOne does <span>(only step c)</span>.</p><p>From <strong>Camel 2.18</strong> onwards there is a new StreamList outputType that streams the result of the query using an Iterator. It can be used with the <a shape="rect" href="splitter.html">Splitter</a> EIP in streaming mode to process the ResultSet in streaming fashion. This StreamList do not support batch mode, but you can use outputClass to map each row to a class.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>outputClass</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12.0:</strong> Specify the full package and class name to use as conversion when <code>outputType=SelectOne</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>outputHeader</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>String</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>null</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.15:</strong> To store the result as a header instead of the message body. This allows to preserve the existing message body as-is.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>parametersCount</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>int</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11.2/2.12.0</strong> If set greater than zero, then Camel will use this count value of parameters to replace instead of querying via JDBC metadata API. This is useful if the JDBC vendor could not return correct parameters count, then user may override instead.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>noop</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>boolean</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12.0</strong> If set, will ignore the results of the SQL query and use the existing IN message as the OUT message for the continuation of processing</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>useMessageBodyForSql</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>boolean</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16:</strong> Whether to use the message body as the SQL and then headers for parameters. If this option is enabled then the SQL in the uri is not used. The SQL parameters must then be provided in a header with the key <code>CamelSqlParameters</code>. This option is only for the producer.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>transacted</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>boolean</code></td><td colspan="1" rowspan="1" class="confluenceTd"><code>false</code></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.16.2:</strong> <strong>SQL consumer only:</strong>Enables or disables transaction. If enabled then if processing an exchange failed then the consumer break out processing any further exchanges to cause a rollback eager</td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Treatmentofthemessagebody">Treatment of the message body</h3><p>The SQL component tries to convert the message body to an object of <code>java.util.Iterator</code> type and then uses this iterator to fill the query parameters (where each query parameter is represented by a <code>#</code> symbol (or configured placeholder) in the endpoint URI). If the message body is not an array or collection, the conversion results in an iterator that iterates over only one object, which is the body itself.</p><p>For example, if the message body is an instance of <code>java.util.List</code>, the first item in the list is substituted into the first occurrence of <code>#</code> in the SQL query, the second item in the list is substituted into the second occurrence of <code>#</code>, and so on.</p><p>If <code>batch</code> is set to <code>true</code>, then the interpretation of the inbound message body changes slightly &#8211; instead of an iterator of parameters, the component expects an iterator that contains the parameter iterators; the size of the outer iterator determines the batch size.</p><p>From Camel 2.16 onwards you can use the option&#160;<span>useMessageBodyForSql that allows to use the message body as the SQL statement, and then the SQL parameters must be provided in a header with the key&#160;SqlConstants.SQL_PARAMETERS. This allows the SQL component to work more dynamic as the SQL query is from the message body.</span></p><h3 id="BookInOnePage-Resultofthequery">Result of the query</h3><p>For <code>select</code> operations, the result is an instance of <code>List&lt;Map&lt;String, Object&gt;&gt;</code> type, as returned by the <a shape="rect" class="external-link" href="http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/jdbc/core/JdbcTemplate.html#queryForList(java.lang.String,%20java.lang.Object%91%93)" rel="nofollow">JdbcTemplate.queryForList()</a> method. For <code>update</code> operations, the result is the number of updated rows, returned as an <code>Integer</code>.</p><p>By default, the result is placed in the message body.&#160; If the outputHeader parameter is set, the result is placed in the header.&#160; This is an alternative to using a full message enrichment pattern to add headers, it provides a concise syntax for querying a sequence or some other small value into a header.&#160; It is convenient to use outputHeader and outputType together:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;jms:order.inbox&amp;quot;) .to(&amp;quot;sql:select order_seq.nextval from dual?outputHeader=OrderId&amp;amp;outputType=SelectOne&amp;quot;) .to(&amp;quot;jms:order.booking&amp;quot;);</script> 
 </div>
</div><h3 id="BookInOnePage-UsingStreamList">Using StreamList</h3><p>From<strong> Camel 2.18</strong> onwards the producer supports outputType=StreamList that uses an iterator to stream the output of the query. This allows to process the data in a streaming fashion which for example can be used by the&#160;<a shape="rect" href="splitter.html">Splitter</a> EIP to process each row one at a time, and load data from the database as needed.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:withSplitModel&amp;quot;) .to(&amp;quot;sql:select * from projects order by id?outputType=StreamList&amp;amp;outputClass=org.apache.camel.component.sql.ProjectModel&amp;quot;) .to(&amp;quot;log:stream&amp;quot;) .split(body()).streaming() .to(&amp;quot;log:row&amp;quot;) .to(&amp;quot;mock:result&amp;quot;) .end();</script> 
 </div>
</div><p>&#160;</p><h3 id="BookInOnePage-Headervalues">Header values</h3><p>When performing <code>update</code> operations, the SQL Component stores the update count in the following message headers:</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSqlUpdateCount</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The number of rows updated for <code>update</code> operations, returned as an <code>Integer</code> object. <span>T</span><span>his header&#160;is not provided when using outputType=StreamList.</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSqlRowCount</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The number of rows returned for <code>select</code> operations, returned as an <code>Integer</code> object. This header&#160;is not provided when using outputType=StreamList.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelSqlQuery</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> Query to execute. This query takes precedence over the query specified in the endpoint URI. Note that query parameters in the header <em>are</em> represented by a <code>?</code> instead of a <code>#</code> symbol</p></td></tr></tbody></table>
</div><p>When performing&#160;<code>insert</code> operations, the SQL Component stores the rows with the generated keys and number of these rown in the following message headers (<strong>Available as of Camel 2.12.4, 2.13.1</strong>):</p><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><pre>CamelSqlGeneratedKeysRowCount</pre></td><td colspan="1" rowspan="1" class="confluenceTd">The number of rows in the header that contains generated keys.</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><pre>CamelSqlGeneratedKeyRows</pre></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;Rows that contains the generated keys (a list of maps of keys).</td></tr></tbody></table>
</div><h3 id="BookInOnePage-Generatedkeys.1">Generated keys</h3><p><strong>Available as of Camel 2.12.4, 2.13.1 and 2.14<br clear="none"></strong></p><p>If you insert data using SQL INSERT, then the RDBMS may support auto generated keys. You can instruct the SQL producer to return the generated keys in headers.<br clear="none"> To do that set the header <code>CamelSqlRetrieveGeneratedKeys=true</code>. Then the generated keys will be provided as headers with the keys listed in the table above.</p><p>You can see more details in this <a shape="rect" class="external-link" href="https://git-wip-us.apache.org/repos/asf?p=camel.git;a=blob_plain;f=components/camel-sql/src/test/java/org/apache/camel/component/sql/SqlGeneratedKeysTest.java;hb=3962b23f94bb4bc23011b931add08c3f6833c82e">unit test</a>.</p><h3 id="BookInOnePage-Configuration.1">Configuration</h3><p>You can now set a reference to a <code>DataSource</code> in the URI directly:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">sql:select * from table where id=# order by name?dataSource=myDS </script> 
 </div>
</div><h3 id="BookInOnePage-Sample.4">Sample</h3><p>In the sample below we execute a query and retrieve the result as a <code>List</code> of rows, where each row is a <code>Map&lt;String, Object</code> and the key is the column name.</p><p>First, we set up a table to use for our sample. As this is based on an unit test, we do it in java:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> // this is the database we create with some initial data for our unit test db = new EmbeddedDatabaseBuilder() .setType(EmbeddedDatabaseType.DERBY).addScript(&amp;quot;sql/createAndPopulateDatabase.sql&amp;quot;).build(); </script> 
  </div>
 </div>The SQL script <code>createAndPopulateDatabase.sql</code> we execute looks like as described below:
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: sql; gutter: false; theme: Default" type="syntaxhighlighter"> create table projects (id integer primary key, project varchar(10), license varchar(5)); insert into projects values (1, &amp;#39;Camel&amp;#39;, &amp;#39;ASF&amp;#39;); insert into projects values (2, &amp;#39;AMQ&amp;#39;, &amp;#39;ASF&amp;#39;); insert into projects values (3, &amp;#39;Linux&amp;#39;, &amp;#39;XXX&amp;#39;); </script> 
  </div>
 </div>Then we configure our route and our <code>sql</code> component. Notice that we use a <code>direct</code> endpoint in front of the <code>sql</code> endpoint. This allows us to send an exchange to the <code>direct</code> endpoint with the URI, <code>direct:simple</code>, which is much easier for the client to use than the long <code>sql:</code> URI. Note that the <code>DataSource</code> is looked up up in the registry, so we can use standard Spring XML to configure our <code>DataSource</code>.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:simple&amp;quot;) .to(&amp;quot;sql:select * from projects where license = # order by id?dataSource=#jdbc/myDataSource&amp;quot;) .to(&amp;quot;mock:result&amp;quot;); </script> 
  </div>
 </div>And then we fire the message into the <code>direct</code> endpoint that will route it to our <code>sql</code> component that queries the database.
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> MockEndpoint mock = getMockEndpoint(&amp;quot;mock:result&amp;quot;); mock.expectedMessageCount(1); // send the query to direct that will route it to the sql where we will execute the query // and bind the parameters with the data from the body. The body only contains one value // in this case (XXX) but if we should use multi values then the body will be iterated // so we could supply a List&amp;lt;String&amp;gt; instead containing each binding value. template.sendBody(&amp;quot;direct:simple&amp;quot;, &amp;quot;XXX&amp;quot;); mock.assertIsSatisfied(); // the result is a List List&amp;lt;?&amp;gt; received = assertIsInstanceOf(List.class, mock.getReceivedExchanges().get(0).getIn().getBody()); // and each row in the list is a Map Map&amp;lt;?, ?&amp;gt; row = assertIsInstanceOf(Map.class, received.get(0)); // and we should be able the get the project from the map that should be Linux assertEquals(&amp;quot;Linux&amp;quot;, row.get(&amp;quot;PROJECT&amp;quot;)); </script> 
  </div>
 </div>We could configure the <code>DataSource</code> in Spring XML as follows:<div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;jee:jndi-lookup id=&amp;quot;myDS&amp;quot; jndi-name=&amp;quot;jdbc/myDataSource&amp;quot;/&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-Usingnamedparameters.1">Using named parameters</h4><p><strong>Available as of Camel 2.11</strong></p><p>In the given route below, we want to get all the projects from the projects table. Notice the SQL query has 2 named parameters, :#lic and :#min.<br clear="none"> Camel will then lookup for these parameters from the message body or message headers. Notice in the example above we set two headers with constant value<br clear="none"> for the named parameters:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:projects&amp;quot;) .setHeader(&amp;quot;lic&amp;quot;, constant(&amp;quot;ASF&amp;quot;)) .setHeader(&amp;quot;min&amp;quot;, constant(123)) .to(&amp;quot;sql:select * from projects where license = :#lic and id &amp;gt; :#min order by id&amp;quot;) </script> 
 </div>
</div><p>Though if the message body is a <code>java.util.Map</code> then the named parameters will be taken from the body.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:projects&amp;quot;) .to(&amp;quot;sql:select * from projects where license = :#lic and id &amp;gt; :#min order by id&amp;quot;) </script> 
 </div>
</div><h4 id="BookInOnePage-Usingexpressionparameters">Using expression parameters</h4><p><strong>Available as of Camel 2.14</strong></p><p>In the given route below, we want to get all the project from the database. It uses the body of the exchange for defining the license and uses the value of a property as the second parameter.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:projects&amp;quot;) .setBody(constant(&amp;quot;ASF&amp;quot;)) .setProperty(&amp;quot;min&amp;quot;, constant(123)) .to(&amp;quot;sql:select * from projects where license = :#${body} and id &amp;gt; :#${property.min} order by id&amp;quot;)</script> 
 </div>
</div><h4 id="BookInOnePage-UsingINquerieswithdynamicvalues">Using IN queries with dynamic values</h4><p><strong>Available as of Camel 2.17</strong></p><p>From Camel 2.17 onwards the SQL producer allows to use SQL queries with IN statements where the IN values is dynamic computed. For example from the message body or a header etc.</p><p>To use IN you need to:</p><ul><li><span style="line-height: 1.42857;">prefix the parameter name with&#160;<code>in:</code></span></li><li><span style="line-height: 1.42857;">add <code>( )</code>&#160;around the parameter</span></li></ul><p><span style="line-height: 1.42857;">An example explains this better. The following query is used:</span></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">-- this is a comment select * from projects where project in (:#in:names) order by id</script> 
 </div>
</div><p><span style="line-height: 1.42857;">In the following route:</span></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:query&amp;quot;) .to(&amp;quot;sql:classpath:sql/selectProjectsIn.sql&amp;quot;) .to(&amp;quot;log:query&amp;quot;) .to(&amp;quot;mock:query&amp;quot;);</script> 
 </div>
</div><p><span style="line-height: 1.42857;">Then the IN query can use a header with the key names with the dynamic values such as:</span></p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">// use an array template.requestBodyAndHeader(&amp;quot;direct:query&amp;quot;, &amp;quot;Hi there!&amp;quot;, &amp;quot;names&amp;quot;, new String[]{&amp;quot;Camel&amp;quot;, &amp;quot;AMQ&amp;quot;}); // use a list List&amp;lt;String&amp;gt; names = new ArrayList&amp;lt;String&amp;gt;(); names.add(&amp;quot;Camel&amp;quot;); names.add(&amp;quot;AMQ&amp;quot;); template.requestBodyAndHeader(&amp;quot;direct:query&amp;quot;, &amp;quot;Hi there!&amp;quot;, &amp;quot;names&amp;quot;, names); // use a string separated values with comma template.requestBodyAndHeader(&amp;quot;direct:query&amp;quot;, &amp;quot;Hi there!&amp;quot;, &amp;quot;names&amp;quot;, &amp;quot;Camel,AMQ&amp;quot;);</script> 
 </div>
</div><p>The query can also be specified in the endpoint instead of being externalized (notice that externalizing makes maintaining the SQL queries easier)</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:query&amp;quot;) .to(&amp;quot;sql:select * from projects where project in (:#in:names) order by id&amp;quot;) .to(&amp;quot;log:query&amp;quot;) .to(&amp;quot;mock:query&amp;quot;);</script> 
 </div>
</div><p>&#160;</p><h2 id="BookInOnePage-UsingtheJDBCbasedidempotentrepository">Using the JDBC based idempotent repository</h2><p><strong>Available as of Camel 2.7</strong>: In this section we will use the JDBC based idempotent repository.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Abstract class</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  &#160;
 </div>
</div><p>From Camel 2.9 onwards there is an abstract class <code>org.apache.camel.processor.idempotent.jdbc.AbstractJdbcMessageIdRepository</code> you can extend to build custom JDBC idempotent repository.</p><p>&#160;</p><p>First we have to create the database table which will be used by the idempotent repository. For <strong>Camel 2.7</strong>, we use the following schema:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: sql; gutter: false; theme: Default" type="syntaxhighlighter">&nbsp;</script> 
 </div>
</div><p>CREATE TABLE CAMEL_MESSAGEPROCESSED ( processorName VARCHAR(255), messageId VARCHAR(100) )</p><p>&#160;</p><p>In <strong>Camel 2.8</strong>, we added the createdAt column:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: sql; gutter: false; theme: Default" type="syntaxhighlighter">&nbsp;</script> 
 </div>
</div><p>CREATE TABLE CAMEL_MESSAGEPROCESSED ( processorName VARCHAR(255), messageId VARCHAR(100), createdAt TIMESTAMP )</p><p>&#160;</p><p>&#160;</p><div class="confluence-information-macro confluence-information-macro-warning">
 <span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  &#160;
 </div>
</div><p class="wysiwyg-macro-body">The SQL Server&#160;<strong>TIMESTAMP</strong> type is a fixed-length binary-string type. It does not map to any of the JDBC time types: <strong>DATE</strong>, <strong>TIME</strong>, or <strong>TIMESTAMP</strong>.</p><p>&#160;</p><p>&#160;</p><p>We recommend to have a unique constraint on the columns processorName and messageId. Because the syntax for this constraint differs for database to database, we do not show it here.</p><p>Second we need to setup a <code>javax.sql.DataSource</code> in the spring XML file:</p><p>&#160;</p><p>{snippet:id=e1|lang=xml|url=camel/trunk/components/camel-sql/src/test/resources/org/apache/camel/processor/idempotent/jdbc/spring.xml}</p><p>&#160;</p><p>&#160;</p><p>And finally we can create our JDBC idempotent repository in the spring XML file as well:</p><p>&#160;</p><p>{snippet:id=e2|lang=xml|url=camel/trunk/components/camel-sql/src/test/resources/org/apache/camel/processor/idempotent/jdbc/spring.xml}</p><p>&#160;</p><p>&#160;</p><p>Customize the JdbcMessageIdRepository</p><p>Starting with <strong>Camel 2.9.1</strong> you have a few options to tune the <code>org.apache.camel.processor.idempotent.jdbc.JdbcMessageIdRepository</code> for your needs:</p><p class="confluenceTable">&#160;</p><p>&#160;</p><p class="confluenceTh">&#160;</p><p>Parameter</p><p>&#160;</p><p class="confluenceTh">&#160;</p><p>Default Value</p><p>&#160;</p><p>Description</p><p>&#160;</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>createTableIfNotExists</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>true</p><p>&#160;</p><p>Defines whether or not Camel should try to create the table if it doesn't exist.</p><p>&#160;</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>tableExistsString</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>SELECT 1 FROM CAMEL_MESSAGEPROCESSED WHERE 1 = 0</p><p>&#160;</p><p>This query is used to figure out whether the table already exists or not. It must throw an exception to indicate the table doesn't exist.</p><p>&#160;</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>createString</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>CREATE TABLE CAMEL_MESSAGEPROCESSED (processorName VARCHAR(255), messageId VARCHAR(100), createdAt TIMESTAMP)</p><p>&#160;</p><p>The statement which is used to create the table.</p><p>&#160;</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>queryString</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>SELECT COUNT(*) FROM CAMEL_MESSAGEPROCESSED WHERE processorName = ? AND messageId = ?</p><p>&#160;</p><p>The query which is used to figure out whether the message already exists in the repository (the result is not equals to '0'). It takes two parameters. This first one is the processor name (<code>String</code>) and the second one is the message id (<code>String</code>).</p><p>&#160;</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>insertString</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>INSERT INTO CAMEL_MESSAGEPROCESSED (processorName, messageId, createdAt) VALUES (?, ?, ?)</p><p>&#160;</p><p>The statement which is used to add the entry into the table. It takes three parameter. The first one is the processor name (<code>String</code>), the second one is the message id (<code>String</code>) and the third one is the timestamp (<code>java.sql.Timestamp</code>) when this entry was added to the repository.</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>deleteString</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>DELETE FROM CAMEL_MESSAGEPROCESSED WHERE processorName = ? AND messageId = ?</p><p>&#160;</p><p>The statement which is used to delete the entry from the database. It takes two parameter. This first one is the processor name (<code>String</code>) and the second one is the message id (<code>String</code>).</p><p>&#160;</p><p>A customized <code>org.apache.camel.processor.idempotent.jdbc.JdbcMessageIdRepository</code> could look like:</p><p>&#160;</p><p>{snippet:id=e1|lang=xml|url=camel/trunk/components/camel-sql/src/test/resources/org/apache/camel/processor/idempotent/jdbc/customized-spring.xml}</p><p>&#160;</p><p>&#160;</p><p>Using the JDBC based aggregation repository</p><p><strong>Available as of Camel 2.6</strong></p><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Using JdbcAggregationRepository in Camel 2.6</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  &#160;
 </div>
</div><p>In Camel 2.6, the JdbcAggregationRepository is provided in the <code>camel-jdbc-aggregator</code> component. From Camel 2.7 onwards, the <code>JdbcAggregationRepository</code> is provided in the <code>camel-sql</code> component.</p><p>&#160;</p><p><code>JdbcAggregationRepository</code> is an <code>AggregationRepository</code> which on the fly persists the aggregated messages. This ensures that you will not loose messages, as the default aggregator will use an in memory only <code>AggregationRepository</code>.<br clear="none"> The <code>JdbcAggregationRepository</code> allows together with Camel to provide persistent support for the <a shape="rect" href="aggregator2.html">Aggregator</a>.</p><p>It has the following options:</p><p class="confluenceTable">&#160;</p><p>&#160;</p><p class="confluenceTh">&#160;</p><p>Option</p><p>&#160;</p><p class="confluenceTh">&#160;</p><p>Type</p><p>&#160;</p><p>Description</p><p>&#160;</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>dataSource</code></p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>DataSource</code></p><p>&#160;</p><p><strong>Mandatory:</strong> The <code>javax.sql.DataSource</code> to use for accessing the database.</p><p>&#160;</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>repositoryName</code></p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>String</code></p><p>&#160;</p><p><strong>Mandatory:</strong> The name of the repository.</p><p>&#160;</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>transactionManager</code></p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>TransactionManager</code></p><p>&#160;</p><p><strong>Mandatory:</strong> The <code>org.springframework.transaction.PlatformTransactionManager</code> to mange transactions for the database. The TransactionManager must be able to support databases.</p><p>&#160;</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>lobHandler</code></p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>LobHandler</code></p><p>&#160;</p><p>A <code>org.springframework.jdbc.support.lob.LobHandler</code> to handle Lob types in the database. Use this option to use a vendor specific LobHandler, for example when using Oracle.</p><p>&#160;</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>returnOldExchange</code></p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>boolean</p><p>&#160;</p><p>Whether the get operation should return the old existing Exchange if any existed. By default this option is <code>false</code> to optimize as we do not need the old exchange when aggregating.</p><p>&#160;</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>useRecovery</code></p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>boolean</p><p>&#160;</p><p>Whether or not recovery is enabled. This option is by default <code>true</code>. When enabled the Camel <a shape="rect" href="aggregator2.html">Aggregator</a> automatic recover failed aggregated exchange and have them resubmitted.</p><p>&#160;</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>recoveryInterval</code></p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>long</p><p>&#160;</p><p>If recovery is enabled then a background task is run every x'th time to scan for failed exchanges to recover and resubmit. By default this interval is 5000 millis.</p><p>&#160;</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>maximumRedeliveries</code></p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>int</p><p>&#160;</p><p>Allows you to limit the maximum number of redelivery attempts for a recovered exchange. If enabled then the Exchange will be moved to the dead letter channel if all redelivery attempts failed. By default this option is disabled. If this option is used then the <code>deadLetterUri</code> option must also be provided.</p><p>&#160;</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>deadLetterUri</code></p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>String</p><p>&#160;</p><p>An endpoint uri for a <a shape="rect" href="dead-letter-channel.html">Dead Letter Channel</a> where exhausted recovered Exchanges will be moved. If this option is used then the <code>maximumRedeliveries</code> option must also be provided.</p><p>&#160;</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>storeBodyAsText</code></p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>boolean</p><p>&#160;</p><p><strong>Camel 2.11:</strong> Whether to store the message body as String which is human readable. By default this option is <code>false</code> storing the body in binary format.</p><p>&#160;</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>headersToStoreAsText</code></p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>List&lt;String&gt;</code></p><p>&#160;</p><p><strong>Camel 2.11:</strong> Allows to store headers as String which is human readable. By default this option is disabled, storing the headers in binary format.</p><p>&#160;</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>optimisticLocking</code></p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>false</code></p><p>&#160;</p><p><strong>Camel 2.12:</strong> To turn on optimistic locking, which often would be needed in clustered environments where multiple Camel applications shared the same JDBC based aggregation repository.</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>jdbcOptimisticLockingExceptionMapper</code></p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>&#160;</p><p>&#160;</p><p><strong>Camel 2.12:</strong> Allows to plugin a custom <code>org.apache.camel.processor.aggregate.jdbc.JdbcOptimisticLockingExceptionMapper</code> to map vendor specific error codes to an optimistick locking error, for Camel to perform a retry. This requires <code>optimisticLocking</code> to be enabled.</p><p>&#160;</p><p>What is preserved when persisting</p><p><code>JdbcAggregationRepository</code> will only preserve any <code>Serializable</code> compatible data types. If a data type is not such a type its dropped and a <code>WARN</code> is logged. And it only persists the <code>Message</code> body and the <code>Message</code> headers. The <code>Exchange</code> properties are <strong>not</strong> persisted.</p><p>From Camel 2.11 onwards you can store the message body and select(ed) headers as String in separate columns.</p><p>Recovery</p><p>The <code>JdbcAggregationRepository</code> will by default recover any failed <a shape="rect" href="exchange.html">Exchange</a>. It does this by having a background tasks that scans for failed <a shape="rect" href="exchange.html">Exchange</a>s in the persistent store. You can use the <code>checkInterval</code> option to set how often this task runs. The recovery works as transactional which ensures that Camel will try to recover and redeliver the failed <a shape="rect" href="exchange.html">Exchange</a>. Any <a shape="rect" href="exchange.html">Exchange</a> which was found to be recovered will be restored from the persistent store and resubmitted and send out again.</p><p>The following headers is set when an <a shape="rect" href="exchange.html">Exchange</a> is being recovered/redelivered:</p><p class="confluenceTable">&#160;</p><p>&#160;</p><p class="confluenceTh">&#160;</p><p>Header</p><p>&#160;</p><p class="confluenceTh">&#160;</p><p>Type</p><p>&#160;</p><p>Description</p><p>&#160;</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>Exchange.REDELIVERED</code></p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>Boolean</p><p>&#160;</p><p>Is set to true to indicate the <a shape="rect" href="exchange.html">Exchange</a> is being redelivered.</p><p>&#160;</p><p class="confluenceTd">&#160;</p><p><code>Exchange.REDELIVERY_COUNTER</code></p><p>&#160;</p><p class="confluenceTd">&#160;</p><p>Integer</p><p>&#160;</p><p>The redelivery attempt, starting from 1.</p><p>&#160;</p><p>Only when an <a shape="rect" href="exchange.html">Exchange</a> has been successfully processed it will be marked as complete which happens when the <code>confirm</code> method is invoked on the <code>AggregationRepository</code>. This means if the same <a shape="rect" href="exchange.html">Exchange</a> fails again it will be kept retried until it success.</p><p>You can use option <code>maximumRedeliveries</code> to limit the maximum number of redelivery attempts for a given recovered <a shape="rect" href="exchange.html">Exchange</a>. You must also set the <code>deadLetterUri</code> option so Camel knows where to send the <a shape="rect" href="exchange.html">Exchange</a> when the <code>maximumRedeliveries</code> was hit.</p><p>You can see some examples in the unit tests of camel-sql, for example <a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/camel/trunk/components/camel-sql/src/test/java/org/apache/camel/processor/aggregate/jdbc/JdbcAggregateRecoverDeadLetterChannelTest.java">this test</a>.</p><p>Database</p><p>To be operational, each aggregator uses two table: the aggregation and completed one. By convention the completed has the same name as the aggregation one suffixed with <code>"_COMPLETED"</code>. The name must be configured in the Spring bean with the <code>RepositoryName</code> property. In the following example aggregation will be used.</p><p>The table structure definition of both table are identical: in both case a String value is used as key (<strong>id</strong>) whereas a Blob contains the exchange serialized in byte array.<br clear="none"> However one difference should be remembered: the <strong>id</strong> field does not have the same content depending on the table.<br clear="none"> In the aggregation table <strong>id</strong> holds the correlation Id used by the component to aggregate the messages. In the completed table, <strong>id</strong> holds the id of the exchange stored in corresponding the blob field.</p><p>Here is the SQL query used to create the tables, just replace <code>"aggregation"</code> with your aggregator repository name.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: sql; gutter: false; theme: Default" type="syntaxhighlighter">&nbsp;</script> 
 </div>
</div><p>CREATE TABLE aggregation ( id varchar(255) NOT NULL, exchange blob NOT NULL, constraint aggregation_pk PRIMARY KEY (id) ); CREATE TABLE aggregation_completed ( id varchar(255) NOT NULL, exchange blob NOT NULL, constraint aggregation_completed_pk PRIMARY KEY (id) );</p><p>&#160;</p><p>Storing body and headers as text</p><p><strong>Available as of Camel 2.11</strong></p><p>You can configure the <code>JdbcAggregationRepository</code> to store message body and select(ed) headers as String in separate columns. For example to store the body, and the following two headers <code>companyName</code> and <code>accountName</code> use the following SQL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: sql; gutter: false; theme: Default" type="syntaxhighlighter">&nbsp;</script> 
 </div>
</div><p>CREATE TABLE aggregationRepo3 ( id varchar(255) NOT NULL, exchange blob NOT NULL, body varchar(1000), companyName varchar(1000), accountName varchar(1000), constraint aggregationRepo3_pk PRIMARY KEY (id) ); CREATE TABLE aggregationRepo3_completed ( id varchar(255) NOT NULL, exchange blob NOT NULL, body varchar(1000), companyName varchar(1000), accountName varchar(1000), constraint aggregationRepo3_completed_pk PRIMARY KEY (id) );</p><p>&#160;</p><p>And then configure the repository to enable this behavior as shown below:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&nbsp;</script> 
 </div>
</div><p>&lt;bean id="repo3" class="org.apache.camel.processor.aggregate.jdbc.JdbcAggregationRepository"&gt; &lt;property name="repositoryName" value="aggregationRepo3"/&gt; &lt;property name="transactionManager" ref="txManager3"/&gt; &lt;property name="dataSource" ref="dataSource3"/&gt; &lt;!-- configure to store the message body and following headers as text in the repo --&gt; &lt;property name="storeBodyAsText" value="true"/&gt; &lt;property name="headersToStoreAsText"&gt; &lt;list&gt; &lt;value&gt;companyName&lt;/value&gt; &lt;value&gt;accountName&lt;/value&gt; &lt;/list&gt; &lt;/property&gt; &lt;/bean&gt;</p><p>&#160;</p><p>Codec (Serialization)</p><p>Since they can contain any type of payload, Exchanges are not serializable by design. It is converted into a byte array to be stored in a database BLOB field. All those conversions are handled by the <code>JdbcCodec</code> class. One detail of the code requires your attention: the <code>ClassLoadingAwareObjectInputStream</code>.</p><p>The <code>ClassLoadingAwareObjectInputStream</code> has been reused from the <a shape="rect" class="external-link" href="http://activemq.apache.org/">Apache ActiveMQ</a> project. It wraps an <code>ObjectInputStream</code> and use it with the <code>ContextClassLoader</code> rather than the <code>currentThread</code> one. The benefit is to be able to load classes exposed by other bundles. This allows the exchange body and headers to have custom types object references.</p><p>Transaction</p><p>A Spring <code>PlatformTransactionManager</code> is required to orchestrate transaction.</p><p>Service (Start/Stop)</p><p>The <code>start</code> method verify the connection of the database and the presence of the required tables. If anything is wrong it will fail during starting.</p><p>Aggregator configuration</p><p>Depending on the targeted environment, the aggregator might need some configuration. As you already know, each aggregator should have its own repository (with the corresponding pair of table created in the database) and a data source. If the default lobHandler is not adapted to your database system, it can be injected with the <code>lobHandler</code> property.</p><p>Here is the declaration for Oracle:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&nbsp;</script> 
 </div>
</div><p>&lt;bean id="lobHandler" class="org.springframework.jdbc.support.lob.OracleLobHandler"&gt; &lt;property name="nativeJdbcExtractor" ref="nativeJdbcExtractor"/&gt; &lt;/bean&gt; &lt;bean id="nativeJdbcExtractor" class="org.springframework.jdbc.support.nativejdbc.CommonsDbcpNativeJdbcExtractor"/&gt; &lt;bean id="repo" class="org.apache.camel.processor.aggregate.jdbc.JdbcAggregationRepository"&gt; &lt;property name="transactionManager" ref="transactionManager"/&gt; &lt;property name="repositoryName" value="aggregation"/&gt; &lt;property name="dataSource" ref="dataSource"/&gt; &lt;!-- Only with Oracle, else use default --&gt; &lt;property name="lobHandler" ref="lobHandler"/&gt; &lt;/bean&gt;</p><p>&#160;</p><p>Optimistic locking</p><p>From <strong>Camel 2.12</strong> onwards you can turn on <code>optimisticLocking</code> and use this JDBC based aggregation repository in a clustered environment where multiple Camel applications shared the same database for the aggregation repository. If there is a race condition there JDBC driver will throw a vendor specific exception which the <code>JdbcAggregationRepository</code> can react upon. To know which caused exceptions from the JDBC driver is regarded as an optimistick locking error we need a mapper to do this. Therefore there is a <code>org.apache.camel.processor.aggregate.jdbc.JdbcOptimisticLockingExceptionMapper</code> allows you to implement your custom logic if needed. There is a default implementation <code>org.apache.camel.processor.aggregate.jdbc.DefaultJdbcOptimisticLockingExceptionMapper</code> which works as follows:</p><p>The following check is done:</p><p>If the caused exception is an <code>SQLException</code> then the SQLState is checked if starts with 23.</p><p>If the caused exception is a <code>DataIntegrityViolationException</code></p><p>If the caused exception class name has "ConstraintViolation" in its name.</p><p>optional checking for FQN class name matches if any class names has been configured</p><p>You can in addition add FQN classnames, and if any of the caused exception (or any nested) equals any of the FQN class names, then its an optimistick locking error.</p><p>Here is an example, where we define 2 extra FQN class names from the JDBC vendor.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&nbsp;</script> 
 </div>
</div><p>&lt;bean id="repo" class="org.apache.camel.processor.aggregate.jdbc.JdbcAggregationRepository"&gt; &lt;property name="transactionManager" ref="transactionManager"/&gt; &lt;property name="repositoryName" value="aggregation"/&gt; &lt;property name="dataSource" ref="dataSource"/&gt; &lt;property name"jdbcOptimisticLockingExceptionMapper" ref="myExceptionMapper"/&gt; &lt;/bean&gt; &lt;!-- use the default mapper with extra FQN class names from our JDBC driver --&gt; &lt;bean id="myExceptionMapper" class="org.apache.camel.processor.aggregate.jdbc.DefaultJdbcOptimisticLockingExceptionMapper"&gt; &lt;property name="classNames"&gt; &lt;util:set&gt; &lt;value&gt;com.foo.sql.MyViolationExceptoion&lt;/value&gt; &lt;value&gt;com.foo.sql.MyOtherViolationExceptoion&lt;/value&gt; &lt;/util:set&gt; &lt;/property&gt; &lt;/bean&gt;</p><p>&#160;</p><p></p><h3 id="BookInOnePage-SeeAlso.83">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><p><a shape="rect" href="sql-stored-procedure.html">SQL Stored Procedure</a></p><p><a shape="rect" href="jdbc.html">JDBC</a></p><h2 id="BookInOnePage-TelegramComponent">Telegram Component</h2><p><strong>Available as of Camel 2.18</strong></p><p>The <strong>Telegram</strong> component provides access to the <a shape="rect" class="external-link" href="https://core.telegram.org/bots/api" rel="nofollow">Telegram Bot API</a>. It allows a Camel-based application to send and receive messages by acting as a Bot, participating in direct conversations with normal users, private and public groups or channels.</p><p>A Telegram Bot must be created before using this component, following the instructions at the <a shape="rect" class="external-link" href="https://core.telegram.org/bots#3-how-do-i-create-a-bot" rel="nofollow">Telegram Bot developers home</a>. When a new Bot is created, the BotFather provides an <strong>authorization token</strong> corresponding to the Bot. The authorization token is a mandatory parameter for the&#160;<strong><code>camel-telegram</code></strong> endpoint.</p><div class="confluence-information-macro confluence-information-macro-note">
 <p class="title">Note</p>
 <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p><span>In order to allow the Bot to receive all messages exchanged within a group or channel (not just the ones starting with a&#160;<strong><code>/</code></strong> character), ask the BotFather to </span><strong>disable the privacy mode</strong>, using the <strong><code>/setprivacy</code></strong> command.</p>
 </div>
</div><p>Maven users will need to add the following dependency to their&#160;<strong><code>pom.xml</code></strong> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-telegram&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt;</script> 
 </div>
</div><h3 id="BookInOnePage-URIFormat.5">URI Format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">telegram:type/authorizationToken[?options]</script> 
 </div>
</div><h3 id="BookInOnePage-Options.75">Options</h3><p>The Telegram component has no options. However, the Telegram component does support 24 endpoint options, which are listed below:</p><div class="confluenceTableSmall">
 <div> 
  <div class="sect2"> 
   <div class="sect3"> 
    <div class="table-wrap"> 
     <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh">Name</th><th colspan="1" rowspan="1" class="confluenceTh">Group</th><th colspan="1" rowspan="1" class="confluenceTh">Default</th><th colspan="1" rowspan="1" class="confluenceTh">Description</th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>authorizationToken</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>common</code></p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><strong>Required</strong> The authorization token for using the bot (ask the BotFather) e.g., <strong><code>654321531:HGF_dTra456323dHuOedsE343211fqr3t-H</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>type</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>common</code></p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><strong>Required</strong> The endpoint type. Currently only the&#160;<strong><code>bots</code></strong> type is supported.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>bridgeErrorHandler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>consumer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">Allows for bridging the consumer to the Camel routing Error Handler which mean any exceptions occurred while the consumer is trying to pickup incoming messages or the likes will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the&#160;<strong><code>org.apache.camel.spi.ExceptionHandler</code></strong> to deal with exceptions that will be logged at&#160;<strong><code>WARN</code>/<code>ERROR</code></strong> level and ignored.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>limit</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>consumer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>100</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">Limit on the number of updates that can be received in a single polling request.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>sendEmptyMessageWhenIdle</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>consumer</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">If the polling consumer did not poll any files you can enable this option to send an empty message (no body) instead.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>timeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><code>consumer</code></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>30</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">Timeout in seconds for long polling. Put&#160;<strong><code>0</code></strong> for short polling or a bigger number for long polling. Long polling produces shorter response time.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>exceptionHandler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>consumer</code>&#160;</p><p class="tableblock">(advanced)</p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">To let the consumer use a custom <strong><code>ExceptionHandler</code></strong>. </p><p class="tableblock"><strong>Note</strong>: if the option&#160;<strong><code>bridgeErrorHandler</code></strong> is enabled then this options is not in use. By default the consumer will deal with exceptions that will be logged at <strong><code>WARN</code>/<code>ERROR</code></strong> level and ignored.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>pollStrategy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>consumer</code>&#160;</p><p class="tableblock">(advanced)</p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">A pluggable&#160;<strong><code>org.apache.camel.PollingConsumerPollingStrategy</code></strong> allowing you to provide your custom implementation to control error handling usually occurred during the poll operation before an Exchange have been created and being routed in Camel.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>chatId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>producer</code></p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">The identifier of the chat that will receive the produced messages. Chat ids can be first obtained from incoming messages e.g., when a telegram user starts a conversation with a bot its client sends automatically a&#160;<strong><code>/start</code></strong> message containing the chat id. It is an optional parameter as the chat id can be set dynamically for each outgoing message (using body or headers).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>exchangePattern</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>advanced</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>InOnly</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">Sets the default exchange pattern when creating an exchange</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>synchronous</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>advanced</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">Sets whether synchronous processing should be strictly used or Camel is allowed to use asynchronous processing (if supported).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>backoffErrorThreshold</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>scheduler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">The number of subsequent error polls (failed due some error) that should happen before the&#160;<strong><code>backoffMultiplier</code></strong> should kick-in.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>backoffIdleThreshold</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>scheduler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">The number of subsequent idle polls that should happen before the&#160;<strong><code>backoffMultiplier</code></strong> should kick-in.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>backoffMultiplier</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>scheduler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">To let the scheduled polling consumer back-off if there has been a number of subsequent idles/errors in a row. The multiplier is then the number of polls that will be skipped before the next actual attempt is happening again. When this option is in use then&#160;<strong><code>backoffIdleThreshold</code></strong> and/or&#160;<strong><code>backoffErrorThreshold</code></strong> must also be configured.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>delay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>scheduler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>500</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">Milliseconds before the next poll. You can also specify time values using units such as:</p> 
         <ul><li class="tableblock"><strong><code>60s</code></strong> (60 seconds)</li><li class="tableblock"><strong><code>5m30s</code></strong> (5 minutes and 30 seconds)</li><li class="tableblock"><strong><code>1h</code></strong> (1 hour)</li></ul></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>greedy</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>scheduler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">If greedy is enabled then the&#160;<strong><code>ScheduledPollConsumer</code></strong> will run immediately again if the previous run polled 1 or more messages.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>initialDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>scheduler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">Milliseconds before the first poll starts. You can also specify time values using units such as:</p> 
         <ul><li class="tableblock"><strong><code>60s</code></strong> (60 seconds)</li><li class="tableblock"><strong><code>5m30s</code></strong> (5 minutes and 30 seconds)</li><li class="tableblock"><strong><code>1h</code></strong> (1 hour)</li></ul></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>runLoggingLevel</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>scheduler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>TRACE</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">The consumer logs a start/complete log line when it polls. This option allows you to configure the logging level for that.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>scheduledExecutorService</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>scheduler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">Allows for configuring a custom/shared thread pool to use for the consumer. By default each consumer has its own single threaded thread pool.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>scheduler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>scheduler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>none</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">To use a cron scheduler from either camel-spring or&#160;<strong><code>camel-quartz2</code></strong> component</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>schedulerProperties</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>scheduler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">To configure additional properties when using a custom scheduler or any of the Quartz2 Spring based scheduler.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>startScheduler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>scheduler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">Whether the scheduler should be auto started.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>timeUnit</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>scheduler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>ms</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">Time unit for&#160;<strong><code>initialDelay</code></strong> and delay options.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>useFixedDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>scheduler</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">Controls if fixed delay or fixed rate is used.</p><p class="tableblock">See&#160;<strong><code>ScheduledExecutorService</code></strong> in JDK for details.</p></td></tr></tbody></table> 
    </div> 
   </div> 
  </div> 
 </div>
</div><h3 id="BookInOnePage-MessageHeaders.18">Message Headers</h3><div class="confluenceTableSmall">
 <div class="sect2"> 
  <div class="sect3"> 
   <div> 
    <div class="sect2"> 
     <div class="sect3"> 
      <div class="table-wrap"> 
       <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh">Name</th><th colspan="1" rowspan="1" class="confluenceTh">Description</th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>CamelTelegramChatId</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">This header is used by the producer endpoint in order to resolve the chat id that will receive the message. The recipient chat id can be placed (in order of priority) in message body, in the <strong><code>CamelTelegramChatId</code></strong> header or in the endpoint configuration (<strong><code>chatId</code></strong> option). This header is also present in all incoming messages.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>CamelTelegramMediaType</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">This header is used to identify the media type when the outgoing message is composed of pure binary data. Possible values are strings or enum values belonging to the <strong><code>org.apache.camel.component.telegram.TelegramMediaType</code></strong> enumeration.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>CamelTelegramMediaTitleCaption</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">This header is used to provide a caption or title for outgoing binary messages.</p></td></tr></tbody></table> 
      </div> 
     </div> 
    </div> 
   </div> 
  </div> 
 </div>
</div><h3 id="BookInOnePage-Usage.10">Usage</h3><div>
 <div class="sect2">
  <div class="sect3">
   <div class="paragraph">
    <p>The Telegram component supports both consumer and producer endpoints. It can also be used in <strong style="line-height: 1.42857;">reactive chat-bot mode</strong> (to consume, then produce messages).</p>
    <h4 id="BookInOnePage-ProducerExample.1">Producer Example</h4>
    <div>
     <div class="sect2">
      <div class="sect3">
       <div class="paragraph">
        <p>The following is a basic example of how to send a message to a Telegram chat through the Telegram Bot API.</p>
        <p>in Java DSL:</p>
        <div class="code panel pdl" style="border-width: 1px;">
         <div class="codeContent panelContent pdl"> 
          <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;telegram:bots/123456789:AAE_dLq5C19xwGjw3yiC2NvEUrZcejK21-Q987654321:AAE_dLq5C19xwOmg5yiC2NvSrkT3wj5Q1-L&amp;quot;);</script> 
         </div>
        </div>
        <p>or in Spring XML:</p>
        <div class="code panel pdl" style="border-width: 1px;">
         <div class="codeContent panelContent pdl"> 
          <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;telegram:bots/123456789:AAE_dLq5C19xwGjw3yiC2NvEUrZcejK21-Q987654321:AAE_dLq5C19xwOmg5yiC2NvSrkT3wj5Q1-L&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt;</script> 
         </div>
        </div>
        <div>
         <div class="sect2">
          <div class="sect3">
           <div class="paragraph">
            <p>The code <strong><code style="line-height: 1.42857;">123456789:AAE_dLq5C19xwGjw3yiC2NvEUrZcejK21-Q987654321:AAE_dLq5C19xwOmg5yiC2NvSrkT3wj5Q1-L</code></strong> is the <strong style="line-height: 1.42857;">authorization token</strong> corresponding to the Bot.</p>
            <p>When using the producer endpoint without specifying the <strong>chat id</strong> option, the target chat will be identified using information contained in the body or headers of the message. The following message bodies are allowed for a producer endpoint (messages of type <strong><code>Outgoing<em>XXX</em>Message</code></strong> belong to the package&#160;<strong><code>org.apache.camel.component.telegram.model</code></strong>)</p>
            <div class="confluenceTableSmall">
             <div class="sect2"> 
              <div class="sect3"> 
               <div class="sect2"> 
                <div class="sect3"> 
                 <div> 
                  <div class="sect2"> 
                   <div class="sect3"> 
                    <div class="table-wrap"> 
                     <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh">Java Type</th><th colspan="1" rowspan="1" class="confluenceTh">Description</th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>OutgoingTextMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">To send a text message to a chat.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>OutgoingPhotoMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">To send a photo (JPG, PNG) to a chat.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>OutgoingAudioMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">To send a mp3 audio to a chat.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>OutgoingVideoMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">To send a mp4 video to a chat.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>byte[]</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">To send any media type supported. It requires the <strong><code>CamelTelegramMediaType</code></strong> header to be set to the appropriate media type.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">To send a text message to a chat. It gets converted automatically into a <strong><code>OutgoingTextMessage</code></strong></p></td></tr></tbody></table> 
                    </div> 
                   </div> 
                  </div> 
                 </div> 
                </div> 
               </div> 
              </div> 
             </div>
            </div>
            <h4 id="BookInOnePage-ConsumerExample.1">Consumer Example</h4>
           </div>
          </div>
         </div>
        </div>
        <p>The following is a basic example of how to receive all messages that telegram users are sending to the configured Bot.</p>
        <p>In Java DSL:</p>
        <div class="code panel pdl" style="border-width: 1px;">
         <div class="codeContent panelContent pdl"> 
          <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;telegram:bots/123456789:AAE_dLq5C19xwGjw3yiC2NvEUrZcejK21-Q987654321:AAE_dLq5C19xwOmg5yiC2NvSrkT3wj5Q1-L&amp;quot;) .bean(ProcessorBean.class)</script> 
         </div>
        </div>
        <p>or in Spring XML:</p>
        <div class="code panel pdl" style="border-width: 1px;">
         <div class="codeContent panelContent pdl"> 
          <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;telegram:bots/123456789:AAE_dLq5C19xwGjw3yiC2NvEUrZcejK21-Q987654321:AAE_dLq5C19xwOmg5yiC2NvSrkT3wj5Q1-L&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;myBean&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;bean id=&amp;quot;myBean&amp;quot; class=&amp;quot;com.example.MyBean&amp;quot;/&amp;gt;</script> 
         </div>
        </div>
        <p>The&#160;<strong><code>MyBean</code></strong> is a simple bean that will receive the messages:</p>
        <div class="code panel pdl" style="border-width: 1px;">
         <div class="codeContent panelContent pdl"> 
          <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public class MyBean { public void process(String message) { // or Exchange, or org.apache.camel.component.telegram.model.IncomingMessage (or both) // do process } }</script> 
         </div>
        </div>
        <p>Supported types for incoming messages are</p>
        <div class="confluenceTableSmall">
         <div class="sect2"> 
          <div class="sect3"> 
           <div class="sect2"> 
            <div class="sect3"> 
             <div class="sect2"> 
              <div class="sect3"> 
               <div> 
                <div class="sect2"> 
                 <div class="sect3"> 
                  <div class="table-wrap"> 
                   <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh">Java Type</th><th colspan="1" rowspan="1" class="confluenceTh">Description</th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>IncomingMessage</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">The full object representation of an incoming message</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock"><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p class="tableblock">The content of the message, for text messages only</p></td></tr></tbody></table> 
                  </div> 
                 </div> 
                </div> 
               </div> 
              </div> 
             </div> 
            </div> 
           </div> 
          </div> 
         </div>
        </div>
        <h4 id="BookInOnePage-ReactiveChat-BotExample">Reactive Chat-Bot Example</h4>
        <p>The reactive chat-bot mode is a simple way of using the Camel component to build a simple chat bot that replies directly to chat messages received from the Telegram users.</p>
        <p>The following is a basic configuration of the chat-bot in Java DSL</p>
        <div class="code panel pdl" style="border-width: 1px;">
         <div class="codeContent panelContent pdl"> 
          <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;telegram:bots/123456789:AAE_dLq5C19xwGjw3yiC2NvEUrZcejK21-Q987654321:AAE_dLq5C19xwOmg5yiC2NvSrkT3wj5Q1-L&amp;quot;) .bean(ChatBotLogic.class) .to(&amp;quot;telegram:bots/123456789:AAE_dLq5C19xwGjw3yiC2NvEUrZcejK21-Q987654321:AAE_dLq5C19xwOmg5yiC2NvSrkT3wj5Q1-L&amp;quot;);</script> 
         </div>
        </div>
        <p>or in Spring XML</p>
        <div class="code panel pdl" style="border-width: 1px;">
         <div class="codeContent panelContent pdl"> 
          <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;telegram:bots/123456789:AAE_dLq5C19xwGjw3yiC2NvEUrZcejK21-Q987654321:AAE_dLq5C19xwOmg5yiC2NvSrkT3wj5Q1-L&amp;quot;/&amp;gt; &amp;lt;bean ref=&amp;quot;chatBotLogic&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;telegram:bots/123456789:AAE_dLq5C19xwGjw3yiC2NvEUrZcejK21-Q987654321:AAE_dLq5C19xwOmg5yiC2NvSrkT3wj5Q1-L&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;bean id=&amp;quot;chatBotLogic&amp;quot; class=&amp;quot;com.example.ChatBotLogic&amp;quot;/&amp;gt;</script> 
         </div>
        </div>
        <p>The&#160;<strong><code>ChatBotLogic</code></strong> is a simple bean that implements a generic String-to-String method.</p>
        <div class="code panel pdl" style="border-width: 1px;">
         <div class="codeContent panelContent pdl"> 
          <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">public class ChatBotLogic { public String chatBotProcess(String message) { if( &amp;quot;do-not-reply&amp;quot;.equals(message) ) { return null; // no response in the chat } return &amp;quot;echo from the bot: &amp;quot; + message; // echoes the message } }</script> 
         </div>
        </div>
        <p>Every non-null string returned by the&#160;<strong><code>chatBotProcess()</code></strong> method is automatically routed to the chat that originated the request (as the&#160;<strong><code>CamelTelegramChatId</code></strong> header is used to route the message).</p>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
 </div>
</div><h2 id="BookInOnePage-TestComponent">Test Component</h2><p><a shape="rect" href="testing.html">Testing</a> of distributed and asynchronous processing is notoriously difficult. The <a shape="rect" href="mock.html">Mock</a>, <a shape="rect" href="test.html">Test</a> and <a shape="rect" href="dataset.html">DataSet</a> endpoints work great with the <a shape="rect" href="testing.html">Camel Testing Framework</a> to simplify your unit and integration testing using <a shape="rect" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a> and Camel's large range of <a shape="rect" href="components.html">Components</a> together with the powerful <a shape="rect" href="bean-integration.html">Bean Integration</a>.</p><p>The <strong><code>test</code></strong> component extends the <a shape="rect" href="mock.html">Mock</a> component to support pulling messages from another endpoint on startup to set the expected message bodies on the underlying <a shape="rect" href="mock.html">Mock</a> endpoint. That is, you use the test endpoint in a route and messages arriving on it will be implicitly compared to some expected messages extracted from some other location.</p><p>So you can use, for example, an expected set of message bodies as files. This will then set up a properly configured <a shape="rect" href="mock.html">Mock</a> endpoint, which is only valid if the received messages match the number of expected messages and their message payloads are equal.</p><p>Maven users will need to add the following dependency to their <strong><code>pom.xml</code></strong> for this component when using <strong>Camel 2.8</strong> or older:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-spring&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><p>From <strong>Camel 2.9</strong>: the <a shape="rect" href="test.html">Test</a> component is provided directly in <strong><code>camel-core</code></strong>.</p><h3 id="BookInOnePage-URIformat.68">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">test:expectedMessagesEndpointUri </script> 
 </div>
</div><p>Where&#160;<strong><code>expectedMessagesEndpointUri</code></strong> refers to some other <a shape="rect" href="component.html">Component</a> URI that the expected message bodies are pulled from before starting the test.</p><h3 id="BookInOnePage-URIOptions.10">URI Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>anyOrder</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17:</strong> Whether the expected messages should arrive in the same order, or in any order.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>delimiter</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>\n|\r</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17:</strong> The delimiter to use when&#160;<strong><code>split=true</code></strong>. The delimiter can be a regular expression.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>split</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17:</strong> If&#160;<strong><code>true</code></strong> messages loaded from the test endpoint will be split using the defined <strong><code>delimiter</code></strong>.For example to use a&#160;<strong><code>file</code></strong> endpoint to load a file where each line is an expected message.&#160;</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>timeout</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>2000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.12:</strong> The timeout to use when polling for message bodies from the URI.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Example.29">Example</h3><p>For example, you could write a test case as follows:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;seda:someEndpoint&amp;quot;) .to(&amp;quot;test:file://data/expectedOutput?noop=true&amp;quot;); </script> 
 </div>
</div><p>If your test then invokes the <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/component/mock/MockEndpoint.html#assertIsSatisfied(org.apache.camel.CamelContext)">MockEndpoint.assertIsSatisfied(camelContext) method</a>, your test case will perform the necessary assertions.</p><p>To see how you can set other expectations on the test endpoint, see the <a shape="rect" href="mock.html">Mock</a> component.</p><p></p><h3 id="BookInOnePage-SeeAlso.84">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul><li><a shape="rect" href="spring-testing.html">Spring Testing</a></li></ul><h2 id="BookInOnePage-TimerComponent">Timer Component</h2><p>The <strong>timer:</strong> component is used to generate message exchanges when a timer fires You can only consume events from this endpoint.</p><h3 id="BookInOnePage-URIformat.69">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">timer:name[?options] </script> 
 </div>
</div><p>Where <code>name</code> is the name of the <code>Timer</code> object, which is created and shared across endpoints. So if you use the same name for all your timer endpoints, only one <code>Timer</code> object and thread will be used.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><p><strong>Note:</strong> The IN body of the generated exchange is <code>null</code>. So <code>exchange.getIn().getBody()</code> returns <code>null</code>.</p><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Advanced Scheduler</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>See also the <a shape="rect" href="quartz.html">Quartz</a> component that supports much more advanced scheduling.</p>
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <p class="title">Specify time in human friendly format</p>
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>In <strong>Camel 2.3</strong> onwards you can specify the time in <a shape="rect" href="how-do-i-specify-time-period-in-a-human-friendly-syntax.html">human friendly syntax</a>.</p>
 </div>
</div><h3 id="BookInOnePage-Options.76">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>time</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>A <code>java.util.Date</code> the <strong>first</strong> event should be generated. If using the URI, the pattern expected is: <code>yyyy-MM-dd HH:mm:ss</code> or <code>yyyy-MM-dd'T'HH:mm:ss</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>pattern</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Allows you to specify a custom <code>Date</code> pattern to use for setting the time option using URI syntax.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>period</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If greater than 0, generate periodic events every <code>period</code> milliseconds.<br clear="none">You can also specify time values using units, such as 60s (60 seconds), 5m30s (5 minutes and 30 seconds), and 1h (1 hour).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>delay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span style="font-family: monospace;">0</span> / <code>1000</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The number of milliseconds to wait before the first event is generated. Should not be used in conjunction with the <code>time</code> option.<br clear="none"><span>You can also specify time values using units, such as 60s (60 seconds), 5m30s (5 minutes and 30 seconds), and 1h (1 hour).</span>&#160;<br clear="none">Before <strong>Camel 2.11</strong> the default value is 0<br clear="none">From <strong>Camel 2.11</strong><span> the <span>default value is </span><code>1000<br clear="none"></code></span>From<strong> Camel 2.17 it </strong>is possible to specify a negative delay. In this scenario the timer will generate and fire events as soon as possible.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>fixedRate</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Events take place at approximately regular intervals, separated by the specified period.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>daemon</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Specifies whether or not the thread associated with the timer endpoint runs as a daemon.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>repeatCount</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> Specifies a maximum limit of number of fires. So if you set it to 1, the timer will only fire once. If you set it to 5, it will only fire five times. A value of zero or negative means fire forever.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-ExchangeProperties.1">Exchange Properties</h3><p>When the timer is fired, it adds the following information as properties to the <code>Exchange</code>:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Exchange.TIMER_NAME</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>String</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The value of the <code>name</code> option.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Exchange.TIMER_TIME</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Date</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The value of the <code>time</code> option.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Exchange.TIMER_PERIOD</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>long</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The value of the <code>period</code> option.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Exchange.TIMER_FIRED_TIME</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Date</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The time when the consumer fired.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Exchange.TIMER_COUNTER</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Long</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8:</strong> The current fire counter. Starts from 1.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-MessageHeaders.19">Message Headers</h3><p>When the timer is fired, it adds the following information as headers to the IN message</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>Exchange.TIMER_FIRED_TIME</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>java.util.Date</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The time when the consumer fired</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Sample.5">Sample</h3><p>To set up a route that generates an event every 60 seconds:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;timer://foo?fixedRate=true&amp;amp;period=60000&amp;quot;).to(&amp;quot;bean:myBean?method=someMethodName&amp;quot;); </script> 
 </div>
</div><div class="confluence-information-macro confluence-information-macro-tip">
 <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body">
  <p>Instead of 60000 you can use period=60s which is more friendly to read.</p>
 </div>
</div><p>The above route will generate an event and then invoke the <code>someMethodName</code> method on the bean called <code>myBean</code> in the <a shape="rect" href="registry.html">Registry</a> such as JNDI or <a shape="rect" href="spring.html">Spring</a>.</p><p>And the route in Spring DSL:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;timer://foo?fixedRate=true&amp;amp;amp;period=60000&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:myBean?method=someMethodName&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><h4 id="BookInOnePage-Firingassoonaspossible">Firing as soon as possible</h4><h4 id="BookInOnePage-AvailableasofCamel2.17">Available as of Camel 2.17</h4><p>You may want to fire messages in a Camel route as soon as possible you can use a negative delay:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;timer://foo?delay=-1&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:myBean?method=someMethodName&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt;</script> 
 </div>
</div><p>In this way the timer will fire messages immediately.</p><p>You can also specify a repeatCount parameter in conjunction with a negative delay to stop firing messages after a fixed number has been reached.</p><p>If you don't specify a repeatCount then the timer will continue firing messages until the route will be stopped.&#160;</p><h4 id="BookInOnePage-Firingonlyonce">Firing only once</h4><p><strong>Available as of Camel 2.8</strong></p><p>You may want to fire a message in a Camel route only once, such as when starting the route. To do that you use the repeatCount option as shown:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;timer://foo?repeatCount=1&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;bean:myBean?method=someMethodName&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; </script> 
 </div>
</div><p></p><h3 id="BookInOnePage-SeeAlso.85">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul><li><a shape="rect" href="quartz.html">Quartz</a></li></ul><h2 id="BookInOnePage-ValidationComponent">Validation Component</h2><p>The Validation component performs XML validation of the message body using the JAXP Validation API and based on any of the supported XML schema languages, which defaults to <a shape="rect" class="external-link" href="http://www.w3.org/XML/Schema" rel="nofollow">XML Schema</a></p><p>Note that the <a shape="rect" href="jing.html">Jing</a> component also supports the following useful schema languages:</p><ul><li><a shape="rect" class="external-link" href="http://relaxng.org/compact-tutorial-20030326.html" rel="nofollow">RelaxNG Compact Syntax</a></li><li><a shape="rect" class="external-link" href="http://relaxng.org/" rel="nofollow">RelaxNG XML Syntax</a></li></ul><p>The <a shape="rect" href="msv.html">MSV</a> component also supports <a shape="rect" class="external-link" href="http://relaxng.org/" rel="nofollow">RelaxNG XML Syntax</a>.</p><h3 id="BookInOnePage-URIformat.70">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">validator:someLocalOrRemoteResource </script> 
 </div>
</div><p>Where <strong>someLocalOrRemoteResource</strong> is some URL to a local resource on the classpath or a full URL to a remote resource or resource on the file system which contains the XSD to validate against. For example:</p><ul><li><code>msv:org/foo/bar.xsd</code></li><li><code>msv:file:../foo/bar.xsd</code></li><li><code>msv:<a shape="rect" class="external-link" href="http://acme.com/cheese.xsd" rel="nofollow">http://acme.com/cheese.xsd</a></code></li><li><code>validator:com/mypackage/myschema.xsd</code></li></ul><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component when using <strong>Camel 2.8</strong> or older:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-spring&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><p>From Camel 2.9 onwards the <a shape="rect" href="validation.html">Validation</a> component is provided directly in the camel-core.</p><h3 id="BookInOnePage-Options.77">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">resourceResolverFactory</td><td colspan="1" rowspan="1" class="confluenceTd">DefaultValidatorResourceResolverFactory</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.17</strong>: Reference to a <code>org.apache.camel.component.validator.ValidatorResourceResolverFactory </code>which creates a resource resolver per endpoint<code>. </code><span>The default implementation creates an instance of <code><span>org.apache.camel.component.validator.</span>DefaultLSResourceResolver per endpoint </code></span><span><span>which creates the default resource resolver <code><span>org.apache.camel.component.validator.</span>DefaultLSResourceResolver. The default resource resolver</code> reads the schema files from the classpath and the file system. This option instead of the option <code>resourceResolver</code> shall be used when the resource resolver depends on the resource URI of the root schema document specified in the endpoint; for example, if you want to extend the default resource resolver. This option is also available on the validator component, so that you can set the resource resolver factory only once for all endpoints.</span></span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>resourceResolver</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9:</strong> Reference to a <code>org.w3c.dom.ls.LSResourceResolver</code> in the <a shape="rect" href="registry.html">Registry</a>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>useDom</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Whether <code>DOMSource</code>/<code>DOMResult</code> or <code>SaxSource</code>/<code>SaxResult</code> should be used by the validator.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>useSharedSchema</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> Whether the <code>Schema</code> instance should be shared or not. This option is introduced to work around a <a shape="rect" class="external-link" href="http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6773084" rel="nofollow">JDK 1.6.x bug</a>. Xerces should not have this issue.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>failOnNullBody</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.5/2.10.3:</strong> Whether to fail if no body exists.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>headerName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> To validate against a header instead of the message body.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>failOnNullHeader</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> Whether to fail if no header exists when validating against a header.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Example.30">Example</h3><p>The following <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-spring/src/test/resources/org/apache/camel/component/validator/camelContext.xml">example</a> shows how to configure a route from endpoint <strong>direct:start</strong> which then goes to one of two endpoints, either <strong>mock:valid</strong> or <strong>mock:invalid</strong> based on whether or not the XML matches the given schema (which is supplied on the classpath).
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:start&amp;quot;/&amp;gt; &amp;lt;doTry&amp;gt; &amp;lt;to uri=&amp;quot;validator:org/apache/camel/component/validator/schema.xsd&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;mock:valid&amp;quot;/&amp;gt; &amp;lt;doCatch&amp;gt; &amp;lt;exception&amp;gt;org.apache.camel.ValidationException&amp;lt;/exception&amp;gt; &amp;lt;to uri=&amp;quot;mock:invalid&amp;quot;/&amp;gt; &amp;lt;/doCatch&amp;gt; &amp;lt;doFinally&amp;gt; &amp;lt;to uri=&amp;quot;mock:finally&amp;quot;/&amp;gt; &amp;lt;/doFinally&amp;gt; &amp;lt;/doTry&amp;gt; &amp;lt;/route&amp;gt; </script> 
  </div>
 </div><h3 id="BookInOnePage-Advanced:JMXmethodclearCachedSchema">Advanced: JMX method clearCachedSchema</h3><p>Since <strong>Camel 2.17</strong>, you can force that the cached schema in the validator endpoint is cleared and reread with the next process call with the JMX operation&#160;<code>clearCachedSchema. </code>You can also use this method to programmatically clear the cache. This method is available on the <code>ValidatorEndpoint </code>class<code>.</code></p><p></p><h3 id="BookInOnePage-SeeAlso.86">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-Velocity">Velocity</h2><p>The <strong>velocity:</strong> component allows you to process a message using an <a shape="rect" class="external-link" href="http://velocity.apache.org/">Apache Velocity</a> template. This can be ideal when using <a shape="rect" href="templating.html">Templating</a> to generate responses for requests.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-velocity&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.71">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">velocity:templateName[?options] </script> 
 </div>
</div><p>Where <strong>templateName</strong> is the classpath-local URI of the template to invoke; or the complete URL of the remote template (eg: <a shape="rect" class="external-link" href="file://folder/myfile.vm" rel="nofollow">file://folder/myfile.vm</a>).</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.78">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Option</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>loaderCache</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Velocity based file loader cache.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>contentCache</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Cache for the resource content when it is loaded. <br clear="none" class="atl-forced-newline"> Note : as of Camel 2.9 cached resource content can be cleared via JMX using the endpoint's <code>clearContentCache</code> operation.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>encoding</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Character encoding of the resource content.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>propertiesFile</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>New option in Camel 2.1: The URI of the properties file which is used for VelocityEngine initialization.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-MessageHeaders.20">Message Headers</h3><p>The velocity component sets a couple headers on the message (you can't set these yourself and from Camel 2.1 velocity component will not set these headers which will cause some side effect on the dynamic template support):</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelVelocityResourceUri</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The <strong>templateName</strong> as a <code>String</code> object.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>CamelVelocitySupplementalContext</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.16:</strong> To add additional information to the used VelocityContext. The value of this header should be a <code>Map</code> with key/values that will added (override any existing key with the same name).<br clear="none">This can be used to pre setup some common key/values you want to reuse in your velocity endpoints.</p></td></tr></tbody></table> 
 </div>
</div><p>Headers set during the Velocity evaluation are returned to the message and added as headers. Then its kinda possible to return values from Velocity to the Message.</p><p>For example, to set the header value of <code>fruit</code> in the Velocity template <code>.tm</code>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">$in.setHeader(&amp;quot;fruit&amp;quot;, &amp;quot;Apple&amp;quot;) </script> 
 </div>
</div><p>The <code>fruit</code> header is now accessible from the <code>message.out.headers</code>.</p><h3 id="BookInOnePage-VelocityContext">Velocity Context</h3><p>Camel will provide exchange information in the Velocity context (just a <code>Map</code>). The <code>Exchange</code> is transfered as:</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>key</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>value</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exchange</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The <code>Exchange</code> itself.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>exchange.properties</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The <code>Exchange</code> properties.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>headers</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The headers of the In message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>camelContext</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Camel Context instance.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>request</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The In message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>in</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The In message.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>body</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The In message body.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>out</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Out message (only for InOut message exchange pattern).</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>response</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The Out message (only for InOut message exchange pattern).</p></td></tr></tbody></table> 
 </div>
</div><p>Since Camel-2.14, you can setup a custom Velocity Context yourself by setting the message header <strong>CamelVelocityContext&#160;</strong>just like this</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> VelocityContext velocityContext = new VelocityContext(variableMap); exchange.getIn().setHeader(&amp;quot;CamelVelocityContext&amp;quot;, velocityContext); </script> 
 </div>
</div><p>&#160;</p><h3 id="BookInOnePage-Hotreloading.2">Hot reloading</h3><p>The Velocity template resource is, by default, hot reloadable for both file and classpath resources (expanded jar). If you set <code>contentCache=true</code>, Camel will only load the resource once, and thus hot reloading is not possible. This scenario can be used in production, when the resource never changes.</p><h3 id="BookInOnePage-Dynamictemplates.1">Dynamic templates</h3><p><strong>Available as of Camel 2.1</strong><br clear="none"> Camel provides two headers by which you can define a different resource location for a template or the template content itself. If any of these headers is set then Camel uses this over the endpoint configured resource. This allows you to provide a dynamic template at runtime.</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Header</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Type</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>CamelVelocityResourceUri</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>String</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.1:</strong> A URI for the template resource to use instead of the endpoint configured.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>CamelVelocityTemplate</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>String</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.1:</strong> The template to use instead of the endpoint configured.</p></td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-Samples.20">Samples</h3><p>For example you could use something like</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:My.Queue&amp;quot;). to(&amp;quot;velocity:com/acme/MyResponse.vm&amp;quot;); </script> 
 </div>
</div><p>To use a Velocity template to formulate a response to a message for InOut message exchanges (where there is a <code>JMSReplyTo</code> header).</p><p>If you want to use InOnly and consume the message and send it to another destination, you could use the following route:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:My.Queue&amp;quot;). to(&amp;quot;velocity:com/acme/MyResponse.vm&amp;quot;). to(&amp;quot;activemq:Another.Queue&amp;quot;); </script> 
 </div>
</div><p>And to use the content cache, e.g. for use in production, where the <code>.vm</code> template never changes:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:My.Queue&amp;quot;). to(&amp;quot;velocity:com/acme/MyResponse.vm?contentCache=true&amp;quot;). to(&amp;quot;activemq:Another.Queue&amp;quot;); </script> 
 </div>
</div><p>And a file based resource:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:My.Queue&amp;quot;). to(&amp;quot;velocity:file://myfolder/MyResponse.vm?contentCache=true&amp;quot;). to(&amp;quot;activemq:Another.Queue&amp;quot;); </script> 
 </div>
</div><p>In <strong>Camel 2.1</strong> it's possible to specify what template the component should use dynamically via a header, so for example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:in&amp;quot;). setHeader(&amp;quot;CamelVelocityResourceUri&amp;quot;).constant(&amp;quot;path/to/my/template.vm&amp;quot;). to(&amp;quot;velocity:dummy&amp;quot;); </script> 
 </div>
</div><p>In <strong>Camel 2.1</strong> it's possible to specify a template directly as a header the component should use dynamically via a header, so for example:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:in&amp;quot;). setHeader(&amp;quot;CamelVelocityTemplate&amp;quot;).constant(&amp;quot;Hi this is a velocity template that can do templating ${body}&amp;quot;). to(&amp;quot;velocity:dummy&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-TheEmailSample.2">The Email Sample</h3><p>In this sample we want to use Velocity templating for an order confirmation email. The email template is laid out in Velocity as:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">Dear ${headers.lastName}, ${headers.firstName} Thanks for the order of ${headers.item}. Regards Camel Riders Bookstore ${body} </script> 
 </div>
</div><p>And the java code:
 </p><div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> private Exchange createLetter() { Exchange exchange = context.getEndpoint(&amp;quot;direct:a&amp;quot;).createExchange(); Message msg = exchange.getIn(); msg.setHeader(&amp;quot;firstName&amp;quot;, &amp;quot;Claus&amp;quot;); msg.setHeader(&amp;quot;lastName&amp;quot;, &amp;quot;Ibsen&amp;quot;); msg.setHeader(&amp;quot;item&amp;quot;, &amp;quot;Camel in Action&amp;quot;); msg.setBody(&amp;quot;PS: Next beer is on me, James&amp;quot;); return exchange; } @Test public void testVelocityLetter() throws Exception { MockEndpoint mock = getMockEndpoint(&amp;quot;mock:result&amp;quot;); mock.expectedMessageCount(1); mock.message(0).body(String.class).contains(&amp;quot;Thanks for the order of Camel in Action&amp;quot;); template.send(&amp;quot;direct:a&amp;quot;, createLetter()); mock.assertIsSatisfied(); } protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { public void configure() throws Exception { from(&amp;quot;direct:a&amp;quot;).to(&amp;quot;velocity:org/apache/camel/component/velocity/letter.vm&amp;quot;).to(&amp;quot;mock:result&amp;quot;); } }; } </script> 
  </div>
 </div><h3 id="BookInOnePage-SeeAlso.87">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-VMComponent">VM Component</h2><p>The <strong>vm:</strong> component provides asynchronous <a shape="rect" class="external-link" href="http://www.eecs.harvard.edu/~mdw/proj/seda/" rel="nofollow">SEDA</a> behavior, exchanging messages on a <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/BlockingQueue.html" rel="nofollow">BlockingQueue</a> and invoking consumers in a separate thread pool.</p><p>This component differs from the <a shape="rect" href="seda.html">Seda</a> component in that VM supports communication across CamelContext instances - so you can use this mechanism to communicate across web applications (provided that <code>camel-core.jar</code> is on the <code>system/boot</code> classpath).</p><p>VM is an extension to the <a shape="rect" href="seda.html">Seda</a> component.</p><h3 id="BookInOnePage-URIformat.72">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> vm:queueName[?options] </script> 
 </div>
</div><p>Where <strong><code>queueName</code></strong> can be any string to uniquely identify the endpoint within the JVM (or at least within the classloader that loaded camel-core.jar)</p><p>You can append query options to the URI in the following format: <code>?option=value&amp;option=value&amp;...</code></p><div class="confluence-information-macro confluence-information-macro-information">
 <p class="title">Before Camel 2.3 - Same URI must be used for both producer and consumer</p>
 <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 <div class="confluence-information-macro-body"> 
  <p>An exactly identical <a shape="rect" href="vm.html">VM</a> endpoint URI <strong>must</strong> be used for both the producer and the consumer endpoint. Otherwise, Camel will create a second <a shape="rect" href="vm.html">VM</a> endpoint despite that the <code>queueName</code> portion of the URI is identical. For example:</p> 
  <div class="code panel pdl" style="border-width: 1px;">
   <div class="codeContent panelContent pdl"> 
    <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:foo&amp;quot;).to(&amp;quot;vm:bar?concurrentConsumers=5&amp;quot;); from(&amp;quot;vm:bar?concurrentConsumers=5&amp;quot;).to(&amp;quot;file://output&amp;quot;); </script> 
   </div>
  </div> 
  <p>Notice that we have to use the full URI, including options in both the producer and consumer.</p> 
  <p>In Camel 2.4 this has been fixed so that only the queue name must match. Using the queue name <code>bar</code>, we could rewrite the previous exmple as follows: </p> 
  <div class="code panel pdl" style="border-width: 1px;">
   <div class="codeContent panelContent pdl"> 
    <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:foo&amp;quot;).to(&amp;quot;vm:bar&amp;quot;); from(&amp;quot;vm:bar?concurrentConsumers=5&amp;quot;).to(&amp;quot;file://output&amp;quot;); </script> 
   </div>
  </div> 
 </div>
</div><h3 id="BookInOnePage-Options.79">Options</h3><p>See the <a shape="rect" href="seda.html">Seda</a> component for options and other important usage details as the same rules apply to the <a shape="rect" href="vm.html">Vm</a> component.</p><h3 id="BookInOnePage-Samples.21">Samples</h3><p>In the route below we send exchanges across CamelContext instances to a VM queue named <code>order.email</code>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;direct:in&amp;quot;).bean(MyOrderBean.class).to(&amp;quot;vm:order.email&amp;quot;); </script> 
 </div>
</div><p>And then we receive exchanges in some other Camel context (such as deployed in another <code>.war</code> application):</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;vm:order.email&amp;quot;).bean(MyOrderEmailSender.class); </script> 
 </div>
</div><h3 id="BookInOnePage-SeeAlso.88">See Also</h3><ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><ul class="alternate"><li><a shape="rect" href="seda.html">Seda</a></li></ul><h2 id="BookInOnePage-XMPPComponent">XMPP Component</h2><p>The <strong>xmpp:</strong> component implements an XMPP (Jabber) transport.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-xmpp&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.73">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter">xmpp://[login@]hostname[:port][/participant][?Options] </script> 
 </div>
</div><p>The component supports both room based and private person-person conversations.<br clear="none"> The component supports both producer and consumer (you can get messages from XMPP or send messages to XMPP). Consumer mode supports rooms starting.</p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><h3 id="BookInOnePage-Options.80">Options</h3><div class="table-wrap">
 <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>room</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If this option is specified, the component will connect to MUC (Multi User Chat). Usually, the domain name for MUC is different from the login domain. For example, if you are <code>superman@jabber.org</code> and want to join the <code>krypton</code> room, then the room URL is <code>krypton@conference.jabber.org</code>. Note the <code>conference</code> part.<br clear="none"> It is not a requirement to provide the full room JID. If the <code>room</code> parameter does not contain the <code>@</code> symbol, the domain part will be discovered and added by Camel</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>user</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>User name (without server name). If not specified, anonymous login will be attempted.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>password</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Password.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>resource</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>XMPP resource. The default is <code>Camel</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>createAccount</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>If <code>true</code>, an attempt to create an account will be made. Default is <code>false</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>participant</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>JID (Jabber ID) of person to receive messages. <code>room</code> parameter has precedence over <code>participant</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>nickname</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Use nickname when joining room. If room is specified and nickname is not, <code>user</code> will be used for the nickname.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>serviceName</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>The name of the service you are connecting to. For Google Talk, this would be <code>gmail.com</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>testConnectionOnStartup</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11</strong> Specifies whether to test the connection on startup. This is used to ensure that the XMPP client has a valid connection to the XMPP server when the route starts. Camel throws an exception on startup if a connection cannot be established. When this option is set to false, Camel will attempt to establish a "lazy" connection when needed by a producer, and will poll for a consumer connection until the connection is established. Default is <code>true</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>connectionPollDelay</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11</strong> The amount of time in seconds between polls to verify the health of the XMPP connection, or between attempts to establish an initial consumer connection. Camel will try to re-establish a connection if it has become inactive. Default is <code>10 seconds</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">pubsub</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.15</strong> Accept pubsub packets on input, default is false</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">doc</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.15</strong> <span>Set a doc header on the IN message containing a Document form of the incoming packet; default is true if presence or pubsub are true, otherwise false</span></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">connectionConfiguration</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.18:</strong> To use an existing connection configuration</td></tr></tbody></table>
</div><h3 id="BookInOnePage-HeadersandsettingSubjectorLanguage">Headers and setting Subject or Language</h3><p>Camel sets the message IN headers as properties on the XMPP message. You can configure a <code>HeaderFilterStategy</code> if you need custom filtering of headers.<br clear="none"> The <strong>Subject</strong> and <strong>Language</strong> of the XMPP message are also set if they are provided as IN headers.</p><h3 id="BookInOnePage-Examples.28">Examples</h3><p>User <code>superman</code> to join room <code>krypton</code> at <code>jabber</code> server with password, <code>secret</code>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter">xmpp://superman@jabber.org/?room=krypton@conference.jabber.org&amp;amp;password=secret </script> 
 </div>
</div><p>User <code>superman</code> to send messages to <code>joker</code>:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: text; gutter: false; theme: Default" type="syntaxhighlighter">xmpp://superman@jabber.org/joker@jabber.org?password=secret </script> 
 </div>
</div><p>Routing example in Java:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;timer://kickoff?period=10000&amp;quot;). setBody(constant(&amp;quot;I will win!\n Your Superman.&amp;quot;)). to(&amp;quot;xmpp://superman@jabber.org/joker@jabber.org?password=secret&amp;quot;); </script> 
 </div>
</div><p>Consumer configuration, which writes all messages from <code>joker</code> into the queue, <code>evil.talk</code>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;xmpp://superman@jabber.org/joker@jabber.org?password=secret&amp;quot;). to(&amp;quot;activemq:evil.talk&amp;quot;); </script> 
 </div>
</div><p>Consumer configuration, which listens to room messages:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;xmpp://superman@jabber.org/?password=secret&amp;amp;room=krypton@conference.jabber.org&amp;quot;). to(&amp;quot;activemq:krypton.talk&amp;quot;); </script> 
 </div>
</div><p>Room in short notation (no domain part):</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;xmpp://superman@jabber.org/?password=secret&amp;amp;room=krypton&amp;quot;). to(&amp;quot;activemq:krypton.talk&amp;quot;); </script> 
 </div>
</div><p>When connecting to the Google Chat service, you'll need to specify the <code>serviceName</code> as well as your credentials:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;direct:start&amp;quot;). to(&amp;quot;xmpp://talk.google.com:5222/touser@gmail.com?serviceName=gmail.com&amp;amp;user=fromuser&amp;amp;password=secret&amp;quot;). to(&amp;quot;mock:result&amp;quot;);</script> 
 </div>
</div><p>&#160;</p><p></p><h3 id="BookInOnePage-SeeAlso.89">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-XQuery.1">XQuery</h2><p>The <strong>xquery:</strong> component allows you to process a message using an <a shape="rect" href="xquery.html">XQuery</a> template. This can be ideal when using <a shape="rect" href="templating.html">Templating</a> to generate respopnses for requests.</p><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-saxon&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-URIformat.74">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> xquery:templateName[?options] </script> 
 </div>
</div><p>Where <strong>templateName</strong> is the classpath-local URI of the template to invoke; or the complete URL of the remote template.</p><p>For example you could use something like this:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;activemq:My.Queue&amp;quot;). to(&amp;quot;xquery:com/acme/mytransform.xquery&amp;quot;); </script> 
 </div>
</div><p>To use an XQuery template to formulate a response to a message for InOut message exchanges (where there is a <code>JMSReplyTo</code> header).</p><p>If you want to use InOnly, consume the message, and send it to another destination, you could use the following route:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> from(&amp;quot;activemq:My.Queue&amp;quot;). to(&amp;quot;xquery:com/acme/mytransform.xquery&amp;quot;). to(&amp;quot;activemq:Another.Queue&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-SeeAlso.90">See Also</h3><ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul><h2 id="BookInOnePage-XSLT">XSLT</h2><p>The <strong>xslt:</strong> component allows you to process a message using an <a shape="rect" class="external-link" href="http://www.w3.org/TR/xslt" rel="nofollow">XSLT</a> template. This can be ideal when using <a shape="rect" href="templating.html">Templating</a> to generate respopnses for requests.</p><h3 id="BookInOnePage-URIformat.75">URI format</h3><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">xslt:templateName[?options] </script> 
 </div>
</div><p>Where <strong>templateName</strong> is the classpath-local URI of the template to invoke; or the complete URL of the remote template. Refer to the <a shape="rect" class="external-link" href="http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/core/io/DefaultResourceLoader.html" rel="nofollow">Spring Documentation for more detail of the URI syntax</a></p><p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;...</code></p><p>Here are some example URIs</p><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>URI</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"> 
      <div class="code panel pdl" style="border-width: 1px;"> 
       <div class="codeContent panelContent pdl"> 
        <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">xslt:com/acme/mytransform.xsl</script> 
       </div> 
      </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>refers to the file com/acme/mytransform.xsl on the classpath</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"> 
      <div class="code panel pdl" style="border-width: 1px;"> 
       <div class="codeContent panelContent pdl"> 
        <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">xslt:file:///foo/bar.xsl</script> 
       </div> 
      </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>refers to the file /foo/bar.xsl</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"> 
      <div class="code panel pdl" style="border-width: 1px;"> 
       <div class="codeContent panelContent pdl"> 
        <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">xslt:http://acme.com/cheese/foo.xsl</script> 
       </div> 
      </div></td><td colspan="1" rowspan="1" class="confluenceTd"><p>refers to the remote http resource</p></td></tr></tbody></table> 
 </div>
</div><p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component when using <strong>Camel 2.8</strong> or older:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;camel-spring&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;x.x.x&amp;lt;/version&amp;gt; &amp;lt;!-- use the same version as your Camel core version --&amp;gt; &amp;lt;/dependency&amp;gt; </script> 
 </div>
</div><p>From Camel 2.9 onwards the <a shape="rect" href="xslt.html">XSLT</a> component is provided directly in the camel-core.</p><h3 id="BookInOnePage-Options.81">Options</h3><div class="confluenceTableSmall">
 <div class="table-wrap"> 
  <table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Default Value</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>converter</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Option to override default <a shape="rect" class="external-link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/converter/jaxp/XmlConverter.html">XmlConverter</a>. Will lookup for the converter in the <a shape="rect" href="registry.html">Registry</a>. The provided converted must be of type org.apache.camel.converter.jaxp.XmlConverter.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transformerFactory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Option to override default <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/TransformerFactory.html" rel="nofollow">TransformerFactory</a>. Will lookup for the transformerFactory in the <a shape="rect" href="registry.html">Registry</a>. The provided transformer factory must be of type javax.xml.transform.TransformerFactory.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transformerFactoryClass</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Option to override default <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/TransformerFactory.html" rel="nofollow">TransformerFactory</a>. Will create a TransformerFactoryClass instance and set it to the converter.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>uriResolverFactory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>DefaultXsltUriResolverFactory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17</strong>: <span style="color: rgb(51,51,51);">&#160;Reference to a&#160;</span><code style="text-align: left;">org.apache.camel.component.</code><code style="text-align: left;">xslt</code><code style="text-align: left;">.</code><span style="color: rgb(51,51,51);"><code>XsltUriResolverFactory</code> which creates an URI resolver per endpoint</span><code style="text-align: left;">.</code><span style="color: rgb(51,51,51);">The default implementation returns an instance of&#160;<code><span>org.apache.camel.component.xslt.</span></code></span><span style="color: rgb(51,51,51);"><span><code>DefaultXsltUriResolverFactory</code> which creates the default URI resolver&#160;<span style="color: rgb(51,51,51);"><span><span style="color: rgb(51,51,51);"><code><span>org.apache.camel.builder.</span><span>xml</span></code></span>.XsltUriResolver</span></span> per endpoint. The default URI resolver reads XSLT documents from the classpath and the file system. This option instead of the option <code>uriResolver</code>&#160;shall be used when the URI resolver depends on the resource URI of the root XSLT document specified in the endpoint; for example, if you want to extend the default URI resolver. This option is also available on the XSLT component, so that you can set the resource resolver factory only once for all endpoints.</span></span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>uriResolver</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3</strong>: Allows you to use a custom <code>javax.xml.transformation.URIResolver</code>. Camel will by default use its own implementation <code>org.apache.camel.builder.xml.XsltUriResolver</code> which is capable of loading from classpath.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>resultHandlerFactory</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> Allows you to use a custom <code>org.apache.camel.builder.xml.ResultHandlerFactory</code> which is capable of using custom <code>org.apache.camel.builder.xml.ResultHandler</code> types.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>failOnNullBody</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> Whether or not to throw an exception if the input body is null.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>deleteOutputFile</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.6:</strong> If you have <code>output=file</code> then this option dictates whether or not the output file should be deleted when the <a shape="rect" href="exchange.html">Exchange</a> is done processing. For example suppose the output file is a temporary file, then it can be a good idea to delete it after use.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>output</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>string</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.3:</strong> Option to specify which output type to use. Possible values are: <code>string, bytes, DOM, file</code>. The first three options are all in memory based, where as <code>file</code> is streamed directly to a <code>java.io.File</code>. For <code>file</code> you <strong>must</strong> specify the filename in the IN header with the key <code>Exchange.XSLT_FILE_NAME</code> which is also <code>CamelXsltFileName</code>. Also any paths leading to the filename must be created beforehand, otherwise an exception is thrown at runtime.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>contentCache</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>true</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.6:</strong> Cache for the resource content (the stylesheet file) when it is loaded. If set to <code>false</code> Camel will reload the stylesheet file on each message processing. This is good for development. <br clear="none"> Note: from <strong>Camel 2.9</strong> a cached stylesheet can be forced to reload at runtime via JMX using the <code>clearCachedStylesheet</code> operation.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>allowStAX</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>&#160;</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.8.3/2.9:</strong> Whether to allow using StAX as the <code>javax.xml.transform.Source</code>. The option is default <code>false</code> in Camel 2.11.3/2.12.2 or older. And default <code>true</code> in Camel 2.11.4/2.12.3 onwards.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>transformerCacheSize</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>0</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.9.3/2.10.1:</strong> The number of <code>javax.xml.transform.Transformer</code> object that are cached for reuse to avoid calls to <code>Template.newTransformer()</code>.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>saxon</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>false</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.11:</strong> Whether to use Saxon as the <code>transformerFactoryClass</code>. If enabled then the class <code>net.sf.saxon.TransformerFactoryImpl</code>. You would need to add Saxon to the classpath.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>saxonExtensionFunctions</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><code>null</code></p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.17:</strong><span> <span>Allows to configure one or more custom net.sf.saxon.lib.ExtensionFunctionDefinition<span>. You would need to add Saxon to the classpath. By setting this option, saxon option will be turned out automatically.</span></span></span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code>errorListener</code></p></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>Camel 2.14:</strong> Allows to configure to use a custom <code>javax.xml.transform.ErrorListener</code>. Beware when doing this then the default error listener which captures any errors or fatal errors and store information on the Exchange as properties is not in use. So only use this option for special use-cases.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><code>entityResolver</code></td><td colspan="1" rowspan="1" class="confluenceTd">&#160;</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>Camel 2.18:</strong> To use a custom org.xml.sax.EntityResolver with javax.xml.transform.sax.SAXSource.</td></tr></tbody></table> 
 </div>
</div><h3 id="BookInOnePage-UsingXSLTendpoints">Using XSLT endpoints</h3><p>For example you could use something like</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:My.Queue&amp;quot;). to(&amp;quot;xslt:com/acme/mytransform.xsl&amp;quot;); </script> 
 </div>
</div><p>To use an XSLT template to formulate a response for a message for InOut message exchanges (where there is a <code>JMSReplyTo</code> header).</p><p>If you want to use InOnly and consume the message and send it to another destination you could use the following route:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">from(&amp;quot;activemq:My.Queue&amp;quot;). to(&amp;quot;xslt:com/acme/mytransform.xsl&amp;quot;). to(&amp;quot;activemq:Another.Queue&amp;quot;); </script> 
 </div>
</div><h3 id="BookInOnePage-GettingParametersintotheXSLTtoworkwith">Getting Parameters into the XSLT to work with</h3><p>By default, all headers are added as parameters which are available in the XSLT.<br clear="none"> To do this you will need to declare the parameter so it is then <em>useable</em>.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;setHeader headerName=&amp;quot;myParam&amp;quot;&amp;gt;&amp;lt;constant&amp;gt;42&amp;lt;/constant&amp;gt;&amp;lt;/setHeader&amp;gt; &amp;lt;to uri=&amp;quot;xslt:MyTransform.xsl&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>And the XSLT just needs to declare it at the top level for it to be available:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;xsl: ...... &amp;gt; &amp;lt;xsl:param name=&amp;quot;myParam&amp;quot;/&amp;gt; &amp;lt;xsl:template ...&amp;gt; </script> 
 </div>
</div><h3 id="BookInOnePage-SpringXMLversions">Spring XML versions</h3><p>To use the above examples in Spring XML you would use something like</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;camelContext xmlns=&amp;quot;http://activemq.apache.org/camel/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;activemq:My.Queue&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;xslt:org/apache/camel/spring/processor/example.xsl&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;activemq:Another.Queue&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; </script> 
 </div>
</div><p>There is a <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-spring/src/test/java/org/apache/camel/spring/processor/XsltTest.java">test case</a> along with <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-spring/src/test/resources/org/apache/camel/spring/processor/XsltTest-context.xml">its Spring XML</a> if you want a concrete example.</p><h3 id="BookInOnePage-Usingxsl:include">Using xsl:include</h3><p><strong>Camel 2.2 or older</strong><br clear="none"> If you use xsl:include in your XSL files then in Camel 2.2 or older it uses the default <code>javax.xml.transform.URIResolver</code> which means it can only lookup files from file system, and its does that relative from the JVM starting folder.</p><p>For example this include:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;xsl:include href=&amp;quot;staff_template.xsl&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>Will lookup the <code>staff_tempkalte.xsl</code> file from the starting folder where the application was started.</p><p><strong>Camel 2.3 or newer</strong> <br clear="none"> Now Camel provides its own implementation of <code>URIResolver</code> which allows Camel to load included files from the classpath and more intelligent than before.</p><p>For example this include:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;xsl:include href=&amp;quot;staff_template.xsl&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>Will now be located relative from the starting endpoint, which for example could be:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">.to(&amp;quot;xslt:org/apache/camel/component/xslt/staff_include_relative.xsl&amp;quot;) </script> 
 </div>
</div><p>Which means Camel will locate the file in the <strong>classpath</strong> as <code>org/apache/camel/component/xslt/staff_template.xsl</code>.<br clear="none"> This allows you to use xsl include and have xsl files located in the same folder such as we do in the example <code>org/apache/camel/component/xslt</code>.</p><p>You can use the following two prefixes <code>classpath:</code> or <code>file:</code> to instruct Camel to look either in classpath or file system. If you omit the prefix then Camel uses the prefix from the endpoint configuration. If that neither has one, then classpath is assumed.</p><p>You can also refer back in the paths such as</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;xsl:include href=&amp;quot;../staff_other_template.xsl&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>Which then will resolve the xsl file under <code>org/apache/camel/component</code>.</p><h4 id="BookInOnePage-Usingxsl:includeanddefaultprefix">Using xsl:include and default prefix</h4><p>When using xsl:include such as:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;xsl:include href=&amp;quot;staff_template.xsl&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>Then in Camel 2.10.3 and older, then Camel will use "classpath:" as the default prefix, and load the resource from the classpath. This works for most cases, but if you configure the starting resource to load from file,</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">.to(&amp;quot;xslt:file:etc/xslt/staff_include_relative.xsl&amp;quot;) </script> 
 </div>
</div><p>.. then you would have to prefix all your includes with "file:" as well.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;xsl:include href=&amp;quot;file:staff_template.xsl&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>From Camel 2.10.4 onwards we have made this easier as Camel will use the prefix from the endpoint configuration as the default prefix. So from Camel 2.10.4 onwards you can do:</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;xsl:include href=&amp;quot;staff_template.xsl&amp;quot;/&amp;gt; </script> 
 </div>
</div><p>Which will load the staff_template.xsl resource from the file system, as the endpoint was configured with "file:" as prefix.<br clear="none"> You can still though explicit configure a prefix, and then mix and match. And have both file and classpath loading. But that would be unusual, as most people either use file or classpath based resources.</p><h3 id="BookInOnePage-UsingSaxonextensionfunctions">Using Saxon extension functions</h3><p>Since Saxon 9.2, writing extension functions has been supplemented by a new mechanism, referred to as&#160;<a shape="rect" class="external-link" href="http://www.saxonica.com/html/documentation/extensibility/integratedfunctions" rel="nofollow" title="Follow link">integrated extension functions</a>&#160;you can now easily use camel:</p><div>
 <p>&#160;</p>
 <p>-&#160;Java example:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter">SimpleRegistry registry = new SimpleRegistry(); registry.put(&amp;quot;function1&amp;quot;, new MyExtensionFunction1()); registry.put(&amp;quot;function2&amp;quot;, new MyExtensionFunction2()); CamelContext context = new DefaultCamelContext(registry); context.addRoutes(new RouteBuilder() { @Override public void configure() throws Exception { from(&amp;quot;direct:start&amp;quot;) .to(&amp;quot;xslt:org/apache/camel/component/xslt/extensions/extensions.xslt?saxonExtensionFunctions=#function1,#function2&amp;quot;); } });</script> 
  </div>
 </div>
 <p>&#160;</p>
 <p>Spring example:</p>
 <div class="code panel pdl" style="border-width: 1px;">
  <div class="codeContent panelContent pdl"> 
   <script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter">&amp;lt;camelContext xmlns=&amp;quot;http://camel.apache.org/schema/spring&amp;quot;&amp;gt; &amp;lt;route&amp;gt; &amp;lt;from uri=&amp;quot;direct:extensions&amp;quot;/&amp;gt; &amp;lt;to uri=&amp;quot;xslt:org/apache/camel/component/xslt/extensions/extensions.xslt?saxonExtensionFunctions=#function1,#function2&amp;quot;/&amp;gt; &amp;lt;/route&amp;gt; &amp;lt;/camelContext&amp;gt; &amp;lt;bean id=&amp;quot;function1&amp;quot; class=&amp;quot;org.apache.camel.component.xslt.extensions.MyExtensionFunction1&amp;quot;/&amp;gt; &amp;lt;bean id=&amp;quot;function2&amp;quot; class=&amp;quot;org.apache.camel.component.xslt.extensions.MyExtensionFunction2&amp;quot;/&amp;gt;</script> 
  </div>
 </div>
 <p>&#160;</p>
</div><p>&#160;</p><h3 id="BookInOnePage-Dynamicstylesheets">Dynamic stylesheets</h3><p>To provide a dynamic stylesheet at runtime you can define a dynamic URI. See&#160;<a shape="rect" href="how-to-use-a-dynamic-uri-in-to.html">How to use a dynamic URI in to()</a> for more information.</p><p><strong>Available as of Camel 2.9 (removed in 2.11.4, 2.12.3 and 2.13.0)</strong><br clear="none"> Camel provides the <code>CamelXsltResourceUri</code> header which you can use to define a stylesheet to use instead of what is configured on the endpoint URI. This allows you to provide a dynamic stylesheet at runtime.</p><h3 id="BookInOnePage-Accessingwarnings,errorsandfatalErrorsfromXSLTErrorListener">Accessing warnings, errors and fatalErrors from XSLT ErrorListener</h3><p><strong>Available as of Camel 2.14</strong></p><p>From Camel 2.14 onwards, any warning/error or fatalError is stored on the current Exchange as a property with the keys&#160;<code>Exchange.XSLT_ERROR</code>,&#160;<code>Exchange.XSLT_FATAL_ERROR</code>, or&#160;<code>Exchange.XSLT_WARNING</code> which allows end users to get hold of any errors happening during transformation.</p><p>For example in the stylesheet below, we want to terminate if a staff has an empty dob field. And to include a custom error message using xsl:message.</p><div class="code panel pdl" style="border-width: 1px;">
 <div class="codeContent panelContent pdl"> 
  <script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"> &amp;lt;xsl:template match=&amp;quot;/&amp;quot;&amp;gt; &amp;lt;html&amp;gt; &amp;lt;body&amp;gt; &amp;lt;xsl:for-each select=&amp;quot;staff/programmer&amp;quot;&amp;gt; &amp;lt;p&amp;gt;Name: &amp;lt;xsl:value-of select=&amp;quot;name&amp;quot;/&amp;gt;&amp;lt;br /&amp;gt; &amp;lt;xsl:if test=&amp;quot;dob=&amp;#39;&amp;#39;&amp;quot;&amp;gt; &amp;lt;xsl:message terminate=&amp;quot;yes&amp;quot;&amp;gt;Error: DOB is an empty string!&amp;lt;/xsl:message&amp;gt; &amp;lt;/xsl:if&amp;gt; &amp;lt;/p&amp;gt; &amp;lt;/xsl:for-each&amp;gt; &amp;lt;/body&amp;gt; &amp;lt;/html&amp;gt; &amp;lt;/xsl:template&amp;gt;</script> 
 </div>
</div><p>This information is not available on the Exchange stored as an Exception that contains the message in the <code>getMessage()</code> method on the exception. The exception is stored on the Exchange as a warning with the key<span style="line-height: 1.4285715;">&#160;</span><code style="line-height: 1.4285715;">Exchange.XSLT_WARNING.</code></p><h3 id="BookInOnePage-NotesonusingXSLTandJavaVersions">Notes on using XSLT and Java Versions</h3><p>Here are some observations from Sameer, a Camel user, which he kindly shared with us:</p><blockquote>
 <p>In case anybody faces issues with the XSLT endpoint please review these points.</p>
 <p>I was trying to use an xslt endpoint for a simple transformation from one xml to another using a simple xsl. The output xml kept appearing (after the xslt processor in the route) with outermost xml tag with no content within.</p>
 <p>No explanations show up in the DEBUG logs. On the TRACE logs however I did find some error/warning indicating that the XMLConverter bean could no be initialized.</p>
 <p>After a few hours of cranking my mind, I had to do the following to get it to work (thanks to some posts on the users forum that gave some clue):</p>
 <p>1. Use the transformerFactory option in the route <code>("xslt:my-transformer.xsl?transformerFactory=tFactory")</code> with the <code>tFactory</code> bean having bean defined in the spring context for <code>class="org.apache.xalan.xsltc.trax.TransformerFactoryImpl"</code>.<br clear="none"> 2. Added the Xalan jar into my maven pom.</p>
 <p>My guess is that the default xml parsing mechanism supplied within the JDK (I am using 1.6.0_03) does not work right in this context and does not throw up any error either. When I switched to Xalan this way it works. This is not a Camel issue, but might need a mention on the xslt component page.</p>
 <p>Another note, jdk 1.6.0_03 ships with JAXB 2.0 while Camel needs 2.1. One workaround is to add the 2.1 jar to the <code>jre/lib/endorsed</code> directory for the jvm or as specified by the container.</p>
 <p>Hope this post saves newbie Camel riders some time.</p>
</blockquote><p></p><h3 id="BookInOnePage-SeeAlso.91">See Also</h3> 
 <ul><li><a shape="rect" href="configuring-camel.html">Configuring Camel</a></li><li><a shape="rect" href="component.html">Component</a></li><li><a shape="rect" href="endpoint.html">Endpoint</a></li><li><a shape="rect" href="getting-started.html">Getting Started</a></li></ul></div></div>
</body>
